<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/mgs/mgs_internal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/mgs/mgs_internal.h</h1><a href="mgs__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef _MGS_INTERNAL_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define _MGS_INTERNAL_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="libcfs_8h.html">libcfs/libcfs.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="lustre__log_8h.html">lustre_log.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="lustre__export_8h.html">lustre_export.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="lustre__nodemap_8h.html">lustre_nodemap.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="dt__object_8h.html">dt_object.h</a>&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="mgs__internal_8h.html#a6178881c8c5cd75b0bbb30bf5dc5c1b6">00046</a> <span class="preprocessor">#define MGSSELF_NAME    &quot;_mgs&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="mgs__internal_8h.html#a29a0ac87775c9f48307e18f0e71b3296">00048</a> <span class="preprocessor">#define MGS_SERVICE_WATCHDOG_FACTOR 2</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="comment">/* -- imperative recovery control data structures -- */</span>
<a name="l00054"></a>00054 <span class="keyword">struct </span><a class="code" href="structmgs__nidtbl.html">mgs_nidtbl</a>;
<a name="l00055"></a><a class="code" href="structmgs__nidtbl__target.html">00055</a> <span class="keyword">struct </span><a class="code" href="structmgs__nidtbl__target.html">mgs_nidtbl_target</a> {
<a name="l00056"></a><a class="code" href="structmgs__nidtbl__target.html#a22af449c17f9ce3638f39acf19fdd627">00056</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structmgs__nidtbl__target.html#a22af449c17f9ce3638f39acf19fdd627">mnt_list</a>;
<a name="l00057"></a><a class="code" href="structmgs__nidtbl__target.html#ac310f7ccb84d05074ba846ab8cee6523">00057</a>         <span class="keyword">struct </span><a class="code" href="structmgs__nidtbl.html">mgs_nidtbl</a>      *<a class="code" href="structmgs__nidtbl__target.html#ac310f7ccb84d05074ba846ab8cee6523">mnt_fs</a>;
<a name="l00058"></a><a class="code" href="structmgs__nidtbl__target.html#ac4d4e8a6c56293787fa8bbdecf1709a9">00058</a>         u64                     <a class="code" href="structmgs__nidtbl__target.html#ac4d4e8a6c56293787fa8bbdecf1709a9">mnt_version</a>;
<a name="l00059"></a><a class="code" href="structmgs__nidtbl__target.html#abbe55607fad74281882ae7c09082f975">00059</a>         <span class="keywordtype">int</span>                     <a class="code" href="structmgs__nidtbl__target.html#abbe55607fad74281882ae7c09082f975">mnt_type</a>;       <span class="comment">/* OST or MDT */</span>
<a name="l00060"></a><a class="code" href="structmgs__nidtbl__target.html#a0d9dcf517716eb404f652fce05483697">00060</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structmgs__nidtbl__target.html#a0d9dcf517716eb404f652fce05483697">mnt_last_active</a>;
<a name="l00061"></a><a class="code" href="structmgs__nidtbl__target.html#a182f21e0190ba7fd216bee981f69ced7">00061</a>         <span class="keyword">struct </span><a class="code" href="structmgs__target__info.html">mgs_target_info</a>  <a class="code" href="structmgs__nidtbl__target.html#a182f21e0190ba7fd216bee981f69ced7">mnt_mti</a>;
<a name="l00062"></a>00062 };
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">enum</span> {
<a name="l00065"></a><a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa14d09ab0186a4ef9b78f08bf7b29c283">00065</a>         <a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa14d09ab0186a4ef9b78f08bf7b29c283">IR_FULL</a> = 0,
<a name="l00066"></a><a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa383868fd27a7a15b67839c2dcbddf491">00066</a>         <a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa383868fd27a7a15b67839c2dcbddf491">IR_STARTUP</a>,
<a name="l00067"></a><a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa1285682cfb8069140e5a02db4c8f2bda">00067</a>         <a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa1285682cfb8069140e5a02db4c8f2bda">IR_DISABLED</a>,
<a name="l00068"></a><a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa3718401d33d00217e7bfd9d50d304cdd">00068</a>         <a class="code" href="mgs__internal_8h.html#afb24d298ddd4bc4ff61aa333f07a574aa3718401d33d00217e7bfd9d50d304cdd">IR_PARTIAL</a>
<a name="l00069"></a>00069 };
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="mgs__internal_8h.html#a6b62506855c6ca37b3ec6282147b3fe7">00071</a> <span class="preprocessor">#define IR_STRINGS { &quot;full&quot;, &quot;startup&quot;, &quot;disabled&quot;, &quot;partial&quot; }</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a>;
<a name="l00076"></a>00076 
<a name="l00080"></a><a class="code" href="structmgs__fsc.html">00080</a> <span class="keyword">struct </span><a class="code" href="structmgs__fsc.html" title="maintain fs client nodes of mgs.">mgs_fsc</a> {
<a name="l00081"></a><a class="code" href="structmgs__fsc.html#a057218b61bec284fd8cf5b172b32be76">00081</a>         <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a>            *<a class="code" href="structmgs__fsc.html#a057218b61bec284fd8cf5b172b32be76">mfc_fsdb</a>;
<a name="l00085"></a><a class="code" href="structmgs__fsc.html#a442854c245528c30c5769838923192af">00085</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structmgs__fsc.html#a442854c245528c30c5769838923192af" title="Where the fs client comes from.">mfc_export</a>;
<a name="l00090"></a><a class="code" href="structmgs__fsc.html#a577c7bc37a84e149930f8e3b1e346420">00090</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structmgs__fsc.html#a577c7bc37a84e149930f8e3b1e346420" title="list of fs clients from the same export, protected by mgs_export_data-&amp;gt;med_lock...">mfc_export_list</a>;
<a name="l00094"></a><a class="code" href="structmgs__fsc.html#a18138846eba51da5ebca8d9f71d3b1bd">00094</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structmgs__fsc.html#a18138846eba51da5ebca8d9f71d3b1bd" title="list of fs clients in the same fsdb, protected by fsdb-&amp;gt;fsdb_mutex">mfc_fsdb_list</a>;
<a name="l00095"></a><a class="code" href="structmgs__fsc.html#a85a4c23f0a648e75a4a59a06fa213a31">00095</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structmgs__fsc.html#a85a4c23f0a648e75a4a59a06fa213a31">mfc_ir_capable</a>:1;
<a name="l00096"></a>00096 };
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="structmgs__nidtbl.html">00098</a> <span class="keyword">struct </span><a class="code" href="structmgs__nidtbl.html">mgs_nidtbl</a> {
<a name="l00099"></a><a class="code" href="structmgs__nidtbl.html#ab9466807e46c9a06be73903e4f1dc4a3">00099</a>         <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a>            *<a class="code" href="structmgs__nidtbl.html#ab9466807e46c9a06be73903e4f1dc4a3">mn_fsdb</a>;
<a name="l00100"></a><a class="code" href="structmgs__nidtbl.html#afc9dcfebfc66b8aebdb74be4c7e4751a">00100</a>         <span class="keyword">struct </span>file             *<a class="code" href="structmgs__nidtbl.html#afc9dcfebfc66b8aebdb74be4c7e4751a">mn_version_file</a>;
<a name="l00101"></a><a class="code" href="structmgs__nidtbl.html#aa017a162f1cf49c1f4670605d1bf5179">00101</a>         <span class="keyword">struct </span>mutex             <a class="code" href="structmgs__nidtbl.html#aa017a162f1cf49c1f4670605d1bf5179">mn_lock</a>;
<a name="l00102"></a><a class="code" href="structmgs__nidtbl.html#a9d14ebe82c6d076ff8bd2819ae304c29">00102</a>         u64                      <a class="code" href="structmgs__nidtbl.html#a9d14ebe82c6d076ff8bd2819ae304c29">mn_version</a>;
<a name="l00103"></a><a class="code" href="structmgs__nidtbl.html#a1a1ed33c5668639eabd3098964662a05">00103</a>         <span class="keywordtype">int</span>                      <a class="code" href="structmgs__nidtbl.html#a1a1ed33c5668639eabd3098964662a05">mn_nr_targets</a>;
<a name="l00104"></a><a class="code" href="structmgs__nidtbl.html#a896819b7b66593c1194683c31572c0c5">00104</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structmgs__nidtbl.html#a896819b7b66593c1194683c31572c0c5">mn_targets</a>;
<a name="l00105"></a>00105 };
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="structmgs__tgt__srpc__conf.html">00107</a> <span class="keyword">struct </span><a class="code" href="structmgs__tgt__srpc__conf.html">mgs_tgt_srpc_conf</a> {
<a name="l00108"></a><a class="code" href="structmgs__tgt__srpc__conf.html#a0f89de860b04ab1ffdf64ecbc6f1c674">00108</a>         <span class="keyword">struct </span><a class="code" href="structmgs__tgt__srpc__conf.html">mgs_tgt_srpc_conf</a>  *<a class="code" href="structmgs__tgt__srpc__conf.html#a0f89de860b04ab1ffdf64ecbc6f1c674">mtsc_next</a>;
<a name="l00109"></a><a class="code" href="structmgs__tgt__srpc__conf.html#a93eee2ce93cc3b54b6f8ba1f7775c2a5">00109</a>         <span class="keywordtype">char</span>                      *<a class="code" href="structmgs__tgt__srpc__conf.html#a93eee2ce93cc3b54b6f8ba1f7775c2a5">mtsc_tgt</a>;
<a name="l00110"></a><a class="code" href="structmgs__tgt__srpc__conf.html#a8233a6da5109279e13d68bc35419e4a8">00110</a>         <span class="keyword">struct </span><a class="code" href="structsptlrpc__rule__set.html" title="A set of rules in memory.">sptlrpc_rule_set</a>    <a class="code" href="structmgs__tgt__srpc__conf.html#a8233a6da5109279e13d68bc35419e4a8">mtsc_rset</a>;
<a name="l00111"></a>00111 };
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="mgs__internal_8h.html#a3dfc47aefaa15a5d22b977f7fda351cd">00113</a> <span class="preprocessor">#define INDEX_MAP_SIZE  8192     </span><span class="comment">/* covers indicies to FFFF */</span>
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="mgs__internal_8h.html#aa12e1acfb51221cfc608f3d504dcd0ed">00115</a> <span class="preprocessor">#define FSDB_LOG_EMPTY          (0)  </span><span class="comment">/* missing client log */</span>
<a name="l00116"></a><a class="code" href="mgs__internal_8h.html#a1cc19987c7754878e67ab9ee8f60c007">00116</a> <span class="preprocessor">#define FSDB_OLDLOG14           (1)  </span><span class="comment">/* log starts in old (1.4) style */</span>
<a name="l00117"></a><a class="code" href="mgs__internal_8h.html#a69f96b1e69299d4ea2df6ad82fcfeffe">00117</a> <span class="preprocessor">#define FSDB_REVOKING_LOCK      (2)  </span><span class="comment">/* DLM lock is being revoked */</span>
<a name="l00118"></a><a class="code" href="mgs__internal_8h.html#a77b704e53907ccae77e04ce057586bf1">00118</a> <span class="preprocessor">#define FSDB_MGS_SELF           (3)  </span><span class="comment">/* for &apos;_mgs&apos;, used by sptlrpc */</span>
<a name="l00119"></a><a class="code" href="mgs__internal_8h.html#a8fd23ee5e4bcf0cf4e6e76a62b1a9fe5">00119</a> <span class="preprocessor">#define FSDB_OSCNAME18          (4)  </span><span class="comment">/* old 1.8 style OSC naming */</span>
<a name="l00120"></a><a class="code" href="mgs__internal_8h.html#a3e667ffe96fa90a424da047ad11ef00f">00120</a> <span class="preprocessor">#define FSDB_UDESC              (5)  </span><span class="comment">/* sptlrpc user desc, will be obsolete */</span>
<a name="l00121"></a><a class="code" href="mgs__internal_8h.html#a40b2b9616d9b65826f7cae6de5dd63cc">00121</a> <span class="preprocessor">#define FSDB_REVOKING_PARAMS    (6)  </span><span class="comment">/* DLM lock is being revoked */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="structfs__db.html">00123</a> <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a> {
<a name="l00124"></a><a class="code" href="structfs__db.html#a4838db18d5b3974d4d487ee8dfcd39de">00124</a>         <span class="keywordtype">char</span>              <a class="code" href="structfs__db.html#a4838db18d5b3974d4d487ee8dfcd39de">fsdb_name</a>[9];
<a name="l00125"></a><a class="code" href="structfs__db.html#afb2460e722e990128ed17f7988effaab">00125</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>  <a class="code" href="structfs__db.html#afb2460e722e990128ed17f7988effaab">fsdb_list</a>;            <span class="comment">/* list of databases */</span>
<a name="l00126"></a><a class="code" href="structfs__db.html#a592a8c5554596d483a7346b250a43b52">00126</a>         <span class="keyword">struct </span>mutex      <a class="code" href="structfs__db.html#a592a8c5554596d483a7346b250a43b52">fsdb_mutex</a>;
<a name="l00127"></a><a class="code" href="structfs__db.html#aeafd01ac6d9d0f20a6599dd5cedbde86">00127</a>         <span class="keywordtype">void</span>             *<a class="code" href="structfs__db.html#aeafd01ac6d9d0f20a6599dd5cedbde86">fsdb_ost_index_map</a>;   <span class="comment">/* bitmap of used indicies */</span>
<a name="l00128"></a><a class="code" href="structfs__db.html#a33812f1acdc3e860784f0d8895d7dddf">00128</a>         <span class="keywordtype">void</span>             *<a class="code" href="structfs__db.html#a33812f1acdc3e860784f0d8895d7dddf">fsdb_mdt_index_map</a>;   <span class="comment">/* bitmap of used indicies */</span>
<a name="l00129"></a><a class="code" href="structfs__db.html#a7382a17d60ca261434c76ee810b67d81">00129</a>         <span class="keywordtype">int</span>               <a class="code" href="structfs__db.html#a7382a17d60ca261434c76ee810b67d81">fsdb_mdt_count</a>;
<a name="l00130"></a><a class="code" href="structfs__db.html#a1bb803bc6c1896a3830b77b4c5c1fb19">00130</a>         <span class="keywordtype">char</span>             *<a class="code" href="structfs__db.html#a1bb803bc6c1896a3830b77b4c5c1fb19">fsdb_clilov</a>;  <span class="comment">/* COMPAT_146 client lov name */</span>
<a name="l00131"></a><a class="code" href="structfs__db.html#a17ae9056cfdae3fff414cb0530bbc1e6">00131</a>         <span class="keywordtype">char</span>             *<a class="code" href="structfs__db.html#a17ae9056cfdae3fff414cb0530bbc1e6">fsdb_clilmv</a>;
<a name="l00132"></a><a class="code" href="structfs__db.html#a0f5f2281ba72c12c63662b89a3b9c8c5">00132</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>     <a class="code" href="structfs__db.html#a0f5f2281ba72c12c63662b89a3b9c8c5">fsdb_flags</a>;
<a name="l00133"></a><a class="code" href="structfs__db.html#ad2ad2670dbe16d69bc7864797bcc9bb3">00133</a>         __u32             <a class="code" href="structfs__db.html#ad2ad2670dbe16d69bc7864797bcc9bb3">fsdb_gen</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">/* in-memory copy of the srpc rules, guarded by fsdb_lock */</span>
<a name="l00136"></a><a class="code" href="structfs__db.html#aca2f6ce4eb0765940eeef99537cbd31d">00136</a>         <span class="keyword">struct </span><a class="code" href="structsptlrpc__rule__set.html" title="A set of rules in memory.">sptlrpc_rule_set</a>   <a class="code" href="structfs__db.html#aca2f6ce4eb0765940eeef99537cbd31d">fsdb_srpc_gen</a>;
<a name="l00137"></a><a class="code" href="structfs__db.html#a3ca4bf1ae72846f45ed84735a967a2ac">00137</a>         <span class="keyword">struct </span><a class="code" href="structmgs__tgt__srpc__conf.html">mgs_tgt_srpc_conf</a> *<a class="code" href="structfs__db.html#a3ca4bf1ae72846f45ed84735a967a2ac">fsdb_srpc_tgt</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">/* list of fs clients, mgs_fsc. protected by mgs_mutex */</span>
<a name="l00140"></a><a class="code" href="structfs__db.html#ab5c2d03c25406fc10f0a80b1e5737125">00140</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>     <a class="code" href="structfs__db.html#ab5c2d03c25406fc10f0a80b1e5737125">fsdb_clients</a>;
<a name="l00141"></a><a class="code" href="structfs__db.html#aa78dbec2669d04f7a017e63eb46e9853">00141</a>         <span class="keywordtype">int</span>                  <a class="code" href="structfs__db.html#aa78dbec2669d04f7a017e63eb46e9853">fsdb_nonir_clients</a>;
<a name="l00142"></a><a class="code" href="structfs__db.html#af6f80972b361ad8882695eb27a501c89">00142</a>         <span class="keywordtype">int</span>                  <a class="code" href="structfs__db.html#af6f80972b361ad8882695eb27a501c89">fsdb_ir_state</a>;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <span class="comment">/* Target NIDs Table */</span>
<a name="l00145"></a><a class="code" href="structfs__db.html#aaab9d0c896f4ae1eb5cf6700d231ca10">00145</a>         <span class="keyword">struct </span><a class="code" href="structmgs__nidtbl.html">mgs_nidtbl</a>    <a class="code" href="structfs__db.html#aaab9d0c896f4ae1eb5cf6700d231ca10">fsdb_nidtbl</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="comment">/* async thread to notify clients */</span>
<a name="l00148"></a><a class="code" href="structfs__db.html#a95c2c2fc339d72008fc7d9d13ef6e40c">00148</a>         <span class="keyword">struct </span><a class="code" href="structmgs__device.html">mgs_device</a>    *<a class="code" href="structfs__db.html#a95c2c2fc339d72008fc7d9d13ef6e40c">fsdb_mgs</a>;
<a name="l00149"></a><a class="code" href="structfs__db.html#a2e1570ba2a6b542d8aa6570424558c6f">00149</a>         wait_queue_head_t     <a class="code" href="structfs__db.html#a2e1570ba2a6b542d8aa6570424558c6f">fsdb_notify_waitq</a>;
<a name="l00150"></a><a class="code" href="structfs__db.html#a87c29bf892c5234e3fe61fbf8cc499e2">00150</a>         <span class="keyword">struct </span>completion     <a class="code" href="structfs__db.html#a87c29bf892c5234e3fe61fbf8cc499e2">fsdb_notify_comp</a>;
<a name="l00151"></a><a class="code" href="structfs__db.html#a382f69b36f28673b858428d56179d2e6">00151</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>            <a class="code" href="structfs__db.html#a382f69b36f28673b858428d56179d2e6">fsdb_notify_start</a>;
<a name="l00152"></a><a class="code" href="structfs__db.html#a5f14fb906bfc040c2f1f8e4b5d72d1be">00152</a>         atomic_t              <a class="code" href="structfs__db.html#a5f14fb906bfc040c2f1f8e4b5d72d1be">fsdb_notify_phase</a>;
<a name="l00153"></a><a class="code" href="structfs__db.html#a970e01ff398965098ca2fdabdf4f74e4">00153</a>         <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structfs__db.html#a4fffe7295660bc03611cd2ef881c4051">fsdb_notify_async</a>:1,
<a name="l00154"></a>00154                              <a class="code" href="structfs__db.html#a970e01ff398965098ca2fdabdf4f74e4">fsdb_notify_stop</a>:1;
<a name="l00155"></a>00155         <span class="comment">/* statistic data */</span>
<a name="l00156"></a><a class="code" href="structfs__db.html#aeddd43a5c955d49c1b65c5c624de6cda">00156</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         <a class="code" href="structfs__db.html#aeddd43a5c955d49c1b65c5c624de6cda">fsdb_notify_total</a>;
<a name="l00157"></a><a class="code" href="structfs__db.html#a37399892f31dbd191180e5b7272fc4ab">00157</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         <a class="code" href="structfs__db.html#a37399892f31dbd191180e5b7272fc4ab">fsdb_notify_max</a>;
<a name="l00158"></a><a class="code" href="structfs__db.html#a7b4e808358502b890ac1493fc03c3103">00158</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>         <a class="code" href="structfs__db.html#a7b4e808358502b890ac1493fc03c3103">fsdb_notify_count</a>;
<a name="l00159"></a>00159 };
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="structmgs__device.html">00161</a> <span class="keyword">struct </span><a class="code" href="structmgs__device.html">mgs_device</a> {
<a name="l00162"></a><a class="code" href="structmgs__device.html#ad1ee6cddc2a42f434653e0f16b71307f">00162</a>         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>                 <a class="code" href="structmgs__device.html#ad1ee6cddc2a42f434653e0f16b71307f">mgs_dt_dev</a>;
<a name="l00163"></a><a class="code" href="structmgs__device.html#a20deb1f34e495211ac762b641aa3f481">00163</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__service.html" title="Definition of PortalRPC service.">ptlrpc_service</a>           *<a class="code" href="structmgs__device.html#a20deb1f34e495211ac762b641aa3f481">mgs_service</a>;
<a name="l00164"></a><a class="code" href="structmgs__device.html#a88912c957896125806ecef3e1a84b3c2">00164</a>         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>                *<a class="code" href="structmgs__device.html#a88912c957896125806ecef3e1a84b3c2">mgs_bottom</a>;
<a name="l00165"></a><a class="code" href="structmgs__device.html#a78daff2768e575e7a8abb56de4377bf0">00165</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>               *<a class="code" href="structmgs__device.html#a78daff2768e575e7a8abb56de4377bf0">mgs_bottom_exp</a>;
<a name="l00166"></a><a class="code" href="structmgs__device.html#a1ee18083e98c0ab11fc69d8aead1f06d">00166</a>         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>                *<a class="code" href="structmgs__device.html#a1ee18083e98c0ab11fc69d8aead1f06d">mgs_configs_dir</a>;
<a name="l00167"></a><a class="code" href="structmgs__device.html#ae76fef1705cc8202b6cfa85420f15576">00167</a>         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>                *<a class="code" href="structmgs__device.html#ae76fef1705cc8202b6cfa85420f15576">mgs_nidtbl_dir</a>;
<a name="l00168"></a><a class="code" href="structmgs__device.html#ad8486970ae18e84363dc6e7cdd60f58b">00168</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                 <a class="code" href="structmgs__device.html#ad8486970ae18e84363dc6e7cdd60f58b">mgs_fs_db_list</a>;
<a name="l00169"></a><a class="code" href="structmgs__device.html#a898b7cb5aa46b5e0e3a50c5f221c911c">00169</a>         spinlock_t                       <a class="code" href="structmgs__device.html#a898b7cb5aa46b5e0e3a50c5f221c911c">mgs_lock</a>; <span class="comment">/* covers mgs_fs_db_list */</span>
<a name="l00170"></a><a class="code" href="structmgs__device.html#a82cbc10bfde7370f6b0ab97e5262bd1c">00170</a>         <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structmgs__device.html#a82cbc10bfde7370f6b0ab97e5262bd1c">mgs_proc_live</a>;
<a name="l00171"></a><a class="code" href="structmgs__device.html#a251ebc998cb3188fb27f9641560cacf2">00171</a>         <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structmgs__device.html#a251ebc998cb3188fb27f9641560cacf2">mgs_proc_osd</a>;
<a name="l00172"></a><a class="code" href="structmgs__device.html#ad17607f20bfd9a58667a97dd559e4ccd">00172</a>         <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structmgs__device.html#ad17607f20bfd9a58667a97dd559e4ccd">mgs_proc_fstype</a>;
<a name="l00173"></a><a class="code" href="structmgs__device.html#aca75e0443bc425bb8c1c97c164feabc9">00173</a>         <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structmgs__device.html#aca75e0443bc425bb8c1c97c164feabc9">mgs_proc_mntdev</a>;
<a name="l00174"></a><a class="code" href="structmgs__device.html#a1ae2eaae5ebefdb9889667c7eb0576eb">00174</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>                       <a class="code" href="structmgs__device.html#a1ae2eaae5ebefdb9889667c7eb0576eb">mgs_start_time</a>;
<a name="l00175"></a><a class="code" href="structmgs__device.html#aed92fab9eb90e489670464c0a2eb98c1">00175</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>               *<a class="code" href="structmgs__device.html#aed92fab9eb90e489670464c0a2eb98c1">mgs_obd</a>;
<a name="l00176"></a><a class="code" href="structmgs__device.html#aa3bb6cf29693d79478ee61eb1ecacc10">00176</a>         <span class="keyword">struct </span><a class="code" href="structlocal__oid__storage.html">local_oid_storage</a>        *<a class="code" href="structmgs__device.html#aa3bb6cf29693d79478ee61eb1ecacc10">mgs_los</a>;
<a name="l00177"></a><a class="code" href="structmgs__device.html#ae3caf39c9ba0aeeee7b99d09ee9b5c24">00177</a>         <span class="keyword">struct </span>mutex                     <a class="code" href="structmgs__device.html#ae3caf39c9ba0aeeee7b99d09ee9b5c24">mgs_mutex</a>;
<a name="l00178"></a><a class="code" href="structmgs__device.html#ac05a2be8326ff6e7d2b929b65af0bf6a">00178</a>         <span class="keyword">struct </span>mutex                     <a class="code" href="structmgs__device.html#ac05a2be8326ff6e7d2b929b65af0bf6a">mgs_health_mutex</a>;
<a name="l00179"></a><a class="code" href="structmgs__device.html#a75078cac17c0cd74297fe49a774daffa">00179</a>         <span class="keyword">struct </span><a class="code" href="structlu__target.html">lu_target</a>                 <a class="code" href="structmgs__device.html#a75078cac17c0cd74297fe49a774daffa">mgs_lut</a>;
<a name="l00180"></a>00180 };
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="comment">/* this is a top object */</span>
<a name="l00183"></a><a class="code" href="structmgs__object.html">00183</a> <span class="keyword">struct </span><a class="code" href="structmgs__object.html">mgs_object</a> {
<a name="l00184"></a><a class="code" href="structmgs__object.html#adc3249dec7f0ed586dde2e90c37f2e96">00184</a>         <span class="keyword">struct </span><a class="code" href="structlu__object__header.html" title="&amp;quot;Compound&amp;quot; object, consisting of multiple layers.">lu_object_header</a> <a class="code" href="structmgs__object.html#adc3249dec7f0ed586dde2e90c37f2e96">mgo_header</a>;
<a name="l00185"></a><a class="code" href="structmgs__object.html#aec51b78f3f3d9b7e133bd38c0689b7f5">00185</a>         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>        <a class="code" href="structmgs__object.html#aec51b78f3f3d9b7e133bd38c0689b7f5">mgo_obj</a>;
<a name="l00186"></a><a class="code" href="structmgs__object.html#a57dd86ee5815f0078c216a22f10e8fe3">00186</a>         <span class="keywordtype">int</span>                     <a class="code" href="structmgs__object.html#a57dd86ee5815f0078c216a22f10e8fe3">mgo_no_attrs</a>;
<a name="l00187"></a><a class="code" href="structmgs__object.html#a8af726e0309bd3fc253bb4cb2621a356">00187</a>         <span class="keywordtype">int</span>                     <a class="code" href="structmgs__object.html#a8af726e0309bd3fc253bb4cb2621a356">mgo_reserved</a>;
<a name="l00188"></a>00188 };
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a5c9e2484ce204edeb5dc7185831719a1">mgs_init_fsdb_list</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs);
<a name="l00191"></a>00191 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#afa7678d5f1d68f54cf5f98a7388bb651">mgs_cleanup_fsdb_list</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs);
<a name="l00192"></a>00192 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#ab228c39ab2c69f7ba760d0b88750a963">mgs__mgs_fsdb_setup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00193"></a>00193                         <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00194"></a>00194 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a9af54b176b554d2b46c5fc91edc7f464">mgs_params_fsdb_setup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00195"></a>00195                           <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00196"></a>00196 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a359aefa66a460606e71f68466cc4d89c">mgs_params_fsdb_cleanup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs);
<a name="l00197"></a>00197 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a107716042db393c8f668b5b7814aa658">mgs_find_or_make_fsdb</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00198"></a>00198                           <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> **dbh);
<a name="l00199"></a>00199 <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a> *<a class="code" href="mgs__internal_8h.html#a8b37e12b5b7a94ce7e6946f203dc86fc">mgs_find_fsdb</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keywordtype">char</span> *fsname);
<a name="l00200"></a>00200 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a3df6f9335897c02496fd461a589dd8a8">mgs_get_fsdb_srpc_from_llog</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00201"></a>00201                                 <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00202"></a>00202 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a355055ca7a6812de38e92bb76592b01c">mgs_check_index</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00203"></a>00203                     <span class="keyword">struct</span> <a class="code" href="structmgs__target__info.html">mgs_target_info</a> *mti);
<a name="l00204"></a>00204 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a0461e5074dbc242d61ef52bcde4a7b18">mgs_check_failnid</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00205"></a>00205                       <span class="keyword">struct</span> <a class="code" href="structmgs__target__info.html">mgs_target_info</a> *mti);
<a name="l00206"></a>00206 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a8a7b9bad6f6e196cb05763a3ffcbc314">mgs_write_log_target</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00207"></a>00207                          <span class="keyword">struct</span> <a class="code" href="structmgs__target__info.html">mgs_target_info</a> *mti, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00208"></a>00208 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#aab1054f700a85f1bf9c563bede07f3ac" title="Replace nids for device to nids values.">mgs_replace_nids</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00209"></a>00209                      <span class="keywordtype">char</span> *<a class="code" href="llverdev_8c.html#a48d51caca654a80a7ea9eb13c3ddbb7b">devname</a>, <span class="keywordtype">char</span> *nids);
<a name="l00210"></a>00210 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a3dfc2b78e1d6157dbf1ed8ee8a24d023">mgs_erase_log</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00211"></a>00211                   <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00212"></a>00212 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a4d03e292513a24e2b3766be2a6581753">mgs_erase_logs</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00213"></a>00213                    <span class="keywordtype">char</span> *fsname);
<a name="l00214"></a>00214 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a2e5f5baf1f1daddf5d3cbe391f1b2463">mgs_setparam</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00215"></a>00215                  <span class="keyword">struct</span> <a class="code" href="structlustre__cfg.html">lustre_cfg</a> *lcfg, <span class="keywordtype">char</span> *fsname);
<a name="l00216"></a>00216 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a5ce5801b186fc109148b67f3ab22a094">mgs_list_logs</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00217"></a>00217                   <span class="keyword">struct</span> <a class="code" href="structobd__ioctl__data.html">obd_ioctl_data</a> *data);
<a name="l00218"></a>00218 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#afd81ce3ad969879ca9a786b2a37fbd61">mgs_pool_cmd</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00219"></a>00219                  <span class="keyword">enum</span> <a class="code" href="group__cfg.html#ga980511536826a6f5df2877e44c9af68b">lcfg_command_type</a> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>, <span class="keywordtype">char</span> *fsname,
<a name="l00220"></a>00220                  <span class="keywordtype">char</span> *ostname);
<a name="l00221"></a>00221 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a9e1cabd4707ace3138f62d12eb4a2882">mgs_nodemap_cmd</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00222"></a>00222                     <span class="keyword">enum</span> <a class="code" href="group__cfg.html#ga980511536826a6f5df2877e44c9af68b">lcfg_command_type</a> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *nodemap_name,
<a name="l00223"></a>00223                     <span class="keywordtype">char</span> *param);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">/* mgs_handler.c */</span>
<a name="l00226"></a>00226 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#acb1ab19140decbbfd20b68ae9387d346">mgs_get_lock</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *res,
<a name="l00227"></a>00227                   <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh);
<a name="l00228"></a>00228 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a7a9b4c480fa530f59d5fb48a6c4ed721">mgs_put_lock</a>(<span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh);
<a name="l00229"></a>00229 <span class="keywordtype">void</span> <a class="code" href="mgs__handler_8c.html#a24564015dd4363b47c2da61a40b55421">mgs_revoke_lock</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb, <span class="keywordtype">int</span> type);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="comment">/* mgs_nids.c */</span>
<a name="l00232"></a>00232 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a23cb17395ac476421e2be760747d98f5">mgs_ir_update</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00233"></a>00233                    <span class="keyword">struct</span> <a class="code" href="structmgs__target__info.html">mgs_target_info</a> *mti);
<a name="l00234"></a>00234 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#ad73b0228beb2fb6fb3b4b9dad025fde5">mgs_ir_init_fs</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00235"></a>00235                    <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00236"></a>00236 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a1ecfe16762c3e19e559c17066fb0e917">mgs_ir_fini_fs</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00237"></a>00237 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a9921820a7627bb61d950e4348a549669">mgs_ir_notify_complete</a>(<span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00238"></a>00238 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a54b4462c5931809e87dac0ef4d188674">mgs_get_ir_logs</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req);
<a name="l00239"></a>00239 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a6253023dd4dd371cf5d88158cf487db8">lprocfs_wr_ir_state</a>(<span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *buffer,
<a name="l00240"></a>00240                          <span class="keywordtype">size_t</span> count, <span class="keywordtype">void</span> *data);
<a name="l00241"></a>00241 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#ab0fe5d54aeb9b89e4ad277bcfc67ebfe">lprocfs_rd_ir_state</a>(<span class="keyword">struct</span> seq_file *seq, <span class="keywordtype">void</span> *data);
<a name="l00242"></a>00242 ssize_t
<a name="l00243"></a>00243 <a class="code" href="mgs__internal_8h.html#a3bff4d3994d47d1ae9b5369a18433309">lprocfs_ir_timeout_seq_write</a>(<span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *buffer,
<a name="l00244"></a>00244                              <span class="keywordtype">size_t</span> count, loff_t *off);
<a name="l00245"></a>00245 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a05a6780b134435db9a50593c521de244">lprocfs_ir_timeout_seq_show</a>(<span class="keyword">struct</span> seq_file *seq, <span class="keywordtype">void</span> *data);
<a name="l00246"></a>00246 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a2e87c901daed10df54f27602f7358244">mgs_fsc_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00247"></a>00247 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a4895da9f3960c0bbf55168c07d162b68">mgs_fsc_cleanup_by_fsdb</a>(<span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00248"></a>00248 <span class="keywordtype">int</span>  <a class="code" href="mgs__internal_8h.html#a451023afa1a4b3ed8fe2acc59209fcbc">mgs_fsc_attach</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00249"></a>00249                     <span class="keywordtype">char</span> *fsname);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="comment">/* mgs_fs.c */</span>
<a name="l00252"></a>00252 <span class="keywordtype">int</span> <a class="code" href="mgs__fs_8c.html#a5a8830bda8417b922d9479c4b21c1a76" title="Initialize MGS per-export statistics.">mgs_export_stats_init</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00253"></a>00253                           <span class="keywordtype">void</span> *localdata);
<a name="l00254"></a>00254 <span class="keywordtype">int</span> <a class="code" href="mgs__fs_8c.html#a15ea7f3d74881bda1500faace0ffedee">mgs_client_free</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00255"></a>00255 <span class="keywordtype">int</span> <a class="code" href="mgs__fs_8c.html#a6c6ea7780eea833baa951697f3d95911">mgs_fs_setup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *m);
<a name="l00256"></a>00256 <span class="keywordtype">int</span> <a class="code" href="mgs__fs_8c.html#a662414b2cbfd48ca598b2f3b3f13a312">mgs_fs_cleanup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *m);
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a0813661bfe1ace2d7471049bc8101104">lproc_mgs_setup</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>);
<a name="l00260"></a>00260 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a61b2f1b20f1e6497577f000534f6d217">lproc_mgs_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs);
<a name="l00261"></a>00261 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a1557a9543b9faad4bf94e04e81c0c057">lproc_mgs_add_live</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00262"></a>00262 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a055877f12e70c0b746b5ef9c1354f5eb">lproc_mgs_del_live</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb);
<a name="l00263"></a>00263 <span class="preprocessor">#else</span>
<a name="l00264"></a><a class="code" href="mgs__internal_8h.html#a0813661bfe1ace2d7471049bc8101104">00264</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a0813661bfe1ace2d7471049bc8101104">lproc_mgs_setup</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>)
<a name="l00265"></a>00265 {<span class="keywordflow">return</span> 0;}
<a name="l00266"></a><a class="code" href="mgs__internal_8h.html#a61b2f1b20f1e6497577f000534f6d217">00266</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a61b2f1b20f1e6497577f000534f6d217">lproc_mgs_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs)
<a name="l00267"></a>00267 {}
<a name="l00268"></a><a class="code" href="mgs__internal_8h.html#a1557a9543b9faad4bf94e04e81c0c057">00268</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a1557a9543b9faad4bf94e04e81c0c057">lproc_mgs_add_live</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb)
<a name="l00269"></a>00269 {<span class="keywordflow">return</span> 0;}
<a name="l00270"></a><a class="code" href="mgs__internal_8h.html#a055877f12e70c0b746b5ef9c1354f5eb">00270</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a055877f12e70c0b746b5ef9c1354f5eb">lproc_mgs_del_live</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs, <span class="keyword">struct</span> <a class="code" href="structfs__db.html">fs_db</a> *fsdb)
<a name="l00271"></a>00271 {<span class="keywordflow">return</span> 0;}
<a name="l00272"></a>00272 <span class="preprocessor">#endif</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a>00274 <span class="comment">/* mgs/lproc_mgs.c */</span>
<a name="l00275"></a>00275 <span class="keyword">enum</span> {
<a name="l00276"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a16591f00801ccb32a813918250eb79c4">00276</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a16591f00801ccb32a813918250eb79c4">LPROC_MGS_CONNECT</a> = 0,
<a name="l00277"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a39e07d6d6ad9a0e86e5b5b86e8359ab8">00277</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a39e07d6d6ad9a0e86e5b5b86e8359ab8">LPROC_MGS_DISCONNECT</a>,
<a name="l00278"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a2d2692537c93f67648239a80fc6c583f">00278</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a2d2692537c93f67648239a80fc6c583f">LPROC_MGS_EXCEPTION</a>,
<a name="l00279"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8ae74863e82d57286bc58076a02941933c">00279</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8ae74863e82d57286bc58076a02941933c">LPROC_MGS_TARGET_REG</a>,
<a name="l00280"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a615d8fef695ab916b23d70c57cbf7910">00280</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a615d8fef695ab916b23d70c57cbf7910">LPROC_MGS_TARGET_DEL</a>,
<a name="l00281"></a><a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a3165ef8c5c101eccf5df671fb8e340d8">00281</a>         <a class="code" href="mgs__internal_8h.html#a39b4e25c4e8f5fed29720be17a532fa8a3165ef8c5c101eccf5df671fb8e340d8">LPROC_MGS_LAST</a>
<a name="l00282"></a>00282 };
<a name="l00283"></a>00283 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#afa30fa04c3503cf54ddfb4ff86638ff4">mgs_counter_incr</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keywordtype">int</span> opcode);
<a name="l00284"></a>00284 <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a967132bbb25ffa6c0b7c25bd76011d95">mgs_stats_counter_init</a>(<span class="keyword">struct</span> <a class="code" href="structlprocfs__stats.html">lprocfs_stats</a> *stats);
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="structtemp__comp.html">00286</a> <span class="keyword">struct </span><a class="code" href="structtemp__comp.html">temp_comp</a> {
<a name="l00287"></a><a class="code" href="structtemp__comp.html#a543d1746a1fced49191f44e5b9591573">00287</a>         <span class="keyword">struct </span><a class="code" href="structmgs__target__info.html">mgs_target_info</a>  *<a class="code" href="structtemp__comp.html#a543d1746a1fced49191f44e5b9591573">comp_tmti</a>;
<a name="l00288"></a><a class="code" href="structtemp__comp.html#abdd822bcdfaa821d4ae999e1be9b932e">00288</a>         <span class="keyword">struct </span><a class="code" href="structmgs__target__info.html">mgs_target_info</a>  *<a class="code" href="structtemp__comp.html#abdd822bcdfaa821d4ae999e1be9b932e">comp_mti</a>;
<a name="l00289"></a><a class="code" href="structtemp__comp.html#a0947d63bb9297f9e1ef55a5b121e391e">00289</a>         <span class="keyword">struct </span><a class="code" href="structfs__db.html">fs_db</a>            *<a class="code" href="structtemp__comp.html#a0947d63bb9297f9e1ef55a5b121e391e">comp_fsdb</a>;
<a name="l00290"></a><a class="code" href="structtemp__comp.html#acdfae466b2aa757b5349467bbcb61117">00290</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>       *<a class="code" href="structtemp__comp.html#acdfae466b2aa757b5349467bbcb61117">comp_obd</a>;
<a name="l00291"></a>00291 };
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="structmgs__thread__info.html">00293</a> <span class="keyword">struct </span><a class="code" href="structmgs__thread__info.html">mgs_thread_info</a> {
<a name="l00294"></a><a class="code" href="structmgs__thread__info.html#a220b5f693dbd4815d8db6a3456862366">00294</a>         <span class="keyword">struct </span><a class="code" href="structlustre__cfg__bufs.html">lustre_cfg_bufs</a>  <a class="code" href="structmgs__thread__info.html#a220b5f693dbd4815d8db6a3456862366">mgi_bufs</a>;
<a name="l00295"></a><a class="code" href="structmgs__thread__info.html#aab2589a36e1adef075f61d852ae61ffc">00295</a>         <span class="keywordtype">char</span>                    <a class="code" href="structmgs__thread__info.html#aab2589a36e1adef075f61d852ae61ffc">mgi_fsname</a>[<a class="code" href="group__lustreidl.html#gadc4a0cddc1bd5021f980dae0e5afe1a1">MTI_NAME_MAXLEN</a>];
<a name="l00296"></a><a class="code" href="structmgs__thread__info.html#a7a816d1e5919204d3d6426a580e7330a">00296</a>         <span class="keyword">struct </span><a class="code" href="structcfg__marker.html">cfg_marker</a>       <a class="code" href="structmgs__thread__info.html#a7a816d1e5919204d3d6426a580e7330a">mgi_marker</a>;
<a name="l00297"></a><a class="code" href="structmgs__thread__info.html#a6be8dccea33789e6ad1b3f8d454366b7">00297</a>         <span class="keyword">struct </span><a class="code" href="structtemp__comp.html">temp_comp</a>        <a class="code" href="structmgs__thread__info.html#a6be8dccea33789e6ad1b3f8d454366b7">mgi_comp</a>;
<a name="l00298"></a>00298 };
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__context__key.html" title="Key.">lu_context_key</a> <a class="code" href="mgs__internal_8h.html#aa6c73279894a584161b186e4e599ccb0">mgs_thread_key</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="mgs__internal_8h.html#a6885c23f00a4030e74a6d9246b8765c9">00302</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__thread__info.html">mgs_thread_info</a> *<a class="code" href="mgs__internal_8h.html#a6885c23f00a4030e74a6d9246b8765c9">mgs_env_info</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env)
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304         <span class="keyword">struct </span><a class="code" href="structmgs__thread__info.html">mgs_thread_info</a>  *info;
<a name="l00305"></a>00305         <span class="keywordtype">int</span>                     rc;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         info = <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;<a class="code" href="mgs__internal_8h.html#aa6c73279894a584161b186e4e599ccb0">mgs_thread_key</a>);
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (info == NULL) {
<a name="l00309"></a>00309                 rc = <a class="code" href="group__lu.html#ga3149440dd27a5c2618f6f940fae4c806">lu_env_refill</a>((<span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *)env);
<a name="l00310"></a>00310                 <span class="keywordflow">if</span> (rc != 0)
<a name="l00311"></a>00311                         <span class="keywordflow">return</span> ERR_PTR(rc);
<a name="l00312"></a>00312                 info = <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;<a class="code" href="mgs__internal_8h.html#aa6c73279894a584161b186e4e599ccb0">mgs_thread_key</a>);
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(info != NULL);
<a name="l00315"></a>00315         <span class="keywordflow">return</span> info;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__device__operations.html" title="Operations common for data and meta-data devices.">lu_device_operations</a> <a class="code" href="mgs__handler_8c.html#a3e80e13389d10ae68e09c47b9617236b">mgs_lu_ops</a>;
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">00320</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">lu_device_is_mgs</a>(<span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322         <span class="keywordflow">return</span> <a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(d != NULL &amp;&amp; d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> != NULL, d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> == &amp;<a class="code" href="mgs__handler_8c.html#a3e80e13389d10ae68e09c47b9617236b">mgs_lu_ops</a>);
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a><a class="code" href="mgs__internal_8h.html#a4ea581f7c334a8455e2728ba72901bba">00325</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__device.html">mgs_device</a>* <a class="code" href="mgs__internal_8h.html#a4ea581f7c334a8455e2728ba72901bba">lu2mgs_dev</a>(<span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">lu_device_is_mgs</a>(d));
<a name="l00328"></a>00328         <span class="keywordflow">return</span> container_of0(d, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a>, <a class="code" href="structmgs__device.html#ad1ee6cddc2a42f434653e0f16b71307f">mgs_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>);
<a name="l00329"></a>00329 }
<a name="l00330"></a>00330 
<a name="l00331"></a><a class="code" href="mgs__internal_8h.html#a5b5e08db67a4c5521a3c341b6fcf00e9">00331</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__device.html">mgs_device</a> *<a class="code" href="mgs__internal_8h.html#a5b5e08db67a4c5521a3c341b6fcf00e9">exp2mgs_dev</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp)
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333         <span class="keywordflow">return</span> <a class="code" href="mgs__internal_8h.html#a4ea581f7c334a8455e2728ba72901bba">lu2mgs_dev</a>(exp-&gt;<a class="code" href="structobd__export.html#ab0e9778c418ab982cb6befb298b38368" title="Obd device of this export.">exp_obd</a>-&gt;<a class="code" href="structobd__device.html#a79cc8c4fff7008c292c0ccdf10a2136b">obd_lu_dev</a>);
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a><a class="code" href="mgs__internal_8h.html#a679ae1ed7c4e4c97be50403ddb70ce47">00336</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *<a class="code" href="mgs__internal_8h.html#a679ae1ed7c4e4c97be50403ddb70ce47">mgs2lu_dev</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *d)
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338         <span class="keywordflow">return</span> (&amp;d-&gt;<a class="code" href="structmgs__device.html#ad1ee6cddc2a42f434653e0f16b71307f">mgs_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>);
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="mgs__internal_8h.html#a4b434a46831d5d49cdff4ca8d358775a">00341</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__device.html">mgs_device</a> *<a class="code" href="mgs__internal_8h.html#a4b434a46831d5d49cdff4ca8d358775a">dt2mgs_dev</a>(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">lu_device_is_mgs</a>(&amp;d-&gt;<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>));
<a name="l00344"></a>00344         <span class="keywordflow">return</span> container_of0(d, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a>, <a class="code" href="structmgs__device.html#ad1ee6cddc2a42f434653e0f16b71307f">mgs_dt_dev</a>);
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="mgs__internal_8h.html#a4bb5718d07d754fe87725bea616ce482">00347</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__object.html">mgs_object</a> *<a class="code" href="mgs__internal_8h.html#a4bb5718d07d754fe87725bea616ce482">lu2mgs_obj</a>(<span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *o)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(o != NULL, <a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">lu_device_is_mgs</a>(o-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>)));
<a name="l00350"></a>00350         <span class="keywordflow">return</span> container_of0(o, <span class="keyword">struct</span> <a class="code" href="structmgs__object.html">mgs_object</a>, <a class="code" href="structmgs__object.html#aec51b78f3f3d9b7e133bd38c0689b7f5">mgo_obj</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a><a class="code" href="mgs__internal_8h.html#ad877ed5674db7229c9c9266c2a265bf6">00353</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *<a class="code" href="mgs__internal_8h.html#ad877ed5674db7229c9c9266c2a265bf6">mgs2lu_obj</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__object.html">mgs_object</a> *obj)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355         <span class="keywordflow">return</span> &amp;obj-&gt;<a class="code" href="structmgs__object.html#aec51b78f3f3d9b7e133bd38c0689b7f5">mgo_obj</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="mgs__internal_8h.html#a8b17407272acb7505a03aacc2eaef0a4">00358</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__object.html">mgs_object</a> *<a class="code" href="mgs__internal_8h.html#a8b17407272acb7505a03aacc2eaef0a4">mgs_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *o)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="mgs__internal_8h.html#a8ddf7be26c84121f07da3f9117bf3b49">lu_device_is_mgs</a>(o-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>));
<a name="l00361"></a>00361         <span class="keywordflow">return</span> container_of0(o, <span class="keyword">struct</span> <a class="code" href="structmgs__object.html">mgs_object</a>, <a class="code" href="structmgs__object.html#aec51b78f3f3d9b7e133bd38c0689b7f5">mgo_obj</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="mgs__internal_8h.html#a087c5c55b5fac3038b40d361b539f089">00364</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__object.html">mgs_object</a> *<a class="code" href="mgs__internal_8h.html#a087c5c55b5fac3038b40d361b539f089">dt2mgs_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366         <span class="keywordflow">return</span> <a class="code" href="mgs__internal_8h.html#a8b17407272acb7505a03aacc2eaef0a4">mgs_obj</a>(&amp;d-&gt;<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a><a class="code" href="mgs__internal_8h.html#ac9abc5bae403f36738f0686a6caa5113">00369</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>* <a class="code" href="mgs__internal_8h.html#ac9abc5bae403f36738f0686a6caa5113">mgs_object_child</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__object.html">mgs_object</a> *o)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371         <span class="keywordflow">return</span> container_of0(<a class="code" href="group__lu.html#ga3e5cbde8881c8850b934b9c9af1d92ba" title="Next sub-object in the layering.">lu_object_next</a>(<a class="code" href="mgs__internal_8h.html#ad877ed5674db7229c9c9266c2a265bf6">mgs2lu_obj</a>(o)),
<a name="l00372"></a>00372                              <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a>, <a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a><a class="code" href="structmgs__direntry.html">00375</a> <span class="keyword">struct </span><a class="code" href="structmgs__direntry.html">mgs_direntry</a> {
<a name="l00376"></a><a class="code" href="structmgs__direntry.html#a73ec82111b349d4920bc0a14b0132e1d">00376</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structmgs__direntry.html#a73ec82111b349d4920bc0a14b0132e1d">mde_list</a>;
<a name="l00377"></a><a class="code" href="structmgs__direntry.html#a6223a256213c59e943a83f7d67a492b3">00377</a>         <span class="keywordtype">char</span>                    *<a class="code" href="structmgs__direntry.html#a6223a256213c59e943a83f7d67a492b3">mde_name</a>;
<a name="l00378"></a><a class="code" href="structmgs__direntry.html#aa8b3dda78628289a02ddcb7338db2bcb">00378</a>         <span class="keywordtype">int</span>                      <a class="code" href="structmgs__direntry.html#aa8b3dda78628289a02ddcb7338db2bcb">mde_len</a>;
<a name="l00379"></a>00379 };
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="mgs__internal_8h.html#a87b93e965a82acd770f14b113dde3838">00381</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="mgs__internal_8h.html#a87b93e965a82acd770f14b113dde3838">mgs_direntry_free</a>(<span class="keyword">struct</span> <a class="code" href="structmgs__direntry.html">mgs_direntry</a> *de)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;de-&gt;<a class="code" href="structmgs__direntry.html#a73ec82111b349d4920bc0a14b0132e1d">mde_list</a>));
<a name="l00384"></a>00384         <span class="keywordflow">if</span> (de) {
<a name="l00385"></a>00385                 <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(de-&gt;<a class="code" href="structmgs__direntry.html#aa8b3dda78628289a02ddcb7338db2bcb">mde_len</a>);
<a name="l00386"></a>00386                 <a class="code" href="obd__support_8h.html#a9bf49373d607ed467488261f133e5e49">OBD_FREE</a>(de-&gt;<a class="code" href="structmgs__direntry.html#a6223a256213c59e943a83f7d67a492b3">mde_name</a>, de-&gt;<a class="code" href="structmgs__direntry.html#aa8b3dda78628289a02ddcb7338db2bcb">mde_len</a>);
<a name="l00387"></a>00387                 <a class="code" href="obd__support_8h.html#a56214d823e92375ad47cd06a7daeae7a">OBD_FREE_PTR</a>(de);
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a><a class="code" href="mgs__internal_8h.html#a6c2e03be4a1b5575757377d578f6b409">00391</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmgs__direntry.html">mgs_direntry</a> *<a class="code" href="mgs__internal_8h.html#a6c2e03be4a1b5575757377d578f6b409">mgs_direntry_alloc</a>(<span class="keywordtype">int</span> len)
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393         <span class="keyword">struct </span><a class="code" href="structmgs__direntry.html">mgs_direntry</a> *de;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <a class="code" href="obd__support_8h.html#ab5ccc29ab0a6625457a863652381c45c">OBD_ALLOC_PTR</a>(de);
<a name="l00396"></a>00396         <span class="keywordflow">if</span> (de == NULL)
<a name="l00397"></a>00397                 <span class="keywordflow">return</span> NULL;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <a class="code" href="obd__support_8h.html#a884069f9eb0bef22c424688b5f3fafba">OBD_ALLOC</a>(de-&gt;<a class="code" href="structmgs__direntry.html#a6223a256213c59e943a83f7d67a492b3">mde_name</a>, len);
<a name="l00400"></a>00400         <span class="keywordflow">if</span> (de-&gt;<a class="code" href="structmgs__direntry.html#a6223a256213c59e943a83f7d67a492b3">mde_name</a> == NULL) {
<a name="l00401"></a>00401                 <a class="code" href="obd__support_8h.html#a56214d823e92375ad47cd06a7daeae7a">OBD_FREE_PTR</a>(de);
<a name="l00402"></a>00402                 <span class="keywordflow">return</span> NULL;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         de-&gt;<a class="code" href="structmgs__direntry.html#aa8b3dda78628289a02ddcb7338db2bcb">mde_len</a> = len;
<a name="l00406"></a>00406         <a class="code" href="list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;de-&gt;<a class="code" href="structmgs__direntry.html#a73ec82111b349d4920bc0a14b0132e1d">mde_list</a>);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="keywordflow">return</span> de;
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">/* mgs_llog.c */</span>
<a name="l00412"></a>00412 <span class="keywordtype">int</span> <a class="code" href="mgs__internal_8h.html#a18c5e0d8e0c6ee61af146dd2cf3d3822">class_dentry_readdir</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structmgs__device.html">mgs_device</a> *mgs,
<a name="l00413"></a>00413                          <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *<a class="code" href="lnetctl_8c.html#ac75dee5cf9c8f0128e744b7d95db6767">list</a>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="preprocessor">#endif </span><span class="comment">/* _MGS_INTERNAL_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:38 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
