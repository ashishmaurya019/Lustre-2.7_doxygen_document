<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ofd/ofd_fmd.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ofd/ofd_fmd.c File Reference</h1><code>#include &quot;<a class="el" href="ofd__internal_8h_source.html">ofd_internal.h</a>&quot;</code><br/>

<p><a href="ofd__fmd_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_FILTER</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a0b18cb162228b6e63db9b9a824bd7482">ofd_fmd_put_nolock</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *fmd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Drop FMD reference and free it if reference drops to zero.  <a href="#a0b18cb162228b6e63db9b9a824bd7482"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a2ff4c339286e71e27dcd8a1138556deb">ofd_fmd_put</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *fmd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wrapper to drop FMD reference with fed_lock held.  <a href="#a2ff4c339286e71e27dcd8a1138556deb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a7c3604ccb1133f4f5b3f6dc6a44a96f5">ofd_fmd_expire_nolock</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *keep)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Expire FMD entries.  <a href="#a7c3604ccb1133f4f5b3f6dc6a44a96f5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a514d9002b47398e274c36c1685ca84a1">ofd_fmd_expire</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Expire FMD entries.  <a href="#a514d9002b47398e274c36c1685ca84a1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a0f6ee7a2220c7bbf9bade1e81cfdaf21">ofd_fmd_find_nolock</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find FMD by specified FID.  <a href="#a0f6ee7a2220c7bbf9bade1e81cfdaf21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#a5c52afc72fe46f15f9fb90ccfda96964">ofd_fmd_find</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find FMD by specified FID with locking.  <a href="#a5c52afc72fe46f15f9fb90ccfda96964"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#aaadfc93c4fff5bf2333b92096bf45cfa">ofd_fmd_get</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find FMD by FID or create a new one if none is found.  <a href="#aaadfc93c4fff5bf2333b92096bf45cfa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#ae7b039d7de4e39805249623f35fed5cd">ofd_fmd_cleanup</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove all entries from FMD list.  <a href="#ae7b039d7de4e39805249623f35fed5cd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#ae6efbe1decaab7a5ad715491cc8112bd">ofd_fmd_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize FMD subsystem.  <a href="#ae6efbe1decaab7a5ad715491cc8112bd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#ab44b575625aab8199957673f650cdede">ofd_fmd_exit</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop FMD subsystem.  <a href="#ab44b575625aab8199957673f650cdede"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct kmem_cache *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fmd_8c.html#adfbfd777ac48c48e682a8d71c580cee1">ll_fmd_cachep</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="ofd_fmd.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_FILTER</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00049">49</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae7b039d7de4e39805249623f35fed5cd"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_cleanup" ref="ae7b039d7de4e39805249623f35fed5cd" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_fmd_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove all entries from FMD list. </p>
<p>Cleanup function to free all FMD enries on the given export.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00300">300</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00113">filter_export_data::fed_mod_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00060">ofd_mod_data::fmd_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00064">ofd_mod_data::fmd_refcount</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00063">ofd_fmd_put_nolock()</a>.</p>

<p>Referenced by <a class="el" href="ofd__obd_8c_source.html#l00492">ofd_destroy_export()</a>.</p>

</div>
</div>
<a class="anchor" id="ab44b575625aab8199957673f650cdede"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_exit" ref="ab44b575625aab8199957673f650cdede" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_fmd_exit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop FMD subsystem. </p>
<p>This function is called upon OFD cleanup and destroy memory used by FMD entries. </p>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00340">340</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="ofd__fmd_8c_source.html#l00053">ll_fmd_cachep</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l03148">ofd_exit()</a>.</p>

</div>
</div>
<a class="anchor" id="a514d9002b47398e274c36c1685ca84a1"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_expire" ref="a514d9002b47398e274c36c1685ca84a1" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_fmd_expire </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Expire FMD entries. </p>
<p>This is a wrapper to call <a class="el" href="ofd__fmd_8c.html#a7c3604ccb1133f4f5b3f6dc6a44a96f5" title="Expire FMD entries.">ofd_fmd_expire_nolock()</a> with the required lock.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00140">140</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00111">ofd_fmd_expire_nolock()</a>.</p>

<p>Referenced by <a class="el" href="ofd__obd_8c_source.html#l01396">ofd_ping()</a>.</p>

</div>
</div>
<a class="anchor" id="a7c3604ccb1133f4f5b3f6dc6a44a96f5"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_expire_nolock" ref="a7c3604ccb1133f4f5b3f6dc6a44a96f5" args="(struct obd_export *exp, struct ofd_mod_data *keep)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_fmd_expire_nolock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td>
          <td class="paramname"> <em>keep</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Expire FMD entries. </p>
<p>Expire entries from the FMD list if there are too many of them or they are too old.</p>
<p>This function must be called with fed_lock held.</p>
<p>The <em>keep</em> FMD is not to be expired in any case. This parameter is used by <a class="el" href="ofd__fmd_8c.html#a0f6ee7a2220c7bbf9bade1e81cfdaf21" title="Find FMD by specified FID.">ofd_fmd_find_nolock()</a> to prohibit a FMD that was just found from expiring.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>keep</em>&nbsp;</td><td>FMD to keep always </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00111">111</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00142">cfs_time_before()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="lustre__export_8h_source.html#l00118">filter_export_data::fed_mod_count</a>, <a class="el" href="lustre__export_8h_source.html#l00113">filter_export_data::fed_mod_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00063">ofd_mod_data::fmd_expire</a>, <a class="el" href="ofd__internal_8h_source.html#l00060">ofd_mod_data::fmd_list</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="createmany_8c_source.html#l00069">now()</a>, <a class="el" href="ofd__internal_8h_source.html#l00207">ofd_exp()</a>, <a class="el" href="ofd__internal_8h_source.html#l00171">ofd_device::ofd_fmd_max_num</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00063">ofd_fmd_put_nolock()</a>.</p>

<p>Referenced by <a class="el" href="ofd__fmd_8c_source.html#l00140">ofd_fmd_expire()</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00162">ofd_fmd_find_nolock()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c52afc72fe46f15f9fb90ccfda96964"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_find" ref="a5c52afc72fe46f15f9fb90ccfda96964" args="(struct obd_export *exp, const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a>* ofd_fmd_find </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find FMD by specified FID with locking. </p>
<p>Wrapper to the <a class="el" href="ofd__fmd_8c.html#a0f6ee7a2220c7bbf9bade1e81cfdaf21" title="Find FMD by specified FID.">ofd_fmd_find_nolock()</a> with correct locks.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of FMD to find</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>struct</em>&nbsp;</td><td><a class="el" href="structofd__mod__data.html">ofd_mod_data</a> found by FID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>indicates FMD is not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00199">199</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00064">ofd_mod_data::fmd_refcount</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00162">ofd_fmd_find_nolock()</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l01163">ofd_commitrw()</a>.</p>

</div>
</div>
<a class="anchor" id="a0f6ee7a2220c7bbf9bade1e81cfdaf21"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_find_nolock" ref="a0f6ee7a2220c7bbf9bade1e81cfdaf21" args="(struct obd_export *exp, const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a>* ofd_fmd_find_nolock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find FMD by specified FID. </p>
<p>Function finds FMD entry by FID in the filter_export_data::fed_fmd_list.</p>
<p>Caller must hold <a class="el" href="structfilter__export__data.html#a8ee477c927b9936bf89a6abfd62f7d46" title="protects fed_mod_list">filter_export_data::fed_lock</a> and take FMD reference.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of FMD to find</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>struct</em>&nbsp;</td><td><a class="el" href="structofd__mod__data.html">ofd_mod_data</a> found by FID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>is FMD is not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00162">162</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="libcfs__time_8h_source.html#l00046">cfs_time_add()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00113">filter_export_data::fed_mod_list</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00472">list_for_each_entry_reverse</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="createmany_8c_source.html#l00069">now()</a>, <a class="el" href="ofd__internal_8h_source.html#l00207">ofd_exp()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00111">ofd_fmd_expire_nolock()</a>, and <a class="el" href="ofd__internal_8h_source.html#l00172">ofd_device::ofd_fmd_max_age</a>.</p>

<p>Referenced by <a class="el" href="ofd__fmd_8c_source.html#l00199">ofd_fmd_find()</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00228">ofd_fmd_get()</a>.</p>

</div>
</div>
<a class="anchor" id="aaadfc93c4fff5bf2333b92096bf45cfa"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_get" ref="aaadfc93c4fff5bf2333b92096bf45cfa" args="(struct obd_export *exp, const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a>* ofd_fmd_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find FMD by FID or create a new one if none is found. </p>
<p>It is possible for this function to return NULL under memory pressure, or if the passed FID is zero (which will only cause old entries to expire). Currently this is not fatal because any FMD state is transient and may also be freed when it gets sufficiently old.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of FMD to find</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>struct</em>&nbsp;</td><td><a class="el" href="structofd__mod__data.html">ofd_mod_data</a> found by FID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>indicates FMD is not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00228">228</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="libcfs__time_8h_source.html#l00046">cfs_time_add()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00118">filter_export_data::fed_mod_count</a>, <a class="el" href="lustre__export_8h_source.html#l00113">filter_export_data::fed_mod_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00063">ofd_mod_data::fmd_expire</a>, <a class="el" href="ofd__internal_8h_source.html#l00064">ofd_mod_data::fmd_refcount</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00053">ll_fmd_cachep</a>, <a class="el" href="createmany_8c_source.html#l00069">now()</a>, <a class="el" href="obd__support_8h_source.html#l00845">OBD_SLAB_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00857">OBD_SLAB_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00207">ofd_exp()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00162">ofd_fmd_find_nolock()</a>, and <a class="el" href="ofd__internal_8h_source.html#l00172">ofd_device::ofd_fmd_max_age</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00491">ofd_attr_set()</a>, and <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>.</p>

</div>
</div>
<a class="anchor" id="ae6efbe1decaab7a5ad715491cc8112bd"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_init" ref="ae6efbe1decaab7a5ad715491cc8112bd" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_fmd_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize FMD subsystem. </p>
<p>This function is called upon OFD setup and initialize memory to be used by FMD entries. </p>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00323">323</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="ofd__fmd_8c_source.html#l00053">ll_fmd_cachep</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l03123">ofd_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a2ff4c339286e71e27dcd8a1138556deb"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_put" ref="a2ff4c339286e71e27dcd8a1138556deb" args="(struct obd_export *exp, struct ofd_mod_data *fmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_fmd_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fmd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wrapper to drop FMD reference with fed_lock held. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fmd</em>&nbsp;</td><td>FMD to put </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00084">84</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00063">ofd_fmd_put_nolock()</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00491">ofd_attr_set()</a>, <a class="el" href="ofd__io_8c_source.html#l01163">ofd_commitrw()</a>, and <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>.</p>

</div>
</div>
<a class="anchor" id="a0b18cb162228b6e63db9b9a824bd7482"></a><!-- doxytag: member="ofd_fmd.c::ofd_fmd_put_nolock" ref="a0b18cb162228b6e63db9b9a824bd7482" args="(struct obd_export *exp, struct ofd_mod_data *fmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_fmd_put_nolock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__mod__data.html">ofd_mod_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fmd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Drop FMD reference and free it if reference drops to zero. </p>
<p>Must be called with fed_lock held.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fmd</em>&nbsp;</td><td>FMD to put </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00063">63</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>References <a class="el" href="lustre__export_8h_source.html#l00109">filter_export_data::fed_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00118">filter_export_data::fed_mod_count</a>, <a class="el" href="ofd__internal_8h_source.html#l00060">ofd_mod_data::fmd_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00064">ofd_mod_data::fmd_refcount</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00053">ll_fmd_cachep</a>, and <a class="el" href="obd__support_8h_source.html#l00832">OBD_SLAB_FREE</a>.</p>

<p>Referenced by <a class="el" href="ofd__fmd_8c_source.html#l00300">ofd_fmd_cleanup()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00111">ofd_fmd_expire_nolock()</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00084">ofd_fmd_put()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="adfbfd777ac48c48e682a8d71c580cee1"></a><!-- doxytag: member="ofd_fmd.c::ll_fmd_cachep" ref="adfbfd777ac48c48e682a8d71c580cee1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct kmem_cache* <a class="el" href="ofd__fmd_8c.html#adfbfd777ac48c48e682a8d71c580cee1">ll_fmd_cachep</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ofd__fmd_8c_source.html#l00053">53</a> of file <a class="el" href="ofd__fmd_8c_source.html">ofd_fmd.c</a>.</p>

<p>Referenced by <a class="el" href="ofd__fmd_8c_source.html#l00340">ofd_fmd_exit()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00228">ofd_fmd_get()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00323">ofd_fmd_init()</a>, and <a class="el" href="ofd__fmd_8c_source.html#l00063">ofd_fmd_put_nolock()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:49 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
