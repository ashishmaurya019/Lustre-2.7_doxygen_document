<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/lod/lod_lov.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/lod/lod_lov.c File Reference</h1><code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__lfsck_8h_source.html">lustre_lfsck.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__lmv_8h_source.html">lustre_lmv.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__swab_8h_source.html">lustre_swab.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="lod__internal_8h_source.html">lod_internal.h</a>&quot;</code><br/>

<p><a href="lod__lov_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aa9ce4cf9ed012a300938f6c637618c01">lod_getref</a> (struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Increase reference count on the target table.  <a href="#aa9ce4cf9ed012a300938f6c637618c01"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ab3950998e92e7107b04fdb3866a20f6a">lod_putref</a> (struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decrease reference count on the target table.  <a href="#ab3950998e92e7107b04fdb3866a20f6a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a60f5de9c793a023d0ebc7ef220c2f60c">ltd_bitmap_resize</a> (struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd, __u32 newsize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Expand size of target table.  <a href="#a60f5de9c793a023d0ebc7ef220c2f60c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a0d4f74b368c7bc09cdb483f6b69665b2">lod_add_device</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, char *osp, unsigned index, unsigned gen, int tgt_index, char *type, int active)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connect LOD to a new OSP and add it to the target table.  <a href="#a0d4f74b368c7bc09cdb483f6b69665b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ab3c7aa77fa18860680f5f2c617acb0d2">__lod_del_device</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd, unsigned idx, bool for_ost)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Schedule target removal from the target table.  <a href="#ab3c7aa77fa18860680f5f2c617acb0d2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ab40a9a7f036ba2a86395fb48e58782e0">lod_fini_tgt</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd, bool for_ost)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Schedule removal of all the targets from the given target table.  <a href="#ab40a9a7f036ba2a86395fb48e58782e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aa568d1f98a1c3293cb72055df6efe3f8">lod_del_device</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd, char *osp, unsigned idx, unsigned gen, bool for_ost)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove device by name.  <a href="#aa568d1f98a1c3293cb72055df6efe3f8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aabaf0528074a96b37d8e0f07db269fce">lod_ea_store_resize</a> (struct <a class="el" href="structlod__thread__info.html">lod_thread_info</a> *info, size_t <a class="el" href="parallel__grouplock_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Resize per-thread storage to hold specified size.  <a href="#aabaf0528074a96b37d8e0f07db269fce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aab53ba7c59112e52755a86b43bb67b9f">lod_generate_and_set_lovea</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Make LOV EA for striped object.  <a href="#aab53ba7c59112e52755a86b43bb67b9f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ae87953a19c720b63ed8d7f8c6b8ac057">lod_get_ea</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get LOV EA.  <a href="#ae87953a19c720b63ed8d7f8c6b8ac057"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a5bdcfbf5ce13a199fa7b8462c304ca11">validate_lod_and_idx</a> (struct <a class="el" href="structlod__device.html">lod_device</a> *md, __u32 idx)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify the target index is present in the current configuration.  <a href="#a5bdcfbf5ce13a199fa7b8462c304ca11"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a7da910c1a72b37869fa1c8ea3c929cde">lod_initialize_objects</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo, struct <a class="el" href="structlov__ost__data__v1.html">lov_ost_data_v1</a> *objs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Instantiate objects for stripes.  <a href="#a7da910c1a72b37869fa1c8ea3c929cde"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a8feee293f7a8167d31ee47356e9a6026">lod_parse_striping</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo, const struct <a class="el" href="structlu__buf.html">lu_buf</a> *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Instantiate objects for striping.  <a href="#a8feee293f7a8167d31ee47356e9a6026"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aae9716d83d5fcb58fdf4bd301edcf8d5">lod_load_striping_locked</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the object representing the stripes.  <a href="#aae9716d83d5fcb58fdf4bd301edcf8d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#aeb3e638f8e7af103ed375a00d4ca0517">lod_load_striping</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__object.html">lod_object</a> *lo)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A generic function to initialize the stripe objects.  <a href="#aeb3e638f8e7af103ed375a00d4ca0517"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ad2fed6443561c5eb1930fe417b652190">lod_verify_striping</a> (struct <a class="el" href="structlod__device.html">lod_device</a> *d, const struct <a class="el" href="structlu__buf.html">lu_buf</a> *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, bool is_from_disk)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify striping.  <a href="#ad2fed6443561c5eb1930fe417b652190"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a3e918ac8530fb534d7fe7cf4d744a00c">lod_fix_desc_stripe_size</a> (<a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a5e02a5fd069a2f3af7ed486c0ae6a59a">lod_fix_desc_stripe_count</a> (__u32 *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a80c109143634c3b4e91d6b69ee9e7cf3">lod_fix_desc_pattern</a> (__u32 *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a2f99f720a942429c77344378e3d1a816">lod_fix_desc_qos_maxage</a> (__u32 *val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ad7086b5a80ae5841bb28c91ce9527061">lod_fix_desc</a> (struct <a class="el" href="structlov__desc.html">lov_desc</a> *desc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to fix insane default striping.  <a href="#ad7086b5a80ae5841bb28c91ce9527061"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#a9a41c8e8cb3c7e27d900b13bc63d668b">lod_pools_init</a> (struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the structures used to store pools and default striping.  <a href="#a9a41c8e8cb3c7e27d900b13bc63d668b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__lov_8c.html#ae715a634b2d198e7ff304497c987f9a3">lod_pools_fini</a> (struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release the structures describing the pools.  <a href="#ae715a634b2d198e7ff304497c987f9a3"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="lod_lov.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00037">37</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab3c7aa77fa18860680f5f2c617acb0d2"></a><!-- doxytag: member="lod_lov.c::__lod_del_device" ref="ab3c7aa77fa18860680f5f2c617acb0d2" args="(const struct lu_env *env, struct lod_device *lod, struct lod_tgt_descs *ltd, unsigned idx, bool for_ost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __lod_del_device </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>for_ost</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Schedule target removal from the target table. </p>
<p>Mark the device as dead. The device is not removed here because it may still be in use. The device will be removed in <a class="el" href="lod__internal_8h.html#ab3950998e92e7107b04fdb3866a20f6a" title="Decrease reference count on the target table.">lod_putref()</a> when the last reference is released.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device the target table belongs to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>index of the target </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>for_ost</em>&nbsp;</td><td>type of the target: 0 - MDT, 1 - OST </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00456">456</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__lib_8c_source.html#l03710">lfsck_del_target()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00158">lod_tgt_descs::ltd_death_row</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00529">lod_del_device()</a>, and <a class="el" href="lod__lov_8c_source.html#l00490">lod_fini_tgt()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d4f74b368c7bc09cdb483f6b69665b2"></a><!-- doxytag: member="lod_lov.c::lod_add_device" ref="a0d4f74b368c7bc09cdb483f6b69665b2" args="(const struct lu_env *env, struct lod_device *lod, char *osp, unsigned index, unsigned gen, int tgt_index, char *type, int active)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_add_device </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>gen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>tgt_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>active</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connect LOD to a new OSP and add it to the target table. </p>
<p>Connect to the OSP device passed, initialize all the internal structures related to the device and add it to the target table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device to be connected to the new OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>name of OSP device name to be added </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>index of the new target </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gen</em>&nbsp;</td><td>target's generation number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tgt_index</em>&nbsp;</td><td>OSP's group </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>type of device (mdc or osc) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>active</em>&nbsp;</td><td>state of OSP: 0 - inactive, 1 - active</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if added successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00207">207</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00087">cfs_bitmap_check()</a>, <a class="el" href="bitmap_8h_source.html#l00081">cfs_bitmap_clear()</a>, <a class="el" href="bitmap_8h_source.html#l00075">cfs_bitmap_set()</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00161">client_obd::cl_target_uuid</a>, <a class="el" href="genops_8c_source.html#l00547">class_find_client_obd()</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="lustre__net_8h_source.html#l00531">ptlrpc_client::cli_request_portal</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__import_8h_source.html#l00172">obd_import::imp_client</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_server_timeout</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__cfg_8h_source.html#l00075">LCFG_CLEANUP</a>, <a class="el" href="lustre__cfg_8h_source.html#l00130">lustre_cfg::lcfg_command</a>, <a class="el" href="lustre__cfg_8h_source.html#l00129">lustre_cfg::lcfg_version</a>, <a class="el" href="lustre__idl_8h_source.html#l02748">lov_desc::ld_active_tgt_count</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lustre__idl_8h_source.html#l02747">lov_desc::ld_tgt_count</a>, <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae">lu_device_operations::ldo_process_config</a>, <a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">lu_device_operations::ldo_recovery_complete</a>, <a class="el" href="lfsck__lib_8c_source.html#l03661">lfsck_add_target()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00181">lod_device::lod_desc</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_initialized</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__pool_8c_source.html#l00537">lod_ost_pool_add()</a>, <a class="el" href="lod__pool_8c_source.html#l00577">lod_ost_pool_remove()</a>, <a class="el" href="lod__internal_8h_source.html#l00204">lod_device::lod_pool_info</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_recovery_completed</a>, <a class="el" href="lod__dev_8c_source.html#l00482">lod_sub_fini_llog()</a>, <a class="el" href="lod__dev_8c_source.html#l00578">lod_sub_init_llog()</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_active</a>, <a class="el" href="lod__lov_8c_source.html#l00149">ltd_bitmap_resize()</a>, <a class="el" href="lod__internal_8h_source.html#l00121">lod_tgt_desc::ltd_exp</a>, <a class="el" href="lod__internal_8h_source.html#l00123">lod_tgt_desc::ltd_gen</a>, <a class="el" href="lod__internal_8h_source.html#l00124">lod_tgt_desc::ltd_index</a>, <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00127">lod_tgt_desc::ltd_recovery_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lod__internal_8h_source.html#l00150">lod_tgt_descs::ltd_tgt_idx</a>, <a class="el" href="lod__internal_8h_source.html#l00154">lod_tgt_descs::ltd_tgtnr</a>, <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>, <a class="el" href="lod__internal_8h_source.html#l00122">lod_tgt_desc::ltd_uuid</a>, <a class="el" href="lod__internal_8h_source.html#l00310">lod_thread_info::lti_lustre_cfg</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00059">LUSTRE_CFG_VERSION</a>, <a class="el" href="obd_8h_source.html#l00463">LUSTRE_OSC_NAME</a>, <a class="el" href="obd_8h_source.html#l00453">LUSTRE_OSP_NAME</a>, <a class="el" href="lustre__ver_8h_source.html#l00023">LUSTRE_VERSION_CODE</a>, <a class="el" href="lnet_2utils_2debug_8c_source.html#l00068">max</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__class_8h_source.html#l00796">obd_connect()</a>, <a class="el" href="lustre__idl_8h_source.html#l01186">OBD_CONNECT_ACL</a>, <a class="el" href="lustre__idl_8h_source.html#l01207">OBD_CONNECT_AT</a>, <a class="el" href="lustre__idl_8h_source.html#l01250">OBD_CONNECT_BULK_MBITS</a>, <a class="el" href="lustre__idl_8h_source.html#l01213">OBD_CONNECT_FID</a>, <a class="el" href="lustre__idl_8h_source.html#l01219">OBD_CONNECT_FULL20</a>, <a class="el" href="lustre__idl_8h_source.html#l01191">OBD_CONNECT_IBITS</a>, <a class="el" href="lustre__idl_8h_source.html#l01180">OBD_CONNECT_INDEX</a>, <a class="el" href="lustre__idl_8h_source.html#l01242">OBD_CONNECT_LFSCK</a>, <a class="el" href="lustre__idl_8h_source.html#l01208">OBD_CONNECT_LRU_RESIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l01233">OBD_CONNECT_LVB_TYPE</a>, <a class="el" href="lustre__idl_8h_source.html#l01181">OBD_CONNECT_MDS</a>, <a class="el" href="lustre__idl_8h_source.html#l01209">OBD_CONNECT_MDS_MDS</a>, <a class="el" href="lustre__idl_8h_source.html#l01237">OBD_CONNECT_PINGLESS</a>, <a class="el" href="lustre__idl_8h_source.html#l01185">OBD_CONNECT_REQPORTAL</a>, <a class="el" href="lustre__idl_8h_source.html#l01217">OBD_CONNECT_SKIP_ORPHAN</a>, <a class="el" href="lustre__idl_8h_source.html#l01184">OBD_CONNECT_VERSION</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00506">obd_str2uuid()</a>, <a class="el" href="obd_8h_source.html#l00598">obd_device::obd_uuid</a>, <a class="el" href="lustre__idl_8h_source.html#l01336">obd_connect_data::ocd_connect_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01347">obd_connect_data::ocd_group</a>, <a class="el" href="lustre__idl_8h_source.html#l01341">obd_connect_data::ocd_ibits_known</a>, <a class="el" href="lustre__idl_8h_source.html#l01339">obd_connect_data::ocd_index</a>, <a class="el" href="lustre__idl_8h_source.html#l01337">obd_connect_data::ocd_version</a>, <a class="el" href="lustre__idl_8h_source.html#l00114">OUT_PORTAL</a>, <a class="el" href="lod__qos_8c_source.html#l00074">qos_add_tgt()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00444">TGT_PTRS_PER_BLOCK</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="aa568d1f98a1c3293cb72055df6efe3f8"></a><!-- doxytag: member="lod_lov.c::lod_del_device" ref="aa568d1f98a1c3293cb72055df6efe3f8" args="(const struct lu_env *env, struct lod_device *lod, struct lod_tgt_descs *ltd, char *osp, unsigned idx, unsigned gen, bool for_ost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_del_device </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>gen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>for_ost</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove device by name. </p>
<p>Remove a device identified by <em>osp</em> from the target table. Given the device can be in use, the real deletion happens in <a class="el" href="lod__internal_8h.html#ab3950998e92e7107b04fdb3866a20f6a" title="Decrease reference count on the target table.">lod_putref()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device to be connected to the new OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>name of OSP device to be removed </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>index of the target </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gen</em>&nbsp;</td><td>generation number, not used currently </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>for_ost</em>&nbsp;</td><td>type of the target: 0 - MDT, 1 - OST</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the device was scheduled for removal </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if no device was found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00529">529</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lod__lov_8c_source.html#l00456">__lod_del_device()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00087">cfs_bitmap_check()</a>, <a class="el" href="genops_8c_source.html#l00547">class_find_client_obd()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="obd_8h_source.html#l00453">LUSTRE_OSP_NAME</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00506">obd_str2uuid()</a>, <a class="el" href="obd_8h_source.html#l00598">obd_device::obd_uuid</a>, <a class="el" href="lustre__user_8h_source.html#l00513">obd_uuid2str()</a>, <a class="el" href="lustre__user_8h_source.html#l00495">obd_uuid_equals()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="aabaf0528074a96b37d8e0f07db269fce"></a><!-- doxytag: member="lod_lov.c::lod_ea_store_resize" ref="aabaf0528074a96b37d8e0f07db269fce" args="(struct lod_thread_info *info, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_ea_store_resize </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__thread__info.html">lod_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Resize per-thread storage to hold specified size. </p>
<p>A helper function to resize per-thread temporary storage. This storage is used to process LOV/LVM EAs and may be quite large. We do not want to allocate/release it every time, so instead we put it into the env and reallocate on demand. The memory is released when the correspondent thread is finished.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>LOD-specific storage in the environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>size</em>&nbsp;</td><td>new size to grow the buffer to</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success, -ENOMEM if reallocation failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00596">596</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l01471">LOV_MAGIC_V3</a>, <a class="el" href="lustre__user_8h_source.html#l00369">LOV_MAX_STRIPE_COUNT</a>, <a class="el" href="lustre__idl_8h_source.html#l01621">lov_mds_md_size()</a>, <a class="el" href="lod__internal_8h_source.html#l00292">lod_thread_info::lti_ea_store</a>, <a class="el" href="lod__internal_8h_source.html#l00293">lod_thread_info::lti_ea_store_size</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__sec_8h_source.html#l00941">size_roundup_power2()</a>.</p>

<p>Referenced by <a class="el" href="lod__object_8c_source.html#l02531">lod_dir_striping_create_internal()</a>, <a class="el" href="lod__lov_8c_source.html#l00636">lod_generate_and_set_lovea()</a>, <a class="el" href="lod__lov_8c_source.html#l00748">lod_get_ea()</a>, <a class="el" href="lod__object_8c_source.html#l01987">lod_object_replace_parent_fid()</a>, <a class="el" href="lod__object_8c_source.html#l01406">lod_prep_lmv_md()</a>, and <a class="el" href="lod__qos_8c_source.html#l00780">lod_qos_ost_in_use_clear()</a>.</p>

</div>
</div>
<a class="anchor" id="ab40a9a7f036ba2a86395fb48e58782e0"></a><!-- doxytag: member="lod_lov.c::lod_fini_tgt" ref="ab40a9a7f036ba2a86395fb48e58782e0" args="(const struct lu_env *env, struct lod_device *lod, struct lod_tgt_descs *ltd, bool for_ost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_fini_tgt </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>for_ost</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Schedule removal of all the targets from the given target table. </p>
<p>See more details in the description for <a class="el" href="lod__lov_8c.html#ab3c7aa77fa18860680f5f2c617acb0d2" title="Schedule target removal from the target table.">__lod_del_device()</a></p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device the target table belongs to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>for_ost</em>&nbsp;</td><td>type of the target: MDT or OST</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>always </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00490">490</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lod__lov_8c_source.html#l00456">__lod_del_device()</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="bitmap_8h_source.html#l00072">CFS_FREE_BITMAP</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lod__internal_8h_source.html#l00150">lod_tgt_descs::ltd_tgt_idx</a>, <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00443">TGT_PTRS</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01638">lod_device_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="ad7086b5a80ae5841bb28c91ce9527061"></a><!-- doxytag: member="lod_lov.c::lod_fix_desc" ref="ad7086b5a80ae5841bb28c91ce9527061" args="(struct lov_desc *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_fix_desc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlov__desc.html">lov_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>desc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used to fix insane default striping. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>desc</em>&nbsp;</td><td>striping description </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01263">1263</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l02749">lov_desc::ld_default_stripe_count</a>, <a class="el" href="lustre__idl_8h_source.html#l02751">lov_desc::ld_default_stripe_size</a>, <a class="el" href="lustre__idl_8h_source.html#l02750">lov_desc::ld_pattern</a>, <a class="el" href="lustre__idl_8h_source.html#l02754">lov_desc::ld_qos_maxage</a>, <a class="el" href="lod__lov_8c_source.html#l01242">lod_fix_desc_pattern()</a>, <a class="el" href="lod__lov_8c_source.html#l01251">lod_fix_desc_qos_maxage()</a>, <a class="el" href="lod__lov_8c_source.html#l01236">lod_fix_desc_stripe_count()</a>, and <a class="el" href="lod__lov_8c_source.html#l01220">lod_fix_desc_stripe_size()</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l01280">lod_pools_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a80c109143634c3b4e91d6b69ee9e7cf3"></a><!-- doxytag: member="lod_lov.c::lod_fix_desc_pattern" ref="a80c109143634c3b4e91d6b69ee9e7cf3" args="(__u32 *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_fix_desc_pattern </td>
          <td>(</td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01242">1242</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, and <a class="el" href="lustre__user_8h_source.html#l00345">LOV_PATTERN_RAID0</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l01263">lod_fix_desc()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f99f720a942429c77344378e3d1a816"></a><!-- doxytag: member="lod_lov.c::lod_fix_desc_qos_maxage" ref="a2f99f720a942429c77344378e3d1a816" args="(__u32 *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_fix_desc_qos_maxage </td>
          <td>(</td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01251">1251</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l02742">LOV_DESC_QOS_MAXAGE_DEFAULT</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l01263">lod_fix_desc()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e02a5fd069a2f3af7ed486c0ae6a59a"></a><!-- doxytag: member="lod_lov.c::lod_fix_desc_stripe_count" ref="a5e02a5fd069a2f3af7ed486c0ae6a59a" args="(__u32 *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_fix_desc_stripe_count </td>
          <td>(</td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01236">1236</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l01263">lod_fix_desc()</a>.</p>

</div>
</div>
<a class="anchor" id="a3e918ac8530fb534d7fe7cf4d744a00c"></a><!-- doxytag: member="lod_lov.c::lod_fix_desc_stripe_size" ref="a3e918ac8530fb534d7fe7cf4d744a00c" args="(__u64 *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_fix_desc_stripe_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01220">1220</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00283">LCONSOLE_INFO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="lustre__idl_8h_source.html#l02743">LOV_DESC_STRIPE_SIZE_DEFAULT</a>, <a class="el" href="lustre__user_8h_source.html#l00358">LOV_MIN_STRIPE_SIZE</a>, and <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l01263">lod_fix_desc()</a>.</p>

</div>
</div>
<a class="anchor" id="aab53ba7c59112e52755a86b43bb67b9f"></a><!-- doxytag: member="lod_lov.c::lod_generate_and_set_lovea" ref="aab53ba7c59112e52755a86b43bb67b9f" args="(const struct lu_env *env, struct lod_object *lo, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_generate_and_set_lovea </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Make LOV EA for striped object. </p>
<p>Generate striping information and store it in the LOV EA of the given object. The caller must ensure nobody else is calling the function against the object concurrently. The transaction must be started. FLDB service must be running as well; it's used to map FID to the target, which is stored in LOV EA.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if LOV EA is stored successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00636">636</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="byteorder_8h_source.html#l00055">cpu_to_le16</a>, <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01806">dt_object_child()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__idl_8h_source.html#l01538">fid_to_lmm_oi()</a>, <a class="el" href="lustre__idl_8h_source.html#l00706">fid_to_ostid()</a>, <a class="el" href="lustre__idl_8h_source.html#l01498">lov_ost_data_v1::l_ost_gen</a>, <a class="el" href="lustre__idl_8h_source.html#l01499">lov_ost_data_v1::l_ost_idx</a>, <a class="el" href="lustre__idl_8h_source.html#l01497">lov_ost_data_v1::l_ost_oi</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, <a class="el" href="lod__internal_8h_source.html#l00253">lod_object::ldo_pattern</a>, <a class="el" href="lod__internal_8h_source.html#l00255">lod_object::ldo_pool</a>, <a class="el" href="lod__internal_8h_source.html#l00254">lod_object::ldo_released_stripenr</a>, <a class="el" href="lod__internal_8h_source.html#l00256">lod_object::ldo_stripe</a>, <a class="el" href="lod__internal_8h_source.html#l00252">lod_object::ldo_stripe_size</a>, <a class="el" href="lod__internal_8h_source.html#l00250">lod_object::ldo_stripenr</a>, <a class="el" href="lustre__idl_8h_source.html#l01510">lov_mds_md_v1::lmm_layout_gen</a>, <a class="el" href="lustre__idl_8h_source.html#l01504">lov_mds_md_v1::lmm_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l01618">lov_mds_md_v3::lmm_objects</a>, <a class="el" href="lustre__idl_8h_source.html#l01511">lov_mds_md_v1::lmm_objects</a>, <a class="el" href="lustre__idl_8h_source.html#l01506">lov_mds_md_v1::lmm_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l01572">lmm_oi_cpu_to_le()</a>, <a class="el" href="lustre__idl_8h_source.html#l01505">lov_mds_md_v1::lmm_pattern</a>, <a class="el" href="lustre__idl_8h_source.html#l01617">lov_mds_md_v3::lmm_pool_name</a>, <a class="el" href="lustre__idl_8h_source.html#l01509">lov_mds_md_v1::lmm_stripe_count</a>, <a class="el" href="lustre__idl_8h_source.html#l01507">lov_mds_md_v1::lmm_stripe_size</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__lov_8c_source.html#l00596">lod_ea_store_resize()</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__dev_8c_source.html#l00121">lod_fld_lookup()</a>, <a class="el" href="lod__object_8c_source.html#l04168">lod_object_free_striping()</a>, <a class="el" href="lod__sub__object_8c_source.html#l00602">lod_sub_object_xattr_set()</a>, <a class="el" href="packet-lustre_8c_source.html#l00085">LOV_MAGIC_V1</a>, <a class="el" href="lustre__idl_8h_source.html#l01471">LOV_MAGIC_V3</a>, <a class="el" href="lustre__idl_8h_source.html#l01621">lov_mds_md_size()</a>, <a class="el" href="lustre__user_8h_source.html#l00352">LOV_PATTERN_F_RELEASED</a>, <a class="el" href="lustre__user_8h_source.html#l00345">LOV_PATTERN_RAID0</a>, <a class="el" href="lod__internal_8h_source.html#l00295">lod_thread_info::lti_buf</a>, <a class="el" href="lod__internal_8h_source.html#l00292">lod_thread_info::lti_ea_store</a>, <a class="el" href="lod__internal_8h_source.html#l00293">lod_thread_info::lti_ea_store_size</a>, <a class="el" href="lod__internal_8h_source.html#l00297">lod_thread_info::lti_fid</a>, <a class="el" href="lod__internal_8h_source.html#l00296">lod_thread_info::lti_ostid</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00167">LU_SEQ_RANGE_OST</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00536">OBD_FAIL_LFSCK_BAD_LMMOI</a>, <a class="el" href="obd__support_8h_source.html#l00541">OBD_FAIL_LFSCK_MULTIPLE_REF</a>, <a class="el" href="obd__support_8h_source.html#l00251">OBD_FAIL_MDS_FLD_LOOKUP</a>, <a class="el" href="structost__id.html#a01d44bff8859d8cd3aabe8a4b0c2ee46">ost_id::oi</a>, <a class="el" href="lustre__idl_8h_source.html#l00823">ostid_cpu_to_le()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="string_8c_source.html#l00058">strlcpy()</a>, and <a class="el" href="lustre__idl_8h_source.html#l01594">XATTR_NAME_LOV</a>.</p>

<p>Referenced by <a class="el" href="lod__object_8c_source.html#l03530">lod_striping_create()</a>.</p>

</div>
</div>
<a class="anchor" id="ae87953a19c720b63ed8d7f8c6b8ac057"></a><!-- doxytag: member="lod_lov.c::lod_get_ea" ref="ae87953a19c720b63ed8d7f8c6b8ac057" args="(const struct lu_env *env, struct lod_object *lo, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_get_ea </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get LOV EA. </p>
<p>Fill lti_ea_store buffer in the environment with a value for the given EA. The buffer is reallocated if the value doesn't fit.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread .lti_ea_store buffer is filled with EA's value </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>name of the EA</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if EA is fetched successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00748">748</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01806">dt_object_child()</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, <a class="el" href="lod__lov_8c_source.html#l00596">lod_ea_store_resize()</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__internal_8h_source.html#l00295">lod_thread_info::lti_buf</a>, <a class="el" href="lod__internal_8h_source.html#l00292">lod_thread_info::lti_ea_store</a>, <a class="el" href="lod__internal_8h_source.html#l00293">lod_thread_info::lti_ea_store_size</a>, <a class="el" href="lu__object_8c_source.html#l02333">LU_BUF_NULL</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lod__internal_8h_source.html#l00437">lod_get_default_lmv_ea()</a>, <a class="el" href="lod__internal_8h_source.html#l00431">lod_get_lmv_ea()</a>, and <a class="el" href="lod__internal_8h_source.html#l00425">lod_get_lov_ea()</a>.</p>

</div>
</div>
<a class="anchor" id="aa9ce4cf9ed012a300938f6c637618c01"></a><!-- doxytag: member="lod_lov.c::lod_getref" ref="aa9ce4cf9ed012a300938f6c637618c01" args="(struct lod_tgt_descs *ltd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_getref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Increase reference count on the target table. </p>
<p>Increase reference count on the target table usage to prevent racing with addition/deletion. Any function that expects the table to remain stationary must take a ref.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table (lod_ost_descs or lod_mdt_descs) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00055">55</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00160">lod_tgt_descs::ltd_refcount</a>, and <a class="el" href="lod__internal_8h_source.html#l00164">lod_tgt_descs::ltd_rw_sem</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__lov_8c_source.html#l00529">lod_del_device()</a>, <a class="el" href="lod__lov_8c_source.html#l00490">lod_fini_tgt()</a>, <a class="el" href="lod__lov_8c_source.html#l00839">lod_initialize_objects()</a>, <a class="el" href="lod__dev_8c_source.html#l01811">lod_obd_get_info()</a>, <a class="el" href="lod__dev_8c_source.html#l01876">lod_obd_set_info_async()</a>, <a class="el" href="lod__object_8c_source.html#l04095">lod_object_init()</a>, <a class="el" href="lod__pool_8c_source.html#l00766">lod_pool_add()</a>, <a class="el" href="lod__pool_8c_source.html#l00823">lod_pool_remove()</a>, <a class="el" href="lod__qos_8c_source.html#l01848">lod_qos_prep_create()</a>, <a class="el" href="lod__dev_8c_source.html#l01029">lod_recovery_complete()</a>, <a class="el" href="lod__dev_8c_source.html#l00720">lod_sub_fini_all_llogs()</a>, <a class="el" href="lod__dev_8c_source.html#l00239">lod_sub_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00676">lod_sub_stop_recovery_threads()</a>, and <a class="el" href="lod__dev_8c_source.html#l01323">lod_sync()</a>.</p>

</div>
</div>
<a class="anchor" id="a7da910c1a72b37869fa1c8ea3c929cde"></a><!-- doxytag: member="lod_lov.c::lod_initialize_objects" ref="a7da910c1a72b37869fa1c8ea3c929cde" args="(const struct lu_env *env, struct lod_object *lo, struct lov_ost_data_v1 *objs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_initialize_objects </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlov__ost__data__v1.html">lov_ost_data_v1</a> *&nbsp;</td>
          <td class="paramname"> <em>objs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Instantiate objects for stripes. </p>
<p>Allocate and initialize LU-objects representing the stripes. The number of the stripes (ldo_stripenr) must be initialized already. The caller must ensure nobody else is calling the function on the object at the same time. FLDB service must be running to be able to map a FID to the targets and find appropriate device representing that target.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objs</em>&nbsp;</td><td>an array of IDs to creates the objects from</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the objects are instantiated successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00839">839</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lu__object_8h_source.html#l00275">lu_device::ld_type</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, <a class="el" href="lod__internal_8h_source.html#l00256">lod_object::ldo_stripe</a>, <a class="el" href="lod__internal_8h_source.html#l00252">lod_object::ldo_stripe_size</a>, <a class="el" href="lod__internal_8h_source.html#l00250">lod_object::ldo_stripenr</a>, <a class="el" href="lod__internal_8h_source.html#l00260">lod_object::ldo_stripes_allocated</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lu__object_8h_source.html#l00468">lu_object::lo_header</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lustre__idl_8h_source.html#l03644">lovea_slot_is_dummy()</a>, <a class="el" href="lod__internal_8h_source.html#l00297">lod_thread_info::lti_fid</a>, <a class="el" href="lod__internal_8h_source.html#l00296">lod_thread_info::lti_ostid</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lu__object_8c_source.html#l00778">lu_object_find_at()</a>, <a class="el" href="lu__object_8c_source.html#l01329">lu_object_locate()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, <a class="el" href="lustre__idl_8h_source.html#l00834">ostid_le_to_cpu()</a>, <a class="el" href="lustre__idl_8h_source.html#l00659">ostid_to_fid()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lod__lov_8c_source.html#l00799">validate_lod_and_idx()</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00927">lod_parse_striping()</a>, and <a class="el" href="lod__qos_8c_source.html#l01636">lod_use_defined_striping()</a>.</p>

</div>
</div>
<a class="anchor" id="aeb3e638f8e7af103ed375a00d4ca0517"></a><!-- doxytag: member="lod_lov.c::lod_load_striping" ref="aeb3e638f8e7af103ed375a00d4ca0517" args="(const struct lu_env *env, struct lod_object *lo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_load_striping </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A generic function to initialize the stripe objects. </p>
<p>A protected version of <a class="el" href="lod__internal_8h.html#aae9716d83d5fcb58fdf4bd301edcf8d5" title="Initialize the object representing the stripes.">lod_load_striping_locked()</a> - load the striping information from storage, parse that and instantiate LU objects to represent the stripes. The LOD object <em>lo</em> supplies a pointer to the next sub-object in the LU stack so we can lock it. Also use <em>lo</em> to return an array of references to the newly instantiated objects.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object, where striping is stored and which gets an array of references</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if parsing and object creation succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01067">1067</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01806">dt_object_child()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, and <a class="el" href="lod__lov_8c_source.html#l00988">lod_load_striping_locked()</a>.</p>

<p>Referenced by <a class="el" href="lod__object_8c_source.html#l03075">lod_ah_init()</a>, <a class="el" href="lod__object_8c_source.html#l01075">lod_declare_attr_set()</a>, <a class="el" href="lod__object_8c_source.html#l03600">lod_declare_object_destroy()</a>, <a class="el" href="lod__object_8c_source.html#l02769">lod_declare_xattr_del()</a>, <a class="el" href="lod__object_8c_source.html#l01918">lod_dir_declare_xattr_set()</a>, <a class="el" href="lod__object_8c_source.html#l03889">lod_object_lock()</a>, and <a class="el" href="lod__object_8c_source.html#l01987">lod_object_replace_parent_fid()</a>.</p>

</div>
</div>
<a class="anchor" id="aae9716d83d5fcb58fdf4bd301edcf8d5"></a><!-- doxytag: member="lod_lov.c::lod_load_striping_locked" ref="aae9716d83d5fcb58fdf4bd301edcf8d5" args="(const struct lu_env *env, struct lod_object *lo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_load_striping_locked </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the object representing the stripes. </p>
<p>Unless the stripes are initialized already, fetch LOV (for regular objects) or LMV (for directory objects) EA and call <a class="el" href="lod__internal_8h.html#a299907b294d1ac30fd0658e804d31b5b" title="Instantiate objects for striping.">lod_parse_striping()</a> to instantiate the objects representing the stripes.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if parsing and object creation succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00988">988</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="dt__object_8h_source.html#l01806">dt_object_child()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lod__internal_8h_source.html#l00260">lod_object::ldo_dir_slave_stripe</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, <a class="el" href="lod__internal_8h_source.html#l00256">lod_object::ldo_stripe</a>, <a class="el" href="lod__internal_8h_source.html#l00260">lod_object::ldo_striping_cached</a>, <a class="el" href="lod__internal_8h_source.html#l00348">lod2lu_obj()</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__internal_8h_source.html#l00431">lod_get_lmv_ea()</a>, <a class="el" href="lod__internal_8h_source.html#l00425">lod_get_lov_ea()</a>, <a class="el" href="lod__object_8c_source.html#l00776">lod_load_lmv_shards()</a>, <a class="el" href="lod__object_8c_source.html#l01462">lod_parse_dir_striping()</a>, <a class="el" href="lod__lov_8c_source.html#l00927">lod_parse_striping()</a>, <a class="el" href="lod__internal_8h_source.html#l00295">lod_thread_info::lti_buf</a>, <a class="el" href="lod__internal_8h_source.html#l00292">lod_thread_info::lti_ea_store</a>, <a class="el" href="lod__internal_8h_source.html#l00293">lod_thread_info::lti_ea_store_size</a>, <a class="el" href="lu__object_8h_source.html#l00860">lu_object_attr()</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__object_8c_source.html#l00954">lod_index_try()</a>, and <a class="el" href="lod__lov_8c_source.html#l01067">lod_load_striping()</a>.</p>

</div>
</div>
<a class="anchor" id="a8feee293f7a8167d31ee47356e9a6026"></a><!-- doxytag: member="lod_lov.c::lod_parse_striping" ref="a8feee293f7a8167d31ee47356e9a6026" args="(const struct lu_env *env, struct lod_object *lo, const struct lu_buf *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_parse_striping </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__object.html">lod_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__buf.html">lu_buf</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Instantiate objects for striping. </p>
<p>Parse striping information in <em>buf</em> and instantiate the objects representing the stripes.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment for this thread </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lo</em>&nbsp;</td><td>LOD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer storing LOV EA to parse</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if parsing and objects creation succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00927">927</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lod__internal_8h_source.html#l00251">lod_object::ldo_layout_gen</a>, <a class="el" href="lod__internal_8h_source.html#l00253">lod_object::ldo_pattern</a>, <a class="el" href="lod__internal_8h_source.html#l00252">lod_object::ldo_stripe_size</a>, <a class="el" href="lod__internal_8h_source.html#l00250">lod_object::ldo_stripenr</a>, <a class="el" href="byteorder_8h_source.html#l00054">le16_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__idl_8h_source.html#l01510">lov_mds_md_v1::lmm_layout_gen</a>, <a class="el" href="lustre__idl_8h_source.html#l01504">lov_mds_md_v1::lmm_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l01511">lov_mds_md_v1::lmm_objects</a>, <a class="el" href="lustre__idl_8h_source.html#l01618">lov_mds_md_v3::lmm_objects</a>, <a class="el" href="lustre__idl_8h_source.html#l01505">lov_mds_md_v1::lmm_pattern</a>, <a class="el" href="lustre__idl_8h_source.html#l01617">lov_mds_md_v3::lmm_pool_name</a>, <a class="el" href="lustre__idl_8h_source.html#l01509">lov_mds_md_v1::lmm_stripe_count</a>, <a class="el" href="lustre__idl_8h_source.html#l01507">lov_mds_md_v1::lmm_stripe_size</a>, <a class="el" href="lod__lov_8c_source.html#l00839">lod_initialize_objects()</a>, <a class="el" href="lod__object_8c_source.html#l02868">lod_object_set_pool()</a>, <a class="el" href="packet-lustre_8c_source.html#l00085">LOV_MAGIC_V1</a>, <a class="el" href="lustre__idl_8h_source.html#l01471">LOV_MAGIC_V3</a>, <a class="el" href="lustre__idl_8h_source.html#l01621">lov_mds_md_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l01492">lov_pattern</a>, <a class="el" href="lustre__user_8h_source.html#l00352">LOV_PATTERN_F_RELEASED</a>, <a class="el" href="lustre__user_8h_source.html#l00345">LOV_PATTERN_RAID0</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00988">lod_load_striping_locked()</a>.</p>

</div>
</div>
<a class="anchor" id="ae715a634b2d198e7ff304497c987f9a3"></a><!-- doxytag: member="lod_lov.c::lod_pools_fini" ref="ae715a634b2d198e7ff304497c987f9a3" args="(struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_pools_fini </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release the structures describing the pools. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device from which we release the structures</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>always </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01372">1372</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="hash_8c_source.html#l01148">cfs_hash_putref()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__pool_8c_source.html#l00611">lod_ost_pool_free()</a>, <a class="el" href="lod__pool_8c_source.html#l00726">lod_pool_del()</a>, <a class="el" href="lod__internal_8h_source.html#l00204">lod_device::lod_pool_info</a>, <a class="el" href="lod__internal_8h_source.html#l00207">lod_device::lod_pool_list</a>, <a class="el" href="lod__internal_8h_source.html#l00206">lod_device::lod_pools_hash_body</a>, <a class="el" href="lod__internal_8h_source.html#l00201">lod_device::lod_qos</a>, <a class="el" href="lod__internal_8h_source.html#l00090">lod_qos::lq_rr</a>, <a class="el" href="lod__internal_8h_source.html#l00064">lod_qos_rr::lqr_pool</a>, <a class="el" href="lod__internal_8h_source.html#l00074">pool_desc::pool_list</a>, <a class="el" href="lod__internal_8h_source.html#l00069">pool_desc::pool_name</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01638">lod_device_fini()</a>, and <a class="el" href="lod__dev_8c_source.html#l01529">lod_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a9a41c8e8cb3c7e27d900b13bc63d668b"></a><!-- doxytag: member="lod_lov.c::lod_pools_init" ref="a9a41c8e8cb3c7e27d900b13bc63d668b" args="(struct lod_device *lod, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_pools_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the structures used to store pools and default striping. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lcfg</em>&nbsp;</td><td>configuration structure storing default striping.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if initialization succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01280">1280</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="byteorder_8h_source.html#l00039">__swab32</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="hash_8c_source.html#l01003">cfs_hash_create()</a>, <a class="el" href="libcfs__hash_8h_source.html#l00165">CFS_HASH_DEFAULT</a>, <a class="el" href="libcfs__hash_8h_source.html#l00775">CFS_HASH_MAX_THETA</a>, <a class="el" href="libcfs__hash_8h_source.html#l00774">CFS_HASH_MIN_THETA</a>, <a class="el" href="hash_8c_source.html#l01148">cfs_hash_putref()</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="obd__support_8h_source.html#l00081">HASH_POOLS_BKT_BITS</a>, <a class="el" href="obd__support_8h_source.html#l00082">HASH_POOLS_CUR_BITS</a>, <a class="el" href="obd__support_8h_source.html#l00083">HASH_POOLS_MAX_BITS</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l02748">lov_desc::ld_active_tgt_count</a>, <a class="el" href="lod__internal_8h_source.html#l00181">lod_device::lod_desc</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__lov_8c_source.html#l01263">lod_fix_desc()</a>, <a class="el" href="lod__pool_8c_source.html#l00611">lod_ost_pool_free()</a>, <a class="el" href="lod__pool_8c_source.html#l00468">lod_ost_pool_init()</a>, <a class="el" href="lod__internal_8h_source.html#l00205">lod_device::lod_pool_count</a>, <a class="el" href="lod__internal_8h_source.html#l00204">lod_device::lod_pool_info</a>, <a class="el" href="lod__internal_8h_source.html#l00207">lod_device::lod_pool_list</a>, <a class="el" href="lod__internal_8h_source.html#l00206">lod_device::lod_pools_hash_body</a>, <a class="el" href="lod__internal_8h_source.html#l00201">lod_device::lod_qos</a>, <a class="el" href="lod__qos_8c_source.html#l00534">lod_qos_rr_init()</a>, <a class="el" href="lod__internal_8h_source.html#l00210">lod_device::lod_sp_me</a>, <a class="el" href="lustre__idl_8h_source.html#l02741">LOV_DESC_MAGIC</a>, <a class="el" href="lod__internal_8h_source.html#l00091">lod_qos::lq_dirty</a>, <a class="el" href="lod__internal_8h_source.html#l00085">lod_qos::lq_oss_list</a>, <a class="el" href="lod__internal_8h_source.html#l00088">lod_qos::lq_prio_free</a>, <a class="el" href="lod__internal_8h_source.html#l00091">lod_qos::lq_reset</a>, <a class="el" href="lod__internal_8h_source.html#l00090">lod_qos::lq_rr</a>, <a class="el" href="lod__internal_8h_source.html#l00086">lod_qos::lq_rw_sem</a>, <a class="el" href="lod__internal_8h_source.html#l00089">lod_qos::lq_threshold_rr</a>, <a class="el" href="lod__internal_8h_source.html#l00065">lod_qos_rr::lqr_dirty</a>, <a class="el" href="lod__internal_8h_source.html#l00064">lod_qos_rr::lqr_pool</a>, <a class="el" href="lustre__cfg_8h_source.html#l00182">lustre_cfg_buf()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00146">LUSTRE_CFG_BUFLEN</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="lustre__sec_8h_source.html#l00316">LUSTRE_SP_CLI</a>, <a class="el" href="pack__generic_8c_source.html#l02053">lustre_swab_lov_desc()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lod__pool_8c_source.html#l00216">pool_hash_operations</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01529">lod_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="ab3950998e92e7107b04fdb3866a20f6a"></a><!-- doxytag: member="lod_lov.c::lod_putref" ref="ab3950998e92e7107b04fdb3866a20f6a" args="(struct lod_device *lod, struct lod_tgt_descs *ltd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_putref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Decrease reference count on the target table. </p>
<p>Companion of <a class="el" href="lod__internal_8h.html#aa9ce4cf9ed012a300938f6c637618c01" title="Increase reference count on the target table.">lod_getref()</a> to release a reference on the target table. If this is the last reference and the OST entry was scheduled for deletion, the descriptor is removed from the table.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>LOD device from which we release a reference </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table (lod_ost_descs or lod_mdt_descs) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00073">73</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00081">cfs_bitmap_clear()</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l02748">lov_desc::ld_active_tgt_count</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00181">lod_device::lod_desc</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__pool_8c_source.html#l00577">lod_ost_pool_remove()</a>, <a class="el" href="lod__internal_8h_source.html#l00204">lod_device::lod_pool_info</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_active</a>, <a class="el" href="lod__internal_8h_source.html#l00158">lod_tgt_descs::ltd_death_row</a>, <a class="el" href="lod__internal_8h_source.html#l00121">lod_tgt_desc::ltd_exp</a>, <a class="el" href="lod__internal_8h_source.html#l00120">lod_tgt_desc::ltd_kill</a>, <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_reap</a>, <a class="el" href="lod__internal_8h_source.html#l00160">lod_tgt_descs::ltd_refcount</a>, <a class="el" href="lod__internal_8h_source.html#l00164">lod_tgt_descs::ltd_rw_sem</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lod__internal_8h_source.html#l00154">lod_tgt_descs::ltd_tgtnr</a>, <a class="el" href="lod__internal_8h_source.html#l00122">lod_tgt_desc::ltd_uuid</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__user_8h_source.html#l00513">obd_uuid2str()</a>, and <a class="el" href="lod__qos_8c_source.html#l00145">qos_del_tgt()</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__lov_8c_source.html#l00529">lod_del_device()</a>, <a class="el" href="lod__lov_8c_source.html#l00490">lod_fini_tgt()</a>, <a class="el" href="lod__lov_8c_source.html#l00839">lod_initialize_objects()</a>, <a class="el" href="lod__dev_8c_source.html#l01811">lod_obd_get_info()</a>, <a class="el" href="lod__dev_8c_source.html#l01876">lod_obd_set_info_async()</a>, <a class="el" href="lod__object_8c_source.html#l04095">lod_object_init()</a>, <a class="el" href="lod__pool_8c_source.html#l00766">lod_pool_add()</a>, <a class="el" href="lod__pool_8c_source.html#l00823">lod_pool_remove()</a>, <a class="el" href="lod__qos_8c_source.html#l01848">lod_qos_prep_create()</a>, <a class="el" href="lod__dev_8c_source.html#l01029">lod_recovery_complete()</a>, <a class="el" href="lod__dev_8c_source.html#l00720">lod_sub_fini_all_llogs()</a>, <a class="el" href="lod__dev_8c_source.html#l00239">lod_sub_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00676">lod_sub_stop_recovery_threads()</a>, and <a class="el" href="lod__dev_8c_source.html#l01323">lod_sync()</a>.</p>

</div>
</div>
<a class="anchor" id="ad2fed6443561c5eb1930fe417b652190"></a><!-- doxytag: member="lod_lov.c::lod_verify_striping" ref="ad2fed6443561c5eb1930fe417b652190" args="(struct lod_device *d, const struct lu_buf *buf, bool is_from_disk)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_verify_striping </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__buf.html">lu_buf</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>is_from_disk</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify striping. </p>
<p>Check the validity of all fields including the magic, stripe size, stripe count, stripe offset and that the pool is present. Also check that each target index points to an existing target. The additional <em>is_from_disk</em> turns additional checks. In some cases zero fields are allowed (like pattern=0).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>LOD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer with LOV EA to verify </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>is_from_disk</em>&nbsp;</td><td>0 - from user, allow some fields to be 0 1 - from disk, do not allow</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the striping is valid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if striping is invalid </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l01097">1097</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="bitmap_8h_source.html#l00087">cfs_bitmap_check()</a>, <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="libcfs__debug_8h_source.html#l00136">D_IOCTL</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00054">le16_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__user_8h_source.html#l00385">lov_user_md_v1::lmm_magic</a>, <a class="el" href="lustre__user_8h_source.html#l00386">lov_user_md_v1::lmm_pattern</a>, <a class="el" href="lustre__user_8h_source.html#l00411">lov_user_md_v3::lmm_pool_name</a>, <a class="el" href="lustre__user_8h_source.html#l00389">lov_user_md_v1::lmm_stripe_count</a>, <a class="el" href="lustre__user_8h_source.html#l00391">lov_user_md_v1::lmm_stripe_offset</a>, <a class="el" href="lustre__user_8h_source.html#l00388">lov_user_md_v1::lmm_stripe_size</a>, <a class="el" href="lod__pool_8c_source.html#l00876">lod_check_index_in_pool()</a>, <a class="el" href="lod__pool_8c_source.html#l00909">lod_find_pool()</a>, <a class="el" href="lod__pool_8c_source.html#l00095">lod_pool_putref()</a>, <a class="el" href="lustre__idl_8h_source.html#l01489">LOV_MAGIC_V1_DEF</a>, <a class="el" href="lustre__idl_8h_source.html#l01490">LOV_MAGIC_V3_DEF</a>, <a class="el" href="lustre__user_8h_source.html#l00358">LOV_MIN_STRIPE_SIZE</a>, <a class="el" href="lod__internal_8h_source.html#l00057">LOV_OFFSET_DEFAULT</a>, <a class="el" href="lustre__user_8h_source.html#l00345">LOV_PATTERN_RAID0</a>, <a class="el" href="lustre__user_8h_source.html#l00336">LOV_USER_MAGIC_V1</a>, <a class="el" href="lustre__user_8h_source.html#l00339">LOV_USER_MAGIC_V3</a>, <a class="el" href="lustre__user_8h_source.html#l01032">offsetof</a>, <a class="el" href="lod__internal_8h_source.html#l00080">pool_tgt_count</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__object_8c_source.html#l02233">lod_xattr_set_lov_on_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="a60f5de9c793a023d0ebc7ef220c2f60c"></a><!-- doxytag: member="lod_lov.c::ltd_bitmap_resize" ref="a60f5de9c793a023d0ebc7ef220c2f60c" args="(struct lod_tgt_descs *ltd, __u32 newsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ltd_bitmap_resize </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>newsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Expand size of target table. </p>
<p>When the target table is full, we have to extend the table. To do so, we allocate new memory with some reserve, move data from the old table to the new one and release memory consumed by the old table. Notice we take ltd_rw_sem exclusively to ensure atomic switch.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target table </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>newsize</em>&nbsp;</td><td>new size of the table</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>if reallocation failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00149">149</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="bitmap_8h_source.html#l00049">CFS_ALLOCATE_BITMAP()</a>, <a class="el" href="bitmap_8h_source.html#l00106">cfs_bitmap_copy()</a>, <a class="el" href="bitmap_8h_source.html#l00072">CFS_FREE_BITMAP</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lod__internal_8h_source.html#l00164">lod_tgt_descs::ltd_rw_sem</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, and <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>.</p>

</div>
</div>
<a class="anchor" id="a5bdcfbf5ce13a199fa7b8462c304ca11"></a><!-- doxytag: member="lod_lov.c::validate_lod_and_idx" ref="a5bdcfbf5ce13a199fa7b8462c304ca11" args="(struct lod_device *md, __u32 idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int validate_lod_and_idx </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>md</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>idx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify the target index is present in the current configuration. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>md</em>&nbsp;</td><td>LOD device where the target table is stored </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>target's index</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the index is present </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if not </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__lov_8c_source.html#l00799">799</a> of file <a class="el" href="lod__lov_8c_source.html">lod_lov.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00087">cfs_bitmap_check()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00219">ltd_ost</a>, <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00839">lod_initialize_objects()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
