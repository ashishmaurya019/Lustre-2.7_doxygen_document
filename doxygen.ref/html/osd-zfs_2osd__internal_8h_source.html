<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/osd-zfs/osd_internal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/osd-zfs/osd_internal.h</h1><a href="osd-zfs_2osd__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2009, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2012, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * lustre/osd-zfs/osd_internal.h</span>
<a name="l00037"></a>00037 <span class="comment"> * Shared definitions and declarations for zfs/dmu osd</span>
<a name="l00038"></a>00038 <span class="comment"> *</span>
<a name="l00039"></a>00039 <span class="comment"> * Author: Alex Zhuravlev &lt;bzzz@whamcloud.com&gt;</span>
<a name="l00040"></a>00040 <span class="comment"> * Author: Mike Pershin &lt;tappro@whamcloud.com&gt;</span>
<a name="l00041"></a>00041 <span class="comment"> * Author: Johann Lombardi &lt;johann@whamcloud.com&gt;</span>
<a name="l00042"></a>00042 <span class="comment"> */</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#ifndef _OSD_INTERNAL_H</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#define _OSD_INTERNAL_H</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="dt__object_8h.html">dt_object.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="md__object_8h.html">md_object.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="lustre__quota_8h.html">lustre_quota.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#ifdef SHRINK_STOP</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#undef SHRINK_STOP</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/arc.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;sys/nvpair.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;sys/zfs_znode.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;sys/zap.h&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;sys/dbuf.h&gt;</span>
<a name="l00058"></a>00058 
<a name="l00064"></a>00064 <span class="preprocessor">#ifdef kmem_cache_destroy</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#undef kmem_cache_destroy</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 <span class="preprocessor">#ifdef kmem_cache_create</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#undef kmem_cache_create</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a>00072 <span class="preprocessor">#ifdef kmem_cache_alloc</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#undef kmem_cache_alloc</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="preprocessor">#ifdef kmem_cache_free</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#undef kmem_cache_free</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a3d4b34f149bb2076ddcc92145f40a92c">00080</a> <span class="preprocessor">#define LUSTRE_ROOT_FID_SEQ     0</span>
<a name="l00081"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ad00649554b013602396a2283422f22cc">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define DMU_OSD_SVNAME          &quot;svname&quot;</span>
<a name="l00082"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a8ec9a6f7a01f0a3b6c194f9ed965b84b">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define DMU_OSD_OI_NAME_BASE    &quot;oi&quot;</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00084"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a5e747b9bfd95c744c220695c510e8998">00084</a> <span class="preprocessor">#define OSD_GFP_IO              (GFP_NOFS | __GFP_HIGHMEM)</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a>00086 <span class="comment">/* Statfs space reservation for grant, fragmentation, and unlink space. */</span>
<a name="l00087"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a4619ebdd5353d601afee8a1bcf2682ae">00087</a> <span class="preprocessor">#define OSD_STATFS_RESERVED_SIZE        (16ULL &lt;&lt; 20) </span><span class="comment">/* reserve 16MB minimum */</span>
<a name="l00088"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#acece91a7b14739b0951ac1d372c467c2">00088</a> <span class="preprocessor">#define OSD_STATFS_RESERVED_SHIFT       (7)     </span><span class="comment">/* reserve 0.78% of all space */</span>
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">/* Statfs {minimum, safe estimate, and maximum} dnodes per block */</span>
<a name="l00091"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a379ae99595d37b2a9e81d8d58b87c47b">00091</a> <span class="preprocessor">#define OSD_DNODE_MIN_BLKSHIFT  (DNODES_PER_BLOCK_SHIFT)</span>
<a name="l00092"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a151b05f663fdcef23200147976adcbcb">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define OSD_DNODE_EST_BLKSHIFT  (DNODES_PER_BLOCK_SHIFT &gt;&gt; 1)</span>
<a name="l00093"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a078927812002298764010990563528c7">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define OSD_DNODE_EST_COUNT     1024</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a3d8ac332a61abada979fa299bc161e61">00095</a> <span class="preprocessor">#define OSD_GRANT_FOR_LOCAL_OIDS (2ULL &lt;&lt; 20) </span><span class="comment">/* 2MB for last_rcvd, ... */</span>
<a name="l00096"></a>00096 
<a name="l00100"></a>00100 <span class="keyword">struct </span><a class="code" href="structosd__it__quota.html" title="Iterator&amp;#39;s in-memory data structure for quota file.">osd_it_quota</a> {
<a name="l00101"></a>00101         <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a>       *<a class="code" href="structosd__it__quota.html#a03dfe8bf4398c18b74122b708549c63a">oiq_obj</a>;
<a name="l00102"></a>00102         <span class="comment">/* DMU accounting object id */</span>
<a name="l00103"></a><a class="code" href="structosd__it__quota.html#acb898fb5e61032d429a8f2ff51acaf6b">00103</a>         uint64_t                 <a class="code" href="structosd__it__quota.html#acb898fb5e61032d429a8f2ff51acaf6b">oiq_oid</a>;
<a name="l00104"></a>00104         <span class="comment">/* ZAP cursor */</span>
<a name="l00105"></a><a class="code" href="structosd__it__quota.html#a9838fb4f54162996159ffbc1c52b941b">00105</a>         zap_cursor_t            *<a class="code" href="structosd__it__quota.html#a9838fb4f54162996159ffbc1c52b941b">oiq_zc</a>;
<a name="l00107"></a>00107         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structosd__it__quota.html#a9d8b986954c568d9b521b4bd9b7aff88" title="identifier for current quota record">oiq_id</a>;
<a name="l00108"></a><a class="code" href="structosd__it__quota.html#a08613807bf08af2efc9e949fbca37989">00108</a>         <span class="keywordtype">unsigned</span>                 <a class="code" href="structosd__it__quota.html#a08613807bf08af2efc9e949fbca37989">oiq_reset</a>:1; <span class="comment">/* 1 -- no need to advance */</span>
<a name="l00109"></a>00109 };
<a name="l00110"></a>00110 
<a name="l00118"></a><a class="code" href="structosd__zap__it.html">00118</a> <span class="keyword">struct </span><a class="code" href="structosd__zap__it.html" title="Iterator&amp;#39;s in-memory data structure for ZAPs.">osd_zap_it</a> {
<a name="l00119"></a><a class="code" href="structosd__zap__it.html#a7b8bdeb6ae4be2f57a9226c589e031b0">00119</a>         zap_cursor_t            *<a class="code" href="structosd__zap__it.html#a7b8bdeb6ae4be2f57a9226c589e031b0">ozi_zc</a>;
<a name="l00120"></a><a class="code" href="structosd__zap__it.html#a61615b98b43ea8ffb8c1704698975915">00120</a>         <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a>       *<a class="code" href="structosd__zap__it.html#a61615b98b43ea8ffb8c1704698975915">ozi_obj</a>;
<a name="l00121"></a><a class="code" href="structosd__zap__it.html#ab558ec38d94c380199f65ff3ef14a2b9">00121</a>         <span class="keywordtype">unsigned</span>                 <a class="code" href="structosd__zap__it.html#ab558ec38d94c380199f65ff3ef14a2b9">ozi_reset</a>:1;   <span class="comment">/* 1 -- no need to advance */</span>
<a name="l00122"></a>00122         <span class="comment">/* ozi_pos - position of the cursor:</span>
<a name="l00123"></a>00123 <span class="comment">         * 0 - before any record</span>
<a name="l00124"></a>00124 <span class="comment">         * 1 - &quot;.&quot;</span>
<a name="l00125"></a>00125 <span class="comment">         * 2 - &quot;..&quot;</span>
<a name="l00126"></a>00126 <span class="comment">         * 3 - real records */</span>
<a name="l00127"></a><a class="code" href="structosd__zap__it.html#ad2f6981f8a1d1154c3f4e7ef05654c93">00127</a>         <span class="keywordtype">unsigned</span>                 <a class="code" href="structosd__zap__it.html#ad2f6981f8a1d1154c3f4e7ef05654c93">ozi_pos</a>:3;
<a name="l00128"></a>00128         <span class="keyword">union </span>{
<a name="l00129"></a><a class="code" href="structosd__zap__it.html#aa7458d82b0f33c610b7482620acc5110">00129</a>                 <span class="keywordtype">char</span>             <a class="code" href="structosd__zap__it.html#aa7458d82b0f33c610b7482620acc5110">ozi_name</a>[MAXNAMELEN]; <span class="comment">/* file name for dir */</span>
<a name="l00130"></a><a class="code" href="structosd__zap__it.html#aa8acda6e755a8b2fe40522855206ef7d">00130</a>                 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>            <a class="code" href="structosd__zap__it.html#aa8acda6e755a8b2fe40522855206ef7d">ozi_key</a>; <span class="comment">/* binary key for index files */</span>
<a name="l00131"></a>00131         };
<a name="l00132"></a>00132 };
<a name="l00133"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a4e644be19f203c421c2d00f0455c0132">00133</a> <span class="preprocessor">#define DT_IT2DT(it) (&amp;((struct osd_zap_it *)it)-&gt;ozi_obj-&gt;oo_dt)</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>
<a name="l00135"></a>00135 <span class="comment">/*</span>
<a name="l00136"></a>00136 <span class="comment"> * regular ZFS direntry</span>
<a name="l00137"></a>00137 <span class="comment"> */</span>
<a name="l00138"></a><a class="code" href="structzpl__direntry.html">00138</a> <span class="keyword">struct </span><a class="code" href="structzpl__direntry.html">zpl_direntry</a> {
<a name="l00139"></a><a class="code" href="structzpl__direntry.html#a61ab61f430d1ef10f2f15c672a17c588">00139</a>         uint64_t        <a class="code" href="structzpl__direntry.html#abb2033dd3dc15f51c086928eddfefd56">zde_dnode</a>:48,
<a name="l00140"></a>00140                         <a class="code" href="structzpl__direntry.html#aa429215dc685ee60aeeb40f62412adc1">zde_pad</a>:12,
<a name="l00141"></a>00141                         <a class="code" href="structzpl__direntry.html#a61ab61f430d1ef10f2f15c672a17c588">zde_type</a>:4;
<a name="l00142"></a>00142 } <a class="code" href="fid_8mod_8c.html#a804f230e6220e338767d15b94fc5801d">__attribute__</a>((<a class="code" href="group__lustreidl.html#ga30372a269f5fc08f064b7e94437589bb" title="Identifier for a single log object.">packed</a>));
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">/*</span>
<a name="l00145"></a>00145 <span class="comment"> * lustre direntry adds a fid to regular ZFS direntry</span>
<a name="l00146"></a>00146 <span class="comment"> */</span>
<a name="l00147"></a><a class="code" href="structluz__direntry.html">00147</a> <span class="keyword">struct </span><a class="code" href="structluz__direntry.html">luz_direntry</a> {
<a name="l00148"></a><a class="code" href="structluz__direntry.html#a5366a192198119daded944fc6eae99f2">00148</a>         <span class="keyword">struct </span><a class="code" href="structzpl__direntry.html">zpl_direntry</a>     <a class="code" href="structluz__direntry.html#a5366a192198119daded944fc6eae99f2">lzd_reg</a>;
<a name="l00149"></a><a class="code" href="structluz__direntry.html#a84c40f79d84ac914a762e1adb5bb8b6a">00149</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>           <a class="code" href="structluz__direntry.html#a84c40f79d84ac914a762e1adb5bb8b6a">lzd_fid</a>;
<a name="l00150"></a>00150 } <a class="code" href="fid_8mod_8c.html#a804f230e6220e338767d15b94fc5801d">__attribute__</a>((<a class="code" href="group__lustreidl.html#ga30372a269f5fc08f064b7e94437589bb" title="Identifier for a single log object.">packed</a>));
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="comment">/* cached SA attributes */</span>
<a name="l00154"></a><a class="code" href="structosa__attr.html">00154</a> <span class="keyword">struct </span><a class="code" href="structosa__attr.html">osa_attr</a> {
<a name="l00155"></a><a class="code" href="structosa__attr.html#a61c4d63f63d54bdb858563cffb6ed044">00155</a>         uint64_t        <a class="code" href="structosa__attr.html#a61c4d63f63d54bdb858563cffb6ed044">mode</a>;
<a name="l00156"></a><a class="code" href="structosa__attr.html#accfebe1d40cc8b814a3cc011b33ec264">00156</a>         uint64_t        <a class="code" href="structosa__attr.html#accfebe1d40cc8b814a3cc011b33ec264">gid</a>;
<a name="l00157"></a><a class="code" href="structosa__attr.html#ab2182cbf4727b89d954e9db745a75a10">00157</a>         uint64_t        <a class="code" href="structosa__attr.html#ab2182cbf4727b89d954e9db745a75a10">uid</a>;
<a name="l00158"></a><a class="code" href="structosa__attr.html#a44f2f9738688eb5fd75efc763635691d">00158</a>         uint64_t        <a class="code" href="structosa__attr.html#a44f2f9738688eb5fd75efc763635691d">nlink</a>;
<a name="l00159"></a><a class="code" href="structosa__attr.html#a11cd392ba425d43ca4baf9f268679a21">00159</a>         uint64_t        <a class="code" href="structosa__attr.html#a11cd392ba425d43ca4baf9f268679a21">rdev</a>;
<a name="l00160"></a><a class="code" href="structosa__attr.html#a1c4172724554f9a8f12d180fa3b99f8c">00160</a>         uint64_t        <a class="code" href="structosa__attr.html#a1c4172724554f9a8f12d180fa3b99f8c">flags</a>;
<a name="l00161"></a><a class="code" href="structosa__attr.html#a2c71dd5f341b77baf273e0140b948da9">00161</a>         uint64_t        <a class="code" href="structosa__attr.html#a2c71dd5f341b77baf273e0140b948da9">size</a>;
<a name="l00162"></a><a class="code" href="structosa__attr.html#aee85cc922285c6787f8cce27fc1f2ad9">00162</a>         uint64_t        <a class="code" href="structosa__attr.html#aee85cc922285c6787f8cce27fc1f2ad9">atime</a>[2];
<a name="l00163"></a><a class="code" href="structosa__attr.html#ae9ff041f4ee25ad5915bb6a7548d0bd6">00163</a>         uint64_t        <a class="code" href="structosa__attr.html#ae9ff041f4ee25ad5915bb6a7548d0bd6">mtime</a>[2];
<a name="l00164"></a><a class="code" href="structosa__attr.html#aa93287651373679e29c309462256e114">00164</a>         uint64_t        <a class="code" href="structosa__attr.html#aa93287651373679e29c309462256e114">ctime</a>[2];
<a name="l00165"></a>00165 };
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> {
<a name="l00168"></a>00168         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>     *<a class="code" href="structosd__thread__info.html#a015305f2c9156fab8180de74a6186b82">oti_env</a>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>            oti_fid;
<a name="l00171"></a>00171         <span class="comment">/*</span>
<a name="l00172"></a>00172 <span class="comment">         * XXX temporary: for -&gt;i_op calls.</span>
<a name="l00173"></a>00173 <span class="comment">         */</span>
<a name="l00174"></a>00174         <span class="keyword">struct </span>timespec          oti_time;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <span class="keyword">struct </span><a class="code" href="structost__id.html" title="OST object IDentifier.">ost_id</a>            oti_ostid;
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="structosd__thread__info.html#a71f1bac8e6af62d8dfae8e8c974719b6">00178</a>         <span class="keywordtype">char</span>                     <a class="code" href="structosd__thread__info.html#a7dc33f62235078a8128d3bdb51574886" title="used in osd_fid_set() to put xattr">oti_buf</a>[64];
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="structosd__thread__info.html#aee75438fc11f6d13ee08729caf03b69b">00180</a>         <span class="keywordtype">char</span>                     <a class="code" href="structosd__thread__info.html#aee75438fc11f6d13ee08729caf03b69b">oti_str</a>[64];
<a name="l00181"></a>00181         <span class="keyword">union </span>{
<a name="l00182"></a><a class="code" href="structosd__thread__info.html#ad5255d2912a0db20e571f142b34332c9">00182</a>                 <span class="keywordtype">char</span>             <a class="code" href="structosd__thread__info.html#ad5255d2912a0db20e571f142b34332c9">oti_key</a>[MAXNAMELEN + 1];
<a name="l00183"></a><a class="code" href="structosd__thread__info.html#a9c59e073f39b50a71a3ccbe7d3c01d64">00183</a>                 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>            <a class="code" href="structosd__thread__info.html#a9c59e073f39b50a71a3ccbe7d3c01d64">oti_key64</a>[(MAXNAMELEN + 1)/<span class="keyword">sizeof</span>(<a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>)];
<a name="l00184"></a>00184         };
<a name="l00185"></a>00185         <span class="keyword">struct </span><a class="code" href="structlustre__mdt__attrs.html" title="Following struct for object attributes, that will be kept inode&amp;#39;s EA.">lustre_mdt_attrs</a> <a class="code" href="structosd__thread__info.html#ac7587c5d6c3b43bdfc4364118cef1f6f">oti_mdt_attrs</a>;
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="structosd__thread__info.html#aa60b8f8a5552e302a6b096ff27c40dfc">00187</a>         <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a>           <a class="code" href="structosd__thread__info.html#aa60b8f8a5552e302a6b096ff27c40dfc">oti_la</a>;
<a name="l00188"></a><a class="code" href="structosd__thread__info.html#ae9f852ed60a6b4cc42c3f97598dc54e6">00188</a>         <span class="keyword">struct </span><a class="code" href="structosa__attr.html">osa_attr</a>          <a class="code" href="structosd__thread__info.html#ae9f852ed60a6b4cc42c3f97598dc54e6">oti_osa</a>;
<a name="l00189"></a><a class="code" href="structosd__thread__info.html#a0579bbeeb208d22e15d7f3d3af696769">00189</a>         zap_attribute_t          <a class="code" href="structosd__thread__info.html#a0579bbeeb208d22e15d7f3d3af696769">oti_za</a>;
<a name="l00190"></a><a class="code" href="structosd__thread__info.html#a61ac039a3ec44d8b0bc12d65058614fe">00190</a>         dmu_object_info_t        <a class="code" href="structosd__thread__info.html#a61ac039a3ec44d8b0bc12d65058614fe">oti_doi</a>;
<a name="l00191"></a><a class="code" href="structosd__thread__info.html#aa0fa9693a4e9ebb77c74b13c58119587">00191</a>         <span class="keyword">struct </span><a class="code" href="structluz__direntry.html">luz_direntry</a>      <a class="code" href="structosd__thread__info.html#aa0fa9693a4e9ebb77c74b13c58119587">oti_zde</a>;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193         <span class="keyword">struct </span><a class="code" href="structlquota__id__info.html">lquota_id_info</a>    <a class="code" href="structosd__thread__info.html#a982b377ce573f4de64ebf78fffd50d99">oti_qi</a>;
<a name="l00194"></a>00194         <span class="keyword">struct </span><a class="code" href="structlu__seq__range.html" title="Describes a range of sequence, lsr_start is included but lsr_end is not in the range...">lu_seq_range</a>      <a class="code" href="structosd__thread__info.html#a40d5f0bfe3c8026b77b307caaadaf2bc">oti_seq_range</a>;
<a name="l00195"></a>00195 };
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__context__key.html" title="Key.">lu_context_key</a> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#aeec1bbe93dd8e9437856bc428708caa4">osd_key</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">00199</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201         <span class="keywordflow">return</span> <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#aeec1bbe93dd8e9437856bc428708caa4">osd_key</a>);
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="keyword">struct </span><a class="code" href="structosd__thandle.html">osd_thandle</a> {
<a name="l00205"></a>00205         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>           <a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>;
<a name="l00206"></a><a class="code" href="structosd__thandle.html#a07e3c381863fd6d92e4cf3462913f991">00206</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__thandle.html#a07e3c381863fd6d92e4cf3462913f991">ot_dcb_list</a>;
<a name="l00207"></a>00207         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__thandle.html#af4812c91367ca69db02db7f9d94ed313">ot_stop_dcb_list</a>;
<a name="l00208"></a><a class="code" href="structosd__thandle.html#ab7d0f944fcb2cfdb07f057a5afc7450a">00208</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__thandle.html#ab7d0f944fcb2cfdb07f057a5afc7450a">ot_unlinked_list</a>;
<a name="l00209"></a><a class="code" href="structosd__thandle.html#a5ce941bd56a8a500b9214104b5bfa4d7">00209</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__thandle.html#a5ce941bd56a8a500b9214104b5bfa4d7">ot_sa_list</a>;
<a name="l00210"></a><a class="code" href="structosd__thandle.html#a7dd4adbc05d2f2001ed3653677657304">00210</a>         <span class="keyword">struct </span>semaphore         <a class="code" href="structosd__thandle.html#a7dd4adbc05d2f2001ed3653677657304">ot_sa_lock</a>;
<a name="l00211"></a><a class="code" href="structosd__thandle.html#ad699403c28542960be8d1e1b33564be1">00211</a>         dmu_tx_t                *<a class="code" href="structosd__thandle.html#ad699403c28542960be8d1e1b33564be1">ot_tx</a>;
<a name="l00212"></a><a class="code" href="structosd__thandle.html#a9ab8c2d25be1857cf1a854e5a90af149">00212</a>         <span class="keyword">struct </span><a class="code" href="structlquota__trans.html">lquota_trans</a>      <a class="code" href="structosd__thandle.html#a2edabe000b7642f34ce5cfbd72afcd0c">ot_quota_trans</a>;
<a name="l00213"></a><a class="code" href="structosd__thandle.html#a693222f330fb4d7594d80776d03e19a9">00213</a>         __u32                    <a class="code" href="structosd__thandle.html#a693222f330fb4d7594d80776d03e19a9">ot_write_commit</a>:1,
<a name="l00214"></a>00214                                  <a class="code" href="structosd__thandle.html#a28b2ebaeb91a360fb3160120756178ce">ot_assigned</a>:1;
<a name="l00215"></a>00215 };
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#accbc088a5b7ebcc647f26889ae56f186">00217</a> <span class="preprocessor">#define OSD_OI_NAME_SIZE        16</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>
<a name="l00219"></a>00219 <span class="comment">/*</span>
<a name="l00220"></a>00220 <span class="comment"> * Object Index (OI) instance.</span>
<a name="l00221"></a>00221 <span class="comment"> */</span>
<a name="l00222"></a>00222 <span class="keyword">struct </span><a class="code" href="structosd__oi.html">osd_oi</a> {
<a name="l00223"></a><a class="code" href="structosd__oi.html#a80b7fce1e41c5cee6b32c311f2561e90">00223</a>         <span class="keywordtype">char</span>                    <a class="code" href="structosd__oi.html#a80b7fce1e41c5cee6b32c311f2561e90">oi_name</a>[<a class="code" href="osd-zfs_2osd__internal_8h.html#accbc088a5b7ebcc647f26889ae56f186">OSD_OI_NAME_SIZE</a>]; <span class="comment">/* unused */</span>
<a name="l00224"></a><a class="code" href="structosd__oi.html#ab29d98314338c549cae4f25be78245b5">00224</a>         uint64_t                <a class="code" href="structosd__oi.html#ab29d98314338c549cae4f25be78245b5">oi_zapid</a>;
<a name="l00225"></a><a class="code" href="structosd__oi.html#a624769e9f7c285ae4a76dffc18919ae9">00225</a>         dmu_buf_t              *<a class="code" href="structosd__oi.html#a624769e9f7c285ae4a76dffc18919ae9">oi_db</a>;
<a name="l00226"></a>00226 };
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="structosd__seq.html">00228</a> <span class="keyword">struct </span><a class="code" href="structosd__seq.html">osd_seq</a> {
<a name="l00229"></a><a class="code" href="structosd__seq.html#acd1759ab81006c7dda5e277ab0420753">00229</a>         uint64_t         *<a class="code" href="structosd__seq.html#acd1759ab81006c7dda5e277ab0420753">os_compat_dirs</a>;
<a name="l00230"></a><a class="code" href="structosd__seq.html#a13d1f6dc392be5586ccfb8027c4f9b73">00230</a>         <span class="keywordtype">int</span>              <a class="code" href="structosd__seq.html#a13d1f6dc392be5586ccfb8027c4f9b73">os_subdir_count</a>; <span class="comment">/* subdir count for each seq */</span>
<a name="l00231"></a><a class="code" href="structosd__seq.html#a0dce44a44b78f456e67a4f0dabc4cfca">00231</a>         u64              <a class="code" href="structosd__seq.html#a0dce44a44b78f456e67a4f0dabc4cfca">os_seq</a>;          <span class="comment">/* seq number */</span>
<a name="l00232"></a><a class="code" href="structosd__seq.html#a3fce995bf946bae968f8a86d44a1a54c">00232</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__seq.html#a3fce995bf946bae968f8a86d44a1a54c">os_seq_list</a>;     <span class="comment">/* list to seq_list */</span>
<a name="l00233"></a>00233 };
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="structosd__seq__list.html">00235</a> <span class="keyword">struct </span><a class="code" href="structosd__seq__list.html">osd_seq_list</a> {
<a name="l00236"></a><a class="code" href="structosd__seq__list.html#a743138ec6248a43196f3caa0477a129c">00236</a>         rwlock_t         <a class="code" href="structosd__seq__list.html#a743138ec6248a43196f3caa0477a129c">osl_seq_list_lock</a>;     <span class="comment">/* lock for seq_list */</span>
<a name="l00237"></a><a class="code" href="structosd__seq__list.html#aa320ab9bca17810dcd296c4770804e15">00237</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__seq__list.html#aa320ab9bca17810dcd296c4770804e15">osl_seq_list</a>;          <span class="comment">/* list head for seq */</span>
<a name="l00238"></a><a class="code" href="structosd__seq__list.html#a86daaa93f8d1abe59f6cb03b281a4fc6">00238</a>         <span class="keyword">struct </span>semaphore <a class="code" href="structosd__seq__list.html#a86daaa93f8d1abe59f6cb03b281a4fc6">osl_seq_init_sem</a>;
<a name="l00239"></a>00239 };
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aed8e8eae2b02ee03e79f0b7fd37bbd99">00241</a> <span class="preprocessor">#define OSD_OST_MAP_SIZE        32</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="comment">/*</span>
<a name="l00244"></a>00244 <span class="comment"> * osd device.</span>
<a name="l00245"></a>00245 <span class="comment"> */</span>
<a name="l00246"></a>00246 <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> {
<a name="l00247"></a>00247         <span class="comment">/* super-class */</span>
<a name="l00248"></a>00248         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>         od_dt_dev;
<a name="l00249"></a>00249         <span class="comment">/* information about underlying file system */</span>
<a name="l00250"></a><a class="code" href="structosd__device.html#aa5d14dd8e85e91041bdcbeeceda5f93e">00250</a>         <span class="keyword">struct </span>objset           *<a class="code" href="structosd__device.html#aa5d14dd8e85e91041bdcbeeceda5f93e">od_os</a>;
<a name="l00251"></a><a class="code" href="structosd__device.html#a6c2bcf10fbb1062475d08b578e02068f">00251</a>         uint64_t                 <a class="code" href="structosd__device.html#a6c2bcf10fbb1062475d08b578e02068f">od_rootid</a>;  <span class="comment">/* id of root znode */</span>
<a name="l00252"></a><a class="code" href="structosd__device.html#a1473657e2ab280c18b442e25495a627c">00252</a>         uint64_t                 <a class="code" href="structosd__device.html#a1473657e2ab280c18b442e25495a627c">od_unlinkedid</a>; <span class="comment">/* id of unlinked zapobj */</span>
<a name="l00253"></a>00253         <span class="comment">/* SA attr mapping-&gt;id,</span>
<a name="l00254"></a>00254 <span class="comment">         * name is the same as in ZFS to use defines SA_ZPL_...*/</span>
<a name="l00255"></a><a class="code" href="structosd__device.html#a76cf1f5fd4e6db2bb8d8c56a3a8823c6">00255</a>         sa_attr_type_t           *<a class="code" href="structosd__device.html#a76cf1f5fd4e6db2bb8d8c56a3a8823c6">z_attr_table</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structosd__device.html#add4a17480cd98cbf2d49abdd087ec597">od_proc_entry</a>;
<a name="l00258"></a>00258         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>    *<a class="code" href="structosd__device.html#a8c01ebae19da43b96fa75f4df27bb7a1">od_stats</a>;
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="structosd__device.html#ab66914cae0a7697fd2dca7664d0759ed">00260</a>         uint64_t                 <a class="code" href="structosd__device.html#ab66914cae0a7697fd2dca7664d0759ed">od_max_blksz</a>;
<a name="l00261"></a><a class="code" href="structosd__device.html#a3f3403063d2c25b54c1bcb8b8c0c151b">00261</a>         uint64_t                 <a class="code" href="structosd__device.html#a3f3403063d2c25b54c1bcb8b8c0c151b">od_root</a>;
<a name="l00262"></a><a class="code" href="structosd__device.html#a4d605c8fda0603f28123cf05ecbdb530">00262</a>         uint64_t                 <a class="code" href="structosd__device.html#a4d605c8fda0603f28123cf05ecbdb530">od_O_id</a>;
<a name="l00263"></a>00263         <span class="keyword">struct </span><a class="code" href="structosd__oi.html">osd_oi</a>           **<a class="code" href="structosd__device.html#aa39936b9319f2e21867a2fd0034ca2dd">od_oi_table</a>;
<a name="l00264"></a><a class="code" href="structosd__device.html#ab3b795fbc2da8bc379a55e546a9646da">00264</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             <a class="code" href="structosd__device.html#a6c567bcf80744a85daba595066670b2e">od_oi_count</a>;
<a name="l00265"></a><a class="code" href="structosd__device.html#a6d5e5b9250ea9b01a740a73743327aca">00265</a>         <span class="keyword">struct </span><a class="code" href="structosd__seq__list.html">osd_seq_list</a>     <a class="code" href="structosd__device.html#a6d5e5b9250ea9b01a740a73743327aca">od_seq_list</a>;
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="structosd__device.html#a553eb931a9fca41836649e50e288d8bd">00267</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             <a class="code" href="structosd__device.html#a453c6802d2ba221e273f0730ae5a190b" title="osd_ro() called">od_dev_set_rdonly</a>:1, 
<a name="l00268"></a>00268                                  <a class="code" href="structosd__device.html#a1a62eb49802b2373c5d99277488bd347" title="ZFS property readonly.">od_prop_rdonly</a>:1,  
<a name="l00269"></a>00269                                  <a class="code" href="structosd__device.html#a553eb931a9fca41836649e50e288d8bd">od_xattr_in_sa</a>:1,
<a name="l00270"></a>00270                                  <a class="code" href="structosd__device.html#af5a9443eb7455aa40efe1228f305ffc1">od_quota_iused_est</a>:1,
<a name="l00271"></a>00271                                  <a class="code" href="structosd__device.html#a39f379723f147ae261cc103ee74abedc">od_is_ost</a>:1,
<a name="l00272"></a>00272                                  <a class="code" href="structosd__device.html#ae3eaaf37149071c9dfdddf9b8095e9dd">od_posix_acl</a>:1;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="keywordtype">char</span>                     <a class="code" href="structosd__device.html#aa3f8fb7471ee895b56517b78b0225424">od_mntdev</a>[128];
<a name="l00275"></a>00275         <span class="keywordtype">char</span>                     <a class="code" href="structosd__device.html#a1caa2232343f3ee6b75de8fe6fd2cd85">od_svname</a>[128];
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="keywordtype">int</span>                      <a class="code" href="structosd__device.html#a0617b10caa8348d428787e6aea37c52b">od_connects</a>;
<a name="l00278"></a>00278         <span class="keyword">struct </span><a class="code" href="structlu__site.html" title="lu_site is a &amp;quot;compartment&amp;quot; within which objects are unique, and LRU discipline...">lu_site</a>           <a class="code" href="structosd__device.html#a6ffdfa10dcb19272d176c9a0af96ade4">od_site</a>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="comment">/* object IDs of the inode accounting indexes */</span>
<a name="l00281"></a><a class="code" href="structosd__device.html#aff24b052c6d898820aa1211d3735ac31">00281</a>         uint64_t                 <a class="code" href="structosd__device.html#aff24b052c6d898820aa1211d3735ac31">od_iusr_oid</a>;
<a name="l00282"></a><a class="code" href="structosd__device.html#aa0b3096b5e6d7de18ab5b3a167ab66ab">00282</a>         uint64_t                 <a class="code" href="structosd__device.html#aa0b3096b5e6d7de18ab5b3a167ab66ab">od_igrp_oid</a>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">/* quota slave instance */</span>
<a name="l00285"></a>00285         <span class="keyword">struct </span><a class="code" href="structqsd__instance.html">qsd_instance</a>     *<a class="code" href="structosd__device.html#a5d68a9e1ddc05312b23ff082ea673e1c">od_quota_slave</a>;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         <span class="keyword">struct </span><a class="code" href="structbrw__stats.html">brw_stats</a>        <a class="code" href="structosd__device.html#ad2dd891460c9c53c4bdef00d46c91ab8">od_brw_stats</a>;
<a name="l00288"></a>00288         atomic_t                <a class="code" href="structosd__device.html#ac38bcff65f55df360529d778d83c43ed">od_r_in_flight</a>;
<a name="l00289"></a>00289         atomic_t                <a class="code" href="structosd__device.html#ae45520e9a93ad0079b9a2f415a7cdf8f">od_w_in_flight</a>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment">/* used to debug zerocopy logic: the fields track all</span>
<a name="l00292"></a>00292 <span class="comment">         * allocated, loaned and referenced buffers in use.</span>
<a name="l00293"></a>00293 <span class="comment">         * to be removed once the change is tested well. */</span>
<a name="l00294"></a><a class="code" href="structosd__device.html#a65e3d4970566ac64e87d8b00b9c21489">00294</a>         atomic_t                 <a class="code" href="structosd__device.html#a65e3d4970566ac64e87d8b00b9c21489">od_zerocopy_alloc</a>;
<a name="l00295"></a><a class="code" href="structosd__device.html#a832f8a8ac986ac9d6f8000ca3809547a">00295</a>         atomic_t                 <a class="code" href="structosd__device.html#a832f8a8ac986ac9d6f8000ca3809547a">od_zerocopy_loan</a>;
<a name="l00296"></a><a class="code" href="structosd__device.html#ad30bca365f64397513f8a6abe206afb6">00296</a>         atomic_t                 <a class="code" href="structosd__device.html#ad30bca365f64397513f8a6abe206afb6">od_zerocopy_pin</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="structosd__device.html#a89c2a8038ad151cd88298a1fcad159cd">00298</a>         arc_prune_t             *<a class="code" href="structosd__device.html#a89c2a8038ad151cd88298a1fcad159cd">arc_prune_cb</a>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="comment">/* osd seq instance */</span>
<a name="l00301"></a>00301         <span class="keyword">struct </span><a class="code" href="structlu__client__seq.html">lu_client_seq</a>    *<a class="code" href="structosd__device.html#a099ccb84759d21affce24b2a2327d747">od_cl_seq</a>;
<a name="l00302"></a>00302 };
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214f">00304</a> <span class="keyword">enum</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214f">osd_destroy_type</a> {
<a name="l00305"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214facc9e882e0211f4e34a8d266ecdf8b6e1">00305</a>         <a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214facc9e882e0211f4e34a8d266ecdf8b6e1">OSD_DESTROY_NONE</a> = 0,
<a name="l00306"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214fa93197e37c0d77613178eee68e73b89cd">00306</a>         <a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214fa93197e37c0d77613178eee68e73b89cd">OSD_DESTROY_SYNC</a> = 1,
<a name="l00307"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214fa6c367f00a6a1d626de822c693a3c584e">00307</a>         <a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214fa6c367f00a6a1d626de822c693a3c584e">OSD_DESTROY_ASYNC</a> = 2,
<a name="l00308"></a>00308 };
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> {
<a name="l00311"></a>00311         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>         oo_dt;
<a name="l00312"></a>00312         <span class="comment">/*</span>
<a name="l00313"></a>00313 <span class="comment">         * Inode for file system object represented by this osd_object. This</span>
<a name="l00314"></a>00314 <span class="comment">         * inode is pinned for the whole duration of lu_object life.</span>
<a name="l00315"></a>00315 <span class="comment">         *</span>
<a name="l00316"></a>00316 <span class="comment">         * Not modified concurrently (either setup early during object</span>
<a name="l00317"></a>00317 <span class="comment">         * creation, or assigned by osd_object_create() under write lock).</span>
<a name="l00318"></a>00318 <span class="comment">         */</span>
<a name="l00319"></a><a class="code" href="structosd__object.html#a69690a98abd452965d4c459feaf1b645">00319</a>         dmu_buf_t               *<a class="code" href="structosd__object.html#a69690a98abd452965d4c459feaf1b645">oo_db</a>;
<a name="l00320"></a><a class="code" href="structosd__object.html#a586ea42d6c236d10b949f5b8627b11c6">00320</a>         sa_handle_t             *<a class="code" href="structosd__object.html#a586ea42d6c236d10b949f5b8627b11c6">oo_sa_hdl</a>;
<a name="l00321"></a><a class="code" href="structosd__object.html#a36482d62dbc7085bab5cba70f9ea11fc">00321</a>         nvlist_t                *<a class="code" href="structosd__object.html#a36482d62dbc7085bab5cba70f9ea11fc">oo_sa_xattr</a>;
<a name="l00322"></a><a class="code" href="structosd__object.html#a2059653b4c3ee7d10a4b606ccd86fa2d">00322</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__object.html#a2059653b4c3ee7d10a4b606ccd86fa2d">oo_sa_linkage</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <span class="comment">/* used to implement osd_object_*_{lock|unlock} */</span>
<a name="l00325"></a>00325         <span class="keyword">struct </span>rw_semaphore      <a class="code" href="structosd__object.html#a03a2365f2e63fefc094ae57a089c45fa">oo_sem</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327         <span class="comment">/* to serialize some updates: destroy vs. others,</span>
<a name="l00328"></a>00328 <span class="comment">         * xattr_set, etc */</span>
<a name="l00329"></a><a class="code" href="structosd__object.html#af09a41e45a06d4e20c4c473d3afc0995">00329</a>         <span class="keyword">struct </span>rw_semaphore      <a class="code" href="structosd__object.html#a0ae5bff884db9403b755de08f7482754" title="protects inode attributes.">oo_guard</a>;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331         <span class="comment">/* protected by oo_guard */</span>
<a name="l00332"></a><a class="code" href="structosd__object.html#ad6ef17082053be4d655dc62b38d98a01">00332</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__object.html#ad6ef17082053be4d655dc62b38d98a01">oo_unlinked_linkage</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <span class="comment">/* cached attributes */</span>
<a name="l00335"></a><a class="code" href="structosd__object.html#a7148faf5adec78c721e0ecfa1e6939a0">00335</a>         rwlock_t                 <a class="code" href="structosd__object.html#a7148faf5adec78c721e0ecfa1e6939a0">oo_attr_lock</a>;
<a name="l00336"></a><a class="code" href="structosd__object.html#a8669d50b0d95bc13eac2b100e25d1dd1">00336</a>         <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a>           <a class="code" href="structosd__object.html#a8669d50b0d95bc13eac2b100e25d1dd1">oo_attr</a>;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="comment">/* external dnode holding large EAs, protected by oo_guard */</span>
<a name="l00339"></a><a class="code" href="structosd__object.html#aa3e9ca5791ad066540f458b78d569d75">00339</a>         uint64_t                 <a class="code" href="structosd__object.html#aa3e9ca5791ad066540f458b78d569d75">oo_xattr</a>;
<a name="l00340"></a><a class="code" href="structosd__object.html#a0b627e2460b9b530942302f94d8b76b9">00340</a>         <span class="keyword">enum</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#ae7910d06672a6a7dba09ba6ae97b214f">osd_destroy_type</a>    <a class="code" href="structosd__object.html#a0b627e2460b9b530942302f94d8b76b9">oo_destroy</a>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342         __u32                    <a class="code" href="structosd__object.html#ae944579808f6846f17612eb34378abdf">oo_destroyed</a>:1;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344         <span class="comment">/* the i_flags in LMA */</span>
<a name="l00345"></a>00345         __u32                    <a class="code" href="structosd__object.html#a1ee7929b30c29fd2c8f16e97154641a7">oo_lma_flags</a>;
<a name="l00346"></a>00346         <span class="comment">/* record size for index file */</span>
<a name="l00347"></a><a class="code" href="structosd__object.html#a3be0b428e0ce77271dd61d03722fd448">00347</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            <a class="code" href="structosd__object.html#a3be0b428e0ce77271dd61d03722fd448">oo_keysize</a>;
<a name="l00348"></a><a class="code" href="structosd__object.html#a2a8155b93a002d14b4ad4e956c0a0236">00348</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            <a class="code" href="structosd__object.html#a2a8155b93a002d14b4ad4e956c0a0236">oo_recsize</a>;
<a name="l00349"></a><a class="code" href="structosd__object.html#a037046f73ccc73ab66e95fc1c9760bcd">00349</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>            <a class="code" href="structosd__object.html#a037046f73ccc73ab66e95fc1c9760bcd">oo_recusize</a>;   <span class="comment">/* unit size */</span>
<a name="l00350"></a>00350 };
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a0e4f6c907c6284be39139b21963e044c">osd_statfs</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *, <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *);
<a name="l00353"></a>00353 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae44c2ce6357b0f5ccb5abf0ef60d23ba" title="Quota/Accounting handling.">osd_acct_index_ops</a>;
<a name="l00354"></a>00354 uint64_t <a class="code" href="osd-zfs_2osd__internal_8h.html#a52fef34f90b0782384e3d9081685cb54" title="Helper function to retrieve DMU object id from fid for accounting object.">osd_quota_fid2dmu</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00355"></a>00355 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__device__operations.html" title="Operations common for data and meta-data devices.">lu_device_operations</a>  <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3d60ffc9efe910c72a37d09413b5c0d6">osd_lu_ops</a>;
<a name="l00356"></a>00356 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a> <a class="code" href="osd__index_8c.html#a53a41d5b9a7c6d05cf02b3cecd6ff1ad">osd_dir_ops</a>;
<a name="l00357"></a>00357 <span class="keywordtype">int</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#a39f3d9fe1d32f995bffdbd9e7fd01b6b" title="Quota Enforcement Management.">osd_declare_quota</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00358"></a>00358                       qid_t uid, qid_t gid, <span class="keywordtype">long</span> <span class="keywordtype">long</span> space,
<a name="l00359"></a>00359                       <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh, <span class="keywordtype">bool</span> is_blk, <span class="keywordtype">int</span> *flags,
<a name="l00360"></a>00360                       <span class="keywordtype">bool</span> force);
<a name="l00361"></a>00361 uint64_t <a class="code" href="osd-zfs_2osd__handler_8c.html#a970d74a38efaebb42e2f615a18ccadd3">osd_objs_count_estimate</a>(uint64_t refdbytes, uint64_t usedobjs,
<a name="l00362"></a>00362                                  uint64_t nrblocks, uint64_t est_maxblockshift);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">/*</span>
<a name="l00365"></a>00365 <span class="comment"> * Helpers.</span>
<a name="l00366"></a>00366 <span class="comment"> */</span>
<a name="l00367"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">00367</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369         <span class="keywordflow">return</span> <a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(d != NULL &amp;&amp; d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> != NULL, d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> == &amp;<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3d60ffc9efe910c72a37d09413b5c0d6">osd_lu_ops</a>);
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">00372</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">osd_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *o)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-zfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(o-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>));
<a name="l00375"></a>00375         <span class="keywordflow">return</span> container_of0(o, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a>, <a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">00378</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-zfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(&amp;d-&gt;<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>));
<a name="l00381"></a>00381         <span class="keywordflow">return</span> container_of0(d, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a>, <a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>);
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">00384</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">osd_dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-zfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(d));
<a name="l00387"></a>00387         <span class="keywordflow">return</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(container_of0(d, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a>, dd_lu_dev));
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ab117b086a8dae31a27429185840ed352">00390</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#ab117b086a8dae31a27429185840ed352">osd_dt_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392         <span class="keywordflow">return</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">osd_obj</a>(&amp;d-&gt;<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">00395</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">osd_obj2dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *o)
<a name="l00396"></a>00396 {
<a name="l00397"></a>00397         <span class="keywordflow">return</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">osd_dev</a>(o-&gt;<a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>);
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a7662499061cbf0295dfa08357a9978d2">00400</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#a7662499061cbf0295dfa08357a9978d2">osd2lu_dev</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402         <span class="keywordflow">return</span> &amp;osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>;
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ab9a043cfaded03d45a127777a2e05387">00405</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>objset * <a class="code" href="osd-zfs_2osd__internal_8h.html#ab9a043cfaded03d45a127777a2e05387">osd_dtobj2objset</a>(<span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407         <span class="keywordflow">return</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">osd_dev</a>(o-&gt;<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>)-&gt;<a class="code" href="structosd__device.html#aa5d14dd8e85e91041bdcbeeceda5f93e">od_os</a>;
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#acebe2b9786f3f47502c589cdd77ab724">00410</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abbced5c9baf2fd600200680e5cf6a491">osd_invariant</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj)
<a name="l00411"></a>00411 {
<a name="l00412"></a>00412         <span class="keywordflow">return</span> 1;
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aff0766e7327a833b33547927986f19f6">00415</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#aff0766e7327a833b33547927986f19f6">osd_object_invariant</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *l)
<a name="l00416"></a>00416 {
<a name="l00417"></a>00417         <span class="keywordflow">return</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abbced5c9baf2fd600200680e5cf6a491">osd_invariant</a>(<a class="code" href="osd-zfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">osd_obj</a>(l));
<a name="l00418"></a>00418 }
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ae1c9b0f9a7e8e8dca38c3a7e962922ca">00420</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structseq__server__site.html">seq_server_site</a> *<a class="code" href="osd-zfs_2osd__internal_8h.html#ae1c9b0f9a7e8e8dca38c3a7e962922ca">osd_seq_site</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422         <span class="keywordflow">return</span> osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>.<a class="code" href="structlu__device.html#aaa1ef1e1a330f307a9baf6e59fc9c39b" title="Stack this device belongs to.">ld_site</a>-&gt;<a class="code" href="structlu__site.html#ae7ef4565e0e4634a56ca97fbb552d271" title="XXX: a hack! fld has to find md_site via site, remove when possible.">ld_seq_site</a>;
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">00425</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">char</span> *<a class="code" href="osd-zfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427         <span class="keywordflow">return</span> osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>.<a class="code" href="structlu__device.html#af35351bd6a533fa48c8a0f0eda83172a">ld_obd</a>-&gt;<a class="code" href="structobd__device.html#a47f3a5a4e3b9ce7d39282c2aa1058985">obd_name</a>;
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span><span class="keyword">enum</span> {
<a name="l00432"></a>00432         LPROC_OSD_READ_BYTES = 0,
<a name="l00433"></a>00433         LPROC_OSD_WRITE_BYTES = 1,
<a name="l00434"></a>00434         LPROC_OSD_GET_PAGE = 2,
<a name="l00435"></a>00435         LPROC_OSD_NO_PAGE = 3,
<a name="l00436"></a>00436         LPROC_OSD_CACHE_ACCESS = 4,
<a name="l00437"></a>00437         LPROC_OSD_CACHE_HIT = 5,
<a name="l00438"></a>00438         LPROC_OSD_CACHE_MISS = 6,
<a name="l00439"></a>00439         LPROC_OSD_COPY_IO = 7,
<a name="l00440"></a>00440         LPROC_OSD_ZEROCOPY_IO = 8,
<a name="l00441"></a>00441         LPROC_OSD_TAIL_IO = 9,
<a name="l00442"></a>00442         LPROC_OSD_LAST,
<a name="l00443"></a>00443 };
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="osd-zfs_2osd__handler_8c.html#a0c0750ae8c2aacc51b5a118311cdb762">osd_zapit_cachep</a>;
<a name="l00446"></a>00446 <span class="comment">/* osd_lproc.c */</span>
<a name="l00447"></a>00447 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a> lprocfs_osd_obd_vars[];
<a name="l00448"></a>00448 
<a name="l00449"></a>00449 <span class="keywordtype">int</span> osd_procfs_init(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00450"></a>00450 <span class="keywordtype">int</span> osd_procfs_fini(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="comment">/* osd_object.c */</span>
<a name="l00453"></a>00453 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="osd__object_8c.html#ae1d37832feda79303d3a7a328a6f737a">osd_obj_tag</a>;
<a name="l00454"></a>00454 <span class="keywordtype">void</span> <a class="code" href="osd__object_8c.html#ae61b493a6c6623900cfebcbf1212fc4b">osd_object_sa_dirty_rele</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00455"></a>00455 <span class="keywordtype">int</span> <a class="code" href="osd__object_8c.html#a9f3b2d29481bbc5245c08cc99bbfb9f6">__osd_obj2dbuf</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, objset_t *os,
<a name="l00456"></a>00456                    uint64_t oid, dmu_buf_t **dbp);
<a name="l00457"></a>00457 <span class="keyword">struct </span><a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *<a class="code" href="osd__object_8c.html#abb472af541f96d0dbbd712e677896a42">osd_object_alloc</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00458"></a>00458                                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object__header.html" title="&amp;quot;Compound&amp;quot; object, consisting of multiple layers.">lu_object_header</a> *hdr,
<a name="l00459"></a>00459                                    <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d);
<a name="l00460"></a>00460 <span class="keywordtype">int</span> <a class="code" href="osd__object_8c.html#ae5e8b203c41b12ada0aed9b4133c643f">osd_object_sa_update</a>(<span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, sa_attr_type_t type,
<a name="l00461"></a>00461                          <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, uint32_t buflen, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00462"></a>00462 <span class="keywordtype">int</span> <a class="code" href="osd__object_8c.html#aff56f77cac089b1289f71a05ccff570e">__osd_zap_create</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00463"></a>00463                      dmu_buf_t **zap_dbp, dmu_tx_t *tx, <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *la,
<a name="l00464"></a>00464                      uint64_t parent, zap_flags_t flags);
<a name="l00465"></a>00465 <span class="keywordtype">int</span> <a class="code" href="osd__object_8c.html#a66a8fe55ba5eac9c3e462487b12ed09f">__osd_object_create</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00466"></a>00466                         dmu_buf_t **dbp, dmu_tx_t *tx, <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *la,
<a name="l00467"></a>00467                         uint64_t parent);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="comment">/* osd_oi.c */</span>
<a name="l00470"></a>00470 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__oi_8c.html#a0a5a8a27b6a2cff32988c270f760c123">osd_oi_init</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *o);
<a name="l00471"></a>00471 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__oi_8c.html#a07ec73eaf18108800ca42eb6efb4a24f">osd_oi_fini</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *o);
<a name="l00472"></a>00472 <span class="keywordtype">int</span> <a class="code" href="osd-zfs_2osd__oi_8c.html#afeba88aeceafe4a805579d5273529615">osd_fid_lookup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00473"></a>00473                    <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *, uint64_t *);
<a name="l00474"></a>00474 uint64_t <a class="code" href="osd-zfs_2osd__oi_8c.html#a83babfb3fe46485890080afde5369491">osd_get_name_n_idx</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00475"></a>00475                             <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keywordtype">char</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>);
<a name="l00476"></a>00476 <span class="keywordtype">int</span> <a class="code" href="osd-zfs_2osd__oi_8c.html#abad5ffee749e0d43c909fe67c18d5c7e">osd_options_init</a>(<span class="keywordtype">void</span>);
<a name="l00477"></a>00477 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af325e21d2afe14f3a1f4b73cc59c9569">osd_ost_seq_exists</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00478"></a>00478                        <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> seq);
<a name="l00479"></a>00479 <span class="comment">/* osd_index.c */</span>
<a name="l00480"></a>00480 <span class="keywordtype">int</span> <a class="code" href="osd__index_8c.html#a1c0ece33565b5bfcdbdf90525aaed0e6">osd_index_try</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00481"></a>00481                   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__index__features.html">dt_index_features</a> *feat);
<a name="l00482"></a>00482 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3f9dcf494255fd8bafc2a6b7f7235422">osd_fld_lookup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00483"></a>00483                    u64 seq, <span class="keyword">struct</span> <a class="code" href="structlu__seq__range.html" title="Describes a range of sequence, lsr_start is included but lsr_end is not in the range...">lu_seq_range</a> *range);
<a name="l00484"></a>00484 <span class="keywordtype">void</span> <a class="code" href="osd__index_8c.html#aece2d32d91b44e0378ddcba1adfaca22">osd_zap_cursor_init_serialized</a>(zap_cursor_t *zc, <span class="keyword">struct</span> objset *os,
<a name="l00485"></a>00485                                     uint64_t <span class="keywordtype">id</span>, uint64_t dirhash);
<a name="l00486"></a>00486 <span class="keywordtype">int</span> <a class="code" href="osd__index_8c.html#a9958a84d04e25370f92ce0148cc9c8f1">osd_zap_cursor_init</a>(zap_cursor_t **zc, <span class="keyword">struct</span> objset *os,
<a name="l00487"></a>00487                         uint64_t <span class="keywordtype">id</span>, uint64_t dirhash);
<a name="l00488"></a>00488 <span class="keywordtype">void</span> <a class="code" href="osd__index_8c.html#af9ebdadb91b03cdd3e6174726a2d0157">osd_zap_cursor_fini</a>(zap_cursor_t *zc);
<a name="l00489"></a>00489 uint64_t <a class="code" href="osd__index_8c.html#ad9580956e66179f70d1b020c2bd9ff65">osd_zap_cursor_serialize</a>(zap_cursor_t *zc);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">/* osd_xattr.c */</span>
<a name="l00492"></a>00492 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a36b58bf57d621d7679c96a79c8ee9161">__osd_xattr_load</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd, uint64_t dnode,
<a name="l00493"></a>00493                      nvlist_t **sa_xattr);
<a name="l00494"></a>00494 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#afa4d036c4d39d628a9a693f1b7ef13df">__osd_xattr_get_large</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00495"></a>00495                           uint64_t xattr, <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>,
<a name="l00496"></a>00496                           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> *sizep);
<a name="l00497"></a>00497 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a54fb26250a5fdc6e84790e672dbdf8f0">osd_xattr_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00498"></a>00498                   <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00499"></a>00499 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#af74f556ac395f12cfca4847bc7cb5dc9">osd_declare_xattr_set</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00500"></a>00500                           <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l00501"></a>00501                           <span class="keywordtype">int</span> fl, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *handle);
<a name="l00502"></a>00502 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#ae20d2ef69a12d676ce52a006c75e7f6c">osd_xattr_set</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00503"></a>00503                   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> fl,
<a name="l00504"></a>00504                   <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *handle);
<a name="l00505"></a>00505 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a161096359f400aa77c5f0d824d16e237">osd_declare_xattr_del</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00506"></a>00506                           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *handle);
<a name="l00507"></a>00507 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a8655cb987cc2b346c647e3238c7089f1">osd_xattr_del</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00508"></a>00508                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *handle);
<a name="l00509"></a>00509 <span class="keywordtype">void</span> <a class="code" href="osd__xattr_8c.html#ad159171313f6f7e1cc92c8302fd32b2b">osd_declare_xattrs_destroy</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00510"></a>00510                                 <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00511"></a>00511                                 <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00512"></a>00512 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#ac808951e0156adbe34f88bb92cf915eb">osd_xattrs_destroy</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00513"></a>00513                        <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00514"></a>00514 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a48102655f5d04db9bdc74623765f92b3">osd_xattr_list</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00515"></a>00515                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *lb);
<a name="l00516"></a>00516 <span class="keywordtype">void</span> <a class="code" href="osd__xattr_8c.html#a0e446af6a800c14a323c91b3c2a36758">__osd_xattr_declare_set</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00517"></a>00517                         <span class="keywordtype">int</span> vallen, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00518"></a>00518 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a9499a27c15735564e1ab24109f2bcab3">__osd_sa_xattr_set</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00519"></a>00519                        <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> fl,
<a name="l00520"></a>00520                        <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);;
<a name="l00521"></a>00521 <span class="keywordtype">int</span> <a class="code" href="osd__xattr_8c.html#a0fd9c97d8258dd4b2517f2471492f021">__osd_xattr_set</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00522"></a>00522                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> fl,
<a name="l00523"></a>00523                     <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00524"></a>00524 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00525"></a>00525 osd_xattr_set_internal(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00526"></a>00526                        <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> fl,
<a name="l00527"></a>00527                        <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529         <span class="keywordtype">int</span> rc;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!<a class="code" href="group__dt.html#ga5e0e64b326cce8eea978a82514f06799">dt_object_exists</a>(&amp;obj-&gt;<a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>) || obj-&gt;<a class="code" href="structosd__object.html#ae944579808f6846f17612eb34378abdf">oo_destroyed</a>))
<a name="l00532"></a>00532                 <span class="keywordflow">return</span> -ENOENT;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(obj-&gt;<a class="code" href="structosd__object.html#a69690a98abd452965d4c459feaf1b645">oo_db</a>);
<a name="l00535"></a>00535         <span class="keywordflow">if</span> (<a class="code" href="osd-zfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">osd_obj2dev</a>(obj)-&gt;od_xattr_in_sa) {
<a name="l00536"></a>00536                 rc = <a class="code" href="osd__xattr_8c.html#a9499a27c15735564e1ab24109f2bcab3">__osd_sa_xattr_set</a>(env, obj, buf, name, fl, oh);
<a name="l00537"></a>00537                 <span class="keywordflow">if</span> (rc == -EFBIG)
<a name="l00538"></a>00538                         rc = <a class="code" href="osd__xattr_8c.html#a0fd9c97d8258dd4b2517f2471492f021">__osd_xattr_set</a>(env, obj, buf, name, fl, oh);
<a name="l00539"></a>00539         } <span class="keywordflow">else</span> {
<a name="l00540"></a>00540                 rc = <a class="code" href="osd__xattr_8c.html#a0fd9c97d8258dd4b2517f2471492f021">__osd_xattr_set</a>(env, obj, buf, name, fl, oh);
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         <span class="keywordflow">return</span> rc;
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="keyword">static</span> <span class="keyword">inline</span> uint64_t attrs_fs2zfs(<span class="keyword">const</span> uint32_t flags)
<a name="l00547"></a>00547 {
<a name="l00548"></a>00548         <span class="keywordflow">return</span> (flags &amp; <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167baeebdea7ab741a68b3731337bf7d98048">LUSTRE_APPEND_FL</a>        ? ZFS_APPENDONLY        : 0) |
<a name="l00549"></a>00549                 (flags &amp; <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167ba06efcf7c29e9ec90b41de0fbc0634524">LUSTRE_NODUMP_FL</a>       ? ZFS_NODUMP            : 0) |
<a name="l00550"></a>00550                 (flags &amp; <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167ba67ea88400f67d1a6ebff0c771e06a1af">LUSTRE_IMMUTABLE_FL</a>    ? ZFS_IMMUTABLE         : 0);
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="keyword">static</span> <span class="keyword">inline</span> uint32_t attrs_zfs2fs(<span class="keyword">const</span> uint64_t flags)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555         <span class="keywordflow">return</span> (flags &amp; ZFS_APPENDONLY  ? <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167baeebdea7ab741a68b3731337bf7d98048">LUSTRE_APPEND_FL</a>      : 0) |
<a name="l00556"></a>00556                 (flags &amp; ZFS_NODUMP     ? <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167ba06efcf7c29e9ec90b41de0fbc0634524">LUSTRE_NODUMP_FL</a>      : 0) |
<a name="l00557"></a>00557                 (flags &amp; ZFS_IMMUTABLE  ? <a class="code" href="group__lustreidl.html#gga7ff5f2dff38e7639981794c43dc9167ba67ea88400f67d1a6ebff0c771e06a1af">LUSTRE_IMMUTABLE_FL</a>   : 0);
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="preprocessor">#endif</span>
<a name="l00561"></a>00561 <span class="preprocessor"></span>
<a name="l00562"></a>00562 <span class="preprocessor">#ifndef HAVE_DSL_POOL_CONFIG</span>
<a name="l00563"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a0b4f393aaccbe0638b1d0feb20db3b8e">00563</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#a0b4f393aaccbe0638b1d0feb20db3b8e">dsl_pool_config_enter</a>(dsl_pool_t *dp, <span class="keywordtype">char</span> *name)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a3618d1c516c2d2a9ee61a7a8ff5bfe87">00567</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-zfs_2osd__internal_8h.html#a3618d1c516c2d2a9ee61a7a8ff5bfe87">dsl_pool_config_exit</a>(dsl_pool_t *dp, <span class="keywordtype">char</span> *name)
<a name="l00568"></a>00568 {
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570 <span class="preprocessor">#endif</span>
<a name="l00571"></a>00571 <span class="preprocessor"></span>
<a name="l00572"></a>00572 <span class="preprocessor">#ifdef HAVE_SPA_MAXBLOCKSIZE</span>
<a name="l00573"></a>00573 <span class="preprocessor"></span><span class="preprocessor">#define osd_spa_maxblocksize(spa)       spa_maxblocksize(spa)</span>
<a name="l00574"></a>00574 <span class="preprocessor"></span><span class="preprocessor">#define osd_spa_maxblockshift(spa)      fls64(spa_maxblocksize(spa) - 1)</span>
<a name="l00575"></a>00575 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00576"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ac20e4ac8559d85c2737df2fbe20ec326">00576</a> <span class="preprocessor"></span><span class="preprocessor">#define osd_spa_maxblocksize(spa)       SPA_MAXBLOCKSIZE</span>
<a name="l00577"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#ac3c397a7aef16448ca38cbadc79d5ac1">00577</a> <span class="preprocessor"></span><span class="preprocessor">#define osd_spa_maxblockshift(spa)      SPA_MAXBLOCKSHIFT</span>
<a name="l00578"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aaa9070ec09b8707891b59d2f6cb62d56">00578</a> <span class="preprocessor"></span><span class="preprocessor">#define SPA_OLD_MAXBLOCKSIZE            SPA_MAXBLOCKSIZE</span>
<a name="l00579"></a>00579 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>
<a name="l00581"></a>00581 <span class="preprocessor">#ifdef HAVE_SA_SPILL_ALLOC</span>
<a name="l00582"></a>00582 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *
<a name="l00583"></a>00583 <a class="code" href="osd-zfs_2osd__internal_8h.html#a547568cfa908b67965c340c23ab3e93c">osd_zio_buf_alloc</a>(<span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00584"></a>00584 {
<a name="l00585"></a>00585         <span class="keywordflow">return</span> sa_spill_alloc(KM_SLEEP);
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00589"></a>00589 <a class="code" href="osd-zfs_2osd__internal_8h.html#aa71b32658daf173be2b035d8ec1dc6ba">osd_zio_buf_free</a>(<span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591         sa_spill_free(buf);
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 <span class="preprocessor">#else</span>
<a name="l00594"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#a547568cfa908b67965c340c23ab3e93c">00594</a> <span class="preprocessor"></span><span class="preprocessor">#define osd_zio_buf_alloc(size)         zio_buf_alloc(size)</span>
<a name="l00595"></a><a class="code" href="osd-zfs_2osd__internal_8h.html#aa71b32658daf173be2b035d8ec1dc6ba">00595</a> <span class="preprocessor"></span><span class="preprocessor">#define osd_zio_buf_free(buf, size)     zio_buf_free(buf, size)</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span>
<a name="l00598"></a>00598 <span class="preprocessor">#endif </span><span class="comment">/* _OSD_INTERNAL_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:41 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
