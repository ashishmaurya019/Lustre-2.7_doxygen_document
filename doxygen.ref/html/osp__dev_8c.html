<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/osp/osp_dev.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/osp/osp_dev.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__ioctl_8h_source.html">lustre_ioctl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__log_8h_source.html">lustre_log.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__obdo_8h_source.html">lustre_obdo.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__param_8h_source.html">lustre_param.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="osp__internal_8h_source.html">osp_internal.h</a>&quot;</code><br/>

<p><a href="osp__dev_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__object.html">lu_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a35165a9baeab355c0b31ae164f5cec90">osp_object_alloc</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *hdr, struct <a class="el" href="structlu__device.html">lu_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">lu_device_operations::ldo_object_alloc</a>.  <a href="#a35165a9baeab355c0b31ae164f5cec90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ae0b5071c8d52d6e9d6d5625453328012">osp_find_or_create_local_file</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structlu__attr.html">lu_attr</a> *attr, __u32 reg_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find or create the local object.  <a href="#ae0b5071c8d52d6e9d6d5625453328012"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a9ed9cff4820f30e8db2f93b01e593aa5">osp_write_local_file</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, struct <a class="el" href="structlu__buf.html">lu_buf</a> *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, loff_t offset)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write data buffer to a local file object.  <a href="#a9ed9cff4820f30e8db2f93b01e593aa5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a55252501a15f47081c4e466e0cfd12d8">osp_init_last_objid</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize last ID object.  <a href="#a55252501a15f47081c4e466e0cfd12d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a4739a9448c56dc423f214ed782b1fd93">osp_init_last_seq</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize last sequence object.  <a href="#a4739a9448c56dc423f214ed782b1fd93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a7339fcd0eadcea2eaa91bf79d501692c">osp_last_used_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize last OID and sequence object.  <a href="#a7339fcd0eadcea2eaa91bf79d501692c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ac83e63ec05d36bbd4b8237998d5d1078">osp_last_used_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release the last sequence and OID file objects in OSP device.  <a href="#ac83e63ec05d36bbd4b8237998d5d1078"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ab0e0ac81eb62b2819c127ceda60e192d">osp_disconnect</a> (struct <a class="el" href="structosp__device.html">osp_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disconnects the connection between OSP and its correspondent MDT or OST, and the import will be marked as inactive.  <a href="#ab0e0ac81eb62b2819c127ceda60e192d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a73eeea0d0e2aa7cf28f92292b38fd880">osp_update_init</a> (struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the osp_update structure in OSP device.  <a href="#a73eeea0d0e2aa7cf28f92292b38fd880"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#aaee5055775a8eb44746e060336eb72a6">osp_update_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finialize osp_update structure in OSP device.  <a href="#aaee5055775a8eb44746e060336eb72a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a14b95686e21b9f394fa1ace73e4c2833">osp_shutdown</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cleanup OSP, which includes disconnect import, cleanup unlink log, stop precreate threads etc.  <a href="#a14b95686e21b9f394fa1ace73e4c2833"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a4d01cbbba4cf9ae550a86ec2f9b9fe9e">osp_process_config</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *dev, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of osp_lu_ops::ldo_process_config.  <a href="#a4d01cbbba4cf9ae550a86ec2f9b9fe9e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a931c635c01b5d8fcd05cf33fca4c580f">osp_recovery_complete</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of osp_lu_ops::ldo_recovery_complete.  <a href="#a931c635c01b5d8fcd05cf33fca4c580f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a46e4b4fdd4588ebbe60257db66bd4e0c">osp_statfs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev, struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *sfs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_device_operations::dt_statfs</a>.  <a href="#a46e4b4fdd4588ebbe60257db66bd4e0c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a4037ad5aa28879256e2d9061ec8d8522">osp_sync_timeout</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a01744bbbd4b8491770f60ae55ae2efc4">osp_sync</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_device_operations::dt_sync</a>.  <a href="#a01744bbbd4b8491770f60ae55ae2efc4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ac948f8789ce063cb9ecf478bd82fb4c0">osp_connect_to_osd</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, const char *nextdev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connect OSP to local OSD.  <a href="#ac948f8789ce063cb9ecf478bd82fb4c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a9feb47aafe58ed4e598a32429768f1c5">osp_cancel_weight</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine if the lock needs to be cancelled.  <a href="#a9feb47aafe58ed4e598a32429768f1c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a89817df76a7d88faa384927a7b0739a1">osp_init0</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *ldt, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *cfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize OSP device according to the parameters in the configuration log <em>cfg</em>.  <a href="#a89817df76a7d88faa384927a7b0739a1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#af00a3788f7dd1e2df775810d0b830e03">osp_device_free</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *lu)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#a190c1198c588f2ed23ab58052f4001bf" title="Free device.">lu_device_type_operations::ldto_device_free</a>.  <a href="#af00a3788f7dd1e2df775810d0b830e03"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a63841b5d383836d9c48e4630421d0d79">osp_device_alloc</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *type, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#acc52dc96707f7a1e4fd5f44c6923e4c6" title="Allocate new device.">lu_device_type_operations::ldto_device_alloc</a>.  <a href="#a63841b5d383836d9c48e4630421d0d79"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ac0779f76ecfc5f2d4177db4f04083a83">osp_device_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *ld)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#a9195fd4ea14e00bbe2d9318d60694263" title="Finalize device.">lu_device_type_operations::ldto_device_fini</a>.  <a href="#ac0779f76ecfc5f2d4177db4f04083a83"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ad985591f693b85d81683db88e703576b">osp_reconnect</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *cluuid, struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *data, void *localdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a8239d39c9f687a6ee062fe6347b8a736">obd_ops::o_reconnect</a>.  <a href="#ad985591f693b85d81683db88e703576b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ac32d23fc462e5bfbec959a7feb5d0ea9">osp_obd_connect</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> **exp, struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *cluuid, struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *data, void *localdata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#af43e6210aedbb756516b2bd75e112ed9">osp_obd_disconnect</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a1dfbddccaf8e568c531a466861c7df0b">obd_ops::o_disconnect</a>.  <a href="#af43e6210aedbb756516b2bd75e112ed9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a6ab2de1414ffc513bd65c5e1cc028c5e">osp_obd_statfs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *osfs, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> unused, __u32 flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a3290ce3a9029a8715d49b42778683c7a">obd_ops::o_statfs</a>.  <a href="#a6ab2de1414ffc513bd65c5e1cc028c5e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ad4f7c786a52c022460228edd95dda493">osp_import_event</a> (struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__import.html">obd_import</a> *imp, enum <a class="el" href="group__export.html#ga25e24f2ae3efcc8caa89c9e6c4c47d31">obd_import_event</a> event)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a1f41b3bcd92eedc56d4ed72f50d02c04">obd_ops::o_import_event</a>.  <a href="#ad4f7c786a52c022460228edd95dda493"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a07949c248ea1ccfaee54f1ea6aab2db5">osp_iocontrol</a> (unsigned int <a class="el" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, int len, void *karg, void __user *uarg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html">obd_ops</a>: o_iocontrol.  <a href="#a07949c248ea1ccfaee54f1ea6aab2db5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a3d2358e482381be0554d094d598a0034">osp_obd_get_info</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, __u32 keylen, void *key, __u32 *vallen, void *val)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a5b1e6cee59585a39cf3a4c75d5b3fbd7">obd_ops::o_get_info</a>.  <a href="#a3d2358e482381be0554d094d598a0034"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a32ba37f83f8744618e68591b9b3ba4ce">osp_obd_set_info_async</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, u32 keylen, void *key, u32 vallen, void *val, struct <a class="el" href="structptlrpc__request__set.html">ptlrpc_request_set</a> *set)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a45df324b07fdccea3d8dd1a69b6c0dce">osp_fid_alloc</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, struct <a class="el" href="structmd__op__data.html">md_op_data</a> *unused)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html">obd_ops</a>: o_fid_alloc.  <a href="#a45df324b07fdccea3d8dd1a69b6c0dce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a4b6003d436deee4f37b013f741824064">LU_KEY_INIT_FINI</a> (osp, struct <a class="el" href="structosp__thread__info.html">osp_thread_info</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a4f2d50979ff1f27f1d9ca475a71e70aa">osp_key_exit</a> (const struct <a class="el" href="structlu__context.html">lu_context</a> *ctx, struct <a class="el" href="structlu__context__key.html">lu_context_key</a> *key, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a76fad0840b24fe0e9af8fc4938fd84c9">LU_KEY_INIT_FINI</a> (osp_txn, struct <a class="el" href="structosp__txn__info.html">osp_txn_info</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a97581808a61c6abdea509d437f59e8d2">LU_TYPE_INIT_FINI</a> (osp,&amp;<a class="el" href="osp__internal_8h.html#ad3c37ca09ea52b0ec6f6c77e71a8d18e">osp_thread_key</a>,&amp;<a class="el" href="osp__internal_8h.html#a6f9defa450c24f77e303a32d1834e142">osp_txn_key</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int __init&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a48c263eb3ac91b11ee41f15df0944692">osp_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize OSP module.  <a href="#a48c263eb3ac91b11ee41f15df0944692"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void __exit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ae9aa103541d52c14166d2a7b7ffef6a5">osp_exit</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalize OSP module.  <a href="#ae9aa103541d52c14166d2a7b7ffef6a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#adc10f40acba3bb9b2640e985276b0a7c">MODULE_AUTHOR</a> (&quot;OpenSFS, Inc. &lt;http://www.lustre.org/&gt;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ac9e390a10c4340dd2f9c7f52c1b80526">MODULE_DESCRIPTION</a> (&quot;Lustre OSD Storage Proxy (&quot;LUSTRE_OSP_NAME&quot;)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ae9c321be2136fb8501887ee69dac11a2">MODULE_VERSION</a> (LUSTRE_VERSION_STRING)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ad94b36675e7eb067ea3ce6ff9e244a44">MODULE_LICENSE</a> (&quot;GPL&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a0f2055fd02ad6f5ed0a30d96e0b1e604">module_init</a> (osp_init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a60b8e0e78d1b166ca94c8938e7014ed3">module_exit</a> (osp_exit)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct kmem_cache *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a5ba0c65d48df6137aa2c1c66354fa0e1">osp_object_kmem</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__kmem__descr.html">lu_kmem_descr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a51d21a1c53c92944bcb1c72a9e7e5ff9">osp_caches</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__device__operations.html">lu_device_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a9e545f9a09277a5db32dcc53f3ae6484">osp_lu_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdt__device__operations.html">dt_device_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a037aa9290c964160d0fa3173b14e9415">osp_dt_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__context__key.html">lu_context_key</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ad3c37ca09ea52b0ec6f6c77e71a8d18e">osp_thread_key</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__context__key.html">lu_context_key</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a6f9defa450c24f77e303a32d1834e142">osp_txn_key</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structlu__device__type__operations.html">lu_device_type_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#afc41eb26033eedcca5f4b70ca99fd274">osp_device_type_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device__type.html">lu_device_type</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#ad8b908db28ab7285c6f990ab7e857c46">osp_device_type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structobd__ops.html">obd_ops</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a5093a3beae861223299799e1f3653e67">osp_obd_device_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structllog__operations.html">llog_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__dev_8c.html#a242e4f041ab0c6d014f218b12aec9622">osp_mds_ost_orig_logops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="osp_dev.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00075">75</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a76fad0840b24fe0e9af8fc4938fd84c9"></a><!-- doxytag: member="osp_dev.c::LU_KEY_INIT_FINI" ref="a76fad0840b24fe0e9af8fc4938fd84c9" args="(osp_txn, struct osp_txn_info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_KEY_INIT_FINI </td>
          <td>(</td>
          <td class="paramtype">osp_txn&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__txn__info.html">osp_txn_info</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4b6003d436deee4f37b013f741824064"></a><!-- doxytag: member="osp_dev.c::LU_KEY_INIT_FINI" ref="a4b6003d436deee4f37b013f741824064" args="(osp, struct osp_thread_info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_KEY_INIT_FINI </td>
          <td>(</td>
          <td class="paramtype">osp&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__thread__info.html">osp_thread_info</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a97581808a61c6abdea509d437f59e8d2"></a><!-- doxytag: member="osp_dev.c::LU_TYPE_INIT_FINI" ref="a97581808a61c6abdea509d437f59e8d2" args="(osp,&amp;osp_thread_key,&amp;osp_txn_key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_TYPE_INIT_FINI </td>
          <td>(</td>
          <td class="paramtype">osp&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&nbsp;</td>
          <td class="paramname"> <em>osp_thread_key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&nbsp;</td>
          <td class="paramname"> <em>osp_txn_key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="adc10f40acba3bb9b2640e985276b0a7c"></a><!-- doxytag: member="osp_dev.c::MODULE_AUTHOR" ref="adc10f40acba3bb9b2640e985276b0a7c" args="(&quot;OpenSFS, Inc. &lt;http://www.lustre.org/&gt;&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_AUTHOR </td>
          <td>(</td>
          <td class="paramtype">&quot;&nbsp;</td>
          <td class="paramname"> <em>OpenSFS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Inc.&lt; http://www.lustre.org/&gt;&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac9e390a10c4340dd2f9c7f52c1b80526"></a><!-- doxytag: member="osp_dev.c::MODULE_DESCRIPTION" ref="ac9e390a10c4340dd2f9c7f52c1b80526" args="(&quot;Lustre OSD Storage Proxy (&quot;LUSTRE_OSP_NAME&quot;)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_DESCRIPTION </td>
          <td>(</td>
          <td class="paramtype">&quot;Lustre OSD Storage Proxy (&quot;LUSTRE_OSP_NAME&quot;)&quot;&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a60b8e0e78d1b166ca94c8938e7014ed3"></a><!-- doxytag: member="osp_dev.c::module_exit" ref="a60b8e0e78d1b166ca94c8938e7014ed3" args="(osp_exit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_exit </td>
          <td>(</td>
          <td class="paramtype">osp_exit&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0f2055fd02ad6f5ed0a30d96e0b1e604"></a><!-- doxytag: member="osp_dev.c::module_init" ref="a0f2055fd02ad6f5ed0a30d96e0b1e604" args="(osp_init)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_init </td>
          <td>(</td>
          <td class="paramtype">osp_init&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad94b36675e7eb067ea3ce6ff9e244a44"></a><!-- doxytag: member="osp_dev.c::MODULE_LICENSE" ref="ad94b36675e7eb067ea3ce6ff9e244a44" args="(&quot;GPL&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_LICENSE </td>
          <td>(</td>
          <td class="paramtype">&quot;GPL&quot;&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae9c321be2136fb8501887ee69dac11a2"></a><!-- doxytag: member="osp_dev.c::MODULE_VERSION" ref="ae9c321be2136fb8501887ee69dac11a2" args="(LUSTRE_VERSION_STRING)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_VERSION </td>
          <td>(</td>
          <td class="paramtype">LUSTRE_VERSION_STRING&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9feb47aafe58ed4e598a32429768f1c5"></a><!-- doxytag: member="osp_dev.c::osp_cancel_weight" ref="a9feb47aafe58ed4e598a32429768f1c5" args="(struct ldlm_lock *lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_cancel_weight </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine if the lock needs to be cancelled. </p>
<p>Determine if the unused lock should be cancelled before replay, see (<a class="el" href="ldlm__request_8c.html#a9c4ba06316a0cc99bf5091fe2d2fdd2e" title="Cancel as many locks as possible w/o sending any RPCs (e.g.">ldlm_cancel_no_wait_policy()</a>). Currently, only inode bits lock exists between MDTs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lock</em>&nbsp;</td><td>lock to be checked.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if the lock needs to be cancelled before replay. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the lock does not need to be cancelled before replay. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00963">963</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="lustre__dlm_8h_source.html#l00694">ldlm_lock::l_resource</a>, <a class="el" href="packet-lustre_8c_source.html#l00301">LDLM_IBITS</a>, <a class="el" href="lustre__dlm_8h_source.html#l00970">ldlm_resource::lr_type</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="ac948f8789ce063cb9ecf478bd82fb4c0"></a><!-- doxytag: member="osp_dev.c::osp_connect_to_osd" ref="ac948f8789ce063cb9ecf478bd82fb4c0" args="(const struct lu_env *env, struct osp_device *osp, const char *nextdev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_connect_to_osd </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nextdev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connect OSP to local OSD. </p>
<p>Locate the local OSD referenced by <em>nextdev</em> and connect to it. Sometimes, OSP needs to access the local OSD to store some information. For example, during precreate, it needs to update last used OID and sequence file (LAST_SEQ) in local OSD.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nextdev</em>&nbsp;</td><td>the name of local OSD</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 connection succeeded </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno connection failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00910">910</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__class_8h_source.html#l00796">obd_connect()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00598">obd_device::obd_uuid</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00148">osp_device::opd_storage</a>, <a class="el" href="osp__internal_8h_source.html#l00147">osp_device::opd_storage_exp</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a63841b5d383836d9c48e4630421d0d79"></a><!-- doxytag: member="osp_dev.c::osp_device_alloc" ref="a63841b5d383836d9c48e4630421d0d79" args="(const struct lu_env *env, struct lu_device_type *type, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a>* osp_device_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#acc52dc96707f7a1e4fd5f44c6923e4c6" title="Allocate new device.">lu_device_type_operations::ldto_device_alloc</a>. </p>
<p>This function allocates and initializes OSP device in memory according to the config log.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>device type of OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lcfg</em>&nbsp;</td><td>config log</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>the pointer of allocated OSP if succeed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>ERR_PTR(errno) if failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01283">1283</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00157">dt_device_init()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00449">osp2lu_dev()</a>, <a class="el" href="osp__dev_8c_source.html#l01255">osp_device_free()</a>, and <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0779f76ecfc5f2d4177db4f04083a83"></a><!-- doxytag: member="osp_dev.c::osp_device_fini" ref="ac0779f76ecfc5f2d4177db4f04083a83" args="(const struct lu_env *env, struct lu_device *ld)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a>* osp_device_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ld</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#a9195fd4ea14e00bbe2d9318d60694263" title="Finalize device.">lu_device_type_operations::ldto_device_fini</a>. </p>
<p>This function cleans up the OSP device, i.e. release and free those attached items in <a class="el" href="structosp__device.html">osp_device</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ld</em>&nbsp;</td><td><a class="el" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> of OSP</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>NULL if cleanup succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>ERR_PTR(errno) if cleanup failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01319">1319</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00292">client_obd::cl_rpc_lock</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="ldlm__lib_8c_source.html#l00504">client_obd_cleanup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lprocfs__status_8h_source.html#l00959">lprocfs_obd_cleanup()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00952">lprocfs_remove()</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00247">osp_device::opd_async_requests</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00147">osp_device::opd_storage_exp</a>, <a class="el" href="osp__internal_8h_source.html#l00240">osp_device::opd_symlink</a>, <a class="el" href="osp__trans_8c_source.html#l00204">osp_update_request_destroy()</a>, <a class="el" href="lustre__net_8h_source.html#l02661">ptlrpc_lprocfs_unregister_obd()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00971">ptlrpcd_decref()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="af00a3788f7dd1e2df775810d0b830e03"></a><!-- doxytag: member="osp_dev.c::osp_device_free" ref="af00a3788f7dd1e2df775810d0b830e03" args="(const struct lu_env *env, struct lu_device *lu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a>* osp_device_free </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#a190c1198c588f2ed23ab58052f4001bf" title="Free device.">lu_device_type_operations::ldto_device_free</a>. </p>
<p>Free the OSP device in memory. No return value is needed for now, so always return NULL to comply with the interface.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lu</em>&nbsp;</td><td><a class="el" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> of OSP</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>NULL unconditionally </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01255">1255</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="dt__object_8c_source.html#l00164">dt_device_fini()</a>, <a class="el" href="lu__object_8h_source.html#l00271">lu_device::ld_ref</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="libcfs__debug_8h_source.html#l00201">LIBCFS_DEBUG_MSG_DATA_DECL</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="lu__object_8c_source.html#l00491">lu_cdebug_printer()</a>, <a class="el" href="lu__object_8c_source.html#l00905">lu_site_print()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l01283">osp_device_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0e0ac81eb62b2819c127ceda60e192d"></a><!-- doxytag: member="osp_dev.c::osp_disconnect" ref="ab0e0ac81eb62b2819c127ceda60e192d" args="(struct osp_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Disconnects the connection between OSP and its correspondent MDT or OST, and the import will be marked as inactive. </p>
<p>It will only be called during OSP cleanup process.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>OSP device being disconnected</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if disconnection succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if disconnection failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00456">456</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_deactive</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="import_8c_source.html#l00233">ptlrpc_deactivate_import()</a>, <a class="el" href="import_8c_source.html#l01550">ptlrpc_disconnect_import()</a>, <a class="el" href="import_8c_source.html#l00286">ptlrpc_invalidate_import()</a>, <a class="el" href="pinger_8c_source.html#l00428">ptlrpc_pinger_del_import()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00626">osp_process_config()</a>, and <a class="el" href="osp__dev_8c_source.html#l00587">osp_shutdown()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9aa103541d52c14166d2a7b7ffef6a5"></a><!-- doxytag: member="osp_dev.c::osp_exit" ref="ae9aa103541d52c14166d2a7b7ffef6a5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __exit osp_exit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finalize OSP module. </p>
<p>This callback is called when kernel unloads OSP module from memory, and it will deregister OSP and LWP device type from obd_types (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="class__obd_8c.html">class_obd.c</a>). </dd></dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01966">1966</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="genops_8c_source.html#l00246">class_unregister_type()</a>, <a class="el" href="lu__object_8c_source.html#l02275">lu_kmem_fini()</a>, <a class="el" href="obd_8h_source.html#l00454">LUSTRE_LWP_NAME</a>, and <a class="el" href="obd_8h_source.html#l00453">LUSTRE_OSP_NAME</a>.</p>

</div>
</div>
<a class="anchor" id="a45df324b07fdccea3d8dd1a69b6c0dce"></a><!-- doxytag: member="osp_dev.c::osp_fid_alloc" ref="a45df324b07fdccea3d8dd1a69b6c0dce" args="(const struct lu_env *env, struct obd_export *exp, struct lu_fid *fid, struct md_op_data *unused)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_fid_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmd__op__data.html">md_op_data</a> *&nbsp;</td>
          <td class="paramname"> <em>unused</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html">obd_ops</a>: o_fid_alloc. </p>
<p>Allocate a FID. There are two cases in which OSP performs FID allocation.</p>
<p>1. FID precreation for data objects, which is done in <a class="el" href="osp__precreate_8c.html#ab4a563fd2211ea086091c9c282167503" title="Find IDs available in current sequence.">osp_precreate_fids()</a> instead of this function. 2. FID allocation for each sub-stripe of a striped directory. Similar to other FID clients, OSP requests the sequence from its corresponding remote MDT, which in turn requests sequences from the sequence controller (MDT0).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export of the OSP </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID being allocated </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>unused</em>&nbsp;</td><td>necessary for the interface but unused.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 FID allocated successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>1 FID allocated successfully and new sequence requested from seq meta server </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if FID allocation failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01821">1821</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00322">client_obd::cl_seq</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__fid_8h_source.html#l00353">lu_client_seq::lcs_exp</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="fid__request_8c_source.html#l00320">seq_client_alloc_fid()</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="ae0b5071c8d52d6e9d6d5625453328012"></a><!-- doxytag: member="osp_dev.c::osp_find_or_create_local_file" ref="ae0b5071c8d52d6e9d6d5625453328012" args="(const struct lu_env *env, struct osp_device *osp, struct lu_attr *attr, __u32 reg_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdt__object.html">dt_object</a>* osp_find_or_create_local_file </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>reg_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find or create the local object. </p>
<p>Finds or creates the local file referenced by <em>reg_id</em> and return the attributes of the local file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>attr</em>&nbsp;</td><td>attributes of the object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>reg_id</em>&nbsp;</td><td>the local object ID of the file. It will be used to compose a local FID{FID_SEQ_LOCAL_FILE, reg_id, 0} to identify the object.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>object</em>&nbsp;</td><td>object(dt_object) found or created </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>ERR_PTR(errno) if not get the object. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00166">166</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l00381">DFT_REGULAR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8c_source.html#l00388">dt_find_or_create()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lustre__fid_8h_source.html#l00242">lu_local_obj_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00148">osp_device::opd_storage</a>, <a class="el" href="osp__internal_8h_source.html#l00312">osp_thread_info::osi_fid</a>, <a class="el" href="osp__internal_8h_source.html#l00409">osp_env_info()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00249">osp_init_last_objid()</a>, and <a class="el" href="osp__dev_8c_source.html#l00306">osp_init_last_seq()</a>.</p>

</div>
</div>
<a class="anchor" id="ad4f7c786a52c022460228edd95dda493"></a><!-- doxytag: member="osp_dev.c::osp_import_event" ref="ad4f7c786a52c022460228edd95dda493" args="(struct obd_device *obd, struct obd_import *imp, enum obd_import_event event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_import_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__export.html#ga25e24f2ae3efcc8caa89c9e6c4c47d31">obd_import_event</a>&nbsp;</td>
          <td class="paramname"> <em>event</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a1f41b3bcd92eedc56d4ed72f50d02c04">obd_ops::o_import_event</a>. </p>
<p>This function is called when some related import event happens. It will mark the necessary flags according to the event and notify the necessary threads (mainly precreate thread).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obd</em>&nbsp;</td><td>OSP OBD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>imp</em>&nbsp;</td><td>import attached from OSP to remote (OST/MDT) service </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>event</em>&nbsp;</td><td>event related to remote service (IMP_EVENT_*)</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if the event handling succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if the event handling failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01574">1574</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="osp__sync_8c_source.html#l00236">__osp_sync_check_for_work()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__import_8h_source.html#l00133">IMP_EVENT_ACTIVATE</a>, <a class="el" href="lustre__import_8h_source.html#l00130">IMP_EVENT_ACTIVE</a>, <a class="el" href="lustre__import_8h_source.html#l00132">IMP_EVENT_DEACTIVATE</a>, <a class="el" href="lustre__import_8h_source.html#l00127">IMP_EVENT_DISCON</a>, <a class="el" href="lustre__import_8h_source.html#l00128">IMP_EVENT_INACTIVE</a>, <a class="el" href="lustre__import_8h_source.html#l00129">IMP_EVENT_INVALIDATE</a>, <a class="el" href="lustre__import_8h_source.html#l00131">IMP_EVENT_OCD</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00191">LDLM_FL_LOCAL_ONLY</a>, <a class="el" href="ldlm__resource_8c_source.html#l00892">ldlm_namespace_cleanup()</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_inactive</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_got_disconnected</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_active</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_connected</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_seen_connected</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_new_connection</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00179">osp_device::opd_pre</a>, <a class="el" href="osp__internal_8h_source.html#l00183">osp_device::opd_pre_waitq</a>, <a class="el" href="osp__trans_8c_source.html#l01354">osp_invalidate_request()</a>, and <a class="el" href="osp__precreate_8c_source.html#l00948">osp_pre_update_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a48c263eb3ac91b11ee41f15df0944692"></a><!-- doxytag: member="osp_dev.c::osp_init" ref="a48c263eb3ac91b11ee41f15df0944692" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __init osp_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize OSP module. </p>
<p>Register device types OSP and Light Weight Proxy (LWP) (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="lwp__dev_8c.html">lwp_dev.c</a>) in <a class="el" href="class__obd_8c.html#ae8a5565221053b29d97f7a4f7f071e21">obd_types</a> (</dd>
<dd>
<a class="el" href="class__obd_8c.html">class_obd.c</a>). Initialize procfs for the the OSP device. Note: OSP was called OSC before Lustre 2.4, so for compatibility it still uses the <a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> "osc" in procfs. This is called at module load time.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if initialization succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if initialization failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01914">1914</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00167">class_register_type()</a>, <a class="el" href="genops_8c_source.html#l00103">class_search_type()</a>, <a class="el" href="genops_8c_source.html#l00246">class_unregister_type()</a>, <a class="el" href="llog__cat_8c_source.html#l00425">llog_cat_add_rec()</a>, <a class="el" href="llog__cat_8c_source.html#l00479">llog_cat_declare_add_rec()</a>, <a class="el" href="llog__osd_8c_source.html#l01854">llog_osd_ops</a>, <a class="el" href="structllog__operations.html#ab49da4026ce87fc82e994ee69ba3d811">llog_operations::lop_add</a>, <a class="el" href="structllog__operations.html#a8d45958b3740ebc3a1e5316abaf002c7">llog_operations::lop_declare_add</a>, <a class="el" href="lprocfs__status_8h_source.html#l00949">lprocfs_register()</a>, <a class="el" href="lu__object_8c_source.html#l02275">lu_kmem_fini()</a>, <a class="el" href="lu__object_8c_source.html#l02251">lu_kmem_init()</a>, <a class="el" href="obd_8h_source.html#l00454">LUSTRE_LWP_NAME</a>, <a class="el" href="obd_8h_source.html#l00463">LUSTRE_OSC_NAME</a>, <a class="el" href="obd_8h_source.html#l00453">LUSTRE_OSP_NAME</a>, <a class="el" href="lwp__dev_8c_source.html#l00395">lwp_device_type</a>, <a class="el" href="lwp__dev_8c_source.html#l00621">lwp_obd_device_ops</a>, <a class="el" href="osp__dev_8c_source.html#l01900">osp_mds_ost_orig_logops</a>, <a class="el" href="lprocfs__status_8h_source.html#l00864">proc_lustre_root</a>, <a class="el" href="obd_8h_source.html#l00108">obd_type::typ_procroot</a>, and <a class="el" href="obd_8h_source.html#l00109">obd_type::typ_procsym</a>.</p>

</div>
</div>
<a class="anchor" id="a89817df76a7d88faa384927a7b0739a1"></a><!-- doxytag: member="osp_dev.c::osp_init0" ref="a89817df76a7d88faa384927a7b0739a1" args="(const struct lu_env *env, struct osp_device *osp, struct lu_device_type *ldt, struct lustre_cfg *cfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_init0 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *&nbsp;</td>
          <td class="paramname"> <em>ldt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize OSP device according to the parameters in the configuration log <em>cfg</em>. </p>
<p>Reconstruct the local device name from the configuration profile, and initialize necessary threads and structures according to the OSP type (MDT or OST).</p>
<p>Since there is no record in the MDT configuration for the local disk device, we have to extract this from elsewhere in the profile. The only information we get at setup is from the OSC records: setup 0:{fsname}-OSTxxxx-osc[-MDTxxxx] 1:lustre-OST0000_UUID 2:NID</p>
<p>Note: configs generated by Lustre 1.8 are missing the -MDTxxxx part, so, we need to reconstruct the name of the underlying OSD from this: {fsname}-{svname}-osd, for example "lustre-MDT0000-osd".</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ldt</em>&nbsp;</td><td>lu device type of OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cfg</em>&nbsp;</td><td>configuration log</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if OSP initialization succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if OSP initialization failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00996">996</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00292">client_obd::cl_rpc_lock</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="uuid_8c_source.html#l00070">class_uuid_unparse()</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="ldlm__lib_8c_source.html#l00504">client_obd_cleanup()</a>, <a class="el" href="ldlm__lib_8c_source.html#l00261">client_obd_setup()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8h_source.html#l01724">dt_device::dd_ops</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="obd__class_8h_source.html#l01712">ll_generate_random_uuid</a>, <a class="el" href="lprocfs__status_8h_source.html#l00959">lprocfs_obd_cleanup()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00952">lprocfs_remove()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="lustre__fid_8h_source.html#l00340">LUSTRE_SEQ_DATA</a>, <a class="el" href="lustre__fid_8h_source.html#l00339">LUSTRE_SEQ_METADATA</a>, <a class="el" href="lustre__user_8h_source.html#l00316">MAX_OBD_NAME</a>, <a class="el" href="lustre__idl_8h_source.html#l02959">MTI_NAME_MAXLEN</a>, <a class="el" href="lustre__dlm_8h_source.html#l00559">ns_register_cancel()</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd__class_8h_source.html#l00867">obd_fid_fini()</a>, <a class="el" href="obd__class_8h_source.html#l00854">obd_fid_init()</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="osp__internal_8h_source.html#l00249">osp_device::opd_async_requests_mutex</a>, <a class="el" href="osp__internal_8h_source.html#l00250">osp_device::opd_async_updates</a>, <a class="el" href="osp__internal_8h_source.html#l00252">osp_device::opd_async_updates_count</a>, <a class="el" href="osp__internal_8h_source.html#l00251">osp_device::opd_async_updates_rwsem</a>, <a class="el" href="osp__internal_8h_source.html#l00161">osp_device::opd_cluuid</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00145">osp_device::opd_group</a>, <a class="el" href="osp__internal_8h_source.html#l00141">osp_device::opd_index</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00147">osp_device::opd_storage_exp</a>, <a class="el" href="osp__internal_8h_source.html#l00240">osp_device::opd_symlink</a>, <a class="el" href="osp__dev_8c_source.html#l00963">osp_cancel_weight()</a>, <a class="el" href="osp__dev_8c_source.html#l00910">osp_connect_to_osd()</a>, <a class="el" href="osp__precreate_8c_source.html#l01531">osp_init_precreate()</a>, <a class="el" href="osp__internal_8h_source.html#l00493">osp_init_rpc_lock</a>, <a class="el" href="osp__dev_8c_source.html#l00432">osp_last_used_fini()</a>, <a class="el" href="osp__dev_8c_source.html#l00362">osp_last_used_init()</a>, <a class="el" href="osp__internal_8h.html#a3b8512ad4175b3e0e2b52a1ff8f6d1ec">osp_lprocfs_init()</a>, <a class="el" href="osp__precreate_8c_source.html#l01596">osp_precreate_fini()</a>, <a class="el" href="osp__sync_8c_source.html#l01444">osp_sync_fini()</a>, <a class="el" href="osp__sync_8c_source.html#l01381">osp_sync_init()</a>, <a class="el" href="osp__dev_8c_source.html#l00546">osp_update_fini()</a>, <a class="el" href="osp__dev_8c_source.html#l00498">osp_update_init()</a>, <a class="el" href="import_8c_source.html#l00123">ptlrpc_init_import()</a>, <a class="el" href="lustre__net_8h_source.html#l02661">ptlrpc_lprocfs_unregister_obd()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00955">ptlrpcd_addref()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00971">ptlrpcd_decref()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>, and <a class="el" href="llog__test_8c_source.html#l00057">uuid</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l01283">osp_device_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="a55252501a15f47081c4e466e0cfd12d8"></a><!-- doxytag: member="osp_dev.c::osp_init_last_objid" ref="a55252501a15f47081c4e466e0cfd12d8" args="(const struct lu_env *env, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_init_last_objid </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize last ID object. </p>
<p>This function initializes the LAST_ID file, which stores the current last used id of data objects. The MDT will use the last used id and the last_seq (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="osp__dev_8c.html#a4739a9448c56dc423f214ed782b1fd93" title="Initialize last sequence object.">osp_init_last_seq()</a>) to synchronize the precreate object cache with OSTs.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if initialization succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if initialization failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00249">249</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8c_source.html#l00490">dt_record_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__fid_8h_source.html#l00218">MDD_LOV_OBJ_OID</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00141">osp_device::opd_index</a>, <a class="el" href="osp__internal_8h_source.html#l00155">osp_device::opd_last_used_fid</a>, <a class="el" href="osp__internal_8h_source.html#l00149">osp_device::opd_last_used_oid_file</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00313">osp_thread_info::osi_attr</a>, <a class="el" href="osp__internal_8h_source.html#l00316">osp_thread_info::osi_id</a>, <a class="el" href="osp__internal_8h_source.html#l00310">osp_thread_info::osi_lb</a>, <a class="el" href="osp__internal_8h_source.html#l00317">osp_thread_info::osi_off</a>, <a class="el" href="osp__internal_8h_source.html#l00409">osp_env_info()</a>, <a class="el" href="osp__dev_8c_source.html#l00166">osp_find_or_create_local_file()</a>, <a class="el" href="osp__internal_8h_source.html#l00383">osp_objid_buf_prep()</a>, <a class="el" href="osp__dev_8c_source.html#l00209">osp_write_local_file()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00362">osp_last_used_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a4739a9448c56dc423f214ed782b1fd93"></a><!-- doxytag: member="osp_dev.c::osp_init_last_seq" ref="a4739a9448c56dc423f214ed782b1fd93" args="(const struct lu_env *env, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_init_last_seq </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize last sequence object. </p>
<p>This function initializes the LAST_SEQ file in the local OSD, which stores the current last used sequence of data objects. The MDT will use the last sequence and last id (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="osp__dev_8c.html#a55252501a15f47081c4e466e0cfd12d8" title="Initialize last ID object.">osp_init_last_objid()</a>) to synchronize the precreate object cache with OSTs.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if initialization succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if initialization failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00306">306</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8c_source.html#l00490">dt_record_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__fid_8h_source.html#l00233">MDD_LOV_OBJ_OSEQ</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00141">osp_device::opd_index</a>, <a class="el" href="osp__internal_8h_source.html#l00155">osp_device::opd_last_used_fid</a>, <a class="el" href="osp__internal_8h_source.html#l00150">osp_device::opd_last_used_seq_file</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00313">osp_thread_info::osi_attr</a>, <a class="el" href="osp__internal_8h_source.html#l00316">osp_thread_info::osi_id</a>, <a class="el" href="osp__internal_8h_source.html#l00310">osp_thread_info::osi_lb</a>, <a class="el" href="osp__internal_8h_source.html#l00317">osp_thread_info::osi_off</a>, <a class="el" href="osp__internal_8h_source.html#l00409">osp_env_info()</a>, <a class="el" href="osp__dev_8c_source.html#l00166">osp_find_or_create_local_file()</a>, <a class="el" href="osp__internal_8h_source.html#l00393">osp_objseq_buf_prep()</a>, <a class="el" href="osp__dev_8c_source.html#l00209">osp_write_local_file()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00362">osp_last_used_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a07949c248ea1ccfaee54f1ea6aab2db5"></a><!-- doxytag: member="osp_dev.c::osp_iocontrol" ref="a07949c248ea1ccfaee54f1ea6aab2db5" args="(unsigned int cmd, struct obd_export *exp, int len, void *karg, void __user *uarg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_iocontrol </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>karg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void __user *&nbsp;</td>
          <td class="paramname"> <em>uarg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html">obd_ops</a>: o_iocontrol. </p>
<p>This function is the ioctl handler for OSP. Note: lctl will access the OSP directly by ioctl, instead of through the MDS stack.</p>
<p>param[in] cmd ioctl command. param[in] exp export of this OSP. param[in] len data length of <em>karg</em>. param[in] karg input argument which is packed as <a class="el" href="structobd__ioctl__data.html">obd_ioctl_data</a> param[out] uarg pointer to userspace buffer (must access by copy_to_user()).</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if the ioctl handling succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if the ioctl handling failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01660">1660</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="linux_2libcfs_8h_source.html#l00146">current_comm</a>, <a class="el" href="dt__object_8h_source.html#l01724">dt_device::dd_ops</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="lustre__ioctl_8h_source.html#l00107">obd_ioctl_data::ioc_inlbuf1</a>, <a class="el" href="lustre__ioctl_8h_source.html#l00091">obd_ioctl_data::ioc_offset</a>, <a class="el" href="lustre__ioctl_8h_source.html#l00412">IOC_OSC_SET_ACTIVE</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="lustre__ioctl_8h_source.html#l00349">OBD_IOC_CLIENT_RECOVER</a>, <a class="el" href="lustre__ioctl_8h_source.html#l00350">OBD_IOC_PING_TARGET</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="pinger_8c_source.html#l00078">ptlrpc_obd_ping()</a>, <a class="el" href="recover_8c_source.html#l00333">ptlrpc_recover_import()</a>, <a class="el" href="recover_8c_source.html#l00290">ptlrpc_set_import_active()</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="a4f2d50979ff1f27f1d9ca475a71e70aa"></a><!-- doxytag: member="osp_dev.c::osp_key_exit" ref="a4f2d50979ff1f27f1d9ca475a71e70aa" args="(const struct lu_context *ctx, struct lu_context_key *key, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_key_exit </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__context.html">lu_context</a> *&nbsp;</td>
          <td class="paramname"> <em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__context__key.html">lu_context_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01838">1838</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, and <a class="el" href="osp__internal_8h_source.html#l00313">osp_thread_info::osi_attr</a>.</p>

</div>
</div>
<a class="anchor" id="ac83e63ec05d36bbd4b8237998d5d1078"></a><!-- doxytag: member="osp_dev.c::osp_last_used_fini" ref="ac83e63ec05d36bbd4b8237998d5d1078" args="(const struct lu_env *env, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_last_used_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release the last sequence and OID file objects in OSP device. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00432">432</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="osp__internal_8h_source.html#l00149">osp_device::opd_last_used_oid_file</a>, and <a class="el" href="osp__internal_8h_source.html#l00150">osp_device::opd_last_used_seq_file</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>, and <a class="el" href="osp__dev_8c_source.html#l00587">osp_shutdown()</a>.</p>

</div>
</div>
<a class="anchor" id="a7339fcd0eadcea2eaa91bf79d501692c"></a><!-- doxytag: member="osp_dev.c::osp_last_used_init" ref="a7339fcd0eadcea2eaa91bf79d501692c" args="(const struct lu_env *env, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_last_used_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize last OID and sequence object. </p>
<p>If the MDT is just upgraded to 2.4 from the lower version, where the LAST_SEQ file does not exist, the file will be created and IDIF sequence will be written into the file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if initialization succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative error if initialization failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00362">362</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__idl_8h_source.html#l00508">fid_idif_seq()</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00141">osp_device::opd_index</a>, <a class="el" href="osp__internal_8h_source.html#l00155">osp_device::opd_last_used_fid</a>, <a class="el" href="osp__internal_8h_source.html#l00149">osp_device::opd_last_used_oid_file</a>, <a class="el" href="osp__internal_8h_source.html#l00150">osp_device::opd_last_used_seq_file</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00310">osp_thread_info::osi_lb</a>, <a class="el" href="osp__internal_8h_source.html#l00317">osp_thread_info::osi_off</a>, <a class="el" href="osp__internal_8h_source.html#l00409">osp_env_info()</a>, <a class="el" href="osp__dev_8c_source.html#l00249">osp_init_last_objid()</a>, <a class="el" href="osp__dev_8c_source.html#l00306">osp_init_last_seq()</a>, <a class="el" href="osp__internal_8h_source.html#l00393">osp_objseq_buf_prep()</a>, <a class="el" href="osp__dev_8c_source.html#l00209">osp_write_local_file()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="ac32d23fc462e5bfbec959a7feb5d0ea9"></a><!-- doxytag: member="osp_dev.c::osp_obd_connect" ref="ac32d23fc462e5bfbec959a7feb5d0ea9" args="(const struct lu_env *env, struct obd_export **exp, struct obd_device *obd, struct obd_uuid *cluuid, struct obd_connect_data *data, void *localdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_obd_connect </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> **&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>cluuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>localdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01398">1398</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00322">client_obd::cl_seq</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="genops_8c_source.html#l01150">class_connect()</a>, <a class="el" href="genops_8c_source.html#l00803">class_export_get()</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__import_8h_source.html#l00316">obd_import::imp_connect_data</a>, <a class="el" href="lustre__import_8h_source.html#l00317">obd_import::imp_connect_flags_orig</a>, <a class="el" href="lustre__import_8h_source.html#l00168">obd_import::imp_dlm_handle</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__fid_8h_source.html#l00353">lu_client_seq::lcs_exp</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="lustre__ver_8h_source.html#l00023">LUSTRE_VERSION_CODE</a>, <a class="el" href="lustre__idl_8h_source.html#l01180">OBD_CONNECT_INDEX</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__idl_8h_source.html#l01336">obd_connect_data::ocd_connect_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01339">obd_connect_data::ocd_index</a>, <a class="el" href="lustre__idl_8h_source.html#l01337">obd_connect_data::ocd_version</a>, <a class="el" href="osp__internal_8h_source.html#l00163">osp_device::opd_connects</a>, <a class="el" href="osp__internal_8h_source.html#l00160">osp_device::opd_exp</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>, <a class="el" href="pinger_8c_source.html#l00405">ptlrpc_pinger_add_import()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="af43e6210aedbb756516b2bd75e112ed9"></a><!-- doxytag: member="osp_dev.c::osp_obd_disconnect" ref="af43e6210aedbb756516b2bd75e112ed9" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_obd_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a1dfbddccaf8e568c531a466861c7df0b">obd_ops::o_disconnect</a>. </p>
<p>Disconnect the export for the OSP. This is called by LOD to release the OSP during cleanup (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="lod__internal_8h.html#aa568d1f98a1c3293cb72055df6efe3f8" title="Remove device by name.">lod_del_device()</a>). The OSP will be released after the <a class="el" href="group__export.html">export</a> is released.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export to be disconnected.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if disconnection succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if disconnection failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01463">1463</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l01220">class_disconnect()</a>, <a class="el" href="obd__config_8c_source.html#l01909">class_manual_cleanup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00163">osp_device::opd_connects</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a3d2358e482381be0554d094d598a0034"></a><!-- doxytag: member="osp_dev.c::osp_obd_get_info" ref="a3d2358e482381be0554d094d598a0034" args="(const struct lu_env *env, struct obd_export *exp, __u32 keylen, void *key, __u32 *vallen, void *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_obd_get_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>keylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>vallen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>val</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a5b1e6cee59585a39cf3a4c75d5b3fbd7">obd_ops::o_get_info</a>. </p>
<p>Retrieve information by key. Retrieval starts from the top layer (MDT) of the MDS stack and traverses the stack by calling the <a class="el" href="obd__class_8h.html#aca78facc3ff7e9e1a70e49178fec07e1">obd_get_info()</a> method of the next sub-layer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export of this OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>keylen</em>&nbsp;</td><td>length of <em>key</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>key</em>&nbsp;</td><td>the key </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>vallen</em>&nbsp;</td><td>length of <em>val</em> </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>val</em>&nbsp;</td><td>holds the value returned by the key</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if getting information succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if getting information failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01721">1721</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="obd__support_8h_source.html#l00860">KEY_IS</a>, <a class="el" href="obd_8h_source.html#l00763">KEY_OSP_CONNECTED</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_set_up</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_stopping</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_seen_connected</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a32ba37f83f8744618e68591b9b3ba4ce"></a><!-- doxytag: member="osp_dev.c::osp_obd_set_info_async" ref="a32ba37f83f8744618e68591b9b3ba4ce" args="(const struct lu_env *env, struct obd_export *exp, u32 keylen, void *key, u32 vallen, void *val, struct ptlrpc_request_set *set)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_obd_set_info_async </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&nbsp;</td>
          <td class="paramname"> <em>keylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&nbsp;</td>
          <td class="paramname"> <em>vallen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request__set.html">ptlrpc_request_set</a> *&nbsp;</td>
          <td class="paramname"> <em>set</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01746">1746</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="obd__support_8h_source.html#l00860">KEY_IS</a>, <a class="el" href="obd_8h_source.html#l00759">KEY_SPTLRPC_CONF</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="packet-lustre_8c_source.html#l00077">LUSTRE_MDS_VERSION</a>, <a class="el" href="packet-lustre_8c_source.html#l00078">LUSTRE_OST_VERSION</a>, <a class="el" href="packet-lustre_8c_source.html#l00214">MDS_SET_INFO</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_set_up</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_stopping</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="packet-lustre_8c_source.html#l00180">OST_SET_INFO</a>, <a class="el" href="client_8c_source.html#l01644">ptlrpc_check_set()</a>, <a class="el" href="client_8c_source.html#l00852">ptlrpc_request_alloc()</a>, <a class="el" href="client_8c_source.html#l00875">ptlrpc_request_free()</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="client_8c_source.html#l01050">ptlrpc_set_add_req()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l00974">RMF_SETINFO_KEY</a>, <a class="el" href="layout_8c_source.html#l00899">RMF_SETINFO_VAL</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="layout_8c_source.html#l01274">RQF_OBD_SET_INFO</a>, <a class="el" href="sec__config_8c_source.html#l00905">sptlrpc_conf_client_adapt()</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="a6ab2de1414ffc513bd65c5e1cc028c5e"></a><!-- doxytag: member="osp_dev.c::osp_obd_statfs" ref="a6ab2de1414ffc513bd65c5e1cc028c5e" args="(const struct lu_env *env, struct obd_export *exp, struct obd_statfs *osfs, __u64 unused, __u32 flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_obd_statfs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *&nbsp;</td>
          <td class="paramname"> <em>osfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>unused</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a3290ce3a9029a8715d49b42778683c7a">obd_ops::o_statfs</a>. </p>
<p>Send a RPC to the remote target to get statfs status. This is only used in lprocfs helpers by <a class="el" href="structobd__statfs.html">obd_statfs</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>connection state from this OSP to the parent (LOD) device </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>osfs</em>&nbsp;</td><td>hold the statfs result </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>unused</em>&nbsp;</td><td>Not used in this function for now </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>flags</em>&nbsp;</td><td>flags to indicate how OSP will issue the RPC</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if statfs succeeded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if statfs failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01503">1503</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00160">client_obd::cl_sem</a>, <a class="el" href="genops_8c_source.html#l01005">class_import_get()</a>, <a class="el" href="genops_8c_source.html#l01015">class_import_put()</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="packet-lustre_8c_source.html#l00078">LUSTRE_OST_VERSION</a>, <a class="el" href="obd__class_8h_source.html#l00048">OBD_STATFS_NODELAY</a>, <a class="el" href="lustre__idl_8h_source.html#l00097">OST_CREATE_PORTAL</a>, <a class="el" href="packet-lustre_8c_source.html#l00176">OST_STATFS</a>, <a class="el" href="client_8c_source.html#l00293">ptlrpc_at_set_req_timeout()</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="client_8c_source.html#l00852">ptlrpc_request_alloc()</a>, <a class="el" href="client_8c_source.html#l00875">ptlrpc_request_free()</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="layout_8c_source.html#l02158">req_capsule_server_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l00969">RMF_OBD_STATFS</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_no_delay</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_no_resend</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="layout_8c_source.html#l01646">RQF_OST_STATFS</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

</div>
</div>
<a class="anchor" id="a35165a9baeab355c0b31ae164f5cec90"></a><!-- doxytag: member="osp_dev.c::osp_object_alloc" ref="a35165a9baeab355c0b31ae164f5cec90" args="(const struct lu_env *env, const struct lu_object_header *hdr, struct lu_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__object.html">lu_object</a>* osp_object_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *&nbsp;</td>
          <td class="paramname"> <em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">lu_device_operations::ldo_object_alloc</a>. </p>
<p>Allocates an OSP object in memory, whose FID is on the remote target.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>hdr</em>&nbsp;</td><td>The header of the object stack. If it is NULL, it means the object is not built from top device, i.e. it is a sub-stripe object of striped directory or an OST object. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>object</em>&nbsp;</td><td>object being created if the creation succeed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>NULL if the creation failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00116">116</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8c_source.html#l00170">dt_object_init()</a>, <a class="el" href="lu__object_8h_source.html#l00476">lu_object::lo_ops</a>, <a class="el" href="lu__object_8c_source.html#l01280">lu_object_add_top()</a>, <a class="el" href="lu__object_8c_source.html#l01301">lu_object_header_init()</a>, <a class="el" href="obd__support_8h_source.html#l00851">OBD_SLAB_ALLOC_PTR_GFP</a>, <a class="el" href="osp__internal_8h_source.html#l00290">osp_object::opo_header</a>, <a class="el" href="osp__internal_8h_source.html#l00291">osp_object::opo_obj</a>, <a class="el" href="osp__object_8c_source.html#l02257">osp_lu_obj_ops</a>, and <a class="el" href="osp__dev_8c_source.html#l00088">osp_object_kmem</a>.</p>

</div>
</div>
<a class="anchor" id="a4d01cbbba4cf9ae550a86ec2f9b9fe9e"></a><!-- doxytag: member="osp_dev.c::osp_process_config" ref="a4d01cbbba4cf9ae550a86ec2f9b9fe9e" args="(const struct lu_env *env, struct lu_device *dev, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_process_config </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of osp_lu_ops::ldo_process_config. </p>
<p>This function processes config log records in OSP layer. It is usually called from the top layer of MDT stack, and goes through the stack by calling ldo_process_config of next layer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td><a class="el" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> of OSP </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lcfg</em>&nbsp;</td><td>config log</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if the config log record is executed correctly. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if the record execution fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00626">626</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="obd__config_8c_source.html#l01322">class_process_proc_param()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__cfg_8h_source.html#l00075">LCFG_CLEANUP</a>, <a class="el" href="lustre__cfg_8h_source.html#l00130">lustre_cfg::lcfg_command</a>, <a class="el" href="lustre__cfg_8h_source.html#l00086">LCFG_PARAM</a>, <a class="el" href="lustre__cfg_8h_source.html#l00099">LCFG_PRE_CLEANUP</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="lu__object_8c_source.html#l01047">lu_dev_del_linkage()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="obd_8h_source.html#l00716">obd_device::obd_vars</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__dev_8c_source.html#l00456">osp_disconnect()</a>, <a class="el" href="osp__dev_8c_source.html#l00587">osp_shutdown()</a>, <a class="el" href="osp__dev_8c_source.html#l00546">osp_update_fini()</a>, <a class="el" href="lustre__param_8h_source.html#l00108">PARAM_OSC</a>, <a class="el" href="lustre__param_8h_source.html#l00116">PARAM_OSP</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ad985591f693b85d81683db88e703576b"></a><!-- doxytag: member="osp_dev.c::osp_reconnect" ref="ad985591f693b85d81683db88e703576b" args="(const struct lu_env *env, struct obd_export *exp, struct obd_device *obd, struct obd_uuid *cluuid, struct obd_connect_data *data, void *localdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_reconnect </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>cluuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>localdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a8239d39c9f687a6ee062fe6347b8a736">obd_ops::o_reconnect</a>. </p>
<p>This function is empty and does not need to do anything for now. </p>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01369">1369</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a931c635c01b5d8fcd05cf33fca4c580f"></a><!-- doxytag: member="osp_dev.c::osp_recovery_complete" ref="a931c635c01b5d8fcd05cf33fca4c580f" args="(const struct lu_env *env, struct lu_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_recovery_complete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of osp_lu_ops::ldo_recovery_complete. </p>
<p>This function is called after recovery is finished, and OSP layer will wake up precreate thread here.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td><a class="el" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> of OSP</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 unconditionally </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00683">683</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00179">osp_device::opd_pre</a>, <a class="el" href="osp__internal_8h_source.html#l00183">osp_device::opd_pre_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00176">osp_device::opd_recovery_completed</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a14b95686e21b9f394fa1ace73e4c2833"></a><!-- doxytag: member="osp_dev.c::osp_shutdown" ref="a14b95686e21b9f394fa1ace73e4c2833" args="(const struct lu_env *env, struct osp_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_shutdown </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cleanup OSP, which includes disconnect import, cleanup unlink log, stop precreate threads etc. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>OSP device being disconnected.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if cleanup succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if cleanup failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00587">587</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="obd__class_8h_source.html#l00867">obd_fid_fini()</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__dev_8c_source.html#l00456">osp_disconnect()</a>, <a class="el" href="osp__dev_8c_source.html#l00432">osp_last_used_fini()</a>, <a class="el" href="osp__precreate_8c_source.html#l01596">osp_precreate_fini()</a>, <a class="el" href="osp__sync_8c_source.html#l01444">osp_sync_fini()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00626">osp_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a46e4b4fdd4588ebbe60257db66bd4e0c"></a><!-- doxytag: member="osp_dev.c::osp_statfs" ref="a46e4b4fdd4588ebbe60257db66bd4e0c" args="(const struct lu_env *env, struct dt_device *dev, struct obd_statfs *sfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_statfs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *&nbsp;</td>
          <td class="paramname"> <em>sfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_device_operations::dt_statfs</a>. </p>
<p>This function provides statfs status (for precreation) from corresponding OST. Note: this function only retrieves the status from the OSP device, and the real statfs RPC happens inside precreate thread (</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="osp__precreate_8c.html#ad3654e532b5fa26c203761087ed06470" title="Send OST_STATFS RPC.">osp_statfs_update</a>). Note: OSP for MDT does not need to retrieve statfs data for <a class="el" href="createmany_8c.html#a5602e9c6b2da7a1db11ed8a76d19fde3">now</a>.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td><a class="el" href="structdt__device.html">dt_device</a> of OSP. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>sfs</em>&nbsp;</td><td>holds the retrieved statfs data.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 statfs data was retrieved successfully or retrieval was not needed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if get statfs failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00720">720</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="osp__internal_8h_source.html#l00454">dt2osp_dev()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__import_8h_source.html#l00230">obd_import::imp_state</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__import_8h_source.html#l00098">LUSTRE_IMP_CLOSED</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_active</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00179">osp_device::opd_pre</a>, <a class="el" href="osp__internal_8h_source.html#l00233">osp_device::opd_statfs</a>, <a class="el" href="lustre__user_8h_source.html#l00111">obd_statfs::os_bavail</a>, <a class="el" href="lustre__user_8h_source.html#l00110">obd_statfs::os_bfree</a>, <a class="el" href="lustre__user_8h_source.html#l00109">obd_statfs::os_blocks</a>, <a class="el" href="lustre__user_8h_source.html#l00113">obd_statfs::os_ffree</a>, <a class="el" href="lustre__user_8h_source.html#l00112">obd_statfs::os_files</a>, <a class="el" href="lustre__user_8h_source.html#l00119">obd_statfs::os_fprecreated</a>, <a class="el" href="lustre__idl_8h_source.html#l01770">OST_MAX_PRECREATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a01744bbbd4b8491770f60ae55ae2efc4"></a><!-- doxytag: member="osp_dev.c::osp_sync" ref="a01744bbbd4b8491770f60ae55ae2efc4" args="(const struct lu_env *env, struct dt_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_sync </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_device_operations::dt_sync</a>. </p>
<p>This function synchronizes the OSP cache to the remote target. It wakes up unlink log threads and sends out unlink records to the remote OST.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td><a class="el" href="structdt__device.html">dt_device</a> of OSP</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if synchronization succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negative errno if synchronization fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00781">781</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="osp__sync_8c_source.html#l00236">__osp_sync_check_for_work()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="libcfs__time_8h_source.html#l00067">cfs_time_shift()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00134">D_CACHE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="osp__internal_8h_source.html#l00454">dt2osp_dev()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lustre__lib_8h_source.html#l00171">LWI_TIMEOUT</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="class__obd_8c_source.html#l00083">obd_timeout</a>, <a class="el" href="osp__internal_8h_source.html#l00252">osp_device::opd_async_updates_count</a>, <a class="el" href="osp__internal_8h_source.html#l00251">osp_device::opd_async_updates_rwsem</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_active</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00227">osp_device::opd_syn_barrier</a>, <a class="el" href="osp__internal_8h_source.html#l00228">osp_device::opd_syn_barrier_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00223">osp_device::opd_syn_last_processed_id</a>, <a class="el" href="osp__internal_8h_source.html#l00218">osp_device::opd_syn_last_used_id</a>, <a class="el" href="osp__internal_8h_source.html#l00210">osp_device::opd_syn_rpc_in_flight</a>, <a class="el" href="osp__dev_8c_source.html#l00764">osp_sync_timeout()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="rename__many_8c_source.html#l00057">start</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a4037ad5aa28879256e2d9061ec8d8522"></a><!-- doxytag: member="osp_dev.c::osp_sync_timeout" ref="a4037ad5aa28879256e2d9061ec8d8522" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_sync_timeout </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00764">764</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00781">osp_sync()</a>.</p>

</div>
</div>
<a class="anchor" id="aaee5055775a8eb44746e060336eb72a6"></a><!-- doxytag: member="osp_dev.c::osp_update_fini" ref="aaee5055775a8eb44746e060336eb72a6" args="(const struct lu_env *env, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_update_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finialize osp_update structure in OSP device. </p>
<p>Stop the OSP update sending thread, then delete the left osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> in the sending list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00546">546</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__internal_8h_source.html#l00188">osp_device::opd_update_thread</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__internal_8h_source.html#l00130">osp_updates::ou_list</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00132">osp_updates::ou_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, and <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>, and <a class="el" href="osp__dev_8c_source.html#l00626">osp_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a73eeea0d0e2aa7cf28f92292b38fd880"></a><!-- doxytag: member="osp_dev.c::osp_update_init" ref="a73eeea0d0e2aa7cf28f92292b38fd880" args="(struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_update_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the osp_update structure in OSP device. </p>
<p>Allocate osp update structure and start update thread.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if initialization succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if initialization fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00498">498</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00145">osp_device::opd_group</a>, <a class="el" href="osp__internal_8h_source.html#l00141">osp_device::opd_index</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__internal_8h_source.html#l00188">osp_device::opd_update_thread</a>, <a class="el" href="osp__trans_8c_source.html#l01423">osp_send_update_thread()</a>, <a class="el" href="osp__internal_8h_source.html#l00650">osp_send_update_thread_running()</a>, <a class="el" href="osp__internal_8h_source.html#l00655">osp_send_update_thread_stopped()</a>, <a class="el" href="osp__internal_8h_source.html#l00130">osp_updates::ou_list</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00134">osp_updates::ou_rpc_version</a>, <a class="el" href="osp__internal_8h_source.html#l00135">osp_updates::ou_version</a>, <a class="el" href="osp__internal_8h_source.html#l00132">osp_updates::ou_waitq</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00996">osp_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a9ed9cff4820f30e8db2f93b01e593aa5"></a><!-- doxytag: member="osp_dev.c::osp_write_local_file" ref="a9ed9cff4820f30e8db2f93b01e593aa5" args="(const struct lu_env *env, struct osp_device *osp, struct dt_object *dt_obj, struct lu_buf *buf, loff_t offset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_write_local_file </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__buf.html">lu_buf</a> *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t&nbsp;</td>
          <td class="paramname"> <em>offset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write data buffer to a local file object. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt_obj</em>&nbsp;</td><td>object written to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer containing byte array and length </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>offset</em>&nbsp;</td><td>write offset in the object in bytes</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>0 if write succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EFAULT</em>&nbsp;</td><td>-EFAULT if only part of buffer is written. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>other negative errno if write failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00209">209</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02087">dt_declare_record_write()</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="osp__internal_8h_source.html#l00148">osp_device::opd_storage</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00249">osp_init_last_objid()</a>, <a class="el" href="osp__dev_8c_source.html#l00306">osp_init_last_seq()</a>, and <a class="el" href="osp__dev_8c_source.html#l00362">osp_last_used_init()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a51d21a1c53c92944bcb1c72a9e7e5ff9"></a><!-- doxytag: member="osp_dev.c::osp_caches" ref="a51d21a1c53c92944bcb1c72a9e7e5ff9" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__kmem__descr.html">lu_kmem_descr</a> <a class="el" href="osp__dev_8c.html#a51d21a1c53c92944bcb1c72a9e7e5ff9">osp_caches</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        {
                .ckd_cache = &amp;<a class="code" href="osp__dev_8c.html#a5ba0c65d48df6137aa2c1c66354fa0e1">osp_object_kmem</a>,
                .ckd_name  = <span class="stringliteral">&quot;osp_obj&quot;</span>,
                .ckd_size  = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structosp__object.html">osp_object</a>)
        },
        {
                .ckd_cache = NULL
        }
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00090">90</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad8b908db28ab7285c6f990ab7e857c46"></a><!-- doxytag: member="osp_dev.c::osp_device_type" ref="ad8b908db28ab7285c6f990ab7e857c46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> <a class="el" href="osp__dev_8c.html#ad8b908db28ab7285c6f990ab7e857c46">osp_device_type</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldt_tags     = <a class="code" href="group__lu.html#ggaa318f5b20c40de1d564f59dd72726345a5b8da75da353b465f5ddc30d87c931d9" title="this is data device">LU_DEVICE_DT</a>,
        .ldt_name     = <a class="code" href="obd_8h.html#ac57fca1ca1ef63748cf5c50ad1b7eb45">LUSTRE_OSP_NAME</a>,
        .ldt_ops      = &amp;<a class="code" href="osp__dev_8c.html#afc41eb26033eedcca5f4b70ca99fd274">osp_device_type_ops</a>,
        .ldt_ctx_tags = <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aa51f264f8e3ea36a381cf8aaaa9672752" title="Thread on md server.">LCT_MD_THREAD</a> | <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aa130ed4529679eed5a88d5dc63db1921f" title="Thread on dt server.">LCT_DT_THREAD</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01876">1876</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="afc41eb26033eedcca5f4b70ca99fd274"></a><!-- doxytag: member="osp_dev.c::osp_device_type_ops" ref="afc41eb26033eedcca5f4b70ca99fd274" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__type__operations.html">lu_device_type_operations</a> <a class="el" href="osp__dev_8c.html#afc41eb26033eedcca5f4b70ca99fd274">osp_device_type_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldto_init           = osp_type_init,
        .ldto_fini           = osp_type_fini,

        .ldto_start          = osp_type_start,
        .ldto_stop           = osp_type_stop,

        .ldto_device_alloc   = <a class="code" href="osp__dev_8c.html#a63841b5d383836d9c48e4630421d0d79" title="Implementation of lu_device_type_operations::ldto_device_alloc.">osp_device_alloc</a>,
        .ldto_device_free    = <a class="code" href="osp__dev_8c.html#af00a3788f7dd1e2df775810d0b830e03" title="Implementation of lu_device_type_operations::ldto_device_free.">osp_device_free</a>,

        .ldto_device_fini    = <a class="code" href="osp__dev_8c.html#ac0779f76ecfc5f2d4177db4f04083a83" title="Implementation of lu_device_type_operations::ldto_device_fini.">osp_device_fini</a>
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01863">1863</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a037aa9290c964160d0fa3173b14e9415"></a><!-- doxytag: member="osp_dev.c::osp_dt_ops" ref="a037aa9290c964160d0fa3173b14e9415" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdt__device__operations.html">dt_device_operations</a> <a class="el" href="osp__internal_8h.html#a037aa9290c964160d0fa3173b14e9415">osp_dt_ops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .dt_statfs       = <a class="code" href="osp__dev_8c.html#a46e4b4fdd4588ebbe60257db66bd4e0c" title="Implementation of dt_device_operations::dt_statfs.">osp_statfs</a>,
        .dt_sync         = <a class="code" href="osp__dev_8c.html#a01744bbbd4b8491770f60ae55ae2efc4" title="Implementation of dt_device_operations::dt_sync.">osp_sync</a>,
        .dt_trans_create = <a class="code" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create</a>,
        .dt_trans_start  = <a class="code" href="osp__internal_8h.html#abc06232f12babe95aefb7105d7008d69" title="The OSP layer dt_device_operations::dt_trans_start() interface to start the transaction...">osp_trans_start</a>,
        .dt_trans_stop   = <a class="code" href="osp__internal_8h.html#a38da7db0c90fa482dc7eab274b4775ef" title="The OSP layer dt_device_operations::dt_trans_stop() interface to stop the transaction...">osp_trans_stop</a>,
        .dt_trans_cb_add   = <a class="code" href="osp__internal_8h.html#a1a8c6788966fb5ad5c99a44e1e9c8bd6" title="Add commit callback to transaction.">osp_trans_cb_add</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00886">886</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9e545f9a09277a5db32dcc53f3ae6484"></a><!-- doxytag: member="osp_dev.c::osp_lu_ops" ref="a9e545f9a09277a5db32dcc53f3ae6484" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__operations.html">lu_device_operations</a> <a class="el" href="osp__internal_8h.html#a9e545f9a09277a5db32dcc53f3ae6484">osp_lu_ops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldo_object_alloc       = <a class="code" href="osp__dev_8c.html#a35165a9baeab355c0b31ae164f5cec90" title="Implementation of lu_device_operations::ldo_object_alloc.">osp_object_alloc</a>,
        .ldo_process_config     = <a class="code" href="osp__dev_8c.html#a4d01cbbba4cf9ae550a86ec2f9b9fe9e" title="Implementation of osp_lu_ops::ldo_process_config.">osp_process_config</a>,
        .ldo_recovery_complete  = <a class="code" href="osp__dev_8c.html#a931c635c01b5d8fcd05cf33fca4c580f" title="Implementation of osp_lu_ops::ldo_recovery_complete.">osp_recovery_complete</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00697">697</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__internal_8h_source.html#l00438">lu_device_is_osp()</a>.</p>

</div>
</div>
<a class="anchor" id="a242e4f041ab0c6d014f218b12aec9622"></a><!-- doxytag: member="osp_dev.c::osp_mds_ost_orig_logops" ref="a242e4f041ab0c6d014f218b12aec9622" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structllog__operations.html">llog_operations</a> <a class="el" href="osp__internal_8h.html#a242e4f041ab0c6d014f218b12aec9622">osp_mds_ost_orig_logops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01900">1900</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l01914">osp_init()</a>, and <a class="el" href="osp__sync_8c_source.html#l01244">osp_sync_llog_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a5093a3beae861223299799e1f3653e67"></a><!-- doxytag: member="osp_dev.c::osp_obd_device_ops" ref="a5093a3beae861223299799e1f3653e67" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structobd__ops.html">obd_ops</a> <a class="el" href="osp__dev_8c.html#a5093a3beae861223299799e1f3653e67">osp_obd_device_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .o_owner        = THIS_MODULE,
        .o_add_conn     = <a class="code" href="group__net.html#gace2253d15c74ffe28cf60ed3518258b2">client_import_add_conn</a>,
        .o_del_conn     = <a class="code" href="group__net.html#ga770f58b91f82d4b373b35f2b11cdf5d0">client_import_del_conn</a>,
        .o_reconnect    = <a class="code" href="osp__dev_8c.html#ad985591f693b85d81683db88e703576b" title="Implementation of obd_ops::o_reconnect.">osp_reconnect</a>,
        .o_connect      = <a class="code" href="osp__dev_8c.html#ac32d23fc462e5bfbec959a7feb5d0ea9">osp_obd_connect</a>,
        .o_disconnect   = <a class="code" href="osp__dev_8c.html#af43e6210aedbb756516b2bd75e112ed9" title="Implementation of obd_ops::o_disconnect.">osp_obd_disconnect</a>,
        .o_get_info     = <a class="code" href="osp__dev_8c.html#a3d2358e482381be0554d094d598a0034" title="Implementation of obd_ops::o_get_info.">osp_obd_get_info</a>,
        .o_set_info_async = <a class="code" href="osp__dev_8c.html#a32ba37f83f8744618e68591b9b3ba4ce">osp_obd_set_info_async</a>,
        .o_import_event = <a class="code" href="osp__dev_8c.html#ad4f7c786a52c022460228edd95dda493" title="Implementation of obd_ops::o_import_event.">osp_import_event</a>,
        .o_iocontrol    = <a class="code" href="osp__dev_8c.html#a07949c248ea1ccfaee54f1ea6aab2db5" title="Implementation of obd_ops: o_iocontrol.">osp_iocontrol</a>,
        .o_statfs       = <a class="code" href="osp__dev_8c.html#a6ab2de1414ffc513bd65c5e1cc028c5e" title="Implementation of obd_ops::o_statfs.">osp_obd_statfs</a>,
        .o_fid_init     = <a class="code" href="group__fid.html#ga3e1fdd8c5dda747c15e4166cceb84a89">client_fid_init</a>,
        .o_fid_fini     = <a class="code" href="group__fid.html#gae6c1b8d714d2bc4f7f094195c1c8e86d">client_fid_fini</a>,
        .o_fid_alloc    = <a class="code" href="osp__dev_8c.html#a45df324b07fdccea3d8dd1a69b6c0dce" title="Implementation of obd_ops: o_fid_alloc.">osp_fid_alloc</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01883">1883</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ba0c65d48df6137aa2c1c66354fa0e1"></a><!-- doxytag: member="osp_dev.c::osp_object_kmem" ref="a5ba0c65d48df6137aa2c1c66354fa0e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct kmem_cache* <a class="el" href="osp__internal_8h.html#a5ba0c65d48df6137aa2c1c66354fa0e1">osp_object_kmem</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l00088">88</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00116">osp_object_alloc()</a>, and <a class="el" href="osp__object_8c_source.html#l02173">osp_object_free()</a>.</p>

</div>
</div>
<a class="anchor" id="ad3c37ca09ea52b0ec6f6c77e71a8d18e"></a><!-- doxytag: member="osp_dev.c::osp_thread_key" ref="ad3c37ca09ea52b0ec6f6c77e71a8d18e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__context__key.html">lu_context_key</a> <a class="el" href="osp__internal_8h.html#ad3c37ca09ea52b0ec6f6c77e71a8d18e">osp_thread_key</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .lct_tags = <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aa51f264f8e3ea36a381cf8aaaa9672752" title="Thread on md server.">LCT_MD_THREAD</a>,
        .lct_init = osp_key_init,
        .lct_fini = osp_key_fini,
        .lct_exit = <a class="code" href="osp__dev_8c.html#a4f2d50979ff1f27f1d9ca475a71e70aa">osp_key_exit</a>
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01846">1846</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__internal_8h_source.html#l00409">osp_env_info()</a>.</p>

</div>
</div>
<a class="anchor" id="a6f9defa450c24f77e303a32d1834e142"></a><!-- doxytag: member="osp_dev.c::osp_txn_key" ref="a6f9defa450c24f77e303a32d1834e142" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__context__key.html">lu_context_key</a> <a class="el" href="osp__internal_8h.html#a6f9defa450c24f77e303a32d1834e142">osp_txn_key</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .lct_tags = <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aa24dc5414c9f1420be38e18a84e730d10" title="A per-request data on OSP device.">LCT_OSP_THREAD</a> | <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aae4ff6019628711d8f1dbefee9e3edfee" title="Context for transaction handle.">LCT_TX_HANDLE</a>,
        .lct_init = osp_txn_key_init,
        .lct_fini = osp_txn_key_fini
}
</pre></div>
<p>Definition at line <a class="el" href="osp__dev_8c_source.html#l01856">1856</a> of file <a class="el" href="osp__dev_8c_source.html">osp_dev.c</a>.</p>

<p>Referenced by <a class="el" href="osp__internal_8h_source.html#l00428">osp_txn_info()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
