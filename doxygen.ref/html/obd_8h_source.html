<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/include/obd.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/include/obd.h</h1><a href="obd_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef __OBD_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define __OBD_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;linux/spinlock.h&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="lustre__idl_8h.html">lustre/lustre_idl.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="lustre__lib_8h.html">lustre_lib.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="bitmap_8h.html">libcfs/bitmap.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#ifdef HAVE_SERVER_SUPPORT</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor"># include &lt;<a class="code" href="lu__target_8h.html">lu_target.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor"># include &lt;<a class="code" href="obd__target_8h.html">obd_target.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#endif</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="lu__ref_8h.html">lu_ref.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="lustre__export_8h.html">lustre_export.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="lustre__fid_8h.html">lustre_fid.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="lustre__fld_8h.html">lustre_fld.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="lustre__handles_8h.html">lustre_handles.h</a>&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="lustre__intent_8h.html">lustre_intent.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="lvfs_8h.html">lvfs.h</a>&gt;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="obd_8h.html#a8b4998eba0906f1e2665945e1766c9ab">00057</a> <span class="preprocessor">#define MAX_OBD_DEVICES 8192</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a><a class="code" href="structosc__async__rc.html">00059</a> <span class="keyword">struct </span><a class="code" href="structosc__async__rc.html">osc_async_rc</a> {
<a name="l00060"></a><a class="code" href="structosc__async__rc.html#ac238ece4c2f3ee8c91612180d83f8405">00060</a>         <span class="keywordtype">int</span>     <a class="code" href="structosc__async__rc.html#ac238ece4c2f3ee8c91612180d83f8405">ar_rc</a>;
<a name="l00061"></a><a class="code" href="structosc__async__rc.html#a562c5670825de81a2fc69e0115b50f41">00061</a>         <span class="keywordtype">int</span>     <a class="code" href="structosc__async__rc.html#a562c5670825de81a2fc69e0115b50f41">ar_force_sync</a>;
<a name="l00062"></a><a class="code" href="structosc__async__rc.html#aabd4e9327416eb408043e5b70bd15f2b">00062</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>   <a class="code" href="structosc__async__rc.html#aabd4e9327416eb408043e5b70bd15f2b">ar_min_xid</a>;
<a name="l00063"></a>00063 };
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="structlov__oinfo.html">00065</a> <span class="keyword">struct </span><a class="code" href="structlov__oinfo.html">lov_oinfo</a> {                 <span class="comment">/* per-stripe data structure */</span>
<a name="l00066"></a><a class="code" href="structlov__oinfo.html#a8d09d3283744c17ac1dd29e7235d5c7b">00066</a>         <span class="keyword">struct </span><a class="code" href="structost__id.html" title="OST object IDentifier.">ost_id</a>   <a class="code" href="structlov__oinfo.html#a8d09d3283744c17ac1dd29e7235d5c7b">loi_oi</a>;    <span class="comment">/* object ID/Sequence on the target OST */</span>
<a name="l00067"></a><a class="code" href="structlov__oinfo.html#a23831418fd676aed99af05e02891ecc5">00067</a>         <span class="keywordtype">int</span> <a class="code" href="structlov__oinfo.html#a23831418fd676aed99af05e02891ecc5">loi_ost_idx</a>;           <span class="comment">/* OST stripe index in lov_tgt_desc-&gt;tgts */</span>
<a name="l00068"></a><a class="code" href="structlov__oinfo.html#ac4a320685ec78a38b16ede9b61888c48">00068</a>         <span class="keywordtype">int</span> <a class="code" href="structlov__oinfo.html#ac4a320685ec78a38b16ede9b61888c48">loi_ost_gen</a>;           <span class="comment">/* generation of this loi_ost_idx */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="structlov__oinfo.html#aa755ce6d1c4d5d9b1be2cd245a162477">00070</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structlov__oinfo.html#aa755ce6d1c4d5d9b1be2cd245a162477">loi_kms_valid</a>:1;
<a name="l00071"></a><a class="code" href="structlov__oinfo.html#a9ffac609d572e59b297dd51938bc9ab9">00071</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structlov__oinfo.html#a9ffac609d572e59b297dd51938bc9ab9">loi_kms</a>;             <span class="comment">/* known minimum size */</span>
<a name="l00072"></a><a class="code" href="structlov__oinfo.html#a6064671b3df673f1eaa2dc2c2bd92a98">00072</a>         <span class="keyword">struct </span><a class="code" href="structost__lvb.html">ost_lvb</a> <a class="code" href="structlov__oinfo.html#a6064671b3df673f1eaa2dc2c2bd92a98">loi_lvb</a>;
<a name="l00073"></a><a class="code" href="structlov__oinfo.html#aceda2b67773ddc3a2df741cfde5848d6">00073</a>         <span class="keyword">struct </span><a class="code" href="structosc__async__rc.html">osc_async_rc</a>     <a class="code" href="structlov__oinfo.html#aceda2b67773ddc3a2df741cfde5848d6">loi_ar</a>;
<a name="l00074"></a>00074 };
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="obd_8h.html#a6ccf0f6d56f6e80d2ceeb3893a5a1489">00076</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="obd_8h.html#a6ccf0f6d56f6e80d2ceeb3893a5a1489">loi_kms_set</a>(<span class="keyword">struct</span> <a class="code" href="structlov__oinfo.html">lov_oinfo</a> *oinfo, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> kms)
<a name="l00077"></a>00077 {
<a name="l00078"></a>00078         oinfo-&gt;<a class="code" href="structlov__oinfo.html#a9ffac609d572e59b297dd51938bc9ab9">loi_kms</a> = kms;
<a name="l00079"></a>00079         oinfo-&gt;<a class="code" href="structlov__oinfo.html#aa755ce6d1c4d5d9b1be2cd245a162477">loi_kms_valid</a> = 1;
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="obd_8h.html#a9e4432b1c35352f4649eb1cbe3cb1f69">00082</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="obd_8h.html#a9e4432b1c35352f4649eb1cbe3cb1f69">loi_init</a>(<span class="keyword">struct</span> <a class="code" href="structlov__oinfo.html">lov_oinfo</a> *loi)
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a>;
<a name="l00087"></a>00087 <span class="keyword">struct </span><a class="code" href="structobd__info.html">obd_info</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="obd_8h.html#a66d7b2a62168416c332d67cac492ee06">00089</a> <span class="keyword">typedef</span> int (*<a class="code" href="obd_8h.html#a66d7b2a62168416c332d67cac492ee06">obd_enqueue_update_f</a>)(<span class="keywordtype">void</span> *cookie, <span class="keywordtype">int</span> rc);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="comment">/* obd info for a particular level (lov, osc). */</span>
<a name="l00092"></a><a class="code" href="structobd__info.html">00092</a> <span class="keyword">struct </span><a class="code" href="structobd__info.html">obd_info</a> {
<a name="l00093"></a>00093         <span class="comment">/* OBD_STATFS_* flags */</span>
<a name="l00094"></a><a class="code" href="structobd__info.html#aa063f85aa82368b3e23ebd6ea64bb216">00094</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structobd__info.html#aa063f85aa82368b3e23ebd6ea64bb216">oi_flags</a>;
<a name="l00095"></a>00095         <span class="comment">/* statfs data specific for every OSC, if needed at all. */</span>
<a name="l00096"></a><a class="code" href="structobd__info.html#a144b7e4ddbfefe454a26c1191f9d9813">00096</a>         <span class="keyword">struct </span><a class="code" href="structobd__statfs.html">obd_statfs</a>      *<a class="code" href="structobd__info.html#a144b7e4ddbfefe454a26c1191f9d9813">oi_osfs</a>;
<a name="l00097"></a>00097         <span class="comment">/* An update callback which is called to update some data on upper</span>
<a name="l00098"></a>00098 <span class="comment">         * level. E.g. it is used for update lsm-&gt;lsm_oinfo at every received</span>
<a name="l00099"></a>00099 <span class="comment">         * request in osc level for enqueue requests. It is also possible to</span>
<a name="l00100"></a>00100 <span class="comment">         * update some caller data from LOV layer if needed. */</span>
<a name="l00101"></a><a class="code" href="structobd__info.html#af4fcfe04964c8f913ac985683c8c6574">00101</a>         <a class="code" href="obd_8h.html#a66d7b2a62168416c332d67cac492ee06">obd_enqueue_update_f</a>    <a class="code" href="structobd__info.html#af4fcfe04964c8f913ac985683c8c6574">oi_cb_up</a>;
<a name="l00102"></a>00102 };
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="structobd__type.html">00104</a> <span class="keyword">struct </span><a class="code" href="structobd__type.html">obd_type</a> {
<a name="l00105"></a><a class="code" href="structobd__type.html#aca67cd2b7451932491a0e56d4696c49f">00105</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structobd__type.html#aca67cd2b7451932491a0e56d4696c49f">typ_chain</a>;
<a name="l00106"></a><a class="code" href="structobd__type.html#aef0df762abd277c120fa3ee0f1318446">00106</a>         <span class="keyword">struct </span><a class="code" href="structobd__ops.html">obd_ops</a>          *<a class="code" href="structobd__type.html#aef0df762abd277c120fa3ee0f1318446">typ_dt_ops</a>;
<a name="l00107"></a><a class="code" href="structobd__type.html#a1c9e8eb01dbb48986910f6251dd54974">00107</a>         <span class="keyword">struct </span><a class="code" href="structmd__ops.html">md_ops</a>           *<a class="code" href="structobd__type.html#a1c9e8eb01dbb48986910f6251dd54974">typ_md_ops</a>;
<a name="l00108"></a><a class="code" href="structobd__type.html#a7626726459daea9351dabfdfa8e17b59">00108</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structobd__type.html#a7626726459daea9351dabfdfa8e17b59">typ_procroot</a>;
<a name="l00109"></a><a class="code" href="structobd__type.html#a328d936036cf655d408ef7a2e58adfd4">00109</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structobd__type.html#a328d936036cf655d408ef7a2e58adfd4">typ_procsym</a>;
<a name="l00110"></a><a class="code" href="structobd__type.html#a75c9c6d8d6e50c999d6639d0b51fe19a">00110</a>         __u32                    <a class="code" href="structobd__type.html#a75c9c6d8d6e50c999d6639d0b51fe19a">typ_sym_filter</a>;
<a name="l00111"></a><a class="code" href="structobd__type.html#a43bd9bff60d57948dd0db78df194e7fb">00111</a>         <span class="keywordtype">char</span>                    *<a class="code" href="structobd__type.html#a43bd9bff60d57948dd0db78df194e7fb">typ_name</a>;
<a name="l00112"></a><a class="code" href="structobd__type.html#a3dd0a3ab2f36144de345f6c70b838b2b">00112</a>         <span class="keywordtype">int</span>                      <a class="code" href="structobd__type.html#a3dd0a3ab2f36144de345f6c70b838b2b">typ_refcnt</a>;
<a name="l00113"></a><a class="code" href="structobd__type.html#aa5e54779a39ef8d3c88e8c785bfe96d8">00113</a>         <span class="keyword">struct </span><a class="code" href="structlu__device__type.html" title="Type of device.">lu_device_type</a>   *<a class="code" href="structobd__type.html#aa5e54779a39ef8d3c88e8c785bfe96d8">typ_lu</a>;
<a name="l00114"></a><a class="code" href="structobd__type.html#a4ab7fceeba7e764b47dfd33b76c9ea17">00114</a>         spinlock_t               <a class="code" href="structobd__type.html#a4ab7fceeba7e764b47dfd33b76c9ea17">obd_type_lock</a>;
<a name="l00115"></a>00115 };
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="structbrw__page.html">00117</a> <span class="keyword">struct </span><a class="code" href="structbrw__page.html">brw_page</a> {
<a name="l00118"></a><a class="code" href="structbrw__page.html#a241e63bf52bb9cca0f51a6493fe1ad0e">00118</a>         u64              <a class="code" href="structbrw__page.html#a241e63bf52bb9cca0f51a6493fe1ad0e">off</a>;
<a name="l00119"></a><a class="code" href="structbrw__page.html#a4027f216571314699f6994353ee17691">00119</a>         <span class="keyword">struct </span>page     *<a class="code" href="structbrw__page.html#a4027f216571314699f6994353ee17691">pg</a>;
<a name="l00120"></a><a class="code" href="structbrw__page.html#a85d231e4b1670f5742e9dc6e7de0e749">00120</a>         u32              <a class="code" href="structbrw__page.html#a85d231e4b1670f5742e9dc6e7de0e749">count</a>;
<a name="l00121"></a><a class="code" href="structbrw__page.html#a67a76cb5fcd4f73de918eed7c786f1a0">00121</a>         u32              <a class="code" href="structbrw__page.html#a67a76cb5fcd4f73de918eed7c786f1a0">flag</a>;
<a name="l00122"></a>00122 };
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="structtimeout__item.html">00124</a> <span class="keyword">struct </span><a class="code" href="structtimeout__item.html">timeout_item</a> {
<a name="l00125"></a><a class="code" href="structtimeout__item.html#a0892248759584d6d99bb7a71e52c0eb1">00125</a>         <span class="keyword">enum</span> <a class="code" href="group__net.html#ga83197c087490e096e36a4397091d0c3f" title="Pinger API (client side only).">timeout_event</a> <a class="code" href="structtimeout__item.html#a0892248759584d6d99bb7a71e52c0eb1">ti_event</a>;
<a name="l00126"></a><a class="code" href="structtimeout__item.html#a47562731f81981c19541ea7e28295097">00126</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>         <a class="code" href="structtimeout__item.html#a47562731f81981c19541ea7e28295097">ti_timeout</a>;
<a name="l00127"></a><a class="code" href="structtimeout__item.html#a62809354beb4d300251bb298186dc9c4">00127</a>         <a class="code" href="group__net.html#gaad82b5875e63992cfb2e05f9b94fbc71">timeout_cb_t</a>       <a class="code" href="structtimeout__item.html#a62809354beb4d300251bb298186dc9c4">ti_cb</a>;
<a name="l00128"></a><a class="code" href="structtimeout__item.html#a6ffce76597b14c1bac115c7c25cff5e6">00128</a>         <span class="keywordtype">void</span>              *<a class="code" href="structtimeout__item.html#a6ffce76597b14c1bac115c7c25cff5e6">ti_cb_data</a>;
<a name="l00129"></a><a class="code" href="structtimeout__item.html#aa784e07888e8c9f73c3b344386eeefac">00129</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>   <a class="code" href="structtimeout__item.html#aa784e07888e8c9f73c3b344386eeefac">ti_obd_list</a>;
<a name="l00130"></a><a class="code" href="structtimeout__item.html#a10dfca7764959752486622e4fa55292f">00130</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>   <a class="code" href="structtimeout__item.html#a10dfca7764959752486622e4fa55292f">ti_chain</a>;
<a name="l00131"></a>00131 };
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="obd_8h.html#a425f33a8896ce83c60b868a65341387b">00133</a> <span class="preprocessor">#define OBD_MAX_RIF_DEFAULT     8</span>
<a name="l00134"></a><a class="code" href="obd_8h.html#a1dba74ca69613c06ccce83ba4c7421a9">00134</a> <span class="preprocessor"></span><span class="preprocessor">#define OBD_MAX_RIF_MAX         512</span>
<a name="l00135"></a><a class="code" href="obd_8h.html#ad8bf16087627018264bf610c0cfc59e0">00135</a> <span class="preprocessor"></span><span class="preprocessor">#define OSC_MAX_RIF_MAX         256</span>
<a name="l00136"></a><a class="code" href="obd_8h.html#a72c92fc77f9376f45d8b3f54845bec2b">00136</a> <span class="preprocessor"></span><span class="preprocessor">#define OSC_MAX_DIRTY_DEFAULT   (OBD_MAX_RIF_DEFAULT * 4)</span>
<a name="l00137"></a><a class="code" href="obd_8h.html#a13503def9c940f5b5fcdf403a1dc648f">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define OSC_MAX_DIRTY_MB_MAX    2048     </span><span class="comment">/* arbitrary, but &lt; MAX_LONG bytes */</span>
<a name="l00138"></a><a class="code" href="obd_8h.html#abdd7f0b620a46cd2b1a983231e65f139">00138</a> <span class="preprocessor">#define OSC_DEFAULT_RESENDS     10</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a>00140 <span class="comment">/* possible values for fo_sync_lock_cancel */</span>
<a name="l00141"></a>00141 <span class="keyword">enum</span> {
<a name="l00142"></a><a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a9939994082a116cd1690deb97521bd07">00142</a>         <a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a9939994082a116cd1690deb97521bd07">NEVER_SYNC_ON_CANCEL</a> = 0,
<a name="l00143"></a><a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a26befd19076e4846164954502fbb57cd">00143</a>         <a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a26befd19076e4846164954502fbb57cd">BLOCKING_SYNC_ON_CANCEL</a> = 1,
<a name="l00144"></a><a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a0863b7687b8f8f0ba75c251bb2d77b24">00144</a>         <a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a0863b7687b8f8f0ba75c251bb2d77b24">ALWAYS_SYNC_ON_CANCEL</a> = 2,
<a name="l00145"></a><a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a442241d59485c3fee1372266e9b38ca3">00145</a>         <a class="code" href="obd_8h.html#a5a77d65f4abba81d4456fa6ba8136e24a442241d59485c3fee1372266e9b38ca3">NUM_SYNC_ON_CANCEL_STATES</a>
<a name="l00146"></a>00146 };
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="comment">/*</span>
<a name="l00149"></a>00149 <span class="comment"> * Limit reply buffer size for striping data to one x86_64 page. This</span>
<a name="l00150"></a>00150 <span class="comment"> * value is chosen to fit the striping data for common use cases while</span>
<a name="l00151"></a>00151 <span class="comment"> * staying well below the limit at which the buffer must be backed by</span>
<a name="l00152"></a>00152 <span class="comment"> * vmalloc(). Excessive use of vmalloc() may cause spinlock contention</span>
<a name="l00153"></a>00153 <span class="comment"> * on the MDS.</span>
<a name="l00154"></a>00154 <span class="comment"> */</span>
<a name="l00155"></a><a class="code" href="obd_8h.html#af42551a071ba149711446718d97e85b0">00155</a> <span class="preprocessor">#define OBD_MAX_DEFAULT_EA_SIZE         4096</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>
<a name="l00157"></a>00157 <span class="keyword">struct </span><a class="code" href="structmdc__rpc__lock.html" title="Serializes in-flight MDT-modifying RPC requests to preserve idempotency.">mdc_rpc_lock</a>;
<a name="l00158"></a>00158 <span class="keyword">struct </span><a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a>;
<a name="l00159"></a><a class="code" href="structclient__obd.html">00159</a> <span class="keyword">struct </span><a class="code" href="structclient__obd.html">client_obd</a> {
<a name="l00160"></a><a class="code" href="structclient__obd.html#a844272def0bf7649701dde45586f7790">00160</a>         <span class="keyword">struct </span>rw_semaphore      <a class="code" href="structclient__obd.html#a844272def0bf7649701dde45586f7790">cl_sem</a>;
<a name="l00161"></a><a class="code" href="structclient__obd.html#ad3183ba07af6456a5af86b99dfbbec50">00161</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>          <a class="code" href="structclient__obd.html#ad3183ba07af6456a5af86b99dfbbec50">cl_target_uuid</a>;
<a name="l00162"></a><a class="code" href="structclient__obd.html#ad5a950b3c1fd9c233f13bb9c505493e9">00162</a>         <span class="keyword">struct </span><a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a>       *<a class="code" href="structclient__obd.html#ad5a950b3c1fd9c233f13bb9c505493e9">cl_import</a>; <span class="comment">/* ptlrpc connection state */</span>
<a name="l00163"></a><a class="code" href="structclient__obd.html#ae1c22964f30e38e39e738babc212ab09">00163</a>         <span class="keywordtype">size_t</span>                   <a class="code" href="structclient__obd.html#ae1c22964f30e38e39e738babc212ab09">cl_conn_count</a>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="comment">/* Cache maximum and default values for easize. This is</span>
<a name="l00166"></a>00166 <span class="comment">         * strictly a performance optimization to minimize calls to</span>
<a name="l00167"></a>00167 <span class="comment">         * obd_size_diskmd(). The default values are used to calculate the</span>
<a name="l00168"></a>00168 <span class="comment">         * initial size of a request buffer. The ptlrpc layer will resize the</span>
<a name="l00169"></a>00169 <span class="comment">         * buffer as needed to accommodate a larger reply from the</span>
<a name="l00170"></a>00170 <span class="comment">         * server. The default values should be small enough to avoid wasted</span>
<a name="l00171"></a>00171 <span class="comment">         * memory and excessive use of vmalloc(), yet large enough to avoid</span>
<a name="l00172"></a>00172 <span class="comment">         * reallocating the buffer in the common use case. */</span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         <span class="comment">/* Default EA size for striping attributes. It is initialized at</span>
<a name="l00175"></a>00175 <span class="comment">         * mount-time based on the default stripe width of the filesystem,</span>
<a name="l00176"></a>00176 <span class="comment">         * then it tracks the largest observed EA size advertised by</span>
<a name="l00177"></a>00177 <span class="comment">         * the MDT, up to a maximum value of OBD_MAX_DEFAULT_EA_SIZE. */</span>
<a name="l00178"></a><a class="code" href="structclient__obd.html#aab81c7f514f35567f42ecae66a11af61">00178</a>         __u32                    <a class="code" href="structclient__obd.html#aab81c7f514f35567f42ecae66a11af61">cl_default_mds_easize</a>;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">/* Maximum possible EA size computed at mount-time based on</span>
<a name="l00181"></a>00181 <span class="comment">         * the number of OSTs in the filesystem. May be increased at</span>
<a name="l00182"></a>00182 <span class="comment">         * run-time if a larger observed size is advertised by the MDT. */</span>
<a name="l00183"></a><a class="code" href="structclient__obd.html#a1a412b912aed53b0206e685b931ba0bf">00183</a>         __u32                    <a class="code" href="structclient__obd.html#a1a412b912aed53b0206e685b931ba0bf">cl_max_mds_easize</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="structclient__obd.html#abce5c34e51d62d1f96b53fe55c6b15fd">00185</a>         <span class="keyword">enum</span> <a class="code" href="group__sptlrpc.html#gaceeb8c40afd0179b5b42fc19aa58d177" title="identify the RPC is generated from what part of Lustre.">lustre_sec_part</a>     <a class="code" href="structclient__obd.html#abce5c34e51d62d1f96b53fe55c6b15fd">cl_sp_me</a>;
<a name="l00186"></a><a class="code" href="structclient__obd.html#a01923005a1c035c436848bdba4104130">00186</a>         <span class="keyword">enum</span> <a class="code" href="group__sptlrpc.html#gaceeb8c40afd0179b5b42fc19aa58d177" title="identify the RPC is generated from what part of Lustre.">lustre_sec_part</a>     <a class="code" href="structclient__obd.html#a01923005a1c035c436848bdba4104130">cl_sp_to</a>;
<a name="l00187"></a><a class="code" href="structclient__obd.html#a93ed8140c317fd8757a544d80325e7da">00187</a>         <span class="keyword">struct </span><a class="code" href="structsptlrpc__flavor.html" title="Full description of flavors being used on a ptlrpc connection, include both regular...">sptlrpc_flavor</a>    <a class="code" href="structclient__obd.html#a93ed8140c317fd8757a544d80325e7da">cl_flvr_mgc</a>; <span class="comment">/* fixed flavor of mgc-&gt;mgs */</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         <span class="comment">/* the grant values are protected by loi_list_lock below */</span>
<a name="l00190"></a><a class="code" href="structclient__obd.html#a099a0b3e3a52236fc126fe858fb4997e">00190</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#a099a0b3e3a52236fc126fe858fb4997e">cl_dirty_pages</a>;      <span class="comment">/* all _dirty_ in pages */</span>
<a name="l00191"></a><a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">00191</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a>;  <span class="comment">/* allowed w/o rpc */</span>
<a name="l00192"></a><a class="code" href="structclient__obd.html#a29cd12d24b5d5705368b6468c4f0edf2">00192</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#a29cd12d24b5d5705368b6468c4f0edf2">cl_dirty_transit</a>;    <span class="comment">/* dirty synchronous */</span>
<a name="l00193"></a><a class="code" href="structclient__obd.html#a4dc7afcfe4ced702cff6034f78c79e42">00193</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#a4dc7afcfe4ced702cff6034f78c79e42">cl_avail_grant</a>;   <span class="comment">/* bytes of credit for ost */</span>
<a name="l00194"></a><a class="code" href="structclient__obd.html#a33d90767f0a3f1ee3b71a625f4149b60">00194</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#a33d90767f0a3f1ee3b71a625f4149b60">cl_lost_grant</a>;    <span class="comment">/* lost credits (trunc) */</span>
<a name="l00195"></a>00195         <span class="comment">/* grant consumed for dirty pages */</span>
<a name="l00196"></a><a class="code" href="structclient__obd.html#ae6feb6dd584b7380588c1e3e0bbe2186">00196</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structclient__obd.html#ae6feb6dd584b7380588c1e3e0bbe2186">cl_dirty_grant</a>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         <span class="comment">/* since we allocate grant by blocks, we don&apos;t know how many grant will</span>
<a name="l00199"></a>00199 <span class="comment">         * be used to add a page into cache. As a solution, we reserve maximum</span>
<a name="l00200"></a>00200 <span class="comment">         * grant before trying to dirty a page and unreserve the rest.</span>
<a name="l00201"></a>00201 <span class="comment">         * See osc_{reserve|unreserve}_grant for details. */</span>
<a name="l00202"></a><a class="code" href="structclient__obd.html#ad4d9e33b8a49ad85d43f3dbcef54c537">00202</a>         <span class="keywordtype">long</span>                    <a class="code" href="structclient__obd.html#ad4d9e33b8a49ad85d43f3dbcef54c537">cl_reserved_grant</a>;
<a name="l00203"></a><a class="code" href="structclient__obd.html#a722ad02b16131a6676447f5b10c7e122">00203</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#a722ad02b16131a6676447f5b10c7e122">cl_cache_waiters</a>; <span class="comment">/* waiting for cache/grant */</span>
<a name="l00204"></a><a class="code" href="structclient__obd.html#a122c5b6799ac27d81dbcf904870d644a">00204</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structclient__obd.html#a122c5b6799ac27d81dbcf904870d644a">cl_next_shrink_grant</a>;   <span class="comment">/* jiffies */</span>
<a name="l00205"></a><a class="code" href="structclient__obd.html#a287a98e17209970f8a5aa31640d779d5">00205</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#a287a98e17209970f8a5aa31640d779d5">cl_grant_shrink_list</a>;  <span class="comment">/* Timeout event list */</span>
<a name="l00206"></a><a class="code" href="structclient__obd.html#a68c434687e978b3dea389b2fc77720a6">00206</a>         <span class="keywordtype">int</span>                     <a class="code" href="structclient__obd.html#a68c434687e978b3dea389b2fc77720a6">cl_grant_shrink_interval</a>; <span class="comment">/* seconds */</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="comment">/* A chunk is an optimal size used by osc_extent to determine</span>
<a name="l00209"></a>00209 <span class="comment">         * the extent size. A chunk is max(PAGE_CACHE_SIZE, OST block size) */</span>
<a name="l00210"></a><a class="code" href="structclient__obd.html#a1826151625d8a950ceab2efae07104ff">00210</a>         <span class="keywordtype">int</span>                     <a class="code" href="structclient__obd.html#a1826151625d8a950ceab2efae07104ff">cl_chunkbits</a>;
<a name="l00211"></a>00211         <span class="comment">/* extent insertion metadata overhead to be accounted in grant,</span>
<a name="l00212"></a>00212 <span class="comment">         * in bytes */</span>
<a name="l00213"></a><a class="code" href="structclient__obd.html#a38703e31976ac138139b069eead15629">00213</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structclient__obd.html#a38703e31976ac138139b069eead15629">cl_grant_extent_tax</a>;
<a name="l00214"></a>00214         <span class="comment">/* maximum extent size, in number of pages */</span>
<a name="l00215"></a><a class="code" href="structclient__obd.html#a02de84b13d16e0a263ebbefe61230cf1">00215</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structclient__obd.html#a02de84b13d16e0a263ebbefe61230cf1">cl_max_extent_pages</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="comment">/* keep track of objects that have lois that contain pages which</span>
<a name="l00218"></a>00218 <span class="comment">         * have been queued for async brw.  this lock also protects the</span>
<a name="l00219"></a>00219 <span class="comment">         * lists of osc_client_pages that hang off of the loi */</span>
<a name="l00220"></a>00220         <span class="comment">/*</span>
<a name="l00221"></a>00221 <span class="comment">         * -&gt;cl_loi_list_lock protects consistency of</span>
<a name="l00222"></a>00222 <span class="comment">         * -&gt;cl_loi_{ready,read,write}_list. -&gt;ap_make_ready() and</span>
<a name="l00223"></a>00223 <span class="comment">         * -&gt;ap_completion() call-backs are executed under this lock. As we</span>
<a name="l00224"></a>00224 <span class="comment">         * cannot guarantee that these call-backs never block on all platforms</span>
<a name="l00225"></a>00225 <span class="comment">         * (as a matter of fact they do block on Mac OS X), type of</span>
<a name="l00226"></a>00226 <span class="comment">         * -&gt;cl_loi_list_lock is platform dependent: it&apos;s a spin-lock on Linux</span>
<a name="l00227"></a>00227 <span class="comment">         * and blocking mutex on Mac OS X. (Alternative is to make this lock</span>
<a name="l00228"></a>00228 <span class="comment">         * blocking everywhere, but we don&apos;t want to slow down fast-path of</span>
<a name="l00229"></a>00229 <span class="comment">         * our main platform.)</span>
<a name="l00230"></a>00230 <span class="comment">         *</span>
<a name="l00231"></a>00231 <span class="comment">         * NB by Jinshan: though field names are still _loi_, but actually</span>
<a name="l00232"></a>00232 <span class="comment">         * osc_object{}s are in the list.</span>
<a name="l00233"></a>00233 <span class="comment">         */</span>
<a name="l00234"></a><a class="code" href="structclient__obd.html#a9cd06f353bf75514ab279d46fa30b26d">00234</a>         spinlock_t              <a class="code" href="structclient__obd.html#a9cd06f353bf75514ab279d46fa30b26d">cl_loi_list_lock</a>;
<a name="l00235"></a><a class="code" href="structclient__obd.html#afba14d439840d4aee82ce9ac28df0ae3">00235</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#afba14d439840d4aee82ce9ac28df0ae3">cl_loi_ready_list</a>;
<a name="l00236"></a><a class="code" href="structclient__obd.html#a8396cc7ebf0b414c4ab140eaac228731">00236</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#a8396cc7ebf0b414c4ab140eaac228731">cl_loi_hp_ready_list</a>;
<a name="l00237"></a><a class="code" href="structclient__obd.html#a10aecd518ef0b24a6bdf7550438d5463">00237</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#a10aecd518ef0b24a6bdf7550438d5463">cl_loi_write_list</a>;
<a name="l00238"></a><a class="code" href="structclient__obd.html#a9efb728193b2aabc5d39b371d210d62d">00238</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structclient__obd.html#a9efb728193b2aabc5d39b371d210d62d">cl_loi_read_list</a>;
<a name="l00239"></a><a class="code" href="structclient__obd.html#a557165b1961d70ca9a09a83f70e33f70">00239</a>         __u32                   <a class="code" href="structclient__obd.html#a557165b1961d70ca9a09a83f70e33f70">cl_r_in_flight</a>;
<a name="l00240"></a><a class="code" href="structclient__obd.html#ad0503c92679f7b9827471f0ff62f5a87">00240</a>         __u32                   <a class="code" href="structclient__obd.html#ad0503c92679f7b9827471f0ff62f5a87">cl_w_in_flight</a>;
<a name="l00241"></a>00241         <span class="comment">/* just a sum of the loi/lop pending numbers to be exported by /proc */</span>
<a name="l00242"></a><a class="code" href="structclient__obd.html#a86f6f3280af384486265d508157dafdd">00242</a>         atomic_t                <a class="code" href="structclient__obd.html#a86f6f3280af384486265d508157dafdd">cl_pending_w_pages</a>;
<a name="l00243"></a><a class="code" href="structclient__obd.html#ab0854f506666f7b437bcde9134363bc9">00243</a>         atomic_t                <a class="code" href="structclient__obd.html#ab0854f506666f7b437bcde9134363bc9">cl_pending_r_pages</a>;
<a name="l00244"></a><a class="code" href="structclient__obd.html#abff4a86d64e35b98676a458209cb9258">00244</a>         __u32                   <a class="code" href="structclient__obd.html#abff4a86d64e35b98676a458209cb9258">cl_max_pages_per_rpc</a>;
<a name="l00245"></a><a class="code" href="structclient__obd.html#a8e77a281528593754771125a793b0cec">00245</a>         __u32                   <a class="code" href="structclient__obd.html#a8e77a281528593754771125a793b0cec">cl_max_rpcs_in_flight</a>;
<a name="l00246"></a><a class="code" href="structclient__obd.html#aa8bda1951d8690547373ef0340305763">00246</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#aa8bda1951d8690547373ef0340305763">cl_read_rpc_hist</a>;
<a name="l00247"></a><a class="code" href="structclient__obd.html#a2faefe011df31d76479d56249dfdfe34">00247</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#a2faefe011df31d76479d56249dfdfe34">cl_write_rpc_hist</a>;
<a name="l00248"></a><a class="code" href="structclient__obd.html#aa14fa0a9411028286dad62ee856ae568">00248</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#aa14fa0a9411028286dad62ee856ae568">cl_read_page_hist</a>;
<a name="l00249"></a><a class="code" href="structclient__obd.html#a1e76041c06a378810a2186ae957469a9">00249</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#a1e76041c06a378810a2186ae957469a9">cl_write_page_hist</a>;
<a name="l00250"></a><a class="code" href="structclient__obd.html#a2523b79650040867ea69db160ff036cc">00250</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#a2523b79650040867ea69db160ff036cc">cl_read_offset_hist</a>;
<a name="l00251"></a><a class="code" href="structclient__obd.html#a7bb21061a8b7063f1de70b4a642d9e0f">00251</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>    <a class="code" href="structclient__obd.html#a7bb21061a8b7063f1de70b4a642d9e0f">cl_write_offset_hist</a>;
<a name="l00252"></a>00252 
<a name="l00254"></a><a class="code" href="structclient__obd.html#a54a7cb17572c1e55c384911366940382">00254</a>         <span class="keyword">struct </span><a class="code" href="structcl__client__cache.html" title="Data structure managing a client&amp;#39;s cached pages.">cl_client_cache</a>  *<a class="code" href="structclient__obd.html#a54a7cb17572c1e55c384911366940382" title="LRU for osc caching pages.">cl_cache</a>;
<a name="l00256"></a><a class="code" href="structclient__obd.html#a6dbc88017907bde436c4a1a33ceb4060">00256</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structclient__obd.html#a6dbc88017907bde436c4a1a33ceb4060" title="member of cl_cache-&amp;gt;ccc_lru">cl_lru_osc</a>;
<a name="l00260"></a><a class="code" href="structclient__obd.html#ac7a50799f915bc96e39e00dfe045e3ce">00260</a>         atomic_long_t           *<a class="code" href="structclient__obd.html#ac7a50799f915bc96e39e00dfe045e3ce" title="# of available LRU slots left in the per-OSC cache.">cl_lru_left</a>;
<a name="l00264"></a><a class="code" href="structclient__obd.html#a2570ada40488ca5becf30dd69bd17add">00264</a>         atomic_long_t            <a class="code" href="structclient__obd.html#a2570ada40488ca5becf30dd69bd17add" title="# of busy LRU pages.">cl_lru_busy</a>;
<a name="l00266"></a><a class="code" href="structclient__obd.html#ac9f92301393a89d78fc95a70d3bfe390">00266</a>         atomic_long_t            <a class="code" href="structclient__obd.html#ac9f92301393a89d78fc95a70d3bfe390" title="# of LRU pages in the cache for this client_obd">cl_lru_in_list</a>;
<a name="l00269"></a><a class="code" href="structclient__obd.html#a0f0b10f102c86214c6ace7570d19c1a8">00269</a>         atomic_t                 <a class="code" href="structclient__obd.html#a0f0b10f102c86214c6ace7570d19c1a8" title="# of threads are shrinking LRU cache.">cl_lru_shrinkers</a>;
<a name="l00271"></a><a class="code" href="structclient__obd.html#aacbf98227a4aa8410f6a1af1b849e9ec">00271</a>         time_t                   <a class="code" href="structclient__obd.html#aacbf98227a4aa8410f6a1af1b849e9ec" title="The time when this LRU cache was last used.">cl_lru_last_used</a>;
<a name="l00276"></a><a class="code" href="structclient__obd.html#ad67142e92d4145f59d7884e14f0facb4">00276</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structclient__obd.html#ad67142e92d4145f59d7884e14f0facb4" title="stats: how many reclaims have happened for this client_obd.">cl_lru_reclaim</a>;
<a name="l00278"></a><a class="code" href="structclient__obd.html#a769643954836cddbb0d37e997b6cd5c9">00278</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structclient__obd.html#a769643954836cddbb0d37e997b6cd5c9" title="List of LRU pages for this client_obd.">cl_lru_list</a>;
<a name="l00280"></a><a class="code" href="structclient__obd.html#a0aa997fa07d6049932d1955fc938e9db">00280</a>         spinlock_t               <a class="code" href="structclient__obd.html#a0aa997fa07d6049932d1955fc938e9db" title="Lock for LRU page list.">cl_lru_list_lock</a>;
<a name="l00284"></a><a class="code" href="structclient__obd.html#a4757a1bb410e50bd8c828cc497e45734">00284</a>         atomic_long_t            <a class="code" href="structclient__obd.html#a4757a1bb410e50bd8c828cc497e45734" title="# of unstable pages in this client_obd.">cl_unstable_count</a>;
<a name="l00286"></a><a class="code" href="structclient__obd.html#a14ec05e4781d916049029a0976da1eb9">00286</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structclient__obd.html#a14ec05e4781d916049029a0976da1eb9" title="Link to osc_shrinker_list.">cl_shrink_list</a>;
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="comment">/* number of in flight destroy rpcs is limited to max_rpcs_in_flight */</span>
<a name="l00289"></a><a class="code" href="structclient__obd.html#a03c4719497f2fb8c580f07f1ddf6d392">00289</a>         atomic_t                 <a class="code" href="structclient__obd.html#a03c4719497f2fb8c580f07f1ddf6d392">cl_destroy_in_flight</a>;
<a name="l00290"></a><a class="code" href="structclient__obd.html#ac978cfbd69b004af84ab98ff932c6c30">00290</a>         wait_queue_head_t        <a class="code" href="structclient__obd.html#ac978cfbd69b004af84ab98ff932c6c30">cl_destroy_waitq</a>;
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="structclient__obd.html#a51bd062b45333be8f99f2f9de7e4e026">00292</a>         <span class="keyword">struct </span><a class="code" href="structmdc__rpc__lock.html" title="Serializes in-flight MDT-modifying RPC requests to preserve idempotency.">mdc_rpc_lock</a>     *<a class="code" href="structclient__obd.html#a51bd062b45333be8f99f2f9de7e4e026">cl_rpc_lock</a>;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">/* modify rpcs in flight</span>
<a name="l00295"></a>00295 <span class="comment">         * currently used for metadata only */</span>
<a name="l00296"></a><a class="code" href="structclient__obd.html#ae8c79fef347fb60d2967f9b890d10627">00296</a>         spinlock_t               <a class="code" href="structclient__obd.html#ae8c79fef347fb60d2967f9b890d10627">cl_mod_rpcs_lock</a>;
<a name="l00297"></a><a class="code" href="structclient__obd.html#a9aab60485ca24f45546447d3521bbe59">00297</a>         __u16                    <a class="code" href="structclient__obd.html#a9aab60485ca24f45546447d3521bbe59">cl_max_mod_rpcs_in_flight</a>;
<a name="l00298"></a><a class="code" href="structclient__obd.html#ac5e42d2c8368459bf271beea7c3bc2dc">00298</a>         __u16                    <a class="code" href="structclient__obd.html#ac5e42d2c8368459bf271beea7c3bc2dc">cl_mod_rpcs_in_flight</a>;
<a name="l00299"></a><a class="code" href="structclient__obd.html#af8d57530b1440e8780a7b9d6e864b625">00299</a>         __u16                    <a class="code" href="structclient__obd.html#af8d57530b1440e8780a7b9d6e864b625">cl_close_rpcs_in_flight</a>;
<a name="l00300"></a><a class="code" href="structclient__obd.html#abd40cc339a5167aa11d47276545939fb">00300</a>         wait_queue_head_t        <a class="code" href="structclient__obd.html#abd40cc339a5167aa11d47276545939fb">cl_mod_rpcs_waitq</a>;
<a name="l00301"></a><a class="code" href="structclient__obd.html#a48ea2bcba0da69df5995b7b17f075f5b">00301</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           *<a class="code" href="structclient__obd.html#a48ea2bcba0da69df5995b7b17f075f5b">cl_mod_tag_bitmap</a>;
<a name="l00302"></a><a class="code" href="structclient__obd.html#ace0f12fa2d7155631778d33c1323cfa3">00302</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a>     <a class="code" href="structclient__obd.html#ace0f12fa2d7155631778d33c1323cfa3">cl_mod_rpcs_hist</a>;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304         <span class="comment">/* mgc datastruct */</span>
<a name="l00305"></a><a class="code" href="structclient__obd.html#a0a17c64fab403ba9d53984cd7e1668c4">00305</a>         <span class="keyword">struct </span>mutex              <a class="code" href="structclient__obd.html#a0a17c64fab403ba9d53984cd7e1668c4">cl_mgc_mutex</a>;
<a name="l00306"></a><a class="code" href="structclient__obd.html#a6a02170461689f33080e83170e71d3ac">00306</a>         <span class="keyword">struct </span><a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *<a class="code" href="structclient__obd.html#a6a02170461689f33080e83170e71d3ac">cl_mgc_los</a>;
<a name="l00307"></a><a class="code" href="structclient__obd.html#ae440a4a19b3bcff81d9c08f20a3e752a">00307</a>         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>         *<a class="code" href="structclient__obd.html#ae440a4a19b3bcff81d9c08f20a3e752a">cl_mgc_configs_dir</a>;
<a name="l00308"></a><a class="code" href="structclient__obd.html#a5064b390656a0ca45a52e44e169c4ea0">00308</a>         atomic_t                  <a class="code" href="structclient__obd.html#a5064b390656a0ca45a52e44e169c4ea0">cl_mgc_refcount</a>;
<a name="l00309"></a><a class="code" href="structclient__obd.html#ab881f2fcc3449d05f0c633b7109574fc">00309</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>        *<a class="code" href="structclient__obd.html#ab881f2fcc3449d05f0c633b7109574fc">cl_mgc_mgsexp</a>;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="comment">/* checksumming for data sent over the network */</span>
<a name="l00312"></a><a class="code" href="structclient__obd.html#ab9fc69c90ebb5cec44ce5cc157052e9f">00312</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             <a class="code" href="structclient__obd.html#ab9fc69c90ebb5cec44ce5cc157052e9f">cl_checksum</a>:1; <span class="comment">/* 0 = disabled, 1 = enabled */</span>
<a name="l00313"></a>00313         <span class="comment">/* supported checksum types that are worked out at connect time */</span>
<a name="l00314"></a><a class="code" href="structclient__obd.html#aa015ac32f714837b6d8ce73f65a5210e">00314</a>         __u32                    <a class="code" href="structclient__obd.html#aa015ac32f714837b6d8ce73f65a5210e">cl_supp_cksum_types</a>;
<a name="l00315"></a>00315         <span class="comment">/* checksum algorithm to be used */</span>
<a name="l00316"></a><a class="code" href="structclient__obd.html#ae9cd2cc4017f6e76586f257d63664633">00316</a>         <a class="code" href="group__lustreidl.html#ga86f1ec8087bf1bf82585bcc3a023c7fc">cksum_type_t</a>             <a class="code" href="structclient__obd.html#ae9cd2cc4017f6e76586f257d63664633">cl_cksum_type</a>;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318         <span class="comment">/* also protected by the poorly named _loi_list_lock lock above */</span>
<a name="l00319"></a><a class="code" href="structclient__obd.html#af5d34a6cbc30971f46e0a389a0be93f5">00319</a>         <span class="keyword">struct </span><a class="code" href="structosc__async__rc.html">osc_async_rc</a>      <a class="code" href="structclient__obd.html#af5d34a6cbc30971f46e0a389a0be93f5">cl_ar</a>;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321         <span class="comment">/* sequence manager */</span>
<a name="l00322"></a><a class="code" href="structclient__obd.html#a556279c4457a8159f96bfecc0e78c875">00322</a>         <span class="keyword">struct </span><a class="code" href="structlu__client__seq.html">lu_client_seq</a>    *<a class="code" href="structclient__obd.html#a556279c4457a8159f96bfecc0e78c875">cl_seq</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a><a class="code" href="structclient__obd.html#aa13b24aec435376f87689a345cd88969">00324</a>         atomic_t             <a class="code" href="structclient__obd.html#aa13b24aec435376f87689a345cd88969">cl_resends</a>; <span class="comment">/* resend count */</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <span class="comment">/* ptlrpc work for writeback in ptlrpcd context */</span>
<a name="l00327"></a><a class="code" href="structclient__obd.html#ac85623a7092c24f11dfdb73ed4d681ad">00327</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structclient__obd.html#ac85623a7092c24f11dfdb73ed4d681ad">cl_writeback_work</a>;
<a name="l00328"></a><a class="code" href="structclient__obd.html#a0a9635af1297ecb0d95df838d414a77b">00328</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structclient__obd.html#a0a9635af1297ecb0d95df838d414a77b">cl_lru_work</a>;
<a name="l00329"></a>00329         <span class="comment">/* hash tables for osc_quota_info */</span>
<a name="l00330"></a><a class="code" href="structclient__obd.html#ad02670c1aec7df8f0b7b501044b72f6a">00330</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>         *<a class="code" href="structclient__obd.html#ad02670c1aec7df8f0b7b501044b72f6a">cl_quota_hash</a>[MAXQUOTAS];
<a name="l00331"></a>00331 };
<a name="l00332"></a><a class="code" href="obd_8h.html#a2f78844a2990c9d3de540a098f26264e">00332</a> <span class="preprocessor">#define obd2cli_tgt(obd) ((char *)(obd)-&gt;u.cli.cl_target_uuid.uuid)</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>
<a name="l00334"></a><a class="code" href="structobd__id__info.html">00334</a> <span class="keyword">struct </span><a class="code" href="structobd__id__info.html">obd_id_info</a> {
<a name="l00335"></a><a class="code" href="structobd__id__info.html#ae18b92907ac11e0a937eac9a14789a4b">00335</a>         u32      <a class="code" href="structobd__id__info.html#ae18b92907ac11e0a937eac9a14789a4b">idx</a>;
<a name="l00336"></a><a class="code" href="structobd__id__info.html#a4c9ba694a67080646619f659a8496914">00336</a>         u64     *<a class="code" href="structobd__id__info.html#a4c9ba694a67080646619f659a8496914">data</a>;
<a name="l00337"></a>00337 };
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="structecho__client__obd.html">00339</a> <span class="keyword">struct </span><a class="code" href="structecho__client__obd.html">echo_client_obd</a> {
<a name="l00340"></a><a class="code" href="structecho__client__obd.html#a54d756d4e878865590f0b52ecda44161">00340</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>      *<a class="code" href="structecho__client__obd.html#a54d756d4e878865590f0b52ecda44161">ec_exp</a>; <span class="comment">/* the local connection to osc/lov */</span>
<a name="l00341"></a><a class="code" href="structecho__client__obd.html#aff1e1e895f57347820fdd8886973404b">00341</a>         spinlock_t              <a class="code" href="structecho__client__obd.html#aff1e1e895f57347820fdd8886973404b">ec_lock</a>;
<a name="l00342"></a><a class="code" href="structecho__client__obd.html#ac471eae44276d5bcb5179c27eed1ec83">00342</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structecho__client__obd.html#ac471eae44276d5bcb5179c27eed1ec83">ec_objects</a>;
<a name="l00343"></a><a class="code" href="structecho__client__obd.html#a2003a5e1d4377a80e40eed1b963938e5">00343</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structecho__client__obd.html#a2003a5e1d4377a80e40eed1b963938e5">ec_locks</a>;
<a name="l00344"></a><a class="code" href="structecho__client__obd.html#a034e31846eaeca7e98042962e855fda5">00344</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structecho__client__obd.html#a034e31846eaeca7e98042962e855fda5">ec_unique</a>;
<a name="l00345"></a>00345 };
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">/* Generic subset of OSTs */</span>
<a name="l00348"></a><a class="code" href="structost__pool.html">00348</a> <span class="keyword">struct </span><a class="code" href="structost__pool.html">ost_pool</a> {
<a name="l00349"></a><a class="code" href="structost__pool.html#aa34253b9b1bf5f8ffc3b00aafcd490d1">00349</a>         __u32              *<a class="code" href="structost__pool.html#aa34253b9b1bf5f8ffc3b00aafcd490d1">op_array</a>;      <span class="comment">/* array of index of</span>
<a name="l00350"></a>00350 <span class="comment">                                                   lov_obd-&gt;lov_tgts */</span>
<a name="l00351"></a><a class="code" href="structost__pool.html#a642dbef96d4109035969f8fe6bf81a35">00351</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="structost__pool.html#a642dbef96d4109035969f8fe6bf81a35">op_count</a>;      <span class="comment">/* number of OSTs in the array */</span>
<a name="l00352"></a><a class="code" href="structost__pool.html#af519518b3702868b1745d18f6c09e883">00352</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="structost__pool.html#af519518b3702868b1745d18f6c09e883">op_size</a>;       <span class="comment">/* allocated size of lp_array */</span>
<a name="l00353"></a><a class="code" href="structost__pool.html#aa9670591e6b9b67187fbf8cc4ddc778b">00353</a>         <span class="keyword">struct </span>rw_semaphore <a class="code" href="structost__pool.html#aa9670591e6b9b67187fbf8cc4ddc778b">op_rw_sem</a>;     <span class="comment">/* to protect ost_pool use */</span>
<a name="l00354"></a>00354 };
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="comment">/* allow statfs data caching for 1 second */</span>
<a name="l00357"></a><a class="code" href="obd_8h.html#aa4599266fbff3d46d087ece4abef9a56">00357</a> <span class="preprocessor">#define OBD_STATFS_CACHE_SECONDS 1</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>
<a name="l00359"></a><a class="code" href="structlov__tgt__desc.html">00359</a> <span class="keyword">struct </span><a class="code" href="structlov__tgt__desc.html">lov_tgt_desc</a> {
<a name="l00360"></a><a class="code" href="structlov__tgt__desc.html#a72b1d04f163441433acd6dd18034b2f3">00360</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structlov__tgt__desc.html#a72b1d04f163441433acd6dd18034b2f3">ltd_kill</a>;
<a name="l00361"></a><a class="code" href="structlov__tgt__desc.html#a020a8b90ccc6f0faa5ad35873f3634c1">00361</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>     <a class="code" href="structlov__tgt__desc.html#a020a8b90ccc6f0faa5ad35873f3634c1">ltd_uuid</a>;
<a name="l00362"></a><a class="code" href="structlov__tgt__desc.html#aecf728298737f53043f4c73136923810">00362</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>  *<a class="code" href="structlov__tgt__desc.html#aecf728298737f53043f4c73136923810">ltd_obd</a>;
<a name="l00363"></a><a class="code" href="structlov__tgt__desc.html#ab75788f1f78d743f7a5ff431b6652f5d">00363</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>  *<a class="code" href="structlov__tgt__desc.html#ab75788f1f78d743f7a5ff431b6652f5d">ltd_exp</a>;
<a name="l00364"></a><a class="code" href="structlov__tgt__desc.html#ae4e12730738acc622cd33ac938970caa">00364</a>         __u32               <a class="code" href="structlov__tgt__desc.html#ae4e12730738acc622cd33ac938970caa">ltd_gen</a>;
<a name="l00365"></a><a class="code" href="structlov__tgt__desc.html#a1720aaba1b2aa31519692f51645deb05">00365</a>         __u32               <a class="code" href="structlov__tgt__desc.html#a1720aaba1b2aa31519692f51645deb05">ltd_index</a>;   <span class="comment">/* index in lov_obd-&gt;tgts */</span>
<a name="l00366"></a><a class="code" href="structlov__tgt__desc.html#a5245a3e7ac6eb0f789a533da8d768b77">00366</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structlov__tgt__desc.html#a0570116c969922f68655e79b188bf2c9">ltd_active</a>:1,<span class="comment">/* is this target up for requests */</span>
<a name="l00367"></a>00367                             <a class="code" href="structlov__tgt__desc.html#aaf8cafe1357b128b1f56f7eb767141ec">ltd_activate</a>:1,<span class="comment">/* should  target be activated */</span>
<a name="l00368"></a>00368                             <a class="code" href="structlov__tgt__desc.html#a5245a3e7ac6eb0f789a533da8d768b77">ltd_reap</a>:1;  <span class="comment">/* should this target be deleted */</span>
<a name="l00369"></a>00369 };
<a name="l00370"></a>00370 
<a name="l00371"></a><a class="code" href="structlov__obd.html">00371</a> <span class="keyword">struct </span><a class="code" href="structlov__obd.html">lov_obd</a> {
<a name="l00372"></a><a class="code" href="structlov__obd.html#ac0068c71ca8df1759c5a9cf0843d4535">00372</a>         <span class="keyword">struct </span><a class="code" href="structlov__desc.html">lov_desc</a>         <a class="code" href="structlov__obd.html#ac0068c71ca8df1759c5a9cf0843d4535">desc</a>;
<a name="l00373"></a><a class="code" href="structlov__obd.html#a3005cc9dd368a7771b7c7cd9d6a50b4e">00373</a>         <span class="keyword">struct </span><a class="code" href="structlov__tgt__desc.html">lov_tgt_desc</a>   **<a class="code" href="structlov__obd.html#a3005cc9dd368a7771b7c7cd9d6a50b4e">lov_tgts</a>;               <span class="comment">/* sparse array */</span>
<a name="l00374"></a><a class="code" href="structlov__obd.html#a74cd0caf4154497c272919c5d6393298">00374</a>         <span class="keyword">struct </span><a class="code" href="structost__pool.html">ost_pool</a>         <a class="code" href="structlov__obd.html#a74cd0caf4154497c272919c5d6393298">lov_packed</a>;             <span class="comment">/* all OSTs in a packed</span>
<a name="l00375"></a>00375 <span class="comment">                                                           array */</span>
<a name="l00376"></a><a class="code" href="structlov__obd.html#ad4d4ebe8a88350fd84478826340461dd">00376</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structlov__lock.html" title="lov-specific lock state.">lov_lock</a>;
<a name="l00377"></a><a class="code" href="structlov__obd.html#ab8d1e10bad6c58e07940b6f4f79c1cac">00377</a>         <span class="keyword">struct </span><a class="code" href="structobd__connect__data.html">obd_connect_data</a> <a class="code" href="structlov__obd.html#ab8d1e10bad6c58e07940b6f4f79c1cac">lov_ocd</a>;
<a name="l00378"></a><a class="code" href="structlov__obd.html#a7a972b82f9f54b51657455611356f428">00378</a>         <span class="keyword">struct </span>proc_dir_entry  *<a class="code" href="structlov__obd.html#a7a972b82f9f54b51657455611356f428">targets_proc_entry</a>;
<a name="l00379"></a><a class="code" href="structlov__obd.html#a14d2bec57b9d330ac1a5e3cedc028c43">00379</a>         atomic_t                <a class="code" href="structlov__obd.html#a14d2bec57b9d330ac1a5e3cedc028c43">lov_refcount</a>;
<a name="l00380"></a><a class="code" href="structlov__obd.html#ad4e6e31dd0c902c1977353eacf8fac6a">00380</a>         __u32                   <a class="code" href="structlov__obd.html#ad4e6e31dd0c902c1977353eacf8fac6a">lov_death_row</a>;  <span class="comment">/* tgts scheduled to be deleted */</span>
<a name="l00381"></a><a class="code" href="structlov__obd.html#ad769efed8bef10ad81a2fc88d4770f63">00381</a>         __u32                   <a class="code" href="structlov__obd.html#ad769efed8bef10ad81a2fc88d4770f63">lov_tgt_size</a>;   <span class="comment">/* size of tgts array */</span>
<a name="l00382"></a><a class="code" href="structlov__obd.html#a6ff06b04f09eeefa280f2f315d01c305">00382</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlov__obd.html#a6ff06b04f09eeefa280f2f315d01c305">lov_connects</a>;
<a name="l00383"></a><a class="code" href="structlov__obd.html#a94fe6c01f54a859dd1cde184d17842a0">00383</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlov__obd.html#a94fe6c01f54a859dd1cde184d17842a0">lov_pool_count</a>;
<a name="l00384"></a><a class="code" href="structlov__obd.html#af00a5b77449cce7e1f9cd314194c14f6">00384</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>        *<a class="code" href="structlov__obd.html#af00a5b77449cce7e1f9cd314194c14f6">lov_pools_hash_body</a>; <span class="comment">/* used for key access */</span>
<a name="l00385"></a><a class="code" href="structlov__obd.html#a8ccdcdac03003fa110ac2a0f7bca9d2b">00385</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structlov__obd.html#a8ccdcdac03003fa110ac2a0f7bca9d2b">lov_pool_list</a>;  <span class="comment">/* used for sequential access */</span>
<a name="l00386"></a><a class="code" href="structlov__obd.html#a7c6989b57efd123b1c9aeba4bf77d042">00386</a>         <span class="keyword">struct </span>proc_dir_entry  *<a class="code" href="structlov__obd.html#a7c6989b57efd123b1c9aeba4bf77d042">lov_pool_proc_entry</a>;
<a name="l00387"></a><a class="code" href="structlov__obd.html#ad4e7a15a99db09e288e9f866693ba5b8">00387</a>         <span class="keyword">enum</span> <a class="code" href="group__sptlrpc.html#gaceeb8c40afd0179b5b42fc19aa58d177" title="identify the RPC is generated from what part of Lustre.">lustre_sec_part</a>    <a class="code" href="structlov__obd.html#ad4e7a15a99db09e288e9f866693ba5b8">lov_sp_me</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">/* Cached LRU and unstable data from upper layer */</span>
<a name="l00390"></a><a class="code" href="structlov__obd.html#ab6adc04e3039caed45fab734ac760a8a">00390</a>         <span class="keyword">struct </span><a class="code" href="structcl__client__cache.html" title="Data structure managing a client&amp;#39;s cached pages.">cl_client_cache</a> *<a class="code" href="structlov__obd.html#ab6adc04e3039caed45fab734ac760a8a">lov_cache</a>;
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="structlov__obd.html#a555096d4f4e7227824802c3be6bfb4f1">00392</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structlov__obd.html#a555096d4f4e7227824802c3be6bfb4f1">lov_notify_lock</a>;
<a name="l00393"></a>00393 };
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="structlmv__tgt__desc.html">00395</a> <span class="keyword">struct </span><a class="code" href="structlmv__tgt__desc.html">lmv_tgt_desc</a> {
<a name="l00396"></a><a class="code" href="structlmv__tgt__desc.html#a2f1adcd9d6e70d041edb8c7954fe578b">00396</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>         <a class="code" href="structlmv__tgt__desc.html#a2f1adcd9d6e70d041edb8c7954fe578b">ltd_uuid</a>;
<a name="l00397"></a><a class="code" href="structlmv__tgt__desc.html#aaf1c4bb06a44439c873e00ba4eab0edc">00397</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structlmv__tgt__desc.html#aaf1c4bb06a44439c873e00ba4eab0edc">ltd_exp</a>;
<a name="l00398"></a><a class="code" href="structlmv__tgt__desc.html#a2938df43a26a6306d1e0c5016a1437e1">00398</a>         __u32                   <a class="code" href="structlmv__tgt__desc.html#a2938df43a26a6306d1e0c5016a1437e1">ltd_idx</a>;
<a name="l00399"></a><a class="code" href="structlmv__tgt__desc.html#ac20324135fb3bf41a54bdd4f6e6c9649">00399</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structlmv__tgt__desc.html#ac20324135fb3bf41a54bdd4f6e6c9649">ltd_fid_mutex</a>;
<a name="l00400"></a><a class="code" href="structlmv__tgt__desc.html#a87a0e31c6c107af9350f0954407e76fa">00400</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structlmv__tgt__desc.html#a87a0e31c6c107af9350f0954407e76fa">ltd_active</a>:1; <span class="comment">/* target up for requests */</span>
<a name="l00401"></a>00401 };
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566e">00403</a> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566e">placement_policy</a> {
<a name="l00404"></a><a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566eae1c47edeb4b16f3878d6b8056442f185">00404</a>         <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566eae1c47edeb4b16f3878d6b8056442f185">PLACEMENT_CHAR_POLICY</a>   = 0,
<a name="l00405"></a><a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566ea0496c881304db61527badfe2bfbb0d63">00405</a>         <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566ea0496c881304db61527badfe2bfbb0d63">PLACEMENT_NID_POLICY</a>    = 1,
<a name="l00406"></a><a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566eae3e1a8c88880ae8dfa23563d6aa31ae4">00406</a>         <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566eae3e1a8c88880ae8dfa23563d6aa31ae4">PLACEMENT_INVAL_POLICY</a>  = 2,
<a name="l00407"></a><a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566ea7e349ead3ca8111353bef9b4bb4d717a">00407</a>         <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566ea7e349ead3ca8111353bef9b4bb4d717a">PLACEMENT_MAX_POLICY</a>
<a name="l00408"></a>00408 };
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="obd_8h.html#ad0b7d8cdbdf0006cde862b07f993a6d8">00410</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a3f1ab6b546fba97769b6bf4a50a2566e">placement_policy</a> <a class="code" href="obd_8h.html#ad0b7d8cdbdf0006cde862b07f993a6d8">placement_policy_t</a>;
<a name="l00411"></a>00411 
<a name="l00412"></a><a class="code" href="structlmv__obd.html">00412</a> <span class="keyword">struct </span><a class="code" href="structlmv__obd.html">lmv_obd</a> {
<a name="l00413"></a><a class="code" href="structlmv__obd.html#a0d4f1d2397e4ea3f75c39626943be65e">00413</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlmv__obd.html#a0d4f1d2397e4ea3f75c39626943be65e">refcount</a>;
<a name="l00414"></a><a class="code" href="structlmv__obd.html#a6a04fc1150ffd264c7540a08870eccc7">00414</a>         <span class="keyword">struct </span><a class="code" href="structlu__client__fld.html">lu_client_fld</a>    <a class="code" href="structlmv__obd.html#a6a04fc1150ffd264c7540a08870eccc7">lmv_fld</a>;
<a name="l00415"></a><a class="code" href="structlmv__obd.html#abb7417932d14e6a68a6b7d8b81c18243">00415</a>         spinlock_t              <a class="code" href="structlmv__obd.html#abb7417932d14e6a68a6b7d8b81c18243">lmv_lock</a>;
<a name="l00416"></a><a class="code" href="structlmv__obd.html#a97b7d3941dd742307bca856445cfa14d">00416</a>         <a class="code" href="obd_8h.html#ad0b7d8cdbdf0006cde862b07f993a6d8">placement_policy_t</a>      <a class="code" href="structlmv__obd.html#a97b7d3941dd742307bca856445cfa14d">lmv_placement</a>;
<a name="l00417"></a><a class="code" href="structlmv__obd.html#a70e4937b8632fd4d89f7574ce5d7d6df">00417</a>         <span class="keyword">struct </span><a class="code" href="structlmv__desc.html">lmv_desc</a>         <a class="code" href="structlmv__obd.html#a70e4937b8632fd4d89f7574ce5d7d6df">desc</a>;
<a name="l00418"></a><a class="code" href="structlmv__obd.html#a59c1f85316b740d7f323dc3c1cbf130a">00418</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>         <a class="code" href="structlmv__obd.html#a59c1f85316b740d7f323dc3c1cbf130a">cluuid</a>;
<a name="l00419"></a><a class="code" href="structlmv__obd.html#a4b7eefd1b2621c3a82312cef604ecef2">00419</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structlmv__obd.html#a4b7eefd1b2621c3a82312cef604ecef2">exp</a>;
<a name="l00420"></a><a class="code" href="structlmv__obd.html#aeb2510307fca3808029987de95b5f6f1">00420</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structlmv__obd.html#aeb2510307fca3808029987de95b5f6f1">targets_proc_entry</a>;
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="structlmv__obd.html#a450490c8fd4e54654c2a2b9e3afb069b">00422</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structlmv__obd.html#a450490c8fd4e54654c2a2b9e3afb069b">lmv_init_mutex</a>;
<a name="l00423"></a><a class="code" href="structlmv__obd.html#a6d652e5945299783fb34f49c8ce45d49">00423</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlmv__obd.html#a6d652e5945299783fb34f49c8ce45d49">connected</a>;
<a name="l00424"></a><a class="code" href="structlmv__obd.html#aaac72fbc304f3642bc23f233304e2fca">00424</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlmv__obd.html#aaac72fbc304f3642bc23f233304e2fca">max_easize</a>;
<a name="l00425"></a><a class="code" href="structlmv__obd.html#a5519d50c84c91c59a6849a40ab55e8c5">00425</a>         <span class="keywordtype">int</span>                     <a class="code" href="structlmv__obd.html#a5519d50c84c91c59a6849a40ab55e8c5">max_def_easize</a>;
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="structlmv__obd.html#a2885e35458264be6223ee7e1c2b83f4c">00427</a>         __u32                   <a class="code" href="structlmv__obd.html#a2885e35458264be6223ee7e1c2b83f4c">tgts_size</a>; <span class="comment">/* size of tgts array */</span>
<a name="l00428"></a><a class="code" href="structlmv__obd.html#ab4ee833b277c597ce80c6c3cd8cd801d">00428</a>         <span class="keyword">struct </span><a class="code" href="structlmv__tgt__desc.html">lmv_tgt_desc</a>     **<a class="code" href="structlmv__obd.html#ab4ee833b277c597ce80c6c3cd8cd801d">tgts</a>;
<a name="l00429"></a>00429 
<a name="l00430"></a><a class="code" href="structlmv__obd.html#acc3729452a57501e34c95a251e093e09">00430</a>         <span class="keyword">struct </span><a class="code" href="structobd__connect__data.html">obd_connect_data</a> <a class="code" href="structlmv__obd.html#acc3729452a57501e34c95a251e093e09">conn_data</a>;
<a name="l00431"></a>00431 };
<a name="l00432"></a>00432 
<a name="l00433"></a><a class="code" href="structniobuf__local.html">00433</a> <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> {
<a name="l00434"></a><a class="code" href="structniobuf__local.html#a16d8e2e471af2085694a0f12424e91ad">00434</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>           <a class="code" href="structniobuf__local.html#a16d8e2e471af2085694a0f12424e91ad">lnb_file_offset</a>;
<a name="l00435"></a><a class="code" href="structniobuf__local.html#a2c5e11a8fdaf278a01440f5ffb3e916a">00435</a>         __u32           <a class="code" href="structniobuf__local.html#a2c5e11a8fdaf278a01440f5ffb3e916a">lnb_page_offset</a>;
<a name="l00436"></a><a class="code" href="structniobuf__local.html#a63abc0f88971891f88a1b74d454bf836">00436</a>         __u32           <a class="code" href="structniobuf__local.html#a63abc0f88971891f88a1b74d454bf836">lnb_len</a>;
<a name="l00437"></a><a class="code" href="structniobuf__local.html#a61002fcd876f9308ead7a3aa79a59c93">00437</a>         __u32           <a class="code" href="structniobuf__local.html#a61002fcd876f9308ead7a3aa79a59c93">lnb_flags</a>;
<a name="l00438"></a><a class="code" href="structniobuf__local.html#a84de8b74217dde49989a171df889c3f4">00438</a>         <span class="keywordtype">int</span>             <a class="code" href="structniobuf__local.html#a84de8b74217dde49989a171df889c3f4">lnb_rc</a>;
<a name="l00439"></a><a class="code" href="structniobuf__local.html#a6399936b90161c712b86110f58d76d88">00439</a>         <span class="keyword">struct </span>page     *<a class="code" href="structniobuf__local.html#a6399936b90161c712b86110f58d76d88">lnb_page</a>;
<a name="l00440"></a><a class="code" href="structniobuf__local.html#a44648d50564ac4cd3ccae62347ec4ff2">00440</a>         <span class="keywordtype">void</span>            *<a class="code" href="structniobuf__local.html#a44648d50564ac4cd3ccae62347ec4ff2">lnb_data</a>;
<a name="l00441"></a>00441 };
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="obd_8h.html#abc9b20a7b4452d9b0762abd494d43035">00443</a> <span class="preprocessor">#define LUSTRE_FLD_NAME         &quot;fld&quot;</span>
<a name="l00444"></a><a class="code" href="obd_8h.html#a6a4bff706e0167ef6989ab0cafd7bb91">00444</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_SEQ_NAME         &quot;seq&quot;</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span>
<a name="l00446"></a><a class="code" href="obd_8h.html#a3bc393314c13178ac52bb39702148647">00446</a> <span class="preprocessor">#define LUSTRE_MDD_NAME         &quot;mdd&quot;</span>
<a name="l00447"></a><a class="code" href="obd_8h.html#ace198fbd08d2d455947f976741715ab1">00447</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_OSD_LDISKFS_NAME &quot;osd-ldiskfs&quot;</span>
<a name="l00448"></a><a class="code" href="obd_8h.html#a6318f6c1b16b403666f69597150e1683">00448</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_OSD_ZFS_NAME     &quot;osd-zfs&quot;</span>
<a name="l00449"></a><a class="code" href="obd_8h.html#a9bd80b5ccf0c8a87a63810df7042b701">00449</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_VVP_NAME         &quot;vvp&quot;</span>
<a name="l00450"></a><a class="code" href="obd_8h.html#a144eb9f1cb91bf276a8b5d822f24cb29">00450</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_LMV_NAME         &quot;lmv&quot;</span>
<a name="l00451"></a><a class="code" href="obd_8h.html#a9a2a36b1d8156382d225c571bf96250a">00451</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_SLP_NAME         &quot;slp&quot;</span>
<a name="l00452"></a><a class="code" href="obd_8h.html#af96412f3059a1c0f53e5fe8c598a17da">00452</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_LOD_NAME         &quot;lod&quot;</span>
<a name="l00453"></a><a class="code" href="obd_8h.html#ac57fca1ca1ef63748cf5c50ad1b7eb45">00453</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_OSP_NAME         &quot;osp&quot;</span>
<a name="l00454"></a><a class="code" href="obd_8h.html#a1faaa03c572d6da5becd353da39bf533">00454</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_LWP_NAME         &quot;lwp&quot;</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>
<a name="l00456"></a>00456 <span class="comment">/* obd device type names */</span>
<a name="l00457"></a>00457  <span class="comment">/* FIXME all the references to LUSTRE_MDS_NAME should be swapped with LUSTRE_MDT_NAME */</span>
<a name="l00458"></a><a class="code" href="obd_8h.html#adbe5105308b544dbe4b98f6a24c835dd">00458</a> <span class="preprocessor">#define LUSTRE_MDS_NAME         &quot;mds&quot;</span>
<a name="l00459"></a><a class="code" href="obd_8h.html#a745628d9f20d135052a7589f7d9ba9ee">00459</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MDT_NAME         &quot;mdt&quot;</span>
<a name="l00460"></a><a class="code" href="obd_8h.html#a398c916a3d6d401d2e581d42deaffb45">00460</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MDC_NAME         &quot;mdc&quot;</span>
<a name="l00461"></a><a class="code" href="obd_8h.html#a6b2aa0d5c23d136b72c67640a801c3a3">00461</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_OSS_NAME         &quot;ost&quot;       </span><span class="comment">/* FIXME change name to oss */</span>
<a name="l00462"></a><a class="code" href="obd_8h.html#abb3759ab959a040f487c882fea46e9a1">00462</a> <span class="preprocessor">#define LUSTRE_OST_NAME         &quot;obdfilter&quot; </span><span class="comment">/* FIXME change name to ost */</span>
<a name="l00463"></a><a class="code" href="obd_8h.html#a2ae5b0d66c37e995d787f3ed67a050c0">00463</a> <span class="preprocessor">#define LUSTRE_OSC_NAME         &quot;osc&quot;</span>
<a name="l00464"></a><a class="code" href="obd_8h.html#a748b6bc3ced19949d49f2767682b8157">00464</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_LOV_NAME         &quot;lov&quot;</span>
<a name="l00465"></a><a class="code" href="obd_8h.html#ac80a4688c7bdca519fd48dcaf1d83ab4">00465</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MGS_NAME         &quot;mgs&quot;</span>
<a name="l00466"></a><a class="code" href="obd_8h.html#a9f34bd9dc4c7e1fe45387044d3d67b6a">00466</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MGC_NAME         &quot;mgc&quot;</span>
<a name="l00467"></a>00467 <span class="preprocessor"></span>
<a name="l00468"></a><a class="code" href="obd_8h.html#a89f667b43706d2e1a37e5a06abbf7e99">00468</a> <span class="preprocessor">#define LUSTRE_ECHO_NAME        &quot;obdecho&quot;</span>
<a name="l00469"></a><a class="code" href="obd_8h.html#a97009a256d6fdf6ab05c3201cdcdc8d9">00469</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_ECHO_CLIENT_NAME &quot;echo_client&quot;</span>
<a name="l00470"></a><a class="code" href="obd_8h.html#a4c4c04430b4331302e23f439e89d88d0">00470</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_QMT_NAME         &quot;qmt&quot;</span>
<a name="l00471"></a>00471 <span class="preprocessor"></span>
<a name="l00472"></a>00472 <span class="comment">/* Constant obd names (post-rename) */</span>
<a name="l00473"></a><a class="code" href="obd_8h.html#a6b3aa582ee7e97ccd25e0bc15cc5234c">00473</a> <span class="preprocessor">#define LUSTRE_MDS_OBDNAME &quot;MDS&quot;</span>
<a name="l00474"></a><a class="code" href="obd_8h.html#a7d1da4363ac0a60b2bc76d4144404428">00474</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_OSS_OBDNAME &quot;OSS&quot;</span>
<a name="l00475"></a><a class="code" href="obd_8h.html#ade1ffd8222bb193482d4f93fe04ec8f2">00475</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MGS_OBDNAME &quot;MGS&quot;</span>
<a name="l00476"></a><a class="code" href="obd_8h.html#a6e14fc91b22840b6008041fbc3059d38">00476</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_MGC_OBDNAME &quot;MGC&quot;</span>
<a name="l00477"></a>00477 <span class="preprocessor"></span>
<a name="l00478"></a><a class="code" href="obd_8h.html#a4117d7d621091b4bf1b288b43edd9c7a">00478</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="obd_8h.html#a4117d7d621091b4bf1b288b43edd9c7a">is_lwp_on_mdt</a>(<span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00479"></a>00479 {
<a name="l00480"></a>00480         <span class="keywordtype">char</span>   *ptr;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482         ptr = strrchr(name, <span class="charliteral">&apos;-&apos;</span>);
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (ptr == NULL) {
<a name="l00484"></a>00484                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;%s is not a obdname\n&quot;</span>, name);
<a name="l00485"></a>00485                 <span class="keywordflow">return</span> 0;
<a name="l00486"></a>00486         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488         <span class="comment">/* LWP name on MDT is fsname-MDTxxxx-lwp-MDTxxxx */</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> (strncmp(ptr + 1, <span class="stringliteral">&quot;MDT&quot;</span>, 3) != 0)
<a name="l00491"></a>00491                 <span class="keywordflow">return</span> 0;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="keywordflow">while</span> (*(--ptr) != <span class="charliteral">&apos;-&apos;</span> &amp;&amp; ptr != name);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495         <span class="keywordflow">if</span> (ptr == name)
<a name="l00496"></a>00496                 <span class="keywordflow">return</span> 0;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (strncmp(ptr + 1, <a class="code" href="obd_8h.html#a1faaa03c572d6da5becd353da39bf533">LUSTRE_LWP_NAME</a>, strlen(<a class="code" href="obd_8h.html#a1faaa03c572d6da5becd353da39bf533">LUSTRE_LWP_NAME</a>)) != 0)
<a name="l00499"></a>00499                 <span class="keywordflow">return</span> 0;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="keywordflow">return</span> 1;
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a><a class="code" href="obd_8h.html#a0aabd5ea6fd510493ae7dd76966878ce">00504</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="obd_8h.html#a0aabd5ea6fd510493ae7dd76966878ce">is_lwp_on_ost</a>(<span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506         <span class="keywordtype">char</span>   *ptr;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         ptr = strrchr(name, <span class="charliteral">&apos;-&apos;</span>);
<a name="l00509"></a>00509         <span class="keywordflow">if</span> (ptr == NULL) {
<a name="l00510"></a>00510                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;%s is not a obdname\n&quot;</span>, name);
<a name="l00511"></a>00511                 <span class="keywordflow">return</span> 0;
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="comment">/* LWP name on OST is fsname-MDTxxxx-lwp-OSTxxxx */</span>
<a name="l00515"></a>00515 
<a name="l00516"></a>00516         <span class="keywordflow">if</span> (strncmp(ptr + 1, <span class="stringliteral">&quot;OST&quot;</span>, 3) != 0)
<a name="l00517"></a>00517                 <span class="keywordflow">return</span> 0;
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="keywordflow">while</span> (*(--ptr) != <span class="charliteral">&apos;-&apos;</span> &amp;&amp; ptr != name);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (ptr == name)
<a name="l00522"></a>00522                 <span class="keywordflow">return</span> 0;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (strncmp(ptr + 1, <a class="code" href="obd_8h.html#a1faaa03c572d6da5becd353da39bf533">LUSTRE_LWP_NAME</a>, strlen(<a class="code" href="obd_8h.html#a1faaa03c572d6da5becd353da39bf533">LUSTRE_LWP_NAME</a>)) != 0)
<a name="l00525"></a>00525                 <span class="keywordflow">return</span> 0;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keywordflow">return</span> 1;
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 <span class="comment">/*</span>
<a name="l00531"></a>00531 <span class="comment"> * Events signalled through obd_notify() upcall-chain.</span>
<a name="l00532"></a>00532 <span class="comment"> */</span>
<a name="l00533"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cc">00533</a> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cc">obd_notify_event</a> {
<a name="l00534"></a>00534         <span class="comment">/* target added */</span>
<a name="l00535"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaf4bf8b477d5dc70dd1164e972c108355">00535</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaf4bf8b477d5dc70dd1164e972c108355">OBD_NOTIFY_CREATE</a>,
<a name="l00536"></a>00536         <span class="comment">/* Device connect start */</span>
<a name="l00537"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccab0d95a27e8c04e505e8ad8f6db5b884e">00537</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccab0d95a27e8c04e505e8ad8f6db5b884e">OBD_NOTIFY_CONNECT</a>,
<a name="l00538"></a>00538         <span class="comment">/* Device activated */</span>
<a name="l00539"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccafd10e8733cbcae6daabb8c53a416ac31">00539</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccafd10e8733cbcae6daabb8c53a416ac31">OBD_NOTIFY_ACTIVE</a>,
<a name="l00540"></a>00540         <span class="comment">/* Device deactivated */</span>
<a name="l00541"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca96dcec94855150f6c6492fb55ada45c1">00541</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca96dcec94855150f6c6492fb55ada45c1">OBD_NOTIFY_INACTIVE</a>,
<a name="l00542"></a>00542         <span class="comment">/* Device disconnected */</span>
<a name="l00543"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccad413d8adce175920c7664844984ec447">00543</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccad413d8adce175920c7664844984ec447">OBD_NOTIFY_DISCON</a>,
<a name="l00544"></a>00544         <span class="comment">/* Connect data for import were changed */</span>
<a name="l00545"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca02cfe4495895e6faea7c64b3f9877634">00545</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca02cfe4495895e6faea7c64b3f9877634">OBD_NOTIFY_OCD</a>,
<a name="l00546"></a>00546         <span class="comment">/* Sync request */</span>
<a name="l00547"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca126973d76b62c78d9cd08cc66bed10b7">00547</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca126973d76b62c78d9cd08cc66bed10b7">OBD_NOTIFY_SYNC_NONBLOCK</a>,
<a name="l00548"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaa2a346dfdafb572f4dd25baf53855716">00548</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaa2a346dfdafb572f4dd25baf53855716">OBD_NOTIFY_SYNC</a>,
<a name="l00549"></a>00549         <span class="comment">/* Configuration event */</span>
<a name="l00550"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca4176cc2646ecb94bd9d29e60e09b309a">00550</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cca4176cc2646ecb94bd9d29e60e09b309a">OBD_NOTIFY_CONFIG</a>,
<a name="l00551"></a>00551         <span class="comment">/* Administratively deactivate/activate event */</span>
<a name="l00552"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaf6b4918ea72c10231b63aed4fe5ee2b1">00552</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaf6b4918ea72c10231b63aed4fe5ee2b1">OBD_NOTIFY_DEACTIVATE</a>,
<a name="l00553"></a><a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaa5e0d3742115c9cd0da9b364bfc9aa1c">00553</a>         <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5ccaa5e0d3742115c9cd0da9b364bfc9aa1c">OBD_NOTIFY_ACTIVATE</a>
<a name="l00554"></a>00554 };
<a name="l00555"></a>00555 
<a name="l00556"></a>00556 <span class="comment">/* bit-mask flags for config events */</span>
<a name="l00557"></a><a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396">00557</a> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396">config_flags</a> {
<a name="l00558"></a><a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396a62bf68deb2fc6a05027618df45af9d22">00558</a>         <a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396a62bf68deb2fc6a05027618df45af9d22">CONFIG_LOG</a>      = 0x1,  <span class="comment">/* finished processing config log */</span>
<a name="l00559"></a><a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396a1d95becd0e74907a13dde1b916984b9e">00559</a>         <a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396a1d95becd0e74907a13dde1b916984b9e">CONFIG_SYNC</a>     = 0x2,  <span class="comment">/* mdt synced 1 ost */</span>
<a name="l00560"></a><a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396ac1ca384a65a740af583f87dc5d06eddd">00560</a>         <a class="code" href="obd_8h.html#a9f2893212dd6a29a740308fe5f75f396ac1ca384a65a740af583f87dc5d06eddd">CONFIG_TARGET</a>   = 0x4   <span class="comment">/* one target is added */</span>
<a name="l00561"></a>00561 };
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="comment">/*</span>
<a name="l00564"></a>00564 <span class="comment"> * Data structure used to pass obd_notify()-event to non-obd listeners (llite</span>
<a name="l00565"></a>00565 <span class="comment"> * and liblustre being main examples).</span>
<a name="l00566"></a>00566 <span class="comment"> */</span>
<a name="l00567"></a><a class="code" href="structobd__notify__upcall.html">00567</a> <span class="keyword">struct </span><a class="code" href="structobd__notify__upcall.html">obd_notify_upcall</a> {
<a name="l00568"></a>00568         int (*<a class="code" href="structobd__notify__upcall.html#ac2f91a021a6afa10b8044ef9435b73fe">onu_upcall</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *host, <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *watched,
<a name="l00569"></a>00569                           <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cc">obd_notify_event</a> ev, <span class="keywordtype">void</span> *owner, <span class="keywordtype">void</span> *data);
<a name="l00570"></a>00570         <span class="comment">/* Opaque datum supplied by upper layer listener */</span>
<a name="l00571"></a><a class="code" href="structobd__notify__upcall.html#a36d54fd7bdcf89cba2fa7fcd34ab5bc4">00571</a>         <span class="keywordtype">void</span> *<a class="code" href="structobd__notify__upcall.html#a36d54fd7bdcf89cba2fa7fcd34ab5bc4">onu_owner</a>;
<a name="l00572"></a>00572 };
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="structtarget__recovery__data.html">00574</a> <span class="keyword">struct </span><a class="code" href="structtarget__recovery__data.html">target_recovery_data</a> {
<a name="l00575"></a><a class="code" href="structtarget__recovery__data.html#ac9f8fba287884a0c3a9b3568b02e2ad8">00575</a>         <a class="code" href="group__net.html#gaafdde121d699c66fbef23b0a702d1cb0">svc_handler_t</a>           <a class="code" href="structtarget__recovery__data.html#ac9f8fba287884a0c3a9b3568b02e2ad8">trd_recovery_handler</a>;
<a name="l00576"></a><a class="code" href="structtarget__recovery__data.html#ae87c3e4b9248f521f9e5f51999474f6f">00576</a>         pid_t                   <a class="code" href="structtarget__recovery__data.html#ae87c3e4b9248f521f9e5f51999474f6f">trd_processing_task</a>;
<a name="l00577"></a><a class="code" href="structtarget__recovery__data.html#a2533221ab305245bf0591d1609bf9e67">00577</a>         <span class="keyword">struct </span>completion       <a class="code" href="structtarget__recovery__data.html#a2533221ab305245bf0591d1609bf9e67">trd_starting</a>;
<a name="l00578"></a><a class="code" href="structtarget__recovery__data.html#a7fd4d4c111e875d2361a8fdcfca0c6ff">00578</a>         <span class="keyword">struct </span>completion       <a class="code" href="structtarget__recovery__data.html#a7fd4d4c111e875d2361a8fdcfca0c6ff">trd_finishing</a>;
<a name="l00579"></a>00579 };
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="structobd__llog__group.html">00581</a> <span class="keyword">struct </span><a class="code" href="structobd__llog__group.html">obd_llog_group</a> {
<a name="l00582"></a><a class="code" href="structobd__llog__group.html#a8a3460979f9026c62cdd98e11fcea2b0">00582</a>         <span class="keyword">struct </span><a class="code" href="structllog__ctxt.html">llog_ctxt</a>   *<a class="code" href="structobd__llog__group.html#a8a3460979f9026c62cdd98e11fcea2b0">olg_ctxts</a>[<a class="code" href="group__lustreidl.html#ggaedddc461eb6cbba1f4f39241cabf24f1a8b20f3ec9ea67643038ef255c98d68f3">LLOG_MAX_CTXTS</a>];
<a name="l00583"></a><a class="code" href="structobd__llog__group.html#acdbd360ebaee4fb8811967fe254afeb3">00583</a>         wait_queue_head_t  <a class="code" href="structobd__llog__group.html#acdbd360ebaee4fb8811967fe254afeb3">olg_waitq</a>;
<a name="l00584"></a><a class="code" href="structobd__llog__group.html#a863c9c98a864d7fe8bf15268aeb969d2">00584</a>         spinlock_t         <a class="code" href="structobd__llog__group.html#a863c9c98a864d7fe8bf15268aeb969d2">olg_lock</a>;
<a name="l00585"></a><a class="code" href="structobd__llog__group.html#a05ae8a330e5656ec8581f161ee0a8dc5">00585</a>         <span class="keyword">struct </span>mutex       <a class="code" href="structobd__llog__group.html#a05ae8a330e5656ec8581f161ee0a8dc5">olg_cat_processing</a>;
<a name="l00586"></a>00586 };
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">/* corresponds to one of the obd&apos;s */</span>
<a name="l00589"></a><a class="code" href="obd_8h.html#a8dec7d90b9e1400b8a87e87d84a6a551">00589</a> <span class="preprocessor">#define OBD_DEVICE_MAGIC        0XAB5CD6EF</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span>
<a name="l00591"></a><a class="code" href="structobd__device.html">00591</a> <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> {
<a name="l00592"></a><a class="code" href="structobd__device.html#a12f24300000bfbce9cdd752a638c0760">00592</a>         <span class="keyword">struct </span><a class="code" href="structobd__type.html">obd_type</a>                 *<a class="code" href="structobd__type.html">obd_type</a>;
<a name="l00593"></a><a class="code" href="structobd__device.html#a4d970a971635cabb4a5a8d648048d930">00593</a>         __u32                            <a class="code" href="structobd__device.html#a4d970a971635cabb4a5a8d648048d930">obd_magic</a>; <span class="comment">/* OBD_DEVICE_MAGIC */</span>
<a name="l00594"></a><a class="code" href="structobd__device.html#a69645841c4be6aee8aa88bc0ffcbf057">00594</a>         <span class="keywordtype">int</span>                              <a class="code" href="structobd__device.html#a69645841c4be6aee8aa88bc0ffcbf057">obd_minor</a>; <span class="comment">/* device number: lctl dl */</span>
<a name="l00595"></a><a class="code" href="structobd__device.html#a79cc8c4fff7008c292c0ccdf10a2136b">00595</a>         <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a>                *<a class="code" href="structobd__device.html#a79cc8c4fff7008c292c0ccdf10a2136b">obd_lu_dev</a>;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597         <span class="comment">/* common and UUID name of this device */</span>
<a name="l00598"></a><a class="code" href="structobd__device.html#a73f149cd166bf2e6ffe0f23a27591596">00598</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>                  <a class="code" href="structobd__uuid.html">obd_uuid</a>;
<a name="l00599"></a><a class="code" href="structobd__device.html#a47f3a5a4e3b9ce7d39282c2aa1058985">00599</a>         <span class="keywordtype">char</span>                             <a class="code" href="structobd__device.html#a47f3a5a4e3b9ce7d39282c2aa1058985">obd_name</a>[<a class="code" href="group__lustreuser.html#ga2cfdb7b2e5cc0eb8ff2ec1ea952f2b3e">MAX_OBD_NAME</a>];
<a name="l00600"></a>00600 
<a name="l00601"></a>00601         <span class="comment">/* bitfield modification is protected by obd_dev_lock */</span>
<a name="l00602"></a>00602         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
<a name="l00603"></a><a class="code" href="structobd__device.html#a66592b32b01af124048a59a58081223d">00603</a>                 <a class="code" href="structobd__device.html#a82afd734db900ab50ddb4d12e4dc5fa4">obd_attached</a>:1,         <span class="comment">/* finished attach */</span>
<a name="l00604"></a>00604                 <a class="code" href="structobd__device.html#a9cd66ba26c20a39ed452ca59930b202d">obd_set_up</a>:1,           <span class="comment">/* finished setup */</span>
<a name="l00605"></a>00605                 <a class="code" href="structobd__device.html#aaaab64ca2afe41b1eba34a6ea4c97344">obd_recovering</a>:1,       <span class="comment">/* there are recoverable clients */</span>
<a name="l00606"></a>00606                 <a class="code" href="structobd__device.html#addf187de9d802275531b95fda5b53fcc">obd_abort_recovery</a>:1,   <span class="comment">/* recovery expired */</span>
<a name="l00607"></a>00607                 <a class="code" href="structobd__device.html#a66592b32b01af124048a59a58081223d">obd_version_recov</a>:1,    <span class="comment">/* obd uses version checking */</span>
<a name="l00608"></a>00608                 <a class="code" href="structobd__device.html#a983b5a45d664cf697a57b620e0b712a4">obd_replayable</a>:1,       <span class="comment">/* recovery enabled; inform clients */</span>
<a name="l00609"></a>00609                 <a class="code" href="structobd__device.html#ac07530c69ffc303778f404537f4356da">obd_no_transno</a>:1,       <span class="comment">/* no committed-transno notification */</span>
<a name="l00610"></a>00610                 <a class="code" href="structobd__device.html#a461351cdb8e71bba07fa74da274cf4e6">obd_no_recov</a>:1,         <span class="comment">/* fail instead of retry messages */</span>
<a name="l00611"></a>00611                 <a class="code" href="structobd__device.html#a81d32b65f32c569ca2de39effaec62e0">obd_stopping</a>:1,         <span class="comment">/* started cleanup */</span>
<a name="l00612"></a>00612                 <a class="code" href="structobd__device.html#a8dfa6949a1aeb6cdb60ba36208b92ae8">obd_starting</a>:1,         <span class="comment">/* started setup */</span>
<a name="l00613"></a>00613                 <a class="code" href="structobd__device.html#a3aff50fa8cb3fddc091671df5c5f9204">obd_force</a>:1,            <span class="comment">/* cleanup with &gt; 0 obd refcount */</span>
<a name="l00614"></a>00614                 <a class="code" href="structobd__device.html#a32c7ae5a6d0fe19f36cd1986b7808990">obd_fail</a>:1,             <span class="comment">/* cleanup with failover */</span>
<a name="l00615"></a>00615                 <a class="code" href="structobd__device.html#aee1152b13507c8289d71cee45f225f1a">obd_no_conn</a>:1,          <span class="comment">/* deny new connections */</span>
<a name="l00616"></a>00616                 <a class="code" href="structobd__device.html#ab5d84ac9265231299ff053a9fd17857f">obd_inactive</a>:1,         <span class="comment">/* device active/inactive</span>
<a name="l00617"></a>00617 <span class="comment">                                         * (for /proc/status only!!) */</span>
<a name="l00618"></a>00618                 <a class="code" href="structobd__device.html#a034557040db82a70b18f7396f91efc71">obd_no_ir</a>:1,            <span class="comment">/* no imperative recovery. */</span>
<a name="l00619"></a>00619                 <a class="code" href="structobd__device.html#a60c9c3e02fde59c7a1d8829fce2d9ad8">obd_process_conf</a>:1,     <span class="comment">/* device is processing mgs config */</span>
<a name="l00620"></a>00620                 <a class="code" href="structobd__device.html#a4fa6351bf9715b42cf45b63038d0f30d">obd_uses_nid_stats</a>:1;   <span class="comment">/* maintain per-client OBD stats */</span>
<a name="l00621"></a>00621 
<a name="l00622"></a>00622         <span class="comment">/* use separate field as it is set in interrupt to don&apos;t mess with</span>
<a name="l00623"></a>00623 <span class="comment">         * protection of other bits using _bh lock */</span>
<a name="l00624"></a><a class="code" href="structobd__device.html#a3ba058acce93e6eca1ae12fb6a479f83">00624</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structobd__device.html#a3ba058acce93e6eca1ae12fb6a479f83">obd_recovery_expired</a>:1;
<a name="l00625"></a>00625         <span class="comment">/* uuid-export hash body */</span>
<a name="l00626"></a><a class="code" href="structobd__device.html#af6c74174b08244965fb06f313b640c84">00626</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>             *<a class="code" href="structobd__device.html#af6c74174b08244965fb06f313b640c84">obd_uuid_hash</a>;
<a name="l00627"></a>00627         <span class="comment">/* nid-export hash body */</span>
<a name="l00628"></a><a class="code" href="structobd__device.html#a609a04cf67bb3331c879629c37fdad75">00628</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>             *<a class="code" href="structobd__device.html#a609a04cf67bb3331c879629c37fdad75">obd_nid_hash</a>;
<a name="l00629"></a>00629         <span class="comment">/* nid stats body */</span>
<a name="l00630"></a><a class="code" href="structobd__device.html#a089bca494410105551646eb1a6e2f513">00630</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>             *<a class="code" href="structobd__device.html#a089bca494410105551646eb1a6e2f513">obd_nid_stats_hash</a>;
<a name="l00631"></a>00631         <span class="comment">/* client_generation-export hash body */</span>
<a name="l00632"></a><a class="code" href="structobd__device.html#ad9aae12786529dd60db7e88e5262cb03">00632</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>             *<a class="code" href="structobd__device.html#ad9aae12786529dd60db7e88e5262cb03">obd_gen_hash</a>;
<a name="l00633"></a><a class="code" href="structobd__device.html#a3bda062259e5d434ac1fd41914dc7696">00633</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#a3bda062259e5d434ac1fd41914dc7696">obd_nid_stats</a>;
<a name="l00634"></a><a class="code" href="structobd__device.html#a75fecf7857fc2baf076e34678baa120a">00634</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#a75fecf7857fc2baf076e34678baa120a">obd_exports</a>;
<a name="l00635"></a><a class="code" href="structobd__device.html#a176ef5172e4f5ad3de01ec553707a6c8">00635</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#a176ef5172e4f5ad3de01ec553707a6c8">obd_unlinked_exports</a>;
<a name="l00636"></a><a class="code" href="structobd__device.html#aad170547978126d346780ee765d6434f">00636</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#aad170547978126d346780ee765d6434f">obd_delayed_exports</a>;
<a name="l00637"></a><a class="code" href="structobd__device.html#aa5ad5730d322a6eb40d820ab8412da61">00637</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#aa5ad5730d322a6eb40d820ab8412da61">obd_lwp_list</a>;
<a name="l00638"></a><a class="code" href="structobd__device.html#acc6174de79f0a969946a09f31a3636d6">00638</a>         atomic_t                <a class="code" href="structobd__device.html#acc6174de79f0a969946a09f31a3636d6">obd_refcount</a>;
<a name="l00639"></a><a class="code" href="structobd__device.html#ab5dfc01ac5da193f9dfb8db306f93044">00639</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#ab5dfc01ac5da193f9dfb8db306f93044">obd_num_exports</a>;
<a name="l00640"></a><a class="code" href="structobd__device.html#a6c97ef50fe53aab315e9ec9c03649a45">00640</a>         spinlock_t              <a class="code" href="structobd__device.html#a6c97ef50fe53aab315e9ec9c03649a45">obd_nid_lock</a>;
<a name="l00641"></a><a class="code" href="structobd__device.html#a433c372799899a00ac3facb842c196c9">00641</a>         <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a>  *<a class="code" href="structobd__device.html#a433c372799899a00ac3facb842c196c9">obd_namespace</a>;
<a name="l00642"></a><a class="code" href="structobd__device.html#a018edecc524660449c403de04eea02bb">00642</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__client.html" title="Client definition for PortalRPC.">ptlrpc_client</a>    <a class="code" href="structobd__device.html#a018edecc524660449c403de04eea02bb">obd_ldlm_client</a>; <span class="comment">/* XXX OST/MDS only */</span>
<a name="l00643"></a>00643         <span class="comment">/* a spinlock is OK for what we do now, may need a semaphore later */</span>
<a name="l00644"></a><a class="code" href="structobd__device.html#a318ff629a967bb291952c902b3357474">00644</a>         spinlock_t              <a class="code" href="structobd__device.html#a318ff629a967bb291952c902b3357474">obd_dev_lock</a>; <span class="comment">/* protect OBD bitfield above */</span>
<a name="l00645"></a><a class="code" href="structobd__device.html#a204ff0af163efc7a8985d1f88e4321e9">00645</a>         spinlock_t              <a class="code" href="structobd__device.html#a204ff0af163efc7a8985d1f88e4321e9">obd_osfs_lock</a>;
<a name="l00646"></a><a class="code" href="structobd__device.html#a00936bb2a2a8982e6282d531b59fdf52">00646</a>         <span class="keyword">struct </span><a class="code" href="structobd__statfs.html">obd_statfs</a>       <a class="code" href="structobd__device.html#a00936bb2a2a8982e6282d531b59fdf52">obd_osfs</a>;       <span class="comment">/* locked by obd_osfs_lock */</span>
<a name="l00647"></a><a class="code" href="structobd__device.html#aa2678ab2c58ce51dc472e8b9d5b61404">00647</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structobd__device.html#aa2678ab2c58ce51dc472e8b9d5b61404">obd_osfs_age</a>;
<a name="l00648"></a><a class="code" href="structobd__device.html#a48d2bcfb7ce73ac3ecf2d30b2caa7900">00648</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structobd__device.html#a48d2bcfb7ce73ac3ecf2d30b2caa7900">obd_last_committed</a>;
<a name="l00649"></a><a class="code" href="structobd__device.html#aaaebd5439583b302f129964570b8f9ae">00649</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structobd__device.html#aaaebd5439583b302f129964570b8f9ae">obd_dev_mutex</a>;
<a name="l00650"></a><a class="code" href="structobd__device.html#a4bd1a5627374ec1628dc0c83d534741a">00650</a>         <span class="keyword">struct </span><a class="code" href="structlvfs__run__ctxt.html">lvfs_run_ctxt</a>    <a class="code" href="structobd__device.html#a4bd1a5627374ec1628dc0c83d534741a">obd_lvfs_ctxt</a>;
<a name="l00651"></a><a class="code" href="structobd__device.html#ad56e6e4fb14d775d5730057c26b2e9d1">00651</a>         <span class="keyword">struct </span><a class="code" href="structobd__llog__group.html">obd_llog_group</a>   <a class="code" href="structobd__device.html#ad56e6e4fb14d775d5730057c26b2e9d1">obd_olg</a>;        <span class="comment">/* default llog group */</span>
<a name="l00652"></a><a class="code" href="structobd__device.html#a87292fdbdd43290591328032624137e1">00652</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>       *<a class="code" href="structobd__device.html#a87292fdbdd43290591328032624137e1">obd_observer</a>;
<a name="l00653"></a><a class="code" href="structobd__device.html#ab128b0f3b3bd9d4ca71fba2c2e484403">00653</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structobd__device.html#ab128b0f3b3bd9d4ca71fba2c2e484403">obd_observer_link_sem</a>;
<a name="l00654"></a><a class="code" href="structobd__device.html#a85bdcd584cf2786fb24f3e453bb5b483">00654</a>         <span class="keyword">struct </span><a class="code" href="structobd__notify__upcall.html">obd_notify_upcall</a> <a class="code" href="structobd__device.html#a85bdcd584cf2786fb24f3e453bb5b483">obd_upcall</a>;
<a name="l00655"></a><a class="code" href="structobd__device.html#a11215b62af46c84584d2b3a7aa4e326e">00655</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structobd__device.html#a11215b62af46c84584d2b3a7aa4e326e">obd_self_export</a>;
<a name="l00656"></a><a class="code" href="structobd__device.html#aa52322650c21ecd828f2dd51fff16fcf">00656</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structobd__device.html#aa52322650c21ecd828f2dd51fff16fcf">obd_lwp_export</a>;
<a name="l00657"></a>00657         <span class="comment">/* list of exports in LRU order, for ping evictor, with obd_dev_lock */</span>
<a name="l00658"></a><a class="code" href="structobd__device.html#a9836dbea2756fbca1b72a81434acc558">00658</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#a9836dbea2756fbca1b72a81434acc558">obd_exports_timed</a>;
<a name="l00659"></a><a class="code" href="structobd__device.html#a23fb097a99f9b7361d915b59fc34f30b">00659</a>         time_t                  <a class="code" href="structobd__device.html#a23fb097a99f9b7361d915b59fc34f30b">obd_eviction_timer</a>;     <span class="comment">/* for ping evictor */</span>
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="structobd__device.html#a0f2d4254017aec550cfe1c78f13d8b53">00661</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#a0f2d4254017aec550cfe1c78f13d8b53">obd_max_recoverable_clients</a>;
<a name="l00662"></a><a class="code" href="structobd__device.html#ac33938bf24cfe4879fe027423b187ec5">00662</a>         atomic_t                <a class="code" href="structobd__device.html#ac33938bf24cfe4879fe027423b187ec5">obd_connected_clients</a>;
<a name="l00663"></a><a class="code" href="structobd__device.html#ac7c8b968c3347e8790b270b832495da0">00663</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#ac7c8b968c3347e8790b270b832495da0">obd_stale_clients</a>;
<a name="l00664"></a>00664         <span class="comment">/* this lock protects all recovery list_heads, timer and</span>
<a name="l00665"></a>00665 <span class="comment">         * obd_next_recovery_transno value */</span>
<a name="l00666"></a><a class="code" href="structobd__device.html#abb7fdd74e262a550597f5bb6eab0d043">00666</a>         spinlock_t              <a class="code" href="structobd__device.html#abb7fdd74e262a550597f5bb6eab0d043">obd_recovery_task_lock</a>;
<a name="l00667"></a><a class="code" href="structobd__device.html#a5c93904a309df5c32d8e4c209cc4b276">00667</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structobd__device.html#a5c93904a309df5c32d8e4c209cc4b276">obd_next_recovery_transno</a>;
<a name="l00668"></a><a class="code" href="structobd__device.html#a45fc6fe0c38a9efd10420e84a1eaea30">00668</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#a45fc6fe0c38a9efd10420e84a1eaea30">obd_replayed_requests</a>;
<a name="l00669"></a><a class="code" href="structobd__device.html#ae816e695accedac19dce05df549e8ac2">00669</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#ae816e695accedac19dce05df549e8ac2">obd_requests_queued_for_recovery</a>;
<a name="l00670"></a><a class="code" href="structobd__device.html#a853c255f7e0227776ce9c327a01582a2">00670</a>         wait_queue_head_t       <a class="code" href="structobd__device.html#a853c255f7e0227776ce9c327a01582a2">obd_next_transno_waitq</a>;
<a name="l00671"></a>00671         <span class="comment">/* protected by obd_recovery_task_lock */</span>
<a name="l00672"></a><a class="code" href="structobd__device.html#a1d537b0381ff44b8a7895f0efb225a5c">00672</a>         <span class="keyword">struct </span>timer_list       <a class="code" href="structobd__device.html#a1d537b0381ff44b8a7895f0efb225a5c">obd_recovery_timer</a>;
<a name="l00673"></a>00673         <span class="comment">/* seconds */</span>
<a name="l00674"></a><a class="code" href="structobd__device.html#aaa61703bffb9b3647234920743e0ed59">00674</a>         time_t                  <a class="code" href="structobd__device.html#aaa61703bffb9b3647234920743e0ed59">obd_recovery_start</a>;
<a name="l00675"></a>00675         <span class="comment">/* seconds, for lprocfs_status */</span>
<a name="l00676"></a><a class="code" href="structobd__device.html#a11a5ed50a72970ce3636b6524e7622e7">00676</a>         time_t                  <a class="code" href="structobd__device.html#a11a5ed50a72970ce3636b6524e7622e7">obd_recovery_end</a>;
<a name="l00677"></a><a class="code" href="structobd__device.html#a41d185c51befbe6fa0f5d2b4d5e6f345">00677</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#a41d185c51befbe6fa0f5d2b4d5e6f345">obd_recovery_time_hard</a>;
<a name="l00678"></a><a class="code" href="structobd__device.html#ac57b711443babae6934247ba9e5e8b9e">00678</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#ac57b711443babae6934247ba9e5e8b9e">obd_recovery_timeout</a>;
<a name="l00679"></a><a class="code" href="structobd__device.html#aaab8f6859eb6d85dabb55ecb8642da1b">00679</a>         <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#aaab8f6859eb6d85dabb55ecb8642da1b">obd_recovery_ir_factor</a>;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681         <span class="comment">/* new recovery stuff from CMD2 */</span>
<a name="l00682"></a><a class="code" href="structobd__device.html#af40ced2a4d8cd97d8e33fa1ba15a641f">00682</a>         <span class="keywordtype">int</span>                             <a class="code" href="structobd__device.html#af40ced2a4d8cd97d8e33fa1ba15a641f">obd_replayed_locks</a>;
<a name="l00683"></a><a class="code" href="structobd__device.html#a04a485cfa76d245dcd735667a277ef44">00683</a>         atomic_t                        <a class="code" href="structobd__device.html#a04a485cfa76d245dcd735667a277ef44">obd_req_replay_clients</a>;
<a name="l00684"></a><a class="code" href="structobd__device.html#ada58ab0f14d4d184e367d888400d62b0">00684</a>         atomic_t                        <a class="code" href="structobd__device.html#ada58ab0f14d4d184e367d888400d62b0">obd_lock_replay_clients</a>;
<a name="l00685"></a><a class="code" href="structobd__device.html#a8117642555189a7be185cfb0579f43eb">00685</a>         <span class="keyword">struct </span><a class="code" href="structtarget__recovery__data.html">target_recovery_data</a>     <a class="code" href="structobd__device.html#a8117642555189a7be185cfb0579f43eb">obd_recovery_data</a>;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         <span class="comment">/* all lists are protected by obd_recovery_task_lock */</span>
<a name="l00688"></a><a class="code" href="structobd__device.html#a7bf457b98498e39b07b10cbaee43e74d">00688</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structobd__device.html#a7bf457b98498e39b07b10cbaee43e74d">obd_req_replay_queue</a>;
<a name="l00689"></a><a class="code" href="structobd__device.html#a7b9c1df8ccdfd32b8e7c4b8f04856c7d">00689</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structobd__device.html#a7b9c1df8ccdfd32b8e7c4b8f04856c7d">obd_lock_replay_queue</a>;
<a name="l00690"></a><a class="code" href="structobd__device.html#a1557528b348de6c00b46a64e9f41ba2c">00690</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structobd__device.html#a1557528b348de6c00b46a64e9f41ba2c">obd_final_req_queue</a>;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692         <span class="keyword">union </span>{
<a name="l00693"></a>00693 <span class="preprocessor">#ifdef HAVE_SERVER_SUPPORT</span>
<a name="l00694"></a>00694 <span class="preprocessor"></span>                <span class="keyword">struct </span><a class="code" href="structobd__device__target.html">obd_device_target</a> obt;
<a name="l00695"></a>00695                 <span class="keyword">struct </span><a class="code" href="structfilter__obd.html">filter_obd</a> filter;
<a name="l00696"></a>00696                 <span class="keyword">struct </span><a class="code" href="structost__obd.html">ost_obd</a> ost;
<a name="l00697"></a>00697                 <span class="keyword">struct </span><a class="code" href="structecho__obd.html">echo_obd</a> echo;
<a name="l00698"></a>00698 <span class="preprocessor">#endif</span>
<a name="l00699"></a><a class="code" href="structobd__device.html#aab14b15f2359afc1da23bbc47decdd0c">00699</a> <span class="preprocessor"></span>                <span class="keyword">struct </span><a class="code" href="structclient__obd.html">client_obd</a> <a class="code" href="structobd__device.html#aab14b15f2359afc1da23bbc47decdd0c">cli</a>;
<a name="l00700"></a><a class="code" href="structobd__device.html#a21e7c5dbd774e8f81404a8eb52d3ecd7">00700</a>                 <span class="keyword">struct </span><a class="code" href="structecho__client__obd.html">echo_client_obd</a> <a class="code" href="structobd__device.html#a21e7c5dbd774e8f81404a8eb52d3ecd7">echo_client</a>;
<a name="l00701"></a><a class="code" href="structobd__device.html#a855c7bb370bc328f8ffde620f5618801">00701</a>                 <span class="keyword">struct </span><a class="code" href="structlov__obd.html">lov_obd</a> <a class="code" href="structobd__device.html#a855c7bb370bc328f8ffde620f5618801">lov</a>;
<a name="l00702"></a><a class="code" href="structobd__device.html#adb39c29ebda1560c507c5f79e26f73a4">00702</a>                 <span class="keyword">struct </span><a class="code" href="structlmv__obd.html">lmv_obd</a> <a class="code" href="structobd__device.html#adb39c29ebda1560c507c5f79e26f73a4">lmv</a>;
<a name="l00703"></a>00703         } <a class="code" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">u</a>;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="comment">/* Fields used by LProcFS */</span>
<a name="l00706"></a><a class="code" href="structobd__device.html#a0ca2b091c13bcb393f1e02679c751f19">00706</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>            *<a class="code" href="structobd__device.html#a0ca2b091c13bcb393f1e02679c751f19">obd_stats</a>;
<a name="l00707"></a><a class="code" href="structobd__device.html#a9cd058c320217b42772ef69347efbeaa">00707</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                    <a class="code" href="structobd__device.html#a9cd058c320217b42772ef69347efbeaa">obd_cntr_base</a>;
<a name="l00708"></a>00708 
<a name="l00709"></a><a class="code" href="structobd__device.html#a42a0bf9c1cbd7e246b779ad913c44326">00709</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                     <a class="code" href="structobd__device.html#a42a0bf9c1cbd7e246b779ad913c44326">obd_md_cntr_base</a>;
<a name="l00710"></a><a class="code" href="structobd__device.html#ac1899562f9331de5e3ba3615ab85edd1">00710</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>            *<a class="code" href="structobd__device.html#ac1899562f9331de5e3ba3615ab85edd1">obd_md_stats</a>;
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="structobd__device.html#a1be8ec6b61422e4cd9c2050efca4c82d">00712</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structobd__device.html#a1be8ec6b61422e4cd9c2050efca4c82d">obd_proc_entry</a>;
<a name="l00713"></a><a class="code" href="structobd__device.html#ad1429778081510418fbdc44fdb9ac446">00713</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structobd__device.html#ad1429778081510418fbdc44fdb9ac446">obd_proc_exports_entry</a>;
<a name="l00714"></a><a class="code" href="structobd__device.html#a28dbe0ff75b99a3ae76bc201d492fef6">00714</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structobd__device.html#a28dbe0ff75b99a3ae76bc201d492fef6">obd_svc_procroot</a>;
<a name="l00715"></a><a class="code" href="structobd__device.html#a65d8e6cd998d816329dfac5bdc1139e8">00715</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>    *<a class="code" href="structobd__device.html#a65d8e6cd998d816329dfac5bdc1139e8">obd_svc_stats</a>;
<a name="l00716"></a><a class="code" href="structobd__device.html#aa055ce323549b9f6b5833fe02fcdce9f">00716</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a>     *<a class="code" href="structobd__device.html#aa055ce323549b9f6b5833fe02fcdce9f">obd_vars</a>;
<a name="l00717"></a><a class="code" href="structobd__device.html#ad30427892c43deac2492f113744d311e">00717</a>         atomic_t                <a class="code" href="structobd__device.html#ad30427892c43deac2492f113744d311e">obd_evict_inprogress</a>;
<a name="l00718"></a><a class="code" href="structobd__device.html#a7ea1e641f3834d898445a1c30af4568d">00718</a>         wait_queue_head_t       <a class="code" href="structobd__device.html#a7ea1e641f3834d898445a1c30af4568d">obd_evict_inprogress_waitq</a>;
<a name="l00719"></a><a class="code" href="structobd__device.html#a115bd22d4f18f8dcfad6b0cf4e673aa2">00719</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structobd__device.html#a115bd22d4f18f8dcfad6b0cf4e673aa2">obd_evict_list</a>; <span class="comment">/* protected with pet_lock */</span>
<a name="l00720"></a>00720 
<a name="l00724"></a><a class="code" href="structobd__device.html#a931d7ce9c6861fefd7d571b5143af22c">00724</a>         rwlock_t                        <a class="code" href="structobd__device.html#a931d7ce9c6861fefd7d571b5143af22c" title="LDLM pool part.">obd_pool_lock</a>;
<a name="l00725"></a><a class="code" href="structobd__device.html#af70c800656535d2f015a8d5fd81dbaaa">00725</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                           <a class="code" href="structobd__device.html#af70c800656535d2f015a8d5fd81dbaaa">obd_pool_slv</a>;
<a name="l00726"></a><a class="code" href="structobd__device.html#a5ada3998bcc679b8c4ab3f23688daa3f">00726</a>         <span class="keywordtype">int</span>                             <a class="code" href="structobd__device.html#a5ada3998bcc679b8c4ab3f23688daa3f">obd_pool_limit</a>;
<a name="l00727"></a>00727 
<a name="l00728"></a><a class="code" href="structobd__device.html#a926b13f8a8c5ae00f859682c1d74fc46">00728</a>         <span class="keywordtype">int</span>                             <a class="code" href="structobd__device.html#a926b13f8a8c5ae00f859682c1d74fc46">obd_conn_inprogress</a>;
<a name="l00729"></a>00729 
<a name="l00732"></a><a class="code" href="structobd__device.html#ad9d328c221cb4f561e2980c6f866008f">00732</a>         <span class="keyword">struct </span><a class="code" href="structlu__ref.html">lu_ref</a>                   <a class="code" href="structobd__device.html#ad9d328c221cb4f561e2980c6f866008f" title="List of outstanding class_incref()&amp;#39;s fo this OBD.">obd_reference</a>;
<a name="l00733"></a>00733 };
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 <span class="comment">/* get/set_info keys */</span>
<a name="l00736"></a><a class="code" href="obd_8h.html#a11d35d3ea9cc488840f3eaacd400f37f">00736</a> <span class="preprocessor">#define KEY_ASYNC               &quot;async&quot;</span>
<a name="l00737"></a><a class="code" href="obd_8h.html#aa26cfccb3c5fe2842d53a0d543af0e25">00737</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_CHANGELOG_CLEAR     &quot;changelog_clear&quot;</span>
<a name="l00738"></a><a class="code" href="obd_8h.html#a693fa09f8e03ac72c3b52b0f914daec1">00738</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_FID2PATH            &quot;fid2path&quot;</span>
<a name="l00739"></a><a class="code" href="obd_8h.html#a029bf4f27b6493418e4211526601c0b8">00739</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_CHECKSUM            &quot;checksum&quot;</span>
<a name="l00740"></a><a class="code" href="obd_8h.html#a913ec23b2552b4419b90d6618f66527d">00740</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_CLEAR_FS            &quot;clear_fs&quot;</span>
<a name="l00741"></a><a class="code" href="obd_8h.html#ac67bd5467d39906397c8a0979d638f18">00741</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_CONN_DATA           &quot;conn_data&quot;</span>
<a name="l00742"></a><a class="code" href="obd_8h.html#af9eb6e61d7d6095ca1521f83254d11f0">00742</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_EVICT_BY_NID        &quot;evict_by_nid&quot;</span>
<a name="l00743"></a><a class="code" href="obd_8h.html#a00328ff3fda7343d0cb8cd6f15656881">00743</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_FIEMAP              &quot;fiemap&quot;</span>
<a name="l00744"></a><a class="code" href="obd_8h.html#a7e9a308df26c65562bde72c9cb7b732f">00744</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_FLUSH_CTX           &quot;flush_ctx&quot;</span>
<a name="l00745"></a><a class="code" href="obd_8h.html#acbfdce692fedab254b0cc31772b74f55">00745</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_GRANT_SHRINK        &quot;grant_shrink&quot;</span>
<a name="l00746"></a><a class="code" href="obd_8h.html#a0d364b47f244c25a159b7f7fc0cdfdb7">00746</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_HSM_COPYTOOL_SEND   &quot;hsm_send&quot;</span>
<a name="l00747"></a><a class="code" href="obd_8h.html#a81eb04b2d69cb5762330d4ac07bf1745">00747</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_INIT_RECOV_BACKUP   &quot;init_recov_bk&quot;</span>
<a name="l00748"></a><a class="code" href="obd_8h.html#aa4df3c7998be07fa7b1d495d6659702d">00748</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_INTERMDS            &quot;inter_mds&quot;</span>
<a name="l00749"></a><a class="code" href="obd_8h.html#ad9e682ec3dacbe3ddcdadf99df2aa074">00749</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LAST_ID             &quot;last_id&quot;</span>
<a name="l00750"></a><a class="code" href="obd_8h.html#a0099a3eadf5e8f27177201e6b16ce97b">00750</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_LAST_FID            &quot;last_fid&quot;</span>
<a name="l00751"></a><a class="code" href="obd_8h.html#a656f554b7418373682e616ae45bcb4c0">00751</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_MAX_EASIZE          &quot;max_easize&quot;</span>
<a name="l00752"></a><a class="code" href="obd_8h.html#a68b6fa1506279c89e3c3210b3a991b60">00752</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_DEFAULT_EASIZE      &quot;default_easize&quot;</span>
<a name="l00753"></a><a class="code" href="obd_8h.html#a4247600ad94253d6e06c2b2ef01bc1ae">00753</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_MGSSEC              &quot;mgssec&quot;</span>
<a name="l00754"></a><a class="code" href="obd_8h.html#ab7be067a7111d863f47d612cc584a429">00754</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_READ_ONLY           &quot;read-only&quot;</span>
<a name="l00755"></a><a class="code" href="obd_8h.html#a0570d50647b08bfad17c871a61c5464b">00755</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_REGISTER_TARGET     &quot;register_target&quot;</span>
<a name="l00756"></a><a class="code" href="obd_8h.html#ac31d60e20b9ea8f774ab9e3f89d918f1">00756</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_SET_FS              &quot;set_fs&quot;</span>
<a name="l00757"></a><a class="code" href="obd_8h.html#a02b2d8e8eca344b7739f331f9c0a506a">00757</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_TGT_COUNT           &quot;tgt_count&quot;</span>
<a name="l00758"></a>00758 <span class="preprocessor"></span><span class="comment">/*      KEY_SET_INFO in lustre_idl.h */</span>
<a name="l00759"></a><a class="code" href="obd_8h.html#a6eb092da080d60e16c5b14e80fbf8954">00759</a> <span class="preprocessor">#define KEY_SPTLRPC_CONF        &quot;sptlrpc_conf&quot;</span>
<a name="l00760"></a>00760 <span class="preprocessor"></span>
<a name="l00761"></a><a class="code" href="obd_8h.html#a19a8af3d329cca38a83ed64c1f48c2d2">00761</a> <span class="preprocessor">#define KEY_CACHE_SET           &quot;cache_set&quot;</span>
<a name="l00762"></a><a class="code" href="obd_8h.html#ac505bca8659aedecb6154e106deabfeb">00762</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_CACHE_LRU_SHRINK    &quot;cache_lru_shrink&quot;</span>
<a name="l00763"></a><a class="code" href="obd_8h.html#a8997c8b4c47661bec716af0472a7349f">00763</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_OSP_CONNECTED       &quot;osp_connected&quot;</span>
<a name="l00764"></a>00764 <span class="preprocessor"></span>
<a name="l00765"></a>00765 <span class="keyword">struct </span><a class="code" href="structlu__context.html" title="lu_context.">lu_context</a>;
<a name="l00766"></a>00766 
<a name="l00767"></a><a class="code" href="obd_8h.html#a1e8b75b0a871f1981247c6d4bd54e149">00767</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="obd_8h.html#a1e8b75b0a871f1981247c6d4bd54e149">it_to_lock_mode</a>(<span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *it)
<a name="l00768"></a>00768 {
<a name="l00769"></a>00769         <span class="comment">/* CREAT needs to be tested before open (both could be set) */</span>
<a name="l00770"></a>00770         <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a> &amp; <a class="code" href="packet-lustre_8c.html#a8074841aaeebb59152d49ac2c70552e7">IT_CREAT</a>)
<a name="l00771"></a>00771                 <span class="keywordflow">return</span> <a class="code" href="packet-lustre_8c.html#ac60a597e5ebc0742a6171d25d5165902">LCK_CW</a>;
<a name="l00772"></a>00772         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a> &amp; (<a class="code" href="packet-lustre_8c.html#acbeec9ce74ca64dd688a410bd97279a0">IT_GETATTR</a> | <a class="code" href="packet-lustre_8c.html#a8ada3fda4c053e538aed2ea027a02c72">IT_OPEN</a> | <a class="code" href="packet-lustre_8c.html#a3966f870e5ac8a44a44faa42c36eedf0">IT_LOOKUP</a> |
<a name="l00773"></a>00773                               <a class="code" href="group__lustreidl.html#gga9c053c844f0d79b44f18bb65850a6081a6da3f5e52e6ebfbc8720806973497811">IT_LAYOUT</a>))
<a name="l00774"></a>00774                 <span class="keywordflow">return</span> <a class="code" href="packet-lustre_8c.html#a8532d2ec7dffedbf9e84ef23a16b19fd">LCK_CR</a>;
<a name="l00775"></a>00775         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a> &amp;  <a class="code" href="packet-lustre_8c.html#a808ff94ddae608550d662a16d0b6d041">IT_READDIR</a>)
<a name="l00776"></a>00776                 <span class="keywordflow">return</span> <a class="code" href="packet-lustre_8c.html#a4b1936ce7054752c0a9d74ebc836c5d6">LCK_PR</a>;
<a name="l00777"></a>00777         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a> &amp;  <a class="code" href="packet-lustre_8c.html#a6d499e10f709bbfadcffbf814b7f8420">IT_GETXATTR</a>)
<a name="l00778"></a>00778                 <span class="keywordflow">return</span> <a class="code" href="packet-lustre_8c.html#a4b1936ce7054752c0a9d74ebc836c5d6">LCK_PR</a>;
<a name="l00779"></a>00779         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a> &amp;  <a class="code" href="group__lustreidl.html#gga9c053c844f0d79b44f18bb65850a6081af0f1358b1d0be5e8fc6d76be4dfe258b">IT_SETXATTR</a>)
<a name="l00780"></a>00780                 <span class="keywordflow">return</span> <a class="code" href="packet-lustre_8c.html#acfddf2f902384575528f1e893c561afc">LCK_PW</a>;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>(0, <span class="stringliteral">&quot;Invalid it_op: %d\n&quot;</span>, it-&gt;<a class="code" href="structlookup__intent.html#a31b6fb3b16053c4e7a04f8284601d3aa">it_op</a>);
<a name="l00783"></a>00783         <span class="keywordflow">return</span> -EINVAL;
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41">00786</a> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41">md_op_flags</a> {
<a name="l00787"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a1f9bccfb422835679c05221cdea088c4">00787</a>         <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a1f9bccfb422835679c05221cdea088c4">MF_MDC_CANCEL_FID1</a>      = 1 &lt;&lt; 0,
<a name="l00788"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a7a13a85734f86ca674c7c13ea756b62c">00788</a>         <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a7a13a85734f86ca674c7c13ea756b62c">MF_MDC_CANCEL_FID2</a>      = 1 &lt;&lt; 1,
<a name="l00789"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41af3f650b715dd186cc2bee8eb6c7023a2">00789</a>         <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41af3f650b715dd186cc2bee8eb6c7023a2">MF_MDC_CANCEL_FID3</a>      = 1 &lt;&lt; 2,
<a name="l00790"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41ad9a3439c4b7f8d023f541f9c7c27b604">00790</a>         <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41ad9a3439c4b7f8d023f541f9c7c27b604">MF_MDC_CANCEL_FID4</a>      = 1 &lt;&lt; 3,
<a name="l00791"></a><a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a220472c0cf57a5c1fa2c93c4f96f135f">00791</a>         <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41a220472c0cf57a5c1fa2c93c4f96f135f">MF_GET_MDT_IDX</a>          = 1 &lt;&lt; 4,
<a name="l00792"></a>00792 };
<a name="l00793"></a>00793 
<a name="l00794"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8f">00794</a> <span class="keyword">enum</span> <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8f">md_cli_flags</a> {
<a name="l00795"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fa24dae44088c8885e481bd46031aab518">00795</a>         <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fa24dae44088c8885e481bd46031aab518">CLI_SET_MEA</a>     = 1 &lt;&lt; 0,
<a name="l00796"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8faa7c948ce2faf444b8f3cf8cb950f7f4e">00796</a>         <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8faa7c948ce2faf444b8f3cf8cb950f7f4e">CLI_RM_ENTRY</a>    = 1 &lt;&lt; 1,
<a name="l00797"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fa1faf2d59c04ff55bceae596df312f1b0">00797</a>         <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fa1faf2d59c04ff55bceae596df312f1b0">CLI_HASH64</a>      = 1 &lt;&lt; 2,
<a name="l00798"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fab59e6243a2376476c8a692cf9758a372">00798</a>         <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fab59e6243a2376476c8a692cf9758a372">CLI_API32</a>       = 1 &lt;&lt; 3,
<a name="l00799"></a><a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fad2ccd8aed310bd8e74f0e6ae54248420">00799</a>         <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8fad2ccd8aed310bd8e74f0e6ae54248420">CLI_MIGRATE</a>     = 1 &lt;&lt; 4,
<a name="l00800"></a>00800 };
<a name="l00801"></a>00801 
<a name="l00802"></a><a class="code" href="structmd__op__data.html">00802</a> <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> {
<a name="l00803"></a><a class="code" href="structmd__op__data.html#ad2ae696058372a6168d03e7d1ef38c03">00803</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>           <a class="code" href="structmd__op__data.html#ad2ae696058372a6168d03e7d1ef38c03">op_fid1</a>; <span class="comment">/* operation fid1 (usualy parent) */</span>
<a name="l00804"></a><a class="code" href="structmd__op__data.html#a8ba5fc2168b1ec3807d95cec8e2a32ce">00804</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>           <a class="code" href="structmd__op__data.html#a8ba5fc2168b1ec3807d95cec8e2a32ce">op_fid2</a>; <span class="comment">/* operation fid2 (usualy child) */</span>
<a name="l00805"></a><a class="code" href="structmd__op__data.html#a1e51f5ad7479e0a944264149171e3e4c">00805</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>           <a class="code" href="structmd__op__data.html#a1e51f5ad7479e0a944264149171e3e4c">op_fid3</a>; <span class="comment">/* 2 extra fids to find conflicting */</span>
<a name="l00806"></a><a class="code" href="structmd__op__data.html#ae30c9edce290b5b33001950b2307a712">00806</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>           <a class="code" href="structmd__op__data.html#ae30c9edce290b5b33001950b2307a712">op_fid4</a>; <span class="comment">/* to the operation locks. */</span>
<a name="l00807"></a><a class="code" href="structmd__op__data.html#a4dd8c2bfe3a67c84e6c0dcfbaad50c56">00807</a>         u32                     <a class="code" href="structmd__op__data.html#a4dd8c2bfe3a67c84e6c0dcfbaad50c56">op_mds</a>;  <span class="comment">/* what mds server open will go to */</span>
<a name="l00808"></a><a class="code" href="structmd__op__data.html#ab55a0e70311a0b7eddfe7e891f81e573">00808</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>    <a class="code" href="structmd__op__data.html#ab55a0e70311a0b7eddfe7e891f81e573">op_handle</a>;
<a name="l00809"></a><a class="code" href="structmd__op__data.html#a9ab9391098f2eeed38cd77090dacf906">00809</a>         s64                     <a class="code" href="structmd__op__data.html#a9ab9391098f2eeed38cd77090dacf906">op_mod_time</a>;
<a name="l00810"></a><a class="code" href="structmd__op__data.html#a3ab0aea452f6640f96badcaf1fc4ae57">00810</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>             *<a class="code" href="structmd__op__data.html#a3ab0aea452f6640f96badcaf1fc4ae57">op_name</a>;
<a name="l00811"></a><a class="code" href="structmd__op__data.html#af911ffe374616a60b297e2b4837ac870">00811</a>         <span class="keywordtype">size_t</span>                  <a class="code" href="structmd__op__data.html#af911ffe374616a60b297e2b4837ac870">op_namelen</a>;
<a name="l00812"></a><a class="code" href="structmd__op__data.html#a4d904035112ff360604472b720902b5c">00812</a>         __u32                   <a class="code" href="structmd__op__data.html#a4d904035112ff360604472b720902b5c">op_mode</a>;
<a name="l00813"></a><a class="code" href="structmd__op__data.html#a26f0da80d5c3aec8055f9a62f68a4def">00813</a>         <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a>   *<a class="code" href="structmd__op__data.html#a26f0da80d5c3aec8055f9a62f68a4def">op_mea1</a>;
<a name="l00814"></a><a class="code" href="structmd__op__data.html#a28f18b5e205069aa3220b9ebabd0654b">00814</a>         <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a>   *<a class="code" href="structmd__op__data.html#a28f18b5e205069aa3220b9ebabd0654b">op_mea2</a>;
<a name="l00815"></a><a class="code" href="structmd__op__data.html#a899c9409628f6aee88040d123b4a9c4e">00815</a>         __u32                   <a class="code" href="structmd__op__data.html#a899c9409628f6aee88040d123b4a9c4e">op_suppgids</a>[2];
<a name="l00816"></a><a class="code" href="structmd__op__data.html#a096091526fc09c7706fc69e3f8348afa">00816</a>         __u32                   <a class="code" href="structmd__op__data.html#a096091526fc09c7706fc69e3f8348afa">op_fsuid</a>;
<a name="l00817"></a><a class="code" href="structmd__op__data.html#a0ff380b4a51163ac87c64c4f16c15a3a">00817</a>         __u32                   <a class="code" href="structmd__op__data.html#a0ff380b4a51163ac87c64c4f16c15a3a">op_fsgid</a>;
<a name="l00818"></a><a class="code" href="structmd__op__data.html#a06337a829b74dad906b39f3e98b0d6a3">00818</a>         <a class="code" href="curproc_8h.html#a3cb6e21040ca4be7dd02ad341b27c28b">cfs_cap_t</a>               <a class="code" href="structmd__op__data.html#a06337a829b74dad906b39f3e98b0d6a3">op_cap</a>;
<a name="l00819"></a><a class="code" href="structmd__op__data.html#a92923c286cac10ce4ddf7d7fe499843a">00819</a>         <span class="keywordtype">void</span>                   *<a class="code" href="structmd__op__data.html#a92923c286cac10ce4ddf7d7fe499843a">op_data</a>;
<a name="l00820"></a><a class="code" href="structmd__op__data.html#a2606fc6bf7c6912e9480002e39f036aa">00820</a>         <span class="keywordtype">size_t</span>                  <a class="code" href="structmd__op__data.html#a2606fc6bf7c6912e9480002e39f036aa">op_data_size</a>;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822         <span class="comment">/* iattr fields and blocks. */</span>
<a name="l00823"></a><a class="code" href="structmd__op__data.html#a0ab042edfc995ef299ad50aab8ff85aa">00823</a>         <span class="keyword">struct </span>iattr            <a class="code" href="structmd__op__data.html#a0ab042edfc995ef299ad50aab8ff85aa">op_attr</a>;
<a name="l00824"></a><a class="code" href="structmd__op__data.html#a40c5c8cca42a6af9c60d4fb5055b8209">00824</a>         loff_t                  <a class="code" href="structmd__op__data.html#a40c5c8cca42a6af9c60d4fb5055b8209">op_attr_blocks</a>;
<a name="l00825"></a><a class="code" href="structmd__op__data.html#abc9dbcc31d8e75ccd7af6f352b7492b3">00825</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structmd__op__data.html#abc9dbcc31d8e75ccd7af6f352b7492b3">op_attr_flags</a>; <span class="comment">/* LUSTRE_{SYNC,..}_FL */</span>
<a name="l00826"></a><a class="code" href="structmd__op__data.html#ac8d9d3433b6a82bc7b3bd0195407067d">00826</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structmd__op__data.html#ac8d9d3433b6a82bc7b3bd0195407067d">op_valid</a>; <span class="comment">/* OBD_MD_* */</span>
<a name="l00827"></a>00827 
<a name="l00828"></a><a class="code" href="structmd__op__data.html#ab2377aa866ff6869d4268894d1ac44f2">00828</a>         <span class="keyword">enum</span> <a class="code" href="obd_8h.html#af5f3a30050e9fc85c19ee2fff6bf4d41">md_op_flags</a>        <a class="code" href="structmd__op__data.html#ab2377aa866ff6869d4268894d1ac44f2">op_flags</a>;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830         <span class="comment">/* Various operation flags. */</span>
<a name="l00831"></a><a class="code" href="structmd__op__data.html#a2bb150a59e3e2b9a70387d685d9c25a4">00831</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga4b1c62e9fc5c50b5ad2eff80f77eb0e9">mds_op_bias</a>        <a class="code" href="structmd__op__data.html#a2bb150a59e3e2b9a70387d685d9c25a4">op_bias</a>;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833         <span class="comment">/* Used by readdir */</span>
<a name="l00834"></a><a class="code" href="structmd__op__data.html#aa28cea5493bf8ab618b53222e72aab60">00834</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structmd__op__data.html#aa28cea5493bf8ab618b53222e72aab60">op_max_pages</a>;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="comment">/* used to transfer info between the stacks of MD client</span>
<a name="l00837"></a>00837 <span class="comment">         * see enum op_cli_flags */</span>
<a name="l00838"></a><a class="code" href="structmd__op__data.html#aaa51c7316a1a65ca308c9ab560ab11fd">00838</a>         <span class="keyword">enum</span> <a class="code" href="obd_8h.html#afa2d07c3fe9ba07c8b95ddeabdc04a8f">md_cli_flags</a>       <a class="code" href="structmd__op__data.html#aaa51c7316a1a65ca308c9ab560ab11fd">op_cli_flags</a>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="comment">/* File object data version for HSM release, on client */</span>
<a name="l00841"></a><a class="code" href="structmd__op__data.html#a7031dcad1808ccdfc07a03c130f4518a">00841</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structmd__op__data.html#a7031dcad1808ccdfc07a03c130f4518a">op_data_version</a>;
<a name="l00842"></a><a class="code" href="structmd__op__data.html#a3928d4bc640710d15dc711bf56bbeda9">00842</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>    <a class="code" href="structmd__op__data.html#a3928d4bc640710d15dc711bf56bbeda9">op_lease_handle</a>;
<a name="l00843"></a>00843 
<a name="l00844"></a>00844         <span class="comment">/* default stripe offset */</span>
<a name="l00845"></a><a class="code" href="structmd__op__data.html#a8508b479a25da222e7b8c133c69612c6">00845</a>         __u32                   <a class="code" href="structmd__op__data.html#a8508b479a25da222e7b8c133c69612c6">op_default_stripe_offset</a>;
<a name="l00846"></a>00846 };
<a name="l00847"></a>00847 
<a name="l00848"></a><a class="code" href="structmd__callback.html">00848</a> <span class="keyword">struct </span><a class="code" href="structmd__callback.html">md_callback</a> {
<a name="l00849"></a>00849         int (*<a class="code" href="structmd__callback.html#a0badebd22380956ad60edcabb363790a">md_blocking_ast</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock,
<a name="l00850"></a>00850                                <span class="keyword">struct </span><a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *desc,
<a name="l00851"></a>00851                                <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flag);
<a name="l00852"></a>00852 };
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="keyword">struct </span><a class="code" href="structmd__enqueue__info.html">md_enqueue_info</a>;
<a name="l00855"></a>00855 <span class="comment">/* metadata stat-ahead */</span>
<a name="l00856"></a><a class="code" href="obd_8h.html#a6f715762b09deaa9ea533034ba1062a1">00856</a> <span class="keyword">typedef</span> int (* <a class="code" href="obd_8h.html#a6f715762b09deaa9ea533034ba1062a1">md_enqueue_cb_t</a>)(<span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l00857"></a>00857                                 <span class="keyword">struct </span><a class="code" href="structmd__enqueue__info.html">md_enqueue_info</a> *minfo,
<a name="l00858"></a>00858                                 <span class="keywordtype">int</span> rc);
<a name="l00859"></a>00859 
<a name="l00860"></a><a class="code" href="structmd__enqueue__info.html">00860</a> <span class="keyword">struct </span><a class="code" href="structmd__enqueue__info.html">md_enqueue_info</a> {
<a name="l00861"></a><a class="code" href="structmd__enqueue__info.html#add1c048a91d08c6daedc8a1ca0bee905">00861</a>         <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a>               <a class="code" href="structmd__enqueue__info.html#add1c048a91d08c6daedc8a1ca0bee905">mi_data</a>;
<a name="l00862"></a><a class="code" href="structmd__enqueue__info.html#af7f220104abaad5773a218c86e002f04">00862</a>         <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a>            <a class="code" href="structmd__enqueue__info.html#af7f220104abaad5773a218c86e002f04">mi_it</a>;
<a name="l00863"></a><a class="code" href="structmd__enqueue__info.html#a031cb91b9c93a5dc03ed6da90b533900">00863</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>            <a class="code" href="structmd__enqueue__info.html#a031cb91b9c93a5dc03ed6da90b533900">mi_lockh</a>;
<a name="l00864"></a><a class="code" href="structmd__enqueue__info.html#a3b8a532b81524e311eedaca791663067">00864</a>         <span class="keyword">struct </span>inode                   *<a class="code" href="structmd__enqueue__info.html#a3b8a532b81524e311eedaca791663067">mi_dir</a>;
<a name="l00865"></a><a class="code" href="structmd__enqueue__info.html#a41254b4d2c4e1aea8f72af615bcda37e">00865</a>         <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a>        <a class="code" href="structmd__enqueue__info.html#a41254b4d2c4e1aea8f72af615bcda37e">mi_einfo</a>;
<a name="l00866"></a><a class="code" href="structmd__enqueue__info.html#a6b940a1064c0a7ee196b5ec652373766">00866</a>         <a class="code" href="obd_8h.html#a6f715762b09deaa9ea533034ba1062a1">md_enqueue_cb_t</a>                 <a class="code" href="structmd__enqueue__info.html#a6b940a1064c0a7ee196b5ec652373766">mi_cb</a>;
<a name="l00867"></a><a class="code" href="structmd__enqueue__info.html#aec58ed8070561abcb2cbfa26b55524bd">00867</a>         <span class="keywordtype">void</span>                           *<a class="code" href="structmd__enqueue__info.html#aec58ed8070561abcb2cbfa26b55524bd">mi_cbdata</a>;
<a name="l00868"></a>00868 };
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="structobd__ops.html">00870</a> <span class="keyword">struct </span><a class="code" href="structobd__ops.html">obd_ops</a> {
<a name="l00871"></a><a class="code" href="structobd__ops.html#a1d905bfb7cd60e05ff0faff20732fe42">00871</a>         <span class="keyword">struct </span>module *<a class="code" href="structobd__ops.html#a1d905bfb7cd60e05ff0faff20732fe42">o_owner</a>;
<a name="l00872"></a>00872         int (*<a class="code" href="structobd__ops.html#a6b7db8aadd44d43d07e479688ec7b969">o_iocontrol</a>)(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keywordtype">int</span> len,
<a name="l00873"></a>00873                            <span class="keywordtype">void</span> *karg, <span class="keywordtype">void</span> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *uarg);
<a name="l00874"></a>00874         int (*<a class="code" href="structobd__ops.html#a5b1e6cee59585a39cf3a4c75d5b3fbd7">o_get_info</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l00875"></a>00875                           __u32 keylen, <span class="keywordtype">void</span> *key, __u32 *vallen, <span class="keywordtype">void</span> *val);
<a name="l00876"></a>00876         int (*<a class="code" href="structobd__ops.html#adab17e65d642a24d7ab7f27aa312cd46">o_set_info_async</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l00877"></a>00877                                 __u32 keylen, <span class="keywordtype">void</span> *key,
<a name="l00878"></a>00878                                 __u32 vallen, <span class="keywordtype">void</span> *val,
<a name="l00879"></a>00879                                 <span class="keyword">struct </span><a class="code" href="structptlrpc__request__set.html" title="Definition of request set structure.">ptlrpc_request_set</a> *<span class="keyword">set</span>);
<a name="l00880"></a>00880         int (*<a class="code" href="structobd__ops.html#ac862d55dab4651a37273c57221276f58">o_setup</a>) (<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *dev, <span class="keyword">struct </span><a class="code" href="structlustre__cfg.html">lustre_cfg</a> *cfg);
<a name="l00881"></a>00881         int (*<a class="code" href="structobd__ops.html#a2f1bf7b7bb9b2f8b3c92c4ee9c8e8709">o_precleanup</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *dev);
<a name="l00882"></a>00882         int (*<a class="code" href="structobd__ops.html#a14d4e60ea30646836a4945e3175fa602">o_cleanup</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *dev);
<a name="l00883"></a>00883         int (*<a class="code" href="structobd__ops.html#a0b27f0e32adaef5b920eb921bc761bb7">o_process_config</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *dev, <span class="keywordtype">size_t</span> len, <span class="keywordtype">void</span> *data);
<a name="l00884"></a>00884         int (*<a class="code" href="structobd__ops.html#a4bcf4e64349d8e3de69c1cc7f9cc3d78">o_postrecov</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *dev);
<a name="l00885"></a>00885         int (*<a class="code" href="structobd__ops.html#abb83ce612de2b5722e6931f1470ee6be">o_add_conn</a>)(<span class="keyword">struct </span><a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *imp, <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a> *<a class="code" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>,
<a name="l00886"></a>00886                           <span class="keywordtype">int</span> priority);
<a name="l00887"></a>00887         int (*<a class="code" href="structobd__ops.html#ab745763622c0127cdc7d302da3fb607a">o_del_conn</a>)(<span class="keyword">struct </span><a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *imp, <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a> *<a class="code" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>);
<a name="l00888"></a>00888         <span class="comment">/* connect to the target device with given connection</span>
<a name="l00889"></a>00889 <span class="comment">         * data. @ocd-&gt;ocd_connect_flags is modified to reflect flags actually</span>
<a name="l00890"></a>00890 <span class="comment">         * granted by the target, which are guaranteed to be a subset of flags</span>
<a name="l00891"></a>00891 <span class="comment">         * asked for. If @ocd == NULL, use default parameters. */</span>
<a name="l00892"></a>00892         int (*<a class="code" href="structobd__ops.html#a248ee7dd4ea89c60d037c3094c9ca581">o_connect</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00893"></a>00893                          <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> **exp, <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *src,
<a name="l00894"></a>00894                          <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a> *cluuid, <span class="keyword">struct </span><a class="code" href="structobd__connect__data.html">obd_connect_data</a> *ocd,
<a name="l00895"></a>00895                          <span class="keywordtype">void</span> *localdata);
<a name="l00896"></a>00896         int (*<a class="code" href="structobd__ops.html#a8239d39c9f687a6ee062fe6347b8a736">o_reconnect</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00897"></a>00897                            <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *src,
<a name="l00898"></a>00898                            <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a> *cluuid,
<a name="l00899"></a>00899                            <span class="keyword">struct </span><a class="code" href="structobd__connect__data.html">obd_connect_data</a> *ocd,
<a name="l00900"></a>00900                            <span class="keywordtype">void</span> *localdata);
<a name="l00901"></a>00901         int (*<a class="code" href="structobd__ops.html#a1dfbddccaf8e568c531a466861c7df0b">o_disconnect</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         <span class="comment">/* Initialize/finalize fids infrastructure. */</span>
<a name="l00904"></a>00904         int (*<a class="code" href="structobd__ops.html#a503113541beb576100ac9ebf22db5225">o_fid_init</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd,
<a name="l00905"></a>00905                           <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">enum</span> <a class="code" href="group__fid.html#gaa9fa6acab517d0fd39a7b1fadb344c97">lu_cli_type</a> type);
<a name="l00906"></a>00906         int (*<a class="code" href="structobd__ops.html#a0929f6f8e29d1565aa65212b1e5e34ae">o_fid_fini</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd);
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="comment">/* Allocate new fid according to passed @hint. */</span>
<a name="l00909"></a>00909         int (*<a class="code" href="structobd__ops.html#a6fdc2e28dd75afef42ee032707f99d7f">o_fid_alloc</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00910"></a>00910                            <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *<a class="code" href="structmd__op__data.html#a92923c286cac10ce4ddf7d7fe499843a">op_data</a>);
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <span class="comment">/*</span>
<a name="l00913"></a>00913 <span class="comment">         * Object with @fid is getting deleted, we may want to do something</span>
<a name="l00914"></a>00914 <span class="comment">         * about this.</span>
<a name="l00915"></a>00915 <span class="comment">         */</span>
<a name="l00916"></a>00916         int (*<a class="code" href="structobd__ops.html#a3290ce3a9029a8715d49b42778683c7a">o_statfs</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00917"></a>00917                         <span class="keyword">struct </span><a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> max_age, __u32 flags);
<a name="l00918"></a>00918         int (*<a class="code" href="structobd__ops.html#a0a81f100c34331fd36c5b7ad29bbdf55">o_statfs_async</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct </span><a class="code" href="structobd__info.html">obd_info</a> *oinfo,
<a name="l00919"></a>00919                               <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> max_age, <span class="keyword">struct </span><a class="code" href="structptlrpc__request__set.html" title="Definition of request set structure.">ptlrpc_request_set</a> *<span class="keyword">set</span>);
<a name="l00920"></a>00920         int (*<a class="code" href="structobd__ops.html#a1e78368369ce63b56b46270957eb7fe9">o_create</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00921"></a>00921                         <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa);
<a name="l00922"></a>00922         int (*<a class="code" href="structobd__ops.html#a537c70262e8c7f9bfc0ab9e2269a07eb">o_destroy</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00923"></a>00923                          <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa);
<a name="l00924"></a>00924         int (*<a class="code" href="structobd__ops.html#a5a15efa9d38a0984a00469043fdc5f06">o_setattr</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00925"></a>00925                          <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa);
<a name="l00926"></a>00926         int (*<a class="code" href="structobd__ops.html#ae42e80bf26ae2f7799e4df089f078167">o_getattr</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l00927"></a>00927                          <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa);
<a name="l00928"></a>00928         int (*<a class="code" href="structobd__ops.html#a738fac644e00a0bf9bf59f29eaf60010">o_preprw</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>,
<a name="l00929"></a>00929                         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa, <span class="keywordtype">int</span> objcount,
<a name="l00930"></a>00930                         <span class="keyword">struct </span><a class="code" href="structobd__ioobj.html">obd_ioobj</a> *obj, <span class="keyword">struct </span><a class="code" href="structniobuf__remote.html">niobuf_remote</a> *remote,
<a name="l00931"></a>00931                         <span class="keywordtype">int</span> *nr_pages, <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *local);
<a name="l00932"></a>00932         int (*<a class="code" href="structobd__ops.html#a3630356852f367a2f23acdf4781af8e2">o_commitrw</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>,
<a name="l00933"></a>00933                           <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct </span><a class="code" href="structobdo.html">obdo</a> *oa,
<a name="l00934"></a>00934                           <span class="keywordtype">int</span> objcount, <span class="keyword">struct </span><a class="code" href="structobd__ioobj.html">obd_ioobj</a> *obj,
<a name="l00935"></a>00935                           <span class="keyword">struct </span><a class="code" href="structniobuf__remote.html">niobuf_remote</a> *remote, <span class="keywordtype">int</span> pages,
<a name="l00936"></a>00936                           <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *local, <span class="keywordtype">int</span> rc);
<a name="l00937"></a>00937         int (*<a class="code" href="structobd__ops.html#a321090592383f62464854f6f49691abc">o_init_export</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00938"></a>00938         int (*<a class="code" href="structobd__ops.html#ac90138a858ea526edbbdf7294380e03b">o_destroy_export</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00939"></a>00939 
<a name="l00940"></a>00940         int (*<a class="code" href="structobd__ops.html#a1f41b3bcd92eedc56d4ed72f50d02c04">o_import_event</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *, <span class="keyword">struct </span><a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *,
<a name="l00941"></a>00941                               <span class="keyword">enum</span> <a class="code" href="group__export.html#ga25e24f2ae3efcc8caa89c9e6c4c47d31" title="List of import event types.">obd_import_event</a>);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         int (*<a class="code" href="structobd__ops.html#a3c362f440ee169d99b44b4a7bb45a35c">o_notify</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *watched,
<a name="l00944"></a>00944                         <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cc">obd_notify_event</a> ev, <span class="keywordtype">void</span> *data);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         int (*<a class="code" href="structobd__ops.html#ad61fc588bb548db919d5e64d9142b3d1">o_health_check</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *);
<a name="l00947"></a>00947         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a> *(*o_get_uuid) (<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949         <span class="comment">/* quota methods */</span>
<a name="l00950"></a>00950         int (*<a class="code" href="structobd__ops.html#afc67b43ee882c3a6903d319001abf052">o_quotactl</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l00951"></a>00951                           <span class="keyword">struct </span><a class="code" href="structobd__quotactl.html">obd_quotactl</a> *);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953         int (*<a class="code" href="structobd__ops.html#a0afb9facc5adcbb5c0c76f130d6f512a">o_ping</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l00954"></a>00954 
<a name="l00955"></a>00955         <span class="comment">/* pools methods */</span>
<a name="l00956"></a>00956         int (*<a class="code" href="structobd__ops.html#a84800c7b70c977fd10ee57314adf0d60">o_pool_new</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>);
<a name="l00957"></a>00957         int (*<a class="code" href="structobd__ops.html#af557928ca94b980d7390c015650e268f">o_pool_del</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>);
<a name="l00958"></a>00958         int (*<a class="code" href="structobd__ops.html#a9c6da66bface03393b495005e04f1068">o_pool_add</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>,
<a name="l00959"></a>00959                           <span class="keywordtype">char</span> *ostname);
<a name="l00960"></a>00960         int (*<a class="code" href="structobd__ops.html#a578dfdadff3e88da7ef8f3f6ae3b9fe7">o_pool_rem</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>,
<a name="l00961"></a>00961                           <span class="keywordtype">char</span> *ostname);
<a name="l00962"></a>00962         void (*<a class="code" href="structobd__ops.html#aea37fcb0460d6ef435e5b89368ad5fbe">o_getref</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd);
<a name="l00963"></a>00963         void (*<a class="code" href="structobd__ops.html#adb10c20baa09d7bb53dc268094d2dcd4">o_putref</a>)(<span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd);
<a name="l00964"></a>00964         <span class="comment">/*</span>
<a name="l00965"></a>00965 <span class="comment">         * NOTE: If adding ops, add another LPROCFS_OBD_OP_INIT() line</span>
<a name="l00966"></a>00966 <span class="comment">         * to lprocfs_alloc_obd_stats() in obdclass/lprocfs_status.c.</span>
<a name="l00967"></a>00967 <span class="comment">         * Also, add a wrapper function in include/linux/obd_class.h. */</span>
<a name="l00968"></a>00968 };
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 <span class="comment">/* lmv structures */</span>
<a name="l00971"></a><a class="code" href="structlustre__md.html">00971</a> <span class="keyword">struct </span><a class="code" href="structlustre__md.html">lustre_md</a> {
<a name="l00972"></a><a class="code" href="structlustre__md.html#ab7ac78f19f3ffdbc9942a0e56cf6403b">00972</a>         <span class="keyword">struct </span><a class="code" href="structmdt__body.html">mdt_body</a>         *<a class="code" href="structlustre__md.html#ab7ac78f19f3ffdbc9942a0e56cf6403b">body</a>;
<a name="l00973"></a><a class="code" href="structlustre__md.html#a999047e71f9b414b7160806fa8a2759a">00973</a>         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>            <a class="code" href="structlustre__md.html#a999047e71f9b414b7160806fa8a2759a">layout</a>;
<a name="l00974"></a><a class="code" href="structlustre__md.html#a5b1fa0c991a00f2e9827eba3d609908f">00974</a>         <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a>    *<a class="code" href="structlustre__md.html#a5b1fa0c991a00f2e9827eba3d609908f">lmv</a>;
<a name="l00975"></a>00975 <span class="preprocessor">#ifdef CONFIG_FS_POSIX_ACL</span>
<a name="l00976"></a>00976 <span class="preprocessor"></span>        <span class="keyword">struct </span>posix_acl        *posix_acl;
<a name="l00977"></a>00977 <span class="preprocessor">#endif</span>
<a name="l00978"></a><a class="code" href="structlustre__md.html#a2773116d6f3087d8cb82a74c65a537ad">00978</a> <span class="preprocessor"></span>        <span class="keyword">struct </span><a class="code" href="structmdt__remote__perm.html">mdt_remote_perm</a>  *<a class="code" href="structlustre__md.html#a2773116d6f3087d8cb82a74c65a537ad">remote_perm</a>;
<a name="l00979"></a>00979 };
<a name="l00980"></a>00980 
<a name="l00981"></a><a class="code" href="structmd__open__data.html">00981</a> <span class="keyword">struct </span><a class="code" href="structmd__open__data.html">md_open_data</a> {
<a name="l00982"></a><a class="code" href="structmd__open__data.html#a833bc7765a78e013b7245f661816331c">00982</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a>        *<a class="code" href="structmd__open__data.html#a833bc7765a78e013b7245f661816331c">mod_och</a>;
<a name="l00983"></a><a class="code" href="structmd__open__data.html#aa67dc24b3e187428d5828783c9cc929e">00983</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a>           *<a class="code" href="structmd__open__data.html#aa67dc24b3e187428d5828783c9cc929e">mod_open_req</a>;
<a name="l00984"></a><a class="code" href="structmd__open__data.html#a50401bd47eb4914030b11a2f15eb7cce">00984</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a>           *<a class="code" href="structmd__open__data.html#a50401bd47eb4914030b11a2f15eb7cce">mod_close_req</a>;
<a name="l00985"></a><a class="code" href="structmd__open__data.html#a8c00203368464234478e08021f52f80b">00985</a>         atomic_t                         <a class="code" href="structmd__open__data.html#a8c00203368464234478e08021f52f80b">mod_refcount</a>;
<a name="l00986"></a><a class="code" href="structmd__open__data.html#ad853568319a28df07e9b7278543c6e07">00986</a>         <span class="keywordtype">bool</span>                             <a class="code" href="structmd__open__data.html#ad853568319a28df07e9b7278543c6e07">mod_is_create</a>;
<a name="l00987"></a>00987 };
<a name="l00988"></a>00988 
<a name="l00989"></a><a class="code" href="structobd__client__handle.html">00989</a> <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a> {
<a name="l00990"></a><a class="code" href="structobd__client__handle.html#aa6301cc34294c6c8dbf27c543499ed7a">00990</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>     <a class="code" href="structobd__client__handle.html#aa6301cc34294c6c8dbf27c543499ed7a">och_fh</a>;
<a name="l00991"></a><a class="code" href="structobd__client__handle.html#aca2fbbd477d0174513f907f1c1f3d623">00991</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>            <a class="code" href="structobd__client__handle.html#aca2fbbd477d0174513f907f1c1f3d623">och_fid</a>;
<a name="l00992"></a><a class="code" href="structobd__client__handle.html#a66b63ef865765dd1cff8d6bfc4bb4b16">00992</a>         <span class="keyword">struct </span><a class="code" href="structmd__open__data.html">md_open_data</a>     *<a class="code" href="structobd__client__handle.html#a66b63ef865765dd1cff8d6bfc4bb4b16">och_mod</a>;
<a name="l00993"></a><a class="code" href="structobd__client__handle.html#a927b1ad6f59ad412941d2f94a7b26b8f">00993</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>     <a class="code" href="structobd__client__handle.html#a927b1ad6f59ad412941d2f94a7b26b8f">och_lease_handle</a>; <span class="comment">/* open lock for lease */</span>
<a name="l00994"></a><a class="code" href="structobd__client__handle.html#a7ca0251cf64c386ed57a747e62ea5e4e">00994</a>         __u32                    <a class="code" href="structobd__client__handle.html#a7ca0251cf64c386ed57a747e62ea5e4e">och_magic</a>;
<a name="l00995"></a><a class="code" href="structobd__client__handle.html#aaa7a08b8903b8d2a9e5f6676ffbd2980">00995</a>         <span class="keywordtype">int</span>                      <a class="code" href="structobd__client__handle.html#aaa7a08b8903b8d2a9e5f6676ffbd2980">och_flags</a>;
<a name="l00996"></a>00996 };
<a name="l00997"></a>00997 
<a name="l00998"></a><a class="code" href="obd_8h.html#a80b392153d324dd7c0a8efc0a9b9eee7">00998</a> <span class="preprocessor">#define OBD_CLIENT_HANDLE_MAGIC 0xd15ea5ed</span>
<a name="l00999"></a>00999 <span class="preprocessor"></span>
<a name="l01000"></a>01000 <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a>;
<a name="l01001"></a>01001 <span class="keyword">struct </span><a class="code" href="structcl__attr.html" title="&amp;quot;Data attributes&amp;quot; of cl_object.">cl_attr</a>;
<a name="l01002"></a>01002 
<a name="l01003"></a><a class="code" href="structmd__ops.html">01003</a> <span class="keyword">struct </span><a class="code" href="structmd__ops.html">md_ops</a> {
<a name="l01004"></a>01004         <span class="comment">/* Every operation from MD_STATS_FIRST_OP up to and including</span>
<a name="l01005"></a>01005 <span class="comment">         * MD_STATS_LAST_OP will be counted by EXP_MD_OP_INCREMENT()</span>
<a name="l01006"></a>01006 <span class="comment">         * and will appear in /proc/fs/lustre/{lmv,mdc}/.../md_stats.</span>
<a name="l01007"></a>01007 <span class="comment">         * Operations after MD_STATS_LAST_OP are excluded from stats.</span>
<a name="l01008"></a>01008 <span class="comment">         * There are a few reasons for doing this: we prune the 17</span>
<a name="l01009"></a>01009 <span class="comment">         * counters which will be of minimal use in understanding</span>
<a name="l01010"></a>01010 <span class="comment">         * metadata utilization, we save memory by allocating 15</span>
<a name="l01011"></a>01011 <span class="comment">         * instead of 32 counters, we save cycles by not counting.</span>
<a name="l01012"></a>01012 <span class="comment">         *</span>
<a name="l01013"></a>01013 <span class="comment">         * MD_STATS_FIRST_OP must be the first member of md_ops.</span>
<a name="l01014"></a>01014 <span class="comment">         */</span>
<a name="l01015"></a><a class="code" href="obd_8h.html#a4c633769dc5d3eae98ba1941af60682e">01015</a> <span class="preprocessor">#define MD_STATS_FIRST_OP m_close</span>
<a name="l01016"></a>01016 <span class="preprocessor"></span>        int (*<a class="code" href="structmd__ops.html#a171b78904242704815ba0f579944c0ce">m_close</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01017"></a>01017                        <span class="keyword">struct </span><a class="code" href="structmd__open__data.html">md_open_data</a> *, <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         int (*<a class="code" href="structmd__ops.html#a07fff86f5153132ba851d4b2c7843d48">m_create</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01020"></a>01020                         <span class="keyword">const</span> <span class="keywordtype">void</span> *, size_t, umode_t, uid_t, gid_t,
<a name="l01021"></a>01021                         <a class="code" href="curproc_8h.html#a3cb6e21040ca4be7dd02ad341b27c28b">cfs_cap_t</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023         int (*<a class="code" href="structmd__ops.html#a838979315524aeb6ddabc34b7f7c99ae">m_enqueue</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *,
<a name="l01024"></a>01024                          <span class="keyword">const</span> <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *,
<a name="l01025"></a>01025                          <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01026"></a>01026                          <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028         int (*<a class="code" href="structmd__ops.html#a2ce31ebfdd725d4b88da27e80c222d02">m_getattr</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01029"></a>01029                          <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         int (*<a class="code" href="structmd__ops.html#a5bdbb503b76bf63c581f1ab193a0b614">m_intent_lock</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01032"></a>01032                              <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a> *,
<a name="l01033"></a>01033                              <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **,
<a name="l01034"></a>01034                              <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         int (*<a class="code" href="structmd__ops.html#ac4962bd4750357c9e32735583cc0be49">m_link</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01037"></a>01037                       <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039         int (*<a class="code" href="structmd__ops.html#a7cc9a348fa482d5dea5b5b82afb63c0e">m_rename</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01040"></a>01040                         <span class="keyword">const</span> <span class="keywordtype">char</span> *, size_t, <span class="keyword">const</span> <span class="keywordtype">char</span> *, size_t,
<a name="l01041"></a>01041                         <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01042"></a>01042 
<a name="l01043"></a>01043         int (*<a class="code" href="structmd__ops.html#ace4d92fcda2fb1fbd13d0073915fe175">m_setattr</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *, <span class="keywordtype">void</span> *,
<a name="l01044"></a>01044                          size_t , <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046         int (*<a class="code" href="structmd__ops.html#a434feda4efb978fe1328d0bdc60006f5">m_fsync</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *,
<a name="l01047"></a>01047                        <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         int (*<a class="code" href="structmd__ops.html#aea7d7c405b46acfb76001e470f76860a">m_read_page</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01050"></a>01050                            <span class="keyword">struct </span><a class="code" href="structmd__callback.html">md_callback</a> *cb_op, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> hash_offset,
<a name="l01051"></a>01051                            <span class="keyword">struct </span>page **ppage);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053         int (*<a class="code" href="structmd__ops.html#a2b77477aba28f8a7fb50586dc2618402">m_unlink</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01054"></a>01054                         <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056         int (*<a class="code" href="structmd__ops.html#a294279958705c31a922eb2ee68ee34e9">m_setxattr</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *,
<a name="l01057"></a>01057                           u64, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, int, int, int, u32,
<a name="l01058"></a>01058                           <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01059"></a>01059 
<a name="l01060"></a>01060         int (*<a class="code" href="structmd__ops.html#aa09a286fb9af6ec3c97df6d3d3fb1c48">m_getxattr</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *,
<a name="l01061"></a>01061                           u64, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, int, int, int,
<a name="l01062"></a>01062                           <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01063"></a>01063 
<a name="l01064"></a>01064         int (*<a class="code" href="structmd__ops.html#a35e33b594b5b8419c996fc950506f8bd">m_intent_getattr_async</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01065"></a>01065                                       <span class="keyword">struct </span><a class="code" href="structmd__enqueue__info.html">md_enqueue_info</a> *);
<a name="l01066"></a>01066 
<a name="l01067"></a>01067         int (*<a class="code" href="structmd__ops.html#a2ed1cc05de96ae3da1509b4f50392acf">m_revalidate_lock</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a> *,
<a name="l01068"></a>01068                                  <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *bits);
<a name="l01069"></a>01069 
<a name="l01070"></a><a class="code" href="obd_8h.html#a8e317563fb2a3e1db8e2af6578b3e47f">01070</a> <span class="preprocessor">#define MD_STATS_LAST_OP m_revalidate_lock</span>
<a name="l01071"></a>01071 <span class="preprocessor"></span>
<a name="l01072"></a>01072         int (*<a class="code" href="structmd__ops.html#aab55a23c0a0068009457d43984f403f2">m_get_root</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *);
<a name="l01073"></a>01073         int (*<a class="code" href="structmd__ops.html#a179204b4a76cd45e3e4c62f0c85979cd">m_null_inode</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *);
<a name="l01074"></a>01074 
<a name="l01075"></a>01075         int (*<a class="code" href="structmd__ops.html#a5aa0aec61bad569a52001299619eb91d">m_getattr_name</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *,
<a name="l01076"></a>01076                               <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01077"></a>01077 
<a name="l01078"></a>01078         int (*<a class="code" href="structmd__ops.html#ac41157b239bfeb7b42ba9a79979c2bd1">m_init_ea_size</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, __u32, __u32);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080         int (*<a class="code" href="structmd__ops.html#a324ecd5d6675d4a5d794110da1ae283e">m_get_lustre_md</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *,
<a name="l01081"></a>01081                                <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01082"></a>01082                                <span class="keyword">struct </span><a class="code" href="structlustre__md.html">lustre_md</a> *);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084         int (*<a class="code" href="structmd__ops.html#a274b654f77e991fca00d485f1b47535f">m_free_lustre_md</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">struct </span><a class="code" href="structlustre__md.html">lustre_md</a> *);
<a name="l01085"></a>01085 
<a name="l01086"></a>01086         int (*<a class="code" href="structmd__ops.html#a5ccedb50fe95533c09ccf79cab1e1707">m_merge_attr</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01087"></a>01087                             <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a> *lsm,
<a name="l01088"></a>01088                             <span class="keyword">struct </span><a class="code" href="structcl__attr.html" title="&amp;quot;Data attributes&amp;quot; of cl_object.">cl_attr</a> *attr, <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>);
<a name="l01089"></a>01089 
<a name="l01090"></a>01090         int (*<a class="code" href="structmd__ops.html#a5b2f9a7abbf07c1a6c4fa132a12744a0">m_set_open_replay_data</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01091"></a>01091                                       <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a> *,
<a name="l01092"></a>01092                                       <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a> *);
<a name="l01093"></a>01093 
<a name="l01094"></a>01094         int (*<a class="code" href="structmd__ops.html#a2c0b6bc796d839cfcb8ee4a9f5cbfc24">m_clear_open_replay_data</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01095"></a>01095                                         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a> *);
<a name="l01096"></a>01096 
<a name="l01097"></a>01097         int (*<a class="code" href="structmd__ops.html#a9170f6b2912fb968a1f1468641441de3">m_set_lock_data</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *, <span class="keywordtype">void</span> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> (*<a class="code" href="structmd__ops.html#a0638783bedf6ba661bc76b2b9704e49a">m_lock_match</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>,
<a name="l01100"></a>01100                                        <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a>,
<a name="l01101"></a>01101                                        <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>,
<a name="l01102"></a>01102                                        <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a> *);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104         int (*<a class="code" href="structmd__ops.html#a7edab724f7d3007e21276feec0fec2ce">m_cancel_unused</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *,
<a name="l01105"></a>01105                                <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>,
<a name="l01106"></a>01106                                <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags, <span class="keywordtype">void</span> *opaque);
<a name="l01107"></a>01107 
<a name="l01108"></a>01108         int (*<a class="code" href="structmd__ops.html#ac5c1073d79fc5042c9ce715f4013c93e">m_get_remote_perm</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *, <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *,
<a name="l01109"></a>01109                                  u32, <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **);
<a name="l01110"></a>01110 
<a name="l01111"></a>01111         int (*<a class="code" href="structmd__ops.html#aabf82b898f64eb8eb2b2f0ade7592252">m_get_fid_from_lsm</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *,
<a name="l01112"></a>01112                                   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a> *,
<a name="l01113"></a>01113                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> namelen,
<a name="l01114"></a>01114                                   <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l01115"></a>01115         int (*<a class="code" href="structmd__ops.html#a8eb39bcd7dce2d08e52bcc743f50e348">m_unpackmd</a>)(<span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a> **plsm,
<a name="l01116"></a>01116                           <span class="keyword">const</span> <span class="keyword">union </span><a class="code" href="unionlmv__mds__md.html">lmv_mds_md</a> *lmv, <span class="keywordtype">size_t</span> lmv_size);
<a name="l01117"></a>01117 };
<a name="l01118"></a>01118 
<a name="l01119"></a><a class="code" href="obd_8h.html#a29ddc85d898ca3697395ef1f0f17d840">01119</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structmd__open__data.html">md_open_data</a> *<a class="code" href="obd_8h.html#a29ddc85d898ca3697395ef1f0f17d840">obd_mod_alloc</a>(<span class="keywordtype">void</span>)
<a name="l01120"></a>01120 {
<a name="l01121"></a>01121         <span class="keyword">struct </span><a class="code" href="structmd__open__data.html">md_open_data</a> *mod;
<a name="l01122"></a>01122         <a class="code" href="obd__support_8h.html#ab5ccc29ab0a6625457a863652381c45c">OBD_ALLOC_PTR</a>(mod);
<a name="l01123"></a>01123         <span class="keywordflow">if</span> (mod == NULL)
<a name="l01124"></a>01124                 <span class="keywordflow">return</span> NULL;
<a name="l01125"></a>01125         atomic_set(&amp;mod-&gt;<a class="code" href="structmd__open__data.html#a8c00203368464234478e08021f52f80b">mod_refcount</a>, 1);
<a name="l01126"></a>01126         <span class="keywordflow">return</span> mod;
<a name="l01127"></a>01127 }
<a name="l01128"></a>01128 
<a name="l01129"></a><a class="code" href="obd_8h.html#a57cc4c7c5009ab2785d55ac545590c8a">01129</a> <span class="preprocessor">#define obd_mod_get(mod) atomic_inc(&amp;(mod)-&gt;mod_refcount)</span>
<a name="l01130"></a><a class="code" href="obd_8h.html#a8ae51716c3e556c363657b0a9194fcb4">01130</a> <span class="preprocessor"></span><span class="preprocessor">#define obd_mod_put(mod)                                          \</span>
<a name="l01131"></a>01131 <span class="preprocessor">({                                                                \</span>
<a name="l01132"></a>01132 <span class="preprocessor">        if (atomic_dec_and_test(&amp;(mod)-&gt;mod_refcount)) {          \</span>
<a name="l01133"></a>01133 <span class="preprocessor">                if ((mod)-&gt;mod_open_req)                          \</span>
<a name="l01134"></a>01134 <span class="preprocessor">                        ptlrpc_req_finished((mod)-&gt;mod_open_req); \</span>
<a name="l01135"></a>01135 <span class="preprocessor">                OBD_FREE_PTR(mod);                                \</span>
<a name="l01136"></a>01136 <span class="preprocessor">        }                                                         \</span>
<a name="l01137"></a>01137 <span class="preprocessor">})</span>
<a name="l01138"></a>01138 <span class="preprocessor"></span>
<a name="l01139"></a>01139 <span class="keywordtype">void</span> <a class="code" href="obd_8h.html#a2a556645f0c9f8e2eea7d16cd1f0faf2">obdo_from_inode</a>(<span class="keyword">struct</span> <a class="code" href="structobdo.html">obdo</a> *dst, <span class="keyword">struct</span> inode *src, u64 valid);
<a name="l01140"></a>01140 <span class="keywordtype">void</span> <a class="code" href="obd_8h.html#aa25e469395bab746dea72d6502fe6794">obdo_set_parent_fid</a>(<span class="keyword">struct</span> <a class="code" href="structobdo.html">obdo</a> *dst, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *parent);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">/* return 1 if client should be resend request */</span>
<a name="l01143"></a><a class="code" href="obd_8h.html#a79da8a6180fb843f6e843ba565fe3dad">01143</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="obd_8h.html#a79da8a6180fb843f6e843ba565fe3dad">client_should_resend</a>(<span class="keywordtype">int</span> resend, <span class="keyword">struct</span> <a class="code" href="structclient__obd.html">client_obd</a> *cli)
<a name="l01144"></a>01144 {
<a name="l01145"></a>01145         <span class="keywordflow">return</span> atomic_read(&amp;cli-&gt;<a class="code" href="structclient__obd.html#aa13b24aec435376f87689a345cd88969">cl_resends</a>) ?
<a name="l01146"></a>01146                atomic_read(&amp;cli-&gt;<a class="code" href="structclient__obd.html#aa13b24aec435376f87689a345cd88969">cl_resends</a>) &gt; resend : 1;
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01156"></a><a class="code" href="obd_8h.html#a77fe997f268e354dac0f54272899fb33">01156</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="obd_8h.html#a77fe997f268e354dac0f54272899fb33" title="Return device name for this device.">lu_dev_name</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *lu_dev)
<a name="l01157"></a>01157 {
<a name="l01158"></a>01158         <span class="keywordflow">return</span> lu_dev-&gt;<a class="code" href="structlu__device.html#af35351bd6a533fa48c8a0f0eda83172a">ld_obd</a>-&gt;<a class="code" href="structobd__device.html#a47f3a5a4e3b9ce7d39282c2aa1058985">obd_name</a>;
<a name="l01159"></a>01159 }
<a name="l01160"></a>01160 
<a name="l01161"></a><a class="code" href="obd_8h.html#abf3096f7d9c220673f04d1ae13cf78a0">01161</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="obd_8h.html#abf3096f7d9c220673f04d1ae13cf78a0">filename_is_volatile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">size_t</span> namelen,
<a name="l01162"></a>01162                                         <span class="keywordtype">int</span> *idx)
<a name="l01163"></a>01163 {
<a name="l01164"></a>01164         <span class="keyword">const</span> <span class="keywordtype">char</span>      *<a class="code" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>;
<a name="l01165"></a>01165         <span class="keywordtype">char</span>            *<a class="code" href="mdsrate_8c.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167         <span class="keywordflow">if</span> (strncmp(name, <a class="code" href="group__lustreuser.html#gae5bdc0a10daa6473ca9341758a50f3d6">LUSTRE_VOLATILE_HDR</a>, <a class="code" href="group__lustreuser.html#ga2e91cce7b77ddf8bbf4b349ed966faad">LUSTRE_VOLATILE_HDR_LEN</a>) != 0)
<a name="l01168"></a>01168                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="comment">/* caller does not care of idx */</span>
<a name="l01171"></a>01171         <span class="keywordflow">if</span> (idx == NULL)
<a name="l01172"></a>01172                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         <span class="comment">/* volatile file, the MDT can be set from name */</span>
<a name="l01175"></a>01175         <span class="comment">/* name format is LUSTRE_VOLATILE_HDR:[idx]: */</span>
<a name="l01176"></a>01176         <span class="comment">/* if no MDT is specified, use std way */</span>
<a name="l01177"></a>01177         <span class="keywordflow">if</span> (namelen &lt; <a class="code" href="group__lustreuser.html#ga2e91cce7b77ddf8bbf4b349ed966faad">LUSTRE_VOLATILE_HDR_LEN</a> + 2)
<a name="l01178"></a>01178                 <span class="keywordflow">goto</span> bad_format;
<a name="l01179"></a>01179         <span class="comment">/* test for no MDT idx case */</span>
<a name="l01180"></a>01180         <span class="keywordflow">if</span> ((*(name + <a class="code" href="group__lustreuser.html#ga2e91cce7b77ddf8bbf4b349ed966faad">LUSTRE_VOLATILE_HDR_LEN</a>) == <span class="charliteral">&apos;:&apos;</span>) &amp;&amp;
<a name="l01181"></a>01181             (*(name + <a class="code" href="group__lustreuser.html#ga2e91cce7b77ddf8bbf4b349ed966faad">LUSTRE_VOLATILE_HDR_LEN</a> + 1) == <span class="charliteral">&apos;:&apos;</span>)) {
<a name="l01182"></a>01182                 *idx = -1;
<a name="l01183"></a>01183                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01184"></a>01184         }
<a name="l01185"></a>01185         <span class="comment">/* we have an idx, read it */</span>
<a name="l01186"></a>01186         start = name + <a class="code" href="group__lustreuser.html#ga2e91cce7b77ddf8bbf4b349ed966faad">LUSTRE_VOLATILE_HDR_LEN</a> + 1;
<a name="l01187"></a>01187         *idx = simple_strtoul(start, &amp;end, 16);
<a name="l01188"></a>01188         <span class="comment">/* error cases:</span>
<a name="l01189"></a>01189 <span class="comment">         * no digit, no trailing :, negative value</span>
<a name="l01190"></a>01190 <span class="comment">         */</span>
<a name="l01191"></a>01191         <span class="keywordflow">if</span> (((*idx == 0) &amp;&amp; (end == start)) ||
<a name="l01192"></a>01192             (*end != <span class="charliteral">&apos;:&apos;</span>) || (*idx &lt; 0))
<a name="l01193"></a>01193                 <span class="keywordflow">goto</span> bad_format;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01196"></a>01196 bad_format:
<a name="l01197"></a>01197         <span class="comment">/* bad format of mdt idx, we cannot return an error</span>
<a name="l01198"></a>01198 <span class="comment">         * to caller so we use hash algo */</span>
<a name="l01199"></a>01199         <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;Bad volatile file name format: %s\n&quot;</span>,
<a name="l01200"></a>01200                name + LUSTRE_VOLATILE_HDR_LEN);
<a name="l01201"></a>01201         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a><a class="code" href="obd_8h.html#abf6fcb171f3506905067717914947def">01204</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="obd_8h.html#abf6fcb171f3506905067717914947def">cli_brw_size</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd)
<a name="l01205"></a>01205 {
<a name="l01206"></a>01206         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(obd != NULL);
<a name="l01207"></a>01207         <span class="keywordflow">return</span> obd-&gt;<a class="code" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">u</a>.<a class="code" href="structobd__device.html#aab14b15f2359afc1da23bbc47decdd0c">cli</a>.<a class="code" href="structclient__obd.html#abff4a86d64e35b98676a458209cb9258">cl_max_pages_per_rpc</a> &lt;&lt; PAGE_CACHE_SHIFT;
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 <span class="comment">/* when RPC size or the max RPCs in flight is increased, the max dirty pages</span>
<a name="l01211"></a>01211 <span class="comment"> * of the client should be increased accordingly to avoid sending fragmented</span>
<a name="l01212"></a>01212 <span class="comment"> * RPCs over the network when the client runs out of the maximum dirty space</span>
<a name="l01213"></a>01213 <span class="comment"> * when so many RPCs are being generated.</span>
<a name="l01214"></a>01214 <span class="comment"> */</span>
<a name="l01215"></a><a class="code" href="obd_8h.html#a3b1aa101eadf55556457235f6caa252a">01215</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="obd_8h.html#a3b1aa101eadf55556457235f6caa252a">client_adjust_max_dirty</a>(<span class="keyword">struct</span> <a class="code" href="structclient__obd.html">client_obd</a> *cli)
<a name="l01216"></a>01216 {
<a name="l01217"></a>01217          <span class="comment">/* initializing */</span>
<a name="l01218"></a>01218         <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a> &lt;= 0)
<a name="l01219"></a>01219                 cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a> = (<a class="code" href="obd_8h.html#a72c92fc77f9376f45d8b3f54845bec2b">OSC_MAX_DIRTY_DEFAULT</a> * 1024 * 1024)
<a name="l01220"></a>01220                                                         &gt;&gt; PAGE_CACHE_SHIFT;
<a name="l01221"></a>01221         <span class="keywordflow">else</span> {
<a name="l01222"></a>01222                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dirty_max = cli-&gt;<a class="code" href="structclient__obd.html#a8e77a281528593754771125a793b0cec">cl_max_rpcs_in_flight</a> *
<a name="l01223"></a>01223                                           cli-&gt;<a class="code" href="structclient__obd.html#abff4a86d64e35b98676a458209cb9258">cl_max_pages_per_rpc</a>;
<a name="l01224"></a>01224 
<a name="l01225"></a>01225                 <span class="keywordflow">if</span> (dirty_max &gt; cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a>)
<a name="l01226"></a>01226                         cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a> = dirty_max;
<a name="l01227"></a>01227         }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229         <span class="keywordflow">if</span> (cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a> &gt; totalram_pages / 8)
<a name="l01230"></a>01230                 cli-&gt;<a class="code" href="structclient__obd.html#a474b579a4b2d805ee0217bffc7246607">cl_dirty_max_pages</a> = totalram_pages / 8;
<a name="l01231"></a>01231 }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233 <span class="preprocessor">#endif </span><span class="comment">/* __OBD_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:35 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
