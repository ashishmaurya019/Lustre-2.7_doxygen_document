<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: API to operate on locks from actual LDLM users.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>API to operate on locks from actual LDLM users.<br/>
<small>
[<a class="el" href="group__LDLM.html">Lustre Distributed Lock Manager</a>]</small>
</h1>
<p>These are typically used by client and server (*_local versions) to obtain and release locks.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#gac3edcad1b11e283d6ef8455a2b598b07">ldlm_cli_enqueue</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **reqp, struct <a class="el" href="structldlm__enqueue__info.html">ldlm_enqueue_info</a> *einfo, const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *res_id, union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> const *policy, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags, void *lvb, __u32 lvb_len, enum <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lockh, int async)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Client-side lock enqueue.  <a href="#gac3edcad1b11e283d6ef8455a2b598b07"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga9fe4c63a5cd0fe654e29fd11aea415cc">ldlm_prep_enqueue_req</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, struct <a class="el" href="structlist__head.html">list_head</a> *cancels, int count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#gabae59a7ebeed8c6fd60b22f03cf88e1f">ldlm_prep_elc_req</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, int <a class="el" href="mount__lustre_8c.html#aad880fc4455c253781e8968f2239d56f">version</a>, int opc, int canceloff, struct <a class="el" href="structlist__head.html">list_head</a> *cancels, int count)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel LRU locks and pack them into the enqueue request.  <a href="#gabae59a7ebeed8c6fd60b22f03cf88e1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga4bde4e4e32bab2c971297a5f065dec66">ldlm_enqueue_pack</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, int lvb_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#gab2f8268913fc19a29b9d39248d3cbf0d">ldlm_handle_enqueue0</a> (struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *ns, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, const struct <a class="el" href="structldlm__request.html">ldlm_request</a> *dlm_req, const struct <a class="el" href="structldlm__callback__suite.html">ldlm_callback_suite</a> *cbs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#gac421005283912bb5186b035013aa58c0">ldlm_cli_enqueue_fini</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, enum <a class="el" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type, __u8 with_policy, enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags, void *lvb, __u32 lvb_len, const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lockh, int rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finishing portion of client lock enqueue code.  <a href="#gac421005283912bb5186b035013aa58c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga1fc673f7fb2c06baaa796f09afc33487">ldlm_cli_enqueue_local</a> (struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *ns, const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *res_id, enum <a class="el" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type, union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy, enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags, <a class="el" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378">ldlm_blocking_callback</a> blocking, <a class="el" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257">ldlm_completion_callback</a> completion, <a class="el" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d">ldlm_glimpse_callback</a> glimpse, void *data, __u32 lvb_len, enum <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>, const <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *client_cookie, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lockh)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enqueue a local lock (typically on a server).  <a href="#ga1fc673f7fb2c06baaa796f09afc33487"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga2a5622167fd1e1543cef0addb8634f09">ldlm_cli_convert</a> (const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lockh, int new_mode, __u32 *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga83cbdc7f471f1c21e1200fb94d5be170">ldlm_cli_update_pool</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update client's OBD pool related fields with new SLV and Limit from <em>req</em>.  <a href="#ga83cbdc7f471f1c21e1200fb94d5be170"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga0237477d402999ab81f2b2447fceebc9">ldlm_cli_cancel</a> (const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lockh, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> cancel_flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Client side lock cancel.  <a href="#ga0237477d402999ab81f2b2447fceebc9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga8067f82d5a14a84d1c103d2de469501a">ldlm_cli_cancel_unused</a> (struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *, const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> flags, void *opaque)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel all locks on a namespace (or a specific resource, if given) that have 0 readers/writers.  <a href="#ga8067f82d5a14a84d1c103d2de469501a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga56914f0205e9d377eeceb78f8db71f66">ldlm_cli_cancel_unused_resource</a> (struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *ns, const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *res_id, union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy, enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> flags, void *opaque)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel all locks on a resource that have 0 readers/writers.  <a href="#ga56914f0205e9d377eeceb78f8db71f66"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga677e9f9ff5fbe2174b139fe8c2b77b70">ldlm_cli_cancel_req</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structlist__head.html">list_head</a> *<a class="el" href="writemany_8c.html#af39400667a953a7c5c34e3964aa1ce9f">head</a>, int count, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare and send a batched cancel RPC.  <a href="#ga677e9f9ff5fbe2174b139fe8c2b77b70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga2fab73fddf169b2202e11527226f7253">ldlm_cancel_resource_local</a> (struct <a class="el" href="structldlm__resource.html">ldlm_resource</a> *res, struct <a class="el" href="structlist__head.html">list_head</a> *cancels, union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy, enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> lock_flags, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> cancel_flags, void *opaque)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find and cancel locally unused locks found on resource, matched to the given policy, mode.  <a href="#ga2fab73fddf169b2202e11527226f7253"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#gac7dcd18ff549bf7b777a067e1c374149">ldlm_cli_cancel_list_local</a> (struct <a class="el" href="structlist__head.html">list_head</a> *cancels, int count, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Locally cancel up to <em>count</em> locks in list <em>cancels</em>.  <a href="#gac7dcd18ff549bf7b777a067e1c374149"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__cli__api.html#ga96adcececc3c547888075de942fa1872">ldlm_cli_cancel_list</a> (struct <a class="el" href="structlist__head.html">list_head</a> *<a class="el" href="writemany_8c.html#af39400667a953a7c5c34e3964aa1ce9f">head</a>, int count, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a> flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel client-side locks from a list and send/prepare cancel RPCs to the server.  <a href="#ga96adcececc3c547888075de942fa1872"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>These are typically used by client and server (*_local versions) to obtain and release locks. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga2fab73fddf169b2202e11527226f7253"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cancel_resource_local" ref="ga2fab73fddf169b2202e11527226f7253" args="(struct ldlm_resource *res, struct list_head *cancels, union ldlm_policy_data *policy, enum ldlm_mode mode, __u64 lock_flags, enum ldlm_cancel_flags cancel_flags, void *opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cancel_resource_local </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__resource.html">ldlm_resource</a> *&nbsp;</td>
          <td class="paramname"> <em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>lock_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>cancel_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find and cancel locally unused locks found on resource, matched to the given policy, mode. </p>
<p>GET the found locks and add them into the <em>cancels</em> list. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01854">1854</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l02841">ldlm_inodebits::bits</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__dlm_8h_source.html#l00822">ldlm_lock::l_ast_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00865">ldlm_lock::l_bl_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00778">ldlm_lock::l_flags</a>, <a class="el" href="lustre__dlm_8h_source.html#l00728">ldlm_lock::l_granted_mode</a>, <a class="el" href="lustre__dlm_8h_source.html#l00635">ldlm_policy_data::l_inodebits</a>, <a class="el" href="lustre__dlm_8h_source.html#l00772">ldlm_lock::l_policy_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00784">ldlm_lock::l_readers</a>, <a class="el" href="lustre__dlm_8h_source.html#l00705">ldlm_lock::l_res_link</a>, <a class="el" href="lustre__dlm_8h_source.html#l00694">ldlm_lock::l_resource</a>, <a class="el" href="lustre__dlm_8h_source.html#l00785">ldlm_lock::l_writers</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ldlm__request_8c_source.html#l01407">ldlm_cli_cancel_list_local()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01169">LDLM_ERROR</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00203">LDLM_FL_CANCELING</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00173">LDLM_FL_CBPENDING</a>, <a class="el" href="packet-lustre_8c_source.html#l00301">LDLM_IBITS</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00271">ldlm_is_bl_ast</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00204">ldlm_is_canceling</a>, <a class="el" href="lustre__dlm_8h_source.html#l01344">LDLM_LOCK_GET</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__dlm_8h_source.html#l01537">lock_res()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00157">lockmode_compat()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00941">ldlm_resource::lr_granted</a>, <a class="el" href="lustre__dlm_8h_source.html#l00970">ldlm_resource::lr_type</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__dlm_8h_source.html#l01550">unlock_res()</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l01971">ldlm_cli_cancel_unused_resource()</a>, <a class="el" href="mdc__reint_8c_source.html#l00067">mdc_resource_get_unused()</a>, and <a class="el" href="osc__request_8c_source.html#l00545">osc_resource_get_unused()</a>.</p>

</div>
</div>
<a class="anchor" id="ga0237477d402999ab81f2b2447fceebc9"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel" ref="ga0237477d402999ab81f2b2447fceebc9" args="(const struct lustre_handle *lockh, enum ldlm_cancel_flags cancel_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lockh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>cancel_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Client side lock cancel. </p>
<p>Lock must not have any readers or writers by this time. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01345">1345</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="genops_8c_source.html#l00749">class_exp2cliimp()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00330">exp_connect_cancelset()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00865">ldlm_lock::l_bl_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00759">ldlm_lock::l_conn_export</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__dlm_8h_source.html#l00616">LCF_ASYNC</a>, <a class="el" href="lustre__dlm_8h_source.html#l00618">LCF_BL_AST</a>, <a class="el" href="lustre__dlm_8h_source.html#l00617">LCF_LOCAL</a>, <a class="el" href="ldlm__request_8c_source.html#l01809">ldlm_cancel_lru_local()</a>, <a class="el" href="ldlm__request_8c_source.html#l01917">ldlm_cli_cancel_list()</a>, <a class="el" href="ldlm__request_8c_source.html#l01107">ldlm_cli_cancel_local()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01122">LDLM_DEBUG_NOLOCK</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00191">LDLM_FL_LOCAL_ONLY</a>, <a class="el" href="ldlm__request_8c_source.html#l00746">ldlm_format_handles_avail()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01282">ldlm_handle2lock_long()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00204">ldlm_is_canceling</a>, <a class="el" href="lustre__dlm_8h_source.html#l01338">LDLM_LOCK_RELEASE</a>, <a class="el" href="lustre__dlm_8h_source.html#l01006">ldlm_lock_to_ns()</a>, <a class="el" href="ldlm__internal_8h_source.html#l00104">LDLM_LRU_FLAG_AGED</a>, <a class="el" href="ldlm__internal_8h_source.html#l00107">LDLM_LRU_FLAG_LRUR</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00205">ldlm_set_canceling</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00046">LIST_HEAD_INIT</a>, <a class="el" href="l__lock_8c_source.html#l00051">lock_res_and_lock()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00553">ns_connect_lru_resize()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01456">RQF_LDLM_CANCEL</a>, and <a class="el" href="l__lock_8c_source.html#l00067">unlock_res_and_lock()</a>.</p>

<p>Referenced by <a class="el" href="ldlm__resource_8c_source.html#l00779">cleanup_resource()</a>, <a class="el" href="ldlm__request_8c_source.html#l00315">ldlm_blocking_ast_nocheck()</a>, <a class="el" href="ldlm__lockd_8c_source.html#l02153">ldlm_callback_handler()</a>, <a class="el" href="file_8c_source.html#l00901">ll_lease_close()</a>, <a class="el" href="namei_8c_source.html#l00187">ll_md_blocking_ast()</a>, <a class="el" href="file_8c_source.html#l00673">ll_md_blocking_lease_ast()</a>, <a class="el" href="mdc__lib_8c_source.html#l00400">mdc_intent_close_pack()</a>, <a class="el" href="mdt__handler_8c_source.html#l02366">mdt_remote_blocking_ast()</a>, <a class="el" href="mgc__request_8c_source.html#l00945">mgc_blocking_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00534">osc_ldlm_blocking_ast()</a>, <a class="el" href="qsd__lock_8c_source.html#l00176">qsd_glb_blocking_ast()</a>, <a class="el" href="qsd__lock_8c_source.html#l00295">qsd_id_blocking_ast()</a>, and <a class="el" href="tgt__main_8c_source.html#l00111">tgt_cancel_slc_locks()</a>.</p>

</div>
</div>
<a class="anchor" id="ga96adcececc3c547888075de942fa1872"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel_list" ref="ga96adcececc3c547888075de942fa1872" args="(struct list_head *head, int count, struct ptlrpc_request *req, enum ldlm_cancel_flags flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel client-side locks from a list and send/prepare cancel RPCs to the server. </p>
<p>If <em>req</em> is NULL, send CANCEL request to server with handles of locks in the <em>cancels</em>. If EARLY_CANCEL is not supported, send CANCEL requests separately per lock. If <em>req</em> is not NULL, put handles of locks in <em>cancels</em> into the request buffer at the offset <em>off</em>. Destroy <em>cancels</em> at the end. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01917">1917</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00266">CDEBUG_LIMIT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00145">D_DLMTRACE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00330">exp_connect_cancelset()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00865">ldlm_lock::l_bl_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00759">ldlm_lock::l_conn_export</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ldlm__request_8c_source.html#l01148">ldlm_cancel_pack()</a>, <a class="el" href="ldlm__request_8c_source.html#l01185">ldlm_cli_cancel_req()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01351">ldlm_lock_list_put</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lockd_8c_source.html#l02662">ldlm_bl_thread_blwi()</a>, <a class="el" href="ldlm__request_8c_source.html#l01345">ldlm_cli_cancel()</a>, <a class="el" href="ldlm__request_8c_source.html#l01407">ldlm_cli_cancel_list_local()</a>, <a class="el" href="ldlm__request_8c_source.html#l01971">ldlm_cli_cancel_unused_resource()</a>, <a class="el" href="ldlm__request_8c_source.html#l00762">ldlm_prep_elc_req()</a>, and <a class="el" href="mdc__reint_8c_source.html#l00350">mdc_rename()</a>.</p>

</div>
</div>
<a class="anchor" id="gac7dcd18ff549bf7b777a067e1c374149"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel_list_local" ref="gac7dcd18ff549bf7b777a067e1c374149" args="(struct list_head *cancels, int count, enum ldlm_cancel_flags flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel_list_local </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>cancel_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Locally cancel up to <em>count</em> locks in list <em>cancels</em>. </p>
<p>Return the number of cancelled locks. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01407">1407</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="lustre__dlm_8h_source.html#l00865">ldlm_lock::l_bl_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00618">LCF_BL_AST</a>, <a class="el" href="lustre__dlm_8h_source.html#l00617">LCF_LOCAL</a>, <a class="el" href="ldlm__request_8c_source.html#l01917">ldlm_cli_cancel_list()</a>, <a class="el" href="ldlm__request_8c_source.html#l01107">ldlm_cli_cancel_local()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00270">LDLM_FL_BL_AST</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00191">LDLM_FL_LOCAL_ONLY</a>, <a class="el" href="ldlm__lock_8c_source.html#l02249">ldlm_lock_cancel()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01338">LDLM_LOCK_RELEASE</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="list_8h_source.html#l00046">LIST_HEAD_INIT</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lockd_8c_source.html#l02662">ldlm_bl_thread_blwi()</a>, <a class="el" href="ldlm__request_8c_source.html#l01809">ldlm_cancel_lru_local()</a>, and <a class="el" href="ldlm__request_8c_source.html#l01854">ldlm_cancel_resource_local()</a>.</p>

</div>
</div>
<a class="anchor" id="ga677e9f9ff5fbe2174b139fe8c2b77b70"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel_req" ref="ga677e9f9ff5fbe2174b139fe8c2b77b70" args="(struct obd_export *exp, struct list_head *head, int count, enum ldlm_cancel_flags flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel_req </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare and send a batched cancel RPC. </p>
<p>It will include <em>count</em> lock handles of locks given in <em>cancels</em> list. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01185">1185</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00266">CDEBUG_LIMIT</a>, <a class="el" href="libcfs__fail_8h_source.html#l00104">CFS_FAIL_CHECK</a>, <a class="el" href="libcfs__fail_8h_source.html#l00139">CFS_FAIL_TIMEOUT</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="genops_8c_source.html#l00749">class_exp2cliimp()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00145">D_DLMTRACE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__export_8h_source.html#l00304">exp_connect_flags()</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__import_8h_source.html#l00237">obd_import::imp_generation</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_invalid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__dlm_8h_source.html#l00616">LCF_ASYNC</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="packet-lustre_8c_source.html#l00286">LDLM_CANCEL</a>, <a class="el" href="ldlm__request_8c_source.html#l01148">ldlm_cancel_pack()</a>, <a class="el" href="lustre__idl_8h_source.html#l00108">LDLM_CANCEL_REPLY_PORTAL</a>, <a class="el" href="lustre__idl_8h_source.html#l00107">LDLM_CANCEL_REQUEST_PORTAL</a>, <a class="el" href="ldlm__request_8c_source.html#l00746">ldlm_format_handles_avail()</a>, <a class="el" href="lustre__idl_8h_source.html#l02915">ldlm_request_bufsize</a>, <a class="el" href="nidstr_8h_source.html#l00077">libcfs_nid2str()</a>, <a class="el" href="lu__object_8h_source.html#l00619">lu_site::ls_top_dev</a>, <a class="el" href="packet-lustre_8c_source.html#l00079">LUSTRE_DLM_VERSION</a>, <a class="el" href="lustre__errno_8h_source.html#l00168">LUSTRE_ESTALE</a>, <a class="el" href="lustre__idl_8h_source.html#l01209">OBD_CONNECT_MDS_MDS</a>, <a class="el" href="obd__support_8h_source.html#l00344">OBD_FAIL_LDLM_CANCEL_RACE</a>, <a class="el" href="obd__support_8h_source.html#l00346">OBD_FAIL_LDLM_PAUSE_CANCEL</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="client_8c_source.html#l00293">ptlrpc_at_set_req_timeout()</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="client_8c_source.html#l00852">ptlrpc_request_alloc()</a>, <a class="el" href="client_8c_source.html#l00875">ptlrpc_request_free()</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00268">ptlrpcd_add_req()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="layout_8c_source.html#l01833">req_capsule_filled_sizes()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01033">RMF_DLM_REQ</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_allow_replay</a>, <a class="el" href="lustre__net_8h_source.html#l01104">ptlrpc_request::rq_import</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, and <a class="el" href="layout_8c_source.html#l01456">RQF_LDLM_CANCEL</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l01917">ldlm_cli_cancel_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ga8067f82d5a14a84d1c103d2de469501a"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel_unused" ref="ga8067f82d5a14a84d1c103d2de469501a" args="(struct ldlm_namespace *, const struct ldlm_res_id *, enum ldlm_cancel_flags flags, void *opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel_unused </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *&nbsp;</td>
          <td class="paramname"> <em>res_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel all locks on a namespace (or a specific resource, if given) that have 0 readers/writers. </p>
<p>If flags &amp; LCF_LOCAL, throw the locks away without trying to notify the server. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l02029">2029</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="hash_8c_source.html#l01663">cfs_hash_for_each_nolock()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ldlm__request_8c_source.html#l02005">ldlm_cli_cancel_arg::lc_flags</a>, <a class="el" href="packet-lustre_8c_source.html#l00290">LCK_MINMODE</a>, <a class="el" href="ldlm__request_8c_source.html#l01971">ldlm_cli_cancel_unused_resource()</a>, <a class="el" href="ldlm__request_8c_source.html#l02010">ldlm_cli_hash_cancel_unused()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00377">ldlm_namespace::ns_rs_hash</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lib_8c_source.html#l00604">client_disconnect_export()</a>.</p>

</div>
</div>
<a class="anchor" id="ga56914f0205e9d377eeceb78f8db71f66"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_cancel_unused_resource" ref="ga56914f0205e9d377eeceb78f8db71f66" args="(struct ldlm_namespace *ns, const struct ldlm_res_id *res_id, union ldlm_policy_data *policy, enum ldlm_mode mode, enum ldlm_cancel_flags flags, void *opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_cancel_unused_resource </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *&nbsp;</td>
          <td class="paramname"> <em>res_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">ldlm_cancel_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel all locks on a resource that have 0 readers/writers. </p>
<p>If flags &amp; LDLM_FL_LOCAL_ONLY, throw the locks away without trying to notify the server. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01971">1971</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__idl_8h_source.html#l02783">DLDLMRES</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__dlm_8h_source.html#l00618">LCF_BL_AST</a>, <a class="el" href="ldlm__request_8c_source.html#l01854">ldlm_cancel_resource_local()</a>, <a class="el" href="ldlm__request_8c_source.html#l01917">ldlm_cli_cancel_list()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01435">LDLM_RESOURCE_ADDREF</a>, <a class="el" href="lustre__dlm_8h_source.html#l01439">LDLM_RESOURCE_DELREF</a>, <a class="el" href="ldlm__resource_8c_source.html#l01179">ldlm_resource_get()</a>, <a class="el" href="ldlm__resource_8c_source.html#l01295">ldlm_resource_putref()</a>, <a class="el" href="list_8h_source.html#l00046">LIST_HEAD_INIT</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l02780">ldlm_res_id::name</a>, <a class="el" href="lustre__idl_8h_source.html#l02784">PLDLMRES</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l02029">ldlm_cli_cancel_unused()</a>, <a class="el" href="ldlm__request_8c_source.html#l02010">ldlm_cli_hash_cancel_unused()</a>, and <a class="el" href="mdc__locks_8c_source.html#l00156">mdc_cancel_unused()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2a5622167fd1e1543cef0addb8634f09"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_convert" ref="ga2a5622167fd1e1543cef0addb8634f09" args="(const struct lustre_handle *lockh, int new_mode, __u32 *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_convert </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lockh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>new_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01029">1029</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="genops_8c_source.html#l00749">class_exp2cliimp()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__dlm_8h_source.html#l00730">ldlm_lock::l_completion_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00759">ldlm_lock::l_conn_export</a>, <a class="el" href="lustre__dlm_8h_source.html#l00766">ldlm_lock::l_remote_handle</a>, <a class="el" href="lustre__idl_8h_source.html#l02898">ldlm_lock_desc::l_req_mode</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="ldlm__request_8c_source.html#l01001">ldlm_cli_convert_local()</a>, <a class="el" href="packet-lustre_8c_source.html#l00285">LDLM_CONVERT</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00179">LDLM_FL_WAIT_NOREPROC</a>, <a class="el" href="lustre__idl_8h_source.html#l02933">ldlm_flags_to_wire</a>, <a class="el" href="lustre__dlm_8h_source.html#l01273">ldlm_handle2lock()</a>, <a class="el" href="ldlm__lock_8c_source.html#l02459">ldlm_lock_convert()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01327">LDLM_LOCK_PUT</a>, <a class="el" href="ldlm__lock_8c_source.html#l02147">ldlm_reprocess_all()</a>, <a class="el" href="lustre__idl_8h_source.html#l02909">ldlm_request::lock_desc</a>, <a class="el" href="lustre__idl_8h_source.html#l02925">ldlm_reply::lock_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l02907">ldlm_request::lock_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l02910">ldlm_request::lock_handle</a>, <a class="el" href="packet-lustre_8c_source.html#l00079">LUSTRE_DLM_VERSION</a>, <a class="el" href="lustre__errno_8h_source.html#l00076">LUSTRE_EDEADLK</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="client_8c_source.html#l00891">ptlrpc_request_alloc_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l02158">req_capsule_server_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01039">RMF_DLM_REP</a>, <a class="el" href="layout_8c_source.html#l01033">RMF_DLM_REQ</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, and <a class="el" href="layout_8c_source.html#l01451">RQF_LDLM_CONVERT</a>.</p>

</div>
</div>
<a class="anchor" id="gac3edcad1b11e283d6ef8455a2b598b07"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_enqueue" ref="gac3edcad1b11e283d6ef8455a2b598b07" args="(struct obd_export *exp, struct ptlrpc_request **reqp, struct ldlm_enqueue_info *einfo, const struct ldlm_res_id *res_id, union ldlm_policy_data const *policy, __u64 *flags, void *lvb, __u32 lvb_len, enum lvb_type lvb_type, struct lustre_handle *lockh, int async)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_enqueue </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **&nbsp;</td>
          <td class="paramname"> <em>reqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structldlm__enqueue__info.html">ldlm_enqueue_info</a> *&nbsp;</td>
          <td class="paramname"> <em>einfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *&nbsp;</td>
          <td class="paramname"> <em>res_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> const *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>lvb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>lvb_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lockh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>async</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Client-side lock enqueue. </p>
<p>If a request has some specific initialisation it is passed in <em>reqp</em>, otherwise it is created in ldlm_cli_enqueue.</p>
<p>Supports sync and async requests, pass <em>async</em> flag accordingly. If a request was created in ldlm_cli_enqueue and it is the async request, pass it to the caller in <em>reqp</em>. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00869">869</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="genops_8c_source.html#l00749">class_exp2cliimp()</a>, <a class="el" href="lustre__idl_8h_source.html#l01132">DLM_LOCKREQ_OFF</a>, <a class="el" href="lustre__dlm_8h_source.html#l01099">ldlm_enqueue_info::ei_cb_bl</a>, <a class="el" href="lustre__dlm_8h_source.html#l01101">ldlm_enqueue_info::ei_cb_cp</a>, <a class="el" href="lustre__dlm_8h_source.html#l01102">ldlm_enqueue_info::ei_cb_gl</a>, <a class="el" href="lustre__dlm_8h_source.html#l01103">ldlm_enqueue_info::ei_cbdata</a>, <a class="el" href="lustre__dlm_8h_source.html#l01098">ldlm_enqueue_info::ei_mode</a>, <a class="el" href="lustre__dlm_8h_source.html#l01097">ldlm_enqueue_info::ei_type</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="ldlm__request_8c_source.html#l00491">failed_lock_cleanup()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00741">ldlm_lock::l_blocking_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00759">ldlm_lock::l_conn_export</a>, <a class="el" href="lustre__dlm_8h_source.html#l00754">ldlm_lock::l_export</a>, <a class="el" href="lustre__dlm_8h_source.html#l00633">ldlm_policy_data::l_extent</a>, <a class="el" href="lustre__dlm_8h_source.html#l00778">ldlm_lock::l_flags</a>, <a class="el" href="lustre__dlm_8h_source.html#l00797">ldlm_lock::l_last_activity</a>, <a class="el" href="lustre__dlm_8h_source.html#l00772">ldlm_lock::l_policy_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00806">ldlm_lock::l_req_extent</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="lustre__dlm_8h_source.html#l01208">ldlm_callback_suite::lcs_completion</a>, <a class="el" href="ldlm__request_8c_source.html#l00541">ldlm_cli_enqueue_fini()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="packet-lustre_8c_source.html#l00284">LDLM_ENQUEUE</a>, <a class="el" href="packet-lustre_8c_source.html#l00299">LDLM_EXTENT</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00349">LDLM_FL_EXCL</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00289">LDLM_FL_NO_LRU</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00070">LDLM_FL_REPLAY</a>, <a class="el" href="lustre__idl_8h_source.html#l02933">ldlm_flags_to_wire</a>, <a class="el" href="lustre__dlm_8h_source.html#l01282">ldlm_handle2lock_long()</a>, <a class="el" href="ldlm__lock_8c_source.html#l00646">ldlm_lock2desc()</a>, <a class="el" href="ldlm__lock_8c_source.html#l00582">ldlm_lock2handle()</a>, <a class="el" href="ldlm__lock_8c_source.html#l00786">ldlm_lock_addref_internal()</a>, <a class="el" href="ldlm__lock_8c_source.html#l01641">ldlm_lock_create()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01338">LDLM_LOCK_RELEASE</a>, <a class="el" href="lustre__idl_8h_source.html#l02909">ldlm_request::lock_desc</a>, <a class="el" href="lustre__idl_8h_source.html#l02907">ldlm_request::lock_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l02910">ldlm_request::lock_handle</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="packet-lustre_8c_source.html#l00079">LUSTRE_DLM_VERSION</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="client_8c_source.html#l00891">ptlrpc_request_alloc_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l02339">req_capsule_extend()</a>, <a class="el" href="layout_8c_source.html#l02263">req_capsule_get_size()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01049">RMF_DLM_LVB</a>, <a class="el" href="layout_8c_source.html#l01033">RMF_DLM_REQ</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="layout_8c_source.html#l01441">RQF_LDLM_ENQUEUE</a>, and <a class="el" href="layout_8c_source.html#l01446">RQF_LDLM_ENQUEUE_LVB</a>.</p>

<p>Referenced by <a class="el" href="mdc__locks_8c_source.html#l00724">mdc_enqueue()</a>, <a class="el" href="mdc__locks_8c_source.html#l01181">mdc_intent_getattr_async()</a>, <a class="el" href="mgc__request_8c_source.html#l01049">mgc_enqueue()</a>, <a class="el" href="osc__request_8c_source.html#l02052">osc_enqueue_base()</a>, <a class="el" href="osp__md__object_8c_source.html#l00880">osp_md_object_lock()</a>, and <a class="el" href="qsd__request_8c_source.html#l00205">qsd_intent_lock()</a>.</p>

</div>
</div>
<a class="anchor" id="gac421005283912bb5186b035013aa58c0"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_enqueue_fini" ref="gac421005283912bb5186b035013aa58c0" args="(struct obd_export *exp, struct ptlrpc_request *req, enum ldlm_type type, __u8 with_policy, enum ldlm_mode mode, __u64 *flags, void *lvb, __u32 lvb_len, const struct lustre_handle *lockh, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_enqueue_fini </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u8&nbsp;</td>
          <td class="paramname"> <em>with_policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>lvb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>lvb_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lockh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finishing portion of client lock enqueue code. </p>
<p>Called after receiving reply from server. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00541">541</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="hash_8c_source.html#l02004">cfs_hash_rehash_key()</a>, <a class="el" href="fsx_8c_source.html#l01082">cleanup()</a>, <a class="el" href="lustre__idl_8h_source.html#l01017">lustre_handle::cookie</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__idl_8h_source.html#l02783">DLDLMRES</a>, <a class="el" href="lustre__dlm_8h_source.html#l00078">ELDLM_LOCK_ABORTED</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__export_8h_source.html#l00304">exp_connect_flags()</a>, <a class="el" href="lustre__export_8h_source.html#l00221">obd_export::exp_lock_hash</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="ldlm__request_8c_source.html#l00491">failed_lock_cleanup()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__dlm_8h_source.html#l00730">ldlm_lock::l_completion_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00714">ldlm_lock::l_exp_hash</a>, <a class="el" href="lustre__dlm_8h_source.html#l00778">ldlm_lock::l_flags</a>, <a class="el" href="lustre__dlm_8h_source.html#l00728">ldlm_lock::l_granted_mode</a>, <a class="el" href="lustre__dlm_8h_source.html#l00819">ldlm_lock::l_lvb_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00818">ldlm_lock::l_lvb_len</a>, <a class="el" href="lustre__dlm_8h_source.html#l00772">ldlm_lock::l_policy_data</a>, <a class="el" href="lustre__idl_8h_source.html#l02900">ldlm_lock_desc::l_policy_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00766">ldlm_lock::l_remote_handle</a>, <a class="el" href="lustre__dlm_8h_source.html#l00724">ldlm_lock::l_req_mode</a>, <a class="el" href="lustre__idl_8h_source.html#l02898">ldlm_lock_desc::l_req_mode</a>, <a class="el" href="lustre__dlm_8h_source.html#l00694">ldlm_lock::l_resource</a>, <a class="el" href="lustre__idl_8h_source.html#l02897">ldlm_lock_desc::l_resource</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="ldlm__lock_8c_source.html#l00103">ldlm_convert_policy_to_local()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="lustre__dlm_8h_source.html#l01169">LDLM_ERROR</a>, <a class="el" href="ldlm__lock_8c_source.html#l01539">ldlm_fill_lvb()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00062">LDLM_FL_AST_SENT</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00270">LDLM_FL_BL_AST</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00173">LDLM_FL_CBPENDING</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00382">LDLM_FL_INHERIT_MASK</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00032">LDLM_FL_LOCK_CHANGED</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00070">LDLM_FL_REPLAY</a>, <a class="el" href="lustre__idl_8h_source.html#l02934">ldlm_flags_from_wire</a>, <a class="el" href="packet-lustre_8c_source.html#l00300">LDLM_FLOCK</a>, <a class="el" href="lustre__dlm_8h_source.html#l01273">ldlm_handle2lock()</a>, <a class="el" href="packet-lustre_8c_source.html#l00301">LDLM_IBITS</a>, <a class="el" href="ldlm__lock_8c_source.html#l00514">ldlm_lock_change_resource()</a>, <a class="el" href="ldlm__lock_8c_source.html#l01708">ldlm_lock_enqueue()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01327">LDLM_LOCK_PUT</a>, <a class="el" href="lustre__dlm_8h_source.html#l01338">LDLM_LOCK_RELEASE</a>, <a class="el" href="ldlm__lock_8c_source.html#l00052">ldlm_lockname</a>, <a class="el" href="packet-lustre_8c_source.html#l00298">LDLM_PLAIN</a>, <a class="el" href="lustre__idl_8h_source.html#l02789">ldlm_res_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l02927">ldlm_reply::lock_desc</a>, <a class="el" href="lustre__idl_8h_source.html#l02925">ldlm_reply::lock_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l02928">ldlm_reply::lock_handle</a>, <a class="el" href="l__lock_8c_source.html#l00051">lock_res_and_lock()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__dlm_8h_source.html#l00951">ldlm_resource::lr_name</a>, <a class="el" href="lustre__idl_8h_source.html#l02893">ldlm_resource_desc::lr_name</a>, <a class="el" href="lustre__dlm_8h_source.html#l00970">ldlm_resource::lr_type</a>, <a class="el" href="lustre__idl_8h_source.html#l01191">OBD_CONNECT_IBITS</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="lustre__idl_8h_source.html#l02784">PLDLMRES</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02263">req_capsule_get_size()</a>, <a class="el" href="layout_8c_source.html#l02158">req_capsule_server_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01049">RMF_DLM_LVB</a>, <a class="el" href="layout_8c_source.html#l01039">RMF_DLM_REP</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="l__lock_8c_source.html#l00067">unlock_res_and_lock()</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l00869">ldlm_cli_enqueue()</a>, <a class="el" href="mdc__locks_8c_source.html#l01131">mdc_intent_getattr_async_interpret()</a>, <a class="el" href="osc__request_8c_source.html#l01990">osc_enqueue_interpret()</a>, and <a class="el" href="qsd__request_8c_source.html#l00156">qsd_intent_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="ga1fc673f7fb2c06baaa796f09afc33487"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_enqueue_local" ref="ga1fc673f7fb2c06baaa796f09afc33487" args="(struct ldlm_namespace *ns, const struct ldlm_res_id *res_id, enum ldlm_type type, union ldlm_policy_data *policy, enum ldlm_mode mode, __u64 *flags, ldlm_blocking_callback blocking, ldlm_completion_callback completion, ldlm_glimpse_callback glimpse, void *data, __u32 lvb_len, enum lvb_type lvb_type, const __u64 *client_cookie, struct lustre_handle *lockh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_enqueue_local </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__res__id.html">ldlm_res_id</a> *&nbsp;</td>
          <td class="paramname"> <em>res_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378">ldlm_blocking_callback</a>&nbsp;</td>
          <td class="paramname"> <em>blocking</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257">ldlm_completion_callback</a>&nbsp;</td>
          <td class="paramname"> <em>completion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d">ldlm_glimpse_callback</a>&nbsp;</td>
          <td class="paramname"> <em>glimpse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>lvb_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>&nbsp;</td>
          <td class="paramname"> <em>lvb_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>client_cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lockh</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enqueue a local lock (typically on a server). </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00415">415</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lustre__dlm_8h_source.html#l00074">ELDLM_OK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__dlm_8h_source.html#l00833">ldlm_lock::l_client_cookie</a>, <a class="el" href="lustre__dlm_8h_source.html#l00730">ldlm_lock::l_completion_ast</a>, <a class="el" href="lustre__dlm_8h_source.html#l00633">ldlm_policy_data::l_extent</a>, <a class="el" href="lustre__dlm_8h_source.html#l00772">ldlm_lock::l_policy_data</a>, <a class="el" href="lustre__dlm_8h_source.html#l00806">ldlm_lock::l_req_extent</a>, <a class="el" href="lustre__dlm_8h_source.html#l00694">ldlm_lock::l_resource</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="lustre__dlm_8h_source.html#l01208">ldlm_callback_suite::lcs_completion</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="lustre__dlm_8h_source.html#l01169">LDLM_ERROR</a>, <a class="el" href="packet-lustre_8c_source.html#l00299">LDLM_EXTENT</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00258">LDLM_FL_ATOMIC_CB</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00070">LDLM_FL_REPLAY</a>, <a class="el" href="ldlm__lock_8c_source.html#l00582">ldlm_lock2handle()</a>, <a class="el" href="ldlm__lock_8c_source.html#l00735">ldlm_lock_addref_internal_nolock()</a>, <a class="el" href="ldlm__lock_8c_source.html#l01641">ldlm_lock_create()</a>, <a class="el" href="ldlm__lock_8c_source.html#l01708">ldlm_lock_enqueue()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01338">LDLM_LOCK_RELEASE</a>, <a class="el" href="lustre__dlm_8h_source.html#l01023">ldlm_lvbo_init()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00260">ldlm_set_atomic_cb</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00211">ldlm_set_local</a>, <a class="el" href="lustre__dlm_8h_source.html#l00518">ns_is_client()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l00355">__lfsck_ibits_lock()</a>, <a class="el" href="echo_8c_source.html#l00548">echo_setup()</a>, <a class="el" href="lfsck__layout_8c_source.html#l01954">lfsck_layout_slave_conditional_destroy()</a>, <a class="el" href="lod__object_8c_source.html#l03889">lod_object_lock()</a>, <a class="el" href="mdt__internal_8h_source.html#l00959">mdt_fid_lock()</a>, <a class="el" href="mdt__reint_8c_source.html#l01250">mdt_rename_lock()</a>, <a class="el" href="mgs__handler_8c_source.html#l00227">mgs_revoke_lock()</a>, <a class="el" href="ofd__obd_8c_source.html#l00984">ofd_destroy_by_fid()</a>, and <a class="el" href="tgt__handler_8c_source.html#l01676">tgt_extent_lock()</a>.</p>

</div>
</div>
<a class="anchor" id="ga83cbdc7f471f1c21e1200fb94d5be170"></a><!-- doxytag: member="lustre_dlm.h::ldlm_cli_update_pool" ref="ga83cbdc7f471f1c21e1200fb94d5be170" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_cli_update_pool </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update client's OBD pool related fields with new SLV and Limit from <em>req</em>. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l01294">1294</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00368">imp_connect_lru_resize()</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="pack__generic_8c_source.html#l01152">lustre_msg_get_limit()</a>, <a class="el" href="pack__generic_8c_source.html#l01116">lustre_msg_get_slv()</a>, <a class="el" href="obd_8h_source.html#l00726">obd_device::obd_pool_limit</a>, <a class="el" href="obd_8h_source.html#l00724">obd_device::obd_pool_lock</a>, <a class="el" href="obd_8h_source.html#l00725">obd_device::obd_pool_slv</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01104">ptlrpc_request::rq_import</a>, <a class="el" href="lustre__net_8h_source.html#l01032">ptlrpc_request::rq_repmsg</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="client_8c_source.html#l01297">after_reply()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4bde4e4e32bab2c971297a5f065dec66"></a><!-- doxytag: member="lustre_dlm.h::ldlm_enqueue_pack" ref="ga4bde4e4e32bab2c971297a5f065dec66" args="(struct obd_export *exp, int lvb_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a>* ldlm_enqueue_pack </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lvb_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00837">837</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="genops_8c_source.html#l00749">class_exp2cliimp()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ldlm__request_8c_source.html#l00829">ldlm_prep_enqueue_req()</a>, <a class="el" href="client_8c_source.html#l00852">ptlrpc_request_alloc()</a>, <a class="el" href="client_8c_source.html#l00875">ptlrpc_request_free()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01049">RMF_DLM_LVB</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, and <a class="el" href="layout_8c_source.html#l01441">RQF_LDLM_ENQUEUE</a>.</p>

<p>Referenced by <a class="el" href="osp__md__object_8c_source.html#l00880">osp_md_object_lock()</a>.</p>

</div>
</div>
<a class="anchor" id="gab2f8268913fc19a29b9d39248d3cbf0d"></a><!-- doxytag: member="lustre_dlm.h::ldlm_handle_enqueue0" ref="gab2f8268913fc19a29b9d39248d3cbf0d" args="(struct ldlm_namespace *ns, struct ptlrpc_request *req, const struct ldlm_request *dlm_req, const struct ldlm_callback_suite *cbs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_handle_enqueue0 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__namespace.html">ldlm_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__request.html">ldlm_request</a> *&nbsp;</td>
          <td class="paramname"> <em>dlm_req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structldlm__callback__suite.html">ldlm_callback_suite</a> *&nbsp;</td>
          <td class="paramname"> <em>cbs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="tgt__handler_8c_source.html#l01385">tgt_enqueue()</a>.</p>

</div>
</div>
<a class="anchor" id="gabae59a7ebeed8c6fd60b22f03cf88e1f"></a><!-- doxytag: member="lustre_dlm.h::ldlm_prep_elc_req" ref="gabae59a7ebeed8c6fd60b22f03cf88e1f" args="(struct obd_export *exp, struct ptlrpc_request *req, int version, int opc, int canceloff, struct list_head *cancels, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_prep_elc_req </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>opc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>canceloff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel LRU locks and pack them into the enqueue request. </p>
<p>Pack there the given <em>count</em> locks in <em>cancels</em>.</p>
<p>This is to be called by functions preparing their own requests that might contain lists of locks to cancel in addition to actual operation that needs to be performed. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00762">762</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ldlm__request_8c_source.html#l01809">ldlm_cancel_lru_local()</a>, <a class="el" href="ldlm__request_8c_source.html#l00738">ldlm_capsule_handles_avail()</a>, <a class="el" href="ldlm__request_8c_source.html#l01917">ldlm_cli_cancel_list()</a>, <a class="el" href="packet-lustre_8c_source.html#l00284">LDLM_ENQUEUE</a>, <a class="el" href="lustre__dlm_8h_source.html#l01351">ldlm_lock_list_put</a>, <a class="el" href="ldlm__internal_8h_source.html#l00104">LDLM_LRU_FLAG_AGED</a>, <a class="el" href="ldlm__internal_8h_source.html#l00110">LDLM_LRU_FLAG_LRUR_NO_WAIT</a>, <a class="el" href="lustre__idl_8h_source.html#l02915">ldlm_request_bufsize</a>, <a class="el" href="list_8h_source.html#l00046">LIST_HEAD_INIT</a>, <a class="el" href="lustre__idl_8h_source.html#l02908">ldlm_request::lock_count</a>, <a class="el" href="lustre__dlm_8h_source.html#l00544">ns_connect_cancelset()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00553">ns_connect_lru_resize()</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l01833">req_capsule_filled_sizes()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01033">RMF_DLM_REQ</a>, and <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l00829">ldlm_prep_enqueue_req()</a>, <a class="el" href="mdc__internal_8h_source.html#l00141">mdc_prep_elc_req()</a>, and <a class="el" href="osc__request_8c_source.html#l00606">osc_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9fe4c63a5cd0fe654e29fd11aea415cc"></a><!-- doxytag: member="lustre_dlm.h::ldlm_prep_enqueue_req" ref="ga9fe4c63a5cd0fe654e29fd11aea415cc" args="(struct obd_export *exp, struct ptlrpc_request *req, struct list_head *cancels, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_prep_enqueue_req </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>cancels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00829">829</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="packet-lustre_8c_source.html#l00284">LDLM_ENQUEUE</a>, <a class="el" href="lustre__idl_8h_source.html#l02904">LDLM_ENQUEUE_CANCEL_OFF</a>, <a class="el" href="ldlm__request_8c_source.html#l00762">ldlm_prep_elc_req()</a>, and <a class="el" href="packet-lustre_8c_source.html#l00079">LUSTRE_DLM_VERSION</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l00837">ldlm_enqueue_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00502">mdc_enqueue_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00412">mdc_intent_getattr_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00328">mdc_intent_getxattr_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00462">mdc_intent_layout_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00238">mdc_intent_open_pack()</a>, <a class="el" href="mdc__locks_8c_source.html#l00375">mdc_intent_unlink_pack()</a>, <a class="el" href="osc__request_8c_source.html#l02052">osc_enqueue_base()</a>, and <a class="el" href="qsd__request_8c_source.html#l00205">qsd_intent_lock()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:52 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
