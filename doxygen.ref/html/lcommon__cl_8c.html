<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/llite/lcommon_cl.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/llite/lcommon_cl.c File Reference</h1><code>#include &lt;<a class="el" href="libcfs_8h_source.html">libcfs/libcfs.h</a>&gt;</code><br/>
<code>#include &lt;linux/fs.h&gt;</code><br/>
<code>#include &lt;linux/sched.h&gt;</code><br/>
<code>#include &lt;linux/mm.h&gt;</code><br/>
<code>#include &lt;linux/quotaops.h&gt;</code><br/>
<code>#include &lt;linux/highmem.h&gt;</code><br/>
<code>#include &lt;linux/pagemap.h&gt;</code><br/>
<code>#include &lt;linux/rbtree.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__support_8h_source.html">obd_support.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__fid_8h_source.html">lustre_fid.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__dlm_8h_source.html">lustre_dlm.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__ver_8h_source.html">lustre_ver.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__mdc_8h_source.html">lustre_mdc.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cl__object_8h_source.html">cl_object.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="llite__internal_8h_source.html">llite_internal.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="vvp__internal_8h_source.html">vvp_internal.h</a>&quot;</code><br/>

<p><a href="lcommon__cl_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_LLITE</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a8e36eb858674e5dab2b07bb6400bcd5b">DEFINE_MUTEX</a> (cl_inode_fini_guard)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A mutex serializing calls to slp_inode_fini() under extreme memory pressure, when environments cannot be allocated.  <a href="#a8e36eb858674e5dab2b07bb6400bcd5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#ab4ddeb93e9aa9cac230107519e85c12b">cl_setattr_ost</a> (struct <a class="el" href="structcl__object.html">cl_object</a> *obj, const struct iattr *attr, unsigned int attr_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#ab5a34b3106b1f1d8fe6705b5c568f0c6">cl_file_inode_init</a> (struct inode *inode, struct <a class="el" href="structlustre__md.html">lustre_md</a> *md)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize or update CLIO structures for regular files when new meta-data arrives from the server.  <a href="#ab5a34b3106b1f1d8fe6705b5c568f0c6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a5215993fa16dd23f6ed075bc973ba449">cl_object_put_last</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__object.html">cl_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for others drop their references of the object at first, then we drop the last one, which will lead to the object be destroyed immediately.  <a href="#a5215993fa16dd23f6ed075bc973ba449"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a522981af77da3b98a01c053f7e18a0c6">cl_inode_fini</a> (struct inode *inode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a2bbbb914dc13833adb36e85b8a2fc5e0">cl_fid_build_ino</a> (const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, int api32)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">build inode number from passed   <a href="#a2bbbb914dc13833adb36e85b8a2fc5e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a97bb21550c942b0f86706150334462cb">cl_fid_build_gen</a> (const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">build inode generation from passed .  <a href="#a97bb21550c942b0f86706150334462cb"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a0f1d0a2f44b41752a5c6f50d524f2678">cl_inode_fini_env</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An `emergency' environment used by <a class="el" href="lcommon__cl_8c.html#a522981af77da3b98a01c053f7e18a0c6">cl_inode_fini()</a> when <a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1" title="Returns lu_env: if there already is an environment associated with the current thread...">cl_env_get()</a> fails.  <a href="#a0f1d0a2f44b41752a5c6f50d524f2678"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lcommon__cl_8c.html#a1ab14f15a78e26f3eaedd5a100900643">cl_inode_fini_refcheck</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="lcommon_cl.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_LLITE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00039">39</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a97bb21550c942b0f86706150334462cb"></a><!-- doxytag: member="lcommon_cl.c::cl_fid_build_gen" ref="a97bb21550c942b0f86706150334462cb" args="(const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u32 cl_fid_build_gen </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>build inode generation from passed . </p>
<p>If our FID overflows the 32-bit inode number then return a non-zero generation to distinguish them. </p>

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00280">280</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__fid_8h_source.html#l00693">fid_flatten()</a>, <a class="el" href="lustre__idl_8h_source.html#l00447">fid_is_igif()</a>, <a class="el" href="lustre__idl_8h_source.html#l00746">lu_igif_gen()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llite__lib_8c_source.html#l01865">ll_update_inode()</a>.</p>

</div>
</div>
<a class="anchor" id="a2bbbb914dc13833adb36e85b8a2fc5e0"></a><!-- doxytag: member="lcommon_cl.c::cl_fid_build_ino" ref="a2bbbb914dc13833adb36e85b8a2fc5e0" args="(const struct lu_fid *fid, int api32)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> cl_fid_build_ino </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>api32</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>build inode number from passed  </p>

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00269">269</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="lustre__fid_8h_source.html#l00693">fid_flatten()</a>, <a class="el" href="lustre__fid_8h_source.html#l00719">fid_flatten32()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llite__lib_8c_source.html#l00164">client_common_fill_super()</a>, <a class="el" href="dir_8c_source.html#l00214">ll_dir_read()</a>, <a class="el" href="file_8c_source.html#l03474">ll_getattr()</a>, <a class="el" href="llite__lib_8c_source.html#l01217">ll_iget_anon_dir()</a>, <a class="el" href="namei_8c_source.html#l00187">ll_md_blocking_ast()</a>, <a class="el" href="llite__lib_8c_source.html#l02284">ll_prep_inode()</a>, <a class="el" href="llite__lib_8c_source.html#l01865">ll_update_inode()</a>, and <a class="el" href="llite__nfs_8c_source.html#l00060">search_inode_for_lustre()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5a34b3106b1f1d8fe6705b5c568f0c6"></a><!-- doxytag: member="lcommon_cl.c::cl_file_inode_init" ref="ab5a34b3106b1f1d8fe6705b5c568f0c6" args="(struct inode *inode, struct lustre_md *md)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_file_inode_init </td>
          <td>(</td>
          <td class="paramtype">struct inode *&nbsp;</td>
          <td class="paramname"> <em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__md.html">lustre_md</a> *&nbsp;</td>
          <td class="paramname"> <em>md</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize or update CLIO structures for regular files when new meta-data arrives from the server. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>inode</em>&nbsp;</td><td>regular file inode </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>md</em>&nbsp;</td><td>new file metadata from MDS</p>
<ul>
<li>allocates <a class="el" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a> if necessary,</li>
<li>updated layout, if object was already here. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00131">131</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00972">lustre_md::body</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="cl__object_8c_source.html#l00298">cl_conf_set()</a>, <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, <a class="el" href="cl__object_8c_source.html#l00103">cl_object_find()</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, <a class="el" href="cl__object_8h_source.html#l00256">cl_object_conf::coc_inode</a>, <a class="el" href="cl__object_8h_source.html#l00241">cl_object_conf::coc_lu</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="obd_8h_source.html#l00973">lustre_md::layout</a>, <a class="el" href="llite__internal_8h_source.html#l00332">ll_i2info()</a>, <a class="el" href="llite__internal_8h_source.html#l01090">ll_i2sbi()</a>, <a class="el" href="llite__internal_8h_source.html#l00556">ll_sb_info::ll_site</a>, <a class="el" href="llite__internal_8h_source.html#l00244">ll_inode_info::lli_clob</a>, <a class="el" href="llite__internal_8h_source.html#l00134">ll_inode_info::lli_fid</a>, <a class="el" href="lu__object_8h_source.html#l00171">LOC_F_NEW</a>, <a class="el" href="lu__object_8h_source.html#l00187">lu_object_conf::loc_flags</a>, <a class="el" href="lu__object_8h_source.html#l00619">lu_site::ls_top_dev</a>, <a class="el" href="cl__object_8h_source.html#l01943">lu2cl_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00866">lu_object_ref_add()</a>, <a class="el" href="lustre__idl_8h_source.html#l02192">mdt_body::mbo_valid</a>, <a class="el" href="lustre__idl_8h_source.html#l01656">OBD_MD_FLID</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

<p>Referenced by <a class="el" href="namei_8c_source.html#l00111">ll_iget()</a>, and <a class="el" href="llite__lib_8c_source.html#l01865">ll_update_inode()</a>.</p>

</div>
</div>
<a class="anchor" id="a522981af77da3b98a01c053f7e18a0c6"></a><!-- doxytag: member="lcommon_cl.c::cl_inode_fini" ref="a522981af77da3b98a01c053f7e18a0c6" args="(struct inode *inode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_inode_fini </td>
          <td>(</td>
          <td class="paramtype">struct inode *&nbsp;</td>
          <td class="paramname"> <em>inode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00226">226</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, <a class="el" href="cl__object_8c_source.html#l01051">cl_env_implant()</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, <a class="el" href="cl__object_8c_source.html#l01028">cl_env_reenter()</a>, <a class="el" href="cl__object_8c_source.html#l01037">cl_env_reexit()</a>, <a class="el" href="cl__object_8c_source.html#l01066">cl_env_unplant()</a>, <a class="el" href="cl__object_8c_source.html#l00435">cl_object_kill()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00198">cl_object_put_last()</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__internal_8h_source.html#l00332">ll_i2info()</a>, <a class="el" href="llite__internal_8h_source.html#l00244">ll_inode_info::lli_clob</a>, and <a class="el" href="lu__object_8h_source.html#l00881">lu_object_ref_del()</a>.</p>

<p>Referenced by <a class="el" href="llite__lib_8c_source.html#l01433">ll_clear_inode()</a>.</p>

</div>
</div>
<a class="anchor" id="a5215993fa16dd23f6ed075bc973ba449"></a><!-- doxytag: member="lcommon_cl.c::cl_object_put_last" ref="a5215993fa16dd23f6ed075bc973ba449" args="(struct lu_env *env, struct cl_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cl_object_put_last </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__object.html">cl_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for others drop their references of the object at first, then we drop the last one, which will lead to the object be destroyed immediately. </p>
<p>Must be called after <a class="el" href="group__cl__object.html#ga2969ac9d2e4cce406eb1bfa24838964f" title="Helper function removing all object locks, and marking object for deletion.">cl_object_kill()</a> against this object.</p>
<p>The reason we want to do this is: destroying top object will wait for sub objects being destroyed first, so we can't let bottom layer (e.g. from ASTs) to initiate top object destroying which may deadlock. See bz22520. </p>

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00198">198</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00120">cl_object_put()</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, <a class="el" href="it__test_8c_source.html#l00070">header</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lu__object_8h_source.html#l00468">lu_object::lo_header</a>, <a class="el" href="lu__object_8h_source.html#l00525">lu_object_header::loh_fid</a>, <a class="el" href="lu__object_8h_source.html#l00534">lu_object_header::loh_ref</a>, <a class="el" href="lu__object_8h_source.html#l00583">lu_site_bkt_data::lsb_marche_funebre</a>, <a class="el" href="lu__object_8h_source.html#l00653">lu_site_bkt_from_fid()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4ddeb93e9aa9cac230107519e85c12b"></a><!-- doxytag: member="lcommon_cl.c::cl_setattr_ost" ref="ab4ddeb93e9aa9cac230107519e85c12b" args="(struct cl_object *obj, const struct iattr *attr, unsigned int attr_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_setattr_ost </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcl__object.html">cl_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct iattr *&nbsp;</td>
          <td class="paramname"> <em>attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>attr_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00075">75</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01820">cl_io::ci_need_restart</a>, <a class="el" href="cl__object_8h_source.html#l01752">cl_io::ci_obj</a>, <a class="el" href="cl__object_8h_source.html#l01819">cl_io::ci_result</a>, <a class="el" href="structcl__io.html#add969c0bdeb6aada0869a2e9c45b406a">cl_io::ci_setattr</a>, <a class="el" href="cl__object_8h_source.html#l01820">cl_io::ci_verify_layout</a>, <a class="el" href="cl__object_8h_source.html#l01366">CIT_SETATTR</a>, <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, <a class="el" href="cl__io_8c_source.html#l00103">cl_io_fini()</a>, <a class="el" href="cl__io_8c_source.html#l00211">cl_io_init()</a>, <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__compat_8h_source.html#l00094">LTIME_S</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="llite__internal_8h_source.html#l00078">LUSTRE_FPRIVATE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="structcl__io.html#a8b561db29f0b79fba4d14b66b9882530">cl_io::u</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, <a class="el" href="vvp__internal_8h_source.html#l00133">vvp_io::vui_fd</a>, <a class="el" href="vvp__internal_8h_source.html#l00209">vvp_env_io()</a>, and <a class="el" href="vvp__internal_8h_source.html#l00186">vvp_env_thread_io()</a>.</p>

<p>Referenced by <a class="el" href="llite__lib_8c_source.html#l02064">ll_iocontrol()</a>, and <a class="el" href="llite__lib_8c_source.html#l01574">ll_setattr_raw()</a>.</p>

</div>
</div>
<a class="anchor" id="a8e36eb858674e5dab2b07bb6400bcd5b"></a><!-- doxytag: member="lcommon_cl.c::DEFINE_MUTEX" ref="a8e36eb858674e5dab2b07bb6400bcd5b" args="(cl_inode_fini_guard)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static DEFINE_MUTEX </td>
          <td>(</td>
          <td class="paramtype">cl_inode_fini_guard&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A mutex serializing calls to slp_inode_fini() under extreme memory pressure, when environments cannot be allocated. </p>

<p>Referenced by <a class="el" href="sec__bulk_8c_source.html#l00427">enc_pools_add_pages()</a>, and <a class="el" href="sec_8c_source.html#l00117">sptlrpc_wireflavor2policy()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a0f1d0a2f44b41752a5c6f50d524f2678"></a><!-- doxytag: member="lcommon_cl.c::cl_inode_fini_env" ref="a0f1d0a2f44b41752a5c6f50d524f2678" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* <a class="el" href="llite__internal_8h.html#a0f1d0a2f44b41752a5c6f50d524f2678">cl_inode_fini_env</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>An `emergency' environment used by <a class="el" href="lcommon__cl_8c.html#a522981af77da3b98a01c053f7e18a0c6">cl_inode_fini()</a> when <a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1" title="Returns lu_env: if there already is an environment associated with the current thread...">cl_env_get()</a> fails. </p>
<p>Access to this environment is serialized by cl_inode_fini_guard mutex. </p>

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00066">66</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>Referenced by <a class="el" href="super25_8c_source.html#l00213">lustre_exit()</a>, and <a class="el" href="super25_8c_source.html#l00105">lustre_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a1ab14f15a78e26f3eaedd5a100900643"></a><!-- doxytag: member="lcommon_cl.c::cl_inode_fini_refcheck" ref="a1ab14f15a78e26f3eaedd5a100900643" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u16 <a class="el" href="llite__internal_8h.html#a1ab14f15a78e26f3eaedd5a100900643">cl_inode_fini_refcheck</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lcommon__cl_8c_source.html#l00067">67</a> of file <a class="el" href="lcommon__cl_8c_source.html">lcommon_cl.c</a>.</p>

<p>Referenced by <a class="el" href="super25_8c_source.html#l00213">lustre_exit()</a>, and <a class="el" href="super25_8c_source.html#l00105">lustre_init()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:47 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
