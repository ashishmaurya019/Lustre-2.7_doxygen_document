<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ofd/ofd_objects.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ofd/ofd_objects.c File Reference</h1><code>#include &lt;<a class="el" href="dt__object_8h_source.html">dt_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__idl_8h_source.html">lustre/lustre_idl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__lfsck_8h_source.html">lustre_lfsck.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ofd__internal_8h_source.html">ofd_internal.h</a>&quot;</code><br/>

<p><a href="ofd__objects_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_FILTER</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a3540cb7ea6b60a2c6690a60a8ad98ad6">ofd_version_get_check</a> (struct <a class="el" href="structofd__thread__info.html">ofd_thread_info</a> *info, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get object version from disk and check it.  <a href="#a3540cb7ea6b60a2c6690a60a8ad98ad6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a57ac86f9d9ab8efeac61c1a578175a40">ofd_object_find</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get OFD object by FID.  <a href="#a57ac86f9d9ab8efeac61c1a578175a40"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a717bbfb0c00e765805d251e3cefef3ff">ofd_object_ff_load</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get FID of parent MDT object.  <a href="#a717bbfb0c00e765805d251e3cefef3ff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a72400bb0b6ad0127f9056b7d7676ff6d">ofd_object_put</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Put OFD object reference.  <a href="#a72400bb0b6ad0127f9056b7d7676ff6d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a996461722e57519b8c0af17df020a387">ofd_precreate_objects</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, u64 id, struct <a class="el" href="structofd__seq.html">ofd_seq</a> *oseq, int nr, int sync)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Precreate the given number <em>nr</em> of objects in the given sequence <em>oseq</em>.  <a href="#a996461722e57519b8c0af17df020a387"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#ae7dbf73641d2ab238392befa35628d06">ofd_attr_handle_ugid</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, int is_setattr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fix the OFD object ownership.  <a href="#ae7dbf73641d2ab238392befa35628d06"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a870eac73cb1ba85bca50cf8f1e116973">ofd_attr_set</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structfilter__fid.html">filter_fid</a> *ff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set OFD object attributes.  <a href="#a870eac73cb1ba85bca50cf8f1e116973"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a7b3f8fb17c1e77da04da0352c11e4fd3">ofd_object_punch</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="el" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> end, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structfilter__fid.html">filter_fid</a> *ff, struct <a class="el" href="structobdo.html">obdo</a> *oa)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Truncate/punch OFD object.  <a href="#a7b3f8fb17c1e77da04da0352c11e4fd3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a892086cdfc86b18fc75ef7604d15b214">ofd_object_destroy</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, int orphan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy OFD object.  <a href="#a892086cdfc86b18fc75ef7604d15b214"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__objects_8c.html#a84d4011f9915ff3ccad468d9c724a81d">ofd_attr_get</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get OFD object attributes.  <a href="#a84d4011f9915ff3ccad468d9c724a81d"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="ofd_objects.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_FILTER</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00041">41</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a84d4011f9915ff3ccad468d9c724a81d"></a><!-- doxytag: member="ofd_objects.c::ofd_attr_get" ref="a84d4011f9915ff3ccad468d9c724a81d" args="(const struct lu_env *env, struct ofd_object *fo, struct lu_attr *la)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_attr_get </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get OFD object attributes. </p>
<p>This function gets OFD object regular attributes. It is used to serve incoming request as well as for local OFD purposes.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00778">778</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__obd_8c_source.html#l01168">ofd_echo_getattr()</a>, <a class="el" href="ofd__dev_8c_source.html#l01281">ofd_getattr_hdl()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00085">ofd_lvbo_init()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00182">ofd_lvbo_update()</a>, and <a class="el" href="ofd__dev_8c_source.html#l01948">ofd_sync_hdl()</a>.</p>

</div>
</div>
<a class="anchor" id="ae7dbf73641d2ab238392befa35628d06"></a><!-- doxytag: member="ofd_objects.c::ofd_attr_handle_ugid" ref="ae7dbf73641d2ab238392befa35628d06" args="(const struct lu_env *env, struct ofd_object *fo, struct lu_attr *la, int is_setattr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_attr_handle_ugid </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_setattr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fix the OFD object ownership. </p>
<p>If the object still has SUID+SGID bits set, meaning that it was precreated by the MDT before it was assigned to any file, (see <a class="el" href="ofd__internal_8h.html#a996461722e57519b8c0af17df020a387" title="Precreate the given number nr of objects in the given sequence oseq.">ofd_precreate_objects()</a>) then we will accept the UID+GID if sent by the client for initializing the ownership of this object. We only allow this to happen once (so clear these bits) and later only allow setattr.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>is_setattr</em>&nbsp;</td><td>was this function called from setattr or not</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00434">434</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ofd__internal_8h_source.html#l00300">ofd_thread_info::fti_attr2</a>, <a class="el" href="lu__object_8h_source.html#l00450">LA_GID</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00449">LA_UID</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00491">ofd_attr_set()</a>, <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>, and <a class="el" href="ofd__io_8c_source.html#l00813">ofd_write_attr_set()</a>.</p>

</div>
</div>
<a class="anchor" id="a870eac73cb1ba85bca50cf8f1e116973"></a><!-- doxytag: member="ofd_objects.c::ofd_attr_set" ref="a870eac73cb1ba85bca50cf8f1e116973" args="(const struct lu_env *env, struct ofd_object *fo, struct lu_attr *la, struct filter_fid *ff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_attr_set </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfilter__fid.html">filter_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>ff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set OFD object attributes. </p>
<p>This function sets OFD object attributes taken from incoming request. It sets not only regular attributes but also XATTR_NAME_FID extended attribute if needed. The "fid" xattr allows the object's MDT parent inode to be found and verified by LFSCK and other tools in case of inconsistency.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ff</em>&nbsp;</td><td><a class="el" href="structfilter__fid.html">filter_fid</a> structure, contains additional attributes</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00491">491</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__user_8h_source.html#l00167">filter_fid::ff_parent</a>, <a class="el" href="ofd__internal_8h_source.html#l00062">ofd_mod_data::fmd_mactime_xid</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00294">ofd_thread_info::fti_exp</a>, <a class="el" href="ofd__internal_8h_source.html#l00295">ofd_thread_info::fti_xid</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00445">LA_MTIME</a>, <a class="el" href="lu__object_8h_source.html#l00447">LA_SIZE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lu__object_8h_source.html#l00525">lu_object_header::loh_fid</a>, <a class="el" href="ofd__objects_8c_source.html#l00434">ofd_attr_handle_ugid()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00228">ofd_fmd_get()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00084">ofd_fmd_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00250">ofd_obj2dev()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00138">ofd_object_ff_load()</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__trans_8c_source.html#l00089">ofd_trans_start()</a>, <a class="el" href="ofd__trans_8c_source.html#l00110">ofd_trans_stop()</a>, <a class="el" href="ofd__objects_8c_source.html#l00063">ofd_version_get_check()</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00218">ofd_object::ofo_header</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="lustre__idl_8h_source.html#l01599">XATTR_NAME_FID</a>.</p>

<p>Referenced by <a class="el" href="ofd__obd_8c_source.html#l00892">ofd_echo_setattr()</a>, and <a class="el" href="ofd__dev_8c_source.html#l01363">ofd_setattr_hdl()</a>.</p>

</div>
</div>
<a class="anchor" id="a892086cdfc86b18fc75ef7604d15b214"></a><!-- doxytag: member="ofd_objects.c::ofd_object_destroy" ref="a892086cdfc86b18fc75ef7604d15b214" args="(const struct lu_env *env, struct ofd_object *fo, int orphan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_object_destroy </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>orphan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy OFD object. </p>
<p>This function destroys OFD object. If object wasn't used at all (orphan) then local transaction is used, which means the transaction data is not returned back in reply.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>orphan</em>&nbsp;</td><td>flag to indicate that object is orphaned</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00722">722</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02137">dt_declare_destroy()</a>, <a class="el" href="dt__object_8h_source.html#l02292">dt_declare_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02151">dt_destroy()</a>, <a class="el" href="dt__object_8h_source.html#l02305">dt_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00525">lu_object_header::loh_fid</a>, <a class="el" href="ofd__internal_8h_source.html#l00484">ofd_fmd_drop</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00250">ofd_obj2dev()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__trans_8c_source.html#l00089">ofd_trans_start()</a>, <a class="el" href="ofd__trans_8c_source.html#l00110">ofd_trans_stop()</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00218">ofd_object::ofo_header</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="rename__many_8c_source.html#l00056">stop</a>.</p>

<p>Referenced by <a class="el" href="ofd__obd_8c_source.html#l00984">ofd_destroy_by_fid()</a>.</p>

</div>
</div>
<a class="anchor" id="a717bbfb0c00e765805d251e3cefef3ff"></a><!-- doxytag: member="ofd_objects.c::ofd_object_ff_load" ref="a717bbfb0c00e765805d251e3cefef3ff" args="(const struct lu_env *env, struct ofd_object *fo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_object_ff_load </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get FID of parent MDT object. </p>
<p>This function reads extended attribute XATTR_NAME_FID of OFD object which contains the MDT parent object FID and saves it in <a class="el" href="structofd__object.html#ab4655ef8f7b9783a6cdd5d08adadadd1">ofd_object::ofo_pfid</a>.</p>
<p>The filter_fid::ff_parent::f_ver field currently holds the OST-object index in the parent MDT-object's layout EA, not the actual FID::f_ver of the parent. We therefore access it via the macro f_stripe_idx.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENODATA</em>&nbsp;</td><td>if there is no such xattr </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00138">138</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__user_8h_source.html#l00172">filter_fid_old::ff_parent</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00304">ofd_thread_info::fti_mds_fid_old</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, and <a class="el" href="lustre__idl_8h_source.html#l01599">XATTR_NAME_FID</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00491">ofd_attr_set()</a>, <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>, <a class="el" href="ofd__io_8c_source.html#l00378">ofd_verify_ff()</a>, and <a class="el" href="ofd__io_8c_source.html#l00813">ofd_write_attr_set()</a>.</p>

</div>
</div>
<a class="anchor" id="a57ac86f9d9ab8efeac61c1a578175a40"></a><!-- doxytag: member="ofd_objects.c::ofd_object_find" ref="a57ac86f9d9ab8efeac61c1a578175a40" args="(const struct lu_env *env, struct ofd_device *ofd, const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structofd__object.html">ofd_object</a>* ofd_object_find </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get OFD object by FID. </p>
<p>This function finds OFD slice of compound object with the given FID.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of the object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the found <a class="el" href="structofd__object.html">ofd_object</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>in case of error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00102">102</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="lu__object_8c_source.html#l00643">lu_object_find()</a>, <a class="el" href="ofd__internal_8h_source.html#l00117">ofd_device::ofd_dt_dev</a>, <a class="el" href="ofd__internal_8h_source.html#l00225">ofd_obj()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00772">ofd_commitrw_read()</a>, <a class="el" href="ofd__io_8c_source.html#l01009">ofd_commitrw_write()</a>, <a class="el" href="ofd__dev_8c_source.html#l00973">ofd_fiemap_get()</a>, <a class="el" href="ofd__obd_8c_source.html#l01220">ofd_ioc_get_obj_version()</a>, <a class="el" href="ofd__dev_8c_source.html#l02118">ofd_ladvise_hdl()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00085">ofd_lvbo_init()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00182">ofd_lvbo_update()</a>, <a class="el" href="ofd__internal_8h_source.html#l00420">ofd_object_find_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00206">ofd_precreate_objects()</a>, <a class="el" href="ofd__io_8c_source.html#l00440">ofd_preprw_read()</a>, and <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b3f8fb17c1e77da04da0352c11e4fd3"></a><!-- doxytag: member="ofd_objects.c::ofd_object_punch" ref="a7b3f8fb17c1e77da04da0352c11e4fd3" args="(const struct lu_env *env, struct ofd_object *fo, __u64 start, __u64 end, struct lu_attr *la, struct filter_fid *ff, struct obdo *oa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_object_punch </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfilter__fid.html">filter_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>ff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Truncate/punch OFD object. </p>
<p>This function frees all of the allocated object's space from the <em>start</em> offset to the <em>end</em> offset. For truncate() operations the <em>end</em> offset is OBD_OBJECT_EOF. The functionality to punch holes in an object via fallocate(FALLOC_FL_PUNCH_HOLE) is not yet implemented (see LU-3606).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>start</em>&nbsp;</td><td>start offset to punch from </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>end</em>&nbsp;</td><td>end of punch </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ff</em>&nbsp;</td><td><a class="el" href="structfilter__fid.html">filter_fid</a> structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td><a class="el" href="structobdo.html">obdo</a> struct from incoming request</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00600">600</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02398">dt_declare_punch()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02408">dt_punch()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__user_8h_source.html#l00167">filter_fid::ff_parent</a>, <a class="el" href="ofd__internal_8h_source.html#l00062">ofd_mod_data::fmd_mactime_xid</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00294">ofd_thread_info::fti_exp</a>, <a class="el" href="ofd__internal_8h_source.html#l00295">ofd_thread_info::fti_xid</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lu__object_8h_source.html#l00525">lu_object_header::loh_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="lustre__idl_8h_source.html#l01680">OBD_MD_FLFID</a>, <a class="el" href="lustre__idl_8h_source.html#l01767">OBD_OBJECT_EOF</a>, <a class="el" href="ofd__objects_8c_source.html#l00434">ofd_attr_handle_ugid()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00228">ofd_fmd_get()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00084">ofd_fmd_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00175">ofd_device::ofd_lfsck_verify_pfid</a>, <a class="el" href="ofd__internal_8h_source.html#l00250">ofd_obj2dev()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00138">ofd_object_ff_load()</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__trans_8c_source.html#l00089">ofd_trans_start()</a>, <a class="el" href="ofd__trans_8c_source.html#l00110">ofd_trans_stop()</a>, <a class="el" href="ofd__io_8c_source.html#l00378">ofd_verify_ff()</a>, <a class="el" href="ofd__objects_8c_source.html#l00063">ofd_version_get_check()</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00218">ofd_object::ofo_header</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="lustre__idl_8h_source.html#l01599">XATTR_NAME_FID</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l02007">ofd_punch_hdl()</a>.</p>

</div>
</div>
<a class="anchor" id="a72400bb0b6ad0127f9056b7d7676ff6d"></a><!-- doxytag: member="ofd_objects.c::ofd_object_put" ref="a72400bb0b6ad0127f9056b7d7676ff6d" args="(const struct lu_env *env, struct ofd_object *fo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_object_put </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Put OFD object reference. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00174">174</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, and <a class="el" href="ofd__internal_8h_source.html#l00219">ofd_object::ofo_obj</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00772">ofd_commitrw_read()</a>, <a class="el" href="ofd__io_8c_source.html#l01009">ofd_commitrw_write()</a>, <a class="el" href="ofd__obd_8c_source.html#l00984">ofd_destroy_by_fid()</a>, <a class="el" href="ofd__obd_8c_source.html#l01168">ofd_echo_getattr()</a>, <a class="el" href="ofd__obd_8c_source.html#l00892">ofd_echo_setattr()</a>, <a class="el" href="ofd__dev_8c_source.html#l00973">ofd_fiemap_get()</a>, <a class="el" href="ofd__dev_8c_source.html#l01281">ofd_getattr_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01220">ofd_ioc_get_obj_version()</a>, <a class="el" href="ofd__dev_8c_source.html#l02118">ofd_ladvise_hdl()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00085">ofd_lvbo_init()</a>, <a class="el" href="ofd__lvb_8c_source.html#l00182">ofd_lvbo_update()</a>, <a class="el" href="ofd__internal_8h_source.html#l00420">ofd_object_find_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00206">ofd_precreate_objects()</a>, <a class="el" href="ofd__io_8c_source.html#l00440">ofd_preprw_read()</a>, <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>, <a class="el" href="ofd__dev_8c_source.html#l02007">ofd_punch_hdl()</a>, <a class="el" href="ofd__dev_8c_source.html#l01363">ofd_setattr_hdl()</a>, and <a class="el" href="ofd__dev_8c_source.html#l01948">ofd_sync_hdl()</a>.</p>

</div>
</div>
<a class="anchor" id="a996461722e57519b8c0af17df020a387"></a><!-- doxytag: member="ofd_objects.c::ofd_precreate_objects" ref="a996461722e57519b8c0af17df020a387" args="(const struct lu_env *env, struct ofd_device *ofd, u64 id, struct ofd_seq *oseq, int nr, int sync)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_precreate_objects </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>oseq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sync</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Precreate the given number <em>nr</em> of objects in the given sequence <em>oseq</em>. </p>
<p>This function precreates new OST objects in the given sequence. The precreation starts from <em>id</em> and creates <em>nr</em> objects sequentially.</p>
<p>Notes: This function may create fewer objects than requested.</p>
<p>We mark object SUID+SGID to flag it for accepting UID+GID from client on first write. Currently the permission bits on the OST are never used, so this is OK.</p>
<p>Initialize a/c/m time so any client timestamp will always be newer and update the inode. The ctime = 0 case is also handled specially in <a class="el" href="osd-ldiskfs_2osd__handler_8c.html#ab28dd16ff6b86e9465309b87a94a39f3">osd_inode_setattr()</a>. See LU-221, LU-1042 for details.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>id</em>&nbsp;</td><td>object ID to start precreation from </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oseq</em>&nbsp;</td><td>object sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nr</em>&nbsp;</td><td>number of objects to precreate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sync</em>&nbsp;</td><td>synchronous precreation flag</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if successful </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00206">206</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="byteorder_8h_source.html#l00059">cpu_to_le64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00130">D_INODE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="dt__object_8h_source.html#l01732">dt_device::dd_record_fid_accessed</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02120">dt_create()</a>, <a class="el" href="dt__object_8h_source.html#l02103">dt_declare_create()</a>, <a class="el" href="dt__object_8h_source.html#l02087">dt_declare_record_write()</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="lustre__idl_8h_source.html#l00342">fid_seq_is_mdt0()</a>, <a class="el" href="lustre__idl_8h_source.html#l00623">fid_set_id()</a>, <a class="el" href="ofd__internal_8h_source.html#l00299">ofd_thread_info::fti_attr</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00315">ofd_thread_info::fti_dof</a>, <a class="el" href="ofd__internal_8h_source.html#l00298">ofd_thread_info::fti_fid</a>, <a class="el" href="ofd__internal_8h_source.html#l00323">ofd_thread_info::fti_lr</a>, <a class="el" href="ofd__internal_8h_source.html#l00317">ofd_thread_info::fti_off</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__idl_8h_source.html#l00320">IDIF_MAX_OID</a>, <a class="el" href="lu__object_8h_source.html#l00413">lu_attr::la_atime</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00411">lu_attr::la_mtime</a>, <a class="el" href="lu__object_8h_source.html#l00445">LA_MTIME</a>, <a class="el" href="lu__object_8h_source.html#l00452">LA_TYPE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03465">LE_FID_ACCESSED</a>, <a class="el" href="lfsck__lib_8c_source.html#l03296">lfsck_in_notify()</a>, <a class="el" href="lustre__lfsck_8h_source.html#l00087">lfsck_pack_rfa()</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00168">LFSCK_TYPE_LAYOUT</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00537">OBD_FAIL_LFSCK_DANGLING</a>, <a class="el" href="obd__support_8h_source.html#l00534">OBD_FAIL_LFSCK_SKIP_LASTID</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="lustre__idl_8h_source.html#l00317">OBIF_MAX_OID</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00102">ofd_object_find()</a>, <a class="el" href="ofd__objects_8c_source.html#l00174">ofd_object_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__fs_8c_source.html#l00164">ofd_seq_last_oid()</a>, <a class="el" href="ofd__fs_8c_source.html#l00181">ofd_seq_last_oid_set()</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__trans_8c_source.html#l00110">ofd_trans_stop()</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00219">ofd_object::ofo_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00112">ofd_seq::os_lastid_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l00531">ostid_seq()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01084">ofd_echo_create()</a>, and <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a3540cb7ea6b60a2c6690a60a8ad98ad6"></a><!-- doxytag: member="ofd_objects.c::ofd_version_get_check" ref="a3540cb7ea6b60a2c6690a60a8ad98ad6" args="(struct ofd_thread_info *info, struct ofd_object *fo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_version_get_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__thread__info.html">ofd_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get object version from disk and check it. </p>
<p>This function checks object version from disk with <a class="el" href="structofd__thread__info.html#a3109a49543b3f1ad4425c66fcffb366f">ofd_thread_info::fti_pre_version</a> filled from incoming RPC. This is part of VBR (Version-Based Recovery) and ensures that object has the same version upon replay as it has during original modification.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>execution thread OFD private data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if version matches </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EOVERFLOW</em>&nbsp;</td><td>on version mismatch </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__objects_8c_source.html#l00063">63</a> of file <a class="el" href="ofd__objects_8c_source.html">ofd_objects.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00130">D_INODE</a>, <a class="el" href="dt__object_8c_source.html#l00553">dt_version_get()</a>, <a class="el" href="lustre__export_8h_source.html#l00240">obd_export::exp_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00245">obd_export::exp_vbr_failed</a>, <a class="el" href="ofd__internal_8h_source.html#l00292">ofd_thread_info::fti_env</a>, <a class="el" href="ofd__internal_8h_source.html#l00294">ofd_thread_info::fti_exp</a>, <a class="el" href="ofd__internal_8h_source.html#l00296">ofd_thread_info::fti_pre_version</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00491">ofd_attr_set()</a>, and <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:49 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
