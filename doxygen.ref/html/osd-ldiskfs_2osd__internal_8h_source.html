<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/osd-ldiskfs/osd_internal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/osd-ldiskfs/osd_internal.h</h1><a href="osd-ldiskfs_2osd__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * lustre/osd/osd_internal.h</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> * Shared definitions and declarations for osd module</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> * Author: Nikita Danilov &lt;nikita@clusterfs.com&gt;</span>
<a name="l00041"></a>00041 <span class="comment"> */</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">#ifndef _OSD_INTERNAL_H</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define _OSD_INTERNAL_H</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">/* struct mutex */</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;linux/mutex.h&gt;</span>
<a name="l00049"></a>00049 <span class="comment">/* struct rw_semaphore */</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;linux/rwsem.h&gt;</span>
<a name="l00051"></a>00051 <span class="comment">/* struct dentry */</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;linux/dcache.h&gt;</span>
<a name="l00053"></a>00053 <span class="comment">/* struct dirent64 */</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;linux/dirent.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;linux/statfs.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;ldiskfs/ldiskfs.h&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;ldiskfs/ldiskfs_jbd2.h&gt;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment">/* LUSTRE_OSD_NAME */</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;<a class="code" href="obd_8h.html">obd.h</a>&gt;</span>
<a name="l00061"></a>00061 <span class="comment">/* class_register_type(), class_unregister_type(), class_get_type() */</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;<a class="code" href="obd__class_8h.html">obd_class.h</a>&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="lustre__disk_8h.html">lustre_disk.h</a>&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;<a class="code" href="dt__object_8h.html">dt_object.h</a>&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;<a class="code" href="lustre__quota_8h.html">lustre_quota.h</a>&gt;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="osd__oi_8h.html">osd_oi.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="osd__iam_8h.html">osd_iam.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="osd__scrub_8h.html">osd_scrub.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="osd__quota__fmt_8h.html">osd_quota_fmt.h</a>&quot;</span>
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keyword">struct </span>inode;
<a name="l00073"></a>00073 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a910895d69a79a724854f18a2ca888b2e">dynlock_cachep</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a85115321842b7f568fdcb0ac5eaf6e31">00075</a> <span class="preprocessor">#define OSD_COUNTERS (0)</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <span class="comment">/* ldiskfs special inode::i_state_flags need to be accessed with</span>
<a name="l00078"></a>00078 <span class="comment"> * ldiskfs_{set,clear,test}_inode_state() only */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="comment">/* OI scrub should skip this inode. */</span>
<a name="l00081"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a5d17c0ddb5ab22a040d7e23a4f330a84">00081</a> <span class="preprocessor">#define LDISKFS_STATE_LUSTRE_NOSCRUB    31</span>
<a name="l00082"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad0c07119f87978d986d945932704c800">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define LDISKFS_STATE_LUSTRE_DESTROY    30</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aaf28c1246db8937aa4f3879cf0fcb355">00085</a> <span class="preprocessor">#define OSD_THANDLE_STATS (0)</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aceb2fa932dd2b7a587d7e0304363d201">00087</a> <span class="preprocessor">#define MAX_OBJID_GROUP (FID_SEQ_ECHO + 1)</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a4a067492d681fbbce4157face2f51c27">00089</a> <span class="preprocessor">#define OBJECTS         &quot;OBJECTS&quot;</span>
<a name="l00090"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ada08e2e64c741e0f5c5f38232dfe257d">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define ADMIN_USR       &quot;admin_quotafile_v2.usr&quot;</span>
<a name="l00091"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a7c97c337188756522a9216cd5f8de874">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define ADMIN_GRP       &quot;admin_quotafile_v2.grp&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 <span class="comment">/* Statfs space reservation for fragmentation and local objects */</span>
<a name="l00094"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a499a0dbd1a4f2235994256d552ad3137">00094</a> <span class="preprocessor">#define OSD_STATFS_RESERVED             (1ULL &lt;&lt; 23) </span><span class="comment">/* 8MB */</span>
<a name="l00095"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#acece91a7b14739b0951ac1d372c467c2">00095</a> <span class="preprocessor">#define OSD_STATFS_RESERVED_SHIFT       (7) </span><span class="comment">/* reserve 0.78% of all space */</span>
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="structosd__directory.html">00097</a> <span class="keyword">struct </span><a class="code" href="structosd__directory.html">osd_directory</a> {
<a name="l00098"></a><a class="code" href="structosd__directory.html#a2b8b9b26938bdd2e2f247ae44fc995ae">00098</a>         <span class="keyword">struct </span><a class="code" href="structiam__container.html">iam_container</a> <a class="code" href="structosd__directory.html#a2b8b9b26938bdd2e2f247ae44fc995ae">od_container</a>;
<a name="l00099"></a><a class="code" href="structosd__directory.html#ad03a0fdc38fd886713c3af5b67e562cc">00099</a>         <span class="keyword">struct </span><a class="code" href="structiam__descr.html">iam_descr</a>     <a class="code" href="structosd__directory.html#ad03a0fdc38fd886713c3af5b67e562cc">od_descr</a>;
<a name="l00100"></a>00100 };
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/*</span>
<a name="l00103"></a>00103 <span class="comment"> * Object Index (oi) instance.</span>
<a name="l00104"></a>00104 <span class="comment"> */</span>
<a name="l00105"></a><a class="code" href="structosd__oi.html">00105</a> <span class="keyword">struct </span><a class="code" href="structosd__oi.html">osd_oi</a> {
<a name="l00106"></a>00106         <span class="comment">/*</span>
<a name="l00107"></a>00107 <span class="comment">         * underlying index object, where fid-&gt;id mapping in stored.</span>
<a name="l00108"></a>00108 <span class="comment">         */</span>
<a name="l00109"></a><a class="code" href="structosd__oi.html#acd548429fecd4afd77fa6bd57a96d072">00109</a>         <span class="keyword">struct </span>inode         *<a class="code" href="structosd__oi.html#acd548429fecd4afd77fa6bd57a96d072">oi_inode</a>;
<a name="l00110"></a><a class="code" href="structosd__oi.html#a3fc52630d9c473830c945b04925d8c2e">00110</a>         <span class="keyword">struct </span><a class="code" href="structosd__directory.html">osd_directory</a>  <a class="code" href="structosd__oi.html#a3fc52630d9c473830c945b04925d8c2e">oi_dir</a>;
<a name="l00111"></a>00111 };
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a629dd8c8b646bfa837e2dfe966091175" title="Note: we do not count into QUOTA here.">osd_dto_credits_noquota</a>[];
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="structosd__object.html">00115</a> <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> {
<a name="l00116"></a><a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">00116</a>         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>        <a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>;
<a name="l00124"></a><a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12">00124</a>         <span class="keyword">struct </span>inode           *<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a>;
<a name="l00128"></a><a class="code" href="structosd__object.html#afc444003c6cfdb46eccb634274606301">00128</a>         <span class="keyword">struct </span>htree_lock_head *<a class="code" href="structosd__object.html#afc444003c6cfdb46eccb634274606301" title="to protect index ops.">oo_hl_head</a>;
<a name="l00129"></a><a class="code" href="structosd__object.html#ab4f2dd9c559664f3c835d4667a65f8b8">00129</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structosd__object.html#ab4f2dd9c559664f3c835d4667a65f8b8">oo_ext_idx_sem</a>;
<a name="l00130"></a><a class="code" href="structosd__object.html#a03a2365f2e63fefc094ae57a089c45fa">00130</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structosd__object.html#a03a2365f2e63fefc094ae57a089c45fa">oo_sem</a>;
<a name="l00131"></a><a class="code" href="structosd__object.html#a8efb02c469a31e5aa4523f6a82ca32ae">00131</a>         <span class="keyword">struct </span><a class="code" href="structosd__directory.html">osd_directory</a>    *<a class="code" href="structosd__object.html#a8efb02c469a31e5aa4523f6a82ca32ae">oo_dir</a>;
<a name="l00133"></a><a class="code" href="structosd__object.html#a0ae5bff884db9403b755de08f7482754">00133</a>         spinlock_t              <a class="code" href="structosd__object.html#a0ae5bff884db9403b755de08f7482754" title="protects inode attributes.">oo_guard</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="structosd__object.html#ae944579808f6846f17612eb34378abdf">00135</a>         __u32                   <a class="code" href="structosd__object.html#ae944579808f6846f17612eb34378abdf">oo_destroyed</a>:1;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137         <span class="comment">/* the i_flags in LMA */</span>
<a name="l00138"></a><a class="code" href="structosd__object.html#a1ee7929b30c29fd2c8f16e97154641a7">00138</a>         __u32                   <a class="code" href="structosd__object.html#a1ee7929b30c29fd2c8f16e97154641a7">oo_lma_flags</a>;
<a name="l00144"></a><a class="code" href="structosd__object.html#a26b2ea0f78f471d664ba28f67fc246a0">00144</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__object.html#a26b2ea0f78f471d664ba28f67fc246a0" title="Following two members are used to indicate the presence of dot and dotdot in the...">oo_compat_dot_created</a>;
<a name="l00145"></a><a class="code" href="structosd__object.html#a0711d436b55fc03a336b2eeb5057c7b4">00145</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__object.html#a0711d436b55fc03a336b2eeb5057c7b4">oo_compat_dotdot_created</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="structosd__object.html#a6caf9c07f98556e864a9350bb6dcf15d">00147</a>         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>    *<a class="code" href="structosd__object.html#a6caf9c07f98556e864a9350bb6dcf15d">oo_owner</a>;
<a name="l00148"></a>00148 <span class="preprocessor">#ifdef CONFIG_LOCKDEP</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>        <span class="keyword">struct </span>lockdep_map      oo_dep_map;
<a name="l00150"></a>00150 <span class="preprocessor">#endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>};
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="structosd__obj__seq.html">00153</a> <span class="keyword">struct </span><a class="code" href="structosd__obj__seq.html">osd_obj_seq</a> {
<a name="l00154"></a>00154         <span class="comment">/* protects on-fly initialization */</span>
<a name="l00155"></a><a class="code" href="structosd__obj__seq.html#a8ac198de1430e68de09114a2d994eff8">00155</a>         <span class="keywordtype">int</span>              <a class="code" href="structosd__obj__seq.html#a8ac198de1430e68de09114a2d994eff8">oos_subdir_count</a>; <span class="comment">/* subdir count for each seq */</span>
<a name="l00156"></a><a class="code" href="structosd__obj__seq.html#ae95109dffcd9b76cdef55e1400988c56">00156</a>         <span class="keyword">struct </span>dentry    *<a class="code" href="structosd__obj__seq.html#ae95109dffcd9b76cdef55e1400988c56">oos_root</a>;        <span class="comment">/* O/&lt;seq&gt; */</span>
<a name="l00157"></a><a class="code" href="structosd__obj__seq.html#a9098411295d6090bb4d4d0529016e29d">00157</a>         <span class="keyword">struct </span>dentry    **<a class="code" href="structosd__obj__seq.html#a9098411295d6090bb4d4d0529016e29d">oos_dirs</a>;       <span class="comment">/* O/&lt;seq&gt;/d0-dXX */</span>
<a name="l00158"></a><a class="code" href="structosd__obj__seq.html#a1fdba5290b4cc5ae5ee1c81df57297f9">00158</a>         u64              <a class="code" href="structosd__obj__seq.html#a1fdba5290b4cc5ae5ee1c81df57297f9">oos_seq</a>;          <span class="comment">/* seq number */</span>
<a name="l00159"></a><a class="code" href="structosd__obj__seq.html#a12c4315a20cf8d9e777301f488266fcf">00159</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__obj__seq.html#a12c4315a20cf8d9e777301f488266fcf">oos_seq_list</a>;     <span class="comment">/* list to seq_list */</span>
<a name="l00160"></a>00160 };
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="structosd__obj__map.html">00162</a> <span class="keyword">struct </span><a class="code" href="structosd__obj__map.html">osd_obj_map</a> {
<a name="l00163"></a><a class="code" href="structosd__obj__map.html#a30107be9e91e87b664bad42a72f69d31">00163</a>         <span class="keyword">struct </span>dentry    *<a class="code" href="structosd__obj__map.html#a30107be9e91e87b664bad42a72f69d31">om_root</a>;        <span class="comment">/* dentry for /O */</span>
<a name="l00164"></a><a class="code" href="structosd__obj__map.html#a80c54069ea47ae69870efa778c014712">00164</a>         rwlock_t         <a class="code" href="structosd__obj__map.html#a80c54069ea47ae69870efa778c014712">om_seq_list_lock</a>; <span class="comment">/* lock for seq_list */</span>
<a name="l00165"></a><a class="code" href="structosd__obj__map.html#a553ab6955019161ae3528672b3a5314e">00165</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__obj__map.html#a553ab6955019161ae3528672b3a5314e">om_seq_list</a>;      <span class="comment">/* list head for seq */</span>
<a name="l00166"></a><a class="code" href="structosd__obj__map.html#a93fb06f6db07f321181a4e87677c8b8f">00166</a>         <span class="keywordtype">int</span>              <a class="code" href="structosd__obj__map.html#a93fb06f6db07f321181a4e87677c8b8f">om_subdir_count</a>;
<a name="l00167"></a><a class="code" href="structosd__obj__map.html#a35ff7eadeba71797a6eb9f40e6e273f5">00167</a>         <span class="keyword">struct </span>mutex     <a class="code" href="structosd__obj__map.html#a35ff7eadeba71797a6eb9f40e6e273f5">om_dir_init_mutex</a>;
<a name="l00168"></a>00168 };
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="structosd__mdobj.html">00170</a> <span class="keyword">struct </span><a class="code" href="structosd__mdobj.html">osd_mdobj</a> {
<a name="l00171"></a><a class="code" href="structosd__mdobj.html#a0cb238137ca9feba334ea3f93130a8fa">00171</a>         <span class="keyword">struct </span>dentry   *<a class="code" href="structosd__mdobj.html#a0cb238137ca9feba334ea3f93130a8fa">om_root</a>;      <span class="comment">/* AGENT/&lt;index&gt; */</span>
<a name="l00172"></a><a class="code" href="structosd__mdobj.html#a2256e3d44e8f0425289009c46d3a6946">00172</a>         u64              <a class="code" href="structosd__mdobj.html#a2256e3d44e8f0425289009c46d3a6946">om_index</a>;     <span class="comment">/* mdt index */</span>
<a name="l00173"></a><a class="code" href="structosd__mdobj.html#a0ce8bd8ed219cc76d6aa86f1c88c4d41">00173</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__mdobj.html#a0ce8bd8ed219cc76d6aa86f1c88c4d41">om_list</a>;      <span class="comment">/* list to omm_list */</span>
<a name="l00174"></a>00174 };
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="structosd__mdobj__map.html">00176</a> <span class="keyword">struct </span><a class="code" href="structosd__mdobj__map.html">osd_mdobj_map</a> {
<a name="l00177"></a><a class="code" href="structosd__mdobj__map.html#a38cffdba0625ee59514be49f0d7a5af3">00177</a>         <span class="keyword">struct </span>dentry   *<a class="code" href="structosd__mdobj__map.html#a38cffdba0625ee59514be49f0d7a5af3">omm_remote_parent</a>;
<a name="l00178"></a>00178 };
<a name="l00179"></a>00179 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#afa5d40e10d49cbfad614e5a3b663da1d">osd_ldiskfs_add_entry</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info,
<a name="l00180"></a>00180                           handle_t *handle, <span class="keyword">struct</span> dentry *child,
<a name="l00181"></a>00181                           <span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> htree_lock *hlock);
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1eda63b1f8228c085c9116a0c8a7aef5">00183</a> <span class="preprocessor">#define OSD_OTABLE_IT_CACHE_SIZE        64</span>
<a name="l00184"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a763928740f25e5e89102dd07b107886a">00184</a> <span class="preprocessor"></span><span class="preprocessor">#define OSD_OTABLE_IT_CACHE_MASK        (~(OSD_OTABLE_IT_CACHE_SIZE - 1))</span>
<a name="l00185"></a>00185 <span class="preprocessor"></span>
<a name="l00186"></a><a class="code" href="structosd__inconsistent__item.html">00186</a> <span class="keyword">struct </span><a class="code" href="structosd__inconsistent__item.html">osd_inconsistent_item</a> {
<a name="l00187"></a>00187         <span class="comment">/* link into osd_scrub::os_inconsistent_items,</span>
<a name="l00188"></a>00188 <span class="comment">         * protected by osd_scrub::os_lock. */</span>
<a name="l00189"></a><a class="code" href="structosd__inconsistent__item.html#adaa47f67b811c00ed0137837bad3596d">00189</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       <a class="code" href="structosd__inconsistent__item.html#adaa47f67b811c00ed0137837bad3596d">oii_list</a>;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191         <span class="comment">/* The right FID &lt;=&gt; ino#/gen mapping. */</span>
<a name="l00192"></a><a class="code" href="structosd__inconsistent__item.html#a4105c6c1d845ebe57c89f9f6c49f1043">00192</a>         <span class="keyword">struct </span><a class="code" href="structosd__idmap__cache.html">osd_idmap_cache</a> <a class="code" href="structosd__inconsistent__item.html#a4105c6c1d845ebe57c89f9f6c49f1043">oii_cache</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a><a class="code" href="structosd__inconsistent__item.html#ae0908735b85fa764f032dba809bc5583">00194</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>           <a class="code" href="structosd__inconsistent__item.html#ae0908735b85fa764f032dba809bc5583">oii_insert</a>:1; <span class="comment">/* insert or update mapping. */</span>
<a name="l00195"></a>00195 };
<a name="l00196"></a>00196 
<a name="l00197"></a><a class="code" href="structosd__otable__cache.html">00197</a> <span class="keyword">struct </span><a class="code" href="structosd__otable__cache.html">osd_otable_cache</a> {
<a name="l00198"></a><a class="code" href="structosd__otable__cache.html#ad62e4109da197fba4a6424e4f8bb273b">00198</a>         <span class="keyword">struct </span><a class="code" href="structosd__idmap__cache.html">osd_idmap_cache</a> <a class="code" href="structosd__otable__cache.html#ad62e4109da197fba4a6424e4f8bb273b">ooc_cache</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1eda63b1f8228c085c9116a0c8a7aef5">OSD_OTABLE_IT_CACHE_SIZE</a>];
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <span class="comment">/* Index for next cache slot to be filled. */</span>
<a name="l00201"></a><a class="code" href="structosd__otable__cache.html#a8111afbee0e458a94923bce575117315">00201</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__otable__cache.html#a8111afbee0e458a94923bce575117315">ooc_producer_idx</a>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         <span class="comment">/* Index for next cache slot to be returned by it::next(). */</span>
<a name="l00204"></a><a class="code" href="structosd__otable__cache.html#a1797c134c4ef249c2e35f40dd2fde4b5">00204</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__otable__cache.html#a1797c134c4ef249c2e35f40dd2fde4b5">ooc_consumer_idx</a>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="comment">/* How many items in ooc_cache. */</span>
<a name="l00207"></a><a class="code" href="structosd__otable__cache.html#a26952febba895fb2c0812e74880223b3">00207</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__otable__cache.html#a26952febba895fb2c0812e74880223b3">ooc_cached_items</a>;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="comment">/* Position for up layer LFSCK iteration pre-loading. */</span>
<a name="l00210"></a><a class="code" href="structosd__otable__cache.html#a350785bbf7e0e85a11f16e89acefa815">00210</a>         __u32                  <a class="code" href="structosd__otable__cache.html#a350785bbf7e0e85a11f16e89acefa815">ooc_pos_preload</a>;
<a name="l00211"></a>00211 };
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="structosd__otable__it.html">00213</a> <span class="keyword">struct </span><a class="code" href="structosd__otable__it.html">osd_otable_it</a> {
<a name="l00214"></a><a class="code" href="structosd__otable__it.html#a1e0f282242c11f9bf0116dd3fca04015">00214</a>         <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a>       *<a class="code" href="structosd__otable__it.html#a1e0f282242c11f9bf0116dd3fca04015">ooi_dev</a>;
<a name="l00215"></a><a class="code" href="structosd__otable__it.html#a627945ef1185b4aa80255be37837d356">00215</a>         <span class="keyword">struct </span><a class="code" href="structosd__otable__cache.html">osd_otable_cache</a>  <a class="code" href="structosd__otable__it.html#a627945ef1185b4aa80255be37837d356">ooi_cache</a>;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         <span class="comment">/* The following bits can be updated/checked w/o lock protection.</span>
<a name="l00218"></a>00218 <span class="comment">         * If more bits will be introduced in the future and need lock to</span>
<a name="l00219"></a>00219 <span class="comment">         * protect, please add comment. */</span>
<a name="l00220"></a><a class="code" href="structosd__otable__it.html#ac23e799c1f157e8a51bb28ca35509c80">00220</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>            <a class="code" href="structosd__otable__it.html#a7f345f86e6054df02379d9ba43981982">ooi_used_outside</a>:1, <span class="comment">/* Some user out of OSD</span>
<a name="l00221"></a>00221 <span class="comment">                                                      * uses the iteration. */</span>
<a name="l00222"></a>00222                                  <a class="code" href="structosd__otable__it.html#a6a3f7e6346e906a4729d944d9633221b">ooi_all_cached</a>:1, <span class="comment">/* No more entries can be</span>
<a name="l00223"></a>00223 <span class="comment">                                                    * filled into cache. */</span>
<a name="l00224"></a>00224                                  <a class="code" href="structosd__otable__it.html#a3c8b3cadb4b0b2013e3ebcd3115bf635">ooi_user_ready</a>:1, <span class="comment">/* The user out of OSD is</span>
<a name="l00225"></a>00225 <span class="comment">                                                    * ready to iterate. */</span>
<a name="l00226"></a>00226                                  <a class="code" href="structosd__otable__it.html#ac23e799c1f157e8a51bb28ca35509c80">ooi_waiting</a>:1; <span class="comment">/* it::next is waiting. */</span>
<a name="l00227"></a>00227 };
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="structosd__obj__orphan.html">00229</a> <span class="keyword">struct </span><a class="code" href="structosd__obj__orphan.html">osd_obj_orphan</a> {
<a name="l00230"></a><a class="code" href="structosd__obj__orphan.html#ad331a5b8827714cfb55da869f1b54b7a">00230</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structosd__obj__orphan.html#ad331a5b8827714cfb55da869f1b54b7a">oor_list</a>;
<a name="l00231"></a><a class="code" href="structosd__obj__orphan.html#a2503e1489c75f7307509fb6eda889e9d">00231</a>         <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>   *<a class="code" href="structosd__obj__orphan.html#a2503e1489c75f7307509fb6eda889e9d">oor_env</a>; <span class="comment">/* to identify &quot;own&quot; records */</span>
<a name="l00232"></a><a class="code" href="structosd__obj__orphan.html#ace8475595ea661883142eed4931691df">00232</a>         __u32 <a class="code" href="structosd__obj__orphan.html#ace8475595ea661883142eed4931691df">oor_ino</a>;
<a name="l00233"></a>00233 };
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="comment">/*</span>
<a name="l00236"></a>00236 <span class="comment"> * osd device.</span>
<a name="l00237"></a>00237 <span class="comment"> */</span>
<a name="l00238"></a><a class="code" href="structosd__device.html">00238</a> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> {
<a name="l00239"></a>00239         <span class="comment">/* super-class */</span>
<a name="l00240"></a><a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">00240</a>         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>          <a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>;
<a name="l00241"></a>00241         <span class="comment">/* information about underlying file system */</span>
<a name="l00242"></a><a class="code" href="structosd__device.html#a7fdc7d18e6fbb3904a2e1e2e92e5bf18">00242</a>         <span class="keyword">struct </span>vfsmount          *<a class="code" href="structosd__device.html#a7fdc7d18e6fbb3904a2e1e2e92e5bf18">od_mnt</a>;
<a name="l00243"></a>00243         <span class="comment">/* object index */</span>
<a name="l00244"></a><a class="code" href="structosd__device.html#aa39936b9319f2e21867a2fd0034ca2dd">00244</a>         <span class="keyword">struct </span><a class="code" href="structosd__oi.html">osd_oi</a>           **<a class="code" href="structosd__device.html#aa39936b9319f2e21867a2fd0034ca2dd">od_oi_table</a>;
<a name="l00245"></a>00245         <span class="comment">/* total number of OI containers */</span>
<a name="l00246"></a><a class="code" href="structosd__device.html#a6c567bcf80744a85daba595066670b2e">00246</a>         <span class="keywordtype">int</span>                       <a class="code" href="structosd__device.html#a6c567bcf80744a85daba595066670b2e">od_oi_count</a>;
<a name="l00247"></a>00247         <span class="comment">/*</span>
<a name="l00248"></a>00248 <span class="comment">         * Fid Capability</span>
<a name="l00249"></a>00249 <span class="comment">         */</span>
<a name="l00250"></a><a class="code" href="structosd__device.html#a975e72dd4752415a5c8925a091ee7b56">00250</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structosd__device.html#ab0748d5af0ce1a6d6ab026124e3c6bf5">od_fl_capa</a>:1,
<a name="l00251"></a>00251                                   <a class="code" href="structosd__device.html#a28da75fcb0d2f72e8f046869eac2b593">od_maybe_new</a>:1,
<a name="l00252"></a>00252                                   <a class="code" href="structosd__device.html#a975e72dd4752415a5c8925a091ee7b56">od_noscrub</a>:1,
<a name="l00253"></a>00253                                   <a class="code" href="structosd__device.html#a309e8211420494c9c118179879f0dc2b">od_igif_inoi</a>:1,
<a name="l00254"></a>00254                                   <a class="code" href="structosd__device.html#ac6d7ce55533a4f42c5e0d45b9fd61527">od_check_ff</a>:1,
<a name="l00255"></a>00255                                   <a class="code" href="structosd__device.html#a39f379723f147ae261cc103ee74abedc">od_is_ost</a>:1,
<a name="l00256"></a>00256                                   <a class="code" href="structosd__device.html#afb17dec540392716cf877728e2b0372d">od_index_in_idif</a>:1;
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="structosd__device.html#a45e202f288e4f136765332af41e13884">00258</a>         __u32                     <a class="code" href="structosd__device.html#a45e202f288e4f136765332af41e13884">od_dirent_journal</a>;
<a name="l00259"></a><a class="code" href="structosd__device.html#aca3f409df8f59b788044e5758659d3e7">00259</a>         <span class="keywordtype">int</span>                       <a class="code" href="structosd__device.html#aca3f409df8f59b788044e5758659d3e7">od_index</a>;
<a name="l00260"></a><a class="code" href="structosd__device.html#add4a17480cd98cbf2d49abdd087ec597">00260</a>         <span class="keyword">struct </span>proc_dir_entry    *<a class="code" href="structosd__device.html#add4a17480cd98cbf2d49abdd087ec597">od_proc_entry</a>;
<a name="l00261"></a><a class="code" href="structosd__device.html#a8c01ebae19da43b96fa75f4df27bb7a1">00261</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>     *<a class="code" href="structosd__device.html#a8c01ebae19da43b96fa75f4df27bb7a1">od_stats</a>;
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="structosd__device.html#a5124007e5f2cfc996c98421ce0d3a600">00263</a>         spinlock_t                <a class="code" href="structosd__device.html#a5124007e5f2cfc996c98421ce0d3a600">od_osfs_lock</a>;
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="structosd__device.html#a0617b10caa8348d428787e6aea37c52b">00265</a>         <span class="keywordtype">int</span>                       <a class="code" href="structosd__device.html#a0617b10caa8348d428787e6aea37c52b">od_connects</a>;
<a name="l00266"></a><a class="code" href="structosd__device.html#a6ffdfa10dcb19272d176c9a0af96ade4">00266</a>         <span class="keyword">struct </span><a class="code" href="structlu__site.html" title="lu_site is a &amp;quot;compartment&amp;quot; within which objects are unique, and LRU discipline...">lu_site</a>            <a class="code" href="structosd__device.html#a6ffdfa10dcb19272d176c9a0af96ade4">od_site</a>;
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="structosd__device.html#a283104e5be9ebad08929b515cf334ef2">00268</a>         <span class="keyword">struct </span><a class="code" href="structosd__obj__map.html">osd_obj_map</a>      *<a class="code" href="structosd__device.html#a283104e5be9ebad08929b515cf334ef2">od_ost_map</a>;
<a name="l00269"></a><a class="code" href="structosd__device.html#a93c16c85d933b26e60ddd6e4691110fd">00269</a>         <span class="keyword">struct </span><a class="code" href="structosd__mdobj__map.html">osd_mdobj_map</a>    *<a class="code" href="structosd__device.html#a93c16c85d933b26e60ddd6e4691110fd">od_mdt_map</a>;
<a name="l00270"></a>00270 
<a name="l00271"></a><a class="code" href="structosd__device.html#ac3bda7467379bea01f97cd209bf2e4ac">00271</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>      <a class="code" href="structosd__device.html#ac3bda7467379bea01f97cd209bf2e4ac">od_readcache_max_filesize</a>;
<a name="l00272"></a><a class="code" href="structosd__device.html#a618493dff044a91d1ce7534ef7ddcd28">00272</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__device.html#a618493dff044a91d1ce7534ef7ddcd28">od_read_cache</a>;
<a name="l00273"></a><a class="code" href="structosd__device.html#af90c3007b41a0331fc003a768484c35e">00273</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__device.html#af90c3007b41a0331fc003a768484c35e">od_writethrough_cache</a>;
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="structosd__device.html#ad2dd891460c9c53c4bdef00d46c91ab8">00275</a>         <span class="keyword">struct </span><a class="code" href="structbrw__stats.html">brw_stats</a>        <a class="code" href="structosd__device.html#ad2dd891460c9c53c4bdef00d46c91ab8">od_brw_stats</a>;
<a name="l00276"></a><a class="code" href="structosd__device.html#ac38bcff65f55df360529d778d83c43ed">00276</a>         atomic_t                <a class="code" href="structosd__device.html#ac38bcff65f55df360529d778d83c43ed">od_r_in_flight</a>;
<a name="l00277"></a><a class="code" href="structosd__device.html#ae45520e9a93ad0079b9a2f415a7cdf8f">00277</a>         atomic_t                <a class="code" href="structosd__device.html#ae45520e9a93ad0079b9a2f415a7cdf8f">od_w_in_flight</a>;
<a name="l00278"></a>00278 
<a name="l00279"></a><a class="code" href="structosd__device.html#a850e352529e42dd73f6a0dab28acbe83">00279</a>         <span class="keyword">struct </span>mutex              <a class="code" href="structosd__device.html#a850e352529e42dd73f6a0dab28acbe83">od_otable_mutex</a>;
<a name="l00280"></a><a class="code" href="structosd__device.html#a60f45786f61f7d4317d0f2436bf58d5c">00280</a>         <span class="keyword">struct </span><a class="code" href="structosd__otable__it.html">osd_otable_it</a>     *<a class="code" href="structosd__device.html#a60f45786f61f7d4317d0f2436bf58d5c">od_otable_it</a>;
<a name="l00281"></a><a class="code" href="structosd__device.html#a4b41b71220ddd6ceb1082d64d87e2752">00281</a>         <span class="keyword">struct </span><a class="code" href="structosd__scrub.html">osd_scrub</a>          <a class="code" href="structosd__device.html#a4b41b71220ddd6ceb1082d64d87e2752">od_scrub</a>;
<a name="l00282"></a><a class="code" href="structosd__device.html#a04502d4602ce1639b3175aa9e54b3d0b">00282</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                  <a class="code" href="structosd__device.html#a04502d4602ce1639b3175aa9e54b3d0b">od_ios_list</a>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="comment">/* service name associated with the osd device */</span>
<a name="l00285"></a><a class="code" href="structosd__device.html#a1caa2232343f3ee6b75de8fe6fd2cd85">00285</a>         <span class="keywordtype">char</span>                      <a class="code" href="structosd__device.html#a1caa2232343f3ee6b75de8fe6fd2cd85">od_svname</a>[<a class="code" href="group__lustreuser.html#ga2cfdb7b2e5cc0eb8ff2ec1ea952f2b3e">MAX_OBD_NAME</a>];
<a name="l00286"></a><a class="code" href="structosd__device.html#aa3f8fb7471ee895b56517b78b0225424">00286</a>         <span class="keywordtype">char</span>                      <a class="code" href="structosd__device.html#aa3f8fb7471ee895b56517b78b0225424">od_mntdev</a>[<a class="code" href="group__lustreuser.html#ga2cfdb7b2e5cc0eb8ff2ec1ea952f2b3e">MAX_OBD_NAME</a>];
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <span class="comment">/* quota slave instance */</span>
<a name="l00289"></a><a class="code" href="structosd__device.html#a5d68a9e1ddc05312b23ff082ea673e1c">00289</a>         <span class="keyword">struct </span><a class="code" href="structqsd__instance.html">qsd_instance</a>      *<a class="code" href="structosd__device.html#a5d68a9e1ddc05312b23ff082ea673e1c">od_quota_slave</a>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="comment">/* osd seq instance */</span>
<a name="l00292"></a><a class="code" href="structosd__device.html#a099ccb84759d21affce24b2a2327d747">00292</a>         <span class="keyword">struct </span><a class="code" href="structlu__client__seq.html">lu_client_seq</a>    *<a class="code" href="structosd__device.html#a099ccb84759d21affce24b2a2327d747">od_cl_seq</a>;
<a name="l00293"></a>00293         <span class="comment">/* If the ratio of &quot;the total OI mappings count&quot; vs</span>
<a name="l00294"></a>00294 <span class="comment">         * &quot;the bad OI mappings count&quot; is lower than the</span>
<a name="l00295"></a>00295 <span class="comment">         * osd_device::od_full_scrub_ratio, then trigger</span>
<a name="l00296"></a>00296 <span class="comment">         * OI scrub to scan the whole the device. */</span>
<a name="l00297"></a><a class="code" href="structosd__device.html#a6501ba8bb942894ca6471e5501fac9f2">00297</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structosd__device.html#a6501ba8bb942894ca6471e5501fac9f2">od_full_scrub_ratio</a>;
<a name="l00298"></a>00298         <span class="comment">/* If the speed of found bad OI mappings (per minute)</span>
<a name="l00299"></a>00299 <span class="comment">         * exceeds the osd_device::od_full_scrub_threshold_rate,</span>
<a name="l00300"></a>00300 <span class="comment">         * then trigger OI scrub to scan the whole device. */</span>
<a name="l00301"></a><a class="code" href="structosd__device.html#a16f8082a38bd5b50ad40f6d15b353a29">00301</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structosd__device.html#a16f8082a38bd5b50ad40f6d15b353a29">od_full_scrub_threshold_rate</a>;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">/* a list of orphaned agent inodes, protected with od_osfs_lock */</span>
<a name="l00304"></a><a class="code" href="structosd__device.html#af64a20926d3f8000d6cd14f1fbb16723">00304</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__device.html#af64a20926d3f8000d6cd14f1fbb16723">od_orphan_list</a>;
<a name="l00305"></a>00305 };
<a name="l00306"></a>00306 
<a name="l00307"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96e">00307</a> <span class="keyword">enum</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96e">osd_full_scrub_ratio</a> {
<a name="l00308"></a>00308         <span class="comment">/* Trigger OI scrub to scan the whole device directly. */</span>
<a name="l00309"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96ea7d40310580263b89e4df1a57029bf4eb">00309</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96ea7d40310580263b89e4df1a57029bf4eb">OFSR_DIRECTLY</a>   = 0,
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="comment">/* Because the bad OI mappings count cannot be larger than</span>
<a name="l00312"></a>00312 <span class="comment">         * the total OI mappints count, then setting OFSR_NEVER means</span>
<a name="l00313"></a>00313 <span class="comment">         * that the whole device scanning cannot be triggered by auto</span>
<a name="l00314"></a>00314 <span class="comment">         * detected bad OI mappings during the RPC services. */</span>
<a name="l00315"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96ea8b460382021720b641f532f15ccefbc8">00315</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96ea8b460382021720b641f532f15ccefbc8">OFSR_NEVER</a>      = 1,
<a name="l00316"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96eae99d212edc09d58bd43d558c4c2c0551">00316</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6f959cc44a6c598386e5cff2e731b96eae99d212edc09d58bd43d558c4c2c0551">OFSR_DEFAULT</a>    = 10000,
<a name="l00317"></a>00317 };
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae517283a288f2db8bc51309b7afcf5a6">00319</a> <span class="preprocessor">#define FULL_SCRUB_THRESHOLD_RATE_DEFAULT       60</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>
<a name="l00321"></a>00321 <span class="comment">/* There are at most 10 uid/gids are affected in a transaction, and</span>
<a name="l00322"></a>00322 <span class="comment"> * that&apos;s rename case:</span>
<a name="l00323"></a>00323 <span class="comment"> * - 2 for source parent uid &amp; gid;</span>
<a name="l00324"></a>00324 <span class="comment"> * - 2 for source child uid &amp; gid (&apos;..&apos; entry update when child is directory);</span>
<a name="l00325"></a>00325 <span class="comment"> * - 2 for target parent uid &amp; gid;</span>
<a name="l00326"></a>00326 <span class="comment"> * - 2 for target child uid &amp; gid (if the target child exists);</span>
<a name="l00327"></a>00327 <span class="comment"> * - 2 for root uid &amp; gid (last_rcvd, llog, etc);</span>
<a name="l00328"></a>00328 <span class="comment"> *</span>
<a name="l00329"></a>00329 <span class="comment"> * The 0 to (OSD_MAX_UGID_CNT - 1) bits of ot_id_type is for indicating</span>
<a name="l00330"></a>00330 <span class="comment"> * the id type of each id in the ot_id_array.</span>
<a name="l00331"></a>00331 <span class="comment"> */</span>
<a name="l00332"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad8489cdfd62cb54929a8dfecf0bf0020">00332</a> <span class="preprocessor">#define OSD_MAX_UGID_CNT        10</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>
<a name="l00334"></a>00334 <span class="keyword">enum</span> {
<a name="l00335"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a908b8933a78a081f6a24e38fae1fa3e0">00335</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a908b8933a78a081f6a24e38fae1fa3e0">OSD_OT_ATTR_SET</a>         = 0,
<a name="l00336"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a11e5d2e7e9fe426650dd01d5431569ce">00336</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a11e5d2e7e9fe426650dd01d5431569ce">OSD_OT_PUNCH</a>            = 1,
<a name="l00337"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a3ee8fdd91d4f9e5d2a7595fe7887dacc">00337</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a3ee8fdd91d4f9e5d2a7595fe7887dacc">OSD_OT_XATTR_SET</a>        = 2,
<a name="l00338"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a66c6623fcfc0f3a4601c8d5dbed82237">00338</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a66c6623fcfc0f3a4601c8d5dbed82237">OSD_OT_CREATE</a>           = 3,
<a name="l00339"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a392ce8bd8bc4c73740b22b58b3ae1522">00339</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a392ce8bd8bc4c73740b22b58b3ae1522">OSD_OT_DESTROY</a>          = 4,
<a name="l00340"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923aed9239d90aabac5da1719a85ba45d37c">00340</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923aed9239d90aabac5da1719a85ba45d37c">OSD_OT_REF_ADD</a>          = 5,
<a name="l00341"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a12e80d4cf137ab2fce567816f4aabf5a">00341</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a12e80d4cf137ab2fce567816f4aabf5a">OSD_OT_REF_DEL</a>          = 6,
<a name="l00342"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923adc3f672fba98283c594a33fe2654415b">00342</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923adc3f672fba98283c594a33fe2654415b">OSD_OT_WRITE</a>            = 7,
<a name="l00343"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923ad3fadd60e2eda9db562fd6bd8af79e8a">00343</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923ad3fadd60e2eda9db562fd6bd8af79e8a">OSD_OT_INSERT</a>           = 8,
<a name="l00344"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923aef8ecf839c7f518df1aa6e02ef2410a5">00344</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923aef8ecf839c7f518df1aa6e02ef2410a5">OSD_OT_DELETE</a>           = 9,
<a name="l00345"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4ac072a258416c36f1569962ac6e1025">00345</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4ac072a258416c36f1569962ac6e1025">OSD_OT_QUOTA</a>            = 10,
<a name="l00346"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">00346</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>              = 11
<a name="l00347"></a>00347 };
<a name="l00348"></a>00348 
<a name="l00349"></a><a class="code" href="structosd__thandle.html">00349</a> <span class="keyword">struct </span><a class="code" href="structosd__thandle.html">osd_thandle</a> {
<a name="l00350"></a><a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">00350</a>         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>          <a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>;
<a name="l00351"></a><a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">00351</a>         handle_t               *<a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">ot_handle</a>;
<a name="l00352"></a><a class="code" href="structosd__thandle.html#a21c344a2d536303534d2001f1fbe4d89">00352</a>         <span class="keyword">struct </span>ldiskfs_journal_cb_entry <a class="code" href="structosd__thandle.html#a21c344a2d536303534d2001f1fbe4d89">ot_jcb</a>;
<a name="l00353"></a><a class="code" href="structosd__thandle.html#ad266717a027a3ad66fa9ac4a583f872d">00353</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       <a class="code" href="structosd__thandle.html#ad266717a027a3ad66fa9ac4a583f872d">ot_commit_dcb_list</a>;
<a name="l00354"></a><a class="code" href="structosd__thandle.html#af4812c91367ca69db02db7f9d94ed313">00354</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       <a class="code" href="structosd__thandle.html#af4812c91367ca69db02db7f9d94ed313">ot_stop_dcb_list</a>;
<a name="l00355"></a>00355         <span class="comment">/* Link to the device, for debugging. */</span>
<a name="l00356"></a><a class="code" href="structosd__thandle.html#ae4c8dbaba5b841b48ff3a5a6cfc38c2f">00356</a>         <span class="keyword">struct </span><a class="code" href="structlu__ref__link.html">lu_ref_link</a>      <a class="code" href="structosd__thandle.html#ae4c8dbaba5b841b48ff3a5a6cfc38c2f">ot_dev_link</a>;
<a name="l00357"></a><a class="code" href="structosd__thandle.html#a4ba41c23d9f16cd4d6c8c4858bf2e344">00357</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thandle.html#a4ba41c23d9f16cd4d6c8c4858bf2e344">ot_credits</a>;
<a name="l00358"></a><a class="code" href="structosd__thandle.html#a69b48920d34e05cd4b4251135b7444a9">00358</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thandle.html#a69b48920d34e05cd4b4251135b7444a9">ot_id_cnt</a>;
<a name="l00359"></a><a class="code" href="structosd__thandle.html#a3b1c933d5888f2235f8bb5639067ac4f">00359</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thandle.html#a3b1c933d5888f2235f8bb5639067ac4f">ot_id_type</a>;
<a name="l00360"></a><a class="code" href="structosd__thandle.html#a5f44d05e2856189e3e52e34742c22bc2">00360</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__thandle.html#a5f44d05e2856189e3e52e34742c22bc2">ot_remove_agents</a>:1;
<a name="l00361"></a><a class="code" href="structosd__thandle.html#a31ad092dcf80445290744842dc029e6b">00361</a>         uid_t                   <a class="code" href="structosd__thandle.html#a31ad092dcf80445290744842dc029e6b">ot_id_array</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad8489cdfd62cb54929a8dfecf0bf0020">OSD_MAX_UGID_CNT</a>];
<a name="l00362"></a><a class="code" href="structosd__thandle.html#a2edabe000b7642f34ce5cfbd72afcd0c">00362</a>         <span class="keyword">struct </span><a class="code" href="structlquota__trans.html">lquota_trans</a>    *<a class="code" href="structosd__thandle.html#a2edabe000b7642f34ce5cfbd72afcd0c">ot_quota_trans</a>;
<a name="l00363"></a>00363 <span class="preprocessor">#if OSD_THANDLE_STATS</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>
<a name="l00365"></a>00365         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a> oth_alloced;
<a name="l00366"></a>00366 
<a name="l00368"></a>00368         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a> oth_started;
<a name="l00369"></a>00369 <span class="preprocessor">#endif</span>
<a name="l00370"></a>00370 <span class="preprocessor"></span>};
<a name="l00371"></a>00371 
<a name="l00375"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008">00375</a> <span class="keyword">enum</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008" title="Basic transaction credit op.">dt_txn_op</a> {
<a name="l00376"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a0db6e2f1bdefe61b343806127ae82084">00376</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a0db6e2f1bdefe61b343806127ae82084">DTO_INDEX_INSERT</a>,
<a name="l00377"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a55044b37b8813ad08e1957f41f09c372">00377</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a55044b37b8813ad08e1957f41f09c372">DTO_INDEX_DELETE</a>,
<a name="l00378"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a3dc7795edc123d7e46310cbf530a41f6">00378</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a3dc7795edc123d7e46310cbf530a41f6">DTO_INDEX_UPDATE</a>,
<a name="l00379"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a812c47bad7436bf0c6d876f3471bb742">00379</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a812c47bad7436bf0c6d876f3471bb742">DTO_OBJECT_CREATE</a>,
<a name="l00380"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ab059c779ee80e45c48a0e09b7343e555">00380</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ab059c779ee80e45c48a0e09b7343e555">DTO_OBJECT_DELETE</a>,
<a name="l00381"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008af64d01789c934b9f96b4fbdf834142fb">00381</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008af64d01789c934b9f96b4fbdf834142fb">DTO_ATTR_SET_BASE</a>,
<a name="l00382"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008acc50ac2f75e6d8feba6445a6946b836e">00382</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008acc50ac2f75e6d8feba6445a6946b836e">DTO_XATTR_SET</a>,
<a name="l00383"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ae505809a719c04852b45483a9783489f">00383</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ae505809a719c04852b45483a9783489f">DTO_WRITE_BASE</a>,
<a name="l00384"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008afae5fcb72cc33f95739cd3ee2fb2bc76">00384</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008afae5fcb72cc33f95739cd3ee2fb2bc76">DTO_WRITE_BLOCK</a>,
<a name="l00385"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a6cf7d624ce0587faee45f79fab0a71a8">00385</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008a6cf7d624ce0587faee45f79fab0a71a8">DTO_ATTR_SET_CHOWN</a>,
<a name="l00386"></a>00386 
<a name="l00387"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ade65d81aa59aa8a57b98d268930df29c">00387</a>         <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a19784b8c9b52fdf1fd273225161d8008ade65d81aa59aa8a57b98d268930df29c">DTO_NR</a>
<a name="l00388"></a>00388 };
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">/*</span>
<a name="l00391"></a>00391 <span class="comment"> * osd dev stats</span>
<a name="l00392"></a>00392 <span class="comment"> */</span>
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span><span class="keyword">enum</span> {
<a name="l00396"></a>00396         LPROC_OSD_READ_BYTES    = 0,
<a name="l00397"></a>00397         LPROC_OSD_WRITE_BYTES   = 1,
<a name="l00398"></a>00398         LPROC_OSD_GET_PAGE      = 2,
<a name="l00399"></a>00399         LPROC_OSD_NO_PAGE       = 3,
<a name="l00400"></a>00400         LPROC_OSD_CACHE_ACCESS  = 4,
<a name="l00401"></a>00401         LPROC_OSD_CACHE_HIT     = 5,
<a name="l00402"></a>00402         LPROC_OSD_CACHE_MISS    = 6,
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="preprocessor">#if OSD_THANDLE_STATS</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>        LPROC_OSD_THANDLE_STARTING,
<a name="l00406"></a>00406         LPROC_OSD_THANDLE_OPEN,
<a name="l00407"></a>00407         LPROC_OSD_THANDLE_CLOSING,
<a name="l00408"></a>00408 <span class="preprocessor">#endif</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span>        LPROC_OSD_LAST,
<a name="l00410"></a>00410 };
<a name="l00411"></a>00411 <span class="preprocessor">#endif</span>
<a name="l00412"></a>00412 <span class="preprocessor"></span>
<a name="l00418"></a><a class="code" href="structosd__fid__pack.html">00418</a> <span class="keyword">struct </span><a class="code" href="structosd__fid__pack.html" title="Storage representation for fids.">osd_fid_pack</a> {
<a name="l00419"></a><a class="code" href="structosd__fid__pack.html#ab19a6b521348a91926cdb0ee27e624d9">00419</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structosd__fid__pack.html#ab19a6b521348a91926cdb0ee27e624d9">fp_len</a>;
<a name="l00420"></a><a class="code" href="structosd__fid__pack.html#a63df25eaf91fc78e92242edf99965abe">00420</a>         <span class="keywordtype">char</span> <a class="code" href="structosd__fid__pack.html#a63df25eaf91fc78e92242edf99965abe">fp_area</a>[<span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>)];
<a name="l00421"></a>00421 };
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="structosd__it__ea__dirent.html">00423</a> <span class="keyword">struct </span><a class="code" href="structosd__it__ea__dirent.html">osd_it_ea_dirent</a> {
<a name="l00424"></a><a class="code" href="structosd__it__ea__dirent.html#ab1b86650ae0910ab0054f814632e9897">00424</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>   <a class="code" href="structosd__it__ea__dirent.html#ab1b86650ae0910ab0054f814632e9897">oied_fid</a>;
<a name="l00425"></a><a class="code" href="structosd__it__ea__dirent.html#a3381c6c48a001fc52df4caae4c0fd93a">00425</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>           <a class="code" href="structosd__it__ea__dirent.html#a3381c6c48a001fc52df4caae4c0fd93a">oied_ino</a>;
<a name="l00426"></a><a class="code" href="structosd__it__ea__dirent.html#ae08d5af1f5c47a1ca81197011853343f">00426</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>           <a class="code" href="structosd__it__ea__dirent.html#ae08d5af1f5c47a1ca81197011853343f">oied_off</a>;
<a name="l00427"></a><a class="code" href="structosd__it__ea__dirent.html#a2621f315cecc849cb4c72f8c8c697a7d">00427</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>  <a class="code" href="structosd__it__ea__dirent.html#a2621f315cecc849cb4c72f8c8c697a7d">oied_namelen</a>;
<a name="l00428"></a><a class="code" href="structosd__it__ea__dirent.html#af31a65eb7c388bbb38712d4deb828011">00428</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="structosd__it__ea__dirent.html#af31a65eb7c388bbb38712d4deb828011">oied_type</a>;
<a name="l00429"></a><a class="code" href="structosd__it__ea__dirent.html#ae9fff913f38f8184523990d728114912">00429</a>         <span class="keywordtype">char</span>            <a class="code" href="structosd__it__ea__dirent.html#ae9fff913f38f8184523990d728114912">oied_name</a>[0];
<a name="l00430"></a>00430 } <a class="code" href="fid_8mod_8c.html#a804f230e6220e338767d15b94fc5801d">__attribute__</a>((<a class="code" href="group__lustreidl.html#ga30372a269f5fc08f064b7e94437589bb" title="Identifier for a single log object.">packed</a>));
<a name="l00431"></a>00431 
<a name="l00439"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af48a4406a08eae32b505e8d1b2fb54a1">00439</a> <span class="preprocessor">#define OSD_IT_EA_BUFSIZE       (PAGE_CACHE_SIZE + PAGE_CACHE_SIZE/4)</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>
<a name="l00445"></a><a class="code" href="structosd__it__ea.html">00445</a> <span class="keyword">struct </span><a class="code" href="structosd__it__ea.html" title="This is iterator&amp;#39;s in-memory data structure in interoperability mode (i.e.">osd_it_ea</a> {
<a name="l00446"></a><a class="code" href="structosd__it__ea.html#a57327a0bc12b725d8f214da5c3c54034">00446</a>         <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a>       *<a class="code" href="structosd__it__ea.html#a57327a0bc12b725d8f214da5c3c54034">oie_obj</a>;
<a name="l00448"></a><a class="code" href="structosd__it__ea.html#a0b8c9bcde5e0f3725305514527d6375b">00448</a>         <span class="keyword">struct </span>file             <a class="code" href="structosd__it__ea.html#a0b8c9bcde5e0f3725305514527d6375b" title="used in ldiskfs iterator, to stored file pointer">oie_file</a>;
<a name="l00450"></a><a class="code" href="structosd__it__ea.html#a4c4286fffd0f6b35e03ae3056b4842d3">00450</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__it__ea.html#a4c4286fffd0f6b35e03ae3056b4842d3" title="how many entries have been read-cached from storage">oie_rd_dirent</a>;
<a name="l00452"></a><a class="code" href="structosd__it__ea.html#ae8f93bbd3ac4d32360962785a8020f44">00452</a>         <span class="keywordtype">int</span>                     <a class="code" href="structosd__it__ea.html#ae8f93bbd3ac4d32360962785a8020f44" title="current entry is being iterated by caller">oie_it_dirent</a>;
<a name="l00454"></a><a class="code" href="structosd__it__ea.html#a9abf464815dd90e055a34485c483a4c5">00454</a>         <span class="keyword">struct </span><a class="code" href="structosd__it__ea__dirent.html">osd_it_ea_dirent</a> *<a class="code" href="structosd__it__ea.html#a9abf464815dd90e055a34485c483a4c5" title="current processing entry">oie_dirent</a>;
<a name="l00456"></a><a class="code" href="structosd__it__ea.html#a2786f970c07aa4943477dd1afc2a039d">00456</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structosd__it__ea.html#a2786f970c07aa4943477dd1afc2a039d" title="buffer to hold entries, size == OSD_IT_EA_BUFSIZE">oie_buf</a>;
<a name="l00457"></a><a class="code" href="structosd__it__ea.html#a33239dde53279c88bca5fdfa63ea43b9">00457</a>         <span class="keyword">struct </span>dentry           <a class="code" href="structosd__it__ea.html#a33239dde53279c88bca5fdfa63ea43b9">oie_dentry</a>;
<a name="l00458"></a>00458 };
<a name="l00459"></a>00459 
<a name="l00463"></a><a class="code" href="structosd__it__iam.html">00463</a> <span class="keyword">struct </span><a class="code" href="structosd__it__iam.html" title="Iterator&amp;#39;s in-memory data structure for IAM mode.">osd_it_iam</a> {
<a name="l00464"></a><a class="code" href="structosd__it__iam.html#a33f58818e0836caf0d5826f17ca31c4c">00464</a>         <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a>     *<a class="code" href="structosd__it__iam.html#a33f58818e0836caf0d5826f17ca31c4c">oi_obj</a>;
<a name="l00465"></a><a class="code" href="structosd__it__iam.html#a0706069c599fc19d7cc0f3e350627e2a">00465</a>         <span class="keyword">struct </span><a class="code" href="structiam__path__descr.html">iam_path_descr</a> *<a class="code" href="structosd__it__iam.html#a0706069c599fc19d7cc0f3e350627e2a">oi_ipd</a>;
<a name="l00466"></a><a class="code" href="structosd__it__iam.html#a5d7b8e69240d05a34ba6fce4bdf816ce">00466</a>         <span class="keyword">struct </span><a class="code" href="structiam__iterator.html">iam_iterator</a>    <a class="code" href="structosd__it__iam.html#a5d7b8e69240d05a34ba6fce4bdf816ce">oi_it</a>;
<a name="l00467"></a>00467 };
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="structosd__quota__leaf.html">00469</a> <span class="keyword">struct </span><a class="code" href="structosd__quota__leaf.html">osd_quota_leaf</a> {
<a name="l00470"></a><a class="code" href="structosd__quota__leaf.html#ab11e3b55f2d2e82578f8c293829c4d38">00470</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structosd__quota__leaf.html#ab11e3b55f2d2e82578f8c293829c4d38">oql_link</a>;
<a name="l00471"></a><a class="code" href="structosd__quota__leaf.html#a391a373f019ef586ba0eca39da300bf0">00471</a>         uint            <a class="code" href="structosd__quota__leaf.html#a391a373f019ef586ba0eca39da300bf0">oql_blk</a>;
<a name="l00472"></a>00472 };
<a name="l00473"></a>00473 
<a name="l00477"></a><a class="code" href="structosd__it__quota.html">00477</a> <span class="keyword">struct </span><a class="code" href="structosd__it__quota.html" title="Iterator&amp;#39;s in-memory data structure for quota file.">osd_it_quota</a> {
<a name="l00478"></a><a class="code" href="structosd__it__quota.html#a03dfe8bf4398c18b74122b708549c63a">00478</a>         <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a>       *<a class="code" href="structosd__it__quota.html#a03dfe8bf4398c18b74122b708549c63a">oiq_obj</a>;
<a name="l00480"></a><a class="code" href="structosd__it__quota.html#a475bf0b9aff5da9b5205184717fda235">00480</a>         uint                     <a class="code" href="structosd__it__quota.html#a475bf0b9aff5da9b5205184717fda235" title="tree blocks path to where the entry is stored">oiq_blk</a>[<a class="code" href="osd__quota__fmt_8h.html#a4ecac244ed221d2870e6c349848cd778">LUSTRE_DQTREEDEPTH</a> + 1];
<a name="l00482"></a><a class="code" href="structosd__it__quota.html#ad7d4709533063f9e2fb9528b72cb203d">00482</a>         loff_t                   <a class="code" href="structosd__it__quota.html#ad7d4709533063f9e2fb9528b72cb203d" title="on-disk offset for current key where quota record can be found">oiq_offset</a>;
<a name="l00484"></a><a class="code" href="structosd__it__quota.html#a9d8b986954c568d9b521b4bd9b7aff88">00484</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structosd__it__quota.html#a9d8b986954c568d9b521b4bd9b7aff88" title="identifier for current quota record">oiq_id</a>;
<a name="l00486"></a><a class="code" href="structosd__it__quota.html#a7c95f84a37a9542ed148be4e6ead35e3">00486</a>         uint                     <a class="code" href="structosd__it__quota.html#a7c95f84a37a9542ed148be4e6ead35e3" title="the record index in the leaf/index block">oiq_index</a>[<a class="code" href="osd__quota__fmt_8h.html#a4ecac244ed221d2870e6c349848cd778">LUSTRE_DQTREEDEPTH</a> + 1];
<a name="l00488"></a><a class="code" href="structosd__it__quota.html#afecd67eb2d70bbb449d25ca565ffe94c">00488</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structosd__it__quota.html#afecd67eb2d70bbb449d25ca565ffe94c" title="list of already processed leaf blocks">oiq_list</a>;
<a name="l00489"></a>00489 };
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a5c919ce0cc2614e4881b441c55727ac4">00491</a> <span class="preprocessor">#define MAX_BLOCKS_PER_PAGE (PAGE_CACHE_SIZE / 512)</span>
<a name="l00492"></a>00492 <span class="preprocessor"></span>
<a name="l00493"></a><a class="code" href="structosd__iobuf.html">00493</a> <span class="keyword">struct </span><a class="code" href="structosd__iobuf.html">osd_iobuf</a> {
<a name="l00494"></a><a class="code" href="structosd__iobuf.html#a3357b97c26400afe04cfe5bc0497c318">00494</a>         wait_queue_head_t  <a class="code" href="structosd__iobuf.html#a3357b97c26400afe04cfe5bc0497c318">dr_wait</a>;
<a name="l00495"></a><a class="code" href="structosd__iobuf.html#aeac0ed91d8f8ab5a17e31a2e80eba2ab">00495</a>         atomic_t       <a class="code" href="structosd__iobuf.html#aeac0ed91d8f8ab5a17e31a2e80eba2ab">dr_numreqs</a>;  <span class="comment">/* number of reqs being processed */</span>
<a name="l00496"></a><a class="code" href="structosd__iobuf.html#af28530ea305f3ec9365de89104975d18">00496</a>         <span class="keywordtype">int</span>                <a class="code" href="structosd__iobuf.html#af28530ea305f3ec9365de89104975d18">dr_max_pages</a>;
<a name="l00497"></a><a class="code" href="structosd__iobuf.html#a53bcc7b19f54a6b1146356db789e8018">00497</a>         <span class="keywordtype">int</span>                <a class="code" href="structosd__iobuf.html#a53bcc7b19f54a6b1146356db789e8018">dr_npages</a>;
<a name="l00498"></a><a class="code" href="structosd__iobuf.html#afe52a8584047b7797b179ebf60105ddd">00498</a>         <span class="keywordtype">int</span>                <a class="code" href="structosd__iobuf.html#afe52a8584047b7797b179ebf60105ddd">dr_error</a>;
<a name="l00499"></a><a class="code" href="structosd__iobuf.html#aade2e2a84d33917a81934aa535057dd6">00499</a>         <span class="keywordtype">int</span>                <a class="code" href="structosd__iobuf.html#aade2e2a84d33917a81934aa535057dd6">dr_frags</a>;
<a name="l00500"></a><a class="code" href="structosd__iobuf.html#af8d2f1c8cdda35da0957588818772b30">00500</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="structosd__iobuf.html#af8d2f1c8cdda35da0957588818772b30">dr_ignore_quota</a>:1;
<a name="l00501"></a><a class="code" href="structosd__iobuf.html#a30cb26c46e58ba7eb3ccf3108744a5dc">00501</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="structosd__iobuf.html#a30cb26c46e58ba7eb3ccf3108744a5dc">dr_elapsed_valid</a>:1; <span class="comment">/* we really did count time */</span>
<a name="l00502"></a><a class="code" href="structosd__iobuf.html#a1805d229e6ef59a0e1ae1a4c563b3771">00502</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="structosd__iobuf.html#a1805d229e6ef59a0e1ae1a4c563b3771">dr_rw</a>:1;
<a name="l00503"></a><a class="code" href="structosd__iobuf.html#af454df69c09fe0d76ad79372080a6fdf">00503</a>         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>      <a class="code" href="structosd__iobuf.html#af454df69c09fe0d76ad79372080a6fdf">dr_pg_buf</a>;
<a name="l00504"></a><a class="code" href="structosd__iobuf.html#a2464d55c1e56cc0f7f886beee16d318a">00504</a>         <span class="keyword">struct </span>page      **<a class="code" href="structosd__iobuf.html#a2464d55c1e56cc0f7f886beee16d318a">dr_pages</a>;
<a name="l00505"></a><a class="code" href="structosd__iobuf.html#aee1c6dde8f1a24a0f763f4124e818143">00505</a>         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>      <a class="code" href="structosd__iobuf.html#aee1c6dde8f1a24a0f763f4124e818143">dr_bl_buf</a>;
<a name="l00506"></a><a class="code" href="structosd__iobuf.html#a529aba4e50bbb3d328bd65459d2e75db">00506</a>         sector_t          *<a class="code" href="structosd__iobuf.html#a529aba4e50bbb3d328bd65459d2e75db">dr_blocks</a>;
<a name="l00507"></a><a class="code" href="structosd__iobuf.html#a7757e0deee4ae075e5c4683f2e65eacc">00507</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>      <a class="code" href="structosd__iobuf.html#a7757e0deee4ae075e5c4683f2e65eacc">dr_start_time</a>;
<a name="l00508"></a><a class="code" href="structosd__iobuf.html#a5446ebf455eb7967e59696e9d6990de6">00508</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>      <a class="code" href="structosd__iobuf.html#a5446ebf455eb7967e59696e9d6990de6">dr_elapsed</a>;  <span class="comment">/* how long io took */</span>
<a name="l00509"></a><a class="code" href="structosd__iobuf.html#af6cac0eb3668e10b1711ce770d033d30">00509</a>         <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="structosd__iobuf.html#af6cac0eb3668e10b1711ce770d033d30">dr_dev</a>;
<a name="l00510"></a><a class="code" href="structosd__iobuf.html#a8a4d3b2fcd6b87c571851e8106603b50">00510</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="structosd__iobuf.html#a8a4d3b2fcd6b87c571851e8106603b50">dr_init_at</a>;  <span class="comment">/* the line iobuf was initialized */</span>
<a name="l00511"></a>00511 };
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa8281072a74b6d8d3aa025083b32842a">00513</a> <span class="preprocessor">#define OSD_INS_CACHE_SIZE      8</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span>
<a name="l00515"></a><a class="code" href="structosd__thread__info.html">00515</a> <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> {
<a name="l00516"></a><a class="code" href="structosd__thread__info.html#a015305f2c9156fab8180de74a6186b82">00516</a>         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>   *<a class="code" href="structosd__thread__info.html#a015305f2c9156fab8180de74a6186b82">oti_env</a>;
<a name="l00520"></a><a class="code" href="structosd__thread__info.html#ab13060bad7d6407028bc061f3e0fd5f5">00520</a>         <span class="keyword">struct </span>dentry          <a class="code" href="structosd__thread__info.html#ab13060bad7d6407028bc061f3e0fd5f5" title="used for index operations.">oti_obj_dentry</a>;
<a name="l00521"></a><a class="code" href="structosd__thread__info.html#a71ab43b003b76ed471c0ed2085021889">00521</a>         <span class="keyword">struct </span>dentry          <a class="code" href="structosd__thread__info.html#a71ab43b003b76ed471c0ed2085021889">oti_child_dentry</a>;
<a name="l00522"></a>00522 
<a name="l00524"></a><a class="code" href="structosd__thread__info.html#a9c6f48bd95e460187c5605c13c8e6079">00524</a>         <span class="keyword">struct </span>dentry           <a class="code" href="structosd__thread__info.html#a9c6f48bd95e460187c5605c13c8e6079" title="dentry for Iterator context.">oti_it_dentry</a>;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="keyword">union </span>{
<a name="l00527"></a>00527                 <span class="comment">/* fake struct file for osd_object_sync */</span>
<a name="l00528"></a><a class="code" href="structosd__thread__info.html#ad310592b2e2d29c8667552692309fb11">00528</a>                 <span class="keyword">struct </span>file             <a class="code" href="structosd__thread__info.html#ad310592b2e2d29c8667552692309fb11">oti_file</a>;
<a name="l00529"></a>00529                 <span class="comment">/* osd_statfs() */</span>
<a name="l00530"></a><a class="code" href="structosd__thread__info.html#aecd4b0dc9caa5a77c849b78363d3ae90">00530</a>                 <span class="keyword">struct </span>kstatfs          <a class="code" href="structosd__thread__info.html#aecd4b0dc9caa5a77c849b78363d3ae90">oti_ksfs</a>;
<a name="l00531"></a>00531         };
<a name="l00532"></a>00532 
<a name="l00533"></a><a class="code" href="structosd__thread__info.html#a695f6006255628e94f0ff678ef08c18f">00533</a>         <span class="keyword">struct </span>htree_lock     *<a class="code" href="structosd__thread__info.html#a695f6006255628e94f0ff678ef08c18f">oti_hlock</a>;
<a name="l00534"></a>00534 
<a name="l00535"></a><a class="code" href="structosd__thread__info.html#abfc6a3c09f887f5fbc00970db4be18f7">00535</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>          <a class="code" href="structosd__thread__info.html#abfc6a3c09f887f5fbc00970db4be18f7">oti_fid</a>;
<a name="l00536"></a><a class="code" href="structosd__thread__info.html#a1f4830a8e6f24344f363b3090ca7ed07">00536</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>          <a class="code" href="structosd__thread__info.html#a1f4830a8e6f24344f363b3090ca7ed07">oti_fid2</a>;
<a name="l00537"></a><a class="code" href="structosd__thread__info.html#a44641feac3b243486a2ca9a35c10140e">00537</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>          <a class="code" href="structosd__thread__info.html#a44641feac3b243486a2ca9a35c10140e">oti_fid3</a>;
<a name="l00538"></a><a class="code" href="structosd__thread__info.html#a62af914efe5265209bdf502fbf004ad6">00538</a>         <span class="keyword">struct </span><a class="code" href="structosd__inode__id.html">osd_inode_id</a>    <a class="code" href="structosd__thread__info.html#a62af914efe5265209bdf502fbf004ad6">oti_id</a>;
<a name="l00539"></a><a class="code" href="structosd__thread__info.html#a7750089e812b27404c2bb8c0525504ff">00539</a>         <span class="keyword">struct </span><a class="code" href="structosd__inode__id.html">osd_inode_id</a>    <a class="code" href="structosd__thread__info.html#a7750089e812b27404c2bb8c0525504ff">oti_id2</a>;
<a name="l00540"></a><a class="code" href="structosd__thread__info.html#a176f3243faae886b4ab900508e0a0cea">00540</a>         <span class="keyword">struct </span><a class="code" href="structosd__inode__id.html">osd_inode_id</a>    <a class="code" href="structosd__thread__info.html#a176f3243faae886b4ab900508e0a0cea">oti_id3</a>;
<a name="l00541"></a><a class="code" href="structosd__thread__info.html#a99dfe6a513c639c173a54d0975186c9a">00541</a>         <span class="keyword">struct </span><a class="code" href="structost__id.html" title="OST object IDentifier.">ost_id</a>          <a class="code" href="structosd__thread__info.html#a99dfe6a513c639c173a54d0975186c9a">oti_ostid</a>;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         <span class="comment">/*</span>
<a name="l00544"></a>00544 <span class="comment">         * XXX temporary: for -&gt;i_op calls.</span>
<a name="l00545"></a>00545 <span class="comment">         */</span>
<a name="l00546"></a><a class="code" href="structosd__thread__info.html#a0a66ffaebc963a0f98a6203060ca9704">00546</a>         <span class="keyword">struct </span>timespec        <a class="code" href="structosd__thread__info.html#a0a66ffaebc963a0f98a6203060ca9704">oti_time</a>;
<a name="l00547"></a>00547 
<a name="l00550"></a><a class="code" href="structosd__thread__info.html#aaf0963ea0d67a0b8b25b6868b2ba8bd4">00550</a>         <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a>     *<a class="code" href="structosd__thread__info.html#aaf0963ea0d67a0b8b25b6868b2ba8bd4" title="osd_device reference, initialized in osd_trans_start() and used in osd_trans_stop()...">oti_dev</a>;
<a name="l00551"></a>00551 
<a name="l00559"></a><a class="code" href="structosd__thread__info.html#a65059bb9aa0ef327e2f8fd6e5f9bbe78">00559</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structosd__thread__info.html#a65059bb9aa0ef327e2f8fd6e5f9bbe78" title="following ipd and it structures are used for osd_index_iam_lookup() these are defined...">oti_it_ea_buf</a>;
<a name="l00560"></a><a class="code" href="structosd__thread__info.html#a3ca21192e0c4bd41f74a5b02b6f4ef97">00560</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structosd__thread__info.html#a3ca21192e0c4bd41f74a5b02b6f4ef97">oti_it_ea_buf_used</a>:1;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562         <span class="comment">/* IAM iterator for index operation. */</span>
<a name="l00563"></a><a class="code" href="structosd__thread__info.html#a28158f8987f40fe730e494070894f632">00563</a>         <span class="keyword">struct </span><a class="code" href="structiam__iterator.html">iam_iterator</a>    <a class="code" href="structosd__thread__info.html#a28158f8987f40fe730e494070894f632">oti_idx_it</a>;
<a name="l00564"></a>00564 
<a name="l00566"></a>00566         <span class="keyword">union </span>{
<a name="l00567"></a><a class="code" href="structosd__thread__info.html#ae7c1805c2300ba9ced37464e726c84f9">00567</a>                 <span class="keywordtype">char</span>           <a class="code" href="structosd__thread__info.html#ae7c1805c2300ba9ced37464e726c84f9">oti_name</a>[48];
<a name="l00568"></a><a class="code" href="structosd__thread__info.html#a0b41068218a273ea5a717d6d2c714b3f">00568</a>                 <span class="keywordtype">char</span>           <a class="code" href="structosd__thread__info.html#a0b41068218a273ea5a717d6d2c714b3f">oti_it_ipd</a>[<a class="code" href="osd__iam_8h.html#aad1afd468cb4339144d0997ddcf04748a343ff01b1acf4e08a68e00dc99e2c714">DX_IPD_MAX_SIZE</a>];
<a name="l00569"></a><a class="code" href="structosd__thread__info.html#a389171a34b99094753f5b673058dcdbe">00569</a>                 <span class="keywordtype">long</span> <span class="keywordtype">long</span>      <a class="code" href="structosd__thread__info.html#a389171a34b99094753f5b673058dcdbe">oti_alignment_lieutenant</a>;
<a name="l00570"></a>00570         };
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="keyword">union </span>{
<a name="l00573"></a><a class="code" href="structosd__thread__info.html#a091f159e297d3ae47ab5e45925189264">00573</a>                 <span class="keywordtype">char</span>           <a class="code" href="structosd__thread__info.html#a091f159e297d3ae47ab5e45925189264">oti_idx_ipd</a>[<a class="code" href="osd__iam_8h.html#aad1afd468cb4339144d0997ddcf04748a343ff01b1acf4e08a68e00dc99e2c714">DX_IPD_MAX_SIZE</a>];
<a name="l00574"></a><a class="code" href="structosd__thread__info.html#acd8be1fe5646e655a8d9b8d0df5502f0">00574</a>                 <span class="keywordtype">long</span> <span class="keywordtype">long</span>      <a class="code" href="structosd__thread__info.html#acd8be1fe5646e655a8d9b8d0df5502f0">oti_alignment_lieutenant_colonel</a>;
<a name="l00575"></a>00575         };
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="structosd__thread__info.html#aec55082ce189c48b1b7e06f20e3b4160">00577</a>         <span class="keyword">struct </span><a class="code" href="structosd__idmap__cache.html">osd_idmap_cache</a> <a class="code" href="structosd__thread__info.html#aec55082ce189c48b1b7e06f20e3b4160">oti_cache</a>;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         <span class="comment">/* dedicated OI cache for insert (which needs inum) */</span>
<a name="l00580"></a><a class="code" href="structosd__thread__info.html#a3a34805c1273d70f1ae24fb4777dd584">00580</a>         <span class="keyword">struct </span><a class="code" href="structosd__idmap__cache.html">osd_idmap_cache</a> *<a class="code" href="structosd__thread__info.html#a3a34805c1273d70f1ae24fb4777dd584">oti_ins_cache</a>;
<a name="l00581"></a><a class="code" href="structosd__thread__info.html#a239023c31d09527863e3d397ee101fc6">00581</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__thread__info.html#a239023c31d09527863e3d397ee101fc6">oti_ins_cache_size</a>;
<a name="l00582"></a><a class="code" href="structosd__thread__info.html#a0ea8938f4d9560e53661f8c54ac8a6a7">00582</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__thread__info.html#a0ea8938f4d9560e53661f8c54ac8a6a7">oti_ins_cache_used</a>;
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="structosd__thread__info.html#ad9106d0dca1ac641de410559053b78d8">00584</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__thread__info.html#ad9106d0dca1ac641de410559053b78d8">oti_r_locks</a>;
<a name="l00585"></a><a class="code" href="structosd__thread__info.html#a7e4ce027bb8a56db30a103f1a49fd9d4">00585</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__thread__info.html#a7e4ce027bb8a56db30a103f1a49fd9d4">oti_w_locks</a>;
<a name="l00586"></a><a class="code" href="structosd__thread__info.html#aab06059a4ef1905e07370ae7161be0a5">00586</a>         <span class="keywordtype">int</span>                    <a class="code" href="structosd__thread__info.html#aab06059a4ef1905e07370ae7161be0a5">oti_txns</a>;
<a name="l00588"></a><a class="code" href="structosd__thread__info.html#a7dc33f62235078a8128d3bdb51574886">00588</a>         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>          <a class="code" href="structosd__thread__info.html#a7dc33f62235078a8128d3bdb51574886" title="used in osd_fid_set() to put xattr">oti_buf</a>;
<a name="l00589"></a><a class="code" href="structosd__thread__info.html#a902a55203f6ffc719b68dbf3fbad7556">00589</a>         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>          <a class="code" href="structosd__thread__info.html#a902a55203f6ffc719b68dbf3fbad7556">oti_big_buf</a>;
<a name="l00591"></a>00591         <span class="keyword">union </span>{
<a name="l00592"></a><a class="code" href="structosd__thread__info.html#ac7587c5d6c3b43bdfc4364118cef1f6f">00592</a>                 <span class="keyword">struct </span><a class="code" href="structlustre__mdt__attrs.html" title="Following struct for object attributes, that will be kept inode&amp;#39;s EA.">lustre_mdt_attrs</a> <a class="code" href="structosd__thread__info.html#ac7587c5d6c3b43bdfc4364118cef1f6f">oti_mdt_attrs</a>;
<a name="l00593"></a>00593                 <span class="comment">/* old LMA for compatibility */</span>
<a name="l00594"></a><a class="code" href="structosd__thread__info.html#a088580f08d6f48ca290d8d4c18229c3d">00594</a>                 <span class="keywordtype">char</span>                    <a class="code" href="structosd__thread__info.html#a088580f08d6f48ca290d8d4c18229c3d">oti_mdt_attrs_old</a>[<a class="code" href="group__lustreuser.html#gaae2dd0d15d4ca9d9d9c3980978ba03df" title="Prior to 2.4, the LMA structure also included SOM attributes which has since been...">LMA_OLD_SIZE</a>];
<a name="l00595"></a><a class="code" href="structosd__thread__info.html#ae5a74f812c97f1d4da5d0da2361abcae">00595</a>                 <span class="keyword">struct </span><a class="code" href="structfilter__fid__old.html">filter_fid_old</a>   <a class="code" href="structosd__thread__info.html#ae5a74f812c97f1d4da5d0da2361abcae">oti_ff</a>;
<a name="l00596"></a><a class="code" href="structosd__thread__info.html#ab243dc087d0bd2fdc6d809ef0080f257">00596</a>                 <span class="keyword">struct </span><a class="code" href="structfilter__fid.html">filter_fid</a>       <a class="code" href="structosd__thread__info.html#ab243dc087d0bd2fdc6d809ef0080f257">oti_ff_new</a>;
<a name="l00597"></a>00597         };
<a name="l00599"></a><a class="code" href="structosd__thread__info.html#aa06c07d2752199ad935f6e1f25856171">00599</a>         <span class="keyword">struct </span><a class="code" href="structosd__iobuf.html">osd_iobuf</a>       <a class="code" href="structosd__thread__info.html#aa06c07d2752199ad935f6e1f25856171" title="0-copy IO">oti_iobuf</a>;
<a name="l00600"></a>00600         <span class="comment">/* used to access objects in /O */</span>
<a name="l00601"></a><a class="code" href="structosd__thread__info.html#a24367f7b882a244238ef534c09204e6c">00601</a>         <span class="keyword">struct </span>inode          *<a class="code" href="structosd__thread__info.html#a24367f7b882a244238ef534c09204e6c">oti_inode</a>;
<a name="l00602"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aac389e75b6158f10cc60e6822a00c411">00602</a> <span class="preprocessor">#define OSD_FID_REC_SZ 32</span>
<a name="l00603"></a><a class="code" href="structosd__thread__info.html#ae4bc1a12f82d4f447417bf54c8a6bc81">00603</a> <span class="preprocessor"></span>        <span class="keywordtype">char</span>                   <a class="code" href="structosd__thread__info.html#ae4bc1a12f82d4f447417bf54c8a6bc81">oti_ldp</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aac389e75b6158f10cc60e6822a00c411">OSD_FID_REC_SZ</a>];
<a name="l00604"></a><a class="code" href="structosd__thread__info.html#aae0d4d8b2906a38014f404cf3cd1fd6d">00604</a>         <span class="keywordtype">char</span>                   <a class="code" href="structosd__thread__info.html#aae0d4d8b2906a38014f404cf3cd1fd6d">oti_ldp2</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aac389e75b6158f10cc60e6822a00c411">OSD_FID_REC_SZ</a>];
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <span class="comment">/* used by quota code */</span>
<a name="l00607"></a>00607         <span class="keyword">union </span>{
<a name="l00608"></a>00608 <span class="preprocessor">#ifdef HAVE_DQUOT_FS_DISK_QUOTA</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>                <span class="keyword">struct </span>fs_disk_quota    oti_fdq;
<a name="l00610"></a>00610 <span class="preprocessor">#else</span>
<a name="l00611"></a><a class="code" href="structosd__thread__info.html#a3bfcb507eadfcec5e2f290cf39d55ab0">00611</a> <span class="preprocessor"></span>                <span class="keyword">struct </span>if_dqblk         <a class="code" href="structosd__thread__info.html#a3bfcb507eadfcec5e2f290cf39d55ab0">oti_dqblk</a>;
<a name="l00612"></a>00612 <span class="preprocessor">#endif</span>
<a name="l00613"></a><a class="code" href="structosd__thread__info.html#afa2a0e9f714263e48df615a99cb876e8">00613</a> <span class="preprocessor"></span>                <span class="keyword">struct </span>if_dqinfo        <a class="code" href="structosd__thread__info.html#afa2a0e9f714263e48df615a99cb876e8">oti_dqinfo</a>;
<a name="l00614"></a>00614         };
<a name="l00615"></a><a class="code" href="structosd__thread__info.html#a982b377ce573f4de64ebf78fffd50d99">00615</a>         <span class="keyword">struct </span><a class="code" href="structlquota__id__info.html">lquota_id_info</a>   <a class="code" href="structosd__thread__info.html#a982b377ce573f4de64ebf78fffd50d99">oti_qi</a>;
<a name="l00616"></a><a class="code" href="structosd__thread__info.html#af3e84110323e4fa4bba6e2928dd62cc6">00616</a>         <span class="keyword">struct </span><a class="code" href="structlquota__trans.html">lquota_trans</a>     <a class="code" href="structosd__thread__info.html#af3e84110323e4fa4bba6e2928dd62cc6">oti_quota_trans</a>;
<a name="l00617"></a><a class="code" href="structosd__thread__info.html#a0bafae78114936db312c2a739af512e0">00617</a>         <span class="keyword">union </span><a class="code" href="unionlquota__rec.html">lquota_rec</a>        <a class="code" href="structosd__thread__info.html#a0bafae78114936db312c2a739af512e0">oti_quota_rec</a>;
<a name="l00618"></a><a class="code" href="structosd__thread__info.html#a4ade588422a39dd9246e86cb7822c948">00618</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structosd__thread__info.html#a4ade588422a39dd9246e86cb7822c948">oti_quota_id</a>;
<a name="l00619"></a><a class="code" href="structosd__thread__info.html#a40d5f0bfe3c8026b77b307caaadaf2bc">00619</a>         <span class="keyword">struct </span><a class="code" href="structlu__seq__range.html" title="Describes a range of sequence, lsr_start is included but lsr_end is not in the range...">lu_seq_range</a>     <a class="code" href="structosd__thread__info.html#a40d5f0bfe3c8026b77b307caaadaf2bc">oti_seq_range</a>;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         <span class="comment">/* Tracking for transaction credits, to allow debugging and optimizing</span>
<a name="l00622"></a>00622 <span class="comment">         * cases where a large number of credits are being allocated for</span>
<a name="l00623"></a>00623 <span class="comment">         * single transaction. */</span>
<a name="l00624"></a><a class="code" href="structosd__thread__info.html#af14d6385ee4e8e31c4126a0f3367eac5">00624</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structosd__thread__info.html#af14d6385ee4e8e31c4126a0f3367eac5">oti_credits_before</a>;
<a name="l00625"></a><a class="code" href="structosd__thread__info.html#acdd7f1b58cad4d72a41c6307179b93b0">00625</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thread__info.html#acdd7f1b58cad4d72a41c6307179b93b0">oti_declare_ops</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>];
<a name="l00626"></a><a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">00626</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>];
<a name="l00627"></a><a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">00627</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>          <a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>];
<a name="l00628"></a>00628 };
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3215c9997e34962b3f09a573dfd8ea39">ldiskfs_pdo</a>;
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af7f2a70b40c8f4550a4b7c6818f03bf7">00632</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af7f2a70b40c8f4550a4b7c6818f03bf7">__osd_xattr_get</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> dentry *dentry,
<a name="l00633"></a>00633                                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> len)
<a name="l00634"></a>00634 {
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (inode == NULL)
<a name="l00636"></a>00636                 <span class="keywordflow">return</span> -EINVAL;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638         dentry-&gt;d_inode = inode;
<a name="l00639"></a>00639         dentry-&gt;d_sb = inode-&gt;i_sb;
<a name="l00640"></a>00640         <span class="keywordflow">return</span> inode-&gt;i_op-&gt;getxattr(dentry, name, buf, len);
<a name="l00641"></a>00641 }
<a name="l00642"></a>00642 
<a name="l00643"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a008f7ba9f00c88fd312e17d1ee4a8d49">00643</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a008f7ba9f00c88fd312e17d1ee4a8d49">__osd_xattr_set</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info,
<a name="l00644"></a>00644                                   <span class="keyword">struct</span> inode *inode, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l00645"></a>00645                                   <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> buflen, <span class="keywordtype">int</span> fl)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647         <span class="keyword">struct </span>dentry *dentry = &amp;info-&gt;<a class="code" href="structosd__thread__info.html#a71ab43b003b76ed471c0ed2085021889">oti_child_dentry</a>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <a class="code" href="lustre__compat_8h.html#a4da823ed535b3ed492253333f13f912d">ll_vfs_dq_init</a>(inode);
<a name="l00650"></a>00650         dentry-&gt;d_inode = inode;
<a name="l00651"></a>00651         dentry-&gt;d_sb = inode-&gt;i_sb;
<a name="l00652"></a>00652         <span class="keywordflow">return</span> inode-&gt;i_op-&gt;setxattr(dentry, name, buf, buflen, fl);
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span><span class="comment">/* osd_lproc.c */</span>
<a name="l00657"></a>00657 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a> lprocfs_osd_obd_vars[];
<a name="l00658"></a>00658 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a> lprocfs_osd_module_vars[];
<a name="l00659"></a>00659 <span class="keywordtype">int</span> osd_procfs_init(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00660"></a>00660 <span class="keywordtype">int</span> osd_procfs_fini(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd);
<a name="l00661"></a>00661 <span class="keywordtype">void</span> osd_brw_stats_update(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd, <span class="keyword">struct</span> <a class="code" href="structosd__iobuf.html">osd_iobuf</a> *iobuf);
<a name="l00662"></a>00662 <span class="preprocessor">#if LUSTRE_VERSION_CODE &lt; OBD_OCD_VERSION(3, 0, 52, 0)</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span><span class="keywordtype">int</span> osd_register_proc_index_in_idif(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd);
<a name="l00664"></a>00664 <span class="preprocessor">#endif</span>
<a name="l00665"></a>00665 <span class="preprocessor"></span>
<a name="l00666"></a>00666 <span class="preprocessor">#endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a0e4f6c907c6284be39139b21963e044c">osd_statfs</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00668"></a>00668                <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *sfs);
<a name="l00669"></a>00669 <span class="keyword">struct </span>inode *<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a322e19443e9c62cb02a6a8c9eec6626d">osd_iget</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev,
<a name="l00670"></a>00670                        <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l00671"></a>00671 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a961b35fafee504af03541e003ae1ddb1" title="Put the fid into lustre_mdt_attrs, and then place the structure inode&amp;#39;s ea.">osd_ea_fid_set</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> inode *inode,
<a name="l00672"></a>00672                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, __u32 compat, __u32 incompat);
<a name="l00673"></a>00673 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a33a698e1f63ed2ae2a915e4bcbce92e8">osd_get_lma</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> inode *inode,
<a name="l00674"></a>00674                 <span class="keyword">struct</span> dentry *dentry, <span class="keyword">struct</span> <a class="code" href="structlustre__mdt__attrs.html" title="Following struct for object attributes, that will be kept inode&amp;#39;s EA.">lustre_mdt_attrs</a> *lma);
<a name="l00675"></a>00675 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a6a92ec612fb05e9eb42cfb6b91310933">osd_add_oi_cache</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00676"></a>00676                       <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00677"></a>00677 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a7bb7106be26bf680a8a943af1c90ef29">osd_get_idif</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> inode *inode,
<a name="l00678"></a>00678                  <span class="keyword">struct</span> dentry *dentry, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a8f1007b7ef143aa891130d4d2c9be380">osd_obj_map_init</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd);
<a name="l00681"></a>00681 <span class="keywordtype">void</span> <a class="code" href="osd__compat_8c.html#a3936caea788b7bd77c5e0159a39f0520">osd_obj_map_fini</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev);
<a name="l00682"></a>00682 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a50a69e871b74dde7523ac43d436cee8a">osd_obj_map_lookup</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00683"></a>00683                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l00684"></a>00684 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a6afeacd12533cf75c89b75285976f206">osd_obj_map_insert</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00685"></a>00685                        <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>,
<a name="l00686"></a>00686                        handle_t *th);
<a name="l00687"></a>00687 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#aba5ddebfc713e82d13b16265ea02e027">osd_obj_map_delete</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00688"></a>00688                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, handle_t *th);
<a name="l00689"></a>00689 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#af7ceac3ba31fbb4e99e7d5ee05ea56e1">osd_obj_map_update</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00690"></a>00690                        <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>,
<a name="l00691"></a>00691                        handle_t *th);
<a name="l00692"></a>00692 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a6796c99b4b77e4c92a12b39cadd35342">osd_obj_map_recover</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00693"></a>00693                         <span class="keyword">struct</span> inode *src_parent, <span class="keyword">struct</span> dentry *src_child,
<a name="l00694"></a>00694                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00695"></a>00695 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#acf638db426fadf0f91bb5d9f6c9a0bfd">osd_obj_spec_lookup</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00696"></a>00696                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l00697"></a>00697 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a512631c3f2624b3ab23ba2682d23d76b">osd_obj_spec_insert</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00698"></a>00698                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>,
<a name="l00699"></a>00699                         handle_t *th);
<a name="l00700"></a>00700 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a4bbbc298d63715bbcf630c97e707142a">osd_obj_spec_update</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00701"></a>00701                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>,
<a name="l00702"></a>00702                         handle_t *th);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1361e78746369d0de05029d472e425ce">osd_scrub_file_reset</a>(<span class="keyword">struct</span> <a class="code" href="structosd__scrub.html">osd_scrub</a> *scrub, __u8 *<a class="code" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags);
<a name="l00705"></a>00705 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6334fbe7a50b9b07959f5d088d4b7530">osd_scrub_file_store</a>(<span class="keyword">struct</span> <a class="code" href="structosd__scrub.html">osd_scrub</a> *scrub);
<a name="l00706"></a>00706 <span class="keywordtype">char</span> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a29a581a5d333eb5349c64d52e273ecd9">osd_lf_fid2name</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00707"></a>00707 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2eca8a4339f8b2871836dfa68b372b36">osd_scrub_start</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev, __u32 flags);
<a name="l00708"></a>00708 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6a2ef8023e882ef01e400372c112ed9c">osd_scrub_setup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev);
<a name="l00709"></a>00709 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a143eda603dd5fcef3aa810a5d6653699">osd_scrub_cleanup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev);
<a name="l00710"></a>00710 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1c3c2f6e2535ebf779351ac39abcea83">osd_oii_insert</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev, <span class="keyword">struct</span> <a class="code" href="structosd__idmap__cache.html">osd_idmap_cache</a> *oic,
<a name="l00711"></a>00711                    <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a1c315138d5fed2bf8d5f5cf86bb9d171">insert</a>);
<a name="l00712"></a>00712 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a61d4f2b60f546541806370355f8b69d8">osd_oii_lookup</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l00713"></a>00713                    <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l00714"></a>00714 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#afd6f406fb0c26c10f2b313f839e96851">osd_scrub_dump</a>(<span class="keyword">struct</span> seq_file *m, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3f9dcf494255fd8bafc2a6b7f7235422">osd_fld_lookup</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00717"></a>00717                    u64 seq, <span class="keyword">struct</span> <a class="code" href="structlu__seq__range.html" title="Describes a range of sequence, lsr_start is included but lsr_end is not in the range...">lu_seq_range</a> *range);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a24e4f91113b836118d6e46ec8b1dcf94">osd_delete_from_remote_parent</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00720"></a>00720                                   <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00721"></a>00721                                   <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00722"></a>00722                                   <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00723"></a>00723 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a9829bee6c253e14011260aba9b5ca161">osd_add_to_remote_parent</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00724"></a>00724                              <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh);
<a name="l00725"></a>00725 <span class="keywordtype">int</span> <a class="code" href="osd__compat_8c.html#a56dc1b3a202cd5744af1118b3d463e8e">osd_lookup_in_remote_parent</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *oti,
<a name="l00726"></a>00726                                 <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00727"></a>00727                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l00728"></a>00728                                 <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af325e21d2afe14f3a1f4b73cc59c9569">osd_ost_seq_exists</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00731"></a>00731                        <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> seq);
<a name="l00732"></a>00732 <span class="comment">/* osd_quota_fmt.c */</span>
<a name="l00733"></a>00733 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad477fa7f7735c684d476bb4cf49e564e" title="Search from index within the tree block blk, and fill the it with the first valid...">walk_tree_dqentry</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00734"></a>00734                       <span class="keywordtype">int</span> type, uint blk, <span class="keywordtype">int</span> depth, uint index,
<a name="l00735"></a>00735                       <span class="keyword">struct</span> <a class="code" href="structosd__it__quota.html" title="Iterator&amp;#39;s in-memory data structure for quota file.">osd_it_quota</a> *it);
<a name="l00736"></a>00736 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab230823332fb20ac2091fa7821435757" title="Search from index within the leaf block blk, and fill the it with the first valid...">walk_block_dqentry</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00737"></a>00737                        <span class="keywordtype">int</span> type, uint blk, uint index,
<a name="l00738"></a>00738                        <span class="keyword">struct</span> <a class="code" href="structosd__it__quota.html" title="Iterator&amp;#39;s in-memory data structure for quota file.">osd_it_quota</a> *it);
<a name="l00739"></a>00739 loff_t <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a8451ea1c57014d021ce90744832af48a" title="Find entry for given dqid in the tree block blk.">find_tree_dqentry</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00740"></a>00740                          <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, <span class="keywordtype">int</span> type,
<a name="l00741"></a>00741                          qid_t dqid, uint blk, <span class="keywordtype">int</span> depth,
<a name="l00742"></a>00742                          <span class="keyword">struct</span> <a class="code" href="structosd__it__quota.html" title="Iterator&amp;#39;s in-memory data structure for quota file.">osd_it_quota</a> *it);
<a name="l00743"></a>00743 <span class="comment">/* osd_quota.c */</span>
<a name="l00744"></a>00744 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a7393f55caa4eb9de3891135094eb77d1" title="Reserve journal credits for quota files update first, then call -&amp;gt;op_begin() to...">osd_declare_qid</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh,
<a name="l00745"></a>00745                     <span class="keyword">struct</span> <a class="code" href="structlquota__id__info.html">lquota_id_info</a> *qi, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00746"></a>00746                     <span class="keywordtype">bool</span> enforce, <span class="keywordtype">int</span> *flags);
<a name="l00747"></a>00747 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae4de07694790ecae06f4cbf95742ffe4" title="Wrapper for osd_declare_qid().">osd_declare_inode_qid</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, qid_t uid, qid_t gid,
<a name="l00748"></a>00748                           <span class="keywordtype">long</span> <span class="keywordtype">long</span> space, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh,
<a name="l00749"></a>00749                           <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, <span class="keywordtype">bool</span> is_blk, <span class="keywordtype">int</span> *flags,
<a name="l00750"></a>00750                           <span class="keywordtype">bool</span> force);
<a name="l00751"></a>00751 <span class="keyword">const</span> <span class="keyword">struct </span>dt_rec *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a37352588b599965792a00f1f42c022c5">osd_quota_pack</a>(<span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj,
<a name="l00752"></a>00752                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_rec *rec,
<a name="l00753"></a>00753                                     <span class="keyword">union</span> <a class="code" href="unionlquota__rec.html">lquota_rec</a> *quota_rec);
<a name="l00754"></a>00754 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a4daab89e8cc5e8a994f82da4a06e1f9a">osd_quota_unpack</a>(<span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj, <span class="keyword">const</span> <span class="keyword">struct</span> dt_rec *rec);
<a name="l00755"></a>00755 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a6a19c00ecce2bd0fa08bf8c932c80074">osd_quota_migration</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="preprocessor">#ifndef HAVE_I_UID_READ</span>
<a name="l00758"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a82b661296512709a2aabc562fba7289d">00758</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> uid_t <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a82b661296512709a2aabc562fba7289d">i_uid_read</a>(<span class="keyword">const</span> <span class="keyword">struct</span> inode *inode)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760         <span class="keywordflow">return</span> inode-&gt;i_uid;
<a name="l00761"></a>00761 }
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa2c78ad5e3f3e00aed05dd795c36dcf3">00763</a> <span class="keyword">static</span> <span class="keyword">inline</span> gid_t <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa2c78ad5e3f3e00aed05dd795c36dcf3">i_gid_read</a>(<span class="keyword">const</span> <span class="keyword">struct</span> inode *inode)
<a name="l00764"></a>00764 {
<a name="l00765"></a>00765         <span class="keywordflow">return</span> inode-&gt;i_gid;
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00768"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1e7b2168fd419ac16a3c81947caf1fbe">00768</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1e7b2168fd419ac16a3c81947caf1fbe">i_uid_write</a>(<span class="keyword">struct</span> inode *inode, uid_t uid)
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770         inode-&gt;i_uid = uid;
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00773"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2322073438cab121b23da3537b88a4a4">00773</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2322073438cab121b23da3537b88a4a4">i_gid_write</a>(<span class="keyword">struct</span> inode *inode, gid_t gid)
<a name="l00774"></a>00774 {
<a name="l00775"></a>00775         inode-&gt;i_gid = gid;
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 <span class="preprocessor">#endif</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span>
<a name="l00779"></a>00779 <span class="preprocessor">#ifdef LDISKFS_HT_MISC</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span><span class="preprocessor"># define osd_journal_start_sb(sb, type, nblock) \</span>
<a name="l00781"></a>00781 <span class="preprocessor">                ldiskfs_journal_start_sb(sb, type, nblock)</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span><span class="preprocessor"># define osd_ldiskfs_append(handle, inode, nblock) \</span>
<a name="l00783"></a>00783 <span class="preprocessor">                ldiskfs_append(handle, inode, nblock)</span>
<a name="l00784"></a>00784 <span class="preprocessor"></span><span class="preprocessor"># define osd_ldiskfs_find_entry(dir, name, de, inlined, lock) \</span>
<a name="l00785"></a>00785 <span class="preprocessor">                __ldiskfs_find_entry(dir, name, de, inlined, lock)</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span><span class="preprocessor"># define osd_journal_start(inode, type, nblocks) \</span>
<a name="l00787"></a>00787 <span class="preprocessor">                ldiskfs_journal_start(inode, type, nblocks)</span>
<a name="l00788"></a>00788 <span class="preprocessor"></span><span class="preprocessor"># define osd_transaction_size(dev) \</span>
<a name="l00789"></a>00789 <span class="preprocessor">                (osd_journal(dev)-&gt;j_max_transaction_buffers / 2)</span>
<a name="l00790"></a>00790 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00791"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2f04c6d32cc94c809895c40abca8420f">00791</a> <span class="preprocessor"></span><span class="preprocessor"># define LDISKFS_HT_MISC        0</span>
<a name="l00792"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a0218a530735e2fee2eb5af489bbf7615">00792</a> <span class="preprocessor"></span><span class="preprocessor"># define osd_journal_start_sb(sb, type, nblock) \</span>
<a name="l00793"></a>00793 <span class="preprocessor">                ldiskfs_journal_start_sb(sb, nblock)</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span>
<a name="l00795"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a135b1e0120ac64a6114b94322ae0b424">00795</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>buffer_head *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a135b1e0120ac64a6114b94322ae0b424">osd_ldiskfs_append</a>(handle_t *handle,
<a name="l00796"></a>00796                                                      <span class="keyword">struct</span> inode *inode,
<a name="l00797"></a>00797                                                      ldiskfs_lblk_t *nblock)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799         <span class="keyword">struct </span>buffer_head *bh;
<a name="l00800"></a>00800         <span class="keywordtype">int</span> err = 0;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         bh = ldiskfs_append(handle, inode, nblock, &amp;err);
<a name="l00803"></a>00803         <span class="keywordflow">if</span> (bh == NULL)
<a name="l00804"></a>00804                 bh = ERR_PTR(err);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806         <span class="keywordflow">return</span> bh;
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac7dd6066628f69ae52504068c04c80d0">00809</a> <span class="preprocessor"># define osd_ldiskfs_find_entry(dir, name, de, inlined, lock) \</span>
<a name="l00810"></a>00810 <span class="preprocessor">                __ldiskfs_find_entry(dir, name, de, lock)</span>
<a name="l00811"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2fa7c13039ee7e876f0755521369f4fa">00811</a> <span class="preprocessor"></span><span class="preprocessor"># define osd_journal_start(inode, type, nblocks) \</span>
<a name="l00812"></a>00812 <span class="preprocessor">                ldiskfs_journal_start(inode, nblocks)</span>
<a name="l00813"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac24873c5cce632b7efe7e3a71868eb9f">00813</a> <span class="preprocessor"></span><span class="preprocessor"># define osd_transaction_size(dev) \</span>
<a name="l00814"></a>00814 <span class="preprocessor">                (osd_journal(dev)-&gt;j_max_transaction_buffers)</span>
<a name="l00815"></a>00815 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00816"></a>00816 <span class="preprocessor"></span>
<a name="l00817"></a>00817 <span class="comment">/*</span>
<a name="l00818"></a>00818 <span class="comment"> * Invariants, assertions.</span>
<a name="l00819"></a>00819 <span class="comment"> */</span>
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="comment">/*</span>
<a name="l00822"></a>00822 <span class="comment"> * XXX: do not enable this, until invariant checking code is made thread safe</span>
<a name="l00823"></a>00823 <span class="comment"> * in the face of pdirops locking.</span>
<a name="l00824"></a>00824 <span class="comment"> */</span>
<a name="l00825"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a89b0750bafdfde9fea38b6b44cdc265d">00825</a> <span class="preprocessor">#define OSD_INVARIANT_CHECKS (0)</span>
<a name="l00826"></a>00826 <span class="preprocessor"></span>
<a name="l00827"></a>00827 <span class="preprocessor">#if OSD_INVARIANT_CHECKS</span>
<a name="l00828"></a>00828 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abbced5c9baf2fd600200680e5cf6a491">osd_invariant</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj)
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830         <span class="keywordflow">return</span>
<a name="l00831"></a>00831                 obj != NULL &amp;&amp;
<a name="l00832"></a>00832                 <a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(obj-&gt;<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a> != NULL,
<a name="l00833"></a>00833                      obj-&gt;<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a>-&gt;i_sb == <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2cd61ff19ca81d776412b8d57afd7524">osd_sb</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">osd_obj2dev</a>(obj)) &amp;&amp;
<a name="l00834"></a>00834                      atomic_read(&amp;obj-&gt;<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a>-&gt;i_count) &gt; 0) &amp;&amp;
<a name="l00835"></a>00835                 <a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(obj-&gt;<a class="code" href="structosd__object.html#a8efb02c469a31e5aa4523f6a82ca32ae">oo_dir</a> != NULL &amp;&amp;
<a name="l00836"></a>00836                      obj-&gt;<a class="code" href="structosd__object.html#a8efb02c469a31e5aa4523f6a82ca32ae">oo_dir</a>-&gt;od_conationer.ic_object != NULL,
<a name="l00837"></a>00837                      obj-&gt;<a class="code" href="structosd__object.html#a8efb02c469a31e5aa4523f6a82ca32ae">oo_dir</a>-&gt;od_conationer.ic_object == obj-&gt;<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a>);
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 <span class="preprocessor">#else</span>
<a name="l00840"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abbced5c9baf2fd600200680e5cf6a491">00840</a> <span class="preprocessor"></span><span class="preprocessor">#define osd_invariant(obj) (1)</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00842"></a>00842 <span class="preprocessor"></span>
<a name="l00843"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a47a60bf5af363e35688589db63433c4c">00843</a> <span class="preprocessor">#define OSD_MAX_CACHE_SIZE OBD_OBJECT_EOF</span>
<a name="l00844"></a>00844 <span class="preprocessor"></span>
<a name="l00845"></a>00845 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa295143d631c3471b40de9493f9bb973">osd_otable_ops</a>;
<a name="l00846"></a>00846 
<a name="l00847"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac1dee6ea17eb78b3ea08cce5c2e0c70c">00847</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac1dee6ea17eb78b3ea08cce5c2e0c70c">osd_oi_fid2idx</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev,
<a name="l00848"></a>00848                                  <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850         <span class="keywordflow">return</span> fid-&gt;<a class="code" href="structlu__fid.html#a05477e45a42f0e5ae1b438c2d9e6cf30" title="FID sequence.">f_seq</a> &amp; (dev-&gt;<a class="code" href="structosd__device.html#a6c567bcf80744a85daba595066670b2e">od_oi_count</a> - 1);
<a name="l00851"></a>00851 }
<a name="l00852"></a>00852 
<a name="l00853"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a50efdbd562fc2429fab941944fda8274">00853</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__oi.html">osd_oi</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a50efdbd562fc2429fab941944fda8274">osd_fid2oi</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l00854"></a>00854                                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid)
<a name="l00855"></a>00855 {
<a name="l00856"></a>00856         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>(!<a class="code" href="group__lu__fid.html#ga83302b8605d68196a1f095f0cff1530f">fid_is_idif</a>(fid), <a class="code" href="group__lustreuser.html#gada965b87689690ab45635c329842df61">DFID</a><span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="group__lustreuser.html#ga00397843677b819317199a3198f5ecc2">PFID</a>(fid));
<a name="l00857"></a>00857         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>(!<a class="code" href="group__lu__fid.html#gaf7cf854e7bfd117237b16739fb243a5b">fid_is_last_id</a>(fid), <a class="code" href="group__lustreuser.html#gada965b87689690ab45635c329842df61">DFID</a><span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="group__lustreuser.html#ga00397843677b819317199a3198f5ecc2">PFID</a>(fid));
<a name="l00858"></a>00858         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>(osd-&gt;<a class="code" href="structosd__device.html#aa39936b9319f2e21867a2fd0034ca2dd">od_oi_table</a> != NULL &amp;&amp; osd-&gt;<a class="code" href="structosd__device.html#a6c567bcf80744a85daba595066670b2e">od_oi_count</a> &gt;= 1,
<a name="l00859"></a>00859                  <a class="code" href="group__lustreuser.html#gada965b87689690ab45635c329842df61">DFID</a><span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="group__lustreuser.html#ga00397843677b819317199a3198f5ecc2">PFID</a>(fid));
<a name="l00860"></a>00860         <span class="comment">/* It can work even od_oi_count equals to 1 although it&apos;s unexpected,</span>
<a name="l00861"></a>00861 <span class="comment">         * the only reason we set it to 1 is for performance measurement */</span>
<a name="l00862"></a>00862         <span class="keywordflow">return</span> osd-&gt;<a class="code" href="structosd__device.html#aa39936b9319f2e21867a2fd0034ca2dd">od_oi_table</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac1dee6ea17eb78b3ea08cce5c2e0c70c">osd_oi_fid2idx</a>(osd, fid)];
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__device__operations.html" title="Operations common for data and meta-data devices.">lu_device_operations</a>  <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3d60ffc9efe910c72a37d09413b5c0d6">osd_lu_ops</a>;
<a name="l00866"></a>00866 
<a name="l00867"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">00867</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00868"></a>00868 {
<a name="l00869"></a>00869         <span class="keywordflow">return</span> <a class="code" href="osd__iam_8h.html#a7f75ab6839d468f4d23480a9c65724c5">ergo</a>(d != NULL &amp;&amp; d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> != NULL, d-&gt;<a class="code" href="structlu__device.html#a4cab097ca33e55a7255ad1d848596827" title="Operation vector for this device.">ld_ops</a> == &amp;<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a3d60ffc9efe910c72a37d09413b5c0d6">osd_lu_ops</a>);
<a name="l00870"></a>00870 }
<a name="l00871"></a>00871 
<a name="l00872"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">00872</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d)
<a name="l00873"></a>00873 {
<a name="l00874"></a>00874         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(&amp;d-&gt;<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>));
<a name="l00875"></a>00875         <span class="keywordflow">return</span> container_of0(d, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a>, <a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>);
<a name="l00876"></a>00876 }
<a name="l00877"></a>00877 
<a name="l00878"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">00878</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">osd_dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l00879"></a>00879 {
<a name="l00880"></a>00880         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(d));
<a name="l00881"></a>00881         <span class="keywordflow">return</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(container_of0(d, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a>, dd_lu_dev));
<a name="l00882"></a>00882 }
<a name="l00883"></a>00883 
<a name="l00884"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">00884</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__device.html">osd_device</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">osd_obj2dev</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *o)
<a name="l00885"></a>00885 {
<a name="l00886"></a>00886         <span class="keywordflow">return</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#adbe78717930967c2e102c72548101ea7">osd_dev</a>(o-&gt;<a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>);
<a name="l00887"></a>00887 }
<a name="l00888"></a>00888 
<a name="l00889"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2cd61ff19ca81d776412b8d57afd7524">00889</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>super_block *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2cd61ff19ca81d776412b8d57afd7524">osd_sb</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev)
<a name="l00890"></a>00890 {
<a name="l00891"></a>00891         <span class="keywordflow">return</span> dev-&gt;<a class="code" href="structosd__device.html#a7fdc7d18e6fbb3904a2e1e2e92e5bf18">od_mnt</a>-&gt;mnt_sb;
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abad26f840be5844f2aee4d03eee1874f">00894</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abad26f840be5844f2aee4d03eee1874f">osd_object_is_root</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a> *obj)
<a name="l00895"></a>00895 {
<a name="l00896"></a>00896         <span class="keywordflow">return</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2cd61ff19ca81d776412b8d57afd7524">osd_sb</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad57c966eb34ffab8b7d800d84c8db76">osd_obj2dev</a>(obj))-&gt;s_root-&gt;d_inode == obj-&gt;<a class="code" href="structosd__object.html#ae81e0028f4f47ba8d7bebb5f2d983e12" title="Inode for file system object represented by this osd_object.">oo_inode</a>;
<a name="l00897"></a>00897 }
<a name="l00898"></a>00898 
<a name="l00899"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">00899</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">osd_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *o)
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae13b6900c1993bffd85a18805d52fb8f">lu_device_is_osd</a>(o-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>));
<a name="l00902"></a>00902         <span class="keywordflow">return</span> container_of0(o, <span class="keyword">struct</span> <a class="code" href="structosd__object.html">osd_object</a>, <a class="code" href="structosd__object.html#a9c7ba8e54cb6dbcac9e634cf4fd7dd43">oo_dt</a>.<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00903"></a>00903 }
<a name="l00904"></a>00904 
<a name="l00905"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab117b086a8dae31a27429185840ed352">00905</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__object.html">osd_object</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab117b086a8dae31a27429185840ed352">osd_dt_obj</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d)
<a name="l00906"></a>00906 {
<a name="l00907"></a>00907         <span class="keywordflow">return</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af504103e6d3f3e69bc9dac4563f6cc81">osd_obj</a>(&amp;d-&gt;<a class="code" href="structdt__object.html#af646d1f1afe6acdc83ad0778a29163d7">do_lu</a>);
<a name="l00908"></a>00908 }
<a name="l00909"></a>00909 
<a name="l00910"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a7662499061cbf0295dfa08357a9978d2">00910</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a7662499061cbf0295dfa08357a9978d2">osd2lu_dev</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00911"></a>00911 {
<a name="l00912"></a>00912         <span class="keywordflow">return</span> &amp;osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>;
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a13b53f25097d490bacdb906fae8c2499">00915</a> <span class="keyword">static</span> <span class="keyword">inline</span> journal_t *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a13b53f25097d490bacdb906fae8c2499">osd_journal</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev)
<a name="l00916"></a>00916 {
<a name="l00917"></a>00917         <span class="keywordflow">return</span> LDISKFS_SB(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a2cd61ff19ca81d776412b8d57afd7524">osd_sb</a>(dev))-&gt;s_journal;
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae1c9b0f9a7e8e8dca38c3a7e962922ca">00920</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structseq__server__site.html">seq_server_site</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae1c9b0f9a7e8e8dca38c3a7e962922ca">osd_seq_site</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922         <span class="keywordflow">return</span> osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>.<a class="code" href="structlu__device.html#aaa1ef1e1a330f307a9baf6e59fc9c39b" title="Stack this device belongs to.">ld_site</a>-&gt;<a class="code" href="structlu__site.html#ae7ef4565e0e4634a56ca97fbb552d271" title="XXX: a hack! fld has to find md_site via site, remove when possible.">ld_seq_site</a>;
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">00925</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">char</span> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd)
<a name="l00926"></a>00926 {
<a name="l00927"></a>00927         <span class="keywordflow">return</span> osd-&gt;<a class="code" href="structosd__device.html#af35407e6c54ef4048353a808029f76d2">od_dt_dev</a>.<a class="code" href="structdt__device.html#a54e8912d9668696ec00395a14ca44fd3">dd_lu_dev</a>.<a class="code" href="structlu__device.html#af35351bd6a533fa48c8a0f0eda83172a">ld_obd</a>-&gt;<a class="code" href="structobd__device.html#a47f3a5a4e3b9ce7d39282c2aa1058985">obd_name</a>;
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00930"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a64393387496fb270f846339808f2e0ef">00930</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a64393387496fb270f846339808f2e0ef">osd_is_ea_inode</a>(<span class="keyword">struct</span> inode *inode)
<a name="l00931"></a>00931 {
<a name="l00932"></a>00932         <span class="keywordflow">return</span> !!(LDISKFS_I(inode)-&gt;i_flags &amp; LDISKFS_EA_INODE_FL);
<a name="l00933"></a>00933 }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__body__operations.html" title="Per-dt-object operations on &amp;quot;file body&amp;quot; - unstructure raw data.">dt_body_operations</a> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a7209b71cf9559b05a2c6ed9358ac0119">osd_body_ops</a>;
<a name="l00936"></a>00936 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__context__key.html" title="Key.">lu_context_key</a> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#aeec1bbe93dd8e9437856bc428708caa4">osd_key</a>;
<a name="l00937"></a>00937 
<a name="l00938"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">00938</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env)
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940         <span class="keywordflow">return</span> <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;<a class="code" href="osd-ldiskfs_2osd__handler_8c.html#aeec1bbe93dd8e9437856bc428708caa4">osd_key</a>);
<a name="l00941"></a>00941 }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__body__operations.html" title="Per-dt-object operations on &amp;quot;file body&amp;quot; - unstructure raw data.">dt_body_operations</a> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad1be0b6525b346160d913e78d6ce9de">osd_body_ops_new</a>;
<a name="l00944"></a>00944 
<a name="l00948"></a>00948 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00949"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abc775af97198aa96317c410edb8e2a39">00949</a> <span class="keyword">struct </span><a class="code" href="structiam__path__descr.html">iam_path_descr</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#abc775af97198aa96317c410edb8e2a39" title="IAM Iterator.">osd_it_ipd_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00950"></a>00950                                       <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structiam__container.html">iam_container</a> *bag)
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952         <span class="keywordflow">return</span> bag-&gt;<a class="code" href="structiam__container.html#a33d58684b5bfc25a9e1498098435df96">ic_descr</a>-&gt;<a class="code" href="structiam__descr.html#a787056febee9a53ec7bc8032d5fa68f3">id_ops</a>-&gt;<a class="code" href="structiam__operations.html#aee31781855035ecb2ff82a7218f6a32f">id_ipd_alloc</a>(bag,
<a name="l00953"></a>00953                                            <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env)-&gt;oti_it_ipd);
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00957"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a0c36ca7f8465684dad2bc63ad197a1b2">00957</a> <span class="keyword">struct </span><a class="code" href="structiam__path__descr.html">iam_path_descr</a> *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a0c36ca7f8465684dad2bc63ad197a1b2">osd_idx_ipd_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00958"></a>00958                                        <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structiam__container.html">iam_container</a> *bag)
<a name="l00959"></a>00959 {
<a name="l00960"></a>00960         <span class="keywordflow">return</span> bag-&gt;<a class="code" href="structiam__container.html#a33d58684b5bfc25a9e1498098435df96">ic_descr</a>-&gt;<a class="code" href="structiam__descr.html#a787056febee9a53ec7bc8032d5fa68f3">id_ops</a>-&gt;<a class="code" href="structiam__operations.html#aee31781855035ecb2ff82a7218f6a32f">id_ipd_alloc</a>(bag,
<a name="l00961"></a>00961                                            <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env)-&gt;oti_idx_ipd);
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a35e53b9e7cba96f0b102d282a5d6d677">00964</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a35e53b9e7cba96f0b102d282a5d6d677">osd_ipd_put</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00965"></a>00965                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structiam__container.html">iam_container</a> *bag,
<a name="l00966"></a>00966                                <span class="keyword">struct</span> <a class="code" href="structiam__path__descr.html">iam_path_descr</a> *ipd)
<a name="l00967"></a>00967 {
<a name="l00968"></a>00968         bag-&gt;<a class="code" href="structiam__container.html#a33d58684b5bfc25a9e1498098435df96">ic_descr</a>-&gt;<a class="code" href="structiam__descr.html#a787056febee9a53ec7bc8032d5fa68f3">id_ops</a>-&gt;<a class="code" href="structiam__operations.html#afc61a9145c59652bd5958e3a99ba7dbb">id_ipd_free</a>(ipd);
<a name="l00969"></a>00969 }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a9839aacb56c63b5dd8fe7daf4a44bf53">osd_calc_bkmap_credits</a>(<span class="keyword">struct</span> super_block *sb, <span class="keyword">struct</span> inode *inode,
<a name="l00972"></a>00972                            <span class="keyword">const</span> loff_t <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="keyword">const</span> loff_t pos,
<a name="l00973"></a>00973                            <span class="keyword">const</span> <span class="keywordtype">int</span> blocks);
<a name="l00974"></a>00974 
<a name="l00975"></a>00975 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa7f07bf1b9d7550e0b7912aeabb45663">osd_ldiskfs_read</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, loff_t *offs);
<a name="l00976"></a>00976 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a8622c9839d1313171a864857fb6554ff">osd_ldiskfs_write_record</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> <a class="code" href="multiop_8c.html#a199ab88d4ca8eab30e1cb7d35edacca5">bufsize</a>,
<a name="l00977"></a>00977                              <span class="keywordtype">int</span> write_NUL, loff_t *offs, handle_t *handle);
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l00980"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a252ec5d9aa7530b65e2d6a27a9a1edb0">00980</a> <span class="keyword">struct </span>dentry *<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a252ec5d9aa7530b65e2d6a27a9a1edb0">osd_child_dentry_by_inode</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00981"></a>00981                                          <span class="keyword">struct</span> inode *inode,
<a name="l00982"></a>00982                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> namelen)
<a name="l00983"></a>00983 {
<a name="l00984"></a>00984         <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info = <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env);
<a name="l00985"></a>00985         <span class="keyword">struct </span>dentry *child_dentry = &amp;info-&gt;<a class="code" href="structosd__thread__info.html#a71ab43b003b76ed471c0ed2085021889">oti_child_dentry</a>;
<a name="l00986"></a>00986         <span class="keyword">struct </span>dentry *obj_dentry = &amp;info-&gt;<a class="code" href="structosd__thread__info.html#ab13060bad7d6407028bc061f3e0fd5f5" title="used for index operations.">oti_obj_dentry</a>;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988         obj_dentry-&gt;d_inode = inode;
<a name="l00989"></a>00989         obj_dentry-&gt;d_sb = inode-&gt;i_sb;
<a name="l00990"></a>00990         obj_dentry-&gt;d_name.hash = 0;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992         child_dentry-&gt;d_name.hash = 0;
<a name="l00993"></a>00993         child_dentry-&gt;d_parent = obj_dentry;
<a name="l00994"></a>00994         child_dentry-&gt;d_name.name = name;
<a name="l00995"></a>00995         child_dentry-&gt;d_name.len = namelen;
<a name="l00996"></a>00996         <span class="keywordflow">return</span> child_dentry;
<a name="l00997"></a>00997 }
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a83377d22d7c0dbe8d0669bfa1f206095">osd_trans_declare_op2rb</a>[];
<a name="l01000"></a>01000 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a9de56a4f2fb731a6a3521d1762bcf984">ldiskfs_track_declares_assert</a>;
<a name="l01001"></a>01001 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a2aca305ee7edbdde2f7d1f84a075bcb6">osd_trans_dump_creds</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01002"></a>01002 
<a name="l01003"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad510f1ebb2cf81a87b59fb9bdc77ca18">01003</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ad510f1ebb2cf81a87b59fb9bdc77ca18">osd_trans_declare_op</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01004"></a>01004                                         <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a> *oh,
<a name="l01005"></a>01005                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, <span class="keywordtype">int</span> <a class="code" href="gnilnd__modparams_8c.html#aca17d0debc49d011e5c492872fa98b92">credits</a>)
<a name="l01006"></a>01006 {
<a name="l01007"></a>01007         <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *oti = <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env);
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(oh-&gt;<a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">ot_handle</a> == NULL);
<a name="l01010"></a>01010         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(op &gt;= <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>)) {
<a name="l01011"></a>01011                 <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ldiskfs_track_declares_assert)) {
<a name="l01012"></a>01012                         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(op &lt; <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>);
<a name="l01013"></a>01013                 } <span class="keywordflow">else</span> {
<a name="l01014"></a>01014                         <a class="code" href="libcfs__debug_8h.html#af03883cada59830b0488595cf5d571a0">CWARN</a>(<span class="stringliteral">&quot;%s: Invalid operation index %d\n&quot;</span>,
<a name="l01015"></a>01015                               <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(oh-&gt;<a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>.<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>)), op);
<a name="l01016"></a>01016                         <a class="code" href="libcfs__private_8h.html#a61e8f1652691969b81fd5e21cf19f81c">libcfs_debug_dumpstack</a>(NULL);
<a name="l01017"></a>01017                 }
<a name="l01018"></a>01018         } <span class="keywordflow">else</span> {
<a name="l01019"></a>01019                 oti-&gt;<a class="code" href="structosd__thread__info.html#acdd7f1b58cad4d72a41c6307179b93b0">oti_declare_ops</a>[op]++;
<a name="l01020"></a>01020                 oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op] += credits;
<a name="l01021"></a>01021         }
<a name="l01022"></a>01022         oh-&gt;<a class="code" href="structosd__thandle.html#a4ba41c23d9f16cd4d6c8c4858bf2e344">ot_credits</a> += credits;
<a name="l01023"></a>01023 }
<a name="l01024"></a>01024 
<a name="l01025"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a9d39800be89b44dbbfce4273ce5a323e">01025</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a9d39800be89b44dbbfce4273ce5a323e">osd_trans_exec_op</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01026"></a>01026                                      <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>)
<a name="l01027"></a>01027 {
<a name="l01028"></a>01028         <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *oti = <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env);
<a name="l01029"></a>01029         <span class="keyword">struct </span><a class="code" href="structosd__thandle.html">osd_thandle</a>     *oh  = container_of(th, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a>,
<a name="l01030"></a>01030                                                    <a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>);
<a name="l01031"></a>01031         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            rb, left;
<a name="l01032"></a>01032 
<a name="l01033"></a>01033         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(oh-&gt;<a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">ot_handle</a> != NULL);
<a name="l01034"></a>01034         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(op &gt;= <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>)) {
<a name="l01035"></a>01035                 <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ldiskfs_track_declares_assert))
<a name="l01036"></a>01036                         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(op &lt; <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4b78e76752ad2c573bb04fb606fc6c1b">OSD_OT_MAX</a>);
<a name="l01037"></a>01037                 <span class="keywordflow">else</span> {
<a name="l01038"></a>01038                         <a class="code" href="libcfs__debug_8h.html#af03883cada59830b0488595cf5d571a0">CWARN</a>(<span class="stringliteral">&quot;%s: Invalid operation index %d\n&quot;</span>,
<a name="l01039"></a>01039                               <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(oh-&gt;<a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>.<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>)), op);
<a name="l01040"></a>01040                         <a class="code" href="libcfs__private_8h.html#a61e8f1652691969b81fd5e21cf19f81c">libcfs_debug_dumpstack</a>(NULL);
<a name="l01041"></a>01041                         <span class="keywordflow">return</span>;
<a name="l01042"></a>01042                 }
<a name="l01043"></a>01043         }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         <span class="comment">/* find rollback (or reverse) operation for the given one</span>
<a name="l01046"></a>01046 <span class="comment">         * such an operation doesn&apos;t require additional credits</span>
<a name="l01047"></a>01047 <span class="comment">         * as the same set of blocks are modified */</span>
<a name="l01048"></a>01048         rb = osd_trans_declare_op2rb[op];
<a name="l01049"></a>01049 
<a name="l01050"></a>01050         <span class="comment">/* check whether credits for this operation were reserved at all */</span>
<a name="l01051"></a>01051         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op] == 0 &amp;&amp;
<a name="l01052"></a>01052                      oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[rb] == 0)) {
<a name="l01053"></a>01053                 <span class="comment">/* the API is not perfect yet: CREATE does REF_ADD internally</span>
<a name="l01054"></a>01054 <span class="comment">                 * while DESTROY does not. To rollback CREATE the callers</span>
<a name="l01055"></a>01055 <span class="comment">                 * needs to call REF_DEL+DESTROY which is hard to detect using</span>
<a name="l01056"></a>01056 <span class="comment">                 * a simple table of rollback operations */</span>
<a name="l01057"></a>01057                 <span class="keywordflow">if</span> (op == <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a12e80d4cf137ab2fce567816f4aabf5a">OSD_OT_REF_DEL</a> &amp;&amp;
<a name="l01058"></a>01058                     oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a66c6623fcfc0f3a4601c8d5dbed82237">OSD_OT_CREATE</a>] &gt; 0)
<a name="l01059"></a>01059                         <span class="keywordflow">goto</span> proceed;
<a name="l01060"></a>01060                 <span class="keywordflow">if</span> (op == <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923aed9239d90aabac5da1719a85ba45d37c">OSD_OT_REF_ADD</a> &amp;&amp;
<a name="l01061"></a>01061                     oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a392ce8bd8bc4c73740b22b58b3ae1522">OSD_OT_DESTROY</a>] &gt; 0)
<a name="l01062"></a>01062                         <span class="keywordflow">goto</span> proceed;
<a name="l01063"></a>01063                 <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a2aca305ee7edbdde2f7d1f84a075bcb6">osd_trans_dump_creds</a>(env, th);
<a name="l01064"></a>01064                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;%s: op = %d, rb = %d\n&quot;</span>,
<a name="l01065"></a>01065                        <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(oh-&gt;<a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>.<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>)), op, rb);
<a name="l01066"></a>01066                 <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ldiskfs_track_declares_assert))
<a name="l01067"></a>01067                         <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01068"></a>01068         }
<a name="l01069"></a>01069 
<a name="l01070"></a>01070 proceed:
<a name="l01071"></a>01071         <span class="comment">/* remember how many credits we have unused before the operation */</span>
<a name="l01072"></a>01072         oti-&gt;<a class="code" href="structosd__thread__info.html#af14d6385ee4e8e31c4126a0f3367eac5">oti_credits_before</a> = oh-&gt;<a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">ot_handle</a>-&gt;h_buffer_credits;
<a name="l01073"></a>01073         left = oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op] - oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op];
<a name="l01074"></a>01074         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(oti-&gt;<a class="code" href="structosd__thread__info.html#af14d6385ee4e8e31c4126a0f3367eac5">oti_credits_before</a> &lt; left)) {
<a name="l01075"></a>01075                 <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a2aca305ee7edbdde2f7d1f84a075bcb6">osd_trans_dump_creds</a>(env, th);
<a name="l01076"></a>01076                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;%s: op = %d, rb = %d\n&quot;</span>,
<a name="l01077"></a>01077                        <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ab2f4469c07df2b1e377405482c00dba4">osd_name</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(oh-&gt;<a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>.<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>)), op, rb);
<a name="l01078"></a>01078                 <span class="comment">/* on a very small fs (testing?) it&apos;s possible that</span>
<a name="l01079"></a>01079 <span class="comment">                 * the transaction can&apos;t fit 1/4 of journal, so we</span>
<a name="l01080"></a>01080 <span class="comment">                 * just request less credits (see osd_trans_start()).</span>
<a name="l01081"></a>01081 <span class="comment">                 * ignore the same case here */</span>
<a name="l01082"></a>01082                 rb = <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac24873c5cce632b7efe7e3a71868eb9f">osd_transaction_size</a>(<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa531d080574b482757eb5b8da8def152">osd_dt_dev</a>(th-&gt;<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>));
<a name="l01083"></a>01083                 <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(oh-&gt;<a class="code" href="structosd__thandle.html#a4ba41c23d9f16cd4d6c8c4858bf2e344">ot_credits</a> &lt; rb)) {
<a name="l01084"></a>01084                         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ldiskfs_track_declares_assert))
<a name="l01085"></a>01085                                 <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01086"></a>01086                 }
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088 }
<a name="l01089"></a>01089 
<a name="l01090"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad58a5ace2ed216455400c65cb048119">01090</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aad58a5ace2ed216455400c65cb048119">osd_trans_exec_check</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01091"></a>01091                                         <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l01092"></a>01092                                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>)
<a name="l01093"></a>01093 {
<a name="l01094"></a>01094         <span class="keyword">struct </span><a class="code" href="structosd__thread__info.html">osd_thread_info</a> *oti = <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#af940395e476e307cb156095b6a291f68">osd_oti_get</a>(env);
<a name="l01095"></a>01095         <span class="keyword">struct </span><a class="code" href="structosd__thandle.html">osd_thandle</a>     *oh  = container_of(th, <span class="keyword">struct</span> <a class="code" href="structosd__thandle.html">osd_thandle</a>,
<a name="l01096"></a>01096                                                    <a class="code" href="structosd__thandle.html#a4058e91895be8093c9c51ab2a0435cdb">ot_super</a>);
<a name="l01097"></a>01097         <span class="keywordtype">int</span>                     used, over, quota;
<a name="l01098"></a>01098 
<a name="l01099"></a>01099         <span class="comment">/* how many credits have been used by the operation */</span>
<a name="l01100"></a>01100         used = oti-&gt;<a class="code" href="structosd__thread__info.html#af14d6385ee4e8e31c4126a0f3367eac5">oti_credits_before</a> - oh-&gt;<a class="code" href="structosd__thandle.html#acfeb56eba9cce2190bc8f0b56eb02a60">ot_handle</a>-&gt;h_buffer_credits;
<a name="l01101"></a>01101 
<a name="l01102"></a>01102         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(used &lt; 0)) {
<a name="l01103"></a>01103                 <span class="comment">/* if some block was allocated and released in the same</span>
<a name="l01104"></a>01104 <span class="comment">                 * transaction, then it won&apos;t be a part of the transaction</span>
<a name="l01105"></a>01105 <span class="comment">                 * and delta can be negative */</span>
<a name="l01106"></a>01106                 <span class="keywordflow">return</span>;
<a name="l01107"></a>01107         }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         <span class="keywordflow">if</span> (used == 0) {
<a name="l01110"></a>01110                 <span class="comment">/* rollback operations (e.g. when we destroy just created</span>
<a name="l01111"></a>01111 <span class="comment">                 * object) should not consume any credits. there is no point</span>
<a name="l01112"></a>01112 <span class="comment">                 * to confuse the checks below */</span>
<a name="l01113"></a>01113                 <span class="keywordflow">return</span>;
<a name="l01114"></a>01114         }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116         oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op] += used;
<a name="l01117"></a>01117         <span class="keywordflow">if</span> (oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op] &lt;= oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op])
<a name="l01118"></a>01118                 <span class="keywordflow">return</span>;
<a name="l01119"></a>01119 
<a name="l01120"></a>01120         <span class="comment">/* we account quota for a whole transaction and any operation can</span>
<a name="l01121"></a>01121 <span class="comment">         * consume corresponding credits */</span>
<a name="l01122"></a>01122         over = oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op] -
<a name="l01123"></a>01123                 oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op];
<a name="l01124"></a>01124         quota = oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4ac072a258416c36f1569962ac6e1025">OSD_OT_QUOTA</a>] -
<a name="l01125"></a>01125                 oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4ac072a258416c36f1569962ac6e1025">OSD_OT_QUOTA</a>];
<a name="l01126"></a>01126         <span class="keywordflow">if</span> (over &lt;= quota) {
<a name="l01127"></a>01127                 <span class="comment">/* probably that credits were consumed by</span>
<a name="l01128"></a>01128 <span class="comment">                 * quota indirectly (in the depths of ldiskfs) */</span>
<a name="l01129"></a>01129                 oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[<a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a14061dd054afd472999a4f4f6cdf3923a4ac072a258416c36f1569962ac6e1025">OSD_OT_QUOTA</a>] += over;
<a name="l01130"></a>01130                 oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op] -= over;
<a name="l01131"></a>01131         } <span class="keywordflow">else</span> {
<a name="l01132"></a>01132                 <a class="code" href="libcfs__debug_8h.html#af03883cada59830b0488595cf5d571a0">CWARN</a>(<span class="stringliteral">&quot;op %d: used %u, used now %u, reserved %u\n&quot;</span>,
<a name="l01133"></a>01133                       op, oti-&gt;<a class="code" href="structosd__thread__info.html#af6d70a9c6ed1371b1911a12315855ee9">oti_declare_ops_used</a>[op], used,
<a name="l01134"></a>01134                       oti-&gt;<a class="code" href="structosd__thread__info.html#a42431f8062febf59190e96d87b7559c7">oti_declare_ops_cred</a>[op]);
<a name="l01135"></a>01135                 <a class="code" href="osd-ldiskfs_2osd__handler_8c.html#a2aca305ee7edbdde2f7d1f84a075bcb6">osd_trans_dump_creds</a>(env, th);
<a name="l01136"></a>01136                 <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ldiskfs_track_declares_assert))
<a name="l01137"></a>01137                         <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01138"></a>01138         }
<a name="l01139"></a>01139 }
<a name="l01140"></a>01140 
<a name="l01144"></a>01144 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l01145"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae4669f45d9d4105902e9111060e6349d">01145</a> <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae4669f45d9d4105902e9111060e6349d" title="Helper function to pack the fid, ldiskfs stores fid in packed format.">osd_fid_pack</a>(<span class="keyword">struct</span> <a class="code" href="structosd__fid__pack.html" title="Storage representation for fids.">osd_fid_pack</a> *pack, <span class="keyword">const</span> <span class="keyword">struct</span> dt_rec *fid,
<a name="l01146"></a>01146                   <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *befider)
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148         <a class="code" href="group__lu__fid.html#ga29f631f588b9332657843f274a7dd2c9">fid_cpu_to_be</a>(befider, (<span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *)fid);
<a name="l01149"></a>01149         memcpy(pack-&gt;<a class="code" href="structosd__fid__pack.html#a63df25eaf91fc78e92242edf99965abe">fp_area</a>, befider, <span class="keyword">sizeof</span>(*befider));
<a name="l01150"></a>01150         pack-&gt;<a class="code" href="structosd__fid__pack.html#ab19a6b521348a91926cdb0ee27e624d9">fp_len</a> =  <span class="keyword">sizeof</span>(*befider) + 1;
<a name="l01151"></a>01151 }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153 <span class="keyword">static</span> <span class="keyword">inline</span>
<a name="l01154"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1b3ce2ff806b41394ac8f7087c2c2c9e">01154</a> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1b3ce2ff806b41394ac8f7087c2c2c9e">osd_fid_unpack</a>(<span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structosd__fid__pack.html" title="Storage representation for fids.">osd_fid_pack</a> *pack)
<a name="l01155"></a>01155 {
<a name="l01156"></a>01156         <span class="keywordtype">int</span> result;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158         result = 0;
<a name="l01159"></a>01159         <span class="keywordflow">switch</span> (pack-&gt;<a class="code" href="structosd__fid__pack.html#ab19a6b521348a91926cdb0ee27e624d9">fp_len</a>) {
<a name="l01160"></a>01160         <span class="keywordflow">case</span> <span class="keyword">sizeof</span> *fid + 1:
<a name="l01161"></a>01161                 memcpy(fid, pack-&gt;<a class="code" href="structosd__fid__pack.html#a63df25eaf91fc78e92242edf99965abe">fp_area</a>, <span class="keyword">sizeof</span> *fid);
<a name="l01162"></a>01162                 <a class="code" href="group__lu__fid.html#ga6800f90e4de0a0dc60d696ead981623f">fid_be_to_cpu</a>(fid, fid);
<a name="l01163"></a>01163                 <span class="keywordflow">break</span>;
<a name="l01164"></a>01164         <span class="keywordflow">default</span>:
<a name="l01165"></a>01165                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;Unexpected packed fid size: %d\n&quot;</span>, pack-&gt;<a class="code" href="structosd__fid__pack.html#ab19a6b521348a91926cdb0ee27e624d9">fp_len</a>);
<a name="l01166"></a>01166                 result = -EIO;
<a name="l01167"></a>01167         }
<a name="l01168"></a>01168         <span class="keywordflow">return</span> result;
<a name="l01169"></a>01169 }
<a name="l01170"></a>01170 
<a name="l01174"></a>01174 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ae44c2ce6357b0f5ccb5abf0ef60d23ba" title="Quota/Accounting handling.">osd_acct_index_ops</a>;
<a name="l01175"></a>01175 <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a5a5356542d5a8f372a17e54536a33a06" title="Space Accounting Management.">osd_acct_obj_lookup</a>(<span class="keyword">struct</span> <a class="code" href="structosd__thread__info.html">osd_thread_info</a> *info, <span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *osd,
<a name="l01176"></a>01176                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">struct</span> <a class="code" href="structosd__inode__id.html">osd_inode_id</a> *<span class="keywordtype">id</span>);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 <span class="comment">/* copy from fs/ext4/dir.c */</span>
<a name="l01179"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#addcab86c341884db3b096a1ad223121b">01179</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#addcab86c341884db3b096a1ad223121b">is_32bit_api</a>(<span class="keywordtype">void</span>)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181 <span class="preprocessor">#ifdef CONFIG_COMPAT</span>
<a name="l01182"></a>01182 <span class="preprocessor"></span>        <span class="keywordflow">return</span> is_compat_task();
<a name="l01183"></a>01183 <span class="preprocessor">#else</span>
<a name="l01184"></a>01184 <span class="preprocessor"></span>        <span class="keywordflow">return</span> (BITS_PER_LONG == 32);
<a name="l01185"></a>01185 <span class="preprocessor">#endif</span>
<a name="l01186"></a>01186 <span class="preprocessor"></span>}
<a name="l01187"></a>01187 
<a name="l01188"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac4e54ca09ac7b519aadfdb76fdc59b8b">01188</a> <span class="keyword">static</span> <span class="keyword">inline</span> loff_t <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#ac4e54ca09ac7b519aadfdb76fdc59b8b">ldiskfs_get_htree_eof</a>(<span class="keyword">struct</span> file *filp)
<a name="l01189"></a>01189 {
<a name="l01190"></a>01190         <span class="keywordflow">if</span> ((filp-&gt;f_mode &amp; FMODE_32BITHASH) ||
<a name="l01191"></a>01191             (!(filp-&gt;f_mode &amp; FMODE_64BITHASH) &amp;&amp; <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#addcab86c341884db3b096a1ad223121b">is_32bit_api</a>()))
<a name="l01192"></a>01192                 <span class="keywordflow">return</span> LDISKFS_HTREE_EOF_32BIT;
<a name="l01193"></a>01193         <span class="keywordflow">else</span>
<a name="l01194"></a>01194                 <span class="keywordflow">return</span> LDISKFS_HTREE_EOF_64BIT;
<a name="l01195"></a>01195 }
<a name="l01196"></a>01196 
<a name="l01197"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa20d1e22e167521fb8baeaf8023dea19">01197</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#aa20d1e22e167521fb8baeaf8023dea19">fid_is_internal</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid)
<a name="l01198"></a>01198 {
<a name="l01199"></a>01199         <span class="keywordflow">return</span> (!<a class="code" href="group__fid.html#ga30219cc8e3351ed9ef3017c06c42623c">fid_is_namespace_visible</a>(fid) &amp;&amp; !<a class="code" href="group__lu__fid.html#ga83302b8605d68196a1f095f0cff1530f">fid_is_idif</a>(fid));
<a name="l01200"></a>01200 }
<a name="l01201"></a>01201 
<a name="l01202"></a><a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1b8601a317479236b03dfabd20b06d77">01202</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a1b8601a317479236b03dfabd20b06d77">osd_remote_parent_ino</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *dev)
<a name="l01203"></a>01203 {
<a name="l01204"></a>01204         <span class="keywordflow">return</span> dev-&gt;<a class="code" href="structosd__device.html#a93c16c85d933b26e60ddd6e4691110fd">od_mdt_map</a>-&gt;<a class="code" href="structosd__mdobj__map.html#a38cffdba0625ee59514be49f0d7a5af3">omm_remote_parent</a>-&gt;d_inode-&gt;i_ino;
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a4368e7b7c1ced583f56b58dbd21a46e4">ldiskfs_inc_count</a>(handle_t *handle, <span class="keyword">struct</span> inode *inode);
<a name="l01208"></a>01208 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a69cd43cc9afcabe50df9073a786a43f4">ldiskfs_dec_count</a>(handle_t *handle, <span class="keyword">struct</span> inode *inode);
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 <span class="keywordtype">void</span> <a class="code" href="osd-ldiskfs_2osd__internal_8h.html#a89b4aa8e17849e419f6f2620b0ba2843">osd_fini_iobuf</a>(<span class="keyword">struct</span> <a class="code" href="structosd__device.html">osd_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structosd__iobuf.html">osd_iobuf</a> *iobuf);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212 <span class="preprocessor">#endif </span><span class="comment">/* _OSD_INTERNAL_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:41 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
