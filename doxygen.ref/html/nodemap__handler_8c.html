<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ptlrpc/nodemap_handler.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ptlrpc/nodemap_handler.c File Reference</h1><code>#include &lt;linux/module.h&gt;</code><br/>
<code>#include &lt;linux/sort.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="nidstr_8h_source.html">lnet/nidstr.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__acl_8h_source.html">lustre_acl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__eacl_8h_source.html">lustre_eacl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="nodemap__internal_8h_source.html">nodemap_internal.h</a>&quot;</code><br/>

<p><a href="nodemap__handler_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#acaedd960a96becb89b8df8931d37f894">HASH_NODEMAP_BKT_BITS</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ae3842a21d3a6024a67712bd458cffc65">HASH_NODEMAP_CUR_BITS</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ae16b7f9edb00fcf8a10da25f11fbbce2">HASH_NODEMAP_MAX_BITS</a>&nbsp;&nbsp;&nbsp;7</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a61514ad101da71334a225913e73f611d">DEFAULT_NODEMAP</a>&nbsp;&nbsp;&nbsp;&quot;default&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a276fa4dd29dcc94d949095e6aae1969c">DEFINE_MUTEX</a> (<a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a7f512158093bb0ee4e36cf72c414e397">nodemap_destroy</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Nodemap destructor.  <a href="#a7f512158093bb0ee4e36cf72c414e397"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#af08b81d6fbd931cdfdcdf964dc567085">nodemap_getref</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Functions used for the <a class="el" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>.  <a href="#af08b81d6fbd931cdfdcdf964dc567085"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a600304141fbb270f7c8d0ca9767a7e84">nodemap_putref</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy nodemap if last reference is put.  <a href="#a600304141fbb270f7c8d0ca9767a7e84"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static __u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a15f0e09cfc044e3f0483a43830347154">nodemap_hashfn</a> (struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *hash_body, const void *key, unsigned mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a9b21e3ddb10bca8863c64e082c537100">nodemap_hs_key</a> (struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a268d1eda3e75e1cd140d94aaa5cbb381">nodemap_hs_keycmp</a> (const void *key, struct <a class="el" href="structhlist__node.html">hlist_node</a> *compared_hnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a57eef950ba415e240bc50d373251809f">nodemap_hs_hashobject</a> (struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a024dfd237c45205b9c2ac4046c796864">nodemap_hs_get</a> (struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *hs, struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a2d6c5304eaf25f7597f4fca0cf84beba">nodemap_hs_put_locked</a> (struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *hs, struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a688c98b3ad78502ba8d3453757bb3b6c">nodemap_init_hash</a> (struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *nmc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize nodemap_hash.  <a href="#a688c98b3ad78502ba8d3453757bb3b6c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a8de3106de7364176f405b5e075ed867f">nodemap_name_is_valid</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check for valid nodemap name.  <a href="#a8de3106de7364176f405b5e075ed867f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a794d82190df968f31520c2686ae22e09">nodemap_lookup</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Nodemap lookup.  <a href="#a794d82190df968f31520c2686ae22e09"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#adb093ebc228625ee24cc21dae68f03ea">nodemap_classify_nid</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Classify the nid into the proper nodemap.  <a href="#adb093ebc228625ee24cc21dae68f03ea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a43bba38a5fe526ecd34ffe7665be7635">is_default_nodemap</a> (const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">simple check for default nodemap  <a href="#a43bba38a5fe526ecd34ffe7665be7635"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#abf60d3c2b15f390c70871eb41c5b7915">nodemap_parse_range</a> (const char *range_str, <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> range[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parse a nodemap range string into two nids  <a href="#abf60d3c2b15f390c70871eb41c5b7915"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a8d888c7e54f1573605375d9412020002">nodemap_parse_idmap</a> (char *idmap_str, __u32 idmap[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parse a string containing an id map of form "client_id:filesystem_id" into an array of __u32 * for use in mapping functions  <a href="#a8d888c7e54f1573605375d9412020002"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a47600f6aa8cec6c7517c286f442a3ccc">nodemap_add_member</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add a member to a nodemap  <a href="#a47600f6aa8cec6c7517c286f442a3ccc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a287485ca7ffe23967e60587ea9172a17">nodemap_del_member</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete a member from a nodemap  <a href="#a287485ca7ffe23967e60587ea9172a17"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ac1401c6fed16ed26411b3c62b6037288">nodemap_add_idmap_helper</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, const __u32 map[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add an idmap to the proper nodemap trees  <a href="#ac1401c6fed16ed26411b3c62b6037288"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a4b9ae4242c022d02094d35b79c6abe0a">nodemap_add_idmap</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, const __u32 map[2])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a671df76d169ff417bc391b9c98b7edbb">nodemap_del_idmap</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, const __u32 map[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete idmap from proper nodemap tree  <a href="#a671df76d169ff417bc391b9c98b7edbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a6e317ec43236a652b2aa411a93f41d0a">nodemap_map_id</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a> tree_type, __u32 id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mapping function for nodemap idmaps  <a href="#a6e317ec43236a652b2aa411a93f41d0a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a2626cbd2240572f7f193e6d5f5679c98">nodemap_map_acl</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, void *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, size_t <a class="el" href="parallel__grouplock_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a> tree_type)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Map posix ACL entries according to the nodemap membership.  <a href="#a2626cbd2240572f7f193e6d5f5679c98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a8181190eec35f780904bf3b5ced3bf91">nodemap_add_range_helper</a> (struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *config, struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid[2], unsigned int range_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a5d7ea1360bc8ed644a4954ecf3db77ee">nodemap_add_range</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid[2])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a42f8fdd2ca78c999baa5379ff6fc088a">nodemap_del_range</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete a range  <a href="#a42f8fdd2ca78c999baa5379ff6fc088a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a903beb8163477e63bcb0985e5b10da1a">nodemap_create</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *config, bool is_default)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Nodemap constructor.  <a href="#a903beb8163477e63bcb0985e5b10da1a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a76786fe350ace0a50238fb9cf7fe0bfa">nodemap_set_allow_root</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bool allow_root)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update flag to turn on or off nodemap functions  <a href="#a76786fe350ace0a50238fb9cf7fe0bfa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a49d9cc376b64323cc02b52718c5be7ae">nodemap_set_trust_client_ids</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bool trust_client_ids)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">updated trust_client_ids flag for nodemap  <a href="#a49d9cc376b64323cc02b52718c5be7ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a9a818c8be1fcc2c0a967cb95e121b408">nodemap_set_squash_uid</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, uid_t uid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update the squash_uid for a nodemap  <a href="#a9a818c8be1fcc2c0a967cb95e121b408"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a74ee63a335b7bfad432bd42bf7752474">nodemap_set_squash_gid</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, gid_t gid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the squash_gid for a nodemap.  <a href="#a74ee63a335b7bfad432bd42bf7752474"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ac1d8d273ed72879bbc0a0dac99a7e3a0">nodemap_can_setquota</a> (const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if this nodemap has root user access.  <a href="#ac1d8d273ed72879bbc0a0dac99a7e3a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a24a4ef566c505d28d39f8ac1e7c71a6f">nodemap_add</a> (const char *nodemap_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a nodemap.  <a href="#a24a4ef566c505d28d39f8ac1e7c71a6f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#aa0d2b5976e04f7cccba42dc997f82d35">nodemap_del</a> (const char *nodemap_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete a nodemap.  <a href="#aa0d2b5976e04f7cccba42dc997f82d35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ab0b2558102b3a24f1f0ed7b0418c4fad">nodemap_activate</a> (const bool value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">activate nodemap functions  <a href="#ab0b2558102b3a24f1f0ed7b0418c4fad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#aa2d824b4713c83d9f49ed69cbe2a4ba3">nodemap_cleanup_iter_cb</a> (struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *hs, struct <a class="el" href="structcfs__hash__bd.html">cfs_hash_bd</a> *bd, struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode, void *nodemap_list_head)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper iterator to convert nodemap hash to list.  <a href="#aa2d824b4713c83d9f49ed69cbe2a4ba3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a197159b11cd3f49e6dc3b34fecbfb920">nodemap_config_cleanup</a> (struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *config)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Walk the nodemap_hash and remove all nodemaps.  <a href="#a197159b11cd3f49e6dc3b34fecbfb920"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a592eea2f257774a4964f285f004b0e7f">nodemap_config_alloc</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a622e3c23152da6922439e7962f6a3249">nodemap_config_dealloc</a> (struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *config)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#aeb4448599e46869cf88880662b9ef27e">nm_hash_list_cb</a> (struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *hs, struct <a class="el" href="structcfs__hash__bd.html">cfs_hash_bd</a> *bd, struct <a class="el" href="structhlist__node.html">hlist_node</a> *hnode, void *nodemap_list_head)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#ad67ea0971f109c21978997ac088f34ce">nodemap_config_set_active</a> (struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *config)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a0915a54863d7b01cbd456139434f36b1">nodemap_mod_exit</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cleanup nodemap module on exit.  <a href="#a0915a54863d7b01cbd456139434f36b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a4c051f529f1acaf45be38bdf6773336a">nodemap_mod_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the nodemap module.  <a href="#a4c051f529f1acaf45be38bdf6773336a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a2a84da7e27c778a7a189f79960626c92">nm_member_revoke_all</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Revoke locks for all nodemaps.  <a href="#a2a84da7e27c778a7a189f79960626c92"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a3f87655a1d6e03c583dc17ea1bdee4cf">nodemap_test_nid</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, char *name_buf, size_t name_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the nodemap classification for a given nid into an ioctl buffer.  <a href="#a3f87655a1d6e03c583dc17ea1bdee4cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#af1a03250476176ef30b163320dfb21f4">nodemap_test_id</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> idtype, __u32 client_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the id mapping for a given nid/id pair.  <a href="#af1a03250476176ef30b163320dfb21f4"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct proc_dir_entry *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#aef1a5af170ef5a454edc1f4e62460489">proc_lustre_nodemap_root</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a300128a8ec1b35307f6ddd737b09e227">nodemap_active</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a3a725ac0883b4d8827637c0069fc8049">active_config</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structcfs__hash__ops.html">cfs_hash_ops</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="nodemap__handler_8c.html#a9dd400138eabb5188a86ba0dd367c863">nodemap_hash_operations</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a61514ad101da71334a225913e73f611d"></a><!-- doxytag: member="nodemap_handler.c::DEFAULT_NODEMAP" ref="a61514ad101da71334a225913e73f611d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_NODEMAP&nbsp;&nbsp;&nbsp;&quot;default&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00042">42</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01033">nodemap_del()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>.</p>

</div>
</div>
<a class="anchor" id="acaedd960a96becb89b8df8931d37f894"></a><!-- doxytag: member="nodemap_handler.c::HASH_NODEMAP_BKT_BITS" ref="acaedd960a96becb89b8df8931d37f894" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH_NODEMAP_BKT_BITS&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00038">38</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00174">nodemap_init_hash()</a>.</p>

</div>
</div>
<a class="anchor" id="ae3842a21d3a6024a67712bd458cffc65"></a><!-- doxytag: member="nodemap_handler.c::HASH_NODEMAP_CUR_BITS" ref="ae3842a21d3a6024a67712bd458cffc65" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH_NODEMAP_CUR_BITS&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00039">39</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00174">nodemap_init_hash()</a>.</p>

</div>
</div>
<a class="anchor" id="ae16b7f9edb00fcf8a10da25f11fbbce2"></a><!-- doxytag: member="nodemap_handler.c::HASH_NODEMAP_MAX_BITS" ref="ae16b7f9edb00fcf8a10da25f11fbbce2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH_NODEMAP_MAX_BITS&nbsp;&nbsp;&nbsp;7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00040">40</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00174">nodemap_init_hash()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a276fa4dd29dcc94d949095e6aae1969c"></a><!-- doxytag: member="nodemap_handler.c::DEFINE_MUTEX" ref="a276fa4dd29dcc94d949095e6aae1969c" args="(active_config_lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEFINE_MUTEX </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a43bba38a5fe526ecd34ffe7665be7635"></a><!-- doxytag: member="nodemap_handler.c::is_default_nodemap" ref="a43bba38a5fe526ecd34ffe7665be7635" args="(const struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool is_default_nodemap </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>simple check for default nodemap </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00266">266</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre__nodemap_8h_source.html#l00069">lu_nodemap::nm_id</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00416">nodemap_add_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00684">nodemap_add_range()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00455">nodemap_del_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00716">nodemap_del_range()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>.</p>

</div>
</div>
<a class="anchor" id="aeb4448599e46869cf88880662b9ef27e"></a><!-- doxytag: member="nodemap_handler.c::nm_hash_list_cb" ref="aeb4448599e46869cf88880662b9ef27e" args="(struct cfs_hash *hs, struct cfs_hash_bd *bd, struct hlist_node *hnode, void *nodemap_list_head)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nm_hash_list_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *&nbsp;</td>
          <td class="paramname"> <em>hs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash__bd.html">cfs_hash_bd</a> *&nbsp;</td>
          <td class="paramname"> <em>bd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>nodemap_list_head</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01179">1179</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, and <a class="el" href="lustre__nodemap_8h_source.html#l00096">lu_nodemap::nm_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01286">nm_member_revoke_all()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a84da7e27c778a7a189f79960626c92"></a><!-- doxytag: member="nodemap_handler.c::nm_member_revoke_all" ref="a2a84da7e27c778a7a189f79960626c92" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nm_member_revoke_all </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Revoke locks for all nodemaps. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01286">1286</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="hash_8c_source.html#l01519">cfs_hash_for_each_safe()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c.html#a16b50f3e067967583e9d2bc2eeb7ff68">LIST_HEAD()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01179">nm_hash_list_cb()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00096">lu_nodemap::nm_list</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01088">nodemap_activate()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0b2558102b3a24f1f0ed7b0418c4fad"></a><!-- doxytag: member="nodemap_handler.c::nodemap_activate" ref="ab0b2558102b3a24f1f0ed7b0418c4fad" args="(const bool value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_activate </td>
          <td>(</td>
          <td class="paramtype">const bool&nbsp;</td>
          <td class="paramname"> <em>value</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>activate nodemap functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>1 for on, 0 for off </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01088">1088</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l01286">nm_member_revoke_all()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00085">nodemap_config::nmc_nodemap_is_active</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00469">nodemap_idx_nodemap_activate()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00257">nodemap_active_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a24a4ef566c505d28d39f8ac1e7c71a6f"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add" ref="a24a4ef566c505d28d39f8ac1e7c71a6f" args="(const char *nodemap_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nodemap_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>invalid nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EEXIST</em>&nbsp;</td><td>nodemap already exists </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>cannot allocate memory for nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01002">1002</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01165">lprocfs_nodemap_register()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00772">nodemap_create()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00346">nodemap_idx_nodemap_add()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00602">lprocfs_add_nodemap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b9ae4242c022d02094d35b79c6abe0a"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add_idmap" ref="a4b9ae4242c022d02094d35b79c6abe0a" args="(const char *name, enum nodemap_id_type id_type, const __u32 map[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_idmap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u32&nbsp;</td>
          <td class="paramname"> <em>map</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00416">416</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00396">nodemap_add_idmap_helper()</a>, <a class="el" href="nodemap__internal_8h.html#a0cdd9ca432fa5968ba35f232eeeebd32">nodemap_idx_idmap_add()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00845">lprocfs_add_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1401c6fed16ed26411b3c62b6037288"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add_idmap_helper" ref="ac1401c6fed16ed26411b3c62b6037288" args="(struct lu_nodemap *nodemap, enum nodemap_id_type id_type, const __u32 map[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_idmap_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u32&nbsp;</td>
          <td class="paramname"> <em>map</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add an idmap to the proper nodemap trees </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id_type</em>&nbsp;</td><td>NODEMAP_UID or NODEMAP_GID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>map</em>&nbsp;</td><td>array[2] __u32 containing the map values map[0] is client id map[1] is the filesystem id</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00396">396</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00039">idmap_create()</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00078">idmap_insert()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, and <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00416">nodemap_add_idmap()</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00487">nodemap_process_keyrec()</a>.</p>

</div>
</div>
<a class="anchor" id="a47600f6aa8cec6c7517c286f442a3ccc"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add_member" ref="a47600f6aa8cec6c7517c286f442a3ccc" args="(lnet_nid_t nid, struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_member </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add a member to a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to add to the members </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exp</em>&nbsp;</td><td><a class="el" href="structobd__export.html" title="Export structure.">obd_export</a> structure for the connection that is being added </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>export is NULL </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EEXIST</em>&nbsp;</td><td>export is already member of a nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00351">351</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__member_8c_source.html#l00079">nm_member_add()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l05252">mdt_obd_connect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05333">mdt_obd_reconnect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00340">ofd_obd_connect()</a>, and <a class="el" href="ofd__obd_8c_source.html#l00295">ofd_obd_reconnect()</a>.</p>

</div>
</div>
<a class="anchor" id="a5d7ea1360bc8ed644a4954ecf3db77ee"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add_range" ref="a5d7ea1360bc8ed644a4954ecf3db77ee" args="(const char *name, const lnet_nid_t nid[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00684">684</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00644">nodemap_add_range_helper()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00727">lprocfs_add_nodemap_range_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a8181190eec35f780904bf3b5ced3bf91"></a><!-- doxytag: member="nodemap_handler.c::nodemap_add_range_helper" ref="a8181190eec35f780904bf3b5ced3bf91" args="(struct nodemap_config *config, struct lu_nodemap *nodemap, const lnet_nid_t nid[2], unsigned int range_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_range_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>[2], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>range_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00644">644</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00077">lu_nodemap::nm_ranges</a>, <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__storage_8c_source.html#l00405">nodemap_idx_range_add()</a>, <a class="el" href="nodemap__internal_8h.html#a855673db9f6f0e80342081ee228a6594">range_create()</a>, <a class="el" href="nodemap__range_8c_source.html#l00134">range_destroy()</a>, <a class="el" href="nodemap__range_8c_source.html#l00152">range_insert()</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00059">lu_nid_range::rn_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00684">nodemap_add_range()</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00487">nodemap_process_keyrec()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1d8d273ed72879bbc0a0dac99a7e3a0"></a><!-- doxytag: member="nodemap_handler.c::nodemap_can_setquota" ref="ac1d8d273ed72879bbc0a0dac99a7e3a0" args="(const struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool nodemap_can_setquota </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns true if this nodemap has root user access. </p>
<p>Always returns true if nodemaps are not active.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>nodemap to check access for </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00987">987</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l02016">mdt_quotactl()</a>.</p>

</div>
</div>
<a class="anchor" id="adb093ebc228625ee24cc21dae68f03ea"></a><!-- doxytag: member="nodemap_handler.c::nodemap_classify_nid" ref="adb093ebc228625ee24cc21dae68f03ea" args="(lnet_nid_t nid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a>* nodemap_classify_nid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Classify the nid into the proper nodemap. </p>
<p>Caller must hold active config and nm_range_tree_lock, and call nodemap_putref when done with nodemap.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to classify </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>nodemap containing the nid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>default_nodemap</em>&nbsp;</td><td>default nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00247">247</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__handler_8c_source.html#l00092">nodemap_getref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00190">range_search()</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00057">lu_nid_range::rn_nodemap</a>.</p>

<p>Referenced by <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00351">nodemap_add_member()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01339">nodemap_test_id()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01311">nodemap_test_nid()</a>.</p>

</div>
</div>
<a class="anchor" id="aa2d824b4713c83d9f49ed69cbe2a4ba3"></a><!-- doxytag: member="nodemap_handler.c::nodemap_cleanup_iter_cb" ref="aa2d824b4713c83d9f49ed69cbe2a4ba3" args="(struct cfs_hash *hs, struct cfs_hash_bd *bd, struct hlist_node *hnode, void *nodemap_list_head)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nodemap_cleanup_iter_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *&nbsp;</td>
          <td class="paramname"> <em>hs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash__bd.html">cfs_hash_bd</a> *&nbsp;</td>
          <td class="paramname"> <em>bd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>nodemap_list_head</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper iterator to convert nodemap hash to list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hs</em>&nbsp;</td><td>hash structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bd</em>&nbsp;</td><td>bucket descriptor </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hnode</em>&nbsp;</td><td>hash node </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nodemap_list_head</em>&nbsp;</td><td>list head for list of nodemaps in hash </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01109">1109</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="hash_8c_source.html#l00549">cfs_hash_bd_del_locked()</a>, <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, and <a class="el" href="lustre__nodemap_8h_source.html#l00096">lu_nodemap::nm_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01126">nodemap_config_cleanup()</a>.</p>

</div>
</div>
<a class="anchor" id="a592eea2f257774a4964f285f004b0e7f"></a><!-- doxytag: member="nodemap_handler.c::nodemap_config_alloc" ref="a592eea2f257774a4964f285f004b0e7f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structnodemap__config.html">nodemap_config</a>* nodemap_config_alloc </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01153">1153</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00174">nodemap_init_hash()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a197159b11cd3f49e6dc3b34fecbfb920"></a><!-- doxytag: member="nodemap_handler.c::nodemap_config_cleanup" ref="a197159b11cd3f49e6dc3b34fecbfb920" args="(struct nodemap_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_config_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Walk the nodemap_hash and remove all nodemaps. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01126">1126</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="hash_8c_source.html#l01519">cfs_hash_for_each_safe()</a>, <a class="el" href="hash_8c_source.html#l01148">cfs_hash_putref()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c.html#a16b50f3e067967583e9d2bc2eeb7ff68">LIST_HEAD()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00077">lu_nodemap::nm_ranges</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l01109">nodemap_cleanup_iter_cb()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00174">range_delete()</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00059">lu_nid_range::rn_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01173">nodemap_config_dealloc()</a>.</p>

</div>
</div>
<a class="anchor" id="a622e3c23152da6922439e7962f6a3249"></a><!-- doxytag: member="nodemap_handler.c::nodemap_config_dealloc" ref="a622e3c23152da6922439e7962f6a3249" args="(struct nodemap_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_config_dealloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01173">1173</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__handler_8c_source.html#l01126">nodemap_config_cleanup()</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01244">nodemap_mod_exit()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ad67ea0971f109c21978997ac088f34ce"></a><!-- doxytag: member="nodemap_handler.c::nodemap_config_set_active" ref="ad67ea0971f109c21978997ac088f34ce" args="(struct nodemap_config *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_config_set_active </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01190">1190</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="hash_8c_source.html#l01519">cfs_hash_for_each_safe()</a>, <a class="el" href="hash_8c_source.html#l01346">cfs_hash_lookup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c.html#a16b50f3e067967583e9d2bc2eeb7ff68">LIST_HEAD()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01165">lprocfs_nodemap_register()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01179">nm_hash_list_cb()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00096">lu_nodemap::nm_list</a>, <a class="el" href="nodemap__handler_8c_source.html#l01286">nm_member_revoke_all()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00093">lu_nodemap::nm_pde_data</a>, <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, <a class="el" href="nodemap__internal_8h_source.html#l00085">nodemap_config::nmc_nodemap_is_active</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, <a class="el" href="nodemap__handler_8c_source.html#l01173">nodemap_config_dealloc()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a903beb8163477e63bcb0985e5b10da1a"></a><!-- doxytag: member="nodemap_handler.c::nodemap_create" ref="a903beb8163477e63bcb0985e5b10da1a" args="(const char *name, struct nodemap_config *config, bool is_default)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a>* nodemap_create </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>is_default</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Nodemap constructor. </p>
<p>Creates an <a class="el" href="structlu__nodemap.html" title="The nodemap id 0 will be the default nodemap.">lu_nodemap</a> structure and assigns sane default member values. If this is the default nodemap, the defaults are the most restictive in xterms of mapping behavior. Otherwise the default flags should be inherited from the default nodemap. The adds nodemap to nodemap_hash.</p>
<p>Requires that the caller take the active_config_lock</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>is_default</em>&nbsp;</td><td>true if default nodemap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>invalid nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EEXIST</em>&nbsp;</td><td>nodemap already exists </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>cannot allocate memory for nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00772">772</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="hash_8c_source.html#l01259">cfs_hash_add_unique()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00034">LUSTRE_NODEMAP_DEFAULT_ID</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00087">lu_nodemap::nm_client_to_fs_gidmap</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00083">lu_nodemap::nm_client_to_fs_uidmap</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00085">lu_nodemap::nm_fs_to_client_gidmap</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00081">lu_nodemap::nm_fs_to_client_uidmap</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00069">lu_nodemap::nm_id</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00096">lu_nodemap::nm_list</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00090">lu_nodemap::nm_member_list</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00089">lu_nodemap::nm_member_list_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00077">lu_nodemap::nm_ranges</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00071">lu_nodemap::nm_refcount</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, <a class="el" href="nodemap__internal_8h_source.html#l00082">nodemap_config::nmc_nodemap_highest_id</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_trust_client_ids</a>, <a class="el" href="nodemap__handler_8c_source.html#l00200">nodemap_name_is_valid()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00041">NODEMAP_NOBODY_GID</a>, <a class="el" href="nodemap__internal_8h_source.html#l00040">NODEMAP_NOBODY_UID</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01002">nodemap_add()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00487">nodemap_process_keyrec()</a>.</p>

</div>
</div>
<a class="anchor" id="aa0d2b5976e04f7cccba42dc997f82d35"></a><!-- doxytag: member="nodemap_handler.c::nodemap_del" ref="aa0d2b5976e04f7cccba42dc997f82d35" args="(const char *nodemap_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nodemap_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemmap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>invalid input </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOENT</em>&nbsp;</td><td>no existing nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01033">1033</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="hash_8c_source.html#l01331">cfs_hash_del_key()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00042">DEFAULT_NODEMAP</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01151">lprocfs_nodemap_remove()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00093">lu_nodemap::nm_pde_data</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00077">lu_nodemap::nm_ranges</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__storage_8c_source.html#l00356">nodemap_idx_nodemap_del()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00418">nodemap_idx_range_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00174">range_delete()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00059">lu_nid_range::rn_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00645">lprocfs_del_nodemap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a671df76d169ff417bc391b9c98b7edbb"></a><!-- doxytag: member="nodemap_handler.c::nodemap_del_idmap" ref="a671df76d169ff417bc391b9c98b7edbb" args="(const char *name, enum nodemap_id_type id_type, const __u32 map[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del_idmap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u32&nbsp;</td>
          <td class="paramname"> <em>map</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete idmap from proper nodemap tree </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id_type</em>&nbsp;</td><td>NODEMAP_UID or NODEMAP_GID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>map</em>&nbsp;</td><td>array[2] __u32 containing the mapA values map[0] is client id map[1] is the filesystem id</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00455">455</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00164">idmap_delete()</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00196">idmap_search()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00048">NODEMAP_CLIENT_TO_FS</a>, <a class="el" href="nodemap__internal_8h.html#a87acb847dc6412ec3dd8af5e2cfbbe93">nodemap_idx_idmap_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00914">lprocfs_del_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a287485ca7ffe23967e60587ea9172a17"></a><!-- doxytag: member="nodemap_handler.c::nodemap_del_member" ref="a287485ca7ffe23967e60587ea9172a17" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_del_member </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete a member from a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>exp</em>&nbsp;</td><td>export to remove from a nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00376">376</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__member_8c_source.html#l00041">nm_member_del()</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l05252">mdt_obd_connect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05225">mdt_obd_disconnect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05333">mdt_obd_reconnect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00340">ofd_obd_connect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00411">ofd_obd_disconnect()</a>, and <a class="el" href="ofd__obd_8c_source.html#l00295">ofd_obd_reconnect()</a>.</p>

</div>
</div>
<a class="anchor" id="a42f8fdd2ca78c999baa5379ff6fc088a"></a><!-- doxytag: member="nodemap_handler.c::nodemap_del_range" ref="a42f8fdd2ca78c999baa5379ff6fc088a" args="(const char *name, const lnet_nid_t nid[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete a range </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>range_str</em>&nbsp;</td><td>string containing range </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Delete range from global range tree, and remove it from the list in the associated nodemap. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00716">716</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__storage_8c_source.html#l00418">nodemap_idx_range_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00174">range_delete()</a>, and <a class="el" href="nodemap__range_8c_source.html#l00112">range_find()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00786">lprocfs_del_nodemap_range_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f512158093bb0ee4e36cf72c414e397"></a><!-- doxytag: member="nodemap_handler.c::nodemap_destroy" ref="a7f512158093bb0ee4e36cf72c414e397" args="(struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nodemap_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Nodemap destructor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>nodemap to destroy </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00062">62</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00251">idmap_delete_tree()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01151">lprocfs_nodemap_remove()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="nodemap__member_8c_source.html#l00056">nm_member_delete_list()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00090">lu_nodemap::nm_member_list</a>, <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00093">lu_nodemap::nm_pde_data</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

</div>
</div>
<a class="anchor" id="af08b81d6fbd931cdfdcdf964dc567085"></a><!-- doxytag: member="nodemap_handler.c::nodemap_getref" ref="af08b81d6fbd931cdfdcdf964dc567085" args="(struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nodemap_getref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Functions used for the <a class="el" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00092">92</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre__nodemap_8h_source.html#l00071">lu_nodemap::nm_refcount</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00140">nodemap_hs_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a15f0e09cfc044e3f0483a43830347154"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hashfn" ref="a15f0e09cfc044e3f0483a43830347154" args="(struct cfs_hash *hash_body, const void *key, unsigned mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static __u32 nodemap_hashfn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *&nbsp;</td>
          <td class="paramname"> <em>hash_body</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00110">110</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="libcfs__hash_8h_source.html#l00813">cfs_hash_djb2_hash()</a>.</p>

</div>
</div>
<a class="anchor" id="a024dfd237c45205b9c2ac4046c796864"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hs_get" ref="a024dfd237c45205b9c2ac4046c796864" args="(struct cfs_hash *hs, struct hlist_node *hnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nodemap_hs_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *&nbsp;</td>
          <td class="paramname"> <em>hs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00140">140</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00092">nodemap_getref()</a>.</p>

</div>
</div>
<a class="anchor" id="a57eef950ba415e240bc50d373251809f"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hs_hashobject" ref="a57eef950ba415e240bc50d373251809f" args="(struct hlist_node *hnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* nodemap_hs_hashobject </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00135">135</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, and <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>.</p>

</div>
</div>
<a class="anchor" id="a9b21e3ddb10bca8863c64e082c537100"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hs_key" ref="a9b21e3ddb10bca8863c64e082c537100" args="(struct hlist_node *hnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* nodemap_hs_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00116">116</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, and <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00125">nodemap_hs_keycmp()</a>.</p>

</div>
</div>
<a class="anchor" id="a268d1eda3e75e1cd140d94aaa5cbb381"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hs_keycmp" ref="a268d1eda3e75e1cd140d94aaa5cbb381" args="(const void *key, struct hlist_node *compared_hnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nodemap_hs_keycmp </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>compared_hnode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00125">125</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__handler_8c_source.html#l00116">nodemap_hs_key()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d6c5304eaf25f7597f4fca0cf84beba"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hs_put_locked" ref="a2d6c5304eaf25f7597f4fca0cf84beba" args="(struct cfs_hash *hs, struct hlist_node *hnode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void nodemap_hs_put_locked </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcfs__hash.html">cfs_hash</a> *&nbsp;</td>
          <td class="paramname"> <em>hs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhlist__node.html">hlist_node</a> *&nbsp;</td>
          <td class="paramname"> <em>hnode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00148">148</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00382">hlist_entry</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00092">lu_nodemap::nm_hash</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

</div>
</div>
<a class="anchor" id="a688c98b3ad78502ba8d3453757bb3b6c"></a><!-- doxytag: member="nodemap_handler.c::nodemap_init_hash" ref="a688c98b3ad78502ba8d3453757bb3b6c" args="(struct nodemap_config *nmc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int nodemap_init_hash </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnodemap__config.html">nodemap_config</a> *&nbsp;</td>
          <td class="paramname"> <em>nmc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize nodemap_hash. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>cannot create hash </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00174">174</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="hash_8c_source.html#l01003">cfs_hash_create()</a>, <a class="el" href="libcfs__hash_8h_source.html#l00165">CFS_HASH_DEFAULT</a>, <a class="el" href="libcfs__hash_8h_source.html#l00775">CFS_HASH_MAX_THETA</a>, <a class="el" href="libcfs__hash_8h_source.html#l00774">CFS_HASH_MIN_THETA</a>, <a class="el" href="nodemap__handler_8c_source.html#l00038">HASH_NODEMAP_BKT_BITS</a>, <a class="el" href="nodemap__handler_8c_source.html#l00039">HASH_NODEMAP_CUR_BITS</a>, <a class="el" href="nodemap__handler_8c_source.html#l00040">HASH_NODEMAP_MAX_BITS</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01153">nodemap_config_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="a794d82190df968f31520c2686ae22e09"></a><!-- doxytag: member="nodemap_handler.c::nodemap_lookup" ref="a794d82190df968f31520c2686ae22e09" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a>* nodemap_lookup </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Nodemap lookup. </p>
<p>Look nodemap up in the active_config nodemap hash. Caller should hold the active_config_lock.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>pointer set to found nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>name is not valid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOENT</em>&nbsp;</td><td>nodemap not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00225">225</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="hash_8c_source.html#l01346">cfs_hash_lookup()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00200">nodemap_name_is_valid()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00416">nodemap_add_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00684">nodemap_add_range()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00397">nodemap_admin_seq_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00455">nodemap_del_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00716">nodemap_del_range()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00183">nodemap_exports_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00291">nodemap_id_seq_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00055">nodemap_idmap_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00123">nodemap_ranges_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00864">nodemap_set_allow_root()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00960">nodemap_set_squash_gid()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00927">nodemap_set_squash_uid()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00894">nodemap_set_trust_client_ids()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00344">nodemap_squash_gid_seq_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00318">nodemap_squash_uid_seq_show()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00370">nodemap_trusted_seq_show()</a>.</p>

</div>
</div>
<a class="anchor" id="a2626cbd2240572f7f193e6d5f5679c98"></a><!-- doxytag: member="nodemap_handler.c::nodemap_map_acl" ref="a2626cbd2240572f7f193e6d5f5679c98" args="(struct lu_nodemap *nodemap, void *buf, size_t size, enum nodemap_tree_type tree_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t nodemap_map_acl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a>&nbsp;</td>
          <td class="paramname"> <em>tree_type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Map posix ACL entries according to the nodemap membership. </p>
<p>Removes any squashed ACLs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structlu__nodemap.html" title="The nodemap id 0 will be the default nodemap.">lu_nodemap</a></em>&nbsp;</td><td>nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer containing xattr encoded ACLs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>size of ACLs in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tree_type</em>&nbsp;</td><td>direction of mapping </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>new size of ACLs in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>bad <em>size</em> param, see posix_acl_xattr_count() </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00580">580</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01851">posix_acl_xattr_header::a_entries</a>, <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01846">posix_acl_xattr_entry::e_id</a>, <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01844">posix_acl_xattr_entry::e_tag</a>, <a class="el" href="mdsrate_8c_source.html#l00132">end</a>, <a class="el" href="it__test_8c_source.html#l00070">header</a>, <a class="el" href="byteorder_8h_source.html#l00054">le16_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00043">NODEMAP_GID</a>, <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00042">NODEMAP_UID</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="mdt__xattr_8c_source.html#l00363">mdt_reint_setxattr()</a>.</p>

</div>
</div>
<a class="anchor" id="a6e317ec43236a652b2aa411a93f41d0a"></a><!-- doxytag: member="nodemap_handler.c::nodemap_map_id" ref="a6e317ec43236a652b2aa411a93f41d0a" args="(struct lu_nodemap *nodemap, enum nodemap_id_type id_type, enum nodemap_tree_type tree_type, __u32 id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u32 nodemap_map_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a>&nbsp;</td>
          <td class="paramname"> <em>tree_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mapping function for nodemap idmaps </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td><a class="el" href="structlu__nodemap.html" title="The nodemap id 0 will be the default nodemap.">lu_nodemap</a> structure defining nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>node_type</em>&nbsp;</td><td>NODEMAP_UID or NODEMAP_GID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tree_type</em>&nbsp;</td><td>NODEMAP_CLIENT_TO_FS or NODEMAP_FS_TO_CLIENT </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>id to map</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mapped</em>&nbsp;</td><td>id according to the rules below.</td></tr>
  </table>
  </dd>
</dl>
<p>if the nodemap_active is false, just return the passed id without mapping</p>
<p>if the id to be looked up is 0, check that root access is allowed and if it is, return 0. Otherwise, return the squash uid or gid.</p>
<p>if the nodemap is configured to trusted the ids from the client system, just return the passwd id without mapping.</p>
<p>if by this point, we haven't returned and the nodemap in question is the default nodemap, return the squash uid or gid.</p>
<p>after these checks, search the proper tree for the mapping, and if found return the mapped value, otherwise return the squash uid or gid. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00519">519</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h_source.html#l00066">lu_idmap::id_client</a>, <a class="el" href="nodemap__internal_8h_source.html#l00068">lu_idmap::id_fs</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00196">idmap_search()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_trust_client_ids</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00047">NODEMAP_FS_TO_CLIENT</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00042">NODEMAP_UID</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l00501">mdt_pack_attr2body()</a>, <a class="el" href="mdt__handler_8c_source.html#l02016">mdt_quotactl()</a>, <a class="el" href="mdt__lib_8c_source.html#l00909">mdt_setattr_unpack_rec()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00580">nodemap_map_acl()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01339">nodemap_test_id()</a>, <a class="el" href="ofd__dev_8c_source.html#l02210">ofd_quotactl()</a>, <a class="el" href="mdt__lib_8c_source.html#l00518">old_init_ucred()</a>, <a class="el" href="mdt__lib_8c_source.html#l00552">old_init_ucred_reint()</a>, and <a class="el" href="tgt__handler_8c_source.html#l00241">tgt_ost_body_unpack()</a>.</p>

</div>
</div>
<a class="anchor" id="a0915a54863d7b01cbd456139434f36b1"></a><!-- doxytag: member="nodemap_handler.c::nodemap_mod_exit" ref="a0915a54863d7b01cbd456139434f36b1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_mod_exit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cleanup nodemap module on exit. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01244">1244</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__handler_8c_source.html#l01173">nodemap_config_dealloc()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l01135">nodemap_procfs_exit()</a>.</p>

<p>Referenced by <a class="el" href="ptlrpc__module_8c_source.html#l00138">ptlrpc_exit()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c051f529f1acaf45be38bdf6773336a"></a><!-- doxytag: member="nodemap_handler.c::nodemap_mod_init" ref="a4c051f529f1acaf45be38bdf6773336a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_mod_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the nodemap module. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01253">1253</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__handler_8c_source.html#l00042">DEFAULT_NODEMAP</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l01153">nodemap_config_alloc()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01173">nodemap_config_dealloc()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00772">nodemap_create()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01135">nodemap_procfs_exit()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01115">nodemap_procfs_init()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="ptlrpc__module_8c_source.html#l00052">ptlrpc_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a8de3106de7364176f405b5e075ed867f"></a><!-- doxytag: member="nodemap_handler.c::nodemap_name_is_valid" ref="a8de3106de7364176f405b5e075ed867f" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool nodemap_name_is_valid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check for valid nodemap name. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>valid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>invalid </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00200">200</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l04051">LUSTRE_NODEMAP_NAME_LENGTH</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00772">nodemap_create()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>.</p>

</div>
</div>
<a class="anchor" id="a8d888c7e54f1573605375d9412020002"></a><!-- doxytag: member="nodemap_handler.c::nodemap_parse_idmap" ref="a8d888c7e54f1573605375d9412020002" args="(char *idmap_str, __u32 idmap[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_parse_idmap </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>idmap_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>idmap</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parse a string containing an id map of form "client_id:filesystem_id" into an array of __u32 * for use in mapping functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>idmap_str</em>&nbsp;</td><td>map string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idmap</em>&nbsp;</td><td>array[2] of __u32</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if idmap cannot be parsed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00313">313</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="linux-misc_8h_source.html#l00049">kstrtoul()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00845">lprocfs_add_nodemap_idmap_seq_write()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00914">lprocfs_del_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="abf60d3c2b15f390c70871eb41c5b7915"></a><!-- doxytag: member="nodemap_handler.c::nodemap_parse_range" ref="abf60d3c2b15f390c70871eb41c5b7915" args="(const char *range_str, lnet_nid_t range[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_parse_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>range_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>range</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parse a nodemap range string into two nids </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>range_str</em>&nbsp;</td><td>string to parse </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>range[2]</em>&nbsp;</td><td>array of two nids  0 on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00278">278</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lnet_2lnet_2nidstrings_8c_source.html#l01210">libcfs_str2nid()</a>, and <a class="el" href="nidstr_8h_source.html#l00057">LNET_NIDSTR_SIZE</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00686">parse_nids()</a>.</p>

</div>
</div>
<a class="anchor" id="a600304141fbb270f7c8d0ca9767a7e84"></a><!-- doxytag: member="nodemap_handler.c::nodemap_putref" ref="a600304141fbb270f7c8d0ca9767a7e84" args="(struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_putref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy nodemap if last reference is put. </p>
<p>Should be called outside active_config_lock </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00101">101</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00071">lu_nodemap::nm_refcount</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00062">nodemap_destroy()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01002">nodemap_add()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00416">nodemap_add_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00351">nodemap_add_member()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00684">nodemap_add_range()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00397">nodemap_admin_seq_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01126">nodemap_config_cleanup()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01033">nodemap_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00455">nodemap_del_idmap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00716">nodemap_del_range()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00183">nodemap_exports_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00148">nodemap_hs_put_locked()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00291">nodemap_id_seq_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00055">nodemap_idmap_show()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01253">nodemap_mod_init()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00487">nodemap_process_keyrec()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00123">nodemap_ranges_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00864">nodemap_set_allow_root()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00960">nodemap_set_squash_gid()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00927">nodemap_set_squash_uid()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00894">nodemap_set_trust_client_ids()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00344">nodemap_squash_gid_seq_show()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00318">nodemap_squash_uid_seq_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01339">nodemap_test_id()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01311">nodemap_test_nid()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00370">nodemap_trusted_seq_show()</a>.</p>

</div>
</div>
<a class="anchor" id="a76786fe350ace0a50238fb9cf7fe0bfa"></a><!-- doxytag: member="nodemap_handler.c::nodemap_set_allow_root" ref="a76786fe350ace0a50238fb9cf7fe0bfa" args="(const char *name, bool allow_root)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_allow_root </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>allow_root</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update flag to turn on or off nodemap functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>admin_string</em>&nbsp;</td><td>string containing updated value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update admin flag to turn on or off nodemap functions. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00864">864</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00573">nodemap_admin_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a74ee63a335b7bfad432bd42bf7752474"></a><!-- doxytag: member="nodemap_handler.c::nodemap_set_squash_gid" ref="a74ee63a335b7bfad432bd42bf7752474" args="(const char *name, gid_t gid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_squash_gid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gid_t&nbsp;</td>
          <td class="paramname"> <em>gid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the squash_gid for a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gid_string</em>&nbsp;</td><td>string containing new squash_gid value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the squash_gid for a nodemap. The squash_uid is the gid that the all client gids are mapped to if nodemap is active, the trust_client_ids flag is not set, and the gid is not in the idmap tree. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00960">960</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00504">nodemap_squash_gid_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a9a818c8be1fcc2c0a967cb95e121b408"></a><!-- doxytag: member="nodemap_handler.c::nodemap_set_squash_uid" ref="a9a818c8be1fcc2c0a967cb95e121b408" args="(const char *name, uid_t uid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_squash_uid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uid_t&nbsp;</td>
          <td class="paramname"> <em>uid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update the squash_uid for a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uid_string</em>&nbsp;</td><td>string containing new squash_uid value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the squash_uid for a nodemap. The squash_uid is the uid that the all client uids are mapped to if nodemap is active, the trust_client_ids flag is not set, and the uid is not in the idmap tree. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00927">927</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00464">nodemap_squash_uid_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a49d9cc376b64323cc02b52718c5be7ae"></a><!-- doxytag: member="nodemap_handler.c::nodemap_set_trust_client_ids" ref="a49d9cc376b64323cc02b52718c5be7ae" args="(const char *name, bool trust_client_ids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_trust_client_ids </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>trust_client_ids</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updated trust_client_ids flag for nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trust_string</em>&nbsp;</td><td>new value for trust flag </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the trust_client_ids flag for a nodemap. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00894">894</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_trust_client_ids</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00544">nodemap_trusted_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="af1a03250476176ef30b163320dfb21f4"></a><!-- doxytag: member="nodemap_handler.c::nodemap_test_id" ref="af1a03250476176ef30b163320dfb21f4" args="(lnet_nid_t nid, enum nodemap_id_type idtype, __u32 client_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u32 nodemap_test_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>idtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>client_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the id mapping for a given nid/id pair. </p>
<p>Useful for testing the nodemap configuration to make sure it is working as expected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to classify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idtype</em>&nbsp;</td><td>uid or gid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>client_id</em>&nbsp;</td><td>id to map to fs</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>mapped fs_id of the given client_id </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01339">1339</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00048">NODEMAP_CLIENT_TO_FS</a>, <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>.</p>

</div>
</div>
<a class="anchor" id="a3f87655a1d6e03c583dc17ea1bdee4cf"></a><!-- doxytag: member="nodemap_handler.c::nodemap_test_nid" ref="a3f87655a1d6e03c583dc17ea1bdee4cf" args="(lnet_nid_t nid, char *name_buf, size_t name_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_test_nid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>name_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the nodemap classification for a given nid into an ioctl buffer. </p>
<p>Useful for testing the nodemap configuration to make sure it is working as expected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to classify </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>name_buf</em>&nbsp;</td><td>buffer to write the nodemap name to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name_len</em>&nbsp;</td><td>length of buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01311">1311</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a3a725ac0883b4d8827637c0069fc8049"></a><!-- doxytag: member="nodemap_handler.c::active_config" ref="a3a725ac0883b4d8827637c0069fc8049" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structnodemap__config.html">nodemap_config</a>* <a class="el" href="nodemap__internal_8h.html#a3a725ac0883b4d8827637c0069fc8049">active_config</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00055">55</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00123">nodemap_ranges_show()</a>.</p>

</div>
</div>
<a class="anchor" id="a300128a8ec1b35307f6ddd737b09e227"></a><!-- doxytag: member="nodemap_handler.c::nodemap_active" ref="a300128a8ec1b35307f6ddd737b09e227" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="nodemap__internal_8h.html#a300128a8ec1b35307f6ddd737b09e227">nodemap_active</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00048">48</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l01088">nodemap_activate()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00240">nodemap_active_seq_show()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00987">nodemap_can_setquota()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01190">nodemap_config_set_active()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00580">nodemap_map_acl()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>.</p>

</div>
</div>
<a class="anchor" id="a9dd400138eabb5188a86ba0dd367c863"></a><!-- doxytag: member="nodemap_handler.c::nodemap_hash_operations" ref="a9dd400138eabb5188a86ba0dd367c863" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcfs__hash__ops.html">cfs_hash_ops</a> <a class="el" href="nodemap__handler_8c.html#a9dd400138eabb5188a86ba0dd367c863">nodemap_hash_operations</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .hs_hash        = <a class="code" href="nodemap__handler_8c.html#a15f0e09cfc044e3f0483a43830347154">nodemap_hashfn</a>,
        .hs_key         = <a class="code" href="nodemap__handler_8c.html#a9b21e3ddb10bca8863c64e082c537100">nodemap_hs_key</a>,
        .hs_keycmp      = <a class="code" href="nodemap__handler_8c.html#a268d1eda3e75e1cd140d94aaa5cbb381">nodemap_hs_keycmp</a>,
        .hs_object      = <a class="code" href="nodemap__handler_8c.html#a57eef950ba415e240bc50d373251809f">nodemap_hs_hashobject</a>,
        .hs_get         = <a class="code" href="nodemap__handler_8c.html#a024dfd237c45205b9c2ac4046c796864">nodemap_hs_get</a>,
        .hs_put_locked  = <a class="code" href="nodemap__handler_8c.html#a2d6c5304eaf25f7597f4fca0cf84beba">nodemap_hs_put_locked</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00157">157</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

</div>
</div>
<a class="anchor" id="aef1a5af170ef5a454edc1f4e62460489"></a><!-- doxytag: member="nodemap_handler.c::proc_lustre_nodemap_root" ref="aef1a5af170ef5a454edc1f4e62460489" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct proc_dir_entry* <a class="el" href="nodemap__internal_8h.html#aef1a5af170ef5a454edc1f4e62460489">proc_lustre_nodemap_root</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00045">45</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l01165">lprocfs_nodemap_register()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01135">nodemap_procfs_exit()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l01115">nodemap_procfs_init()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
