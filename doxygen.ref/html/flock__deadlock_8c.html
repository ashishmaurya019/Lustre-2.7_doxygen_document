<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/tests/flock_deadlock.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/tests/flock_deadlock.c File Reference</h1><code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;sys/file.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="string_8h_source.html">string.h</a>&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/wait.h&gt;</code><br/>
<code>#include &lt;sys/sem.h&gt;</code><br/>
<code>#include &lt;semaphore.h&gt;</code><br/>
<code>#include &lt;sys/mman.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>

<p><a href="flock__deadlock_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="flock__deadlock_8c.html#a8e9da6277d8d36c9177075b58613f5c9">LOCK_LEN</a>&nbsp;&nbsp;&nbsp;100</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="flock__deadlock_8c.html#a57399441346c059418ee0485b10eec21">flock_call</a>(fd, num, get, label)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="flock__deadlock_8c.html#a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d">FLOCK_GET</a> =  0, 
<a class="el" href="flock__deadlock_8c.html#a337d6b8d9f9cc2b4d207e433a70d3987a4b229bfb9e93f3b40a818b6274b8b723">FLOCK_PUT</a> =  1
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="flock__deadlock_8c.html#aeb8ceb8e5df9e94eabac7103a66e8968">catch_alarm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="flock__deadlock_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct flock&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a> [4]</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a57399441346c059418ee0485b10eec21"></a><!-- doxytag: member="flock_deadlock.c::flock_call" ref="a57399441346c059418ee0485b10eec21" args="(fd, num, get, label)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define flock_call</td>
          <td>(</td>
          <td class="paramtype">fd, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">num, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">get, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">label&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><a class="code" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[num].l_type = <span class="keyword">get</span> == <a class="code" href="flock__deadlock_8c.html#a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d">FLOCK_GET</a> ? F_WRLCK : F_UNLCK;              \
        printf(<span class="stringliteral">&quot;%d: %s lock%d [%llu, %llu]\n&quot;</span>, pid,                             \
                <span class="keyword">get</span> == <a class="code" href="flock__deadlock_8c.html#a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d">FLOCK_GET</a> ? <span class="stringliteral">&quot;taking&quot;</span> : <span class="stringliteral">&quot;putting&quot;</span>,                        \
                num, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)<a class="code" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[num].l_start,                   \
                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)<a class="code" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[num].l_start + <a class="code" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[num].l_len);   \
        rc = fcntl(fd, F_SETLKW, &amp;<a class="code" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[num]);                                 \
        <span class="keywordflow">if</span> (rc &lt; 0) {                                                           \
                rc = errno;                                                     \
                fprintf(stderr, <span class="stringliteral">&quot;%d: failed to %s lock%d, %s\n&quot;</span>,                \
                        pid, <span class="keyword">get</span> == <a class="code" href="flock__deadlock_8c.html#a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d">FLOCK_GET</a> ? <span class="stringliteral">&quot;take&quot;</span> : <span class="stringliteral">&quot;put&quot;</span>,                 \
                        num, strerror(errno));                                  \
                <span class="keywordflow">goto</span> label;                                                     \
        } <span class="keywordflow">else</span> {                                                                \
                printf(<span class="stringliteral">&quot;%d: done\n&quot;</span>, pid);                                      \
        }
</pre></div>
<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00088">88</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

<p>Referenced by <a class="el" href="flock__deadlock_8c_source.html#l00111">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a8e9da6277d8d36c9177075b58613f5c9"></a><!-- doxytag: member="flock_deadlock.c::LOCK_LEN" ref="a8e9da6277d8d36c9177075b58613f5c9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCK_LEN&nbsp;&nbsp;&nbsp;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00046">46</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a337d6b8d9f9cc2b4d207e433a70d3987"></a><!-- doxytag: member="flock_deadlock.c::@187" ref="a337d6b8d9f9cc2b4d207e433a70d3987" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d"></a><!-- doxytag: member="FLOCK_GET" ref="a337d6b8d9f9cc2b4d207e433a70d3987ade86d7b6c994671e95906064d5c1b60d" args="" -->FLOCK_GET</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a337d6b8d9f9cc2b4d207e433a70d3987a4b229bfb9e93f3b40a818b6274b8b723"></a><!-- doxytag: member="FLOCK_PUT" ref="a337d6b8d9f9cc2b4d207e433a70d3987a4b229bfb9e93f3b40a818b6274b8b723" args="" -->FLOCK_PUT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00083">83</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aeb8ceb8e5df9e94eabac7103a66e8968"></a><!-- doxytag: member="flock_deadlock.c::catch_alarm" ref="aeb8ceb8e5df9e94eabac7103a66e8968" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void catch_alarm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00105">105</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

<p>Referenced by <a class="el" href="write__time__limit_8c_source.html#l00056">catch_alarm()</a>, and <a class="el" href="flock__deadlock_8c_source.html#l00111">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="flock_deadlock.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00111">111</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

<p>References <a class="el" href="flock__deadlock_8c_source.html#l00105">catch_alarm()</a>, <a class="el" href="flock__deadlock_8c_source.html#l00088">flock_call</a>, <a class="el" href="flock__deadlock_8c_source.html#l00084">FLOCK_GET</a>, <a class="el" href="flock__deadlock_8c_source.html#l00085">FLOCK_PUT</a>, <a class="el" href="flock__deadlock_8c_source.html#l00048">flocks</a>, and <a class="el" href="lustre__rsync_8c_source.html#l00187">status</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="af7c7f69fd1a689c428f50bcc58faa2a4"></a><!-- doxytag: member="flock_deadlock.c::flocks" ref="af7c7f69fd1a689c428f50bcc58faa2a4" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct flock <a class="el" href="flock__deadlock_8c.html#af7c7f69fd1a689c428f50bcc58faa2a4">flocks</a>[4]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="flock__deadlock_8c_source.html#l00048">48</a> of file <a class="el" href="flock__deadlock_8c_source.html">flock_deadlock.c</a>.</p>

<p>Referenced by <a class="el" href="flock__deadlock_8c_source.html#l00111">main()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:51 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
