<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ofd/ofd_io.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ofd/ofd_io.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ofd__internal_8h_source.html">ofd_internal.h</a>&quot;</code><br/>

<p><a href="ofd__io_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structofd__inconsistency__item.html">ofd_inconsistency_item</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structofd__soft__sync__callback.html">ofd_soft_sync_callback</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_FILTER</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#afa27e093a5a326db739d808572f4439d">ofd_inconsistency_verify_one</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, struct <a class="el" href="structofd__inconsistency__item.html">ofd_inconsistency_item</a> *oii, struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *lr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify single object for parent FID consistency.  <a href="#afa27e093a5a326db739d808572f4439d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#ae73678766b398ab02bc2d2cc9fbe0d90">ofd_inconsistency_verification_main</a> (void *args)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verification thread to check parent FID consistency.  <a href="#ae73678766b398ab02bc2d2cc9fbe0d90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#abad8e9cb4f2bf23b5f26f3fa2064d164">ofd_start_inconsistency_verification_thread</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start parent FID verification thread.  <a href="#abad8e9cb4f2bf23b5f26f3fa2064d164"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a0aca95140be0eaf4b18bac3e2db396da">ofd_stop_inconsistency_verification_thread</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop parent FID verification thread.  <a href="#a0aca95140be0eaf4b18bac3e2db396da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a37c4c4a55c3a4818e21de32d263a48ed">ofd_add_inconsistency_item</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, struct <a class="el" href="structobdo.html">obdo</a> *oa)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add new item for parent FID verification.  <a href="#a37c4c4a55c3a4818e21de32d263a48ed"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#aea6c312b1e6a241a81a51050dffb8bc5">ofd_verify_ff</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__object.html">ofd_object</a> *fo, struct <a class="el" href="structobdo.html">obdo</a> *oa)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify parent FID of an object.  <a href="#aea6c312b1e6a241a81a51050dffb8bc5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a509e4729fb1bf03d8c4a1aed45d7ee2d">ofd_preprw_read</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structobdo.html">obdo</a> *oa, int niocount, struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *rnb, int *nr_local, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb, char *jobid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare buffers for read request processing.  <a href="#a509e4729fb1bf03d8c4a1aed45d7ee2d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a3e2417f451915f575c2003ec5cad7800">ofd_preprw_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structobdo.html">obdo</a> *oa, int objcount, struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *obj, struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *rnb, int *nr_local, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb, char *jobid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare buffers for write request processing.  <a href="#a3e2417f451915f575c2003ec5cad7800"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a5e1b48d7cdf4e6ccdc5f00ba323f1ddb">ofd_preprw</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, int <a class="el" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structobdo.html">obdo</a> *oa, int objcount, struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *obj, struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *rnb, int *nr_local, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare bulk IO requests for processing.  <a href="#a5e1b48d7cdf4e6ccdc5f00ba323f1ddb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a726260e44939ea9ba9f68887cde3cdfe">ofd_commitrw_read</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, int objcount, int niocount, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Drop reference on local buffers for read bulk IO.  <a href="#a726260e44939ea9ba9f68887cde3cdfe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#aaf6a220a030d76e7971ada9f1f7fa901">ofd_write_attr_set</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, struct <a class="el" href="structofd__object.html">ofd_object</a> *ofd_obj, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structfilter__fid.html">filter_fid</a> *ff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set attributes of object during write bulk IO processing.  <a href="#aaf6a220a030d76e7971ada9f1f7fa901"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a03f0094f5f011978294d940421bbe4a0">ofd_cb_soft_sync</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *cb, int err)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback function for "soft sync" update.  <a href="#a03f0094f5f011978294d940421bbe4a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a9aff6e10341be026e344cbc27ed8077b">ofd_soft_sync_cb_add</a> (struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add callback for "soft sync" processing.  <a href="#a9aff6e10341be026e344cbc27ed8077b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a1e84a4a9ee850e6cf2bb06643e7f77ad">ofd_commitrw_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la, struct <a class="el" href="structfilter__fid.html">filter_fid</a> *ff, int objcount, int niocount, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb, unsigned long granted, int old_rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Commit bulk IO buffers to the storage.  <a href="#a1e84a4a9ee850e6cf2bb06643e7f77ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__io_8c.html#a390d484ba582cfdbd4e5b50466d3a5af">ofd_commitrw</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, int <a class="el" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, struct <a class="el" href="structobdo.html">obdo</a> *oa, int objcount, struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *obj, struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *rnb, int npages, struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *lnb, int old_rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Commit bulk IO to the storage.  <a href="#a390d484ba582cfdbd4e5b50466d3a5af"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="ofd_io.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_FILTER</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00041">41</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a37c4c4a55c3a4818e21de32d263a48ed"></a><!-- doxytag: member="ofd_io.c::ofd_add_inconsistency_item" ref="a37c4c4a55c3a4818e21de32d263a48ed" args="(const struct lu_env *env, struct ofd_object *fo, struct obdo *oa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_add_inconsistency_item </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add new item for parent FID verification. </p>
<p>Prepare new verification item and pass it to the dedicated verification thread for further processing.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure with PFID </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00320">320</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lu__object_8h_source.html#l00709">lu_object_get()</a>, <a class="el" href="lustre__idl_8h_source.html#l03400">obdo::o_parent_oid</a>, <a class="el" href="lustre__idl_8h_source.html#l03385">obdo::o_parent_seq</a>, <a class="el" href="lustre__idl_8h_source.html#l03404">obdo::o_stripe_idx</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00193">ofd_device::ofd_inconsistency_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00194">ofd_device::ofd_inconsistency_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00192">ofd_device::ofd_inconsistency_thread</a>, <a class="el" href="ofd__internal_8h_source.html#l00250">ofd_obj2dev()</a>, <a class="el" href="ofd__internal_8h_source.html#l00219">ofd_object::ofo_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_checking</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_verified</a>, <a class="el" href="ofd__io_8c_source.html#l00047">ofd_inconsistency_item::oii_list</a>, <a class="el" href="ofd__io_8c_source.html#l00048">ofd_inconsistency_item::oii_obj</a>, <a class="el" href="ofd__io_8c_source.html#l00049">ofd_inconsistency_item::oii_pfid</a>, and <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00378">ofd_verify_ff()</a>.</p>

</div>
</div>
<a class="anchor" id="a03f0094f5f011978294d940421bbe4a0"></a><!-- doxytag: member="ofd_io.c::ofd_cb_soft_sync" ref="a03f0094f5f011978294d940421bbe4a0" args="(struct lu_env *env, struct thandle *th, struct dt_txn_commit_cb *cb, int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_cb_soft_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Callback function for "soft sync" update. </p>
<p>Reset fed_soft_sync_count upon committing the "soft_sync" update. See <a class="el" href="ofd__io_8c.html#a9aff6e10341be026e344cbc27ed8077b" title="Add callback for &quot;soft sync&quot; processing.">ofd_soft_sync_cb_add()</a> below for more details on soft sync.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>transaction handle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cb</em>&nbsp;</td><td>callback data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>err</em>&nbsp;</td><td>error code </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00931">931</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="obd__class_8h_source.html#l00281">class_export_cb_put</a>, <a class="el" href="libcfs__debug_8h_source.html#l00130">D_INODE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__io_8c_source.html#l00916">ofd_soft_sync_callback::ossc_cb</a>, and <a class="el" href="ofd__io_8c_source.html#l00917">ofd_soft_sync_callback::ossc_exp</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00961">ofd_soft_sync_cb_add()</a>.</p>

</div>
</div>
<a class="anchor" id="a390d484ba582cfdbd4e5b50466d3a5af"></a><!-- doxytag: member="ofd_io.c::ofd_commitrw" ref="a390d484ba582cfdbd4e5b50466d3a5af" args="(const struct lu_env *env, int cmd, struct obd_export *exp, struct obdo *oa, int objcount, struct obd_ioobj *obj, struct niobuf_remote *rnb, int npages, struct niobuf_local *lnb, int old_rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_commitrw </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>objcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *&nbsp;</td>
          <td class="paramname"> <em>rnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>npages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>old_rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Commit bulk IO to the storage. </p>
<p>This is companion function to the <a class="el" href="ofd__internal_8h.html#a5e1b48d7cdf4e6ccdc5f00ba323f1ddb" title="Prepare bulk IO requests for processing.">ofd_preprw()</a>. It finishes bulk IO request processing by committing buffers to the storage (WRITE) and/or freeing those buffers (read/write). See <a class="el" href="ofd__io_8c.html#a726260e44939ea9ba9f68887cde3cdfe" title="Drop reference on local buffers for read bulk IO.">ofd_commitrw_read()</a> and <a class="el" href="ofd__io_8c.html#a1e84a4a9ee850e6cf2bb06643e7f77ad" title="Commit bulk IO buffers to the storage.">ofd_commitrw_write()</a> for details about each type of IO.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>IO type (READ/WRITE) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure from client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objcount</em>&nbsp;</td><td>always 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>object data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rnb</em>&nbsp;</td><td>remote buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>npages</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>old_rc</em>&nbsp;</td><td>result of processing at this point</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful commit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l01163">1163</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="ofd__internal_8h_source.html#l00062">ofd_mod_data::fmd_mactime_xid</a>, <a class="el" href="ofd__internal_8h_source.html#l00299">ofd_thread_info::fti_attr</a>, <a class="el" href="ofd__internal_8h_source.html#l00303">ofd_thread_info::fti_mds_fid</a>, <a class="el" href="ofd__internal_8h_source.html#l00301">ofd_thread_info::fti_resid</a>, <a class="el" href="ofd__internal_8h_source.html#l00295">ofd_thread_info::fti_xid</a>, <a class="el" href="linux-obdo_8c_source.html#l00103">la_from_obdo()</a>, <a class="el" href="lu__object_8h_source.html#l00450">LA_GID</a>, <a class="el" href="lu__object_8h_source.html#l00449">LA_UID</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="packet-lustre_8c_source.html#l00299">LDLM_EXTENT</a>, <a class="el" href="lustre__dlm_8h_source.html#l01296">ldlm_res_lvbo_update()</a>, <a class="el" href="ldlm__resource_8c_source.html#l01179">ldlm_resource_get()</a>, <a class="el" href="ldlm__resource_8c_source.html#l01295">ldlm_resource_putref()</a>, <a class="el" href="structldlm__valblock__ops.html#a2a67bc2634b21d63b85e93494b74a067">ldlm_valblock_ops::lvbo_update</a>, <a class="el" href="lustre__dlm_8h_source.html#l00452">ldlm_namespace::ns_lvbo</a>, <a class="el" href="lustre__idl_8h_source.html#l03398">obdo::o_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03384">obdo::o_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="lustre__idl_8h_source.html#l01761">OBD_BRW_OVER_GRPQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01760">OBD_BRW_OVER_USRQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01746">OBD_BRW_READ</a>, <a class="el" href="lustre__idl_8h_source.html#l01747">OBD_BRW_WRITE</a>, <a class="el" href="lustre__idl_8h_source.html#l01433">OBD_FL_NO_GRPQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01432">OBD_FL_NO_USRQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01657">OBD_MD_FLATIME</a>, <a class="el" href="lustre__idl_8h_source.html#l01659">OBD_MD_FLCTIME</a>, <a class="el" href="lustre__idl_8h_source.html#l01680">OBD_MD_FLFID</a>, <a class="el" href="lustre__idl_8h_source.html#l01667">OBD_MD_FLFLAGS</a>, <a class="el" href="lustre__idl_8h_source.html#l01666">OBD_MD_FLGID</a>, <a class="el" href="lustre__idl_8h_source.html#l01686">OBD_MD_FLGRPQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01658">OBD_MD_FLMTIME</a>, <a class="el" href="lustre__idl_8h_source.html#l01665">OBD_MD_FLUID</a>, <a class="el" href="lustre__idl_8h_source.html#l01685">OBD_MD_FLUSRQUOTA</a>, <a class="el" href="linux-obdo_8c_source.html#l00052">obdo_from_la()</a>, <a class="el" href="ofd__io_8c_source.html#l00772">ofd_commitrw_read()</a>, <a class="el" href="ofd__io_8c_source.html#l01009">ofd_commitrw_write()</a>, <a class="el" href="ofd__internal_8h_source.html#l00207">ofd_exp()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00199">ofd_fmd_find()</a>, <a class="el" href="ofd__fmd_8c_source.html#l00084">ofd_fmd_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00122">ofd_device::ofd_namespace</a>, <a class="el" href="ofd__internal_8h_source.html#l00562">ofd_prepare_fidea()</a>, <a class="el" href="ofd__internal_8h_source.html#l00055">OFD_VALID_FLAGS</a>, <a class="el" href="lustre__user_8h_source.html#l00219">ost_id::oi_fid</a>, <a class="el" href="lustre__fid_8h_source.html#l00652">ost_fid_build_resid()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a726260e44939ea9ba9f68887cde3cdfe"></a><!-- doxytag: member="ofd_io.c::ofd_commitrw_read" ref="a726260e44939ea9ba9f68887cde3cdfe" args="(const struct lu_env *env, struct ofd_device *ofd, const struct lu_fid *fid, int objcount, int niocount, struct niobuf_local *lnb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_commitrw_read </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>objcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>niocount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Drop reference on local buffers for read bulk IO. </p>
<p>This will free all local buffers use by this read request.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>object FID </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objcount</em>&nbsp;</td><td>always 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>niocount</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful execution </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00772">772</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02329">dt_bufs_put()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00102">ofd_object_find()</a>, <a class="el" href="ofd__objects_8c_source.html#l00174">ofd_object_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00263">ofd_read_unlock()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l01163">ofd_commitrw()</a>.</p>

</div>
</div>
<a class="anchor" id="a1e84a4a9ee850e6cf2bb06643e7f77ad"></a><!-- doxytag: member="ofd_io.c::ofd_commitrw_write" ref="a1e84a4a9ee850e6cf2bb06643e7f77ad" args="(const struct lu_env *env, struct obd_export *exp, struct ofd_device *ofd, const struct lu_fid *fid, struct lu_attr *la, struct filter_fid *ff, int objcount, int niocount, struct niobuf_local *lnb, unsigned long granted, int old_rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_commitrw_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfilter__fid.html">filter_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>ff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>objcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>niocount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>granted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>old_rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Commit bulk IO buffers to the storage. </p>
<p>This function finalizes write IO processing by writing data to the disk. That write can be synchronous or asynchronous depending on buffers flags.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ff</em>&nbsp;</td><td>parent FID of object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objcount</em>&nbsp;</td><td>always 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>niocount</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>granted</em>&nbsp;</td><td>grant space consumed for the bulk I/O </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>old_rc</em>&nbsp;</td><td>result of processing at this point</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful commit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l01009">1009</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00130">D_INODE</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02329">dt_bufs_put()</a>, <a class="el" href="dt__object_8h_source.html#l02645">dt_commit_async()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02347">dt_declare_write_commit()</a>, <a class="el" href="dt__object_8h_source.html#l02358">dt_write_commit()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00117">filter_export_data::fed_soft_sync_count</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00445">LA_MTIME</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l01758">OBD_BRW_ASYNC</a>, <a class="el" href="lustre__idl_8h_source.html#l01762">OBD_BRW_SOFT_SYNC</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00321">OBD_FAIL_OST_DQACQ_NET</a>, <a class="el" href="ofd__grant_8c_source.html#l01264">ofd_grant_commit()</a>, <a class="el" href="ofd__grant_8c_source.html#l01369">ofd_grant_commit_cb_add()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00102">ofd_object_find()</a>, <a class="el" href="ofd__objects_8c_source.html#l00174">ofd_object_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__internal_8h_source.html#l00263">ofd_read_unlock()</a>, <a class="el" href="ofd__io_8c_source.html#l00961">ofd_soft_sync_cb_add()</a>, <a class="el" href="ofd__internal_8h_source.html#l00188">ofd_device::ofd_soft_sync_limit</a>, <a class="el" href="ofd__internal_8h_source.html#l00175">ofd_device::ofd_syncjournal</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__trans_8c_source.html#l00089">ofd_trans_start()</a>, <a class="el" href="ofd__trans_8c_source.html#l00110">ofd_trans_stop()</a>, <a class="el" href="ofd__io_8c_source.html#l00813">ofd_write_attr_set()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l01163">ofd_commitrw()</a>.</p>

</div>
</div>
<a class="anchor" id="ae73678766b398ab02bc2d2cc9fbe0d90"></a><!-- doxytag: member="ofd_io.c::ofd_inconsistency_verification_main" ref="ae73678766b398ab02bc2d2cc9fbe0d90" args="(void *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_inconsistency_verification_main </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>args</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verification thread to check parent FID consistency. </p>
<p>Kernel thread to check consistency of parent FID for any new item added for checking by <a class="el" href="ofd__io_8c.html#a37c4c4a55c3a4818e21de32d263a48ed" title="Add new item for parent FID verification.">ofd_add_inconsistency_item()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>args</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful thread termination </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value if thread can't start </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00154">154</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lu__object_8h_source.html#l00999">LCT_DT_THREAD</a>, <a class="el" href="lustre__idl_8h_source.html#l03468">LE_PAIRS_VERIFY</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00168">LFSCK_TYPE_LAYOUT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lustre__idl_8h_source.html#l03440">lfsck_request::lr_active</a>, <a class="el" href="lustre__idl_8h_source.html#l03430">lfsck_request::lr_event</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00193">ofd_device::ofd_inconsistency_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00194">ofd_device::ofd_inconsistency_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00192">ofd_device::ofd_inconsistency_thread</a>, <a class="el" href="ofd__io_8c_source.html#l00065">ofd_inconsistency_verify_one()</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00219">ofd_object::ofo_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_checking</a>, <a class="el" href="ofd__io_8c_source.html#l00047">ofd_inconsistency_item::oii_list</a>, <a class="el" href="ofd__io_8c_source.html#l00048">ofd_inconsistency_item::oii_obj</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, <a class="el" href="lustre__net_8h_source.html#l01577">thread_set_flags()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00247">ofd_start_inconsistency_verification_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="afa27e093a5a326db739d808572f4439d"></a><!-- doxytag: member="ofd_io.c::ofd_inconsistency_verify_one" ref="afa27e093a5a326db739d808572f4439d" args="(const struct lu_env *env, struct ofd_device *ofd, struct ofd_inconsistency_item *oii, struct lfsck_request *lr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_inconsistency_verify_one </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__inconsistency__item.html">ofd_inconsistency_item</a> *&nbsp;</td>
          <td class="paramname"> <em>oii</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *&nbsp;</td>
          <td class="paramname"> <em>lr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify single object for parent FID consistency. </p>
<p>Part of LFSCK processing which checks single object PFID stored in extended attribute (XATTR) against real FID of MDT parent object received by LFSCK. This verifies that the OST object is being referenced by only a single MDT object.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oii</em>&nbsp;</td><td>object-related local data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lr</em>&nbsp;</td><td>LFSCK request data </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00065">65</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__lib_8c_source.html#l03296">lfsck_in_notify()</a>, <a class="el" href="lu__object_8h_source.html#l00525">lu_object_header::loh_fid</a>, <a class="el" href="lustre__lfsck_8h_source.html#l00050">LPVS_INCONSISTENT</a>, <a class="el" href="lustre__lfsck_8h_source.html#l00051">LPVS_INCONSISTENT_TOFIX</a>, <a class="el" href="lustre__lfsck_8h_source.html#l00049">LPVS_INIT</a>, <a class="el" href="lustre__idl_8h_source.html#l03444">lfsck_request::lr_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03445">lfsck_request::lr_fid2</a>, <a class="el" href="lustre__idl_8h_source.html#l03446">lfsck_request::lr_fid3</a>, <a class="el" href="lustre__idl_8h_source.html#l03436">lfsck_request::lr_status</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00129">ofd_device::ofd_inconsistency_self_detected</a>, <a class="el" href="ofd__internal_8h_source.html#l00130">ofd_device::ofd_inconsistency_self_repaired</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__internal_8h_source.html#l00271">ofd_write_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00279">ofd_write_unlock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00218">ofd_object::ofo_header</a>, <a class="el" href="ofd__internal_8h_source.html#l00219">ofd_object::ofo_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_checking</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_verified</a>, <a class="el" href="ofd__io_8c_source.html#l00048">ofd_inconsistency_item::oii_obj</a>, <a class="el" href="ofd__io_8c_source.html#l00049">ofd_inconsistency_item::oii_pfid</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00154">ofd_inconsistency_verification_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e1b48d7cdf4e6ccdc5f00ba323f1ddb"></a><!-- doxytag: member="ofd_io.c::ofd_preprw" ref="a5e1b48d7cdf4e6ccdc5f00ba323f1ddb" args="(const struct lu_env *env, int cmd, struct obd_export *exp, struct obdo *oa, int objcount, struct obd_ioobj *obj, struct niobuf_remote *rnb, int *nr_local, struct niobuf_local *lnb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_preprw </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>objcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *&nbsp;</td>
          <td class="paramname"> <em>rnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nr_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare bulk IO requests for processing. </p>
<p>This function does initial checks of IO and calls corresponding functions for read/write processing.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>IO type (read/write) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure from request </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objcount</em>&nbsp;</td><td>always 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>object data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rnb</em>&nbsp;</td><td>remote buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nr_local</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful prepare </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00685">685</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="ofd__internal_8h_source.html#l00299">ofd_thread_info::fti_attr</a>, <a class="el" href="lustre__idl_8h_source.html#l01777">obd_ioobj::ioo_bufcnt</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="linux-obdo_8c_source.html#l00103">la_from_obdo()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l03384">obdo::o_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l01746">OBD_BRW_READ</a>, <a class="el" href="lustre__idl_8h_source.html#l01747">OBD_BRW_WRITE</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00302">OBD_FAIL_SRV_ENOENT</a>, <a class="el" href="lustre__idl_8h_source.html#l01720">OBD_MD_FLGETATTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="linux-obdo_8c_source.html#l00052">obdo_from_la()</a>, <a class="el" href="ofd__internal_8h_source.html#l00207">ofd_exp()</a>, <a class="el" href="ofd__grant_8c_source.html#l00988">ofd_grant_prepare_read()</a>, <a class="el" href="ofd__internal_8h_source.html#l00511">ofd_info_init()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__io_8c_source.html#l00440">ofd_preprw_read()</a>, <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>, <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>, <a class="el" href="ofd__fs_8c_source.html#l00109">ofd_seq_put()</a>, <a class="el" href="lustre__user_8h_source.html#l00219">ost_id::oi_fid</a>, <a class="el" href="ofd__internal_8h_source.html#l00113">ofd_seq::os_destroys_in_progress</a>, <a class="el" href="lustre__idl_8h_source.html#l00531">ostid_seq()</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="lustre__net_8h_source.html#l00105">PTLRPC_MAX_BRW_PAGES</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lu__target_8h_source.html#l00235">tgt_ses_info()</a>, <a class="el" href="lu__target_8h_source.html#l00334">tgt_ses_req()</a>, <a class="el" href="ofd__internal_8h_source.html#l00527">tsi2ofd_info()</a>, and <a class="el" href="lu__target_8h_source.html#l00227">tgt_session_info::tsi_jobid</a>.</p>

</div>
</div>
<a class="anchor" id="a509e4729fb1bf03d8c4a1aed45d7ee2d"></a><!-- doxytag: member="ofd_io.c::ofd_preprw_read" ref="a509e4729fb1bf03d8c4a1aed45d7ee2d" args="(const struct lu_env *env, struct obd_export *exp, struct ofd_device *ofd, const struct lu_fid *fid, struct lu_attr *la, struct obdo *oa, int niocount, struct niobuf_remote *rnb, int *nr_local, struct niobuf_local *lnb, char *jobid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_preprw_read </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>niocount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *&nbsp;</td>
          <td class="paramname"> <em>rnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nr_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>jobid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare buffers for read request processing. </p>
<p>This function converts remote buffers from client to local buffers and prepares the latter.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure from client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>niocount</em>&nbsp;</td><td>number of remote buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rnb</em>&nbsp;</td><td>remote buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nr_local</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>jobid</em>&nbsp;</td><td>job ID name</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful prepare </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00440">440</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l02318">dt_bufs_get()</a>, <a class="el" href="dt__object_8h_source.html#l02329">dt_bufs_put()</a>, <a class="el" href="dt__object_8h_source.html#l02368">dt_read_prep()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ofd__internal_8h_source.html#l00074">LPROC_OFD_STATS_READ</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="lustre__idl_8h_source.html#l01680">OBD_MD_FLFID</a>, <a class="el" href="ofd__internal_8h_source.html#l00089">ofd_counter_incr()</a>, <a class="el" href="ofd__internal_8h_source.html#l00175">ofd_device::ofd_lfsck_verify_pfid</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00102">ofd_object_find()</a>, <a class="el" href="ofd__objects_8c_source.html#l00174">ofd_object_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00255">ofd_read_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00263">ofd_read_unlock()</a>, <a class="el" href="ofd__io_8c_source.html#l00378">ofd_verify_ff()</a>, <a class="el" href="lustre__net_8h_source.html#l00105">PTLRPC_MAX_BRW_PAGES</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__idl_8h_source.html#l01791">niobuf_remote::rnb_len</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00685">ofd_preprw()</a>.</p>

</div>
</div>
<a class="anchor" id="a3e2417f451915f575c2003ec5cad7800"></a><!-- doxytag: member="ofd_io.c::ofd_preprw_write" ref="a3e2417f451915f575c2003ec5cad7800" args="(const struct lu_env *env, struct obd_export *exp, struct ofd_device *ofd, const struct lu_fid *fid, struct lu_attr *la, struct obdo *oa, int objcount, struct obd_ioobj *obj, struct niobuf_remote *rnb, int *nr_local, struct niobuf_local *lnb, char *jobid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_preprw_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>objcount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__ioobj.html">obd_ioobj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__remote.html">niobuf_remote</a> *&nbsp;</td>
          <td class="paramname"> <em>rnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>nr_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structniobuf__local.html">niobuf_local</a> *&nbsp;</td>
          <td class="paramname"> <em>lnb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>jobid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare buffers for write request processing. </p>
<p>This function converts remote buffers from client to local buffers and prepares the latter. If there is recovery in progress and required object is missing then it can be re-created before write.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>FID of object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure from client </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>objcount</em>&nbsp;</td><td>always 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>object data </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rnb</em>&nbsp;</td><td>remote buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nr_local</em>&nbsp;</td><td>number of local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnb</em>&nbsp;</td><td>local buffers </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>jobid</em>&nbsp;</td><td>job ID name</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful prepare </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00524">524</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02318">dt_bufs_get()</a>, <a class="el" href="dt__object_8h_source.html#l02329">dt_bufs_put()</a>, <a class="el" href="dt__object_8h_source.html#l02338">dt_write_prep()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00342">exp_connect_rmtclient()</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00457">fid_seq_is_idif()</a>, <a class="el" href="lustre__idl_8h_source.html#l00342">fid_seq_is_mdt0()</a>, <a class="el" href="lustre__idl_8h_source.html#l00472">fid_seq_is_norm()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__idl_8h_source.html#l00320">IDIF_MAX_OID</a>, <a class="el" href="lustre__idl_8h_source.html#l01777">obd_ioobj::ioo_bufcnt</a>, <a class="el" href="lustre__idl_8h_source.html#l01773">obd_ioobj::ioo_oid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="obd_8h_source.html#l00437">niobuf_local::lnb_flags</a>, <a class="el" href="obd_8h_source.html#l00438">niobuf_local::lnb_rc</a>, <a class="el" href="ofd__internal_8h_source.html#l00075">LPROC_OFD_STATS_WRITE</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__fid_8h_source.html#l00182">LUSTRE_DATA_SEQ_MAX_WIDTH</a>, <a class="el" href="lustre__idl_8h_source.html#l03384">obdo::o_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="lustre__idl_8h_source.html#l01754">OBD_BRW_GRANTED</a>, <a class="el" href="lustre__idl_8h_source.html#l01756">OBD_BRW_NOQUOTA</a>, <a class="el" href="lustre__idl_8h_source.html#l01680">OBD_MD_FLFID</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="ofd__internal_8h_source.html#l00089">ofd_counter_incr()</a>, <a class="el" href="ofd__grant_8c_source.html#l01264">ofd_grant_commit()</a>, <a class="el" href="ofd__grant_8c_source.html#l00988">ofd_grant_prepare_read()</a>, <a class="el" href="ofd__grant_8c_source.html#l01068">ofd_grant_prepare_write()</a>, <a class="el" href="ofd__internal_8h_source.html#l00175">ofd_device::ofd_lfsck_verify_pfid</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__internal_8h_source.html#l00230">ofd_object_exists()</a>, <a class="el" href="ofd__objects_8c_source.html#l00102">ofd_object_find()</a>, <a class="el" href="ofd__objects_8c_source.html#l00174">ofd_object_put()</a>, <a class="el" href="ofd__fs_8c_source.html#l00061">ofd_precreate_batch()</a>, <a class="el" href="ofd__objects_8c_source.html#l00206">ofd_precreate_objects()</a>, <a class="el" href="ofd__internal_8h_source.html#l00255">ofd_read_lock()</a>, <a class="el" href="ofd__internal_8h_source.html#l00263">ofd_read_unlock()</a>, <a class="el" href="ofd__fs_8c_source.html#l00164">ofd_seq_last_oid()</a>, <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>, <a class="el" href="ofd__fs_8c_source.html#l00109">ofd_seq_put()</a>, <a class="el" href="ofd__io_8c_source.html#l00378">ofd_verify_ff()</a>, <a class="el" href="ofd__internal_8h_source.html#l00110">ofd_seq::os_create_lock</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="lustre__net_8h_source.html#l00105">PTLRPC_MAX_BRW_PAGES</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__idl_8h_source.html#l01792">niobuf_remote::rnb_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01791">niobuf_remote::rnb_len</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l00685">ofd_preprw()</a>.</p>

</div>
</div>
<a class="anchor" id="a9aff6e10341be026e344cbc27ed8077b"></a><!-- doxytag: member="ofd_io.c::ofd_soft_sync_cb_add" ref="a9aff6e10341be026e344cbc27ed8077b" args="(struct thandle *th, struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_soft_sync_cb_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add callback for "soft sync" processing. </p>
<p>The "soft sync" mechanism does asynchronous commit when OBD_BRW_SOFT_SYNC flag is set in client buffers. The intention is for this operation to commit pages belonging to a client which has "too many" outstanding unstable pages in its cache. See LU-2139 for details.</p>
<p>This function adds callback to be called when commit is done.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>transaction handle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>OBD export of client</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful callback adding </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00961">961</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="obd__class_8h_source.html#l00273">class_export_cb_get</a>, <a class="el" href="obd__class_8h_source.html#l00281">class_export_cb_put</a>, <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l00114">dt_txn_commit_cb::dcb_name</a>, <a class="el" href="dt__object_8h_source.html#l02077">dt_trans_cb_add()</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__io_8c_source.html#l00931">ofd_cb_soft_sync()</a>, <a class="el" href="ofd__io_8c_source.html#l00916">ofd_soft_sync_callback::ossc_cb</a>, <a class="el" href="ofd__io_8c_source.html#l00917">ofd_soft_sync_callback::ossc_exp</a>, and <a class="el" href="string_8c_source.html#l00058">strlcpy()</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l01009">ofd_commitrw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="abad8e9cb4f2bf23b5f26f3fa2064d164"></a><!-- doxytag: member="ofd_io.c::ofd_start_inconsistency_verification_thread" ref="abad8e9cb4f2bf23b5f26f3fa2064d164" args="(struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_start_inconsistency_verification_thread </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start parent FID verification thread. </p>
<p>See <a class="el" href="ofd__io_8c.html#ae73678766b398ab02bc2d2cc9fbe0d90" title="Verification thread to check parent FID consistency.">ofd_inconsistency_verification_main()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful start of thread </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00247">247</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="ofd__internal_8h_source.html#l00194">ofd_device::ofd_inconsistency_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00192">ofd_device::ofd_inconsistency_thread</a>, <a class="el" href="ofd__io_8c_source.html#l00154">ofd_inconsistency_verification_main()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>, <a class="el" href="lustre__net_8h_source.html#l01577">thread_set_flags()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l02814">ofd_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a0aca95140be0eaf4b18bac3e2db396da"></a><!-- doxytag: member="ofd_io.c::ofd_stop_inconsistency_verification_thread" ref="a0aca95140be0eaf4b18bac3e2db396da" args="(struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_stop_inconsistency_verification_thread </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop parent FID verification thread. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful start of thread </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EALREADY</em>&nbsp;</td><td>if thread is already stopped </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00288">288</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="ofd__internal_8h_source.html#l00194">ofd_device::ofd_inconsistency_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00192">ofd_device::ofd_inconsistency_thread</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01537">thread_is_init()</a>, <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>, and <a class="el" href="lustre__net_8h_source.html#l01577">thread_set_flags()</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l02983">ofd_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="aea6c312b1e6a241a81a51050dffb8bc5"></a><!-- doxytag: member="ofd_io.c::ofd_verify_ff" ref="aea6c312b1e6a241a81a51050dffb8bc5" args="(const struct lu_env *env, struct ofd_object *fo, struct obdo *oa)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_verify_ff </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobdo.html">obdo</a> *&nbsp;</td>
          <td class="paramname"> <em>oa</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify parent FID of an object. </p>
<p>Check the parent FID is sane and start extended verification procedure otherwise.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fo</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oa</em>&nbsp;</td><td>OBDO structure with PFID</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful verification </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINPROGRESS</em>&nbsp;</td><td>if PFID is being repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EPERM</em>&nbsp;</td><td>if PFID was verified but still insane </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00378">378</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="lustre__idl_8h_source.html#l03400">obdo::o_parent_oid</a>, <a class="el" href="lustre__idl_8h_source.html#l03385">obdo::o_parent_seq</a>, <a class="el" href="lustre__idl_8h_source.html#l03404">obdo::o_stripe_idx</a>, <a class="el" href="ofd__io_8c_source.html#l00320">ofd_add_inconsistency_item()</a>, <a class="el" href="ofd__objects_8c_source.html#l00138">ofd_object_ff_load()</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_checking</a>, <a class="el" href="ofd__internal_8h_source.html#l00221">ofd_object::ofo_pfid_verified</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__objects_8c_source.html#l00600">ofd_object_punch()</a>, <a class="el" href="ofd__io_8c_source.html#l00440">ofd_preprw_read()</a>, and <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf6a220a030d76e7971ada9f1f7fa901"></a><!-- doxytag: member="ofd_io.c::ofd_write_attr_set" ref="aaf6a220a030d76e7971ada9f1f7fa901" args="(const struct lu_env *env, struct ofd_device *ofd, struct ofd_object *ofd_obj, struct lu_attr *la, struct filter_fid *ff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_write_attr_set </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__object.html">ofd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfilter__fid.html">filter_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>ff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set attributes of object during write bulk IO processing. </p>
<p>Change object attributes and write parent FID into extended attributes when needed.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd_obj</em>&nbsp;</td><td>OFD object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>object attributes </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ff</em>&nbsp;</td><td>parent FID</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful attributes update </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__io_8c_source.html#l00813">813</a> of file <a class="el" href="ofd__io_8c_source.html">ofd_io.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__user_8h_source.html#l00167">filter_fid::ff_parent</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00450">LA_GID</a>, <a class="el" href="lu__object_8h_source.html#l00449">LA_UID</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00544">OBD_FAIL_LFSCK_NOPFID</a>, <a class="el" href="obd__support_8h_source.html#l00538">OBD_FAIL_LFSCK_UNMATCHED_PAIR1</a>, <a class="el" href="obd__support_8h_source.html#l00539">OBD_FAIL_LFSCK_UNMATCHED_PAIR2</a>, <a class="el" href="ofd__objects_8c_source.html#l00434">ofd_attr_handle_ugid()</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00243">ofd_object_child()</a>, <a class="el" href="ofd__objects_8c_source.html#l00138">ofd_object_ff_load()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__trans_8c_source.html#l00057">ofd_trans_create()</a>, <a class="el" href="ofd__internal_8h_source.html#l00220">ofd_object::ofo_pfid</a>, and <a class="el" href="lustre__idl_8h_source.html#l01599">XATTR_NAME_FID</a>.</p>

<p>Referenced by <a class="el" href="ofd__io_8c_source.html#l01009">ofd_commitrw_write()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:49 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
