<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/mdt/mdt_hsm_cdt_agent.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/mdt/mdt_hsm_cdt_agent.c File Reference</h1><code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__support_8h_source.html">obd_support.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__export_8h_source.html">lustre_export.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__user_8h_source.html">lustre/lustre_user.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lprocfs__status_8h_source.html">lprocfs_status.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__kernelcomm_8h_source.html">lustre_kernelcomm.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="mdt__internal_8h_source.html">mdt_internal.h</a>&quot;</code><br/>

<p><a href="mdt__hsm__cdt__agent_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhsm__agent.html">hsm_agent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a2f014a0032e35f4934b97c3184cc16a7">mdt_hsm_agent_lookup</a> (struct <a class="el" href="structcoordinator.html">coordinator</a> *cdt, const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a1f30a82ebc6efe0acb9122c3fbd79f53">mdt_hsm_agent_register</a> (struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *mti, const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, int nr_archives, __u32 *archive_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register a copy tool  <a href="#a1f30a82ebc6efe0acb9122c3fbd79f53"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#afb6538e4bec19875acab9085115bb81f">mdt_hsm_agent_register_mask</a> (struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *mti, const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, __u32 archive_mask)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register a copy tool  <a href="#afb6538e4bec19875acab9085115bb81f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#acc2e72d9f7fffc387ddbf1e06352d95e">mdt_hsm_agent_unregister</a> (struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *mti, const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">unregister a copy tool  <a href="#acc2e72d9f7fffc387ddbf1e06352d95e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a2590cfa39d2821765fd81a8e2cddd35f">mdt_hsm_agent_update_statistics</a> (struct <a class="el" href="structcoordinator.html">coordinator</a> *cdt, int succ_rq, int fail_rq, int new_rq, const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update agent statistics  <a href="#a2590cfa39d2821765fd81a8e2cddd35f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a9d13dc794fa8f8885ee9c3b098675dd1">mdt_hsm_find_best_agent</a> (struct <a class="el" href="structcoordinator.html">coordinator</a> *cdt, __u32 archive, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">find the best agent  <a href="#a9d13dc794fa8f8885ee9c3b098675dd1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#ab0c3f5ec4cb4656ab69af45c1484b6ee">mdt_hsm_agent_send</a> (struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *mti, struct <a class="el" href="structhsm__action__list.html">hsm_action_list</a> *hal, bool purge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send a compound request to the agent  <a href="#ab0c3f5ec4cb4656ab69af45c1484b6ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#adc10087711d7d674734d277d9e3decc4">mdt_hsm_coordinator_update</a> (struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *mti, struct <a class="el" href="structhsm__progress__kernel.html">hsm_progress_kernel</a> *pgs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update status of a request  <a href="#adc10087711d7d674734d277d9e3decc4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#aad7995d67480a67941839b04f76271e6">mdt_hsm_agent_proc_start</a> (struct seq_file *s, loff_t *off)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">seq_file method called to start access to /proc file  <a href="#aad7995d67480a67941839b04f76271e6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#ab2b3831f25d086041670cebf659fdfa2">mdt_hsm_agent_proc_next</a> (struct seq_file *s, void *v, loff_t *p)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">seq_file method called to get next item just returns NULL at eof  <a href="#ab2b3831f25d086041670cebf659fdfa2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a109b89d2949765d02de188431ef079bf">mdt_hsm_agent_proc_show</a> (struct seq_file *s, void *v)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#aca40e9ef3e1cc6e450395a2729f13982">mdt_hsm_agent_proc_stop</a> (struct seq_file *s, void *v)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">seq_file method called to stop access to /proc file  <a href="#aca40e9ef3e1cc6e450395a2729f13982"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#abb8bf9a4bccc60d3b8a3976c47d22307">lprocfs_open_hsm_agent</a> (struct inode *inode, struct file *file)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">public function called at open of /proc file to get list of agents  <a href="#abb8bf9a4bccc60d3b8a3976c47d22307"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct seq_operations&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#a5df11d67c20db5fe7316c6821d4fd752">mdt_hsm_agent_proc_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct file_operations&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdt__hsm__cdt__agent_8c.html#ae27f872199c9effc47a6630d21ff2509">mdt_hsm_agent_fops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00036">36</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abb8bf9a4bccc60d3b8a3976c47d22307"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::lprocfs_open_hsm_agent" ref="abb8bf9a4bccc60d3b8a3976c47d22307" args="(struct inode *inode, struct file *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lprocfs_open_hsm_agent </td>
          <td>(</td>
          <td class="paramtype">struct inode *&nbsp;</td>
          <td class="paramname"> <em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct file *&nbsp;</td>
          <td class="paramname"> <em>file</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>public function called at open of /proc file to get list of agents </p>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00637">637</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00626">mdt_hsm_agent_proc_ops</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a2f014a0032e35f4934b97c3184cc16a7"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_lookup" ref="a2f014a0032e35f4934b97c3184cc16a7" args="(struct coordinator *cdt, const struct obd_uuid *uuid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhsm__agent.html">hsm_agent</a>* mdt_hsm_agent_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcoordinator.html">coordinator</a> *&nbsp;</td>
          <td class="paramname"> <em>cdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00057">57</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="mdt__internal_8h_source.html#l00475">hsm_agent::ha_uuid</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, and <a class="el" href="lustre__user_8h_source.html#l00495">obd_uuid_equals()</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00078">mdt_hsm_agent_register()</a>, and <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00191">mdt_hsm_agent_unregister()</a>.</p>

</div>
</div>
<a class="anchor" id="ab2b3831f25d086041670cebf659fdfa2"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_proc_next" ref="ab2b3831f25d086041670cebf659fdfa2" args="(struct seq_file *s, void *v, loff_t *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* mdt_hsm_agent_proc_next </td>
          <td>(</td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>seq_file method called to get next item just returns NULL at eof </p>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00566">566</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a109b89d2949765d02de188431ef079bf"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_proc_show" ref="a109b89d2949765d02de188431ef079bf" args="(struct seq_file *s, void *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mdt_hsm_agent_proc_show </td>
          <td>(</td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>v</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00587">587</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__internal_8h_source.html#l00477">hsm_agent::ha_archive_cnt</a>, <a class="el" href="mdt__internal_8h_source.html#l00476">hsm_agent::ha_archive_id</a>, <a class="el" href="mdt__internal_8h_source.html#l00482">hsm_agent::ha_failure</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="mdt__internal_8h_source.html#l00479">hsm_agent::ha_requests</a>, <a class="el" href="mdt__internal_8h_source.html#l00480">hsm_agent::ha_success</a>, <a class="el" href="mdt__internal_8h_source.html#l00475">hsm_agent::ha_uuid</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

</div>
</div>
<a class="anchor" id="aad7995d67480a67941839b04f76271e6"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_proc_start" ref="aad7995d67480a67941839b04f76271e6" args="(struct seq_file *s, loff_t *off)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* mdt_hsm_agent_proc_start </td>
          <td>(</td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t *&nbsp;</td>
          <td class="paramname"> <em>off</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>seq_file method called to start access to /proc file </p>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00536">536</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00253">list_for_each</a>, <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="aca40e9ef3e1cc6e450395a2729f13982"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_proc_stop" ref="aca40e9ef3e1cc6e450395a2729f13982" args="(struct seq_file *s, void *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mdt_hsm_agent_proc_stop </td>
          <td>(</td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>v</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>seq_file method called to stop access to /proc file </p>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00617">617</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, and <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>.</p>

</div>
</div>
<a class="anchor" id="a1f30a82ebc6efe0acb9122c3fbd79f53"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_register" ref="a1f30a82ebc6efe0acb9122c3fbd79f53" args="(struct mdt_thread_info *mti, const struct obd_uuid *uuid, int nr_archives, __u32 *archive_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_agent_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>mti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nr_archives</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>archive_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>register a copy tool </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mti</em>&nbsp;</td><td>[IN] MDT context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>[IN] client UUID to be registered </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>count</em>&nbsp;</td><td>[IN] number of archives agent serves </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>archive_id</em>&nbsp;</td><td>[IN] vector of archive number served by the copytool </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00078">78</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="mdt__internal_8h_source.html#l00118">coordinator::cdt_state</a>, <a class="el" href="mdt__internal_8h_source.html#l00098">CDT_STOPPED</a>, <a class="el" href="libcfs__debug_8h_source.html#l00158">D_HSM</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="mdt__internal_8h_source.html#l00477">hsm_agent::ha_archive_cnt</a>, <a class="el" href="mdt__internal_8h_source.html#l00476">hsm_agent::ha_archive_id</a>, <a class="el" href="mdt__internal_8h_source.html#l00482">hsm_agent::ha_failure</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="mdt__internal_8h_source.html#l00479">hsm_agent::ha_requests</a>, <a class="el" href="mdt__internal_8h_source.html#l00480">hsm_agent::ha_success</a>, <a class="el" href="mdt__internal_8h_source.html#l00475">hsm_agent::ha_uuid</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00057">mdt_hsm_agent_lookup()</a>, <a class="el" href="mdt__internal_8h_source.html#l00330">mdt_thread_info::mti_mdt</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__user_8h_source.html#l00513">obd_uuid2str()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00153">mdt_hsm_agent_register_mask()</a>.</p>

</div>
</div>
<a class="anchor" id="afb6538e4bec19875acab9085115bb81f"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_register_mask" ref="afb6538e4bec19875acab9085115bb81f" args="(struct mdt_thread_info *mti, const struct obd_uuid *uuid, __u32 archive_mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_agent_register_mask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>mti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>archive_mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>register a copy tool </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mti</em>&nbsp;</td><td>[IN] MDT context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>[IN] uuid to be registered </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>archive_mask</em>&nbsp;</td><td>[IN] bitmask of archive number served by the copytool </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00153">153</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00078">mdt_hsm_agent_register()</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm_8c_source.html#l00146">mdt_hsm_ct_register()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0c3f5ec4cb4656ab69af45c1484b6ee"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_send" ref="ab0c3f5ec4cb4656ab69af45c1484b6ee" args="(struct mdt_thread_info *mti, struct hsm_action_list *hal, bool purge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_agent_send </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>mti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhsm__action__list.html">hsm_action_list</a> *&nbsp;</td>
          <td class="paramname"> <em>hal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>purge</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send a compound request to the agent </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mti</em>&nbsp;</td><td>[IN] context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hal</em>&nbsp;</td><td>[IN] request (can be a kuc payload) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>purge</em>&nbsp;</td><td>[IN] purge mode (no record) </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure This function supposes:</p>
<ul>
<li>all actions are for the same archive number</li>
<li>in case of cancel, all cancel are for the same agent This implies that request split has to be done before when building the hal </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00322">322</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l03231">agent_req_status2name()</a>, <a class="el" href="lustre__idl_8h_source.html#l03226">ARS_FAILED</a>, <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="mdt__internal_8h_source.html#l00128">coordinator::cdt_restore_lock</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="hash_8c_source.html#l01346">cfs_hash_lookup()</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="mdt__internal_8h_source.html#l00489">cdt_restore_handle::crh_lh</a>, <a class="el" href="mdt__internal_8h_source.html#l00486">cdt_restore_handle::crh_list</a>, <a class="el" href="libcfs__debug_8h_source.html#l00158">D_HSM</a>, <a class="el" href="pack__generic_8c_source.html#l01574">do_set_info_async()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00245">obd_export::exp_disconnected</a>, <a class="el" href="lustre__export_8h_source.html#l00214">obd_export::exp_imp_reverse</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__user_8h_source.html#l01303">hai_first()</a>, <a class="el" href="lustre__user_8h_source.html#l01311">hai_next()</a>, <a class="el" href="lustre__user_8h_source.html#l01287">hsm_action_list::hal_archive_id</a>, <a class="el" href="lustre__user_8h_source.html#l01284">hsm_action_list::hal_count</a>, <a class="el" href="lustre__user_8h_source.html#l01286">hsm_action_list::hal_flags</a>, <a class="el" href="lustre__user_8h_source.html#l01318">hal_size()</a>, <a class="el" href="lustre__user_8h_source.html#l01213">HMT_ACTION_LIST</a>, <a class="el" href="lustre__user_8h_source.html#l01222">HSMA_CANCEL</a>, <a class="el" href="lustre__user_8h_source.html#l01221">HSMA_REMOVE</a>, <a class="el" href="lustre__user_8h_source.html#l01220">HSMA_RESTORE</a>, <a class="el" href="obd_8h_source.html#l00746">KEY_HSM_COPYTOOL_SEND</a>, <a class="el" href="genops_8c_source.html#l01914">kuc_alloc()</a>, <a class="el" href="genops_8c_source.html#l01933">kuc_free()</a>, <a class="el" href="genops_8c_source.html#l01893">kuc_len()</a>, <a class="el" href="genops_8c_source.html#l01903">kuc_ptr()</a>, <a class="el" href="uapi__kernelcomm_8h_source.html#l00061">KUC_TRANSPORT_HSM</a>, <a class="el" href="lustre__idl_8h_source.html#l02773">LDLM_SET_INFO</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="packet-lustre_8c_source.html#l00076">LUSTRE_OBD_VERSION</a>, <a class="el" href="mdt__internal_8h_source.html#l01041">mdt2obd_dev()</a>, <a class="el" href="mdt__hsm__cdt__actions_8c_source.html#l00261">mdt_agent_record_update()</a>, <a class="el" href="mdt__hsm__cdt__requests_8c_source.html#l00389">mdt_cdt_remove_request()</a>, <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01011">mdt_hsm_add_hal()</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00191">mdt_hsm_agent_unregister()</a>, <a class="el" href="mdt__handler_8c_source.html#l00108">mdt_hsm_cdt_kmem</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00277">mdt_hsm_find_best_agent()</a>, <a class="el" href="mdt__coordinator_8c_source.html#l00060">mdt_hsm_get_md_hsm()</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01648">mdt_hsm_is_action_compat()</a>, <a class="el" href="mdt__coordinator_8c_source.html#l00623">mdt_hsm_restore_hdl_find()</a>, <a class="el" href="mdt__internal_8h_source.html#l01048">mdt_obd_name()</a>, <a class="el" href="mdt__handler_8c_source.html#l02224">mdt_object_find()</a>, <a class="el" href="mdt__internal_8h_source.html#l00525">mdt_object_put()</a>, <a class="el" href="mdt__handler_8c_source.html#l02771">mdt_object_unlock()</a>, <a class="el" href="mdt__internal_8h_source.html#l00331">mdt_thread_info::mti_env</a>, <a class="el" href="mdt__internal_8h_source.html#l00330">mdt_thread_info::mti_mdt</a>, <a class="el" href="obd__support_8h_source.html#l00857">OBD_SLAB_FREE_PTR</a>, <a class="el" href="lustre__user_8h_source.html#l00513">obd_uuid2str()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__coordinator_8c_source.html#l01544">hsm_cancel_all_actions()</a>, and <a class="el" href="mdt__coordinator_8c_source.html#l00425">mdt_coordinator()</a>.</p>

</div>
</div>
<a class="anchor" id="acc2e72d9f7fffc387ddbf1e06352d95e"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_unregister" ref="acc2e72d9f7fffc387ddbf1e06352d95e" args="(struct mdt_thread_info *mti, const struct obd_uuid *uuid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_agent_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>mti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>unregister a copy tool </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mti</em>&nbsp;</td><td>[IN] MDT context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>[IN] uuid to be unregistered </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00191">191</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, <a class="el" href="mdt__internal_8h_source.html#l00118">coordinator::cdt_state</a>, <a class="el" href="mdt__internal_8h_source.html#l00098">CDT_STOPPED</a>, <a class="el" href="libcfs__debug_8h_source.html#l00158">D_HSM</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="mdt__internal_8h_source.html#l00477">hsm_agent::ha_archive_cnt</a>, <a class="el" href="mdt__internal_8h_source.html#l00476">hsm_agent::ha_archive_id</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="mdt__internal_8h_source.html#l00218">mdt_device::mdt_coordinator</a>, <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00057">mdt_hsm_agent_lookup()</a>, <a class="el" href="mdt__internal_8h_source.html#l00330">mdt_thread_info::mti_mdt</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__user_8h_source.html#l00513">obd_uuid2str()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00322">mdt_hsm_agent_send()</a>, and <a class="el" href="mdt__hsm_8c_source.html#l00169">mdt_hsm_ct_unregister()</a>.</p>

</div>
</div>
<a class="anchor" id="a2590cfa39d2821765fd81a8e2cddd35f"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_update_statistics" ref="a2590cfa39d2821765fd81a8e2cddd35f" args="(struct coordinator *cdt, int succ_rq, int fail_rq, int new_rq, const struct obd_uuid *uuid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_agent_update_statistics </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcoordinator.html">coordinator</a> *&nbsp;</td>
          <td class="paramname"> <em>cdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>succ_rq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fail_rq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>new_rq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update agent statistics </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mdt</em>&nbsp;</td><td>[IN] MDT device </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>succ_rq</em>&nbsp;</td><td>[IN] number of success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fail_rq</em>&nbsp;</td><td>[IN] number of failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>new_rq</em>&nbsp;</td><td>[IN] number of new requests </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>[IN] agent uuid if all counters == 0, clear counters </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00237">237</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="mdt__internal_8h_source.html#l00482">hsm_agent::ha_failure</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="mdt__internal_8h_source.html#l00479">hsm_agent::ha_requests</a>, <a class="el" href="mdt__internal_8h_source.html#l00480">hsm_agent::ha_success</a>, <a class="el" href="mdt__internal_8h_source.html#l00475">hsm_agent::ha_uuid</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__user_8h_source.html#l00495">obd_uuid_equals()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__requests_8c_source.html#l00336">mdt_cdt_add_request()</a>, and <a class="el" href="mdt__hsm__cdt__requests_8c_source.html#l00424">mdt_cdt_update_request()</a>.</p>

</div>
</div>
<a class="anchor" id="adc10087711d7d674734d277d9e3decc4"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_coordinator_update" ref="adc10087711d7d674734d277d9e3decc4" args="(struct mdt_thread_info *mti, struct hsm_progress_kernel *pgs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_coordinator_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmdt__thread__info.html">mdt_thread_info</a> *&nbsp;</td>
          <td class="paramname"> <em>mti</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhsm__progress__kernel.html">hsm_progress_kernel</a> *&nbsp;</td>
          <td class="paramname"> <em>pgs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update status of a request </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mti</em>&nbsp;</td><td>[IN] </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pgs</em>&nbsp;</td><td>[IN] progress of the copy tool </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00521">521</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01382">mdt_hsm_update_request_state()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm_8c_source.html#l00108">mdt_hsm_progress()</a>.</p>

</div>
</div>
<a class="anchor" id="a9d13dc794fa8f8885ee9c3b098675dd1"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_find_best_agent" ref="a9d13dc794fa8f8885ee9c3b098675dd1" args="(struct coordinator *cdt, __u32 archive, struct obd_uuid *uuid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdt_hsm_find_best_agent </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcoordinator.html">coordinator</a> *&nbsp;</td>
          <td class="paramname"> <em>cdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>archive</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>find the best agent </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdt</em>&nbsp;</td><td>[IN] <a class="el" href="structcoordinator.html">coordinator</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>archive</em>&nbsp;</td><td>[IN] archive number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>[OUT] agent who can serve archive </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00277">277</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>References <a class="el" href="mdt__internal_8h_source.html#l00125">coordinator::cdt_agent_lock</a>, <a class="el" href="mdt__internal_8h_source.html#l00143">coordinator::cdt_agents</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="mdt__internal_8h_source.html#l00477">hsm_agent::ha_archive_cnt</a>, <a class="el" href="mdt__internal_8h_source.html#l00476">hsm_agent::ha_archive_id</a>, <a class="el" href="mdt__internal_8h_source.html#l00474">hsm_agent::ha_list</a>, <a class="el" href="mdt__internal_8h_source.html#l00479">hsm_agent::ha_requests</a>, <a class="el" href="mdt__internal_8h_source.html#l00475">hsm_agent::ha_uuid</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00322">mdt_hsm_agent_send()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ae27f872199c9effc47a6630d21ff2509"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_fops" ref="ae27f872199c9effc47a6630d21ff2509" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct file_operations <a class="el" href="mdt__internal_8h.html#ae27f872199c9effc47a6630d21ff2509">mdt_hsm_agent_fops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .owner          = THIS_MODULE,
        .open           = <a class="code" href="mdt__hsm__cdt__agent_8c.html#abb8bf9a4bccc60d3b8a3976c47d22307" title="public function called at open of /proc file to get list of agents">lprocfs_open_hsm_agent</a>,
        .read           = seq_read,
        .llseek         = seq_lseek,
        .release        = lprocfs_seq_release,
}
</pre></div>
<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00654">654</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5df11d67c20db5fe7316c6821d4fd752"></a><!-- doxytag: member="mdt_hsm_cdt_agent.c::mdt_hsm_agent_proc_ops" ref="a5df11d67c20db5fe7316c6821d4fd752" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct seq_operations <a class="el" href="mdt__hsm__cdt__agent_8c.html#a5df11d67c20db5fe7316c6821d4fd752">mdt_hsm_agent_proc_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .start  = <a class="code" href="mdt__hsm__cdt__agent_8c.html#aad7995d67480a67941839b04f76271e6" title="seq_file method called to start access to /proc file">mdt_hsm_agent_proc_start</a>,
        .next   = <a class="code" href="mdt__hsm__cdt__agent_8c.html#ab2b3831f25d086041670cebf659fdfa2" title="seq_file method called to get next item just returns NULL at eof">mdt_hsm_agent_proc_next</a>,
        .show   = <a class="code" href="mdt__hsm__cdt__agent_8c.html#a109b89d2949765d02de188431ef079bf">mdt_hsm_agent_proc_show</a>,
        .stop   = <a class="code" href="mdt__hsm__cdt__agent_8c.html#aca40e9ef3e1cc6e450395a2729f13982" title="seq_file method called to stop access to /proc file">mdt_hsm_agent_proc_stop</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00626">626</a> of file <a class="el" href="mdt__hsm__cdt__agent_8c_source.html">mdt_hsm_cdt_agent.c</a>.</p>

<p>Referenced by <a class="el" href="mdt__hsm__cdt__agent_8c_source.html#l00637">lprocfs_open_hsm_agent()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
