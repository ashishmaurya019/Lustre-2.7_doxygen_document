<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/osp/osp_trans.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/osp/osp_trans.c File Reference</h1><code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="osp__internal_8h_source.html">osp_internal.h</a>&quot;</code><br/>

<p><a href="osp__trans_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosp__update__args.html">osp_update_args</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The argument for the interpreter callback of osp request.  <a href="structosp__update__args.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosp__update__callback.html">osp_update_callback</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Call back for each update request.  <a href="structosp__update__callback.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structobject__update__request.html">object_update_request</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a8f61d807f1ce1832da12e92e3219cd2b">object_update_request_alloc</a> (size_t <a class="el" href="parallel__grouplock_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a944ee7971f4e4493976d4da4baafdfda">osp_object_update_request_create</a> (struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our, size_t <a class="el" href="parallel__grouplock_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate new update request.  <a href="#a944ee7971f4e4493976d4da4baafdfda"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structosp__update__request__sub.html">osp_update_request_sub</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a11169ca71acf2f849764ac3e78e595c9">osp_current_object_update_request</a> (struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get current update request.  <a href="#a11169ca71acf2f849764ac3e78e595c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a2ab6c8e8a82925f7fda820d3b20e7225">osp_update_request_create</a> (struct <a class="el" href="structdt__device.html">dt_device</a> *dt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate and initialize <a class="el" href="structosp__update__request.html">osp_update_request</a>.  <a href="#a2ab6c8e8a82925f7fda820d3b20e7225"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a85ed96dbc53b69407ed297d7fa79dfa4">osp_update_request_destroy</a> (struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a2d4b734cf8881edd434c74315bf05743">object_update_request_dump</a> (const struct <a class="el" href="structobject__update__request.html">object_update_request</a> *ourq, unsigned int mask)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a9fc0cd5671c1bb850b0fc89be112b55b">osp_prep_inline_update_req</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our, int repsize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare inline update request.  <a href="#a9fc0cd5671c1bb850b0fc89be112b55b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a286fa51dc4b7827a253690dca8145b21">osp_prep_update_req</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **reqp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare update request.  <a href="#a286fa51dc4b7827a253690dca8145b21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a69fa65d300df0018885545e4d2f99a78">osp_remote_sync</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **reqp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send update RPC.  <a href="#a69fa65d300df0018885545e4d2f99a78"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a1c7d7df2679d2f6fb56e0bf0462ced71">osp_thandle_invalidate_object</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Invalidate all objects in the osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.  <a href="#a1c7d7df2679d2f6fb56e0bf0462ced71"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a8a3c448aa3128d7bee677dd29e13b496">osp_trans_stop_cb</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth, int result)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structosp__update__callback.html">osp_update_callback</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a8b200c68ad9566df44e971d3d256338d">osp_update_callback_init</a> (struct <a class="el" href="structosp__object.html">osp_object</a> *obj, void *data, <a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a> interpreter)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate an osp request and initialize it with the given parameters.  <a href="#a8b200c68ad9566df44e971d3d256338d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#aa4cd6b79c6733e6c662053c039af0b8e">osp_update_callback_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__update__callback.html">osp_update_callback</a> *ouc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy the <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a>.  <a href="#aa4cd6b79c6733e6c662053c039af0b8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a067dfbd2cb3a4bd51b2e14112d692405">osp_update_interpret</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, void *arg, int rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Interpret the packaged OUT RPC results.  <a href="#a067dfbd2cb3a4bd51b2e14112d692405"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#ae2aa51f12a3af0c62972e20c93d7654c">osp_unplug_async_request</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pack all the requests in the shared asynchronous idempotent request queue into a single OUT RPC that will be given to the background <a class="el" href="structptlrpcd.html">ptlrpcd</a> daemon.  <a href="#ae2aa51f12a3af0c62972e20c93d7654c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a47b9f01620cd1a12917730b5a5c7e06e">osp_find_or_create_async_update_request</a> (struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find or create (if NOT exist or purged) the shared asynchronous idempotent request queue - <a class="el" href="structosp__device.html#aeb7e85ef23633ee78d56135dd4fee04b">osp_device::opd_async_requests</a>.  <a href="#a47b9f01620cd1a12917730b5a5c7e06e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a7832d7ba780c8c9dcdb4a707fffa00d2">osp_insert_update_callback</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our, struct <a class="el" href="structosp__object.html">osp_object</a> *obj, void *data, <a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a> interpreter)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert an <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a> into the <a class="el" href="structosp__update__request.html">osp_update_request</a>.  <a href="#a7832d7ba780c8c9dcdb4a707fffa00d2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#adf78c9e7e9976cb1c68011ccc1dd8b01">osp_insert_async_request</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, enum <a class="el" href="group__lustreidl.html#ga2d1a90f202540bfbcbd72a8c0f94b586">update_type</a> <a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, struct <a class="el" href="structosp__object.html">osp_object</a> *obj, int count, __u16 *lens, const void **bufs, void *data, __u32 repsize, <a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a> interpreter)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert an asynchronous idempotent request to the shared request queue that is attached to the <a class="el" href="structosp__device.html">osp_device</a>.  <a href="#adf78c9e7e9976cb1c68011ccc1dd8b01"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#ad85a2edcb3ab6a94d03da547d8b0dd33">osp_trans_update_request_create</a> (struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a6bd88b1bd0177d870b04c84e6f9aea0e">osp_thandle_destroy</a> (struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a2963c05847ee507a77adeb79accdc6f7">osp_trans_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The OSP layer <a class="el" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_device_operations::dt_trans_create()</a> interface to create a transaction.  <a href="#a2963c05847ee507a77adeb79accdc6f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a1a8c6788966fb5ad5c99a44e1e9c8bd6">osp_trans_cb_add</a> (struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *dcb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add commit callback to transaction.  <a href="#a1a8c6788966fb5ad5c99a44e1e9c8bd6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a7115096f3d1076104df517a34791d7b7">osp_trans_commit_cb</a> (struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth, int result)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a3d2ecdd4bc2fe8b7c576d202d76dc0e6">osp_request_commit_cb</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#ac0eee5ec07a43a79b28e19e541e2a3a5">osp_trans_callback</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth, int rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">callback of osp transaction  <a href="#ac0eee5ec07a43a79b28e19e541e2a3a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a814a172ca559ca97e267e775ccba328e">osp_send_update_req</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosp__device.html">osp_device</a> *osp, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *our)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send the request for remote updates.  <a href="#a814a172ca559ca97e267e775ccba328e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#af9e29fa5d9911f2cd76c72c4d9d4d693">osp_get_storage_thandle</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get local <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> for <a class="el" href="structosp__thandle.html">osp_thandle</a>.  <a href="#af9e29fa5d9911f2cd76c72c4d9d4d693"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#acc48914405b387e92e6cfb6c38883562">osp_check_and_set_rpc_version</a> (struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *oth, struct <a class="el" href="structosp__object.html">osp_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set version for the transaction.  <a href="#acc48914405b387e92e6cfb6c38883562"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#aeb036859f4399a9490708c69424e571b">osp_get_next_request</a> (struct <a class="el" href="structosp__updates.html">osp_updates</a> *ou, struct <a class="el" href="structosp__update__request.html">osp_update_request</a> **ourp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get next OSP update request in the sending list Get next OSP update request in the sending list by version number, next request will be 1.  <a href="#aeb036859f4399a9490708c69424e571b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a4e27b17abaedcfafe6e54d44fb616783">osp_invalidate_request</a> (struct <a class="el" href="structosp__device.html">osp_device</a> *osp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Invalidate update request.  <a href="#a4e27b17abaedcfafe6e54d44fb616783"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a7b0be3a2ddb7154bfa24d5b502c8763d">osp_send_update_thread</a> (void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sending update thread.  <a href="#a7b0be3a2ddb7154bfa24d5b502c8763d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#abc06232f12babe95aefb7105d7008d69">osp_trans_start</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The OSP layer <a class="el" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_device_operations::dt_trans_start()</a> interface to start the transaction.  <a href="#abc06232f12babe95aefb7105d7008d69"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osp__trans_8c.html#a38da7db0c90fa482dc7eab274b4775ef">osp_trans_stop</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The OSP layer <a class="el" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_device_operations::dt_trans_stop()</a> interface to stop the transaction.  <a href="#a38da7db0c90fa482dc7eab274b4775ef"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="osp_trans.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00067">67</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8f61d807f1ce1832da12e92e3219cd2b"></a><!-- doxytag: member="osp_trans.c::object_update_request_alloc" ref="a8f61d807f1ce1832da12e92e3219cd2b" args="(size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structobject__update__request.html">object_update_request</a>* object_update_request_alloc </td>
          <td>(</td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00100">100</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="lustre__idl_8h_source.html#l03842">object_update_request::ourq_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03841">object_update_request::ourq_magic</a>, and <a class="el" href="lustre__idl_8h_source.html#l03838">UPDATE_REQUEST_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00125">osp_object_update_request_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d4b734cf8881edd434c74315bf05743"></a><!-- doxytag: member="osp_trans.c::object_update_request_dump" ref="a2d4b734cf8881edd434c74315bf05743" args="(const struct object_update_request *ourq, unsigned int mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void object_update_request_dump </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structobject__update__request.html">object_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>ourq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00222">222</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l03889">object_update_request_get()</a>, <a class="el" href="lustre__idl_8h_source.html#l03831">object_update::ou_batchid</a>, <a class="el" href="lustre__idl_8h_source.html#l03832">object_update::ou_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03827">object_update::ou_params_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03828">object_update::ou_result_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03826">object_update::ou_type</a>, <a class="el" href="lustre__idl_8h_source.html#l03842">object_update_request::ourq_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03841">object_update_request::ourq_magic</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, and <a class="el" href="out__lib_8c_source.html#l00043">update_op_str()</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00314">osp_prep_update_req()</a>.</p>

</div>
</div>
<a class="anchor" id="acc48914405b387e92e6cfb6c38883562"></a><!-- doxytag: member="osp_trans.c::osp_check_and_set_rpc_version" ref="acc48914405b387e92e6cfb6c38883562" args="(struct osp_thandle *oth, struct osp_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_check_and_set_rpc_version </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__object.html">osp_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set version for the transaction. </p>
<p>Set the version for the transaction and add the request to the sending list, then after transaction stop, the request will be picked in the order of version, by sending thread.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oth</em>&nbsp;</td><td>osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to be set version.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if set version succeeds negative errno if set version fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01264">1264</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="osp__internal_8h_source.html#l00454">dt2osp_dev()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__internal_8h_source.html#l00292">osp_object::opo_stale</a>, <a class="el" href="osp__internal_8h_source.html#l00697">osp_thandle_get()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__internal_8h_source.html#l00130">osp_updates::ou_list</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00135">osp_updates::ou_version</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00121">osp_update_request::our_list_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00125">osp_update_request::our_req_ready</a>, <a class="el" href="osp__internal_8h_source.html#l00119">osp_update_request::our_version</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, and <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_wait_submit</a>.</p>

<p>Referenced by <a class="el" href="osp__md__object_8c_source.html#l01090">osp_md_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a11169ca71acf2f849764ac3e78e595c9"></a><!-- doxytag: member="osp_trans.c::osp_current_object_update_request" ref="a11169ca71acf2f849764ac3e78e595c9" args="(struct osp_update_request *our)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structosp__update__request__sub.html">osp_update_request_sub</a>* osp_current_object_update_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get current update request. </p>
<p>Get current object update request from our_req_list in <a class="el" href="structosp__update__request.html">osp_update_request</a>, because we always insert the new update request in the last position, so the last update request in the list will be the current update req.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>our</em>&nbsp;</td><td>osp update request where to get the current object update.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>current object update. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00166">166</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00101">osp_update_request_sub::ours_list</a>, and <a class="el" href="list_8h_source.html#l00043">list_head::prev</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00835">osp_declare_xattr_get()</a>, and <a class="el" href="osp__trans_8c_source.html#l00840">osp_insert_async_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a47b9f01620cd1a12917730b5a5c7e06e"></a><!-- doxytag: member="osp_trans.c::osp_find_or_create_async_update_request" ref="a47b9f01620cd1a12917730b5a5c7e06e" args="(struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structosp__update__request.html">osp_update_request</a>* osp_find_or_create_async_update_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find or create (if NOT exist or purged) the shared asynchronous idempotent request queue - <a class="el" href="structosp__device.html#aeb7e85ef23633ee78d56135dd4fee04b">osp_device::opd_async_requests</a>. </p>
<p>If the <a class="el" href="structosp__device.html#aeb7e85ef23633ee78d56135dd4fee04b">osp_device::opd_async_requests</a> is not NULL, then return it directly; otherwise create new <a class="el" href="structosp__update__request.html">osp_update_request</a> and attach it to opd_async_requests.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>pointer to the OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the shared queue </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00768">768</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="osp__internal_8h_source.html#l00247">osp_device::opd_async_requests</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, and <a class="el" href="osp__trans_8c_source.html#l00187">osp_update_request_create()</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00840">osp_insert_async_request()</a>.</p>

</div>
</div>
<a class="anchor" id="aeb036859f4399a9490708c69424e571b"></a><!-- doxytag: member="osp_trans.c::osp_get_next_request" ref="aeb036859f4399a9490708c69424e571b" args="(struct osp_updates *ou, struct osp_update_request **ourp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool osp_get_next_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__updates.html">osp_updates</a> *&nbsp;</td>
          <td class="paramname"> <em>ou</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> **&nbsp;</td>
          <td class="paramname"> <em>ourp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get next OSP update request in the sending list Get next OSP update request in the sending list by version number, next request will be 1. </p>
<p>transaction which does not have a version number. 2. transaction whose version == opd_rpc_version.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ou</em>&nbsp;</td><td>osp update structure. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>ourp</em>&nbsp;</td><td>the pointer holding the next update request.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>if getting the next transaction. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>if not getting the next transaction. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01315">1315</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="osp__internal_8h_source.html#l00130">osp_updates::ou_list</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00134">osp_updates::ou_rpc_version</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00121">osp_update_request::our_list_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00125">osp_update_request::our_req_ready</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, and <a class="el" href="osp__internal_8h_source.html#l00119">osp_update_request::our_version</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01423">osp_send_update_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="af9e29fa5d9911f2cd76c72c4d9d4d693"></a><!-- doxytag: member="osp_trans.c::osp_get_storage_thandle" ref="af9e29fa5d9911f2cd76c72c4d9d4d693" args="(const struct lu_env *env, struct thandle *th, struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthandle.html">thandle</a>* osp_get_storage_thandle </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get local <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> for <a class="el" href="structosp__thandle.html">osp_thandle</a>. </p>
<p>Get the local OSD <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> from the OSP <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. Currently, there are a few OSP API (<a class="el" href="osp__object_8c.html#af498986402b3be3292cfbd9d93d8273b" title="Implement OSP layer dt_object_operations::do_create() interface.">osp_object_create()</a> and <a class="el" href="osp__internal_8h.html#ad84dcbea0dbe8c7aba1d3a5514e236f0">osp_sync_add()</a>) needs to update the object on local OSD device.</p>
<p>If the <a class="el" href="structosp__thandle.html">osp_thandle</a> comes from normal stack (MDD-&gt;LOD-&gt;OSP), then we will get local <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> by thandle_get_sub_by_dt.</p>
<p>If the <a class="el" href="structosp__thandle.html">osp_thandle</a> is remote <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> (th_top == NULL, only used by LFSCK), then it will create a local <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>, and stop it in <a class="el" href="osp__internal_8h.html#a38da7db0c90fa482dc7eab274b4775ef" title="The OSP layer dt_device_operations::dt_trans_stop() interface to stop the transaction...">osp_trans_stop()</a>. And this only happens on OSP for OST.</p>
<p>These are temporary solution, once OSP accessing OSD object is being fixed properly, this function should be removed. XXX</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>pointer to the transaction handler </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>pointer to the OSP device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the local <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>if it fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01227">1227</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00148">osp_device::opd_storage</a>, <a class="el" href="osp__internal_8h_source.html#l00353">osp_thandle::ot_storage_th</a>, <a class="el" href="dt__object_8h_source.html#l01836">thandle::th_top</a>, <a class="el" href="update__trans_8c_source.html#l01164">thandle_get_sub_by_dt()</a>, and <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l01309">osp_declare_object_create()</a>, and <a class="el" href="osp__object_8c_source.html#l01417">osp_object_create()</a>.</p>

</div>
</div>
<a class="anchor" id="adf78c9e7e9976cb1c68011ccc1dd8b01"></a><!-- doxytag: member="osp_trans.c::osp_insert_async_request" ref="adf78c9e7e9976cb1c68011ccc1dd8b01" args="(const struct lu_env *env, enum update_type op, struct osp_object *obj, int count, __u16 *lens, const void **bufs, void *data, __u32 repsize, osp_update_interpreter_t interpreter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_insert_async_request </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreidl.html#ga2d1a90f202540bfbcbd72a8c0f94b586">update_type</a>&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__object.html">osp_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>lens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void **&nbsp;</td>
          <td class="paramname"> <em>bufs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>repsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a>&nbsp;</td>
          <td class="paramname"> <em>interpreter</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert an asynchronous idempotent request to the shared request queue that is attached to the <a class="el" href="structosp__device.html">osp_device</a>. </p>
<p>This function generates a new osp_async_request with the given parameters, then tries to insert the request into the osp_device-based shared request queue. If the queue is full, then triggers the packaged OUT RPC to purge the shared queue firstly, and then re-tries.</p>
<p>NOTE: must hold the osp::opd_async_requests_mutex to serialize concurrent osp_insert_async_request call from others.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>op</em>&nbsp;</td><td>operation type, see 'enum update_type' </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the operation target </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>count</em>&nbsp;</td><td>array size of the subsequent <em>lens</em> and <em>bufs</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lens</em>&nbsp;</td><td>buffer length array for the subsequent <em>bufs</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bufs</em>&nbsp;</td><td>the buffers to compose the request </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to the data used by the interpreter </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>repsize</em>&nbsp;</td><td>how many bytes the caller allocated for <em>data</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>interpreter</em>&nbsp;</td><td>pointer to the interpreter function</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00840">840</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osp__internal_8h_source.html#l00443">lu2osp_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lustre__update_8h_source.html#l00203">object_update_request_size()</a>, <a class="el" href="osp__internal_8h_source.html#l00247">osp_device::opd_async_requests</a>, <a class="el" href="osp__internal_8h_source.html#l00249">osp_device::opd_async_requests_mutex</a>, <a class="el" href="osp__internal_8h_source.html#l00466">osp2lu_obj()</a>, <a class="el" href="osp__trans_8c_source.html#l00166">osp_current_object_update_request()</a>, <a class="el" href="osp__trans_8c_source.html#l00768">osp_find_or_create_async_update_request()</a>, <a class="el" href="osp__trans_8c_source.html#l00799">osp_insert_update_callback()</a>, <a class="el" href="osp__trans_8c_source.html#l00714">osp_unplug_async_request()</a>, <a class="el" href="osp__internal_8h_source.html#l00112">osp_update_request::our_update_nr</a>, <a class="el" href="lustre__idl_8h_source.html#l03842">object_update_request::ourq_count</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, <a class="el" href="osp__internal_8h_source.html#l00099">osp_update_request_sub::ours_req_size</a>, <a class="el" href="out__lib_8c_source.html#l00146">out_update_pack()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="osp__md__object_8c_source.html#l00141">update_buffer_get_update()</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00503">osp_declare_attr_get()</a>, and <a class="el" href="osp__object_8c_source.html#l00835">osp_declare_xattr_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a7832d7ba780c8c9dcdb4a707fffa00d2"></a><!-- doxytag: member="osp_trans.c::osp_insert_update_callback" ref="a7832d7ba780c8c9dcdb4a707fffa00d2" args="(const struct lu_env *env, struct osp_update_request *our, struct osp_object *obj, void *data, osp_update_interpreter_t interpreter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_insert_update_callback </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__object.html">osp_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a>&nbsp;</td>
          <td class="paramname"> <em>interpreter</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert an <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a> into the <a class="el" href="structosp__update__request.html">osp_update_request</a>. </p>
<p>Insert an <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a> to the <a class="el" href="structosp__update__request.html">osp_update_request</a>. Usually each update in the <a class="el" href="structosp__update__request.html">osp_update_request</a> will have one correspondent callback, and these callbacks will be called in rq_interpret_reply.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the operation target object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to the data used by the interpreter </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>interpreter</em>&nbsp;</td><td>pointer to the interpreter function</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00799">799</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="osp__trans_8c_source.html#l00558">osp_update_callback_init()</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, <a class="el" href="osp__internal_8h_source.html#l00114">osp_update_request::our_cb_items</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00840">osp_insert_async_request()</a>, <a class="el" href="osp__md__object_8c_source.html#l00173">osp_md_object_create()</a>, and <a class="el" href="osp__md__object_8c_source.html#l00983">osp_md_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="a4e27b17abaedcfafe6e54d44fb616783"></a><!-- doxytag: member="osp_trans.c::osp_invalidate_request" ref="a4e27b17abaedcfafe6e54d44fb616783" args="(struct osp_device *osp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void osp_invalidate_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Invalidate update request. </p>
<p>Invalidate update request in the OSP sending list, so all of requests in the sending list will return error, which happens when it finds one update (with writing llog) requests fails or the OSP is evicted by remote target. see <a class="el" href="osp__internal_8h.html#a7b0be3a2ddb7154bfa24d5b502c8763d" title="Sending update thread.">osp_send_update_thread()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>OSP device whose update requests will be invalidated. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01354">1354</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lu__object_8h_source.html#l00275">lu_device::ld_type</a>, <a class="el" href="lu__object_8h_source.html#l00336">lu_device_type::ldt_ctx_tags</a>, <a class="el" href="lnetctl_8c_source.html#l00969">list</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c.html#a16b50f3e067967583e9d2bc2eeb7ff68">LIST_HEAD()</a>, <a class="el" href="list_8h_source.html#l00137">list_move()</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__internal_8h_source.html#l00130">osp_updates::ou_list</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00134">osp_updates::ou_rpc_version</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00121">osp_update_request::our_list_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00125">osp_update_request::our_req_ready</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="osp__internal_8h_source.html#l00119">osp_update_request::our_version</a>, and <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l01574">osp_import_event()</a>, and <a class="el" href="osp__trans_8c_source.html#l01423">osp_send_update_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a944ee7971f4e4493976d4da4baafdfda"></a><!-- doxytag: member="osp_trans.c::osp_object_update_request_create" ref="a944ee7971f4e4493976d4da4baafdfda" args="(struct osp_update_request *our, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_object_update_request_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate new update request. </p>
<p>Allocate new update request and insert it to the req_update_list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>our</em>&nbsp;</td><td>osp_udate_request where to create a new update request</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if creation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if creation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00125">125</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__trans_8c_source.html#l00100">object_update_request_alloc()</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00111">osp_update_request::our_req_nr</a>, <a class="el" href="osp__internal_8h_source.html#l00101">osp_update_request_sub::ours_list</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, <a class="el" href="osp__internal_8h_source.html#l00099">osp_update_request_sub::ours_req_size</a>, and <a class="el" href="lustre__update_8h_source.html#l00036">OUT_UPDATE_INIT_BUFFER_SIZE</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00187">osp_update_request_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a9fc0cd5671c1bb850b0fc89be112b55b"></a><!-- doxytag: member="osp_trans.c::osp_prep_inline_update_req" ref="a9fc0cd5671c1bb850b0fc89be112b55b" args="(const struct lu_env *env, struct ptlrpc_request *req, struct osp_update_request *our, int repsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_prep_inline_update_req </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>repsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare inline update request. </p>
<p>Prepare OUT update ptlrpc inline request, and the request usually includes one update buffer, which does not need bulk transfer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>req</em>&nbsp;</td><td>ptlrpc request </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ours</em>&nbsp;</td><td>sub <a class="el" href="structosp__update__request.html">osp_update_request</a> to be packed</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if packing succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if packing fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00262">262</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="packet-lustre_8c_source.html#l00077">LUSTRE_MDS_VERSION</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="lustre__update_8h_source.html#l00203">object_update_request_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l00094">OSC_REPLY_PORTAL</a>, <a class="el" href="lustre__idl_8h_source.html#l03852">out_update_header::ouh_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03855">out_update_header::ouh_inline_data</a>, <a class="el" href="lustre__idl_8h_source.html#l03853">out_update_header::ouh_inline_length</a>, <a class="el" href="lustre__idl_8h_source.html#l03851">out_update_header::ouh_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l03854">out_update_header::ouh_reply_size</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, <a class="el" href="lustre__idl_8h_source.html#l00114">OUT_PORTAL</a>, <a class="el" href="lustre__idl_8h_source.html#l02037">OUT_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l03847">OUT_UPDATE_HEADER_MAGIC</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01231">RMF_OUT_UPDATE_HEADER</a>, <a class="el" href="layout_8c_source.html#l01199">RMF_OUT_UPDATE_REPLY</a>, and <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00314">osp_prep_update_req()</a>.</p>

</div>
</div>
<a class="anchor" id="a286fa51dc4b7827a253690dca8145b21"></a><!-- doxytag: member="osp_trans.c::osp_prep_update_req" ref="a286fa51dc4b7827a253690dca8145b21" args="(const struct lu_env *env, struct obd_import *imp, struct osp_update_request *our, struct ptlrpc_request **reqp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_prep_update_req </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **&nbsp;</td>
          <td class="paramname"> <em>reqp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare update request. </p>
<p>Prepare OUT update ptlrpc request, and the request usually includes all of updates (stored in </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ureq)</em>&nbsp;</td><td>from one operation.</td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>imp</em>&nbsp;</td><td>import on which ptlrpc request will be sent </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ureq</em>&nbsp;</td><td>hold all of updates which will be packed into the req </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>reqp</em>&nbsp;</td><td>request to be created</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if preparation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if preparation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00314">314</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="structptlrpc__bulk__frag__ops.html#a071eacf4504ae84799e0f989a0e43229">ptlrpc_bulk_frag_ops::add_iov_frag</a>, <a class="el" href="lustre__net_8h_source.html#l01451">ptlrpc_bulk_desc::bd_frag_ops</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lnet_2include_2lnet_2types_8h_source.html#l00446">LNET_MTU_BITS</a>, <a class="el" href="packet-lustre_8c_source.html#l00077">LUSTRE_MDS_VERSION</a>, <a class="el" href="lustre__net_8h_source.html#l00108">MD_MAX_BRW_SIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l00104">MDS_BULK_PORTAL</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="osp__trans_8c_source.html#l00222">object_update_request_dump()</a>, <a class="el" href="lustre__idl_8h_source.html#l03889">object_update_request_get()</a>, <a class="el" href="lustre__update_8h_source.html#l00203">object_update_request_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l00094">OSC_REPLY_PORTAL</a>, <a class="el" href="osp__trans_8c_source.html#l00262">osp_prep_inline_update_req()</a>, <a class="el" href="lustre__idl_8h_source.html#l03828">object_update::ou_result_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03859">out_update_buffer::oub_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03852">out_update_header::ouh_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03853">out_update_header::ouh_inline_length</a>, <a class="el" href="lustre__idl_8h_source.html#l03851">out_update_header::ouh_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l03854">out_update_header::ouh_reply_size</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00112">osp_update_request::our_update_nr</a>, <a class="el" href="lustre__idl_8h_source.html#l03925">object_update_reply::ourp_lens</a>, <a class="el" href="lustre__idl_8h_source.html#l03842">object_update_request::ourq_count</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, <a class="el" href="osp__internal_8h_source.html#l00099">osp_update_request_sub::ours_req_size</a>, <a class="el" href="lustre__idl_8h_source.html#l00114">OUT_PORTAL</a>, <a class="el" href="lustre__idl_8h_source.html#l02037">OUT_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l03847">OUT_UPDATE_HEADER_MAGIC</a>, <a class="el" href="lustre__idl_8h_source.html#l03848">OUT_UPDATE_MAX_INLINE_SIZE</a>, <a class="el" href="lustre__update_8h_source.html#l00037">OUT_UPDATE_REPLY_SIZE</a>, <a class="el" href="lustre__net_8h_source.html#l01336">PTLRPC_BULK_BUF_KVEC</a>, <a class="el" href="lustre__net_8h_source.html#l01338">PTLRPC_BULK_GET_SOURCE</a>, <a class="el" href="client_8c_source.html#l00062">ptlrpc_bulk_kvec_ops</a>, <a class="el" href="client_8c_source.html#l00174">ptlrpc_prep_bulk_imp()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="client_8c_source.html#l00852">ptlrpc_request_alloc()</a>, <a class="el" href="client_8c_source.html#l00762">ptlrpc_request_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00058">RCL_CLIENT</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02117">req_capsule_client_get()</a>, <a class="el" href="layout_8c_source.html#l02226">req_capsule_set_size()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01235">RMF_OUT_UPDATE_BUF</a>, <a class="el" href="layout_8c_source.html#l01231">RMF_OUT_UPDATE_HEADER</a>, <a class="el" href="layout_8c_source.html#l01199">RMF_OUT_UPDATE_REPLY</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_bulk_write</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="layout_8c_source.html#l01436">RQF_OUT_UPDATE</a>, and <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>.</p>

<p>Referenced by <a class="el" href="osp__md__object_8c_source.html#l01126">osp_md_read()</a>, <a class="el" href="osp__trans_8c_source.html#l00442">osp_remote_sync()</a>, <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>, and <a class="el" href="osp__trans_8c_source.html#l00714">osp_unplug_async_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a69fa65d300df0018885545e4d2f99a78"></a><!-- doxytag: member="osp_trans.c::osp_remote_sync" ref="a69fa65d300df0018885545e4d2f99a78" args="(const struct lu_env *env, struct osp_device *osp, struct osp_update_request *our, struct ptlrpc_request **reqp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_remote_sync </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> **&nbsp;</td>
          <td class="paramname"> <em>reqp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send update RPC. </p>
<p>Send update request to the remote MDT synchronously.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>imp</em>&nbsp;</td><td>import on which ptlrpc request will be sent </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>our</em>&nbsp;</td><td>hold all of updates which will be packed into the req </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>reqp</em>&nbsp;</td><td>request to be created</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if RPC succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if RPC fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00442">442</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__trans_8c_source.html#l00314">osp_prep_update_req()</a>, <a class="el" href="osp__internal_8h_source.html#l00107">osp_update_request::our_rc</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_allow_intr</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_allow_replay</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00542">osp_attr_get()</a>, <a class="el" href="osp__md__object_8c_source.html#l00480">osp_md_index_lookup()</a>, and <a class="el" href="osp__object_8c_source.html#l00916">osp_xattr_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d2ecdd4bc2fe8b7c576d202d76dc0e6"></a><!-- doxytag: member="osp_trans.c::osp_request_commit_cb" ref="a3d2ecdd4bc2fe8b7c576d202d76dc0e6" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_request_commit_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01019">1019</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__import_8h_source.html#l00248">obd_import::imp_peer_committed_transno</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="pack__generic_8c_source.html#l01044">lustre_msg_get_last_committed()</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01002">osp_trans_commit_cb()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_committed</a>, <a class="el" href="lustre__net_8h_source.html#l01104">ptlrpc_request::rq_import</a>, <a class="el" href="lustre__net_8h_source.html#l01032">ptlrpc_request::rq_repmsg</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, <a class="el" href="lustre__net_8h_source.html#l01034">ptlrpc_request::rq_transno</a>, and <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>.</p>

</div>
</div>
<a class="anchor" id="a814a172ca559ca97e267e775ccba328e"></a><!-- doxytag: member="osp_trans.c::osp_send_update_req" ref="a814a172ca559ca97e267e775ccba328e" args="(const struct lu_env *env, struct osp_device *osp, struct osp_update_request *our)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_send_update_req </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send the request for remote updates. </p>
<p>Send updates to the remote MDT. Prepare the request by osp_update_req and send them to remote MDT, for sync request, it will wait until the reply return, otherwise hand it to <a class="el" href="structptlrpcd.html">ptlrpcd</a>.</p>
<p>Please refer to <a class="el" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create()</a> for transaction type.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>pointer to the OSP device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>our</em>&nbsp;</td><td>pointer to the <a class="el" href="structosp__update__request.html">osp_update_request</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01104">1104</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lu__object_8h_source.html#l00619">lu_site::ls_top_dev</a>, <a class="el" href="osp__trans_8c_source.html#l00077">osp_update_args::oaua_count</a>, <a class="el" href="osp__trans_8c_source.html#l00079">osp_update_args::oaua_flow_control</a>, <a class="el" href="osp__trans_8c_source.html#l00076">osp_update_args::oaua_update</a>, <a class="el" href="osp__trans_8c_source.html#l00080">osp_update_args::oaua_update_env</a>, <a class="el" href="osp__trans_8c_source.html#l00078">osp_update_args::oaua_waitq</a>, <a class="el" href="genops_8c_source.html#l01965">obd_get_request_slot()</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="osp__internal_8h_source.html#l00252">osp_device::opd_async_updates_count</a>, <a class="el" href="osp__internal_8h_source.html#l00251">osp_device::opd_async_updates_rwsem</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_active</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_imp_connected</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00228">osp_device::opd_syn_barrier_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00495">osp_get_rpc_lock()</a>, <a class="el" href="osp__trans_8c_source.html#l00314">osp_prep_update_req()</a>, <a class="el" href="osp__internal_8h_source.html#l00502">osp_put_rpc_lock()</a>, <a class="el" href="osp__trans_8c_source.html#l01019">osp_request_commit_cb()</a>, <a class="el" href="osp__internal_8h_source.html#l00697">osp_thandle_get()</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__trans_8c_source.html#l00605">osp_update_interpret()</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="client_8c_source.html#l02829">ptlrpc_queue_wait()</a>, <a class="el" href="lustre__net_8h_source.html#l00505">ptlrpc_req_async_args</a>, <a class="el" href="client_8c_source.html#l02490">ptlrpc_req_finished()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00268">ptlrpcd_add_req()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_allow_replay</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_committed</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, <a class="el" href="lustre__net_8h_source.html#l01034">ptlrpc_request::rq_transno</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_wait_submit</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01423">osp_send_update_thread()</a>, and <a class="el" href="osp__trans_8c_source.html#l01542">osp_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b0be3a2ddb7154bfa24d5b502c8763d"></a><!-- doxytag: member="osp_trans.c::osp_send_update_thread" ref="a7b0be3a2ddb7154bfa24d5b502c8763d" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_send_update_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sending update thread. </p>
<p>Create thread to send update request to other MDTs, this thread will pull out update request from the list in OSP by version number, i.e. it will make sure the update request with lower version number will be sent first.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>arg</em>&nbsp;</td><td>hold the OSP device.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the thread is created successfully.  negative error if the thread is not created successfully. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01423">1423</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00275">lu_device::ld_type</a>, <a class="el" href="lu__object_8h_source.html#l00336">lu_device_type::ldt_ctx_tags</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00576">OBD_FAIL_INVALIDATE_UPDATE</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00139">osp_device::opd_dt_dev</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__internal_8h_source.html#l00188">osp_device::opd_update_thread</a>, <a class="el" href="osp__trans_8c_source.html#l01315">osp_get_next_request()</a>, <a class="el" href="osp__trans_8c_source.html#l01354">osp_invalidate_request()</a>, <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>, <a class="el" href="osp__internal_8h_source.html#l00650">osp_send_update_thread_running()</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__internal_8h_source.html#l00131">osp_updates::ou_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00134">osp_updates::ou_rpc_version</a>, <a class="el" href="osp__internal_8h_source.html#l00132">osp_updates::ou_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="osp__internal_8h_source.html#l00119">osp_update_request::our_version</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="osp__dev_8c_source.html#l00498">osp_update_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a6bd88b1bd0177d870b04c84e6f9aea0e"></a><!-- doxytag: member="osp_trans.c::osp_thandle_destroy" ref="a6bd88b1bd0177d870b04c84e6f9aea0e" args="(struct osp_thandle *oth)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void osp_thandle_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00919">919</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00348">OSP_THANDLE_MAGIC</a>, <a class="el" href="osp__trans_8c_source.html#l00204">osp_update_request_destroy()</a>, <a class="el" href="osp__internal_8h_source.html#l00355">osp_thandle::ot_commit_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00354">osp_thandle::ot_magic</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, and <a class="el" href="osp__internal_8h_source.html#l00356">osp_thandle::ot_stop_dcb_list</a>.</p>

<p>Referenced by <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c7d7df2679d2f6fb56e0bf0462ced71"></a><!-- doxytag: member="osp_trans.c::osp_thandle_invalidate_object" ref="a1c7d7df2679d2f6fb56e0bf0462ced71" args="(const struct lu_env *env, struct osp_thandle *oth)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_thandle_invalidate_object </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Invalidate all objects in the osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </p>
<p>invalidate all of objects in the update request, which will be called when the transaction is aborted.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oth</em>&nbsp;</td><td>osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00481">481</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="osp__internal_8h_source.html#l00460">lu2osp_obj()</a>, <a class="el" href="lu__object_8c_source.html#l00808">lu_object_find_slice()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__idl_8h_source.html#l03889">object_update_request_get()</a>, <a class="el" href="osp__internal_8h_source.html#l00284">osp_object_attr::ooa_attr</a>, <a class="el" href="osp__internal_8h_source.html#l00301">osp_object::opo_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00299">osp_object::opo_ooa</a>, <a class="el" href="osp__internal_8h_source.html#l00292">osp_object::opo_stale</a>, <a class="el" href="osp__internal_8h_source.html#l00471">osp_obj()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="lustre__idl_8h_source.html#l03832">object_update::ou_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03826">object_update::ou_type</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="lustre__idl_8h_source.html#l03842">object_update_request::ourq_count</a>, <a class="el" href="osp__internal_8h_source.html#l00101">osp_update_request_sub::ours_list</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, <a class="el" href="lustre__idl_8h_source.html#l03796">OUT_WRITE</a>, and <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00527">osp_trans_stop_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0eee5ec07a43a79b28e19e541e2a3a5"></a><!-- doxytag: member="osp_trans.c::osp_trans_callback" ref="ac0eee5ec07a43a79b28e19e541e2a3a5" args="(const struct lu_env *env, struct osp_thandle *oth, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void osp_trans_callback </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>callback of osp transaction </p>
<p>Call all of callbacks for this osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. This will only be called in error handler path. In the normal processing path, these callback will be called in <a class="el" href="osp__trans_8c.html#a3d2ecdd4bc2fe8b7c576d202d76dc0e6">osp_request_commit_cb()</a> and <a class="el" href="osp__trans_8c.html#a067dfbd2cb3a4bd51b2e14112d692405" title="Interpret the packaged OUT RPC results.">osp_update_interpret()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oth</em>&nbsp;</td><td>osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rc</em>&nbsp;</td><td>result of the osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01067">1067</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="osp__trans_8c_source.html#l01002">osp_trans_commit_cb()</a>, <a class="el" href="osp__trans_8c_source.html#l00527">osp_trans_stop_cb()</a>, <a class="el" href="osp__trans_8c_source.html#l00582">osp_update_callback_fini()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__trans_8c_source.html#l00094">osp_update_callback::ouc_data</a>, <a class="el" href="osp__trans_8c_source.html#l00097">osp_update_callback::ouc_interpreter</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, <a class="el" href="osp__trans_8c_source.html#l00091">osp_update_callback::ouc_obj</a>, and <a class="el" href="osp__internal_8h_source.html#l00114">osp_update_request::our_cb_items</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01354">osp_invalidate_request()</a>, <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>, <a class="el" href="osp__trans_8c_source.html#l01423">osp_send_update_thread()</a>, <a class="el" href="osp__trans_8c_source.html#l01542">osp_trans_stop()</a>, and <a class="el" href="osp__dev_8c_source.html#l00546">osp_update_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a8c6788966fb5ad5c99a44e1e9c8bd6"></a><!-- doxytag: member="osp_trans.c::osp_trans_cb_add" ref="a1a8c6788966fb5ad5c99a44e1e9c8bd6" args="(struct thandle *th, struct dt_txn_commit_cb *dcb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_trans_cb_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>dcb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add commit callback to transaction. </p>
<p>Add commit callback to the osp <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>, which will be called when the <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> is committed remotely.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>the <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dcb</em>&nbsp;</td><td>commit callback structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>only</em>&nbsp;</td><td>return 0 for now. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00989">989</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00113">dt_txn_commit_cb::dcb_flags</a>, <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l00112">dt_txn_commit_cb::dcb_magic</a>, <a class="el" href="dt__object_8h_source.html#l00107">DCB_TRANS_STOP</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="osp__internal_8h_source.html#l00355">osp_thandle::ot_commit_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00356">osp_thandle::ot_stop_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>, and <a class="el" href="dt__object_8h_source.html#l00104">TRANS_COMMIT_CB_MAGIC</a>.</p>

</div>
</div>
<a class="anchor" id="a7115096f3d1076104df517a34791d7b7"></a><!-- doxytag: member="osp_trans.c::osp_trans_commit_cb" ref="a7115096f3d1076104df517a34791d7b7" args="(struct osp_thandle *oth, int result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_trans_commit_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01002">1002</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l00112">dt_txn_commit_cb::dcb_magic</a>, <a class="el" href="dt__object_8h_source.html#l00114">dt_txn_commit_cb::dcb_name</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="osp__internal_8h_source.html#l00355">osp_thandle::ot_commit_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00358">osp_thandle::ot_refcount</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, and <a class="el" href="dt__object_8h_source.html#l00104">TRANS_COMMIT_CB_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01019">osp_request_commit_cb()</a>, and <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>.</p>

</div>
</div>
<a class="anchor" id="a2963c05847ee507a77adeb79accdc6f7"></a><!-- doxytag: member="osp_trans.c::osp_trans_create" ref="a2963c05847ee507a77adeb79accdc6f7" args="(const struct lu_env *env, struct dt_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthandle.html">thandle</a>* osp_trans_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The OSP layer <a class="el" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_device_operations::dt_trans_create()</a> interface to create a transaction. </p>
<p>There are two kinds of transactions that will involve OSP:</p>
<p>1) If the transaction only contains the updates on remote server (MDT or OST), such as re-generating the lost OST-object for LFSCK, then it is a remote transaction. For remote transaction, the upper layer caller (such as the LFSCK engine) will call the <a class="el" href="group__dt.html#ga689a89697bff3936cf4d60bd2651dc8a">dt_trans_create()</a> (with the OSP <a class="el" href="structdt__device.html">dt_device</a> as the parameter), then the call will be directed to the <a class="el" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create()</a> that creates the transaction handler and returns it to the caller.</p>
<p>2) If the transcation contains both local and remote updates, such as cross MDTs create under DNE mode, then the upper layer caller will not trigger <a class="el" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create()</a>. Instead, it will call <a class="el" href="group__dt.html#ga689a89697bff3936cf4d60bd2651dc8a">dt_trans_create()</a> on other <a class="el" href="structdt__device.html">dt_device</a>, such as LOD that will generate the transaction handler. Such handler will be used by the whole transaction in subsequent sub-operations.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>pointer to the OSP <a class="el" href="structdt__device.html">dt_device</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the transaction handler </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00956">956</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lu__object_8h_source.html#l01003">LCT_TX_HANDLE</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00348">OSP_THANDLE_MAGIC</a>, <a class="el" href="osp__internal_8h_source.html#l00355">osp_thandle::ot_commit_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00354">osp_thandle::ot_magic</a>, <a class="el" href="osp__internal_8h_source.html#l00358">osp_thandle::ot_refcount</a>, <a class="el" href="osp__internal_8h_source.html#l00356">osp_thandle::ot_stop_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01841">thandle::th_tags</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="abc06232f12babe95aefb7105d7008d69"></a><!-- doxytag: member="osp_trans.c::osp_trans_start" ref="abc06232f12babe95aefb7105d7008d69" args="(const struct lu_env *env, struct dt_device *dt, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_trans_start </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The OSP layer <a class="el" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_device_operations::dt_trans_start()</a> interface to start the transaction. </p>
<p>If the transaction is a remote transaction, then related remote updates will be triggered in the <a class="el" href="osp__internal_8h.html#a38da7db0c90fa482dc7eab274b4775ef" title="The OSP layer dt_device_operations::dt_trans_stop() interface to stop the transaction...">osp_trans_stop()</a>. Please refer to <a class="el" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create()</a> for transaction type.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>pointer to the OSP <a class="el" href="structdt__device.html">dt_device</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>pointer to the transaction handler</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01509">1509</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02054">dt_trans_start()</a>, <a class="el" href="osp__internal_8h_source.html#l00378">is_only_remote_trans()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__internal_8h_source.html#l00353">osp_thandle::ot_storage_th</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__internal_8h_source.html#l00105">osp_update_request::our_flags</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>, and <a class="el" href="lustre__idl_8h_source.html#l03806">UPDATE_FL_SYNC</a>.</p>

</div>
</div>
<a class="anchor" id="a38da7db0c90fa482dc7eab274b4775ef"></a><!-- doxytag: member="osp_trans.c::osp_trans_stop" ref="a38da7db0c90fa482dc7eab274b4775ef" args="(const struct lu_env *env, struct dt_device *dt, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_trans_stop </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The OSP layer <a class="el" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_device_operations::dt_trans_stop()</a> interface to stop the transaction. </p>
<p>If the transaction is a remote transaction, related remote updates will be triggered at the end of this function.</p>
<p>For synchronous mode update or any failed update, the request will be destroyed explicitly when the <a class="el" href="osp__internal_8h.html#a38da7db0c90fa482dc7eab274b4775ef" title="The OSP layer dt_device_operations::dt_trans_stop() interface to stop the transaction...">osp_trans_stop()</a>.</p>
<p>Please refer to <a class="el" href="osp__internal_8h.html#a2963c05847ee507a77adeb79accdc6f7" title="The OSP layer dt_device_operations::dt_trans_create() interface to create a transaction...">osp_trans_create()</a> for transaction type.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>pointer to the OSP <a class="el" href="structdt__device.html">dt_device</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>pointer to the transaction handler</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l01542">1542</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="osp__internal_8h_source.html#l00454">dt2osp_dev()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="osp__internal_8h_source.html#l00167">osp_device::opd_connect_mdt</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00186">osp_device::opd_update</a>, <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>, <a class="el" href="osp__internal_8h_source.html#l00650">osp_send_update_thread_running()</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__internal_8h_source.html#l00353">osp_thandle::ot_storage_th</a>, <a class="el" href="osp__internal_8h_source.html#l00132">osp_updates::ou_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00121">osp_update_request::our_list_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00125">osp_update_request::our_req_ready</a>, <a class="el" href="osp__internal_8h_source.html#l00119">osp_update_request::our_version</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="dt__object_8h_source.html#l01836">thandle::th_top</a>, and <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>.</p>

</div>
</div>
<a class="anchor" id="a8a3c448aa3128d7bee677dd29e13b496"></a><!-- doxytag: member="osp_trans.c::osp_trans_stop_cb" ref="a8a3c448aa3128d7bee677dd29e13b496" args="(const struct lu_env *env, struct osp_thandle *oth, int result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_trans_stop_cb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__thandle.html">osp_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00527">527</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l00112">dt_txn_commit_cb::dcb_magic</a>, <a class="el" href="dt__object_8h_source.html#l00114">dt_txn_commit_cb::dcb_name</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="osp__trans_8c_source.html#l00481">osp_thandle_invalidate_object()</a>, <a class="el" href="osp__internal_8h_source.html#l00356">osp_thandle::ot_stop_dcb_list</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, and <a class="el" href="dt__object_8h_source.html#l00104">TRANS_COMMIT_CB_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, and <a class="el" href="osp__trans_8c_source.html#l00605">osp_update_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="ad85a2edcb3ab6a94d03da547d8b0dd33"></a><!-- doxytag: member="osp_trans.c::osp_trans_update_request_create" ref="ad85a2edcb3ab6a94d03da547d8b0dd33" args="(struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_trans_update_request_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00899">899</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="osp__trans_8c_source.html#l00187">osp_update_request_create()</a>, <a class="el" href="osp__internal_8h_source.html#l00357">osp_thandle::ot_our</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, and <a class="el" href="osp__internal_8h_source.html#l00362">thandle_to_osp_thandle()</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l01236">osp_declare_xattr_del()</a>, <a class="el" href="osp__object_8c_source.html#l01125">osp_declare_xattr_set()</a>, <a class="el" href="osp__md__object_8c_source.html#l00337">osp_md_declare_attr_set()</a>, <a class="el" href="osp__md__object_8c_source.html#l00630">osp_md_declare_index_delete()</a>, <a class="el" href="osp__md__object_8c_source.html#l00573">osp_md_declare_index_insert()</a>, <a class="el" href="osp__md__object_8c_source.html#l00121">osp_md_declare_object_create()</a>, <a class="el" href="osp__md__object_8c_source.html#l00962">osp_md_declare_object_destroy()</a>, <a class="el" href="osp__md__object_8c_source.html#l00264">osp_md_declare_ref_add()</a>, <a class="el" href="osp__md__object_8c_source.html#l00218">osp_md_declare_ref_del()</a>, and <a class="el" href="osp__md__object_8c_source.html#l01053">osp_md_declare_write()</a>.</p>

</div>
</div>
<a class="anchor" id="ae2aa51f12a3af0c62972e20c93d7654c"></a><!-- doxytag: member="osp_trans.c::osp_unplug_async_request" ref="ae2aa51f12a3af0c62972e20c93d7654c" args="(const struct lu_env *env, struct osp_device *osp, struct osp_update_request *our)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osp_unplug_async_request </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__device.html">osp_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pack all the requests in the shared asynchronous idempotent request queue into a single OUT RPC that will be given to the background <a class="el" href="structptlrpcd.html">ptlrpcd</a> daemon. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>osp</em>&nbsp;</td><td>pointer to the OSP device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>our</em>&nbsp;</td><td>pointer to the shared queue</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00714">714</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="osp__trans_8c_source.html#l00077">osp_update_args::oaua_count</a>, <a class="el" href="osp__trans_8c_source.html#l00079">osp_update_args::oaua_flow_control</a>, <a class="el" href="osp__trans_8c_source.html#l00076">osp_update_args::oaua_update</a>, <a class="el" href="osp__trans_8c_source.html#l00080">osp_update_args::oaua_update_env</a>, <a class="el" href="osp__trans_8c_source.html#l00078">osp_update_args::oaua_waitq</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__trans_8c_source.html#l00314">osp_prep_update_req()</a>, <a class="el" href="osp__trans_8c_source.html#l00582">osp_update_callback_fini()</a>, <a class="el" href="osp__trans_8c_source.html#l00605">osp_update_interpret()</a>, <a class="el" href="osp__trans_8c_source.html#l00204">osp_update_request_destroy()</a>, <a class="el" href="osp__trans_8c_source.html#l00094">osp_update_callback::ouc_data</a>, <a class="el" href="osp__trans_8c_source.html#l00097">osp_update_callback::ouc_interpreter</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, <a class="el" href="osp__trans_8c_source.html#l00091">osp_update_callback::ouc_obj</a>, <a class="el" href="osp__internal_8h_source.html#l00114">osp_update_request::our_cb_items</a>, <a class="el" href="lustre__net_8h_source.html#l00505">ptlrpc_req_async_args</a>, <a class="el" href="ptlrpcd_8c_source.html#l00268">ptlrpcd_add_req()</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00835">osp_declare_xattr_get()</a>, and <a class="el" href="osp__trans_8c_source.html#l00840">osp_insert_async_request()</a>.</p>

</div>
</div>
<a class="anchor" id="aa4cd6b79c6733e6c662053c039af0b8e"></a><!-- doxytag: member="osp_trans.c::osp_update_callback_fini" ref="aa4cd6b79c6733e6c662053c039af0b8e" args="(const struct lu_env *env, struct osp_update_callback *ouc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_update_callback_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__update__callback.html">osp_update_callback</a> *&nbsp;</td>
          <td class="paramname"> <em>ouc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy the <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ouc</em>&nbsp;</td><td>pointer to <a class="el" href="structosp__update__callback.html" title="Call back for each update request.">osp_update_callback</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00582">582</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00466">osp2lu_obj()</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, and <a class="el" href="osp__trans_8c_source.html#l00091">osp_update_callback::ouc_obj</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01067">osp_trans_callback()</a>, <a class="el" href="osp__trans_8c_source.html#l00714">osp_unplug_async_request()</a>, and <a class="el" href="osp__trans_8c_source.html#l00605">osp_update_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b200c68ad9566df44e971d3d256338d"></a><!-- doxytag: member="osp_trans.c::osp_update_callback_init" ref="a8b200c68ad9566df44e971d3d256338d" args="(struct osp_object *obj, void *data, osp_update_interpreter_t interpreter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structosp__update__callback.html">osp_update_callback</a>* osp_update_callback_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__object.html">osp_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="osp__internal_8h.html#a3b00e28d2b68085c3ebf8992634dbbca">osp_update_interpreter_t</a>&nbsp;</td>
          <td class="paramname"> <em>interpreter</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate an osp request and initialize it with the given parameters. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the operation target </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to the data used by the interpreter </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>interpreter</em>&nbsp;</td><td>pointer to the interpreter function</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the asychronous request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if the allocation failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00558">558</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lu__object_8h_source.html#l00709">lu_object_get()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00466">osp2lu_obj()</a>, <a class="el" href="osp__trans_8c_source.html#l00094">osp_update_callback::ouc_data</a>, <a class="el" href="osp__trans_8c_source.html#l00097">osp_update_callback::ouc_interpreter</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, and <a class="el" href="osp__trans_8c_source.html#l00091">osp_update_callback::ouc_obj</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l00799">osp_insert_update_callback()</a>.</p>

</div>
</div>
<a class="anchor" id="a067dfbd2cb3a4bd51b2e14112d692405"></a><!-- doxytag: member="osp_trans.c::osp_update_interpret" ref="a067dfbd2cb3a4bd51b2e14112d692405" args="(const struct lu_env *env, struct ptlrpc_request *req, void *arg, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_update_interpret </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Interpret the packaged OUT RPC results. </p>
<p>For every packaged sub-request, call its registered interpreter function. Then destroy the sub-request.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>req</em>&nbsp;</td><td>pointer to the RPC </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>arg</em>&nbsp;</td><td>pointer to data used by the interpreter </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rc</em>&nbsp;</td><td>the RPC return value</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00605">605</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="osp__internal_8h_source.html#l00454">dt2osp_dev()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="osp__trans_8c_source.html#l00077">osp_update_args::oaua_count</a>, <a class="el" href="osp__trans_8c_source.html#l00079">osp_update_args::oaua_flow_control</a>, <a class="el" href="osp__trans_8c_source.html#l00076">osp_update_args::oaua_update</a>, <a class="el" href="osp__trans_8c_source.html#l00080">osp_update_args::oaua_update_env</a>, <a class="el" href="osp__trans_8c_source.html#l00078">osp_update_args::oaua_waitq</a>, <a class="el" href="genops_8c_source.html#l02012">obd_put_request_slot()</a>, <a class="el" href="lustre__idl_8h_source.html#l03929">object_update_result_get()</a>, <a class="el" href="osp__internal_8h_source.html#l00159">osp_device::opd_obd</a>, <a class="el" href="osp__internal_8h_source.html#l00702">osp_thandle_put()</a>, <a class="el" href="osp__trans_8c_source.html#l00527">osp_trans_stop_cb()</a>, <a class="el" href="osp__trans_8c_source.html#l00582">osp_update_callback_fini()</a>, <a class="el" href="osp__trans_8c_source.html#l00204">osp_update_request_destroy()</a>, <a class="el" href="osp__internal_8h_source.html#l00350">osp_thandle::ot_super</a>, <a class="el" href="osp__trans_8c_source.html#l00094">osp_update_callback::ouc_data</a>, <a class="el" href="osp__trans_8c_source.html#l00097">osp_update_callback::ouc_interpreter</a>, <a class="el" href="osp__trans_8c_source.html#l00088">osp_update_callback::ouc_list</a>, <a class="el" href="osp__trans_8c_source.html#l00091">osp_update_callback::ouc_obj</a>, <a class="el" href="osp__internal_8h_source.html#l00114">osp_update_request::our_cb_items</a>, <a class="el" href="lustre__idl_8h_source.html#l03911">object_update_result::our_rc</a>, <a class="el" href="osp__internal_8h_source.html#l00117">osp_update_request::our_th</a>, <a class="el" href="lustre__idl_8h_source.html#l03923">object_update_reply::ourp_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03922">object_update_reply::ourp_magic</a>, <a class="el" href="lustre__update_8h_source.html#l00037">OUT_UPDATE_REPLY_SIZE</a>, <a class="el" href="layout_8c_source.html#l02186">req_capsule_server_sized_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01199">RMF_OUT_UPDATE_REPLY</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_replied</a>, <a class="el" href="lustre__net_8h_source.html#l01032">ptlrpc_request::rq_repmsg</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>, and <a class="el" href="lustre__idl_8h_source.html#l03919">UPDATE_REPLY_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="osp__trans_8c_source.html#l01104">osp_send_update_req()</a>, and <a class="el" href="osp__trans_8c_source.html#l00714">osp_unplug_async_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a2ab6c8e8a82925f7fda820d3b20e7225"></a><!-- doxytag: member="osp_trans.c::osp_update_request_create" ref="a2ab6c8e8a82925f7fda820d3b20e7225" args="(struct dt_device *dt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structosp__update__request.html">osp_update_request</a>* osp_update_request_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate and initialize <a class="el" href="structosp__update__request.html">osp_update_request</a>. </p>
<p><a class="el" href="structosp__update__request.html">osp_update_request</a> is being used to track updates being executed on this dt_device(OSD or OSP). The update buffer will be 4k initially, and increased if needed.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>dt device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structosp__update__request.html">osp_update_request</a></em>&nbsp;</td><td>being allocated if succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>if failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00187">187</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="osp__trans_8c_source.html#l00125">osp_object_update_request_create()</a>, <a class="el" href="osp__internal_8h_source.html#l00114">osp_update_request::our_cb_items</a>, <a class="el" href="osp__internal_8h_source.html#l00123">osp_update_request::our_list</a>, <a class="el" href="osp__internal_8h_source.html#l00121">osp_update_request::our_list_lock</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, and <a class="el" href="lustre__update_8h_source.html#l00036">OUT_UPDATE_INIT_BUFFER_SIZE</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00542">osp_attr_get()</a>, <a class="el" href="osp__trans_8c_source.html#l00768">osp_find_or_create_async_update_request()</a>, <a class="el" href="osp__md__object_8c_source.html#l00480">osp_md_index_lookup()</a>, <a class="el" href="osp__md__object_8c_source.html#l01126">osp_md_read()</a>, <a class="el" href="osp__trans_8c_source.html#l00899">osp_trans_update_request_create()</a>, and <a class="el" href="osp__object_8c_source.html#l00916">osp_xattr_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a85ed96dbc53b69407ed297d7fa79dfa4"></a><!-- doxytag: member="osp_trans.c::osp_update_request_destroy" ref="a85ed96dbc53b69407ed297d7fa79dfa4" args="(struct osp_update_request *our)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void osp_update_request_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__update__request.html">osp_update_request</a> *&nbsp;</td>
          <td class="paramname"> <em>our</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osp__trans_8c_source.html#l00204">204</a> of file <a class="el" href="osp__trans_8c_source.html">osp_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osp__internal_8h_source.html#l00110">osp_update_request::our_req_list</a>, <a class="el" href="osp__internal_8h_source.html#l00101">osp_update_request_sub::ours_list</a>, <a class="el" href="osp__internal_8h_source.html#l00098">osp_update_request_sub::ours_req</a>, and <a class="el" href="osp__internal_8h_source.html#l00099">osp_update_request_sub::ours_req_size</a>.</p>

<p>Referenced by <a class="el" href="osp__object_8c_source.html#l00542">osp_attr_get()</a>, <a class="el" href="osp__dev_8c_source.html#l01319">osp_device_fini()</a>, <a class="el" href="osp__md__object_8c_source.html#l00480">osp_md_index_lookup()</a>, <a class="el" href="osp__md__object_8c_source.html#l01126">osp_md_read()</a>, <a class="el" href="osp__trans_8c_source.html#l00919">osp_thandle_destroy()</a>, <a class="el" href="osp__trans_8c_source.html#l00714">osp_unplug_async_request()</a>, <a class="el" href="osp__trans_8c_source.html#l00605">osp_update_interpret()</a>, and <a class="el" href="osp__object_8c_source.html#l00916">osp_xattr_get()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
