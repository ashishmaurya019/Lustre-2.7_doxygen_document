<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ldlm/ldlm_lib.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ldlm/ldlm_lib.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="libcfs_8h_source.html">libcfs/libcfs.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__dlm_8h_source.html">lustre_dlm.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__sec_8h_source.html">lustre_sec.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ldlm__internal_8h_source.html">ldlm_internal.h</a>&quot;</code><br/>

<p><a href="ldlm__lib_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ldlm__lib_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_LDLM</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This file deals with various client/target related logic including recovery.  <a href="#abda60744d497fcfe370cfd6b2d65c7ed"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ldlm__lib_8c.html#a50988986fe7d66d9e77e8eaa0ea9d52b">import_set_conn</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, int priority, int create)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga7f7cd84c38bd70963730d1338076a21d">import_set_conn_priority</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gace2253d15c74ffe28cf60ed3518258b2">client_import_add_conn</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, int priority)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga770f58b91f82d4b373b35f2b11cdf5d0">client_import_del_conn</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga0d66e2da6f0da4bb948be01b9719af5c">client_import_find_conn</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> peer, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find conn UUID by peer NID.  <a href="group__net.html#ga0d66e2da6f0da4bb948be01b9719af5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga0e64772578519b8f2ed8c0bd50b0a3a1">client_destroy_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ldlm__lib_8c.html#a98682aa881f3effc90265a82af3073ca">osc_on_mdt</a> (char *obdname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether or not the OSC is on MDT.  <a href="#a98682aa881f3effc90265a82af3073ca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gabcdaa31fdbdb87a69a06d19c43bbcda0">client_obd_setup</a> (struct <a class="el" href="structobd__device.html">obd_device</a> *obddev, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Target client logic.  <a href="group__net.html#gabcdaa31fdbdb87a69a06d19c43bbcda0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga41252167a852a9399752defcf029083a">client_obd_cleanup</a> (struct <a class="el" href="structobd__device.html">obd_device</a> *obddev)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gab66008e96b57e399aaf8e48a351478f8">client_connect_import</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> **exp, struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *cluuid, struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *data, void *localdata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gab8ecd3b16250a80c377e9c9f7bfebfb8">client_disconnect_export</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib.html#gafdb6e70a2f301ef0c9e594f8871d9b40">target_pack_pool_reply</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Packs current SLV and Limit into <em>req</em>.  <a href="group__lib.html#gafdb6e70a2f301ef0c9e594f8871d9b40"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ldlm__lib_8c.html#a4c3e059d531320fcecb55ada0d705139">target_send_reply_msg</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, int rc, int fail_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib.html#ga85f5aad1f6441ed3a0d44b17c6b99c7b">target_send_reply</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, int rc, int fail_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__LDLM.html#ga7dac0446d813ef65c24c0831b6d1a519">ldlm_error2errno</a> (enum <a class="el" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7">ldlm_error</a> error)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rather arbitrary mapping from LDLM error codes to errno values.  <a href="group__LDLM.html#ga7dac0446d813ef65c24c0831b6d1a519"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7">ldlm_error</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__LDLM.html#ga9d483fecb156d6db20dc2bfc1d6f11be">ldlm_errno2error</a> (int err_no)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dual to <a class="el" href="group__LDLM.html#ga7dac0446d813ef65c24c0831b6d1a519" title="Rather arbitrary mapping from LDLM error codes to errno values.">ldlm_error2errno()</a>: maps errno values back to enum ldlm_error.  <a href="group__LDLM.html#ga9d483fecb156d6db20dc2bfc1d6f11be"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__LDLM.html#ga3cf0131341b6663da454ede83009988b">lck_compat_array</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="ldlm_lib.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_LDLM</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This file deals with various client/target related logic including recovery. </p>
<p>TODO: This code more logically belongs in the ptlrpc module than in ldlm and should be moved. </p>

<p>Definition at line <a class="el" href="ldlm__lib_8c_source.html#l00044">44</a> of file <a class="el" href="ldlm__lib_8c_source.html">ldlm_lib.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a50988986fe7d66d9e77e8eaa0ea9d52b"></a><!-- doxytag: member="ldlm_lib.c::import_set_conn" ref="a50988986fe7d66d9e77e8eaa0ea9d52b" args="(struct obd_import *imp, struct obd_uuid *uuid, int priority, int create)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int import_set_conn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>create</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ldlm__lib_8c_source.html#l00058">58</a> of file <a class="el" href="ldlm__lib_8c_source.html">ldlm_lib.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__import_8h_source.html#l00267">obd_import::imp_conn_list</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00495">obd_uuid_equals()</a>, <a class="el" href="lustre__import_8h_source.html#l00143">obd_import_conn::oic_conn</a>, <a class="el" href="lustre__import_8h_source.html#l00141">obd_import_conn::oic_item</a>, <a class="el" href="lustre__import_8h_source.html#l00149">obd_import_conn::oic_last_attempt</a>, <a class="el" href="lustre__import_8h_source.html#l00145">obd_import_conn::oic_uuid</a>, <a class="el" href="connection_8c_source.html#l00091">ptlrpc_connection_put()</a>, <a class="el" href="client_8c_source.html#l00086">ptlrpc_uuid_to_connection()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lib_8c_source.html#l00133">client_import_add_conn()</a>, and <a class="el" href="ldlm__lib_8c_source.html#l00128">import_set_conn_priority()</a>.</p>

</div>
</div>
<a class="anchor" id="a98682aa881f3effc90265a82af3073ca"></a><!-- doxytag: member="ldlm_lib.c::osc_on_mdt" ref="a98682aa881f3effc90265a82af3073ca" args="(char *obdname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osc_on_mdt </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>obdname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check whether or not the OSC is on MDT. </p>
<p>In the config log, osc on MDT setup 0:{fsname}-OSTxxxx-osc[-MDTxxxx] 1:lustre-OST0000_UUID 2:NID osc on client setup 0:{fsname}-OSTxxxx-osc 1:lustre-OST0000_UUID 2:NID </p>

<p>Definition at line <a class="el" href="ldlm__lib_8c_source.html#l00240">240</a> of file <a class="el" href="ldlm__lib_8c_source.html">ldlm_lib.c</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lib_8c_source.html#l00261">client_obd_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c3e059d531320fcecb55ada0d705139"></a><!-- doxytag: member="ldlm_lib.c::target_send_reply_msg" ref="a4c3e059d531320fcecb55ada0d705139" args="(struct ptlrpc_request *req, int rc, int fail_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int target_send_reply_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fail_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ldlm__lib_8c_source.html#l02835">2835</a> of file <a class="el" href="ldlm__lib_8c_source.html">ldlm_lib.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00138">D_NET</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="pack__generic_8c_source.html#l00989">lustre_msg_get_opc()</a>, <a class="el" href="packet-lustre_8c_source.html#l00204">MDS_REINT</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00621">OBD_FAIL_CHECK_ORSET</a>, <a class="el" href="obd__support_8h_source.html#l00249">OBD_FAIL_MDS_REINT_MULTI_NET_REP</a>, <a class="el" href="obd__support_8h_source.html#l00628">OBD_FAIL_ONCE</a>, <a class="el" href="lustre__net_8h_source.html#l02065">PTLRPC_REPLY_MAYBE_DIFFICULT</a>, <a class="el" href="niobuf_8c_source.html#l00626">ptlrpc_send_error()</a>, <a class="el" href="niobuf_8c_source.html#l00528">ptlrpc_send_reply()</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="ldlm__lib_8c_source.html#l02860">target_send_reply()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:47 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
