<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/target/update_recovery.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/target/update_recovery.c File Reference</h1><code>#include &lt;<a class="el" href="lu__target_8h_source.html">lu_target.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__obdo_8h_source.html">lustre_obdo.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__update_8h_source.html">lustre_update.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__swab_8h_source.html">lustre_swab.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="md__object_8h_source.html">md_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="tgt__internal_8h_source.html">tgt_internal.h</a>&quot;</code><br/>

<p><a href="update__recovery_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_CLASS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a9f454b70a2b0b742bd4eb16dc76080fe">dtrq_lookup</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> batchid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup distribute_txn_replay req.  <a href="#a9f454b70a2b0b742bd4eb16dc76080fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a133e532cc4b5b870494646b827afbbdd">dtrq_insert</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *new)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">insert distribute txn replay req  <a href="#a133e532cc4b5b870494646b827afbbdd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#ad8dd01935d54dac22d4fb1fd598b7865">dtrq_create</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *<a class="el" href="llog__test_8c.html#a691936eb94060f108728643f5af5a196">lur</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">create distribute txn replay req  <a href="#ad8dd01935d54dac22d4fb1fd598b7865"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <br class="typebreak"/>
<a class="el" href="structdistribute__txn__replay__req__sub.html">distribute_txn_replay_req_sub</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#ae2a40c19fbb51b69714096bb3790c3f3">dtrq_sub_lookup</a> (struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, __u32 mdt_index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup distribute sub replay.  <a href="#ae2a40c19fbb51b69714096bb3790c3f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a51cb1af70b019d86c0c42ff99e5d8c3b">dtrq_sub_add_cookie</a> (struct <a class="el" href="structdistribute__txn__replay__req__sub.html">distribute_txn_replay_req_sub</a> *dtrqs, struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *cookie)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Try to add cookie to sub distribute txn request.  <a href="#a51cb1af70b019d86c0c42ff99e5d8c3b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a9f8f30ffe3d3e2fb561cdd5a6b51c0ee">dtrq_sub_create_and_insert</a> (struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *cookie, __u32 mdt_index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert distribute txn sub req replay.  <a href="#a9f8f30ffe3d3e2fb561cdd5a6b51c0ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#abe60cfb4ad47361cbd782f1a1c8c957a">dtrq_append_updates</a> (struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, struct <a class="el" href="structupdate__records.html">update_records</a> *record)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">append updates to the current replay updates  <a href="#abe60cfb4ad47361cbd782f1a1c8c957a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a80f6b8cf0ec5b651cc8a561775fd3952">insert_update_records_to_replay_list</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *<a class="el" href="llog__test_8c.html#a691936eb94060f108728643f5af5a196">lur</a>, struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *cookie, __u32 mdt_index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert update records to the replay list.  <a href="#a80f6b8cf0ec5b651cc8a561775fd3952"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a06fe5659d9fd4ece73a6fe3ce2a0836f">dtrq_list_dump</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, unsigned int mask)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dump updates of distribute txns.  <a href="#a06fe5659d9fd4ece73a6fe3ce2a0836f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#ab6d23979347a7c679da7837639cad4fb">dtrq_destroy</a> (struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy distribute txn replay req.  <a href="#ab6d23979347a7c679da7837639cad4fb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a24e734097bb6681b5ead7052840a5035">dtrq_list_destroy</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy all of replay req.  <a href="#a24e734097bb6681b5ead7052840a5035"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#ab229e64542f5caae9ab80111044a4362">distribute_txn_get_next_req</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get next req in the replay list.  <a href="#ab229e64542f5caae9ab80111044a4362"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a12b4ef21b103dfcb9d3b939109a4450e">distribute_txn_get_next_transno</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get next transno in the replay list, because this is the sorted list, so it will return the transno of next req in the list.  <a href="#a12b4ef21b103dfcb9d3b939109a4450e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a398dc256ceab3788d49754c1ebe7398c">distribute_txn_lookup_finish_list</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> xid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a38618de03dc6314e7509b6efe2a24559">is_req_replayed_by_update</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#aa80d0da2fdb82f00bb561abf4895b271">update_is_committed</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th, struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *st)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if the update of one object is committed.  <a href="#aa80d0da2fdb82f00bb561abf4895b271"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a4a22f6eb35fe52fb5d084e579ebb8996">update_recovery_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of different update methods for update recovery.  <a href="#a4a22f6eb35fe52fb5d084e579ebb8996"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a667dc34c6a139d50adff099bb549e084">update_recovery_destroy</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a7f11a41d27b82df87febc9aab1cd828d">update_recovery_ref_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a5bf344d23c613f8e4a346aaa5af17fc9">update_recovery_ref_del</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a6c0bfee968ceb23477968b63312f5617">update_recovery_attr_set</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#af256f9b6b34e70948261ec01582500d8">update_recovery_xattr_set</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a0881a15cdf256eced3565774c3c7bda4">update_recovery_index_insert</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a03af5ba86326ead1da5ac61eefa3a597">update_recovery_index_delete</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a959315dc9aa8814a3e9982eea273299f">update_recovery_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#ab1d635944fc59872ce140105e2059368">update_recovery_xattr_del</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt_obj, const struct <a class="el" href="structupdate__op.html">update_op</a> *<a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, const struct <a class="el" href="structupdate__params.html">update_params</a> *params, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#abdeaeeea01064a028f920c4c5b9d5f75">update_recovery_update_ses</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structthandle.html">thandle</a> *master_th, struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, struct <a class="el" href="structtx__arg.html">tx_arg</a> *ta_arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update session information.  <a href="#abdeaeeea01064a028f920c4c5b9d5f75"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a4439e9a84119689a8bf51fb67334dcce">update_recovery_exec</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq, struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *ta)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute updates in the update replay records.  <a href="#a4439e9a84119689a8bf51fb67334dcce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__recovery_8c.html#a71c2a195400c2c213ff1934459935f04">distribute_txn_replay_handle</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *dtrq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">redo updates on MDT if needed.  <a href="#a71c2a195400c2c213ff1934459935f04"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="update_recovery.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_CLASS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00044">44</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab229e64542f5caae9ab80111044a4362"></a><!-- doxytag: member="update_recovery.c::distribute_txn_get_next_req" ref="ab229e64542f5caae9ab80111044a4362" args="(struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a>* distribute_txn_get_next_req </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get next req in the replay list. </p>
<p>Get next req needs to be replayed, since it is a sorted list (by master MDT transno)</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute txn data where the replay list is</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>pointer of update recovery header </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00565">565</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>, and <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>.</p>

</div>
</div>
<a class="anchor" id="a12b4ef21b103dfcb9d3b939109a4450e"></a><!-- doxytag: member="update_recovery.c::distribute_txn_get_next_transno" ref="a12b4ef21b103dfcb9d3b939109a4450e" args="(struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> distribute_txn_get_next_transno </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get next transno in the replay list, because this is the sorted list, so it will return the transno of next req in the list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute txn data where the replay list is</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>transno of next update in the list </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00589">589</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="lu__target_8h_source.html#l00057">distribute_txn_replay_req::dtrq_master_transno</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>, and <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>.</p>

</div>
</div>
<a class="anchor" id="a398dc256ceab3788d49754c1ebe7398c"></a><!-- doxytag: member="update_recovery.c::distribute_txn_lookup_finish_list" ref="a398dc256ceab3788d49754c1ebe7398c" args="(struct target_distribute_txn_data *tdtd, __u64 xid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a>* distribute_txn_lookup_finish_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>xid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00609">609</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="lu__target_8h_source.html#l00059">distribute_txn_replay_req::dtrq_xid</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lu__target_8h_source.html#l00108">target_distribute_txn_data::tdtd_replay_finish_list</a>, and <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00626">is_req_replayed_by_update()</a>.</p>

</div>
</div>
<a class="anchor" id="a71c2a195400c2c213ff1934459935f04"></a><!-- doxytag: member="update_recovery.c::distribute_txn_replay_handle" ref="a71c2a195400c2c213ff1934459935f04" args="(struct lu_env *env, struct target_distribute_txn_data *tdtd, struct distribute_txn_replay_req *dtrq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int distribute_txn_replay_handle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>redo updates on MDT if needed. </p>
<p>During DNE recovery, the recovery thread (target_recovery_thread) will call this function to replay distribute txn updates on all MDTs. It only replay updates on the MDT where the update record is missing.</p>
<p>If the update already exists on the MDT, then it does not need replay the updates on that MDT, and only mark the sub transaction has been committed there.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>target distribute txn data, which holds the replay list and all parameters needed by replay process. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>distribute txn replay req.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if replay succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if replay failes. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l01285">1285</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="update__trans_8c_source.html#l00694">distribute_txn_insert_by_batchid()</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="tgt__internal_8h_source.html#l00118">dt_obd_name()</a>, <a class="el" href="lu__target_8h_source.html#l00058">distribute_txn_replay_req::dtrq_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="lu__target_8h_source.html#l00052">distribute_txn_replay_req::dtrq_lur_size</a>, <a class="el" href="lu__target_8h_source.html#l00057">distribute_txn_replay_req::dtrq_master_transno</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__update_8h_source.html#l00343">tx_arg::exec_fn</a>, <a class="el" href="lustre__update_8h_source.html#l00346">tx_arg::file</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01039">LCT_NOREF</a>, <a class="el" href="lu__object_8h_source.html#l01028">LCT_SERVER_SESSION</a>, <a class="el" href="lu__object_8h_source.html#l01277">lu_env::le_ses</a>, <a class="el" href="lustre__update_8h_source.html#l00348">tx_arg::line</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="update__trans_8c_source.html#l00423">lookup_sub_thandle()</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lu__object_8c_source.html#l01776">lu_context_enter()</a>, <a class="el" href="lu__object_8c_source.html#l01786">lu_context_exit()</a>, <a class="el" href="lu__object_8c_source.html#l01755">lu_context_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01729">lu_context_init()</a>, <a class="el" href="lu__object_8c_source.html#l01889">lu_env_refill()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lu__target_8h_source.html#l00120">lu_target::lut_bottom</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="lu__target_8h_source.html#l00159">lu_target::lut_reply_data</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__update_8h_source.html#l00345">tx_arg::object</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="lustre__update_8h_source.html#l00385">thandle_exec_args::ta_argno</a>, <a class="el" href="lustre__update_8h_source.html#l00387">thandle_exec_args::ta_args</a>, <a class="el" href="lustre__update_8h_source.html#l00384">thandle_exec_args::ta_handle</a>, <a class="el" href="lu__target_8h_source.html#l00096">target_distribute_txn_data::tdtd_committed_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00093">target_distribute_txn_data::tdtd_dt</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lu__target_8h_source.html#l00235">tgt_ses_info()</a>, <a class="el" href="tgt__internal_8h_source.html#l00095">tgt_th_info()</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00284">top_multiple_thandle::tmt_master_sub_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, <a class="el" href="update__trans_8c_source.html#l00598">top_trans_create()</a>, <a class="el" href="update__trans_8c_source.html#l01112">top_trans_create_tmt()</a>, <a class="el" href="update__trans_8c_source.html#l00784">top_trans_start()</a>, <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>, <a class="el" href="lu__target_8h_source.html#l00202">tgt_session_info::tsi_exp</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, <a class="el" href="tgt__internal_8h_source.html#l00066">tgt_thread_info::tti_transno</a>, <a class="el" href="lustre__update_8h_source.html#l00278">thandle_update_records::tur_update_param_count</a>, <a class="el" href="lustre__update_8h_source.html#l00277">thandle_update_records::tur_update_params</a>, <a class="el" href="lustre__update_8h_source.html#l00273">thandle_update_records::tur_update_records</a>, <a class="el" href="lustre__update_8h_source.html#l00274">thandle_update_records::tur_update_records_buf_size</a>, <a class="el" href="lustre__update_8h_source.html#l00344">tx_arg::undo_fn</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="update__records_8c_source.html#l00063">update_records_dump()</a>, <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>, <a class="el" href="update__recovery_8c_source.html#l01066">update_recovery_update_ses()</a>, <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>, <a class="el" href="tgt__internal_8h_source.html#l00263">update_thread_info::uti_tea</a>, and <a class="el" href="tgt__internal_8h_source.html#l00261">update_thread_info::uti_tur</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>.</p>

</div>
</div>
<a class="anchor" id="abe60cfb4ad47361cbd782f1a1c8c957a"></a><!-- doxytag: member="update_recovery.c::dtrq_append_updates" ref="abe60cfb4ad47361cbd782f1a1c8c957a" args="(struct distribute_txn_replay_req *dtrq, struct update_records *record)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dtrq_append_updates </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structupdate__records.html">update_records</a> *&nbsp;</td>
          <td class="paramname"> <em>record</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>append updates to the current replay updates </p>
<p>Append more updates to the existent replay update. And this is only used when combining mulitple updates into one large updates during replay.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>the update replay request where the new update records will be added. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lur</em>&nbsp;</td><td>the new update record.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if appending succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if appending fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00307">307</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="lu__target_8h_source.html#l00052">distribute_txn_replay_req::dtrq_lur_size</a>, <a class="el" href="lu__target_8h_source.html#l00063">distribute_txn_replay_req::dtrq_sub_list_lock</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="lustre__user_8h_source.html#l01032">offsetof</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="update__records_8c_source.html#l00063">update_records_dump()</a>, <a class="el" href="lustre__update_8h_source.html#l00134">update_records_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l04025">update_records::ur_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l04028">update_records::ur_index</a>, <a class="el" href="lustre__idl_8h_source.html#l04031">update_records::ur_ops</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, and <a class="el" href="lustre__idl_8h_source.html#l04029">update_records::ur_update_count</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ad8dd01935d54dac22d4fb1fd598b7865"></a><!-- doxytag: member="update_recovery.c::dtrq_create" ref="ad8dd01935d54dac22d4fb1fd598b7865" args="(struct target_distribute_txn_data *tdtd, struct llog_update_record *lur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a>* dtrq_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *&nbsp;</td>
          <td class="paramname"> <em>lur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>create distribute txn replay req </p>
<p>Allocate distribute txn replay req according to the update records.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>target distribute txn data where replay list is. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>record</em>&nbsp;</td><td>update records from the update log.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>pointer of distribute txn replay req if the creation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if the creation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00141">141</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00648">obd_device::obd_last_committed</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lustre__idl_8h_source.html#l04024">update_records::ur_batchid</a>, and <a class="el" href="lustre__idl_8h_source.html#l04023">update_records::ur_master_transno</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ab6d23979347a7c679da7837639cad4fb"></a><!-- doxytag: member="update_recovery.c::dtrq_destroy" ref="ab6d23979347a7c679da7837639cad4fb" args="(struct distribute_txn_replay_req *dtrq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dtrq_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy distribute txn replay req. </p>
<p>Destroy distribute txn replay req and all of subs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>distribute txn replqy req to be destroyed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00499">499</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="lu__target_8h_source.html#l00052">distribute_txn_replay_req::dtrq_lur_size</a>, <a class="el" href="lu__target_8h_source.html#l00062">distribute_txn_replay_req::dtrq_sub_list</a>, <a class="el" href="lu__target_8h_source.html#l00063">distribute_txn_replay_req::dtrq_sub_list_lock</a>, <a class="el" href="lu__target_8h_source.html#l00078">distribute_txn_replay_req_sub::dtrqs_cookie_list</a>, <a class="el" href="lu__target_8h_source.html#l00079">distribute_txn_replay_req_sub::dtrqs_list</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00534">dtrq_list_destroy()</a>, and <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="a133e532cc4b5b870494646b827afbbdd"></a><!-- doxytag: member="update_recovery.c::dtrq_insert" ref="a133e532cc4b5b870494646b827afbbdd" args="(struct target_distribute_txn_data *tdtd, struct distribute_txn_replay_req *new)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dtrq_insert </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>new</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>insert distribute txn replay req </p>
<p>Insert distribute txn replay to the replay list, and it assumes the list has been looked. Note: the replay list is a sorted list, which is sorted by master transno. It is assumed the replay list has been locked before calling this function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>target distribute txn data where replay list is </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>new</em>&nbsp;</td><td>distribute txn replay to be inserted</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if insertion succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>EEXIST</em>&nbsp;</td><td>if the dtrq already exists </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00098">98</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00058">distribute_txn_replay_req::dtrq_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="update__recovery_8c_source.html#l00070">dtrq_lookup()</a>, <a class="el" href="lu__target_8h_source.html#l00057">distribute_txn_replay_req::dtrq_master_transno</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00472">list_for_each_entry_reverse</a>, and <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="a24e734097bb6681b5ead7052840a5035"></a><!-- doxytag: member="update_recovery.c::dtrq_list_destroy" ref="a24e734097bb6681b5ead7052840a5035" args="(struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dtrq_list_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy all of replay req. </p>
<p>Destroy all of replay req in the replay list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>target distribute txn data where the replay list is. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00534">534</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="update__recovery_8c_source.html#l00499">dtrq_destroy()</a>, <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lu__target_8h_source.html#l00108">target_distribute_txn_data::tdtd_replay_finish_list</a>, <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>, and <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01732">distribute_txn_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="a06fe5659d9fd4ece73a6fe3ce2a0836f"></a><!-- doxytag: member="update_recovery.c::dtrq_list_dump" ref="a06fe5659d9fd4ece73a6fe3ce2a0836f" args="(struct target_distribute_txn_data *tdtd, unsigned int mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dtrq_list_dump </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dump updates of distribute txns. </p>
<p>Output all of recovery updates in the distribute txn list to the debug log.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute txn data where all of distribute txn are listed. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mask</em>&nbsp;</td><td>debug mask </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00480">480</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>, <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>, and <a class="el" href="update__records_8c_source.html#l00063">update_records_dump()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f454b70a2b0b742bd4eb16dc76080fe"></a><!-- doxytag: member="update_recovery.c::dtrq_lookup" ref="a9f454b70a2b0b742bd4eb16dc76080fe" args="(struct target_distribute_txn_data *tdtd, __u64 batchid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a>* dtrq_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>batchid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup distribute_txn_replay req. </p>
<p>Lookup distribute_txn_replay in the replay list by batchid. It is assumed the list has been locked before calling this function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute_txn_data, which holds the replay list. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>batchid</em>&nbsp;</td><td>batchid used by lookup.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>of the replay if succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if can not find it. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00070">70</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00058">distribute_txn_replay_req::dtrq_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, and <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00098">dtrq_insert()</a>, and <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="a51cb1af70b019d86c0c42ff99e5d8c3b"></a><!-- doxytag: member="update_recovery.c::dtrq_sub_add_cookie" ref="a51cb1af70b019d86c0c42ff99e5d8c3b" args="(struct distribute_txn_replay_req_sub *dtrqs, struct llog_cookie *cookie)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dtrq_sub_add_cookie </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req__sub.html">distribute_txn_replay_req_sub</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrqs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *&nbsp;</td>
          <td class="paramname"> <em>cookie</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Try to add cookie to sub distribute txn request. </p>
<p>Check if the update log cookie has been added to the request, if not, add it to the dtrqs_cookie_list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrqs</em>&nbsp;</td><td>sub replay req where cookies to be added. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cookie</em>&nbsp;</td><td>cookie to be added.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the cookie is adding succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if adding fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00223">223</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00078">distribute_txn_replay_req_sub::dtrqs_cookie_list</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, and <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00254">dtrq_sub_create_and_insert()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f8f30ffe3d3e2fb561cdd5a6b51c0ee"></a><!-- doxytag: member="update_recovery.c::dtrq_sub_create_and_insert" ref="a9f8f30ffe3d3e2fb561cdd5a6b51c0ee" args="(struct distribute_txn_replay_req *dtrq, struct llog_cookie *cookie, __u32 mdt_index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dtrq_sub_create_and_insert </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *&nbsp;</td>
          <td class="paramname"> <em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>mdt_index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert distribute txn sub req replay. </p>
<p>Allocate sub replay req and insert distribute txn replay list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>d to be added </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cookie</em>&nbsp;</td><td>the cookie of the update record </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mdt_index</em>&nbsp;</td><td>the mdt_index of the update record</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the adding succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if the adding fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00254">254</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="update__recovery_8c_source.html#l00223">dtrq_sub_add_cookie()</a>, <a class="el" href="lu__target_8h_source.html#l00062">distribute_txn_replay_req::dtrq_sub_list</a>, <a class="el" href="lu__target_8h_source.html#l00063">distribute_txn_replay_req::dtrq_sub_list_lock</a>, <a class="el" href="update__recovery_8c_source.html#l00197">dtrq_sub_lookup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ae2a40c19fbb51b69714096bb3790c3f3"></a><!-- doxytag: member="update_recovery.c::dtrq_sub_lookup" ref="ae2a40c19fbb51b69714096bb3790c3f3" args="(struct distribute_txn_replay_req *dtrq, __u32 mdt_index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdistribute__txn__replay__req__sub.html">distribute_txn_replay_req_sub</a>* dtrq_sub_lookup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>mdt_index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup distribute sub replay. </p>
<p>Lookup distribute sub replay in the sub list of distribute_txn_replay by mdt_index.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em><a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a></em>&nbsp;</td><td>the distribute txn replay req to lookup </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mdt_index</em>&nbsp;</td><td>the mdt_index as the key of lookup</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>pointer of sub replay if it can be found. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if it can not find. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00197">197</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00062">distribute_txn_replay_req::dtrq_sub_list</a>, <a class="el" href="lu__target_8h_source.html#l00079">distribute_txn_replay_req_sub::dtrqs_list</a>, <a class="el" href="lu__target_8h_source.html#l00074">distribute_txn_replay_req_sub::dtrqs_mdt_index</a>, and <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l00254">dtrq_sub_create_and_insert()</a>, and <a class="el" href="update__recovery_8c_source.html#l00659">update_is_committed()</a>.</p>

</div>
</div>
<a class="anchor" id="a80f6b8cf0ec5b651cc8a561775fd3952"></a><!-- doxytag: member="update_recovery.c::insert_update_records_to_replay_list" ref="a80f6b8cf0ec5b651cc8a561775fd3952" args="(struct target_distribute_txn_data *tdtd, struct llog_update_record *lur, struct llog_cookie *cookie, __u32 mdt_index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int insert_update_records_to_replay_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *&nbsp;</td>
          <td class="paramname"> <em>lur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *&nbsp;</td>
          <td class="paramname"> <em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>mdt_index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert update records to the replay list. </p>
<p>Allocate distribute txn replay req and insert it into the replay list, then insert the update records into the replay req.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute txn replay data where the replay list is. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>record</em>&nbsp;</td><td>the update record </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cookie</em>&nbsp;</td><td>cookie of the record </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>mdt index of the record</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the adding succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if the adding fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00373">373</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="update__recovery_8c_source.html#l00307">dtrq_append_updates()</a>, <a class="el" href="update__recovery_8c_source.html#l00141">dtrq_create()</a>, <a class="el" href="update__recovery_8c_source.html#l00499">dtrq_destroy()</a>, <a class="el" href="update__recovery_8c_source.html#l00098">dtrq_insert()</a>, <a class="el" href="lu__target_8h_source.html#l00056">distribute_txn_replay_req::dtrq_list</a>, <a class="el" href="update__recovery_8c_source.html#l00070">dtrq_lookup()</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="lu__target_8h_source.html#l00052">distribute_txn_replay_req::dtrq_lur_size</a>, <a class="el" href="lu__target_8h_source.html#l00057">distribute_txn_replay_req::dtrq_master_transno</a>, <a class="el" href="update__recovery_8c_source.html#l00254">dtrq_sub_create_and_insert()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lu__target_8h_source.html#l00090">target_distribute_txn_data::tdtd_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>, <a class="el" href="lustre__idl_8h_source.html#l04010">UPDATE_RECORD_CONTINUE</a>, <a class="el" href="lustre__idl_8h_source.html#l04024">update_records::ur_batchid</a>, <a class="el" href="lustre__idl_8h_source.html#l04025">update_records::ur_flags</a>, and <a class="el" href="lustre__idl_8h_source.html#l04023">update_records::ur_master_transno</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00296">lod_process_recovery_updates()</a>.</p>

</div>
</div>
<a class="anchor" id="a38618de03dc6314e7509b6efe2a24559"></a><!-- doxytag: member="update_recovery.c::is_req_replayed_by_update" ref="a38618de03dc6314e7509b6efe2a24559" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool is_req_replayed_by_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00626">626</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="update__recovery_8c_source.html#l00609">distribute_txn_lookup_finish_list()</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, and <a class="el" href="lustre__net_8h_source.html#l01036">ptlrpc_request::rq_xid</a>.</p>

</div>
</div>
<a class="anchor" id="aa80d0da2fdb82f00bb561abf4895b271"></a><!-- doxytag: member="update_recovery.c::update_is_committed" ref="aa80d0da2fdb82f00bb561abf4895b271" args="(const struct lu_env *env, struct distribute_txn_replay_req *dtrq, struct dt_object *dt_obj, struct top_thandle *top_th, struct sub_thandle *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_is_committed </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if the update of one object is committed. </p>
<p>Check whether the update for the object is committed by checking whether the correspondent sub exists in the replay req. If it is committed, mark the committed flag in correspondent the sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>replay request </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt_obj</em>&nbsp;</td><td>object for the update </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>top_th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sub_th</em>&nbsp;</td><td>sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> which the update belongs to</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if the update is not committed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the update is committed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if some other failures happen. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00659">659</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="update__recovery_8c_source.html#l00197">dtrq_sub_lookup()</a>, <a class="el" href="lu__target_8h_source.html#l00078">distribute_txn_replay_req_sub::dtrqs_cookie_list</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00492">fid_is_update_log()</a>, <a class="el" href="lustre__idl_8h_source.html#l00502">fid_is_update_log_dir()</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__fid_8h_source.html#l00312">fid_seq_in_fldb()</a>, <a class="el" href="seq__range_8h_source.html#l00081">fld_range_set_type()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="list_8h_source.html#l00137">list_move()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="structlu__server__fld.html#af5b50bd0685dbc4d18ba3b33b337e2cc">lu_server_fld::lsf_seq_lookup</a>, <a class="el" href="lustre__idl_8h_source.html#l00156">lu_seq_range::lsr_index</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00166">LU_SEQ_RANGE_MDT</a>, <a class="el" href="lu__object_8h_source.html#l00661">lu_site2seq()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__fid_8h_source.html#l00454">seq_server_site::ss_node_id</a>, <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>, <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>, and <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a6c0bfee968ceb23477968b63312f5617"></a><!-- doxytag: member="update_recovery.c::update_recovery_attr_set" ref="a6c0bfee968ceb23477968b63312f5617" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_attr_set </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00825">825</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="linux-obdo_8c_source.html#l00103">la_from_obdo()</a>, <a class="el" href="lustre__idl_8h_source.html#l03106">LLOG_REC_HDR_NEEDS_SWABBING</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lustre__obdo_8h_source.html#l00069">lustre_get_wire_obdo()</a>, <a class="el" href="pack__generic_8c_source.html#l01701">lustre_swab_obdo()</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="tgt__internal_8h_source.html#l00201">out_tx_attr_set</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, <a class="el" href="tgt__internal_8h_source.html#l00258">update_thread_info::uti_attr</a>, <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>, and <a class="el" href="tgt__internal_8h_source.html#l00262">update_thread_info::uti_obdo</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a22f6eb35fe52fb5d084e579ebb8996"></a><!-- doxytag: member="update_recovery.c::update_recovery_create" ref="a4a22f6eb35fe52fb5d084e579ebb8996" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of different update methods for update recovery. </p>
<p>These following functions update_recovery_ implement different updates recovery methods. They will extract the parameters from the common parameters area and call correspondent dt API to redo the update.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>op</em>&nbsp;</td><td>update operation to be replayed </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>params</em>&nbsp;</td><td>common update parameters which holds all parameters of the operation </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>transaction handle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>declare</em>&nbsp;</td><td>indicate it will do declare or real execution, true means declare, false means real execution</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if it succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if it fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00737">737</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="linux-obdo_8c_source.html#l00103">la_from_obdo()</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lustre__idl_8h_source.html#l03106">LLOG_REC_HDR_NEEDS_SWABBING</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lustre__obdo_8h_source.html#l00069">lustre_get_wire_obdo()</a>, <a class="el" href="pack__generic_8c_source.html#l01701">lustre_swab_obdo()</a>, <a class="el" href="lustre__idl_8h_source.html#l03383">obdo::o_valid</a>, <a class="el" href="tgt__internal_8h_source.html#l00197">out_tx_create</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, <a class="el" href="tgt__internal_8h_source.html#l00258">update_thread_info::uti_attr</a>, <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>, and <a class="el" href="tgt__internal_8h_source.html#l00262">update_thread_info::uti_obdo</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a667dc34c6a139d50adff099bb549e084"></a><!-- doxytag: member="update_recovery.c::update_recovery_destroy" ref="a667dc34c6a139d50adff099bb549e084" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_destroy </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00780">780</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="tgt__internal_8h_source.html#l00229">out_tx_destroy</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a4439e9a84119689a8bf51fb67334dcce"></a><!-- doxytag: member="update_recovery.c::update_recovery_exec" ref="a4439e9a84119689a8bf51fb67334dcce" args="(const struct lu_env *env, struct target_distribute_txn_data *tdtd, struct distribute_txn_replay_req *dtrq, struct thandle_exec_args *ta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_exec </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute updates in the update replay records. </p>
<p>Declare distribute txn replay by update records and add the updates to the execution list. Note: it will check if the update has been committed, and only execute the updates if it is not committed to disk.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute txn replay data which hold all of replay reqs and all replay parameters. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dtrq</em>&nbsp;</td><td>distribute transaction replay req. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ta</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> execute args.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if declare succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if declare fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l01137">1137</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="update__trans_8c_source.html#l00436">create_sub_thandle()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8h_source.html#l01806">dt_object_child()</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="update__trans_8c_source.html#l00423">lookup_sub_thandle()</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lustre__idl_8h_source.html#l03789">OUT_ATTR_SET</a>, <a class="el" href="lustre__idl_8h_source.html#l03785">OUT_CREATE</a>, <a class="el" href="lustre__idl_8h_source.html#l03786">OUT_DESTROY</a>, <a class="el" href="lustre__idl_8h_source.html#l03795">OUT_INDEX_DELETE</a>, <a class="el" href="lustre__idl_8h_source.html#l03794">OUT_INDEX_INSERT</a>, <a class="el" href="lustre__idl_8h_source.html#l03800">OUT_NOOP</a>, <a class="el" href="lustre__idl_8h_source.html#l03787">OUT_REF_ADD</a>, <a class="el" href="lustre__idl_8h_source.html#l03788">OUT_REF_DEL</a>, <a class="el" href="lustre__idl_8h_source.html#l03796">OUT_WRITE</a>, <a class="el" href="lustre__idl_8h_source.html#l03797">OUT_XATTR_DEL</a>, <a class="el" href="lustre__idl_8h_source.html#l03791">OUT_XATTR_SET</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00567">sub_thandle_trans_create()</a>, <a class="el" href="lustre__update_8h_source.html#l00384">thandle_exec_args::ta_handle</a>, <a class="el" href="lu__target_8h_source.html#l00093">target_distribute_txn_data::tdtd_dt</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>, <a class="el" href="lustre__idl_8h_source.html#l03995">update_op::uop_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03996">update_op::uop_type</a>, <a class="el" href="lustre__idl_8h_source.html#l04002">update_ops::uops_op</a>, <a class="el" href="update__recovery_8c_source.html#l00659">update_is_committed()</a>, <a class="el" href="lustre__update_8h_source.html#l00105">update_op_next_op()</a>, <a class="el" href="lustre__update_8h_source.html#l00126">update_records_get_params()</a>, <a class="el" href="update__recovery_8c_source.html#l00825">update_recovery_attr_set()</a>, <a class="el" href="update__recovery_8c_source.html#l00737">update_recovery_create()</a>, <a class="el" href="update__recovery_8c_source.html#l00780">update_recovery_destroy()</a>, <a class="el" href="update__recovery_8c_source.html#l00962">update_recovery_index_delete()</a>, <a class="el" href="update__recovery_8c_source.html#l00908">update_recovery_index_insert()</a>, <a class="el" href="update__recovery_8c_source.html#l00795">update_recovery_ref_add()</a>, <a class="el" href="update__recovery_8c_source.html#l00810">update_recovery_ref_del()</a>, <a class="el" href="update__recovery_8c_source.html#l00991">update_recovery_write()</a>, <a class="el" href="update__recovery_8c_source.html#l01028">update_recovery_xattr_del()</a>, <a class="el" href="update__recovery_8c_source.html#l00861">update_recovery_xattr_set()</a>, and <a class="el" href="lustre__idl_8h_source.html#l04031">update_records::ur_ops</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>.</p>

</div>
</div>
<a class="anchor" id="a03af5ba86326ead1da5ac61eefa3a597"></a><!-- doxytag: member="update_recovery.c::update_recovery_index_delete" ref="a03af5ba86326ead1da5ac61eefa3a597" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_index_delete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00962">962</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="tgt__internal_8h_source.html#l00225">out_tx_index_delete</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, and <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a0881a15cdf256eced3565774c3c7bda4"></a><!-- doxytag: member="update_recovery.c::update_recovery_index_insert" ref="a0881a15cdf256eced3565774c3c7bda4" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_index_insert </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00908">908</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00772">fid_le_to_cpu()</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="tgt__internal_8h_source.html#l00221">out_tx_index_insert</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>, and <a class="el" href="tgt__internal_8h_source.html#l00264">update_thread_info::uti_rec</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a7f11a41d27b82df87febc9aab1cd828d"></a><!-- doxytag: member="update_recovery.c::update_recovery_ref_add" ref="a7f11a41d27b82df87febc9aab1cd828d" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_ref_add </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00795">795</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="tgt__internal_8h_source.html#l00213">out_tx_ref_add</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a5bf344d23c613f8e4a346aaa5af17fc9"></a><!-- doxytag: member="update_recovery.c::update_recovery_ref_del" ref="a5bf344d23c613f8e4a346aaa5af17fc9" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_ref_del </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00810">810</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="tgt__internal_8h_source.html#l00217">out_tx_ref_del</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="abdeaeeea01064a028f920c4c5b9d5f75"></a><!-- doxytag: member="update_recovery.c::update_recovery_update_ses" ref="abdeaeeea01064a028f920c4c5b9d5f75" args="(struct lu_env *env, struct target_distribute_txn_data *tdtd, struct thandle *th, struct thandle *master_th, struct distribute_txn_replay_req *dtrq, struct tx_arg *ta_arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void update_recovery_update_ses </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>master_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdistribute__txn__replay__req.html">distribute_txn_replay_req</a> *&nbsp;</td>
          <td class="paramname"> <em>dtrq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtx__arg.html">tx_arg</a> *&nbsp;</td>
          <td class="paramname"> <em>ta_arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update session information. </p>
<p>Update session information so <a class="el" href="tgt__internal_8h.html#a4422f06a2a87e28b67af5cf4d7443bac">tgt_txn_stop_cb()</a>-&gt;<a class="el" href="tgt__lastrcvd_8c.html#a3feb6626f6155c126221bc395a59f6d1">tgt_last_rcvd_update()</a> can be called correctly during update replay.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute data structure of the recovering tgt. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> of this update replay. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>master_th</em>&nbsp;</td><td>master sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ta_arg</em>&nbsp;</td><td>the tx arg structure to hold the update for updating reply data. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l01066">1066</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="hash_8c_source.html#l01140">cfs_hash_getref()</a>, <a class="el" href="hash_8c_source.html#l01346">cfs_hash_lookup()</a>, <a class="el" href="hash_8c_source.html#l01148">cfs_hash_putref()</a>, <a class="el" href="lu__target_8h_source.html#l00059">distribute_txn_replay_req::dtrq_xid</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lustre__disk_8h_source.html#l00386">lsd_reply_data::lrd_client_gen</a>, <a class="el" href="lustre__disk_8h_source.html#l00384">lsd_reply_data::lrd_data</a>, <a class="el" href="lustre__disk_8h_source.html#l00385">lsd_reply_data::lrd_result</a>, <a class="el" href="lustre__disk_8h_source.html#l00382">lsd_reply_data::lrd_transno</a>, <a class="el" href="lustre__disk_8h_source.html#l00383">lsd_reply_data::lrd_xid</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd_8h_source.html#l00632">obd_device::obd_gen_hash</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lu__target_8h_source.html#l00235">tgt_ses_info()</a>, <a class="el" href="tgt__internal_8h_source.html#l00095">tgt_th_info()</a>, <a class="el" href="lu__target_8h_source.html#l00232">tgt_session_info::tsi_client_gen</a>, <a class="el" href="lu__target_8h_source.html#l00202">tgt_session_info::tsi_exp</a>, <a class="el" href="lu__target_8h_source.html#l00219">tgt_session_info::tsi_opdata</a>, <a class="el" href="lu__target_8h_source.html#l00231">tgt_session_info::tsi_result</a>, <a class="el" href="lu__target_8h_source.html#l00230">tgt_session_info::tsi_xid</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, <a class="el" href="structtx__arg.html#a6da1d2063d78a3aa5027503fe581d919">tx_arg::u</a>, and <a class="el" href="structtx__arg.html#a7e6e20b060dddaf48eed1da63bb4cd81">tx_arg::write</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>.</p>

</div>
</div>
<a class="anchor" id="a959315dc9aa8814a3e9982eea273299f"></a><!-- doxytag: member="update_recovery.c::update_recovery_write" ref="a959315dc9aa8814a3e9982eea273299f" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00991">991</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="tgt__internal_8h_source.html#l00233">out_tx_write</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, <a class="el" href="tgt__internal_8h_source.html#l00260">update_thread_info::uti_buf</a>, and <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="ab1d635944fc59872ce140105e2059368"></a><!-- doxytag: member="update_recovery.c::update_recovery_xattr_del" ref="ab1d635944fc59872ce140105e2059368" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_xattr_del </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l01028">1028</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="tgt__internal_8h_source.html#l00209">out_tx_xattr_del</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, and <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="af256f9b6b34e70948261ec01582500d8"></a><!-- doxytag: member="update_recovery.c::update_recovery_xattr_set" ref="af256f9b6b34e70948261ec01582500d8" args="(const struct lu_env *env, struct dt_object *dt_obj, const struct update_op *op, const struct update_params *params, struct thandle_exec_args *ta, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_recovery_xattr_set </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__op.html">update_op</a> *&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structupdate__params.html">update_params</a> *&nbsp;</td>
          <td class="paramname"> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle__exec__args.html">thandle_exec_args</a> *&nbsp;</td>
          <td class="paramname"> <em>ta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__recovery_8c_source.html#l00861">861</a> of file <a class="el" href="update__recovery_8c_source.html">update_recovery.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="lu__target_8h_source.html#l00051">distribute_txn_replay_req::dtrq_lur</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="tgt__internal_8h_source.html#l00205">out_tx_xattr_set</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="lustre__idl_8h_source.html#l03998">update_op::uop_params_off</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, <a class="el" href="lustre__update_8h_source.html#l00082">update_params_get_param_buf()</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, <a class="el" href="tgt__internal_8h_source.html#l00260">update_thread_info::uti_buf</a>, and <a class="el" href="tgt__internal_8h_source.html#l00265">update_thread_info::uti_dtrq</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:51 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
