<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/mdd/mdd_orphans.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/mdd/mdd_orphans.c File Reference</h1><code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__ver_8h_source.html">lustre_ver.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__support_8h_source.html">obd_support.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__fid_8h_source.html">lustre_fid.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="mdd__internal_8h_source.html">mdd_internal.h</a>&quot;</code><br/>

<p><a href="mdd__orphans_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a586ab0f5bd6df9ed79857e7a8f6b7206">ORPHAN_FILE_NAME_FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%016llx:%08x:%08x:%2x&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a6d854561ba9bc3eea4c4d0aea12464c6">ORPHAN_FILE_NAME_FORMAT_18</a>&nbsp;&nbsp;&nbsp;&quot;%llx:%08x&quot;</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="mdd__orphans_8c.html#a2f1398dba5e4a5616b83437528bdb28ea7d21b2b011e434ba4fe74829c96e289d">ORPH_OP_UNLINK</a>, 
<a class="el" href="mdd__orphans_8c.html#a2f1398dba5e4a5616b83437528bdb28ea575677c0c74bc742af5d1e76268e612a">ORPH_OP_TRUNCATE</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a5a72716310ab80f1e019c4ce0945c866">orph_key_fill</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *lf, __u32 <a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a64c0af5997535b41384dc200ac8b03cf">orph_key_fill_18</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *lf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a370e3bc703807e46a1742326cd1945d1">mdd_orphan_write_lock</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#ab149c0abb4edb46d083e806d6b10704e">mdd_orphan_write_unlock</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a225f90dbd2e3713929f6368a95b4c5cf">mdd_orphan_insert_obj</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, __u32 <a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a130f35f751fc00e83baf892daa6f9648">mdd_orphan_delete_obj</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd, struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *key, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#aad5e1d7e41e41fe8ec9f08d0ae04e5e0">mdd_orphan_ref_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a62702af581ac1c57e17ed13b4a8c87c5">mdd_orphan_ref_del</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a818f4ba3660f67284c0183cae18cb2df">orph_declare_index_insert</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, umode_t <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a4385c9a324ed2f24acdc38668d7d557d">orph_index_insert</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, __u32 <a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#aeccccb584cc1dee546b0e3f90fe193e7">orph_declare_index_delete</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a46bfb38114a0b7a705501e32159d1063">orph_index_delete</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, __u32 <a class="el" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a56dd9d31ad2cc374433313750b178490">orphan_object_destroy</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *key)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#acec76bd0d0f9bcb1edda36a70b543470">orph_key_test_and_del</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd, struct <a class="el" href="structlu__fid.html">lu_fid</a> *lf, struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *key)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete unused orphan with FID <em>lf</em> from PENDING directory.  <a href="#acec76bd0d0f9bcb1edda36a70b543470"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a666f271b0df6814788688f970500575d">orph_index_iterate</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__generic__thread.html">mdd_generic_thread</a> *<a class="el" href="obd_8c.html#a20057145635eb007e0621c11bc2d7176">thread</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete unreferenced files and directories in the PENDING directory  <a href="#a666f271b0df6814788688f970500575d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#ae460711899b02d914d01cfaedee00e5b">orph_index_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">open the PENDING directory for device <em>mdd</em>  <a href="#ae460711899b02d914d01cfaedee00e5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a76e7250e72b264f6bdf4f29a354fdf90">orph_index_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *mdd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#ae440dd6aa1434712209b28ddc8cf31fe">__mdd_orphan_cleanup</a> (void *args)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a4e67f130b76cceb3b9bd53d38c9b8f74">mdd_orphan_cleanup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__device.html">mdd_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Iterate orphan index to cleanup orphan objects after recovery is done.  <a href="#a4e67f130b76cceb3b9bd53d38c9b8f74"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#adf112349637fc28872fc405e17950738">__mdd_orphan_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add an orphan <em>obj</em> to the orphan index.  <a href="#adf112349637fc28872fc405e17950738"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#ac10d1bbacbcbc17de0a7ffcd5b6ce6e7">__mdd_orphan_del</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structmdd__object.html">mdd_object</a> *obj, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete an orphan <em>obj</em> from orphan index.  <a href="#ac10d1bbacbcbc17de0a7ffcd5b6ce6e7"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#ae108beede221a7672faa31aaf55ed737">orph_index_name</a> [] = &quot;PENDING&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="mdd__orphans_8c.html#a7914eee395b20d62ae6bc4a189f3a468">dotdot</a> [] = &quot;..&quot;</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="mdd_orphans.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00044">44</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

</div>
</div>
<a class="anchor" id="a586ab0f5bd6df9ed79857e7a8f6b7206"></a><!-- doxytag: member="mdd_orphans.c::ORPHAN_FILE_NAME_FORMAT" ref="a586ab0f5bd6df9ed79857e7a8f6b7206" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ORPHAN_FILE_NAME_FORMAT&nbsp;&nbsp;&nbsp;&quot;%016llx:%08x:%08x:%2x&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00061">61</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00064">orph_key_fill()</a>.</p>

</div>
</div>
<a class="anchor" id="a6d854561ba9bc3eea4c4d0aea12464c6"></a><!-- doxytag: member="mdd_orphans.c::ORPHAN_FILE_NAME_FORMAT_18" ref="a6d854561ba9bc3eea4c4d0aea12464c6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ORPHAN_FILE_NAME_FORMAT_18&nbsp;&nbsp;&nbsp;&quot;%llx:%08x&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00062">62</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00080">orph_key_fill_18()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a2f1398dba5e4a5616b83437528bdb28e"></a><!-- doxytag: member="mdd_orphans.c::@115" ref="a2f1398dba5e4a5616b83437528bdb28e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a2f1398dba5e4a5616b83437528bdb28ea7d21b2b011e434ba4fe74829c96e289d"></a><!-- doxytag: member="ORPH_OP_UNLINK" ref="a2f1398dba5e4a5616b83437528bdb28ea7d21b2b011e434ba4fe74829c96e289d" args="" -->ORPH_OP_UNLINK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2f1398dba5e4a5616b83437528bdb28ea575677c0c74bc742af5d1e76268e612a"></a><!-- doxytag: member="ORPH_OP_TRUNCATE" ref="a2f1398dba5e4a5616b83437528bdb28ea575677c0c74bc742af5d1e76268e612a" args="" -->ORPH_OP_TRUNCATE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00056">56</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="adf112349637fc28872fc405e17950738"></a><!-- doxytag: member="mdd_orphans.c::__mdd_orphan_add" ref="adf112349637fc28872fc405e17950738" args="(const struct lu_env *env, struct mdd_object *obj, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __mdd_orphan_add </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add an orphan <em>obj</em> to the orphan index. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>file or directory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>th</em>&nbsp;</td><td>transaction for index insert.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>obj nlink == 0 &amp;&amp; obj-&gt;mod_count != 0</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>index operation error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00628">628</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="mdd__orphans_8c_source.html#l00196">orph_index_insert()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00057">ORPH_OP_UNLINK</a>.</p>

<p>Referenced by <a class="el" href="mdd__dir_8c_source.html#l02347">mdd_create()</a>, <a class="el" href="mdd__dir_8c_source.html#l01453">mdd_finish_unlink()</a>, and <a class="el" href="mdd__dir_8c_source.html#l03933">mdd_migrate_update_name()</a>.</p>

</div>
</div>
<a class="anchor" id="ae440dd6aa1434712209b28ddc8cf31fe"></a><!-- doxytag: member="mdd_orphans.c::__mdd_orphan_cleanup" ref="ae440dd6aa1434712209b28ddc8cf31fe" args="(void *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __mdd_orphan_cleanup </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>args</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00563">563</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00995">LCT_MD_THREAD</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="mdd__internal_8h_source.html#l00092">mdd_generic_thread::mgt_finished</a>, <a class="el" href="mdd__internal_8h_source.html#l00091">mdd_generic_thread::mgt_started</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="mdd__orphans_8c_source.html#l00427">orph_index_iterate()</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00595">mdd_orphan_cleanup()</a>.</p>

</div>
</div>
<a class="anchor" id="ac10d1bbacbcbc17de0a7ffcd5b6ce6e7"></a><!-- doxytag: member="mdd_orphans.c::__mdd_orphan_del" ref="ac10d1bbacbcbc17de0a7ffcd5b6ce6e7" args="(const struct lu_env *env, struct mdd_object *obj, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __mdd_orphan_del </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete an orphan <em>obj</em> from orphan index. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>file or directory. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>th</em>&nbsp;</td><td>transaction for index deletion and object destruction.</td></tr>
  </table>
  </dd>
</dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>obj-&gt;mod_count == 0 &amp;&amp; ORPHAN_OBJ is set for obj.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>index operation error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00644">644</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00057">ORPH_OP_UNLINK</a>.</p>

<p>Referenced by <a class="el" href="mdd__object_8c_source.html#l01722">mdd_close()</a>, and <a class="el" href="mdd__dir_8c_source.html#l02347">mdd_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a4e67f130b76cceb3b9bd53d38c9b8f74"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_cleanup" ref="a4e67f130b76cceb3b9bd53d38c9b8f74" args="(const struct lu_env *env, struct mdd_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mdd_orphan_cleanup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Iterate orphan index to cleanup orphan objects after recovery is done. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>d</em>&nbsp;</td><td>mdd device in recovery. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00595">595</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="mdd__orphans_8c_source.html#l00563">__mdd_orphan_cleanup()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="mdd__internal_8h_source.html#l00415">mdd2obd_dev()</a>, <a class="el" href="mdd__device_8c_source.html#l01571">mdd_generic_thread_start()</a>, <a class="el" href="mdd__internal_8h_source.html#l00115">mdd_device::mdd_orph_cleanup_thread</a>, <a class="el" href="lustre__idl_8h_source.html#l02959">MTI_NAME_MAXLEN</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, and <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>.</p>

<p>Referenced by <a class="el" href="mdd__device_8c_source.html#l00932">mdd_recovery_complete()</a>.</p>

</div>
</div>
<a class="anchor" id="a130f35f751fc00e83baf892daa6f9648"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_delete_obj" ref="a130f35f751fc00e83baf892daa6f9648" args="(const struct lu_env *env, struct mdd_device *mdd, struct dt_key *key, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mdd_orphan_delete_obj </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00125">125</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, and <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="a225f90dbd2e3713929f6368a95b4c5cf"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_insert_obj" ref="a225f90dbd2e3713929f6368a95b4c5cf" args="(const struct lu_env *env, struct mdd_device *mdd, struct mdd_object *obj, __u32 op, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mdd_orphan_insert_obj </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00109">109</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00430">mdd_object_type()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__internal_8h_source.html#l00425">mdo2fid()</a>, <a class="el" href="mdd__internal_8h_source.html#l00160">mdd_thread_info::mti_dt_rec</a>, <a class="el" href="mdd__orphans_8c_source.html#l00064">orph_key_fill()</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, and <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00196">orph_index_insert()</a>.</p>

</div>
</div>
<a class="anchor" id="aad5e1d7e41e41fe8ec9f08d0ae04e5e0"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_ref_add" ref="aad5e1d7e41e41fe8ec9f08d0ae04e5e0" args="(const struct lu_env *env, struct mdd_device *mdd, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mdd_orphan_ref_add </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00135">135</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, and <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00196">orph_index_insert()</a>.</p>

</div>
</div>
<a class="anchor" id="a62702af581ac1c57e17ed13b4a8c87c5"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_ref_del" ref="a62702af581ac1c57e17ed13b4a8c87c5" args="(const struct lu_env *env, struct mdd_device *mdd, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mdd_orphan_ref_del </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00143">143</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02305">dt_ref_del()</a>, and <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="a370e3bc703807e46a1742326cd1945d1"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_write_lock" ref="a370e3bc703807e46a1742326cd1945d1" args="(const struct lu_env *env, struct mdd_device *mdd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mdd_orphan_write_lock </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00095">95</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, and <a class="el" href="md__object_8h_source.html#l00568">MOR_TGT_ORPHAN</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00196">orph_index_insert()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="ab149c0abb4edb46d083e806d6b10704e"></a><!-- doxytag: member="mdd_orphans.c::mdd_orphan_write_unlock" ref="ab149c0abb4edb46d083e806d6b10704e" args="(const struct lu_env *env, struct mdd_device *mdd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mdd_orphan_write_unlock </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00102">102</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, and <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00196">orph_index_insert()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="aeccccb584cc1dee546b0e3f90fe193e7"></a><!-- doxytag: member="mdd_orphans.c::orph_declare_index_delete" ref="aeccccb584cc1dee546b0e3f90fe193e7" args="(const struct lu_env *env, struct mdd_object *obj, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int orph_declare_index_delete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00245">245</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02292">dt_declare_ref_del()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="mdd__internal_8h_source.html#l00430">mdd_object_type()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__internal_8h_source.html#l00425">mdo2fid()</a>, <a class="el" href="mdd__internal_8h_source.html#l00388">mdo2mdd()</a>, <a class="el" href="mdd__internal_8h_source.html#l00632">mdo_declare_ref_del()</a>, <a class="el" href="mdd__internal_8h_source.html#l00125">mdd_object::mod_obj</a>, <a class="el" href="mdd__orphans_8c_source.html#l00064">orph_key_fill()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00057">ORPH_OP_UNLINK</a>.</p>

<p>Referenced by <a class="el" href="mdd__object_8c_source.html#l01705">mdd_declare_close()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="a818f4ba3660f67284c0183cae18cb2df"></a><!-- doxytag: member="mdd_orphans.c::orph_declare_index_insert" ref="a818f4ba3660f67284c0183cae18cb2df" args="(const struct lu_env *env, struct mdd_object *obj, umode_t mode, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int orph_declare_index_insert </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">umode_t&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00152">152</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__internal_8h_source.html#l00425">mdo2fid()</a>, <a class="el" href="mdd__internal_8h_source.html#l00388">mdo2mdd()</a>, <a class="el" href="mdd__internal_8h_source.html#l00601">mdo_declare_index_delete()</a>, <a class="el" href="mdd__internal_8h_source.html#l00575">mdo_declare_index_insert()</a>, <a class="el" href="mdd__internal_8h_source.html#l00613">mdo_declare_ref_add()</a>, <a class="el" href="mdd__internal_8h_source.html#l00125">mdd_object::mod_obj</a>, <a class="el" href="mdd__internal_8h_source.html#l00160">mdd_thread_info::mti_dt_rec</a>, <a class="el" href="mdd__orphans_8c_source.html#l00064">orph_key_fill()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00057">ORPH_OP_UNLINK</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, and <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>.</p>

<p>Referenced by <a class="el" href="mdd__dir_8c_source.html#l02090">mdd_declare_create()</a>, and <a class="el" href="mdd__dir_8c_source.html#l01428">mdd_declare_finish_unlink()</a>.</p>

</div>
</div>
<a class="anchor" id="a46bfb38114a0b7a705501e32159d1063"></a><!-- doxytag: member="mdd_orphans.c::orph_index_delete" ref="a46bfb38114a0b7a705501e32159d1063" args="(const struct lu_env *env, struct mdd_object *obj, __u32 op, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int orph_index_delete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00275">275</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="mdd__internal_8h_source.html#l00430">mdd_object_type()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00125">mdd_orphan_delete_obj()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00143">mdd_orphan_ref_del()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00095">mdd_orphan_write_lock()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00102">mdd_orphan_write_unlock()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__lock_8c_source.html#l00079">mdd_write_locked()</a>, <a class="el" href="mdd__internal_8h_source.html#l00425">mdo2fid()</a>, <a class="el" href="mdd__internal_8h_source.html#l00388">mdo2mdd()</a>, <a class="el" href="mdd__internal_8h_source.html#l00640">mdo_ref_del()</a>, <a class="el" href="mdd__internal_8h_source.html#l00127">mdd_object::mod_count</a>, <a class="el" href="mdd__internal_8h_source.html#l00130">mdd_object::mod_flags</a>, <a class="el" href="mdd__internal_8h_source.html#l00125">mdd_object::mod_obj</a>, <a class="el" href="mdd__orphans_8c_source.html#l00064">orph_key_fill()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00080">orph_key_fill_18()</a>, <a class="el" href="mdd__internal_8h_source.html#l00121">ORPHAN_OBJ</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00644">__mdd_orphan_del()</a>.</p>

</div>
</div>
<a class="anchor" id="a76e7250e72b264f6bdf4f29a354fdf90"></a><!-- doxytag: member="mdd_orphans.c::orph_index_fini" ref="a76e7250e72b264f6bdf4f29a354fdf90" args="(const struct lu_env *env, struct mdd_device *mdd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void orph_index_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00553">553</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, and <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>.</p>

<p>Referenced by <a class="el" href="mdd__device_8c_source.html#l00875">mdd_device_shutdown()</a>, and <a class="el" href="mdd__device_8c_source.html#l00990">mdd_prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="ae460711899b02d914d01cfaedee00e5b"></a><!-- doxytag: member="mdd_orphans.c::orph_index_init" ref="ae460711899b02d914d01cfaedee00e5b" args="(const struct lu_env *env, struct mdd_device *mdd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int orph_index_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>open the PENDING directory for device <em>mdd</em> </p>
<p>The PENDING directory persistently tracks files and directories that were unlinked from the namespace (nlink == 0) but are still held open by clients. Those inodes shouldn't be deleted if the MDS crashes, because the clients would not be able to recover and reopen those files. Instead, these inodes are linked into the PENDING directory on disk, and only deleted if all clients close them, or the MDS finishes client recovery without any client reopening them (i.e. former clients didn't join recovery). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>d</em>&nbsp;</td><td>mdd device being started.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>index operation error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00523">523</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00840">lu_object_exists</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="mdd__internal_8h_source.html#l00415">mdd2obd_dev()</a>, <a class="el" href="mdd__internal_8h_source.html#l00101">mdd_device::mdd_child</a>, <a class="el" href="mdd__device_8c_source.html#l00950">mdd_local_file_create()</a>, <a class="el" href="mdd__internal_8h_source.html#l00104">mdd_device::mdd_local_root_fid</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__orphans_8c_source.html#l00053">orph_index_name</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdd__device_8c_source.html#l00990">mdd_prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="a4385c9a324ed2f24acdc38668d7d557d"></a><!-- doxytag: member="mdd_orphans.c::orph_index_insert" ref="a4385c9a324ed2f24acdc38668d7d557d" args="(const struct lu_env *env, struct mdd_object *obj, __u32 op, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int orph_index_insert </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00196">196</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00409">mdd_object_child()</a>, <a class="el" href="mdd__internal_8h_source.html#l00430">mdd_object_type()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00109">mdd_orphan_insert_obj()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00135">mdd_orphan_ref_add()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00095">mdd_orphan_write_lock()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00102">mdd_orphan_write_unlock()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__lock_8c_source.html#l00079">mdd_write_locked()</a>, <a class="el" href="mdd__internal_8h_source.html#l00388">mdo2mdd()</a>, <a class="el" href="mdd__internal_8h_source.html#l00621">mdo_ref_add()</a>, <a class="el" href="mdd__internal_8h_source.html#l00130">mdd_object::mod_flags</a>, <a class="el" href="mdd__internal_8h_source.html#l00125">mdd_object::mod_obj</a>, <a class="el" href="mdd__internal_8h_source.html#l00160">mdd_thread_info::mti_dt_rec</a>, <a class="el" href="mdd__internal_8h_source.html#l00121">ORPHAN_OBJ</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00628">__mdd_orphan_add()</a>.</p>

</div>
</div>
<a class="anchor" id="a666f271b0df6814788688f970500575d"></a><!-- doxytag: member="mdd_orphans.c::orph_index_iterate" ref="a666f271b0df6814788688f970500575d" args="(const struct lu_env *env, struct mdd_generic_thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int orph_index_iterate </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__generic__thread.html">mdd_generic_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>thread</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete unreferenced files and directories in the PENDING directory </p>
<p>Files that remain in PENDING after client-&gt;MDS recovery has completed have to be referenced (opened) by some client during recovery, or they will be deleted here (for clients that did not complete recovery).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>thread</em>&nbsp;</td><td>info about orphan cleanup thread</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00427">427</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__idl_8h_source.html#l00772">fid_le_to_cpu()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__idl_8h_source.html#l00872">LUDA_64BITHASH</a>, <a class="el" href="mdd__internal_8h_source.html#l00415">mdd2obd_dev()</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00106">mdd_device::mdd_orphans</a>, <a class="el" href="mdd__internal_8h_source.html#l00094">mdd_generic_thread::mgt_abort</a>, <a class="el" href="mdd__internal_8h_source.html#l00093">mdd_generic_thread::mgt_data</a>, <a class="el" href="mdd__internal_8h_source.html#l00149">mdd_thread_info::mti_ent</a>, <a class="el" href="mdd__orphans_8c_source.html#l00380">orph_key_test_and_del()</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00563">__mdd_orphan_cleanup()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a72716310ab80f1e019c4ce0945c866"></a><!-- doxytag: member="mdd_orphans.c::orph_key_fill" ref="a5a72716310ab80f1e019c4ce0945c866" args="(const struct lu_env *env, const struct lu_fid *lf, __u32 op)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a>* orph_key_fill </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>lf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>op</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00064">64</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00255">fid_ver()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00150">mdd_thread_info::mti_key</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00061">ORPHAN_FILE_NAME_FORMAT</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00109">mdd_orphan_insert_obj()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00245">orph_declare_index_delete()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00152">orph_declare_index_insert()</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>.</p>

</div>
</div>
<a class="anchor" id="a64c0af5997535b41384dc200ac8b03cf"></a><!-- doxytag: member="mdd_orphans.c::orph_key_fill_18" ref="a64c0af5997535b41384dc200ac8b03cf" args="(const struct lu_env *env, const struct lu_fid *lf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a>* orph_key_fill_18 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>lf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00080">80</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="mdd__object_8c_source.html#l00090">mdd_env_info()</a>, <a class="el" href="mdd__internal_8h_source.html#l00150">mdd_thread_info::mti_key</a>, and <a class="el" href="mdd__orphans_8c_source.html#l00062">ORPHAN_FILE_NAME_FORMAT_18</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00275">orph_index_delete()</a>.</p>

</div>
</div>
<a class="anchor" id="acec76bd0d0f9bcb1edda36a70b543470"></a><!-- doxytag: member="mdd_orphans.c::orph_key_test_and_del" ref="acec76bd0d0f9bcb1edda36a70b543470" args="(const struct lu_env *env, struct mdd_device *mdd, struct lu_fid *lf, struct dt_key *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int orph_key_test_and_del </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__device.html">mdd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>mdd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>lf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete unused orphan with FID <em>lf</em> from PENDING directory. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mdd</em>&nbsp;</td><td>MDD device finishing recovery </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lf</em>&nbsp;</td><td>FID of file or directory to delete </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>key</em>&nbsp;</td><td>cookie for this entry in index iterator</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00380">380</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="mdd__internal_8h_source.html#l00415">mdd2obd_dev()</a>, <a class="el" href="mdd__object_8c_source.html#l00202">mdd_object_find()</a>, <a class="el" href="mdd__internal_8h_source.html#l00326">mdd_object_put()</a>, <a class="el" href="mdd__lock_8c_source.html#l00049">mdd_write_lock()</a>, <a class="el" href="mdd__lock_8c_source.html#l00065">mdd_write_unlock()</a>, <a class="el" href="mdd__internal_8h_source.html#l00127">mdd_object::mod_count</a>, <a class="el" href="mdd__internal_8h_source.html#l00130">mdd_object::mod_flags</a>, <a class="el" href="md__object_8h_source.html#l00567">MOR_TGT_CHILD</a>, <a class="el" href="mdd__internal_8h_source.html#l00121">ORPHAN_OBJ</a>, <a class="el" href="mdd__orphans_8c_source.html#l00320">orphan_object_destroy()</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00427">orph_index_iterate()</a>.</p>

</div>
</div>
<a class="anchor" id="a56dd9d31ad2cc374433313750b178490"></a><!-- doxytag: member="mdd_orphans.c::orphan_object_destroy" ref="a56dd9d31ad2cc374433313750b178490" args="(const struct lu_env *env, struct mdd_object *obj, struct dt_key *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int orphan_object_destroy </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structmdd__object.html">mdd_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00320">320</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="mdd__internal_8h_source.html#l00430">mdd_object_type()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00125">mdd_orphan_delete_obj()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00143">mdd_orphan_ref_del()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00095">mdd_orphan_write_lock()</a>, <a class="el" href="mdd__orphans_8c_source.html#l00102">mdd_orphan_write_unlock()</a>, <a class="el" href="mdd__trans_8c_source.html#l00051">mdd_trans_create()</a>, <a class="el" href="mdd__trans_8c_source.html#l00057">mdd_trans_start()</a>, <a class="el" href="mdd__trans_8c_source.html#l00063">mdd_trans_stop()</a>, <a class="el" href="mdd__lock_8c_source.html#l00049">mdd_write_lock()</a>, <a class="el" href="mdd__lock_8c_source.html#l00065">mdd_write_unlock()</a>, <a class="el" href="mdd__internal_8h_source.html#l00388">mdo2mdd()</a>, <a class="el" href="mdd__internal_8h_source.html#l00674">mdo_declare_destroy()</a>, <a class="el" href="mdd__internal_8h_source.html#l00682">mdo_destroy()</a>, <a class="el" href="mdd__internal_8h_source.html#l00640">mdo_ref_del()</a>, <a class="el" href="mdd__internal_8h_source.html#l00127">mdd_object::mod_count</a>, <a class="el" href="mdd__internal_8h_source.html#l00125">mdd_object::mod_obj</a>, <a class="el" href="md__object_8h_source.html#l00567">MOR_TGT_CHILD</a>, <a class="el" href="mdd__orphans_8c_source.html#l00245">orph_declare_index_delete()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="rename__many_8c_source.html#l00056">stop</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00380">orph_key_test_and_del()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a7914eee395b20d62ae6bc4a189f3a468"></a><!-- doxytag: member="mdd_orphans.c::dotdot" ref="a7914eee395b20d62ae6bc4a189f3a468" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="osd-ldiskfs_2osd__handler_8c.html#a7914eee395b20d62ae6bc4a189f3a468">dotdot</a>[] = &quot;..&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00054">54</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae108beede221a7672faa31aaf55ed737"></a><!-- doxytag: member="mdd_orphans.c::orph_index_name" ref="ae108beede221a7672faa31aaf55ed737" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="mdd__orphans_8c.html#ae108beede221a7672faa31aaf55ed737">orph_index_name</a>[] = &quot;PENDING&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="mdd__orphans_8c_source.html#l00053">53</a> of file <a class="el" href="mdd__orphans_8c_source.html">mdd_orphans.c</a>.</p>

<p>Referenced by <a class="el" href="mdd__orphans_8c_source.html#l00523">orph_index_init()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
