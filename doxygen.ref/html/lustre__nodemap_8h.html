<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/include/lustre_nodemap.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/include/lustre_nodemap.h File Reference</h1><code>#include &lt;<a class="el" href="lustre__idl_8h_source.html">lustre/lustre_idl.h</a>&gt;</code><br/>

<p><a href="lustre__nodemap_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnodemap__pde.html">nodemap_pde</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__nodemap.html">lu_nodemap</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The nodemap id 0 will be the default nodemap.  <a href="structlu__nodemap.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnm__config__file.html">nm_config_file</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a56fb14afe8f48b0950e8f055ec049dcc">LUSTRE_NODEMAP_NAME</a>&nbsp;&nbsp;&nbsp;&quot;nodemap&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a09aa92849fa257a124c5582020fd6317">LUSTRE_NODEMAP_DEFAULT_ID</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> { <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4a0497746ebf6ec135e8e0ba8e9dc9d74a">NODEMAP_UID</a>, 
<a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4a00362293ac49bdf90cc115176275556c">NODEMAP_GID</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>enums containing the types of ids contained in a nodemap kept so other modules (mgs, mdt, etc) can define the type of search easily </p>
 <a href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a> { <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5a5321213090147860a687d422c100f2e5">NODEMAP_FS_TO_CLIENT</a>, 
<a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5a9faa3347ed2ee1aec2fa4c3fad7bee55">NODEMAP_CLIENT_TO_FS</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#ab0b2558102b3a24f1f0ed7b0418c4fad">nodemap_activate</a> (const bool value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">activate nodemap functions  <a href="#ab0b2558102b3a24f1f0ed7b0418c4fad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a24a4ef566c505d28d39f8ac1e7c71a6f">nodemap_add</a> (const char *nodemap_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a nodemap.  <a href="#a24a4ef566c505d28d39f8ac1e7c71a6f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#aa0d2b5976e04f7cccba42dc997f82d35">nodemap_del</a> (const char *nodemap_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete a nodemap.  <a href="#aa0d2b5976e04f7cccba42dc997f82d35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a47600f6aa8cec6c7517c286f442a3ccc">nodemap_add_member</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add a member to a nodemap  <a href="#a47600f6aa8cec6c7517c286f442a3ccc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a287485ca7ffe23967e60587ea9172a17">nodemap_del_member</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete a member from a nodemap  <a href="#a287485ca7ffe23967e60587ea9172a17"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a61e40f6905232c017ddbe2eb0c53d827">nodemap_parse_range</a> (const char *range_string, <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> range[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parse a nodemap range string into two nids  <a href="#a61e40f6905232c017ddbe2eb0c53d827"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a6dfb73d1f3faa3d1c44d18f5ee04e896">nodemap_parse_idmap</a> (char *idmap_string, __u32 idmap[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parse a string containing an id map of form "client_id:filesystem_id" into an array of __u32 * for use in mapping functions  <a href="#a6dfb73d1f3faa3d1c44d18f5ee04e896"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a5d7ea1360bc8ed644a4954ecf3db77ee">nodemap_add_range</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid[2])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a42f8fdd2ca78c999baa5379ff6fc088a">nodemap_del_range</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete a range  <a href="#a42f8fdd2ca78c999baa5379ff6fc088a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a76786fe350ace0a50238fb9cf7fe0bfa">nodemap_set_allow_root</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bool allow_root)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update flag to turn on or off nodemap functions  <a href="#a76786fe350ace0a50238fb9cf7fe0bfa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a49d9cc376b64323cc02b52718c5be7ae">nodemap_set_trust_client_ids</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bool trust_client_ids)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">updated trust_client_ids flag for nodemap  <a href="#a49d9cc376b64323cc02b52718c5be7ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a9a818c8be1fcc2c0a967cb95e121b408">nodemap_set_squash_uid</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, uid_t uid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">update the squash_uid for a nodemap  <a href="#a9a818c8be1fcc2c0a967cb95e121b408"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a74ee63a335b7bfad432bd42bf7752474">nodemap_set_squash_gid</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, gid_t gid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the squash_gid for a nodemap.  <a href="#a74ee63a335b7bfad432bd42bf7752474"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#ac1d8d273ed72879bbc0a0dac99a7e3a0">nodemap_can_setquota</a> (const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if this nodemap has root user access.  <a href="#ac1d8d273ed72879bbc0a0dac99a7e3a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a4b9ae4242c022d02094d35b79c6abe0a">nodemap_add_idmap</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, const __u32 map[2])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a671df76d169ff417bc391b9c98b7edbb">nodemap_del_idmap</a> (const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, const __u32 map[2])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete idmap from proper nodemap tree  <a href="#a671df76d169ff417bc391b9c98b7edbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a6e317ec43236a652b2aa411a93f41d0a">nodemap_map_id</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> id_type, enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a> tree_type, __u32 id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mapping function for nodemap idmaps  <a href="#a6e317ec43236a652b2aa411a93f41d0a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a2626cbd2240572f7f193e6d5f5679c98">nodemap_map_acl</a> (struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *nodemap, void *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, size_t <a class="el" href="parallel__grouplock_8c.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a> tree_type)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Map posix ACL entries according to the nodemap membership.  <a href="#a2626cbd2240572f7f193e6d5f5679c98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a3f87655a1d6e03c583dc17ea1bdee4cf">nodemap_test_nid</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, char *name_buf, size_t name_len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the nodemap classification for a given nid into an ioctl buffer.  <a href="#a3f87655a1d6e03c583dc17ea1bdee4cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#af1a03250476176ef30b163320dfb21f4">nodemap_test_id</a> (<a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a> nid, enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a> idtype, __u32 client_id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the id mapping for a given nid/id pair.  <a href="#af1a03250476176ef30b163320dfb21f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structnm__config__file.html">nm_config_file</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#a944e06a08db78a6aebf8af533df29e88">nm_config_file_register</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a <a class="el" href="structdt__object.html">dt_object</a> representing the config index file.  <a href="#a944e06a08db78a6aebf8af533df29e88"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lustre__nodemap_8h.html#ad6206a7f9f24210f127d0ded54ca00a4">nm_config_file_deregister</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structnm__config__file.html">nm_config_file</a> *ncf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deregister a <a class="el" href="structnm__config__file.html">nm_config_file</a>.  <a href="#ad6206a7f9f24210f127d0ded54ca00a4"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a09aa92849fa257a124c5582020fd6317"></a><!-- doxytag: member="lustre_nodemap.h::LUSTRE_NODEMAP_DEFAULT_ID" ref="a09aa92849fa257a124c5582020fd6317" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUSTRE_NODEMAP_DEFAULT_ID&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lustre__nodemap_8h_source.html#l00034">34</a> of file <a class="el" href="lustre__nodemap_8h_source.html">lustre_nodemap.h</a>.</p>

<p>Referenced by <a class="el" href="nodemap__handler_8c_source.html#l00772">nodemap_create()</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00487">nodemap_process_keyrec()</a>.</p>

</div>
</div>
<a class="anchor" id="a56fb14afe8f48b0950e8f055ec049dcc"></a><!-- doxytag: member="lustre_nodemap.h::LUSTRE_NODEMAP_NAME" ref="a56fb14afe8f48b0950e8f055ec049dcc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUSTRE_NODEMAP_NAME&nbsp;&nbsp;&nbsp;&quot;nodemap&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lustre__nodemap_8h_source.html#l00032">32</a> of file <a class="el" href="lustre__nodemap_8h_source.html">lustre_nodemap.h</a>.</p>

<p>Referenced by <a class="el" href="mgs__fs_8c_source.html#l00116">mgs_fs_setup()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l01115">nodemap_procfs_init()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a81845468d8a3390881570642981a38a4"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_id_type" ref="a81845468d8a3390881570642981a38a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>enums containing the types of ids contained in a nodemap kept so other modules (mgs, mdt, etc) can define the type of search easily </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a81845468d8a3390881570642981a38a4a0497746ebf6ec135e8e0ba8e9dc9d74a"></a><!-- doxytag: member="NODEMAP_UID" ref="a81845468d8a3390881570642981a38a4a0497746ebf6ec135e8e0ba8e9dc9d74a" args="" -->NODEMAP_UID</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81845468d8a3390881570642981a38a4a00362293ac49bdf90cc115176275556c"></a><!-- doxytag: member="NODEMAP_GID" ref="a81845468d8a3390881570642981a38a4a00362293ac49bdf90cc115176275556c" args="" -->NODEMAP_GID</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nodemap_8h_source.html#l00041">41</a> of file <a class="el" href="lustre__nodemap_8h_source.html">lustre_nodemap.h</a>.</p>

</div>
</div>
<a class="anchor" id="a15f74b6f9beee07e49fe3c27e947d4d5"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_tree_type" ref="a15f74b6f9beee07e49fe3c27e947d4d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a15f74b6f9beee07e49fe3c27e947d4d5a5321213090147860a687d422c100f2e5"></a><!-- doxytag: member="NODEMAP_FS_TO_CLIENT" ref="a15f74b6f9beee07e49fe3c27e947d4d5a5321213090147860a687d422c100f2e5" args="" -->NODEMAP_FS_TO_CLIENT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a15f74b6f9beee07e49fe3c27e947d4d5a9faa3347ed2ee1aec2fa4c3fad7bee55"></a><!-- doxytag: member="NODEMAP_CLIENT_TO_FS" ref="a15f74b6f9beee07e49fe3c27e947d4d5a9faa3347ed2ee1aec2fa4c3fad7bee55" args="" -->NODEMAP_CLIENT_TO_FS</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nodemap_8h_source.html#l00046">46</a> of file <a class="el" href="lustre__nodemap_8h_source.html">lustre_nodemap.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad6206a7f9f24210f127d0ded54ca00a4"></a><!-- doxytag: member="lustre_nodemap.h::nm_config_file_deregister" ref="ad6206a7f9f24210f127d0ded54ca00a4" args="(const struct lu_env *env, struct nm_config_file *ncf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nm_config_file_deregister </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnm__config__file.html">nm_config_file</a> *&nbsp;</td>
          <td class="paramname"> <em>ncf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deregister a <a class="el" href="structnm__config__file.html">nm_config_file</a>. </p>
<p>Should be called by targets during cleanup.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ncf</em>&nbsp;</td><td>config file to deregister </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__storage_8c_source.html#l00782">782</a> of file <a class="el" href="nodemap__storage_8c_source.html">nodemap_storage.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00105">nm_config_file::ncf_list</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00104">nm_config_file::ncf_obj</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="mgs__fs_8c_source.html#l00225">mgs_fs_cleanup()</a>, and <a class="el" href="mgs__fs_8c_source.html#l00116">mgs_fs_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a944e06a08db78a6aebf8af533df29e88"></a><!-- doxytag: member="lustre_nodemap.h::nm_config_file_register" ref="a944e06a08db78a6aebf8af533df29e88" args="(const struct lu_env *env, struct dt_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structnm__config__file.html">nm_config_file</a>* nm_config_file_register </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a <a class="el" href="structdt__object.html">dt_object</a> representing the config index file. </p>
<p>This should be called by targets in order to load the nodemap configuration from disk. The <a class="el" href="structdt__object.html">dt_object</a> should be created with local_index_find_or_create and the index features should be enabled with do_index_try.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td><a class="el" href="structdt__object.html">dt_object</a> returned by local_index_find_or_create</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>on</em>&nbsp;</td><td>success: <a class="el" href="structnm__config__file.html">nm_config_file</a> handle for later deregistration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>memory allocation failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOENT</em>&nbsp;</td><td>error loading nodemap config </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>error loading nodemap config </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__storage_8c_source.html#l00740">740</a> of file <a class="el" href="nodemap__storage_8c_source.html">nodemap_storage.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00105">nm_config_file::ncf_list</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00104">nm_config_file::ncf_obj</a>, <a class="el" href="nodemap__storage_8c_source.html#l00621">nodemap_load_entries()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="mgs__fs_8c_source.html#l00116">mgs_fs_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="ab0b2558102b3a24f1f0ed7b0418c4fad"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_activate" ref="ab0b2558102b3a24f1f0ed7b0418c4fad" args="(const bool value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_activate </td>
          <td>(</td>
          <td class="paramtype">const bool&nbsp;</td>
          <td class="paramname"> <em>value</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>activate nodemap functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>1 for on, 0 for off </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01088">1088</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l01286">nm_member_revoke_all()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00085">nodemap_config::nmc_nodemap_is_active</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, and <a class="el" href="nodemap__storage_8c_source.html#l00469">nodemap_idx_nodemap_activate()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00257">nodemap_active_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a24a4ef566c505d28d39f8ac1e7c71a6f"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_add" ref="a24a4ef566c505d28d39f8ac1e7c71a6f" args="(const char *nodemap_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nodemap_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>invalid nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EEXIST</em>&nbsp;</td><td>nodemap already exists </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOMEM</em>&nbsp;</td><td>cannot allocate memory for nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01002">1002</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01165">lprocfs_nodemap_register()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00772">nodemap_create()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00346">nodemap_idx_nodemap_add()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00602">lprocfs_add_nodemap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b9ae4242c022d02094d35b79c6abe0a"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_add_idmap" ref="a4b9ae4242c022d02094d35b79c6abe0a" args="(const char *name, enum nodemap_id_type id_type, const __u32 map[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_idmap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u32&nbsp;</td>
          <td class="paramname"> <em>map</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00416">416</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00396">nodemap_add_idmap_helper()</a>, <a class="el" href="nodemap__internal_8h.html#a0cdd9ca432fa5968ba35f232eeeebd32">nodemap_idx_idmap_add()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00845">lprocfs_add_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a47600f6aa8cec6c7517c286f442a3ccc"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_add_member" ref="a47600f6aa8cec6c7517c286f442a3ccc" args="(lnet_nid_t nid, struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_member </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add a member to a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to add to the members </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exp</em>&nbsp;</td><td><a class="el" href="structobd__export.html" title="Export structure.">obd_export</a> structure for the connection that is being added </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>export is NULL </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EEXIST</em>&nbsp;</td><td>export is already member of a nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00351">351</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__member_8c_source.html#l00079">nm_member_add()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l05252">mdt_obd_connect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05333">mdt_obd_reconnect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00340">ofd_obd_connect()</a>, and <a class="el" href="ofd__obd_8c_source.html#l00295">ofd_obd_reconnect()</a>.</p>

</div>
</div>
<a class="anchor" id="a5d7ea1360bc8ed644a4954ecf3db77ee"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_add_range" ref="a5d7ea1360bc8ed644a4954ecf3db77ee" args="(const char *name, const lnet_nid_t nid[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_add_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00684">684</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00644">nodemap_add_range_helper()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00727">lprocfs_add_nodemap_range_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1d8d273ed72879bbc0a0dac99a7e3a0"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_can_setquota" ref="ac1d8d273ed72879bbc0a0dac99a7e3a0" args="(const struct lu_nodemap *nodemap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool nodemap_can_setquota </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns true if this nodemap has root user access. </p>
<p>Always returns true if nodemaps are not active.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td>nodemap to check access for </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00987">987</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l02016">mdt_quotactl()</a>.</p>

</div>
</div>
<a class="anchor" id="aa0d2b5976e04f7cccba42dc997f82d35"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_del" ref="aa0d2b5976e04f7cccba42dc997f82d35" args="(const char *nodemap_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>nodemap_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemmap </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>invalid input </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ENOENT</em>&nbsp;</td><td>no existing nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01033">1033</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="hash_8c_source.html#l01331">cfs_hash_del_key()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00042">DEFAULT_NODEMAP</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="nodemap__lproc_8c_source.html#l01151">lprocfs_nodemap_remove()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00093">lu_nodemap::nm_pde_data</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00077">lu_nodemap::nm_ranges</a>, <a class="el" href="nodemap__internal_8h_source.html#l00100">nodemap_config::nmc_nodemap_hash</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__storage_8c_source.html#l00356">nodemap_idx_nodemap_del()</a>, <a class="el" href="nodemap__storage_8c_source.html#l00418">nodemap_idx_range_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00174">range_delete()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="nodemap__internal_8h_source.html#l00059">lu_nid_range::rn_list</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00645">lprocfs_del_nodemap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a671df76d169ff417bc391b9c98b7edbb"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_del_idmap" ref="a671df76d169ff417bc391b9c98b7edbb" args="(const char *name, enum nodemap_id_type id_type, const __u32 map[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del_idmap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u32&nbsp;</td>
          <td class="paramname"> <em>map</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete idmap from proper nodemap tree </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id_type</em>&nbsp;</td><td>NODEMAP_UID or NODEMAP_GID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>map</em>&nbsp;</td><td>array[2] __u32 containing the mapA values map[0] is client id map[1] is the filesystem id</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00455">455</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00164">idmap_delete()</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00196">idmap_search()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00048">NODEMAP_CLIENT_TO_FS</a>, <a class="el" href="nodemap__internal_8h.html#a87acb847dc6412ec3dd8af5e2cfbbe93">nodemap_idx_idmap_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00914">lprocfs_del_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a287485ca7ffe23967e60587ea9172a17"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_del_member" ref="a287485ca7ffe23967e60587ea9172a17" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_del_member </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete a member from a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>exp</em>&nbsp;</td><td>export to remove from a nodemap </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00376">376</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__member_8c_source.html#l00041">nm_member_del()</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l05252">mdt_obd_connect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05225">mdt_obd_disconnect()</a>, <a class="el" href="mdt__handler_8c_source.html#l05333">mdt_obd_reconnect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00340">ofd_obd_connect()</a>, <a class="el" href="ofd__obd_8c_source.html#l00411">ofd_obd_disconnect()</a>, and <a class="el" href="ofd__obd_8c_source.html#l00295">ofd_obd_reconnect()</a>.</p>

</div>
</div>
<a class="anchor" id="a42f8fdd2ca78c999baa5379ff6fc088a"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_del_range" ref="a42f8fdd2ca78c999baa5379ff6fc088a" args="(const char *name, const lnet_nid_t nid[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_del_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete a range </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>range_str</em>&nbsp;</td><td>string containing range </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Delete range from global range tree, and remove it from the list in the associated nodemap. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00716">716</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="nodemap__member_8c_source.html#l00141">nm_member_reclassify_nodemap()</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="nodemap__internal_8h_source.html#l00088">nodemap_config::nmc_default_nodemap</a>, <a class="el" href="nodemap__internal_8h_source.html#l00094">nodemap_config::nmc_range_tree</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__storage_8c_source.html#l00418">nodemap_idx_range_del()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>, <a class="el" href="nodemap__range_8c_source.html#l00174">range_delete()</a>, and <a class="el" href="nodemap__range_8c_source.html#l00112">range_find()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00786">lprocfs_del_nodemap_range_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a2626cbd2240572f7f193e6d5f5679c98"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_map_acl" ref="a2626cbd2240572f7f193e6d5f5679c98" args="(struct lu_nodemap *nodemap, void *buf, size_t size, enum nodemap_tree_type tree_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t nodemap_map_acl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a>&nbsp;</td>
          <td class="paramname"> <em>tree_type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Map posix ACL entries according to the nodemap membership. </p>
<p>Removes any squashed ACLs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structlu__nodemap.html" title="The nodemap id 0 will be the default nodemap.">lu_nodemap</a></em>&nbsp;</td><td>nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer containing xattr encoded ACLs </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>size of ACLs in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tree_type</em>&nbsp;</td><td>direction of mapping </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>new size of ACLs in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>bad <em>size</em> param, see posix_acl_xattr_count() </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00580">580</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01851">posix_acl_xattr_header::a_entries</a>, <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01846">posix_acl_xattr_entry::e_id</a>, <a class="el" href="lustre_2utils_2wirecheck_8c_source.html#l01844">posix_acl_xattr_entry::e_tag</a>, <a class="el" href="mdsrate_8c_source.html#l00132">end</a>, <a class="el" href="it__test_8c_source.html#l00070">header</a>, <a class="el" href="byteorder_8h_source.html#l00054">le16_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00043">NODEMAP_GID</a>, <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00042">NODEMAP_UID</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="mdt__xattr_8c_source.html#l00363">mdt_reint_setxattr()</a>.</p>

</div>
</div>
<a class="anchor" id="a6e317ec43236a652b2aa411a93f41d0a"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_map_id" ref="a6e317ec43236a652b2aa411a93f41d0a" args="(struct lu_nodemap *nodemap, enum nodemap_id_type id_type, enum nodemap_tree_type tree_type, __u32 id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u32 nodemap_map_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__nodemap.html">lu_nodemap</a> *&nbsp;</td>
          <td class="paramname"> <em>nodemap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>id_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a15f74b6f9beee07e49fe3c27e947d4d5">nodemap_tree_type</a>&nbsp;</td>
          <td class="paramname"> <em>tree_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mapping function for nodemap idmaps </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nodemap</em>&nbsp;</td><td><a class="el" href="structlu__nodemap.html" title="The nodemap id 0 will be the default nodemap.">lu_nodemap</a> structure defining nodemap </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>node_type</em>&nbsp;</td><td>NODEMAP_UID or NODEMAP_GID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tree_type</em>&nbsp;</td><td>NODEMAP_CLIENT_TO_FS or NODEMAP_FS_TO_CLIENT </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>id to map</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mapped</em>&nbsp;</td><td>id according to the rules below.</td></tr>
  </table>
  </dd>
</dl>
<p>if the nodemap_active is false, just return the passed id without mapping</p>
<p>if the id to be looked up is 0, check that root access is allowed and if it is, return 0. Otherwise, return the squash uid or gid.</p>
<p>if the nodemap is configured to trusted the ids from the client system, just return the passwd id without mapping.</p>
<p>if by this point, we haven't returned and the nodemap in question is the default nodemap, return the squash uid or gid.</p>
<p>after these checks, search the proper tree for the mapping, and if found return the mapped value, otherwise return the squash uid or gid. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00519">519</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h_source.html#l00066">lu_idmap::id_client</a>, <a class="el" href="nodemap__internal_8h_source.html#l00068">lu_idmap::id_fs</a>, <a class="el" href="nodemap__idmap_8c_source.html#l00196">idmap_search()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00266">is_default_nodemap()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00079">lu_nodemap::nm_idmap_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_trust_client_ids</a>, <a class="el" href="nodemap__handler_8c_source.html#l00048">nodemap_active</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00047">NODEMAP_FS_TO_CLIENT</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00042">NODEMAP_UID</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="mdt__handler_8c_source.html#l00501">mdt_pack_attr2body()</a>, <a class="el" href="mdt__handler_8c_source.html#l02016">mdt_quotactl()</a>, <a class="el" href="mdt__lib_8c_source.html#l00909">mdt_setattr_unpack_rec()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00580">nodemap_map_acl()</a>, <a class="el" href="nodemap__handler_8c_source.html#l01339">nodemap_test_id()</a>, <a class="el" href="ofd__dev_8c_source.html#l02210">ofd_quotactl()</a>, <a class="el" href="mdt__lib_8c_source.html#l00518">old_init_ucred()</a>, <a class="el" href="mdt__lib_8c_source.html#l00552">old_init_ucred_reint()</a>, and <a class="el" href="tgt__handler_8c_source.html#l00241">tgt_ost_body_unpack()</a>.</p>

</div>
</div>
<a class="anchor" id="a6dfb73d1f3faa3d1c44d18f5ee04e896"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_parse_idmap" ref="a6dfb73d1f3faa3d1c44d18f5ee04e896" args="(char *idmap_string, __u32 idmap[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_parse_idmap </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>idmap_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>idmap</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parse a string containing an id map of form "client_id:filesystem_id" into an array of __u32 * for use in mapping functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>idmap_str</em>&nbsp;</td><td>map string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idmap</em>&nbsp;</td><td>array[2] of __u32</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if idmap cannot be parsed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00313">313</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="linux-misc_8h_source.html#l00049">kstrtoul()</a>.</p>

<p>Referenced by <a class="el" href="nodemap__lproc_8c_source.html#l00845">lprocfs_add_nodemap_idmap_seq_write()</a>, <a class="el" href="nodemap__lproc_8c_source.html#l00914">lprocfs_del_nodemap_idmap_seq_write()</a>, and <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>.</p>

</div>
</div>
<a class="anchor" id="a61e40f6905232c017ddbe2eb0c53d827"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_parse_range" ref="a61e40f6905232c017ddbe2eb0c53d827" args="(const char *range_string, lnet_nid_t range[2])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_parse_range </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>range_str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>range</em>[2]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parse a nodemap range string into two nids </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>range_str</em>&nbsp;</td><td>string to parse </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>range[2]</em>&nbsp;</td><td>array of two nids  0 on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00278">278</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lnet_2lnet_2nidstrings_8c_source.html#l01210">libcfs_str2nid()</a>, and <a class="el" href="nidstr_8h_source.html#l00057">LNET_NIDSTR_SIZE</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00686">parse_nids()</a>.</p>

</div>
</div>
<a class="anchor" id="a76786fe350ace0a50238fb9cf7fe0bfa"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_set_allow_root" ref="a76786fe350ace0a50238fb9cf7fe0bfa" args="(const char *name, bool allow_root)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_allow_root </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>allow_root</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update flag to turn on or off nodemap functions </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>admin_string</em>&nbsp;</td><td>string containing updated value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update admin flag to turn on or off nodemap functions. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00864">864</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_allow_root_access</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00573">nodemap_admin_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a74ee63a335b7bfad432bd42bf7752474"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_set_squash_gid" ref="a74ee63a335b7bfad432bd42bf7752474" args="(const char *name, gid_t gid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_squash_gid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gid_t&nbsp;</td>
          <td class="paramname"> <em>gid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the squash_gid for a nodemap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gid_string</em>&nbsp;</td><td>string containing new squash_gid value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the squash_gid for a nodemap. The squash_uid is the gid that the all client gids are mapped to if nodemap is active, the trust_client_ids flag is not set, and the gid is not in the idmap tree. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00960">960</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00075">lu_nodemap::nm_squash_gid</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00504">nodemap_squash_gid_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a9a818c8be1fcc2c0a967cb95e121b408"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_set_squash_uid" ref="a9a818c8be1fcc2c0a967cb95e121b408" args="(const char *name, uid_t uid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_squash_uid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uid_t&nbsp;</td>
          <td class="paramname"> <em>uid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>update the squash_uid for a nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uid_string</em>&nbsp;</td><td>string containing new squash_uid value </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the squash_uid for a nodemap. The squash_uid is the uid that the all client uids are mapped to if nodemap is active, the trust_client_ids flag is not set, and the uid is not in the idmap tree. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00927">927</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00073">lu_nodemap::nm_squash_uid</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00464">nodemap_squash_uid_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a49d9cc376b64323cc02b52718c5be7ae"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_set_trust_client_ids" ref="a49d9cc376b64323cc02b52718c5be7ae" args="(const char *name, bool trust_client_ids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nodemap_set_trust_client_ids </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>trust_client_ids</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>updated trust_client_ids flag for nodemap </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>nodemap name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trust_string</em>&nbsp;</td><td>new value for trust flag </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Update the trust_client_ids flag for a nodemap. </p>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l00894">894</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="nodemap__member_8c_source.html#l00190">nm_member_revoke_locks()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00066">lu_nodemap::nmf_trust_client_ids</a>, <a class="el" href="nodemap__storage_8c_source.html#l00351">nodemap_idx_nodemap_update()</a>, <a class="el" href="nodemap__handler_8c_source.html#l00225">nodemap_lookup()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__llog_8c_source.html#l04102">mgs_nodemap_cmd()</a>, and <a class="el" href="nodemap__lproc_8c_source.html#l00544">nodemap_trusted_seq_write()</a>.</p>

</div>
</div>
<a class="anchor" id="af1a03250476176ef30b163320dfb21f4"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_test_id" ref="af1a03250476176ef30b163320dfb21f4" args="(lnet_nid_t nid, enum nodemap_id_type idtype, __u32 client_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__u32 nodemap_test_id </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lustre__nodemap_8h.html#a81845468d8a3390881570642981a38a4">nodemap_id_type</a>&nbsp;</td>
          <td class="paramname"> <em>idtype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>client_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the id mapping for a given nid/id pair. </p>
<p>Useful for testing the nodemap configuration to make sure it is working as expected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to classify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>idtype</em>&nbsp;</td><td>uid or gid </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>client_id</em>&nbsp;</td><td>id to map to fs</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>mapped fs_id of the given client_id </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01339">1339</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00048">NODEMAP_CLIENT_TO_FS</a>, <a class="el" href="nodemap__handler_8c_source.html#l00519">nodemap_map_id()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>.</p>

</div>
</div>
<a class="anchor" id="a3f87655a1d6e03c583dc17ea1bdee4cf"></a><!-- doxytag: member="lustre_nodemap.h::nodemap_test_nid" ref="a3f87655a1d6e03c583dc17ea1bdee4cf" args="(lnet_nid_t nid, char *name_buf, size_t name_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodemap_test_nid </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312">lnet_nid_t</a>&nbsp;</td>
          <td class="paramname"> <em>nid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>name_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the nodemap classification for a given nid into an ioctl buffer. </p>
<p>Useful for testing the nodemap configuration to make sure it is working as expected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nid</em>&nbsp;</td><td>nid to classify </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>name_buf</em>&nbsp;</td><td>buffer to write the nodemap name to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name_len</em>&nbsp;</td><td>length of buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nodemap__handler_8c_source.html#l01311">1311</a> of file <a class="el" href="nodemap__handler_8c_source.html">nodemap_handler.c</a>.</p>

<p>References <a class="el" href="nodemap__internal_8h.html#a9ceb1c86d8eba61e36ec42a9ae9f492c">active_config_lock</a>, <a class="el" href="lustre__nodemap_8h_source.html#l00064">lu_nodemap::nm_name</a>, <a class="el" href="nodemap__internal_8h_source.html#l00093">nodemap_config::nmc_range_tree_lock</a>, <a class="el" href="nodemap__handler_8c_source.html#l00247">nodemap_classify_nid()</a>, and <a class="el" href="nodemap__handler_8c_source.html#l00101">nodemap_putref()</a>.</p>

<p>Referenced by <a class="el" href="mgs__handler_8c_source.html#l00650">mgs_iocontrol_nodemap()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:47 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
