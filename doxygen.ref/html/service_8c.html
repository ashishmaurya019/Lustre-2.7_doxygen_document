<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ptlrpc/service.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ptlrpc/service.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__support_8h_source.html">obd_support.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lu__object_8h_source.html">lu_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lnet_2include_2lnet_2types_8h_source.html">lnet/types.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ptlrpc__internal_8h_source.html">ptlrpc_internal.h</a>&quot;</code><br/>

<p><a href="service_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__hr__thread.html">ptlrpc_hr_thread</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__hr__partition.html">ptlrpc_hr_partition</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__hr__service.html">ptlrpc_hr_service</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrs__batch.html">rs_batch</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_RPC</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a74f50884015f0b41cda5a936cf25dc1f">HRT_RUNNING</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#afa47a1bdedf2b8af1cfb64ae2cccd6d8">HRT_STOPPING</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a0e7952bed1f9084bd75d14b91da45ba1">MAX_SCHEDULED</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">maximum mumber of replies scheduled in one batch  <a href="#a0e7952bed1f9084bd75d14b91da45ba1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ae1ce5b998befbc6511c12bd072d274ad">DECLARE_RS_BATCH</a>(b)&nbsp;&nbsp;&nbsp;struct <a class="el" href="structrs__batch.html">rs_batch</a> b</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a8866e15ce909777c49f9260d4f52161d">module_param</a> (<a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a>, int, 0444)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a3e171ccbf747fcc6bd1c7f860dcd429d">MODULE_PARM_DESC</a> (<a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a>,&quot;set non-zero to put pressure on request buffer pools&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a5c6ecc25e9c0e4254ec1281cd957b55d">module_param</a> (<a class="el" href="group__export.html#gac018b3cde737ca787e95380e27734ffd">at_min</a>, int, 0644)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aaa5ac77f46f16f6c3ca5d879576cd19b">MODULE_PARM_DESC</a> (<a class="el" href="group__export.html#gac018b3cde737ca787e95380e27734ffd">at_min</a>,&quot;Adaptive <a class="el" href="o2iblnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> minimum (sec)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a5f074ac89cf2bc64df1f0e2d8701b4ff">module_param</a> (<a class="el" href="group__export.html#gad437939efbc33a157b6f386ac4a92ecb">at_max</a>, int, 0644)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac85aad1065368ea01ac59488dcec926d">MODULE_PARM_DESC</a> (<a class="el" href="group__export.html#gad437939efbc33a157b6f386ac4a92ecb">at_max</a>,&quot;Adaptive <a class="el" href="o2iblnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> maximum (sec)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a7b441740e87a80ed72ad126a7e246a1f">module_param</a> (<a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a>, int, 0644)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a09b982a6b3f1a3c99e03069a34ce8ab0">MODULE_PARM_DESC</a> (<a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a>,&quot;Adaptive timeouts remember the slowest event that took place within this period (sec)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac3682f00145553e514cdc0f6bd9c82dd">module_param</a> (<a class="el" href="class__obd_8c.html#a47a70ddef4976d21923b761d4b637514">at_early_margin</a>, int, 0644)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aa13bcb11caae6a01f924300da7ab8e4f">MODULE_PARM_DESC</a> (<a class="el" href="class__obd_8c.html#a47a70ddef4976d21923b761d4b637514">at_early_margin</a>,&quot;How soon before an RPC deadline to send an early reply&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a7b1b8ffd1bfebf5f7a1c3d99974a0b34">module_param</a> (<a class="el" href="class__obd_8c.html#a30b9fa4cca5a373d84fb01422c5e239d">at_extra</a>, int, 0644)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a679fb2727a7a142f91e4b32e10ada487">MODULE_PARM_DESC</a> (<a class="el" href="class__obd_8c.html#a30b9fa4cca5a373d84fb01422c5e239d">at_extra</a>,&quot;How much extra time to give with each early reply&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aa3c644131d0f98fd22ad9ba28d49974c">ptlrpc_server_post_idle_rqbds</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aaa197378ce94c91c9a218f7b3f3faa8c">ptlrpc_server_hpreq_fini</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove the request from the export list.  <a href="#aaa197378ce94c91c9a218f7b3f3faa8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a7a53df8d8b8dad6cc5e77af7524794eb">ptlrpc_at_remove_timed</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structptlrpc__request__buffer__desc.html">ptlrpc_request_buffer_desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aed50b6950afc4c4f1b9a2bac3a9e2e8b">ptlrpc_alloc_rqbd</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ab4c8313b60651ab857fe795c83b71b64">ptlrpc_free_rqbd</a> (struct <a class="el" href="structptlrpc__request__buffer__desc.html">ptlrpc_request_buffer_desc</a> *rqbd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a30a2276abeb17ab744d168f4e53c2ee8">ptlrpc_grow_req_bufs</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, int post)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga686ce1d3f4b5ce9b59e59136cb6b265c">ptlrpc_save_lock</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lock, int <a class="el" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, int no_ack)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Part of Rep-Ack logic.  <a href="group__net.html#ga686ce1d3f4b5ce9b59e59136cb6b265c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a411747971396d61bbbaf5b5644fff526">rs_batch_init</a> (struct <a class="el" href="structrs__batch.html">rs_batch</a> *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a reply batch.  <a href="#a411747971396d61bbbaf5b5644fff526"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structptlrpc__hr__thread.html">ptlrpc_hr_thread</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a9f6d78a36a493da0ddbcdb98eb6c1b70">ptlrpc_hr_select</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Choose an hr thread to dispatch requests to.  <a href="#a9f6d78a36a493da0ddbcdb98eb6c1b70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a8508e7a2ae29df691ccbce2c99d12da3">rs_batch_dispatch</a> (struct <a class="el" href="structrs__batch.html">rs_batch</a> *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dispatch all replies accumulated in the batch to one from dedicated reply handling threads.  <a href="#a8508e7a2ae29df691ccbce2c99d12da3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac0db37205b6dec202322fd1fcfe8cfbe">rs_batch_add</a> (struct <a class="el" href="structrs__batch.html">rs_batch</a> *b, struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *rs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a reply to a batch.  <a href="#ac0db37205b6dec202322fd1fcfe8cfbe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a779db3012eec07c43c3d57dc0fb2bff4">rs_batch_fini</a> (struct <a class="el" href="structrs__batch.html">rs_batch</a> *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reply batch finalization.  <a href="#a779db3012eec07c43c3d57dc0fb2bff4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gac133162c229195f6e9479dd79aac6473">ptlrpc_dispatch_difficult_reply</a> (struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *rs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Put reply state into a queue for processing because we received ACK from the client.  <a href="group__net.html#gac133162c229195f6e9479dd79aac6473"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga9ab523a4b395599275d00e72079b51f9">ptlrpc_schedule_difficult_reply</a> (struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *rs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga1c4d3548ace7c49c820adf3d6610f7a8">ptlrpc_commit_replies</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#af921ffb9ea5bd5fa5e842e754bb41f29">ptlrpc_at_timer</a> (unsigned long castmeharder)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac741a2591e6035bc09f137d7a799e811">ptlrpc_server_nthreads_check</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, struct <a class="el" href="structptlrpc__service__conf.html">ptlrpc_service_conf</a> *conf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ae8ee0d436d5d29f2484f26aec0bbc224">ptlrpc_service_part_init</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, int cpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize percpt data for a service.  <a href="#ae8ee0d436d5d29f2484f26aec0bbc224"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga13835bf69545de9744051ff7ef02a4c3">ptlrpc_register_service</a> (struct <a class="el" href="structptlrpc__service__conf.html">ptlrpc_service_conf</a> *conf, struct proc_dir_entry *proc_entry)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize service on a given portal.  <a href="group__net.html#ga13835bf69545de9744051ff7ef02a4c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a2489791165b9da8139f7e6c88c50f26f">ptlrpc_server_free_request</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">to actually free the request, must be called without holding svc_lock.  <a href="#a2489791165b9da8139f7e6c88c50f26f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga45bbc99a8cb3940b830d5ac581cd2f10">ptlrpc_server_drop_request</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">drop a reference count of the request.  <a href="group__net.html#ga45bbc99a8cb3940b830d5ac581cd2f10"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gaedae07eef44eef7ce7d1b0cfe437804f">ptlrpc_request_change_export</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, struct <a class="el" href="structobd__export.html">obd_export</a> *export)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change request export and move hp request from old export to new.  <a href="group__net.html#gaedae07eef44eef7ce7d1b0cfe437804f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a2d71c5442a9a62c66bd99bc984d2c8d1">ptlrpc_server_finish_request</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">to finish a request: stop sending more early replies, and release the request.  <a href="#a2d71c5442a9a62c66bd99bc984d2c8d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a82747d1c580374cfd9087a99f1c67750">ptlrpc_server_finish_active_request</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">to finish an active request: stop sending more early replies, and release the request.  <a href="#a82747d1c580374cfd9087a99f1c67750"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga3b962a1b6e534a49a4848336555d1d89">ptlrpc_update_export_timer</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp, long extra_delay)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function makes sure dead exports are evicted in a timely manner.  <a href="group__net.html#ga3b962a1b6e534a49a4848336555d1d89"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a80f18cb077b5d857391b16687f9dcb0e">ptlrpc_check_req</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sanity check request <em>req</em>.  <a href="#a80f18cb077b5d857391b16687f9dcb0e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a4757a6d721555e12790af773a0b36145">ptlrpc_at_set_timer</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a870c7d7495f1f30e402923ad17a49687">ptlrpc_at_add_timed</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aa46d5add9948a153701350bb60d73f40">ptlrpc_at_send_early_reply</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aa7ee569529c9251f8c0abed514c5c8e5">ptlrpc_at_check_timed</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a4fe9438acef5ce97dd9c9948c15211d1">ptlrpc_server_check_resend_in_progress</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a2f4b65688f54e1839964c171450ad4e2">ptlrpc_server_hpreq_init</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a request should be assigned with a high priority.  <a href="#a2f4b65688f54e1839964c171450ad4e2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a3998b53a9b8e5f5daae67e33d71d9d4b">ptlrpc_hpreq_check</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga6539e422ce487ae5c6cdeb3855ffdc96">ptlrpc_hpreq_handler</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a22d78c661b2c78da1b7e5c06d50510f5">ptlrpc_server_request_add</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aad3a54e6eed55c20c2fcb640b152f720">ptlrpc_server_allow_high</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allow to handle high priority request User can call it w/o any lock but need to hold ptlrpc_service_part::scp_req_lock to get reliable result.  <a href="#aad3a54e6eed55c20c2fcb640b152f720"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac5e70e9ac0846630ba9e4d3e1a50156b">ptlrpc_server_high_pending</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac6e38d8c616e2daee51de465d2d7013a">ptlrpc_server_allow_normal</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Only allow normal priority requests on a service that has a high-priority queue if forced (i.e.  <a href="#ac6e38d8c616e2daee51de465d2d7013a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a07185adbcc9ce1e9ca17cb1a13789e00">ptlrpc_server_normal_pending</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ac05b630214d88cf338cae0215329ffac">ptlrpc_server_request_pending</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if there are requests available in incoming request queue for processing and it is allowed to fetch them.  <a href="#ac05b630214d88cf338cae0215329ffac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a6974eddc8d099fb5e20dcc08d3863f35">ptlrpc_server_request_get</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, bool force)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fetch a request for processing from queue of unprocessed requests.  <a href="#a6974eddc8d099fb5e20dcc08d3863f35"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#af551f3c6043b58390a944685f0010c4e">ptlrpc_server_handle_req_in</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *<a class="el" href="obd_8c.html#a20057145635eb007e0621c11bc2d7176">thread</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle freshly incoming reqs, add to timed early reply list, pass on to regular request queue.  <a href="#af551f3c6043b58390a944685f0010c4e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a9380f0d64f1bd15f62f971bccdc810b7">ptlrpc_server_handle_request</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *<a class="el" href="obd_8c.html#a20057145635eb007e0621c11bc2d7176">thread</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main incoming request handling logic.  <a href="#a9380f0d64f1bd15f62f971bccdc810b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a028888de363f84cfcc617068e00c9f78">ptlrpc_handle_rs</a> (struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *rs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An internal function to process a single reply state object.  <a href="#a028888de363f84cfcc617068e00c9f78"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ae95b1f7839d3ace23bfa28a6be4fd70c">ptlrpc_check_rqbd_pool</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a909aa12fe9994a55430ff3e660c01f4c">ptlrpc_retry_rqbds</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a3cfdf38f0d5acd7850dd17575a69560e">ptlrpc_threads_enough</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a4430e2147c91e0e0a9d599b81203221e">ptlrpc_threads_increasable</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">allowed to create more threads user can call it w/o any lock but need to hold ptlrpc_service_part::scp_lock to get reliable result  <a href="#a4430e2147c91e0e0a9d599b81203221e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a2506ff0b950b2484e9d414ac8fcda9d8">ptlrpc_threads_need_create</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">too many requests and allowed to create more threads  <a href="#a2506ff0b950b2484e9d414ac8fcda9d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a83a141ecdccbc4b49ab3c20b9c02de30">ptlrpc_thread_stopping</a> (struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *<a class="el" href="obd_8c.html#a20057145635eb007e0621c11bc2d7176">thread</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#af8041c3cf09a9ac2e2f56d44e9d71d7a">ptlrpc_rqbd_pending</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a636d42759b82b23e7c74c1023c6e5862">ptlrpc_at_check</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a0322266f64e271acfbab011e51926e55">ptlrpc_server_request_incoming</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">requests wait on preprocessing user can call it w/o any lock but need to hold ptlrpc_service_part::scp_lock to get reliable result  <a href="#a0322266f64e271acfbab011e51926e55"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a1775ae7f2480ffa206fe948279e60e45">__attribute__</a> ((__noinline__))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aac3d1f47bc27111a611b1c116255f53c">ptlrpc_main</a> (void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main thread body for service threads.  <a href="#aac3d1f47bc27111a611b1c116255f53c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a2f5691160ea879ec21a77c501e649740">hrt_dont_sleep</a> (struct <a class="el" href="structptlrpc__hr__thread.html">ptlrpc_hr_thread</a> *hrt, struct <a class="el" href="structlist__head.html">list_head</a> *replies)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ae480dac18fde296385661bf5d397128d">ptlrpc_hr_main</a> (void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main body of "handle reply" function.  <a href="#ae480dac18fde296385661bf5d397128d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aaeadc494869c167148325113344afdeb">ptlrpc_stop_hr_threads</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a3605ffc33362009878bd0b077a1f577d">ptlrpc_start_hr_threads</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a62db31ec83e712c6dfd032092407be6b">ptlrpc_svcpt_stop_threads</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga59db7fb30a02fd79e28791330f99fb3c">ptlrpc_stop_all_threads</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stops all threads of a particular service <em>svc</em>.  <a href="group__net.html#ga59db7fb30a02fd79e28791330f99fb3c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gae98dcdbb3ab34d8e067f6caf336c9d31">ptlrpc_start_threads</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ae010a629f5f836492d7726dcf2692a0e">ptlrpc_start_thread</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt, int wait)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga47eab7558ff3a05ad0bd51901e737849">ptlrpc_hr_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga48bcd41298dc75aed55d30b850d28c26">ptlrpc_hr_fini</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#af06fb62ce2b0948a26182475c53245c7">ptlrpc_wait_replies</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait until all already scheduled replies are processed.  <a href="#af06fb62ce2b0948a26182475c53245c7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a81a779f138575827c60f3e9e562d1e44">ptlrpc_service_del_atimer</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a0715e555526b5bb028ef352dc19a58a5">ptlrpc_service_unlink_rqbd</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#aea01c5861feea88341d2a351ff7574c3">ptlrpc_service_purge_all</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a43254fcf67c7956fe3e38637b11086be">ptlrpc_service_free</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga2f7edc9d9d00fa395262051c0f9fc855">ptlrpc_unregister_service</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *<a class="el" href="o2iblnd__modparams_8c.html#a00f09e31c707a86ebc6b0cf74e934633">service</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#ada6b019d287e10df1411a160eb834584">ptlrpc_svcpt_health_check</a> (struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *svcpt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns 0 if the service is healthy.  <a href="#ada6b019d287e10df1411a160eb834584"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga7bc966179d16fa5e27e45a95523b0386">ptlrpc_service_health_check</a> (struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlist__head.html">list_head</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a9bbbe993837b9f20a26325525bc76bfb">ptlrpc_all_services</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Holds a list of all PTLRPC services.  <a href="#a9bbbe993837b9f20a26325525bc76bfb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct mutex&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a9e88c117c1eccb6da9707b1f9430d4f3">ptlrpc_all_services_mutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used to protect the <em>ptlrpc_all_services</em> list.  <a href="#a9e88c117c1eccb6da9707b1f9430d4f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structptlrpc__hr__service.html">ptlrpc_hr_service</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#a6750d361795df91f3863e34d25ef5072">ptlrpc_hr</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">reply handling service.  <a href="#a6750d361795df91f3863e34d25ef5072"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structptlrpc__hpreq__ops.html">ptlrpc_hpreq_ops</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="service_8c.html#affadc36d1336031381dedcf4b2720d6e">ptlrpc_hpreq_common</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="service.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_RPC</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00037">37</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae1ce5b998befbc6511c12bd072d274ad"></a><!-- doxytag: member="service.c::DECLARE_RS_BATCH" ref="ae1ce5b998befbc6511c12bd072d274ad" args="(b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECLARE_RS_BATCH</td>
          <td>(</td>
          <td class="paramtype">b&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;struct <a class="el" href="structrs__batch.html">rs_batch</a> b</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00362">362</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00408">ptlrpc_commit_replies()</a>.</p>

</div>
</div>
<a class="anchor" id="a74f50884015f0b41cda5a936cf25dc1f"></a><!-- doxytag: member="service.c::HRT_RUNNING" ref="a74f50884015f0b41cda5a936cf25dc1f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HRT_RUNNING&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00230">230</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

</div>
</div>
<a class="anchor" id="afa47a1bdedf2b8af1cfb64ae2cccd6d8"></a><!-- doxytag: member="service.c::HRT_STOPPING" ref="afa47a1bdedf2b8af1cfb64ae2cccd6d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HRT_STOPPING&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00231">231</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0e7952bed1f9084bd75d14b91da45ba1"></a><!-- doxytag: member="service.c::MAX_SCHEDULED" ref="a0e7952bed1f9084bd75d14b91da45ba1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SCHEDULED&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>maximum mumber of replies scheduled in one batch </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00257">257</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00324">rs_batch_add()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1775ae7f2480ffa206fe948279e60e45"></a><!-- doxytag: member="service.c::__attribute__" ref="a1775ae7f2480ffa206fe948279e60e45" args="((__noinline__))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__noinline__)&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02345">2345</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__lib_8h_source.html#l00349">l_wait_event_exclusive_head</a>, <a class="el" href="watchdog_8c_source.html#l00506">lc_watchdog_disable()</a>, <a class="el" href="watchdog_8c_source.html#l00501">lc_watchdog_touch()</a>, <a class="el" href="lustre__lib_8h_source.html#l00171">LWI_TIMEOUT</a>, <a class="el" href="service_8c_source.html#l02329">ptlrpc_at_check()</a>, <a class="el" href="service_8c_source.html#l02275">ptlrpc_retry_rqbds()</a>, <a class="el" href="service_8c_source.html#l02322">ptlrpc_rqbd_pending()</a>, <a class="el" href="lustre__net_8h_source.html#l02574">ptlrpc_server_get_timeout()</a>, <a class="el" href="service_8c_source.html#l02340">ptlrpc_server_request_incoming()</a>, <a class="el" href="service_8c_source.html#l01777">ptlrpc_server_request_pending()</a>, and <a class="el" href="service_8c_source.html#l02315">ptlrpc_thread_stopping()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f5691160ea879ec21a77c501e649740"></a><!-- doxytag: member="service.c::hrt_dont_sleep" ref="a2f5691160ea879ec21a77c501e649740" args="(struct ptlrpc_hr_thread *hrt, struct list_head *replies)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int hrt_dont_sleep </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__hr__thread.html">ptlrpc_hr_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>hrt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlist__head.html">list_head</a> *&nbsp;</td>
          <td class="paramname"> <em>replies</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02560">2560</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l00238">ptlrpc_hr_service::hr_stopping</a>, <a class="el" href="service_8c_source.html#l00209">ptlrpc_hr_thread::hrt_lock</a>, <a class="el" href="service_8c_source.html#l00211">ptlrpc_hr_thread::hrt_queue</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00227">list_splice_init()</a>, and <a class="el" href="service_8c_source.html#l00252">ptlrpc_hr</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02578">ptlrpc_hr_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b1b8ffd1bfebf5f7a1c3d99974a0b34"></a><!-- doxytag: member="service.c::module_param" ref="a7b1b8ffd1bfebf5f7a1c3d99974a0b34" args="(at_extra, int, 0644)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class__obd_8c.html#a30b9fa4cca5a373d84fb01422c5e239d">at_extra</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0644&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac3682f00145553e514cdc0f6bd9c82dd"></a><!-- doxytag: member="service.c::module_param" ref="ac3682f00145553e514cdc0f6bd9c82dd" args="(at_early_margin, int, 0644)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class__obd_8c.html#a47a70ddef4976d21923b761d4b637514">at_early_margin</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0644&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a7b441740e87a80ed72ad126a7e246a1f"></a><!-- doxytag: member="service.c::module_param" ref="a7b441740e87a80ed72ad126a7e246a1f" args="(at_history, int, 0644)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0644&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5f074ac89cf2bc64df1f0e2d8701b4ff"></a><!-- doxytag: member="service.c::module_param" ref="a5f074ac89cf2bc64df1f0e2d8701b4ff" args="(at_max, int, 0644)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__export.html#gad437939efbc33a157b6f386ac4a92ecb">at_max</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0644&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5c6ecc25e9c0e4254ec1281cd957b55d"></a><!-- doxytag: member="service.c::module_param" ref="a5c6ecc25e9c0e4254ec1281cd957b55d" args="(at_min, int, 0644)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__export.html#gac018b3cde737ca787e95380e27734ffd">at_min</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0644&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a8866e15ce909777c49f9260d4f52161d"></a><!-- doxytag: member="service.c::module_param" ref="a8866e15ce909777c49f9260d4f52161d" args="(test_req_buffer_pressure, int, 0444)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0444&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a679fb2727a7a142f91e4b32e10ada487"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="a679fb2727a7a142f91e4b32e10ada487" args="(at_extra,&quot;How much extra time to give with each early reply&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class__obd_8c.html#a30b9fa4cca5a373d84fb01422c5e239d">at_extra</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;How much extra time to give with each early reply&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aa13bcb11caae6a01f924300da7ab8e4f"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="aa13bcb11caae6a01f924300da7ab8e4f" args="(at_early_margin,&quot;How soon before an RPC deadline to send an early reply&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class__obd_8c.html#a47a70ddef4976d21923b761d4b637514">at_early_margin</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;How soon before an RPC deadline to send an early reply&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a09b982a6b3f1a3c99e03069a34ce8ab0"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="a09b982a6b3f1a3c99e03069a34ce8ab0" args="(at_history,&quot;Adaptive timeouts remember the slowest event that took place within this period (sec)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Adaptive timeouts remember the slowest event that took place within this period (sec)&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac85aad1065368ea01ac59488dcec926d"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="ac85aad1065368ea01ac59488dcec926d" args="(at_max,&quot;Adaptive timeout maximum (sec)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__export.html#gad437939efbc33a157b6f386ac4a92ecb">at_max</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Adaptive <a class="el" href="o2iblnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> maximum (sec)&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aaa5ac77f46f16f6c3ca5d879576cd19b"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="aaa5ac77f46f16f6c3ca5d879576cd19b" args="(at_min,&quot;Adaptive timeout minimum (sec)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__export.html#gac018b3cde737ca787e95380e27734ffd">at_min</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Adaptive <a class="el" href="o2iblnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> minimum (sec)&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a3e171ccbf747fcc6bd1c7f860dcd429d"></a><!-- doxytag: member="service.c::MODULE_PARM_DESC" ref="a3e171ccbf747fcc6bd1c7f860dcd429d" args="(test_req_buffer_pressure,&quot;set non&#45;zero to put pressure on request buffer pools&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_PARM_DESC </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;set non-zero to put pressure on request buffer pools&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aed50b6950afc4c4f1b9a2bac3a9e2e8b"></a><!-- doxytag: member="service.c::ptlrpc_alloc_rqbd" ref="aed50b6950afc4c4f1b9a2bac3a9e2e8b" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structptlrpc__request__buffer__desc.html">ptlrpc_request_buffer_desc</a>* ptlrpc_alloc_rqbd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00073">73</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l00635">ptlrpc_cb_id::cbid_arg</a>, <a class="el" href="structptlrpc__cb__id.html#a58f3b9cf321abbbda3162af4e35c310e">ptlrpc_cb_id::cbid_fn</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="obd__support_8h_source.html#l00754">OBD_CPT_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00719">OBD_CPT_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="events_8c_source.html#l00291">request_in_callback()</a>, <a class="el" href="lustre__net_8h_source.html#l01615">ptlrpc_request_buffer_desc::rqbd_buffer</a>, <a class="el" href="lustre__net_8h_source.html#l01616">ptlrpc_request_buffer_desc::rqbd_cbid</a>, <a class="el" href="lustre__net_8h_source.html#l01606">ptlrpc_request_buffer_desc::rqbd_list</a>, <a class="el" href="lustre__net_8h_source.html#l01613">ptlrpc_request_buffer_desc::rqbd_refcount</a>, <a class="el" href="lustre__net_8h_source.html#l01608">ptlrpc_request_buffer_desc::rqbd_reqs</a>, <a class="el" href="lustre__net_8h_source.html#l01610">ptlrpc_request_buffer_desc::rqbd_svcpt</a>, <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>, <a class="el" href="lustre__net_8h_source.html#l01772">ptlrpc_service_part::scp_nrqbds_total</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01698">ptlrpc_service::srv_buf_size</a>, and <a class="el" href="lustre__net_8h_source.html#l01724">ptlrpc_service::srv_cptable</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00120">ptlrpc_grow_req_bufs()</a>.</p>

</div>
</div>
<a class="anchor" id="a870c7d7495f1f30e402923ad17a49687"></a><!-- doxytag: member="service.c::ptlrpc_at_add_timed" ref="a870c7d7495f1f30e402923ad17a49687" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_at_add_timed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01182">1182</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00379">AT_OFF</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00472">list_for_each_entry_reverse</a>, <a class="el" href="pack__generic_8c_source.html#l00805">lustre_msghdr_get_flags()</a>, <a class="el" href="lustre__idl_8h_source.html#l01044">MSGHDR_AT_SUPPORT</a>, <a class="el" href="lustre__import_8h_source.html#l00081">ptlrpc_at_array::paa_count</a>, <a class="el" href="lustre__import_8h_source.html#l00082">ptlrpc_at_array::paa_deadline</a>, <a class="el" href="lustre__import_8h_source.html#l00079">ptlrpc_at_array::paa_reqs_array</a>, <a class="el" href="lustre__import_8h_source.html#l00083">ptlrpc_at_array::paa_reqs_count</a>, <a class="el" href="lustre__import_8h_source.html#l00080">ptlrpc_at_array::paa_size</a>, <a class="el" href="service_8c_source.html#l01159">ptlrpc_at_set_timer()</a>, <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_at_linked</a>, <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l00966">ptlrpc_request::rq_lock</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_no_reply</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l00930">rq_timed_list</a>, and <a class="el" href="lustre__net_8h_source.html#l01833">ptlrpc_service_part::scp_at_array</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01416">ptlrpc_at_check_timed()</a>, and <a class="el" href="service_8c_source.html#l01835">ptlrpc_server_handle_req_in()</a>.</p>

</div>
</div>
<a class="anchor" id="a636d42759b82b23e7c74c1023c6e5862"></a><!-- doxytag: member="service.c::ptlrpc_at_check" ref="a636d42759b82b23e7c74c1023c6e5862" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_at_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02329">2329</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01839">ptlrpc_service_part::scp_at_check</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>, and <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7ee569529c9251f8c0abed514c5c8e5"></a><!-- doxytag: member="service.c::ptlrpc_at_check_timed" ref="aa7ee569529c9251f8c0abed514c5c8e5" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_at_check_timed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p><a class="el" href="group__net.html#ga45bbc99a8cb3940b830d5ac581cd2f10" title="drop a reference count of the request.">ptlrpc_server_drop_request()</a> may drop refcount to 0 already. Let's check this and don't add entry to work_list</p>
</p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01416">1416</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="class__obd_8c_source.html#l00101">at_early_margin</a>, <a class="el" href="class__obd_8c_source.html#l00103">at_extra</a>, <a class="el" href="lustre__import_8h_source.html#l00373">at_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00263">CFS_DURATION_T</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__time_8h_source.html#l00051">cfs_time_sub()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="lustre__import_8h_source.html#l00059">D_ADAPTTO</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="createmany_8c_source.html#l00069">now()</a>, <a class="el" href="lustre__import_8h_source.html#l00081">ptlrpc_at_array::paa_count</a>, <a class="el" href="lustre__import_8h_source.html#l00082">ptlrpc_at_array::paa_deadline</a>, <a class="el" href="lustre__import_8h_source.html#l00079">ptlrpc_at_array::paa_reqs_array</a>, <a class="el" href="lustre__import_8h_source.html#l00083">ptlrpc_at_array::paa_reqs_count</a>, <a class="el" href="lustre__import_8h_source.html#l00080">ptlrpc_at_array::paa_size</a>, <a class="el" href="service_8c_source.html#l01182">ptlrpc_at_add_timed()</a>, <a class="el" href="service_8c_source.html#l01237">ptlrpc_at_remove_timed()</a>, <a class="el" href="service_8c_source.html#l01259">ptlrpc_at_send_early_reply()</a>, <a class="el" href="service_8c_source.html#l01159">ptlrpc_at_set_timer()</a>, <a class="el" href="service_8c_source.html#l00859">ptlrpc_server_drop_request()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l01016">ptlrpc_request::rq_refcount</a>, <a class="el" href="lustre__net_8h_source.html#l00930">rq_timed_list</a>, <a class="el" href="lustre__net_8h_source.html#l01833">ptlrpc_service_part::scp_at_array</a>, <a class="el" href="lustre__net_8h_source.html#l01839">ptlrpc_service_part::scp_at_check</a>, <a class="el" href="lustre__net_8h_source.html#l01837">ptlrpc_service_part::scp_at_checktime</a>, <a class="el" href="lustre__net_8h_source.html#l01831">ptlrpc_service_part::scp_at_estimate</a>, <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, and <a class="el" href="lustre__net_8h_source.html#l01778">ptlrpc_service_part::scp_nreqs_incoming</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a7a53df8d8b8dad6cc5e77af7524794eb"></a><!-- doxytag: member="service.c::ptlrpc_at_remove_timed" ref="a7a53df8d8b8dad6cc5e77af7524794eb" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_at_remove_timed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01237">1237</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lustre__import_8h_source.html#l00081">ptlrpc_at_array::paa_count</a>, <a class="el" href="lustre__import_8h_source.html#l00083">ptlrpc_at_array::paa_reqs_count</a>, <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_at_linked</a>, and <a class="el" href="lustre__net_8h_source.html#l00966">ptlrpc_request::rq_lock</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01416">ptlrpc_at_check_timed()</a>, and <a class="el" href="service_8c_source.html#l00859">ptlrpc_server_drop_request()</a>.</p>

</div>
</div>
<a class="anchor" id="aa46d5add9948a153701350bb60d73f40"></a><!-- doxytag: member="service.c::ptlrpc_at_send_early_reply" ref="aa46d5add9948a153701350bb60d73f40" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_at_send_early_reply </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>if it is last refcount then early reply isn't needed </p>
</p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01259">1259</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="class__obd_8c_source.html#l00101">at_early_margin</a>, <a class="el" href="class__obd_8c_source.html#l00103">at_extra</a>, <a class="el" href="lustre__import_8h_source.html#l00373">at_get()</a>, <a class="el" href="import_8c_source.html#l01665">at_measured()</a>, <a class="el" href="lustre__import_8h_source.html#l00379">AT_OFF</a>, <a class="el" href="libcfs__fail_8h_source.html#l00104">CFS_FAIL_CHECK</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="obd__class_8h_source.html#l00246">class_export_rpc_dec</a>, <a class="el" href="obd__class_8h_source.html#l00239">class_export_rpc_inc</a>, <a class="el" href="lustre__import_8h_source.html#l00059">D_ADAPTTO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00139">D_WARNING</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__net_8h_source.html#l02316">LPRFL_EARLY_REPLY</a>, <a class="el" href="lustre__idl_8h_source.html#l01047">lustre_msg</a>, <a class="el" href="pack__generic_8c_source.html#l00829">lustre_msg_get_flags()</a>, <a class="el" href="pack__generic_8c_source.html#l00923">lustre_msg_get_handle()</a>, <a class="el" href="pack__generic_8c_source.html#l00805">lustre_msghdr_get_flags()</a>, <a class="el" href="pack__generic_8c_source.html#l00372">lustre_pack_reply_flags()</a>, <a class="el" href="lustre__idl_8h_source.html#l01162">MSG_LOCK_REPLAY_DONE</a>, <a class="el" href="lustre__idl_8h_source.html#l01154">MSG_REPLAY</a>, <a class="el" href="lustre__idl_8h_source.html#l01161">MSG_REQ_REPLAY_DONE</a>, <a class="el" href="lustre__idl_8h_source.html#l01044">MSGHDR_AT_SUPPORT</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_fail</a>, <a class="el" href="obd__support_8h_source.html#l00444">OBD_FAIL_TGT_REPLAY_RECONNECT</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd_8h_source.html#l00678">obd_device::obd_recovery_timeout</a>, <a class="el" href="lustre__net_8h_source.html#l02066">PTLRPC_REPLY_EARLY</a>, <a class="el" href="lustre__net_8h_source.html#l02526">ptlrpc_req_drop_rs()</a>, <a class="el" href="client_8c_source.html#l00492">ptlrpc_request_cache_alloc()</a>, <a class="el" href="client_8c_source.html#l00500">ptlrpc_request_cache_free()</a>, <a class="el" href="niobuf_8c_source.html#l00528">ptlrpc_send_reply()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l01100">ptlrpc_request::rq_early_count</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_no_reply</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_pack_bulk</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_pack_udesc</a>, <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_packed_final</a>, <a class="el" href="lustre__net_8h_source.html#l01016">ptlrpc_request::rq_refcount</a>, <a class="el" href="lustre__net_8h_source.html#l01097">ptlrpc_request::rq_rep_swab_mask</a>, <a class="el" href="lustre__net_8h_source.html#l01024">ptlrpc_request::rq_reqlen</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l01831">ptlrpc_service_part::scp_at_estimate</a>, <a class="el" href="sec_8c_source.html#l02221">sptlrpc_svc_ctx_addref()</a>, and <a class="el" href="sec_8c_source.html#l02229">sptlrpc_svc_ctx_decref()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01416">ptlrpc_at_check_timed()</a>.</p>

</div>
</div>
<a class="anchor" id="a4757a6d721555e12790af773a0b36145"></a><!-- doxytag: member="service.c::ptlrpc_at_set_timer" ref="a4757a6d721555e12790af773a0b36145" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_at_set_timer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01159">1159</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="class__obd_8c_source.html#l00101">at_early_margin</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__time_8h_source.html#l00067">cfs_time_shift()</a>, <a class="el" href="linux-prim_8c_source.html#l00063">cfs_timer_arm()</a>, <a class="el" href="linux-prim_8c_source.html#l00069">cfs_timer_disarm()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__import_8h_source.html#l00081">ptlrpc_at_array::paa_count</a>, <a class="el" href="lustre__import_8h_source.html#l00082">ptlrpc_at_array::paa_deadline</a>, <a class="el" href="service_8c_source.html#l00482">ptlrpc_at_timer()</a>, <a class="el" href="lustre__net_8h_source.html#l01833">ptlrpc_service_part::scp_at_array</a>, and <a class="el" href="lustre__net_8h_source.html#l01835">ptlrpc_service_part::scp_at_timer</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01182">ptlrpc_at_add_timed()</a>, and <a class="el" href="service_8c_source.html#l01416">ptlrpc_at_check_timed()</a>.</p>

</div>
</div>
<a class="anchor" id="af921ffb9ea5bd5fa5e842e754bb41f29"></a><!-- doxytag: member="service.c::ptlrpc_at_timer" ref="af921ffb9ea5bd5fa5e842e754bb41f29" args="(unsigned long castmeharder)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_at_timer </td>
          <td>(</td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>castmeharder</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00482">482</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="lustre__net_8h_source.html#l01839">ptlrpc_service_part::scp_at_check</a>, <a class="el" href="lustre__net_8h_source.html#l01837">ptlrpc_service_part::scp_at_checktime</a>, and <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01159">ptlrpc_at_set_timer()</a>, and <a class="el" href="service_8c_source.html#l00599">ptlrpc_service_part_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a80f18cb077b5d857391b16687f9dcb0e"></a><!-- doxytag: member="service.c::ptlrpc_check_req" ref="a80f18cb077b5d857391b16687f9dcb0e" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_check_req </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sanity check request <em>req</em>. </p>
<p>Return 0 if all is ok, error code otherwise. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01117">1117</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="genops_8c_source.html#l01395">class_fail_export()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="lustre__export_8h_source.html#l00219">obd_export::exp_conn_cnt</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="pack__generic_8c_source.html#l01188">lustre_msg_get_conn_cnt()</a>, <a class="el" href="pack__generic_8c_source.html#l00829">lustre_msg_get_flags()</a>, <a class="el" href="pack__generic_8c_source.html#l01080">lustre_msg_get_transno()</a>, <a class="el" href="lustre__idl_8h_source.html#l01154">MSG_REPLAY</a>, <a class="el" href="lustre__idl_8h_source.html#l01161">MSG_REQ_REPLAY_DONE</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_fail</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="niobuf_8c_source.html#l00649">ptlrpc_error()</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01835">ptlrpc_server_handle_req_in()</a>, and <a class="el" href="service_8c_source.html#l01999">ptlrpc_server_handle_request()</a>.</p>

</div>
</div>
<a class="anchor" id="ae95b1f7839d3ace23bfa28a6be4fd70c"></a><!-- doxytag: member="service.c::ptlrpc_check_rqbd_pool" ref="ae95b1f7839d3ace23bfa28a6be4fd70c" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_check_rqbd_pool </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02252">2252</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lprocfs__status_8h_source.html#l00866">lprocfs_counter_add()</a>, <a class="el" href="service_8c_source.html#l00120">ptlrpc_grow_req_bufs()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00335">PTLRPC_REQBUF_AVAIL_CNTR</a>, <a class="el" href="lustre__net_8h_source.html#l01774">ptlrpc_service_part::scp_nrqbds_posted</a>, and <a class="el" href="service_8c_source.html#l00047">test_req_buffer_pressure</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4c8313b60651ab857fe795c83b71b64"></a><!-- doxytag: member="service.c::ptlrpc_free_rqbd" ref="ab4c8313b60651ab857fe795c83b71b64" args="(struct ptlrpc_request_buffer_desc *rqbd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_free_rqbd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request__buffer__desc.html">ptlrpc_request_buffer_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>rqbd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00103">103</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__net_8h_source.html#l01615">ptlrpc_request_buffer_desc::rqbd_buffer</a>, <a class="el" href="lustre__net_8h_source.html#l01606">ptlrpc_request_buffer_desc::rqbd_list</a>, <a class="el" href="lustre__net_8h_source.html#l01613">ptlrpc_request_buffer_desc::rqbd_refcount</a>, <a class="el" href="lustre__net_8h_source.html#l01608">ptlrpc_request_buffer_desc::rqbd_reqs</a>, <a class="el" href="lustre__net_8h_source.html#l01610">ptlrpc_request_buffer_desc::rqbd_svcpt</a>, and <a class="el" href="lustre__net_8h_source.html#l01772">ptlrpc_service_part::scp_nrqbds_total</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="a30a2276abeb17ab744d168f4e53c2ee8"></a><!-- doxytag: member="service.c::ptlrpc_grow_req_bufs" ref="a30a2276abeb17ab744d168f4e53c2ee8" args="(struct ptlrpc_service_part *svcpt, int post)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_grow_req_bufs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>post</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00120">120</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="service_8c_source.html#l00073">ptlrpc_alloc_rqbd()</a>, <a class="el" href="service_8c_source.html#l00436">ptlrpc_server_post_idle_rqbds()</a>, <a class="el" href="lustre__net_8h_source.html#l01774">ptlrpc_service_part::scp_nrqbds_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01772">ptlrpc_service_part::scp_nrqbds_total</a>, <a class="el" href="lustre__net_8h_source.html#l01776">ptlrpc_service_part::scp_rqbd_allocating</a>, <a class="el" href="lustre__net_8h_source.html#l01698">ptlrpc_service::srv_buf_size</a>, <a class="el" href="lustre__net_8h_source.html#l01678">ptlrpc_service::srv_name</a>, and <a class="el" href="lustre__net_8h_source.html#l01700">ptlrpc_service::srv_nbuf_per_group</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02252">ptlrpc_check_rqbd_pool()</a>, and <a class="el" href="service_8c_source.html#l00599">ptlrpc_service_part_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a028888de363f84cfcc617068e00c9f78"></a><!-- doxytag: member="service.c::ptlrpc_handle_rs" ref="a028888de363f84cfcc617068e00c9f78" args="(struct ptlrpc_reply_state *rs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_handle_rs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *&nbsp;</td>
          <td class="paramname"> <em>rs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>An internal function to process a single reply state object. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02149">2149</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l00521">ptlrpc_connection::c_peer</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00217">obd_export::exp_connection</a>, <a class="el" href="lustre__export_8h_source.html#l00240">obd_export::exp_lock</a>, <a class="el" href="lustre__export_8h_source.html#l00229">obd_export::exp_uncommitted_replies_lock</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="ldlm__lock_8c_source.html#l00903">ldlm_lock_decref()</a>, <a class="el" href="nidstr_8h_source.html#l00077">libcfs_nid2str()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lib-md_8c_source.html#l00417">LNetMDUnlink()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00046">LPD64</a>, <a class="el" href="lnet_2include_2lnet_2types_8h_source.html#l00304">lnet_process_id_t::nid</a>, <a class="el" href="lustre__net_8h_source.html#l02518">ptlrpc_rs_decref()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l00672">ptlrpc_reply_state::rs_committed</a>, <a class="el" href="lustre__net_8h_source.html#l00664">ptlrpc_reply_state::rs_difficult</a>, <a class="el" href="lustre__net_8h_source.html#l00655">ptlrpc_reply_state::rs_exp_list</a>, <a class="el" href="lustre__net_8h_source.html#l00687">ptlrpc_reply_state::rs_export</a>, <a class="el" href="lustre__net_8h_source.html#l00669">ptlrpc_reply_state::rs_handled</a>, <a class="el" href="lustre__net_8h_source.html#l00653">ptlrpc_reply_state::rs_list</a>, <a class="el" href="lustre__net_8h_source.html#l00662">ptlrpc_reply_state::rs_lock</a>, <a class="el" href="lustre__net_8h_source.html#l00708">ptlrpc_reply_state::rs_locks</a>, <a class="el" href="lustre__net_8h_source.html#l00690">ptlrpc_reply_state::rs_md_h</a>, <a class="el" href="lustre__net_8h_source.html#l00710">ptlrpc_reply_state::rs_modes</a>, <a class="el" href="lustre__net_8h_source.html#l00677">ptlrpc_reply_state::rs_nlocks</a>, <a class="el" href="lustre__net_8h_source.html#l00657">ptlrpc_reply_state::rs_obd_list</a>, <a class="el" href="lustre__net_8h_source.html#l00670">ptlrpc_reply_state::rs_on_net</a>, <a class="el" href="lustre__net_8h_source.html#l00682">ptlrpc_reply_state::rs_opc</a>, <a class="el" href="lustre__net_8h_source.html#l00667">ptlrpc_reply_state::rs_scheduled</a>, <a class="el" href="lustre__net_8h_source.html#l00688">ptlrpc_reply_state::rs_svcpt</a>, <a class="el" href="lustre__net_8h_source.html#l00684">ptlrpc_reply_state::rs_transno</a>, <a class="el" href="lustre__net_8h_source.html#l00686">ptlrpc_reply_state::rs_xid</a>, <a class="el" href="lustre__net_8h_source.html#l01854">ptlrpc_service_part::scp_nreps_difficult</a>, <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>, and <a class="el" href="lustre__net_8h_source.html#l01713">ptlrpc_service::srv_is_stopping</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02578">ptlrpc_hr_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a3998b53a9b8e5f5daae67e33d71d9d4b"></a><!-- doxytag: member="service.c::ptlrpc_hpreq_check" ref="a3998b53a9b8e5f5daae67e33d71d9d4b" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_hpreq_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01610">1610</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae480dac18fde296385661bf5d397128d"></a><!-- doxytag: member="service.c::ptlrpc_hr_main" ref="ae480dac18fde296385661bf5d397128d" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_hr_main </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Main body of "handle reply" function. </p>
<p>It processes acked reply states </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02578">2578</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__cpu_8c_source.html#l00207">cfs_cpt_bind()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="service_8c_source.html#l00235">ptlrpc_hr_service::hr_cpt_table</a>, <a class="el" href="service_8c_source.html#l00238">ptlrpc_hr_service::hr_stopping</a>, <a class="el" href="service_8c_source.html#l00237">ptlrpc_hr_service::hr_waitq</a>, <a class="el" href="service_8c_source.html#l00221">ptlrpc_hr_partition::hrp_cpt</a>, <a class="el" href="service_8c_source.html#l00217">ptlrpc_hr_partition::hrp_nstarted</a>, <a class="el" href="service_8c_source.html#l00219">ptlrpc_hr_partition::hrp_nstopped</a>, <a class="el" href="service_8c_source.html#l02560">hrt_dont_sleep()</a>, <a class="el" href="service_8c_source.html#l00208">ptlrpc_hr_thread::hrt_id</a>, <a class="el" href="service_8c_source.html#l00212">ptlrpc_hr_thread::hrt_partition</a>, <a class="el" href="service_8c_source.html#l00210">ptlrpc_hr_thread::hrt_waitq</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__lib_8h_source.html#l00359">l_wait_condition</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::prev</a>, <a class="el" href="service_8c_source.html#l02149">ptlrpc_handle_rs()</a>, <a class="el" href="service_8c_source.html#l00252">ptlrpc_hr</a>, and <a class="el" href="lustre__net_8h_source.html#l00653">ptlrpc_reply_state::rs_list</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02644">ptlrpc_start_hr_threads()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f6d78a36a493da0ddbcdb98eb6c1b70"></a><!-- doxytag: member="service.c::ptlrpc_hr_select" ref="a9f6d78a36a493da0ddbcdb98eb6c1b70" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structptlrpc__hr__thread.html">ptlrpc_hr_thread</a>* ptlrpc_hr_select </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Choose an hr thread to dispatch requests to. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00274">274</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__cpu_8c_source.html#l00093">cfs_cpt_number()</a>, <a class="el" href="service_8c_source.html#l00235">ptlrpc_hr_service::hr_cpt_table</a>, <a class="el" href="service_8c_source.html#l00242">ptlrpc_hr_service::hr_partitions</a>, <a class="el" href="service_8c_source.html#l00240">ptlrpc_hr_service::hr_rotor</a>, <a class="el" href="service_8c_source.html#l00225">ptlrpc_hr_partition::hrp_nthrs</a>, <a class="el" href="service_8c_source.html#l00223">ptlrpc_hr_partition::hrp_rotor</a>, <a class="el" href="service_8c_source.html#l00227">ptlrpc_hr_partition::hrp_thrs</a>, <a class="el" href="service_8c_source.html#l00252">ptlrpc_hr</a>, and <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00369">ptlrpc_dispatch_difficult_reply()</a>, and <a class="el" href="service_8c_source.html#l00301">rs_batch_dispatch()</a>.</p>

</div>
</div>
<a class="anchor" id="aac3d1f47bc27111a611b1c116255f53c"></a><!-- doxytag: member="service.c::ptlrpc_main" ref="aac3d1f47bc27111a611b1c116255f53c" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_main </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Main thread body for service threads. </p>
<p>Waits in a loop waiting for new requests to process to appear. Every time an incoming requests is added to its queue, a waitq is woken up and one of the threads will handle it. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02378">2378</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__cpu_8c_source.html#l00207">cfs_cpt_bind()</a>, <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="linux_2libcfs_8h_source.html#l00145">current_pid</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="libcfs__debug_8h_source.html#l00138">D_NET</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00984">lu_context::lc_cookie</a>, <a class="el" href="lu__object_8h_source.html#l00964">lu_context::lc_thread</a>, <a class="el" href="watchdog_8c_source.html#l00492">lc_watchdog_add()</a>, <a class="el" href="watchdog_8c_source.html#l00511">lc_watchdog_delete()</a>, <a class="el" href="lu__object_8h_source.html#l01039">LCT_NOREF</a>, <a class="el" href="lu__object_8h_source.html#l01047">LCT_REMEMBER</a>, <a class="el" href="lu__object_8h_source.html#l01273">lu_env::le_ctx</a>, <a class="el" href="lu__object_8h_source.html#l01277">lu_env::le_ses</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lu__object_8c_source.html#l01776">lu_context_enter()</a>, <a class="el" href="lu__object_8c_source.html#l01786">lu_context_exit()</a>, <a class="el" href="lu__object_8c_source.html#l01755">lu_context_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01729">lu_context_init()</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="service_8c_source.html#l02329">ptlrpc_at_check()</a>, <a class="el" href="service_8c_source.html#l01416">ptlrpc_at_check_timed()</a>, <a class="el" href="service_8c_source.html#l02252">ptlrpc_check_rqbd_pool()</a>, <a class="el" href="service_8c_source.html#l02322">ptlrpc_rqbd_pending()</a>, <a class="el" href="lustre__net_8h_source.html#l02574">ptlrpc_server_get_timeout()</a>, <a class="el" href="service_8c_source.html#l01835">ptlrpc_server_handle_req_in()</a>, <a class="el" href="service_8c_source.html#l01999">ptlrpc_server_handle_request()</a>, <a class="el" href="service_8c_source.html#l00436">ptlrpc_server_post_idle_rqbds()</a>, <a class="el" href="service_8c_source.html#l02340">ptlrpc_server_request_incoming()</a>, <a class="el" href="service_8c_source.html#l01777">ptlrpc_server_request_pending()</a>, <a class="el" href="service_8c_source.html#l02782">ptlrpc_start_thread()</a>, <a class="el" href="service_8c_source.html#l02315">ptlrpc_thread_stopping()</a>, <a class="el" href="service_8c_source.html#l02308">ptlrpc_threads_need_create()</a>, <a class="el" href="lustre__net_8h_source.html#l00653">ptlrpc_reply_state::rs_list</a>, <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>, <a class="el" href="lustre__net_8h_source.html#l01774">ptlrpc_service_part::scp_nrqbds_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>, <a class="el" href="lustre__net_8h_source.html#l01757">ptlrpc_service_part::scp_nthrs_starting</a>, <a class="el" href="lustre__net_8h_source.html#l01850">ptlrpc_service_part::scp_rep_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01852">ptlrpc_service_part::scp_rep_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01786">ptlrpc_service_part::scp_rqbd_timeout</a>, <a class="el" href="structptlrpc__service__ops.html#ae5aa4ea05c5025d162fbef6e3cd11b20">ptlrpc_service_ops::so_thr_done</a>, <a class="el" href="structptlrpc__service__ops.html#a46b48cb79fc9aa8a65bb59b204ef6f29">ptlrpc_service_ops::so_thr_init</a>, <a class="el" href="lustre__net_8h_source.html#l01724">ptlrpc_service::srv_cptable</a>, <a class="el" href="lustre__net_8h_source.html#l01709">ptlrpc_service::srv_ctx_tags</a>, <a class="el" href="lustre__net_8h_source.html#l01696">ptlrpc_service::srv_max_reply_size</a>, <a class="el" href="lustre__net_8h_source.html#l01678">ptlrpc_service::srv_name</a>, <a class="el" href="lustre__net_8h_source.html#l01676">ptlrpc_service::srv_ops</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01496">SVC_STARTING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01533">ptlrpc_thread::t_env</a>, <a class="el" href="lustre__net_8h_source.html#l01519">ptlrpc_thread::t_id</a>, <a class="el" href="lustre__net_8h_source.html#l01534">ptlrpc_thread::t_name</a>, <a class="el" href="lustre__net_8h_source.html#l01523">ptlrpc_thread::t_pid</a>, <a class="el" href="lustre__net_8h_source.html#l01531">ptlrpc_thread::t_svcpt</a>, <a class="el" href="lustre__net_8h_source.html#l01527">ptlrpc_thread::t_watchdog</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01582">thread_add_flags()</a>, <a class="el" href="lustre__net_8h_source.html#l01572">thread_clear_flags()</a>, <a class="el" href="lustre__net_8h_source.html#l01552">thread_is_starting()</a>, and <a class="el" href="lustre__net_8h_source.html#l01587">thread_test_and_clear_flags()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02782">ptlrpc_start_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a909aa12fe9994a55430ff3e660c01f4c"></a><!-- doxytag: member="service.c::ptlrpc_retry_rqbds" ref="a909aa12fe9994a55430ff3e660c01f4c" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_retry_rqbds </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02275">2275</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01786">ptlrpc_service_part::scp_rqbd_timeout</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>.</p>

</div>
</div>
<a class="anchor" id="af8041c3cf09a9ac2e2f56d44e9d71d7a"></a><!-- doxytag: member="service.c::ptlrpc_rqbd_pending" ref="af8041c3cf09a9ac2e2f56d44e9d71d7a" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_rqbd_pending </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02322">2322</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, and <a class="el" href="lustre__net_8h_source.html#l01786">ptlrpc_service_part::scp_rqbd_timeout</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>, and <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="aad3a54e6eed55c20c2fcb640b152f720"></a><!-- doxytag: member="service.c::ptlrpc_server_allow_high" ref="aad3a54e6eed55c20c2fcb640b152f720" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_server_allow_high </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allow to handle high priority request User can call it w/o any lock but need to hold ptlrpc_service_part::scp_req_lock to get reliable result. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01686">1686</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__fail_8h_source.html#l00077">CFS_FAIL_PRECHECK()</a>, <a class="el" href="lustre__idl_8h_source.html#l00102">MDS_REQUEST_PORTAL</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00184">nrs_svcpt_has_hp()</a>, <a class="el" href="obd__support_8h_source.html#l00415">OBD_FAIL_PTLRPC_CANCEL_RESEND</a>, <a class="el" href="nrs_8c_source.html#l01643">ptlrpc_nrs_req_pending_nolock()</a>, <a class="el" href="nrs_8c_source.html#l01660">ptlrpc_nrs_req_throttling_nolock()</a>, <a class="el" href="lustre__net_8h_source.html#l00128">PTLRPC_NTHRS_INIT</a>, <a class="el" href="lustre__net_8h_source.html#l01815">ptlrpc_service_part::scp_hreq_count</a>, <a class="el" href="lustre__net_8h_source.html#l01813">ptlrpc_service_part::scp_nhreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01718">ptlrpc_server_high_pending()</a>.</p>

</div>
</div>
<a class="anchor" id="ac6e38d8c616e2daee51de465d2d7013a"></a><!-- doxytag: member="service.c::ptlrpc_server_allow_normal" ref="ac6e38d8c616e2daee51de465d2d7013a" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_server_allow_normal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Only allow normal priority requests on a service that has a high-priority queue if forced (i.e. </p>
<p>cleanup), if there are other high priority requests already being processed (i.e. those threads can service more high-priority requests), or if there are enough idle threads that a later thread can do a high priority request. User can call it w/o any lock but need to hold ptlrpc_service_part::scp_req_lock to get reliable result </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01734">1734</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__fail_8h_source.html#l00077">CFS_FAIL_PRECHECK()</a>, <a class="el" href="lustre__idl_8h_source.html#l00102">MDS_REQUEST_PORTAL</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00184">nrs_svcpt_has_hp()</a>, <a class="el" href="obd__support_8h_source.html#l00415">OBD_FAIL_PTLRPC_CANCEL_RESEND</a>, <a class="el" href="nrs_8c_source.html#l01660">ptlrpc_nrs_req_throttling_nolock()</a>, <a class="el" href="lustre__net_8h_source.html#l00128">PTLRPC_NTHRS_INIT</a>, <a class="el" href="lustre__net_8h_source.html#l01813">ptlrpc_service_part::scp_nhreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01761">ptlrpc_server_normal_pending()</a>.</p>

</div>
</div>
<a class="anchor" id="a4fe9438acef5ce97dd9c9948c15211d1"></a><!-- doxytag: member="service.c::ptlrpc_server_check_resend_in_progress" ref="a4fe9438acef5ce97dd9c9948c15211d1" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_check_resend_in_progress </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01522">1522</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="lustre__export_8h_source.html#l00270">obd_export::exp_hp_rpcs</a>, <a class="el" href="lustre__export_8h_source.html#l00271">obd_export::exp_reg_rpcs</a>, <a class="el" href="lustre__export_8h_source.html#l00183">obd_export::exp_rpc_count</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="pack__generic_8c_source.html#l00829">lustre_msg_get_flags()</a>, <a class="el" href="lustre__idl_8h_source.html#l01153">MSG_RESENT</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_bulk_read</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_bulk_write</a>, <a class="el" href="lustre__net_8h_source.html#l00931">rq_exp_list</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, and <a class="el" href="lustre__net_8h_source.html#l01036">ptlrpc_request::rq_xid</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01634">ptlrpc_server_request_add()</a>.</p>

</div>
</div>
<a class="anchor" id="a82747d1c580374cfd9087a99f1c67750"></a><!-- doxytag: member="service.c::ptlrpc_server_finish_active_request" ref="a82747d1c580374cfd9087a99f1c67750" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_server_finish_active_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>to finish an active request: stop sending more early replies, and release the request. </p>
<p>should be called after we finished handling the request. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01013">1013</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="obd__class_8h_source.html#l00246">class_export_rpc_dec</a>, <a class="el" href="nrs_8c_source.html#l01499">ptlrpc_nrs_req_finalize()</a>, <a class="el" href="nrs_8c_source.html#l01509">ptlrpc_nrs_req_stop_nolock()</a>, <a class="el" href="service_8c_source.html#l01001">ptlrpc_server_finish_request()</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_hp</a>, <a class="el" href="lustre__net_8h_source.html#l01813">ptlrpc_service_part::scp_nhreqs_active</a>, and <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01999">ptlrpc_server_handle_request()</a>, and <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d71c5442a9a62c66bd99bc984d2c8d1"></a><!-- doxytag: member="service.c::ptlrpc_server_finish_request" ref="a2d71c5442a9a62c66bd99bc984d2c8d1" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_server_finish_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>to finish a request: stop sending more early replies, and release the request. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01001">1001</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l00859">ptlrpc_server_drop_request()</a>, and <a class="el" href="service_8c_source.html#l01594">ptlrpc_server_hpreq_fini()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01013">ptlrpc_server_finish_active_request()</a>, <a class="el" href="service_8c_source.html#l01835">ptlrpc_server_handle_req_in()</a>, and <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="a2489791165b9da8139f7e6c88c50f26f"></a><!-- doxytag: member="service.c::ptlrpc_server_free_request" ref="a2489791165b9da8139f7e6c88c50f26f" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_server_free_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>to actually free the request, must be called without holding svc_lock. </p>
<p>note it's caller's responsibility to unlink req-&gt;rq_list. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00836">836</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lustre__net_8h_source.html#l02526">ptlrpc_req_drop_rs()</a>, <a class="el" href="client_8c_source.html#l00500">ptlrpc_request_cache_free()</a>, <a class="el" href="lustre__net_8h_source.html#l01016">ptlrpc_request::rq_refcount</a>, and <a class="el" href="sec_8c_source.html#l02229">sptlrpc_svc_ctx_decref()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00859">ptlrpc_server_drop_request()</a>.</p>

</div>
</div>
<a class="anchor" id="af551f3c6043b58390a944685f0010c4e"></a><!-- doxytag: member="service.c::ptlrpc_server_handle_req_in" ref="af551f3c6043b58390a944685f0010c4e" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_handle_req_in </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>thread</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle freshly incoming reqs, add to timed early reply list, pass on to regular request queue. </p>
<p>All incoming requests pass through here before getting into ptlrpc_server_handle_req later on. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01835">1835</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="linux-time_8h_source.html#l00263">CFS_DURATION_T</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__time_8h_source.html#l00051">cfs_time_sub()</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00139">D_WARNING</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="lu__object_8h_source.html#l01039">LCT_NOREF</a>, <a class="el" href="lu__object_8h_source.html#l01028">LCT_SERVER_SESSION</a>, <a class="el" href="lu__object_8h_source.html#l01277">lu_env::le_ses</a>, <a class="el" href="lnet_2lnet_2nidstrings_8c_source.html#l01236">libcfs_id2str()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lu__object_8c_source.html#l01776">lu_context_enter()</a>, <a class="el" href="lu__object_8c_source.html#l01729">lu_context_init()</a>, <a class="el" href="pack__generic_8c_source.html#l00923">lustre_msg_get_handle()</a>, <a class="el" href="pack__generic_8c_source.html#l00989">lustre_msg_get_opc()</a>, <a class="el" href="pack__generic_8c_source.html#l01217">lustre_msg_get_timeout()</a>, <a class="el" href="pack__generic_8c_source.html#l00940">lustre_msg_get_type()</a>, <a class="el" href="pack__generic_8c_source.html#l00805">lustre_msghdr_get_flags()</a>, <a class="el" href="pack__generic_8c_source.html#l00649">lustre_unpack_req_ptlrpc_body()</a>, <a class="el" href="packet-lustre_8c_source.html#l00205">MDS_READPAGE</a>, <a class="el" href="packet-lustre_8c_source.html#l00219">MDS_WRITEPAGE</a>, <a class="el" href="packet-lustre_8c_source.html#l00315">MGS_CONFIG_READ</a>, <a class="el" href="lustre__idl_8h_source.html#l01125">MSG_PTLRPC_BODY_OFF</a>, <a class="el" href="lustre__idl_8h_source.html#l01044">MSGHDR_AT_SUPPORT</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00193">OBD_FAIL_MDS_ALL_REPLY_NET</a>, <a class="el" href="obd__support_8h_source.html#l00213">OBD_FAIL_MDS_RESEND</a>, <a class="el" href="obd__support_8h_source.html#l00618">OBD_FAIL_PRECHECK</a>, <a class="el" href="obd__support_8h_source.html#l00411">OBD_FAIL_PTLRPC_DROP_REQ_OPC</a>, <a class="el" href="class__obd_8c_source.html#l00083">obd_timeout</a>, <a class="el" href="packet-lustre_8c_source.html#l00166">OST_READ</a>, <a class="el" href="packet-lustre_8c_source.html#l00167">OST_WRITE</a>, <a class="el" href="lustre__idl_8h_source.html#l02037">OUT_UPDATE</a>, <a class="el" href="packet-lustre_8c_source.html#l00359">PTL_RPC_MSG_REQUEST</a>, <a class="el" href="service_8c_source.html#l01182">ptlrpc_at_add_timed()</a>, <a class="el" href="service_8c_source.html#l01117">ptlrpc_check_req()</a>, <a class="el" href="service_8c_source.html#l01001">ptlrpc_server_finish_request()</a>, <a class="el" href="service_8c_source.html#l01634">ptlrpc_server_request_add()</a>, <a class="el" href="pack__generic_8c_source.html#l00600">ptlrpc_unpack_req_msg()</a>, <a class="el" href="service_8c_source.html#l01037">ptlrpc_update_export_timer()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_bulk_read</a>, <a class="el" href="lustre__net_8h_source.html#l01059">ptlrpc_request::rq_bulk_write</a>, <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01055">ptlrpc_request::rq_flvr</a>, <a class="el" href="lustre__net_8h_source.html#l00962">ptlrpc_request::rq_list</a>, <a class="el" href="lustre__net_8h_source.html#l01108">ptlrpc_request::rq_peer</a>, <a class="el" href="lustre__net_8h_source.html#l01024">ptlrpc_request::rq_reqlen</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l01036">ptlrpc_request::rq_xid</a>, <a class="el" href="lustre__net_8h_source.html#l01778">ptlrpc_service_part::scp_nreqs_incoming</a>, <a class="el" href="lustre__net_8h_source.html#l01784">ptlrpc_service_part::scp_req_incoming</a>, <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>, <a class="el" href="lustre__sec_8h_source.html#l01103">SECSVC_COMPLETE</a>, <a class="el" href="lustre__sec_8h_source.html#l01104">SECSVC_DROP</a>, <a class="el" href="lustre__sec_8h_source.html#l01102">SECSVC_OK</a>, <a class="el" href="lustre__sec_8h_source.html#l00292">sptlrpc_flavor::sf_rpc</a>, <a class="el" href="lustre__sec_8h_source.html#l00152">SPTLRPC_FLVR_POLICY</a>, <a class="el" href="lustre__sec_8h_source.html#l00088">SPTLRPC_POLICY_NULL</a>, <a class="el" href="sec_8c_source.html#l02070">sptlrpc_svc_unwrap_request()</a>, <a class="el" href="sec_8c_source.html#l01797">sptlrpc_target_export_check()</a>, <a class="el" href="lustre__net_8h_source.html#l01702">ptlrpc_service::srv_req_portal</a>, <a class="el" href="lustre__net_8h_source.html#l01533">ptlrpc_thread::t_env</a>, <a class="el" href="lustre__net_8h_source.html#l01534">ptlrpc_thread::t_name</a>, <a class="el" href="ldlm__lib_8c_source.html#l02860">target_send_reply()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a9380f0d64f1bd15f62f971bccdc810b7"></a><!-- doxytag: member="service.c::ptlrpc_server_handle_request" ref="a9380f0d64f1bd15f62f971bccdc810b7" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_handle_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>thread</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Main incoming request handling logic. </p>
<p>Calls handler function from service to do actual processing. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01999">1999</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00373">at_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00263">CFS_DURATION_T</a>, <a class="el" href="libcfs__fail_8h_source.html#l00142">CFS_FAIL_TIMEOUT_MS</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__time_8h_source.html#l00051">cfs_time_sub()</a>, <a class="el" href="libcfs__time_8h_source.html#l00072">cfs_timeval_sub()</a>, <a class="el" href="linux_2libcfs_8h_source.html#l00146">current_comm</a>, <a class="el" href="lustre__import_8h_source.html#l00059">D_ADAPTTO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00138">D_NET</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00139">D_WARNING</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00193">obd_export::exp_client_uuid</a>, <a class="el" href="lustre__export_8h_source.html#l00176">obd_export::exp_refcount</a>, <a class="el" href="lprocfs__status_8h_source.html#l00327">EXTRA_MAX_OPCODES</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="packet-lustre_8c_source.html#l00284">LDLM_ENQUEUE</a>, <a class="el" href="lu__object_8h_source.html#l01277">lu_env::le_ses</a>, <a class="el" href="libcfs_2libcfs_2debug_8c_source.html#l00251">libcfs_debug_dumplog()</a>, <a class="el" href="lnet_2lnet_2nidstrings_8c_source.html#l01236">libcfs_id2str()</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="lprocfs__status_8h_source.html#l00866">lprocfs_counter_add()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lprocfs__status_8h_source.html#l00314">LUSTRE_MAX_OPCODES</a>, <a class="el" href="pack__generic_8c_source.html#l00989">lustre_msg_get_opc()</a>, <a class="el" href="pack__generic_8c_source.html#l01098">lustre_msg_get_status()</a>, <a class="el" href="pack__generic_8c_source.html#l01080">lustre_msg_get_transno()</a>, <a class="el" href="packet-lustre_8c_source.html#l00204">MDS_REINT</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00406">OBD_FAIL_PTLRPC_DUMP_LOG</a>, <a class="el" href="obd__support_8h_source.html#l00410">OBD_FAIL_PTLRPC_HPREQ_NOTIMEOUT</a>, <a class="el" href="obd__support_8h_source.html#l00409">OBD_FAIL_PTLRPC_HPREQ_TIMEOUT</a>, <a class="el" href="obd__support_8h_source.html#l00403">OBD_FAIL_PTLRPC_PAUSE_REQ</a>, <a class="el" href="obd__support_8h_source.html#l00624">OBD_FAIL_TIMEOUT</a>, <a class="el" href="packet-lustre_8c_source.html#l00303">OBD_PING</a>, <a class="el" href="lprocfs__status_8h_source.html#l00204">opcode_offset()</a>, <a class="el" href="service_8c_source.html#l01117">ptlrpc_check_req()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00333">PTLRPC_REQACTIVE_CNTR</a>, <a class="el" href="lprocfs__status_8h_source.html#l00332">PTLRPC_REQQDEPTH_CNTR</a>, <a class="el" href="lprocfs__status_8h_source.html#l00331">PTLRPC_REQWAIT_CNTR</a>, <a class="el" href="lustre__net_8h_source.html#l02428">ptlrpc_rqphase_move()</a>, <a class="el" href="service_8c_source.html#l01013">ptlrpc_server_finish_active_request()</a>, <a class="el" href="service_8c_source.html#l01789">ptlrpc_server_request_get()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00334">PTLRPC_TIMEOUT</a>, <a class="el" href="service_8c_source.html#l01037">ptlrpc_update_export_timer()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l01100">ptlrpc_request::rq_early_count</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01108">ptlrpc_request::rq_peer</a>, <a class="el" href="lustre__net_8h_source.html#l00721">RQ_PHASE_COMPLETE</a>, <a class="el" href="lustre__net_8h_source.html#l00720">RQ_PHASE_INTERPRET</a>, <a class="el" href="lustre__net_8h_source.html#l01032">ptlrpc_request::rq_repmsg</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>, <a class="el" href="lustre__net_8h_source.html#l01034">ptlrpc_request::rq_transno</a>, <a class="el" href="lustre__net_8h_source.html#l01036">ptlrpc_request::rq_xid</a>, <a class="el" href="lustre__net_8h_source.html#l01831">ptlrpc_service_part::scp_at_estimate</a>, <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01778">ptlrpc_service_part::scp_nreqs_incoming</a>, <a class="el" href="structptlrpc__service__ops.html#ace0bd2960a564f7e405763b10879d854">ptlrpc_service_ops::so_req_handler</a>, <a class="el" href="lustre__net_8h_source.html#l01676">ptlrpc_service::srv_ops</a>, <a class="el" href="lustre__net_8h_source.html#l01690">ptlrpc_service::srv_stats</a>, <a class="el" href="lustre__net_8h_source.html#l01533">ptlrpc_thread::t_env</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac5e70e9ac0846630ba9e4d3e1a50156b"></a><!-- doxytag: member="service.c::ptlrpc_server_high_pending" ref="ac5e70e9ac0846630ba9e4d3e1a50156b" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_server_high_pending </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01718">1718</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="nrs_8c_source.html#l01643">ptlrpc_nrs_req_pending_nolock()</a>, and <a class="el" href="service_8c_source.html#l01686">ptlrpc_server_allow_high()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01789">ptlrpc_server_request_get()</a>, <a class="el" href="service_8c_source.html#l01777">ptlrpc_server_request_pending()</a>, and <a class="el" href="service_8c_source.html#l03193">ptlrpc_svcpt_health_check()</a>.</p>

</div>
</div>
<a class="anchor" id="aaa197378ce94c91c9a218f7b3f3faa8c"></a><!-- doxytag: member="service.c::ptlrpc_server_hpreq_fini" ref="aaa197378ce94c91c9a218f7b3f3faa8c" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_server_hpreq_fini </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove the request from the export list. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01594">1594</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__export_8h_source.html#l00269">obd_export::exp_rpc_lock</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, and <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01001">ptlrpc_server_finish_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a2f4b65688f54e1839964c171450ad4e2"></a><!-- doxytag: member="service.c::ptlrpc_server_hpreq_init" ref="a2f4b65688f54e1839964c171450ad4e2" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_hpreq_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if a request should be assigned with a high priority. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>&lt;</em>&nbsp;</td><td>0: error occurred 0: normal RPC request +1: high priority request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l01566">1566</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01634">ptlrpc_server_request_add()</a>.</p>

</div>
</div>
<a class="anchor" id="a07185adbcc9ce1e9ca17cb1a13789e00"></a><!-- doxytag: member="service.c::ptlrpc_server_normal_pending" ref="a07185adbcc9ce1e9ca17cb1a13789e00" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_server_normal_pending </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01761">1761</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="nrs_8c_source.html#l01643">ptlrpc_nrs_req_pending_nolock()</a>, and <a class="el" href="service_8c_source.html#l01734">ptlrpc_server_allow_normal()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01789">ptlrpc_server_request_get()</a>, <a class="el" href="service_8c_source.html#l01777">ptlrpc_server_request_pending()</a>, and <a class="el" href="service_8c_source.html#l03193">ptlrpc_svcpt_health_check()</a>.</p>

</div>
</div>
<a class="anchor" id="ac741a2591e6035bc09f137d7a799e811"></a><!-- doxytag: member="service.c::ptlrpc_server_nthreads_check" ref="ac741a2591e6035bc09f137d7a799e811" args="(struct ptlrpc_service *svc, struct ptlrpc_service_conf *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_server_nthreads_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__conf.html">ptlrpc_service_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00494">494</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__cpu_8h_source.html#l00095">CFS_CPT_ANY</a>, <a class="el" href="libcfs__cpu_8c_source.html#l00100">cfs_cpt_weight()</a>, <a class="el" href="libcfs__cpu_8c_source.html#l00186">cfs_cpu_ht_nsiblings()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lnet_2utils_2debug_8c_source.html#l00068">max</a>, <a class="el" href="lustre__net_8h_source.html#l02239">ptlrpc_service_conf::psc_thr</a>, <a class="el" href="lustre__net_8h_source.html#l00128">PTLRPC_NTHRS_INIT</a>, <a class="el" href="structptlrpc__service__ops.html#a3b99111ca745490f2cd0cfd183482174">ptlrpc_service_ops::so_hpreq_handler</a>, <a class="el" href="lustre__net_8h_source.html#l01724">ptlrpc_service::srv_cptable</a>, <a class="el" href="lustre__net_8h_source.html#l01678">ptlrpc_service::srv_name</a>, <a class="el" href="lustre__net_8h_source.html#l01718">ptlrpc_service::srv_ncpts</a>, <a class="el" href="lustre__net_8h_source.html#l01684">ptlrpc_service::srv_nthrs_cpt_init</a>, <a class="el" href="lustre__net_8h_source.html#l01686">ptlrpc_service::srv_nthrs_cpt_limit</a>, <a class="el" href="lustre__net_8h_source.html#l01676">ptlrpc_service::srv_ops</a>, <a class="el" href="lustre__net_8h_source.html#l02213">ptlrpc_service_thr_conf::tc_nthrs_base</a>, <a class="el" href="lustre__net_8h_source.html#l02206">ptlrpc_service_thr_conf::tc_nthrs_init</a>, <a class="el" href="lustre__net_8h_source.html#l02215">ptlrpc_service_thr_conf::tc_nthrs_max</a>, <a class="el" href="lustre__net_8h_source.html#l02218">ptlrpc_service_thr_conf::tc_nthrs_user</a>, and <a class="el" href="lustre__net_8h_source.html#l02204">ptlrpc_service_thr_conf::tc_thr_factor</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3c644131d0f98fd22ad9ba28d49974c"></a><!-- doxytag: member="service.c::ptlrpc_server_post_idle_rqbds" ref="aa3c644131d0f98fd22ad9ba28d49974c" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_post_idle_rqbds </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00436">436</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="niobuf_8c_source.html#l00900">ptlrpc_register_rqbd()</a>, <a class="el" href="lustre__net_8h_source.html#l01606">ptlrpc_request_buffer_desc::rqbd_list</a>, <a class="el" href="lustre__net_8h_source.html#l01774">ptlrpc_service_part::scp_nrqbds_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, and <a class="el" href="lustre__net_8h_source.html#l01782">ptlrpc_service_part::scp_rqbd_posted</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00120">ptlrpc_grow_req_bufs()</a>, and <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a22d78c661b2c78da1b7e5c06d50510f5"></a><!-- doxytag: member="service.c::ptlrpc_server_request_add" ref="a22d78c661b2c78da1b7e5c06d50510f5" args="(struct ptlrpc_service_part *svcpt, struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_request_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l01634">1634</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00270">obd_export::exp_hp_rpcs</a>, <a class="el" href="lustre__export_8h_source.html#l00271">obd_export::exp_reg_rpcs</a>, <a class="el" href="lustre__export_8h_source.html#l00269">obd_export::exp_rpc_lock</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="nrs_8c_source.html#l01524">ptlrpc_nrs_req_add()</a>, <a class="el" href="nrs_8c_source.html#l01499">ptlrpc_nrs_req_finalize()</a>, <a class="el" href="nrs_8c_source.html#l01475">ptlrpc_nrs_req_initialize()</a>, <a class="el" href="service_8c_source.html#l01522">ptlrpc_server_check_resend_in_progress()</a>, <a class="el" href="service_8c_source.html#l01566">ptlrpc_server_hpreq_init()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01835">ptlrpc_server_handle_req_in()</a>.</p>

</div>
</div>
<a class="anchor" id="a6974eddc8d099fb5e20dcc08d3863f35"></a><!-- doxytag: member="service.c::ptlrpc_server_request_get" ref="a6974eddc8d099fb5e20dcc08d3863f35" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a>* ptlrpc_server_request_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fetch a request for processing from queue of unprocessed requests. </p>
<p>Favors high-priority requests. Returns a pointer to fetched request. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l01789">1789</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="obd__class_8h_source.html#l00239">class_export_rpc_inc</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00160">ptlrpc_nrs_req_get_nolock()</a>, <a class="el" href="service_8c_source.html#l01718">ptlrpc_server_high_pending()</a>, <a class="el" href="service_8c_source.html#l01761">ptlrpc_server_normal_pending()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01102">ptlrpc_request::rq_export</a>, <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_hp</a>, <a class="el" href="lustre__net_8h_source.html#l01815">ptlrpc_service_part::scp_hreq_count</a>, <a class="el" href="lustre__net_8h_source.html#l01813">ptlrpc_service_part::scp_nhreqs_active</a>, and <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l01999">ptlrpc_server_handle_request()</a>, and <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="a0322266f64e271acfbab011e51926e55"></a><!-- doxytag: member="service.c::ptlrpc_server_request_incoming" ref="a0322266f64e271acfbab011e51926e55" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_server_request_incoming </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>requests wait on preprocessing user can call it w/o any lock but need to hold ptlrpc_service_part::scp_lock to get reliable result </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02340">2340</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, and <a class="el" href="lustre__net_8h_source.html#l01784">ptlrpc_service_part::scp_req_incoming</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>, and <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac05b630214d88cf338cae0215329ffac"></a><!-- doxytag: member="service.c::ptlrpc_server_request_pending" ref="ac05b630214d88cf338cae0215329ffac" args="(struct ptlrpc_service_part *svcpt, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_server_request_pending </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns true if there are requests available in incoming request queue for processing and it is allowed to fetch them. </p>
<p>User can call it w/o any lock but need to hold ptlrpc_service::scp_req_lock to get reliable result </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="service_8c.html#ac6e38d8c616e2daee51de465d2d7013a" title="Only allow normal priority requests on a service that has a high-priority queue if...">ptlrpc_server_allow_normal</a> </dd>
<dd>
ptlrpc_server_allow high </dd></dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l01777">1777</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l01718">ptlrpc_server_high_pending()</a>, and <a class="el" href="service_8c_source.html#l01761">ptlrpc_server_normal_pending()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>, <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>, and <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="a81a779f138575827c60f3e9e562d1e44"></a><!-- doxytag: member="service.c::ptlrpc_service_del_atimer" ref="a81a779f138575827c60f3e9e562d1e44" args="(struct ptlrpc_service *svc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_service_del_atimer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02985">2985</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="linux-prim_8c_source.html#l00069">cfs_timer_disarm()</a>, <a class="el" href="lustre__net_8h_source.html#l01857">ptlrpc_service_for_each_part</a>, and <a class="el" href="lustre__net_8h_source.html#l01835">ptlrpc_service_part::scp_at_timer</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03160">ptlrpc_unregister_service()</a>.</p>

</div>
</div>
<a class="anchor" id="a43254fcf67c7956fe3e38637b11086be"></a><!-- doxytag: member="service.c::ptlrpc_service_free" ref="a43254fcf67c7956fe3e38637b11086be" args="(struct ptlrpc_service *svc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_service_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l03123">3123</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__string_8h_source.html#l00090">cfs_expr_list_values_free()</a>, <a class="el" href="linux-prim_8c_source.html#l00069">cfs_timer_disarm()</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__user_8h_source.html#l01032">offsetof</a>, <a class="el" href="lustre__import_8h_source.html#l00079">ptlrpc_at_array::paa_reqs_array</a>, <a class="el" href="lustre__import_8h_source.html#l00083">ptlrpc_at_array::paa_reqs_count</a>, <a class="el" href="lustre__import_8h_source.html#l00080">ptlrpc_at_array::paa_size</a>, <a class="el" href="lustre__net_8h_source.html#l01857">ptlrpc_service_for_each_part</a>, <a class="el" href="lustre__net_8h_source.html#l01833">ptlrpc_service_part::scp_at_array</a>, <a class="el" href="lustre__net_8h_source.html#l01835">ptlrpc_service_part::scp_at_timer</a>, <a class="el" href="lustre__net_8h_source.html#l01720">ptlrpc_service::srv_cpts</a>, and <a class="el" href="lustre__net_8h_source.html#l01718">ptlrpc_service::srv_ncpts</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03160">ptlrpc_unregister_service()</a>.</p>

</div>
</div>
<a class="anchor" id="ae8ee0d436d5d29f2484f26aec0bbc224"></a><!-- doxytag: member="service.c::ptlrpc_service_part_init" ref="ae8ee0d436d5d29f2484f26aec0bbc224" args="(struct ptlrpc_service *svc, struct ptlrpc_service_part *svcpt, int cpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_service_part_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cpt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize percpt data for a service. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00599">599</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00328">at_est2timeout()</a>, <a class="el" href="lustre__import_8h_source.html#l00355">at_init()</a>, <a class="el" href="class__obd_8c_source.html#l00097">at_max</a>, <a class="el" href="linux-prim_8c_source.html#l00055">cfs_timer_init()</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="obd__support_8h_source.html#l00716">OBD_CPT_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="lustre__import_8h_source.html#l00081">ptlrpc_at_array::paa_count</a>, <a class="el" href="lustre__import_8h_source.html#l00082">ptlrpc_at_array::paa_deadline</a>, <a class="el" href="lustre__import_8h_source.html#l00079">ptlrpc_at_array::paa_reqs_array</a>, <a class="el" href="lustre__import_8h_source.html#l00083">ptlrpc_at_array::paa_reqs_count</a>, <a class="el" href="lustre__import_8h_source.html#l00080">ptlrpc_at_array::paa_size</a>, <a class="el" href="service_8c_source.html#l00482">ptlrpc_at_timer()</a>, <a class="el" href="service_8c_source.html#l00120">ptlrpc_grow_req_bufs()</a>, <a class="el" href="lustre__net_8h_source.html#l01833">ptlrpc_service_part::scp_at_array</a>, <a class="el" href="lustre__net_8h_source.html#l01831">ptlrpc_service_part::scp_at_estimate</a>, <a class="el" href="lustre__net_8h_source.html#l01835">ptlrpc_service_part::scp_at_timer</a>, <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>, <a class="el" href="lustre__net_8h_source.html#l01794">ptlrpc_service_part::scp_hist_reqs</a>, <a class="el" href="lustre__net_8h_source.html#l01796">ptlrpc_service_part::scp_hist_rqbds</a>, <a class="el" href="lustre__net_8h_source.html#l01854">ptlrpc_service_part::scp_nreps_difficult</a>, <a class="el" href="lustre__net_8h_source.html#l01848">ptlrpc_service_part::scp_rep_active</a>, <a class="el" href="lustre__net_8h_source.html#l01850">ptlrpc_service_part::scp_rep_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01852">ptlrpc_service_part::scp_rep_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01784">ptlrpc_service_part::scp_req_incoming</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01782">ptlrpc_service_part::scp_rqbd_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01763">ptlrpc_service_part::scp_threads</a>, <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, and <a class="el" href="lustre__net_8h_source.html#l01724">ptlrpc_service::srv_cptable</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>.</p>

</div>
</div>
<a class="anchor" id="aea01c5861feea88341d2a351ff7574c3"></a><!-- doxytag: member="service.c::ptlrpc_service_purge_all" ref="aea01c5861feea88341d2a351ff7574c3" args="(struct ptlrpc_service *svc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_service_purge_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l03055">3055</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="service_8c_source.html#l00103">ptlrpc_free_rqbd()</a>, <a class="el" href="service_8c_source.html#l00387">ptlrpc_schedule_difficult_reply()</a>, <a class="el" href="service_8c_source.html#l01013">ptlrpc_server_finish_active_request()</a>, <a class="el" href="service_8c_source.html#l01001">ptlrpc_server_finish_request()</a>, <a class="el" href="service_8c_source.html#l01789">ptlrpc_server_request_get()</a>, <a class="el" href="service_8c_source.html#l01777">ptlrpc_server_request_pending()</a>, <a class="el" href="lustre__net_8h_source.html#l01857">ptlrpc_service_for_each_part</a>, <a class="el" href="service_8c_source.html#l02968">ptlrpc_wait_replies()</a>, <a class="el" href="lustre__net_8h_source.html#l00962">ptlrpc_request::rq_list</a>, <a class="el" href="lustre__net_8h_source.html#l00653">ptlrpc_reply_state::rs_list</a>, <a class="el" href="lustre__net_8h_source.html#l00662">ptlrpc_reply_state::rs_lock</a>, <a class="el" href="lustre__net_8h_source.html#l01798">ptlrpc_service_part::scp_hist_nrqbds</a>, <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, <a class="el" href="lustre__net_8h_source.html#l01778">ptlrpc_service_part::scp_nreqs_incoming</a>, <a class="el" href="lustre__net_8h_source.html#l01848">ptlrpc_service_part::scp_rep_active</a>, <a class="el" href="lustre__net_8h_source.html#l01850">ptlrpc_service_part::scp_rep_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01784">ptlrpc_service_part::scp_req_incoming</a>, <a class="el" href="lustre__net_8h_source.html#l01780">ptlrpc_service_part::scp_rqbd_idle</a>, <a class="el" href="lustre__net_8h_source.html#l01782">ptlrpc_service_part::scp_rqbd_posted</a>, and <a class="el" href="lustre__net_8h_source.html#l01696">ptlrpc_service::srv_max_reply_size</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03160">ptlrpc_unregister_service()</a>.</p>

</div>
</div>
<a class="anchor" id="a0715e555526b5bb028ef352dc19a58a5"></a><!-- doxytag: member="service.c::ptlrpc_service_unlink_rqbd" ref="a0715e555526b5bb028ef352dc19a58a5" args="(struct ptlrpc_service *svc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_service_unlink_rqbd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02998">2998</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lib-ptl_8c_source.html#l00977">LNetClearLazyPortal()</a>, <a class="el" href="lib-md_8c_source.html#l00417">LNetMDUnlink()</a>, <a class="el" href="obd__support_8h_source.html#l00151">LONG_UNLINK</a>, <a class="el" href="lustre__lib_8h_source.html#l00180">LWI_TIMEOUT_INTERVAL</a>, <a class="el" href="lustre__net_8h_source.html#l01857">ptlrpc_service_for_each_part</a>, <a class="el" href="lustre__net_8h_source.html#l01612">ptlrpc_request_buffer_desc::rqbd_md_h</a>, <a class="el" href="lustre__net_8h_source.html#l01774">ptlrpc_service_part::scp_nrqbds_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01782">ptlrpc_service_part::scp_rqbd_posted</a>, <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01716">ptlrpc_service::srv_hist_nrqbds_cpt_max</a>, and <a class="el" href="lustre__net_8h_source.html#l01702">ptlrpc_service::srv_req_portal</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03160">ptlrpc_unregister_service()</a>.</p>

</div>
</div>
<a class="anchor" id="a3605ffc33362009878bd0b077a1f577d"></a><!-- doxytag: member="service.c::ptlrpc_start_hr_threads" ref="a3605ffc33362009878bd0b077a1f577d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_start_hr_threads </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02644">2644</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__cpu_8h_source.html#l00213">cfs_percpt_for_each</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="service_8c_source.html#l00242">ptlrpc_hr_service::hr_partitions</a>, <a class="el" href="service_8c_source.html#l00237">ptlrpc_hr_service::hr_waitq</a>, <a class="el" href="service_8c_source.html#l00221">ptlrpc_hr_partition::hrp_cpt</a>, <a class="el" href="service_8c_source.html#l00217">ptlrpc_hr_partition::hrp_nstarted</a>, <a class="el" href="service_8c_source.html#l00225">ptlrpc_hr_partition::hrp_nthrs</a>, <a class="el" href="service_8c_source.html#l00227">ptlrpc_hr_partition::hrp_thrs</a>, <a class="el" href="service_8c_source.html#l00208">ptlrpc_hr_thread::hrt_id</a>, <a class="el" href="service_8c_source.html#l00252">ptlrpc_hr</a>, <a class="el" href="service_8c_source.html#l02578">ptlrpc_hr_main()</a>, <a class="el" href="service_8c_source.html#l02620">ptlrpc_stop_hr_threads()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02888">ptlrpc_hr_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ae010a629f5f836492d7726dcf2692a0e"></a><!-- doxytag: member="service.c::ptlrpc_start_thread" ref="ae010a629f5f836492d7726dcf2692a0e" args="(struct ptlrpc_service_part *svcpt, int wait)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ptlrpc_start_thread </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wait</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02782">2782</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="libcfs__debug_8h_source.html#l00149">D_RPCTRACE</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="obd__support_8h_source.html#l00719">OBD_CPT_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00435">OBD_FAIL_TGT_TOOMANY_THREADS</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>, <a class="el" href="lustre__net_8h_source.html#l01502">PTLRPC_THR_NAME_LEN</a>, <a class="el" href="service_8c_source.html#l02297">ptlrpc_threads_increasable()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>, <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>, <a class="el" href="lustre__net_8h_source.html#l01757">ptlrpc_service_part::scp_nthrs_starting</a>, <a class="el" href="lustre__net_8h_source.html#l01755">ptlrpc_service_part::scp_thr_nextid</a>, <a class="el" href="lustre__net_8h_source.html#l01763">ptlrpc_service_part::scp_threads</a>, <a class="el" href="lustre__net_8h_source.html#l01724">ptlrpc_service::srv_cptable</a>, <a class="el" href="lustre__net_8h_source.html#l01713">ptlrpc_service::srv_is_stopping</a>, <a class="el" href="lustre__net_8h_source.html#l01678">ptlrpc_service::srv_name</a>, <a class="el" href="lustre__net_8h_source.html#l01684">ptlrpc_service::srv_nthrs_cpt_init</a>, <a class="el" href="lustre__net_8h_source.html#l01686">ptlrpc_service::srv_nthrs_cpt_limit</a>, <a class="el" href="lustre__net_8h_source.html#l01680">ptlrpc_service::srv_thread_name</a>, <a class="el" href="lustre__net_8h_source.html#l01496">SVC_STARTING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01519">ptlrpc_thread::t_id</a>, <a class="el" href="lustre__net_8h_source.html#l01510">ptlrpc_thread::t_link</a>, <a class="el" href="lustre__net_8h_source.html#l01534">ptlrpc_thread::t_name</a>, <a class="el" href="lustre__net_8h_source.html#l01531">ptlrpc_thread::t_svcpt</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01582">thread_add_flags()</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>, <a class="el" href="lustre__net_8h_source.html#l01547">thread_is_stopping()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>, and <a class="el" href="service_8c_source.html#l02751">ptlrpc_start_threads()</a>.</p>

</div>
</div>
<a class="anchor" id="aaeadc494869c167148325113344afdeb"></a><!-- doxytag: member="service.c::ptlrpc_stop_hr_threads" ref="aaeadc494869c167148325113344afdeb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_stop_hr_threads </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02620">2620</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__cpu_8h_source.html#l00213">cfs_percpt_for_each</a>, <a class="el" href="service_8c_source.html#l00242">ptlrpc_hr_service::hr_partitions</a>, <a class="el" href="service_8c_source.html#l00238">ptlrpc_hr_service::hr_stopping</a>, <a class="el" href="service_8c_source.html#l00237">ptlrpc_hr_service::hr_waitq</a>, <a class="el" href="service_8c_source.html#l00217">ptlrpc_hr_partition::hrp_nstarted</a>, <a class="el" href="service_8c_source.html#l00219">ptlrpc_hr_partition::hrp_nstopped</a>, <a class="el" href="service_8c_source.html#l00225">ptlrpc_hr_partition::hrp_nthrs</a>, <a class="el" href="service_8c_source.html#l00227">ptlrpc_hr_partition::hrp_thrs</a>, <a class="el" href="service_8c_source.html#l00210">ptlrpc_hr_thread::hrt_waitq</a>, and <a class="el" href="service_8c_source.html#l00252">ptlrpc_hr</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02943">ptlrpc_hr_fini()</a>, and <a class="el" href="service_8c_source.html#l02644">ptlrpc_start_hr_threads()</a>.</p>

</div>
</div>
<a class="anchor" id="ada6b019d287e10df1411a160eb834584"></a><!-- doxytag: member="service.c::ptlrpc_svcpt_health_check" ref="ada6b019d287e10df1411a160eb834584" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_svcpt_health_check </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns 0 if the service is healthy. </p>
<p>Right now, it just checks to make sure that requests aren't languishing in the queue. We'll use this health check to govern whether a node needs to be shot, so it's intentionally non-aggressive. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l03193">3193</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="class__obd_8c_source.html#l00097">at_max</a>, <a class="el" href="lustre__import_8h_source.html#l00379">AT_OFF</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__time_8h_source.html#l00072">cfs_timeval_sub()</a>, <a class="el" href="class__obd_8c_source.html#l00083">obd_timeout</a>, <a class="el" href="linux-time_8h_source.html#l00094">ONE_MILLION</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00167">ptlrpc_nrs_req_peek_nolock()</a>, <a class="el" href="service_8c_source.html#l01718">ptlrpc_server_high_pending()</a>, and <a class="el" href="service_8c_source.html#l01761">ptlrpc_server_normal_pending()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03227">ptlrpc_service_health_check()</a>.</p>

</div>
</div>
<a class="anchor" id="a62db31ec83e712c6dfd032092407be6b"></a><!-- doxytag: member="service.c::ptlrpc_svcpt_stop_threads" ref="a62db31ec83e712c6dfd032092407be6b" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_svcpt_stop_threads </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02683">2683</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__net_8h_source.html#l01763">ptlrpc_service_part::scp_threads</a>, <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01519">ptlrpc_thread::t_id</a>, <a class="el" href="lustre__net_8h_source.html#l01510">ptlrpc_thread::t_link</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01582">thread_add_flags()</a>, and <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02737">ptlrpc_stop_all_threads()</a>.</p>

</div>
</div>
<a class="anchor" id="a83a141ecdccbc4b49ab3c20b9c02de30"></a><!-- doxytag: member="service.c::ptlrpc_thread_stopping" ref="a83a141ecdccbc4b49ab3c20b9c02de30" args="(struct ptlrpc_thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_thread_stopping </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>thread</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02315">2315</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01531">ptlrpc_thread::t_svcpt</a>, and <a class="el" href="lustre__net_8h_source.html#l01547">thread_is_stopping()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02345">__attribute__()</a>, and <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="a3cfdf38f0d5acd7850dd17575a69560e"></a><!-- doxytag: member="service.c::ptlrpc_threads_enough" ref="a3cfdf38f0d5acd7850dd17575a69560e" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_threads_enough </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l02284">2284</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01811">ptlrpc_service_part::scp_nreqs_active</a>, and <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02308">ptlrpc_threads_need_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a4430e2147c91e0e0a9d599b81203221e"></a><!-- doxytag: member="service.c::ptlrpc_threads_increasable" ref="a4430e2147c91e0e0a9d599b81203221e" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_threads_increasable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>allowed to create more threads user can call it w/o any lock but need to hold ptlrpc_service_part::scp_lock to get reliable result </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02297">2297</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01761">ptlrpc_service_part::scp_nthrs_running</a>, and <a class="el" href="lustre__net_8h_source.html#l01757">ptlrpc_service_part::scp_nthrs_starting</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02782">ptlrpc_start_thread()</a>, and <a class="el" href="service_8c_source.html#l02308">ptlrpc_threads_need_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a2506ff0b950b2484e9d414ac8fcda9d8"></a><!-- doxytag: member="service.c::ptlrpc_threads_need_create" ref="a2506ff0b950b2484e9d414ac8fcda9d8" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_threads_need_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>too many requests and allowed to create more threads </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02308">2308</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l02284">ptlrpc_threads_enough()</a>, and <a class="el" href="service_8c_source.html#l02297">ptlrpc_threads_increasable()</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02378">ptlrpc_main()</a>.</p>

</div>
</div>
<a class="anchor" id="af06fb62ce2b0948a26182475c53245c7"></a><!-- doxytag: member="service.c::ptlrpc_wait_replies" ref="af06fb62ce2b0948a26182475c53245c7" args="(struct ptlrpc_service_part *svcpt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_wait_replies </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td>
          <td class="paramname"> <em>svcpt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait until all already scheduled replies are processed. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l02968">2968</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lustre__lib_8h_source.html#l00171">LWI_TIMEOUT</a>, <a class="el" href="lustre__net_8h_source.html#l01854">ptlrpc_service_part::scp_nreps_difficult</a>, and <a class="el" href="lustre__net_8h_source.html#l01791">ptlrpc_service_part::scp_waitq</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l03055">ptlrpc_service_purge_all()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0db37205b6dec202322fd1fcfe8cfbe"></a><!-- doxytag: member="service.c::rs_batch_add" ref="ac0db37205b6dec202322fd1fcfe8cfbe" args="(struct rs_batch *b, struct ptlrpc_reply_state *rs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_batch_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structrs__batch.html">rs_batch</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__reply__state.html">ptlrpc_reply_state</a> *&nbsp;</td>
          <td class="paramname"> <em>rs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a reply to a batch. </p>
<p>Add one reply object to a batch, schedule batched replies if overload.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>batch </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rs</em>&nbsp;</td><td>reply </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l00324">324</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00137">list_move()</a>, <a class="el" href="service_8c_source.html#l00257">MAX_SCHEDULED</a>, <a class="el" href="service_8c_source.html#l00301">rs_batch_dispatch()</a>, <a class="el" href="lustre__net_8h_source.html#l00672">ptlrpc_reply_state::rs_committed</a>, <a class="el" href="lustre__net_8h_source.html#l00653">ptlrpc_reply_state::rs_list</a>, <a class="el" href="lustre__net_8h_source.html#l00662">ptlrpc_reply_state::rs_lock</a>, <a class="el" href="lustre__net_8h_source.html#l00667">ptlrpc_reply_state::rs_scheduled</a>, <a class="el" href="lustre__net_8h_source.html#l00668">ptlrpc_reply_state::rs_scheduled_ever</a>, <a class="el" href="lustre__net_8h_source.html#l00688">ptlrpc_reply_state::rs_svcpt</a>, <a class="el" href="service_8c_source.html#l00247">rs_batch::rsb_n_replies</a>, <a class="el" href="service_8c_source.html#l00246">rs_batch::rsb_replies</a>, and <a class="el" href="service_8c_source.html#l00248">rs_batch::rsb_svcpt</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00408">ptlrpc_commit_replies()</a>.</p>

</div>
</div>
<a class="anchor" id="a8508e7a2ae29df691ccbce2c99d12da3"></a><!-- doxytag: member="service.c::rs_batch_dispatch" ref="a8508e7a2ae29df691ccbce2c99d12da3" args="(struct rs_batch *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_batch_dispatch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structrs__batch.html">rs_batch</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dispatch all replies accumulated in the batch to one from dedicated reply handling threads. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>batch </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l00301">301</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l00209">ptlrpc_hr_thread::hrt_lock</a>, <a class="el" href="service_8c_source.html#l00211">ptlrpc_hr_thread::hrt_queue</a>, <a class="el" href="service_8c_source.html#l00210">ptlrpc_hr_thread::hrt_waitq</a>, <a class="el" href="list_8h_source.html#l00227">list_splice_init()</a>, <a class="el" href="service_8c_source.html#l00274">ptlrpc_hr_select()</a>, <a class="el" href="service_8c_source.html#l00247">rs_batch::rsb_n_replies</a>, <a class="el" href="service_8c_source.html#l00246">rs_batch::rsb_replies</a>, and <a class="el" href="service_8c_source.html#l00248">rs_batch::rsb_svcpt</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00324">rs_batch_add()</a>, and <a class="el" href="service_8c_source.html#l00354">rs_batch_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="a779db3012eec07c43c3d57dc0fb2bff4"></a><!-- doxytag: member="service.c::rs_batch_fini" ref="a779db3012eec07c43c3d57dc0fb2bff4" args="(struct rs_batch *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_batch_fini </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structrs__batch.html">rs_batch</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reply batch finalization. </p>
<p>Dispatch remaining replies from the batch and release remaining spinlock.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>batch </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l00354">354</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="service_8c_source.html#l00301">rs_batch_dispatch()</a>, and <a class="el" href="service_8c_source.html#l00248">rs_batch::rsb_svcpt</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00408">ptlrpc_commit_replies()</a>.</p>

</div>
</div>
<a class="anchor" id="a411747971396d61bbbaf5b5644fff526"></a><!-- doxytag: member="service.c::rs_batch_init" ref="a411747971396d61bbbaf5b5644fff526" args="(struct rs_batch *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void rs_batch_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structrs__batch.html">rs_batch</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a reply batch. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>batch </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="service_8c_source.html#l00264">264</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, and <a class="el" href="service_8c_source.html#l00246">rs_batch::rsb_replies</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00408">ptlrpc_commit_replies()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a9bbbe993837b9f20a26325525bc76bfb"></a><!-- doxytag: member="service.c::ptlrpc_all_services" ref="a9bbbe993837b9f20a26325525bc76bfb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlist__head.html">list_head</a> <a class="el" href="service_8c.html#a9bbbe993837b9f20a26325525bc76bfb">ptlrpc_all_services</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Holds a list of all PTLRPC services. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00068">68</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01099">nrs_policy_unregister_locked()</a>, <a class="el" href="ptlrpc__module_8c_source.html#l00052">ptlrpc_init()</a>, <a class="el" href="nrs_8c_source.html#l01165">ptlrpc_nrs_policy_register()</a>, and <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>.</p>

</div>
</div>
<a class="anchor" id="a9e88c117c1eccb6da9707b1f9430d4f3"></a><!-- doxytag: member="service.c::ptlrpc_all_services_mutex" ref="a9e88c117c1eccb6da9707b1f9430d4f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct mutex <a class="el" href="service_8c.html#a9e88c117c1eccb6da9707b1f9430d4f3">ptlrpc_all_services_mutex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used to protect the <em>ptlrpc_all_services</em> list. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00070">70</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01099">nrs_policy_unregister_locked()</a>, <a class="el" href="ptlrpc__module_8c_source.html#l00052">ptlrpc_init()</a>, <a class="el" href="nrs_8c_source.html#l01165">ptlrpc_nrs_policy_register()</a>, <a class="el" href="nrs_8c_source.html#l01323">ptlrpc_nrs_policy_unregister()</a>, <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>, and <a class="el" href="service_8c_source.html#l03160">ptlrpc_unregister_service()</a>.</p>

</div>
</div>
<a class="anchor" id="affadc36d1336031381dedcf4b2720d6e"></a><!-- doxytag: member="service.c::ptlrpc_hpreq_common" ref="affadc36d1336031381dedcf4b2720d6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structptlrpc__hpreq__ops.html">ptlrpc_hpreq_ops</a> <a class="el" href="service_8c.html#affadc36d1336031381dedcf4b2720d6e">ptlrpc_hpreq_common</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .hpreq_check       = <a class="code" href="service_8c.html#a3998b53a9b8e5f5daae67e33d71d9d4b">ptlrpc_hpreq_check</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="service_8c_source.html#l01615">1615</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6750d361795df91f3863e34d25ef5072"></a><!-- doxytag: member="service.c::ptlrpc_hr" ref="a6750d361795df91f3863e34d25ef5072" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structptlrpc__hr__service.html">ptlrpc_hr_service</a> <a class="el" href="service_8c.html#a6750d361795df91f3863e34d25ef5072">ptlrpc_hr</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>reply handling service. </p>

<p>Definition at line <a class="el" href="service_8c_source.html#l00252">252</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02560">hrt_dont_sleep()</a>, <a class="el" href="service_8c_source.html#l02943">ptlrpc_hr_fini()</a>, <a class="el" href="service_8c_source.html#l02888">ptlrpc_hr_init()</a>, <a class="el" href="service_8c_source.html#l02578">ptlrpc_hr_main()</a>, <a class="el" href="service_8c_source.html#l00274">ptlrpc_hr_select()</a>, <a class="el" href="service_8c_source.html#l02644">ptlrpc_start_hr_threads()</a>, and <a class="el" href="service_8c_source.html#l02620">ptlrpc_stop_hr_threads()</a>.</p>

</div>
</div>
<a class="anchor" id="a840cfd893cfd1ea1f4ac7b04382ed44d"></a><!-- doxytag: member="service.c::test_req_buffer_pressure" ref="a840cfd893cfd1ea1f4ac7b04382ed44d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="service_8c.html#a840cfd893cfd1ea1f4ac7b04382ed44d">test_req_buffer_pressure</a> = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="service_8c_source.html#l00047">47</a> of file <a class="el" href="service_8c_source.html">service.c</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l02252">ptlrpc_check_rqbd_pool()</a>, <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>, and <a class="el" href="events_8c_source.html#l00291">request_in_callback()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
