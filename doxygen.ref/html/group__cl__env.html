<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: cl_env</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cl_env<br/>
<small>
[<a class="el" href="group__clio.html">clio</a>]</small>
</h1>
<p><a class="el" href="structlu__env.html" title="Environment.">lu_env</a> handling for a client.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__env__nest.html">cl_env_nest</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#gad6cae9e9e53d78c25ee1deae1ae3b8f4">cl_env_peek</a> (__u16 *refcheck)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1">cl_env_get</a> (__u16 *refcheck)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns <a class="el" href="structlu__env.html" title="Environment.">lu_env</a>: if there already is an environment associated with the current thread, it is returned, otherwise, new environment is allocated.  <a href="#ga17240d2c6cef5226d4ec8c0b4046afa1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga2d91b169de0380c5f5be4c1118c7af8e">cl_env_alloc</a> (__u16 *refcheck, __u32 tags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Forces an allocation of a fresh environment with given tags.  <a href="#ga2d91b169de0380c5f5be4c1118c7af8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga6ed10b419dd63d9fa101c7e14e75f965">cl_env_nested_get</a> (struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *nest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga9cf31d221b7596143ff46bd799f19cf2">cl_env_put</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, __u16 *refcheck)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release an environment.  <a href="#ga9cf31d221b7596143ff46bd799f19cf2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#gad0152e8236bb22b70e9066509070fded">cl_env_nested_put</a> (struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *nest, struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga2c3cf05baa558c0e2888b5c82d0039a2">cl_env_reenter</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declares a point of re-entrancy.  <a href="#ga2c3cf05baa558c0e2888b5c82d0039a2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga6a2f0ccf8118ede1c1f191a545937eac">cl_env_reexit</a> (void *cookie)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Exits re-entrancy.  <a href="#ga6a2f0ccf8118ede1c1f191a545937eac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#gad07c2a6339d36f40375805d9ae5e02cc">cl_env_implant</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, __u16 *refcheck)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Setup user-supplied <em>env</em> as a current environment.  <a href="#gad07c2a6339d36f40375805d9ae5e02cc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#gace30ddb0f3834c7dad1c4d5315dd63ba">cl_env_unplant</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, __u16 *refcheck)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Detach environment installed earlier by <a class="el" href="group__cl__env.html#gad07c2a6339d36f40375805d9ae5e02cc" title="Setup user-supplied env as a current environment.">cl_env_implant()</a>.  <a href="#gace30ddb0f3834c7dad1c4d5315dd63ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga865dfbdba69721fb16c551ec6ce996d1">cl_env_cache_purge</a> (unsigned nr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalizes and frees a given number of cached environments.  <a href="#ga865dfbdba69721fb16c551ec6ce996d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#ga8d7bb468153f7ccc6259ecef4dfa91bf">cl_env_percpu_get</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__env.html#gabbd19d47d20a5e5787bb6e61acaf1461">cl_env_percpu_put</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="structlu__env.html" title="Environment.">lu_env</a> handling for a client. </p>
<p><a class="el" href="structlu__env.html" title="Environment.">lu_env</a> is an environment within which lustre code executes. Its major part is lu_context---a fast memory allocation mechanism that is used to conserve precious kernel stack space. Originally <a class="el" href="structlu__env.html" title="Environment.">lu_env</a> was designed for a server, where</p>
<ul>
<li>there is a (mostly) fixed number of threads, and</li>
</ul>
<ul>
<li>call chains have no non-lustre portions inserted between lustre code.</li>
</ul>
<p>On a client both these assumtpion fails, because every user thread can potentially execute lustre code as part of a system call, and lustre calls into VFS or MM that call back into lustre.</p>
<p>To deal with that, <a class="el" href="structcl__env.html">cl_env</a> wrapper functions implement the following optimizations:</p>
<ul>
<li>allocation and destruction of environment is amortized by caching no longer used environments instead of destroying them;</li>
</ul>
<ul>
<li>there is a notion of "current" environment, attached to the kernel data structure representing current thread Top-level lustre code allocates an environment and makes it current, then calls into non-lustre code, that in turn calls lustre back. Low-level lustre code thus called can fetch environment created by the top-level code and reuse it, avoiding additional environment allocation. Right now, three interfaces can attach the <a class="el" href="structcl__env.html">cl_env</a> to running thread:<ul>
<li>cl_env_get</li>
<li>cl_env_implant</li>
<li>cl_env_reexit(cl_env_reenter had to be called priorly)</li>
</ul>
</li>
</ul>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structlu__env.html" title="Environment.">lu_env</a>, <a class="el" href="structlu__context.html" title="lu_context.">lu_context</a>, <a class="el" href="structlu__context__key.html" title="Key.">lu_context_key</a> </dd></dl>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga2d91b169de0380c5f5be4c1118c7af8e"></a><!-- doxytag: member="cl_object.h::cl_env_alloc" ref="ga2d91b169de0380c5f5be4c1118c7af8e" args="(__u16 *refcheck, __u32 tags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* cl_env_alloc </td>
          <td>(</td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>tags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Forces an allocation of a fresh environment with given tags. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1" title="Returns lu_env: if there already is an environment associated with the current thread...">cl_env_get()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l00931">931</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00790">cl_env_new()</a>, <a class="el" href="cl__object_8c_source.html#l00872">cl_env_peek()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="lov__dev_8c_source.html#l00267">lov_emerg_alloc()</a>, and <a class="el" href="super25_8c_source.html#l00105">lustre_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga865dfbdba69721fb16c551ec6ce996d1"></a><!-- doxytag: member="cl_object.h::cl_env_cache_purge" ref="ga865dfbdba69721fb16c551ec6ce996d1" args="(unsigned nr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned cl_env_cache_purge </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>nr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finalizes and frees a given number of cached environments. </p>
<p>This is done to (1) free some memory (not currently hooked into VM), or (2) release references to modules. </p>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l00960">960</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00609">ce_linkage</a>, <a class="el" href="cl__object_8c_source.html#l00825">cl_env_fini()</a>, <a class="el" href="cl__object_8c_source.html#l00572">cl_envs</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00059">equi</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llite__lib_8c_source.html#l01099">ll_put_super()</a>, and <a class="el" href="lu__object_8c_source.html#l01594">lu_context_key_quiesce()</a>.</p>

</div>
</div>
<a class="anchor" id="ga17240d2c6cef5226d4ec8c0b4046afa1"></a><!-- doxytag: member="cl_object.h::cl_env_get" ref="ga17240d2c6cef5226d4ec8c0b4046afa1" args="(__u16 *refcheck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* cl_env_get </td>
          <td>(</td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns <a class="el" href="structlu__env.html" title="Environment.">lu_env</a>: if there already is an environment associated with the current thread, it is returned, otherwise, new environment is allocated. </p>
<p>Allocations are amortized through the global cache of environments.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>refcheck</em>&nbsp;</td><td>pointer to a counter used to detect environment leaks. In the usual case <a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1" title="Returns lu_env: if there already is an environment associated with the current thread...">cl_env_get()</a> and <a class="el" href="group__cl__env.html#ga9cf31d221b7596143ff46bd799f19cf2" title="Release an environment.">cl_env_put()</a> are called in the same lexical scope and pointer to the same integer is passed as <em>refcheck</em>. This is used to detect missed <a class="el" href="group__cl__env.html#ga9cf31d221b7596143ff46bd799f19cf2" title="Release an environment.">cl_env_put()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__cl__env.html#ga9cf31d221b7596143ff46bd799f19cf2" title="Release an environment.">cl_env_put()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l00906">906</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00702">cl_env_attach()</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00833">cl_env_obtain()</a>, <a class="el" href="cl__object_8c_source.html#l00872">cl_env_peek()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>.</p>

<p>Referenced by <a class="el" href="echo__client_8c_source.html#l01286">cl_echo_object_brw()</a>, <a class="el" href="echo__client_8c_source.html#l01109">cl_echo_object_find()</a>, <a class="el" href="echo__client_8c_source.html#l01174">cl_echo_object_put()</a>, <a class="el" href="cl__object_8c_source.html#l01051">cl_env_implant()</a>, <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00131">cl_file_inode_init()</a>, <a class="el" href="lcommon__misc_8c_source.html#l00124">cl_get_grouplock()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>, <a class="el" href="glimpse_8c_source.html#l00147">cl_io_get()</a>, <a class="el" href="vvp__dev_8c_source.html#l00337">cl_sb_fini()</a>, <a class="el" href="vvp__dev_8c_source.html#l00314">cl_sb_init()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00075">cl_setattr_ost()</a>, <a class="el" href="echo__client_8c_source.html#l02557">echo_client_iocontrol()</a>, <a class="el" href="file_8c_source.html#l01869">ll_data_version()</a>, <a class="el" href="rw26_8c_source.html#l00487">ll_direct_IO()</a>, <a class="el" href="file_8c_source.html#l01760">ll_do_fiemap()</a>, <a class="el" href="file_8c_source.html#l01245">ll_file_aio_read()</a>, <a class="el" href="file_8c_source.html#l01334">ll_file_aio_write()</a>, <a class="el" href="file_8c_source.html#l01583">ll_file_getstripe()</a>, <a class="el" href="file_8c_source.html#l01300">ll_file_read()</a>, <a class="el" href="file_8c_source.html#l01168">ll_file_read_iter()</a>, <a class="el" href="file_8c_source.html#l01422">ll_file_splice_read()</a>, <a class="el" href="file_8c_source.html#l01387">ll_file_write()</a>, <a class="el" href="file_8c_source.html#l01192">ll_file_write_iter()</a>, <a class="el" href="xattr_8c_source.html#l00521">ll_getxattr_lov()</a>, <a class="el" href="rw26_8c_source.html#l00078">ll_invalidatepage()</a>, <a class="el" href="lloop_8c_source.html#l00444">loop_thread()</a>, <a class="el" href="lov__io_8c_source.html#l00154">lov_io_sub_init()</a>, <a class="el" href="lov__object_8c_source.html#l00729">lov_layout_change()</a>, <a class="el" href="osc__request_8c_source.html#l02632">osc_import_event()</a>, <a class="el" href="vvp__dev_8c_source.html#l00610">vvp_pgcache_next()</a>, <a class="el" href="vvp__dev_8c_source.html#l00537">vvp_pgcache_show()</a>, and <a class="el" href="vvp__dev_8c_source.html#l00586">vvp_pgcache_start()</a>.</p>

</div>
</div>
<a class="anchor" id="gad07c2a6339d36f40375805d9ae5e02cc"></a><!-- doxytag: member="cl_object.h::cl_env_implant" ref="gad07c2a6339d36f40375805d9ae5e02cc" args="(struct lu_env *env, __u16 *refcheck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_implant </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Setup user-supplied <em>env</em> as a current environment. </p>
<p>This is to be used to guaranteed that environment exists even when <a class="el" href="group__cl__env.html#ga17240d2c6cef5226d4ec8c0b4046afa1" title="Returns lu_env: if there already is an environment associated with the current thread...">cl_env_get()</a> fails. It is up to user to ensure proper concurrency control.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__cl__env.html#gace30ddb0f3834c7dad1c4d5315dd63ba" title="Detach environment installed earlier by cl_env_implant().">cl_env_unplant()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01051">1051</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00702">cl_env_attach()</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>, and <a class="el" href="lcommon__misc_8c_source.html#l00181">cl_put_grouplock()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6ed10b419dd63d9fa101c7e14e75f965"></a><!-- doxytag: member="cl_object.h::cl_env_nested_get" ref="ga6ed10b419dd63d9fa101c7e14e75f965" args="(struct cl_env_nest *nest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* cl_env_nested_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *&nbsp;</td>
          <td class="paramname"> <em>nest</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01079">1079</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l02463">cl_env_nest::cen_cookie</a>, <a class="el" href="cl__object_8h_source.html#l02462">cl_env_nest::cen_refcheck</a>, <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, <a class="el" href="cl__object_8c_source.html#l00872">cl_env_peek()</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, <a class="el" href="cl__object_8c_source.html#l01028">cl_env_reenter()</a>, <a class="el" href="cl__object_8c_source.html#l01037">cl_env_reexit()</a>, <a class="el" href="cl__io_8c_source.html#l00076">cl_io_is_going()</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l02787">cl_sync_file_range()</a>, <a class="el" href="llite__mmap_8c_source.html#l00101">ll_fault_io_init()</a>, <a class="el" href="file_8c_source.html#l01915">ll_hsm_release()</a>, <a class="el" href="file_8c_source.html#l02224">ll_ladvise()</a>, <a class="el" href="file_8c_source.html#l03872">ll_layout_conf()</a>, <a class="el" href="rw_8c_source.html#l00887">ll_writepage()</a>, <a class="el" href="osc__page_8c_source.html#l01161">osc_cache_shrink_scan()</a>, <a class="el" href="osc__cache_8c_source.html#l00961">osc_extent_truncate()</a>, <a class="el" href="osc__lock_8c_source.html#l00534">osc_ldlm_blocking_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00582">osc_ldlm_glimpse_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00693">osc_ldlm_weigh_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00393">osc_lock_flush()</a>, <a class="el" href="osc__lock_8c_source.html#l00302">osc_lock_upcall()</a>, <a class="el" href="osc__lock_8c_source.html#l00357">osc_lock_upcall_agl()</a>, and <a class="el" href="osc__page_8c_source.html#l00808">osc_lru_reclaim()</a>.</p>

</div>
</div>
<a class="anchor" id="gad0152e8236bb22b70e9066509070fded"></a><!-- doxytag: member="cl_object.h::cl_env_nested_put" ref="gad0152e8236bb22b70e9066509070fded" args="(struct cl_env_nest *nest, struct lu_env *env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_nested_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *&nbsp;</td>
          <td class="paramname"> <em>nest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01104">1104</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l02463">cl_env_nest::cen_cookie</a>, <a class="el" href="cl__object_8h_source.html#l02462">cl_env_nest::cen_refcheck</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, and <a class="el" href="cl__object_8c_source.html#l01037">cl_env_reexit()</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l02787">cl_sync_file_range()</a>, <a class="el" href="llite__mmap_8c_source.html#l00288">ll_fault0()</a>, <a class="el" href="llite__mmap_8c_source.html#l00101">ll_fault_io_init()</a>, <a class="el" href="file_8c_source.html#l01915">ll_hsm_release()</a>, <a class="el" href="file_8c_source.html#l02224">ll_ladvise()</a>, <a class="el" href="file_8c_source.html#l03872">ll_layout_conf()</a>, <a class="el" href="llite__mmap_8c_source.html#l00177">ll_page_mkwrite0()</a>, <a class="el" href="rw_8c_source.html#l00887">ll_writepage()</a>, <a class="el" href="osc__page_8c_source.html#l01161">osc_cache_shrink_scan()</a>, <a class="el" href="osc__cache_8c_source.html#l00961">osc_extent_truncate()</a>, <a class="el" href="osc__lock_8c_source.html#l00534">osc_ldlm_blocking_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00582">osc_ldlm_glimpse_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00693">osc_ldlm_weigh_ast()</a>, <a class="el" href="osc__lock_8c_source.html#l00393">osc_lock_flush()</a>, <a class="el" href="osc__lock_8c_source.html#l00302">osc_lock_upcall()</a>, <a class="el" href="osc__lock_8c_source.html#l00357">osc_lock_upcall_agl()</a>, and <a class="el" href="osc__page_8c_source.html#l00808">osc_lru_reclaim()</a>.</p>

</div>
</div>
<a class="anchor" id="gad6cae9e9e53d78c25ee1deae1ae3b8f4"></a><!-- doxytag: member="cl_object.h::cl_env_peek" ref="gad6cae9e9e53d78c25ee1deae1ae3b8f4" args="(__u16 *refcheck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* cl_env_peek </td>
          <td>(</td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l00872">872</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00580">ce_lu</a>, <a class="el" href="cl__object_8c_source.html#l00579">ce_magic</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00693">cl_env_fetch()</a>, <a class="el" href="cl__object_8c_source.html#l00629">CL_ENV_INC</a>, <a class="el" href="osd__iam_8h_source.html#l00054">CLASSERT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="iam__ut_8c_source.html#l00142">lookup()</a>, and <a class="el" href="lustre__user_8h_source.html#l01032">offsetof</a>.</p>

<p>Referenced by <a class="el" href="cl__object_8c_source.html#l00931">cl_env_alloc()</a>, <a class="el" href="cl__object_8c_source.html#l00906">cl_env_get()</a>, and <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>.</p>

</div>
</div>
<a class="anchor" id="ga8d7bb468153f7ccc6259ecef4dfa91bf"></a><!-- doxytag: member="cl_object.h::cl_env_percpu_get" ref="ga8d7bb468153f7ccc6259ecef4dfa91bf" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__env.html">lu_env</a>* cl_env_percpu_get </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01229">1229</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00580">ce_lu</a>, <a class="el" href="cl__object_8c_source.html#l00702">cl_env_attach()</a>, <a class="el" href="cl__object_8c_source.html#l00633">cl_env_init0()</a>, and <a class="el" href="cl__object_8c_source.html#l01144">cl_env_percpu</a>.</p>

<p>Referenced by <a class="el" href="rw26_8c_source.html#l00128">ll_releasepage()</a>.</p>

</div>
</div>
<a class="anchor" id="gabbd19d47d20a5e5787bb6e61acaf1461"></a><!-- doxytag: member="cl_object.h::cl_env_percpu_put" ref="gabbd19d47d20a5e5787bb6e61acaf1461" args="(struct lu_env *env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_percpu_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01209">1209</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00618">ce_debug</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00630">CL_ENV_DEC</a>, <a class="el" href="cl__object_8c_source.html#l00779">cl_env_detach()</a>, <a class="el" href="cl__object_8c_source.html#l01144">cl_env_percpu</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="rw26_8c_source.html#l00128">ll_releasepage()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9cf31d221b7596143ff46bd799f19cf2"></a><!-- doxytag: member="cl_object.h::cl_env_put" ref="ga9cf31d221b7596143ff46bd799f19cf2" args="(struct lu_env *env, __u16 *refcheck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release an environment. </p>
<p>Decrement <em>env</em> reference counter. When counter drops to 0, nothing in this thread is using environment and it is returned to the allocation cache, or freed straight away, if cache is large enough. </p>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l00989">989</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00618">ce_debug</a>, <a class="el" href="cl__object_8c_source.html#l00609">ce_linkage</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00630">CL_ENV_DEC</a>, <a class="el" href="cl__object_8c_source.html#l00779">cl_env_detach()</a>, <a class="el" href="cl__object_8c_source.html#l00948">cl_env_exit()</a>, <a class="el" href="cl__object_8c_source.html#l00825">cl_env_fini()</a>, <a class="el" href="cl__object_8c_source.html#l00572">cl_envs</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00958">lu_context::lc_tags</a>, <a class="el" href="lu__object_8h_source.html#l01007">LCT_CL_THREAD</a>, <a class="el" href="lu__object_8h_source.html#l01034">LCT_HAS_EXIT</a>, <a class="el" href="lu__object_8h_source.html#l01012">LCT_SESSION</a>, <a class="el" href="lu__object_8h_source.html#l01273">lu_env::le_ctx</a>, <a class="el" href="lu__object_8h_source.html#l01277">lu_env::le_ses</a>, and <a class="el" href="list_8h_source.html#l00076">list_add()</a>.</p>

<p>Referenced by <a class="el" href="echo__client_8c_source.html#l01286">cl_echo_object_brw()</a>, <a class="el" href="echo__client_8c_source.html#l01109">cl_echo_object_find()</a>, <a class="el" href="echo__client_8c_source.html#l01174">cl_echo_object_put()</a>, <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>, <a class="el" href="cl__object_8c_source.html#l01104">cl_env_nested_put()</a>, <a class="el" href="cl__object_8c_source.html#l01066">cl_env_unplant()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00131">cl_file_inode_init()</a>, <a class="el" href="lcommon__misc_8c_source.html#l00124">cl_get_grouplock()</a>, <a class="el" href="glimpse_8c_source.html#l00171">cl_glimpse_size0()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>, <a class="el" href="lcommon__misc_8c_source.html#l00181">cl_put_grouplock()</a>, <a class="el" href="vvp__dev_8c_source.html#l00337">cl_sb_fini()</a>, <a class="el" href="vvp__dev_8c_source.html#l00314">cl_sb_init()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00075">cl_setattr_ost()</a>, <a class="el" href="echo__client_8c_source.html#l02557">echo_client_iocontrol()</a>, <a class="el" href="file_8c_source.html#l01869">ll_data_version()</a>, <a class="el" href="rw26_8c_source.html#l00487">ll_direct_IO()</a>, <a class="el" href="file_8c_source.html#l01760">ll_do_fiemap()</a>, <a class="el" href="file_8c_source.html#l01245">ll_file_aio_read()</a>, <a class="el" href="file_8c_source.html#l01334">ll_file_aio_write()</a>, <a class="el" href="file_8c_source.html#l01583">ll_file_getstripe()</a>, <a class="el" href="file_8c_source.html#l01300">ll_file_read()</a>, <a class="el" href="file_8c_source.html#l01168">ll_file_read_iter()</a>, <a class="el" href="file_8c_source.html#l01422">ll_file_splice_read()</a>, <a class="el" href="file_8c_source.html#l01387">ll_file_write()</a>, <a class="el" href="file_8c_source.html#l01192">ll_file_write_iter()</a>, <a class="el" href="xattr_8c_source.html#l00521">ll_getxattr_lov()</a>, <a class="el" href="rw26_8c_source.html#l00078">ll_invalidatepage()</a>, <a class="el" href="lloop_8c_source.html#l00444">loop_thread()</a>, <a class="el" href="lov__dev_8c_source.html#l00221">lov_emerg_free()</a>, <a class="el" href="lov__io_8c_source.html#l00059">lov_io_sub_fini()</a>, <a class="el" href="lov__object_8c_source.html#l00729">lov_layout_change()</a>, <a class="el" href="super25_8c_source.html#l00213">lustre_exit()</a>, <a class="el" href="super25_8c_source.html#l00105">lustre_init()</a>, <a class="el" href="osc__request_8c_source.html#l02632">osc_import_event()</a>, <a class="el" href="vvp__dev_8c_source.html#l00610">vvp_pgcache_next()</a>, <a class="el" href="vvp__dev_8c_source.html#l00537">vvp_pgcache_show()</a>, and <a class="el" href="vvp__dev_8c_source.html#l00586">vvp_pgcache_start()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2c3cf05baa558c0e2888b5c82d0039a2"></a><!-- doxytag: member="cl_object.h::cl_env_reenter" ref="ga2c3cf05baa558c0e2888b5c82d0039a2" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* cl_env_reenter </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Declares a point of re-entrancy. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__cl__env.html#ga6a2f0ccf8118ede1c1f191a545937eac" title="Exits re-entrancy.">cl_env_reexit()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01028">1028</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00779">cl_env_detach()</a>.</p>

<p>Referenced by <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>, <a class="el" href="rw26_8c_source.html#l00128">ll_releasepage()</a>, <a class="el" href="lov__io_8c_source.html#l00154">lov_io_sub_init()</a>, and <a class="el" href="lov__object_8c_source.html#l00729">lov_layout_change()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6a2f0ccf8118ede1c1f191a545937eac"></a><!-- doxytag: member="cl_object.h::cl_env_reexit" ref="ga6a2f0ccf8118ede1c1f191a545937eac" args="(void *cookie)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_reexit </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>cookie</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Exits re-entrancy. </p>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01037">1037</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00702">cl_env_attach()</a>, and <a class="el" href="cl__object_8c_source.html#l00779">cl_env_detach()</a>.</p>

<p>Referenced by <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>, <a class="el" href="cl__object_8c_source.html#l01104">cl_env_nested_put()</a>, <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>, <a class="el" href="rw26_8c_source.html#l00128">ll_releasepage()</a>, <a class="el" href="lov__io_8c_source.html#l00154">lov_io_sub_init()</a>, and <a class="el" href="lov__object_8c_source.html#l00729">lov_layout_change()</a>.</p>

</div>
</div>
<a class="anchor" id="gace30ddb0f3834c7dad1c4d5315dd63ba"></a><!-- doxytag: member="cl_object.h::cl_env_unplant" ref="gace30ddb0f3834c7dad1c4d5315dd63ba" args="(struct lu_env *env, __u16 *refcheck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_env_unplant </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16 *&nbsp;</td>
          <td class="paramname"> <em>refcheck</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Detach environment installed earlier by <a class="el" href="group__cl__env.html#gad07c2a6339d36f40375805d9ae5e02cc" title="Setup user-supplied env as a current environment.">cl_env_implant()</a>. </p>

<p>Definition at line <a class="el" href="cl__object_8c_source.html#l01066">1066</a> of file <a class="el" href="cl__object_8c_source.html">cl_object.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8c_source.html#l00613">ce_ref</a>, <a class="el" href="cl__object_8c_source.html#l00867">cl_env_container()</a>, <a class="el" href="cl__object_8c_source.html#l00779">cl_env_detach()</a>, <a class="el" href="cl__object_8c_source.html#l00989">cl_env_put()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="lcommon__misc_8c_source.html#l00124">cl_get_grouplock()</a>, and <a class="el" href="lcommon__cl_8c_source.html#l00226">cl_inode_fini()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:51 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
