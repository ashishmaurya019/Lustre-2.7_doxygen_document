<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/llite/llite_mmap.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/llite/llite_mmap.c File Reference</h1><code>#include &lt;linux/kernel.h&gt;</code><br/>
<code>#include &lt;linux/mm.h&gt;</code><br/>
<code>#include &lt;linux/string.h&gt;</code><br/>
<code>#include &lt;linux/stat.h&gt;</code><br/>
<code>#include &lt;linux/errno.h&gt;</code><br/>
<code>#include &lt;linux/unistd.h&gt;</code><br/>
<code>#include &lt;linux/version.h&gt;</code><br/>
<code>#include &lt;asm/uaccess.h&gt;</code><br/>
<code>#include &lt;linux/fs.h&gt;</code><br/>
<code>#include &lt;linux/pagemap.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="llite__internal_8h_source.html">llite_internal.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="lustre__compat_8h_source.html">lustre_compat.h</a>&gt;</code><br/>

<p><a href="llite__mmap_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_LLITE</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a925cdc15265963168a4993a5d71d756a">policy_from_vma</a> (union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy, struct vm_area_struct *vma, unsigned long addr, size_t count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct vm_area_struct *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a25cfecbc8c69892122b25b50200aabdc">our_vma</a> (struct mm_struct *mm, unsigned long addr, size_t count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#afd22c6f04419302b337aa18c7c54f956">ll_fault_io_init</a> (struct vm_area_struct *vma, struct <a class="el" href="structlu__env.html">lu_env</a> **env_ret, struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *nest, pgoff_t index, unsigned long *ra_flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">API independent part for page fault initialization.  <a href="#afd22c6f04419302b337aa18c7c54f956"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a920bb350f4bfa3c7ba3981d449cbf5df">ll_page_mkwrite0</a> (struct vm_area_struct *vma, struct page *vmpage, bool *retry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#aab5c47ad1af42cfb258c309c45b1ba1c">to_fault_error</a> (int result)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a9cf9dc084d9fd0866385a6a7105e21d9">ll_fault0</a> (struct vm_area_struct *vma, struct vm_fault *vmf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lustre implementation of a vm_operations_struct::fault() method, called by VM to server page fault (both in kernel and user space).  <a href="#a9cf9dc084d9fd0866385a6a7105e21d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a1f17027c75e7567ec6876f1cff8352a0">ll_fault</a> (struct vm_area_struct *vma, struct vm_fault *vmf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#ae9dcb3b5eef6e8ce61ee591fcde0800e">ll_page_mkwrite</a> (struct vm_area_struct *vma, struct vm_fault *vmf)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#aeead415972b72c50180ed33777eadb1f">ll_vm_open</a> (struct vm_area_struct *vma)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">To avoid cancel the locks covering mmapped region for lock cache pressure, we track the mapped vma count in <a class="el" href="structvvp__object.html#a8f1265402ca6c05691a88dbfd9ae2c39" title="Number of outstanding mmaps on this file.">vvp_object::vob_mmap_cnt</a>.  <a href="#aeead415972b72c50180ed33777eadb1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#af13a4ef8fe69aab6482b1e469d451227">ll_vm_close</a> (struct vm_area_struct *vma)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dual to <a class="el" href="llite__mmap_8c.html#aeead415972b72c50180ed33777eadb1f" title="To avoid cancel the locks covering mmapped region for lock cache pressure, we track...">ll_vm_open()</a>.  <a href="#af13a4ef8fe69aab6482b1e469d451227"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a8d9439d2cabe466cddf9badbbd1da103">ll_teardown_mmaps</a> (struct address_space *<a class="el" href="lsupport_8c.html#a204e0f2b3e5eb394897a119a9bf17b01">mapping</a>, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> first, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> last)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#ad850d32388ed2bf59cb3e8027653ba9c">ll_file_mmap</a> (struct file *file, struct vm_area_struct *vma)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct vm_operations_struct&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llite__mmap_8c.html#a9e7e337eebf70ad0584d0fd21cbffec7">ll_file_vm_ops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="llite_mmap.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_LLITE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00052">52</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1f17027c75e7567ec6876f1cff8352a0"></a><!-- doxytag: member="llite_mmap.c::ll_fault" ref="a1f17027c75e7567ec6876f1cff8352a0" args="(struct vm_area_struct *vma, struct vm_fault *vmf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ll_fault </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_fault *&nbsp;</td>
          <td class="paramname"> <em>vmf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00343">343</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="linux-prim_8c_source.html#l00117">cfs_block_sigsinv()</a>, <a class="el" href="linux-prim_8c_source.html#l00132">cfs_restore_sigs()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__mmap_8c_source.html#l00288">ll_fault0()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a9cf9dc084d9fd0866385a6a7105e21d9"></a><!-- doxytag: member="llite_mmap.c::ll_fault0" ref="a9cf9dc084d9fd0866385a6a7105e21d9" args="(struct vm_area_struct *vma, struct vm_fault *vmf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ll_fault0 </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_fault *&nbsp;</td>
          <td class="paramname"> <em>vmf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lustre implementation of a vm_operations_struct::fault() method, called by VM to server page fault (both in kernel and user space). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>vma</em>&nbsp;</td><td>- is virtiual area struct related to page fault </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>vmf</em>&nbsp;</td><td>- structure which describe type and address where hit fault</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>allocated and filled _locked_ page for address </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>VM_FAULT_ERROR</em>&nbsp;</td><td>on general error </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NOPAGE_OOM</em>&nbsp;</td><td>not have memory for allocate new page </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00288">288</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="cl__object_8h_source.html#l01819">cl_io::ci_result</a>, <a class="el" href="cl__object_8c_source.html#l01104">cl_env_nested_put()</a>, <a class="el" href="cl__io_8c_source.html#l00103">cl_io_fini()</a>, <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00152">D_MMAP</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="structvvp__io.html#a58c58a6a44d253e212e393909b368924">vvp_io::fault</a>, <a class="el" href="rw_8c_source.html#l01051">ll_cl_add()</a>, <a class="el" href="rw_8c_source.html#l01067">ll_cl_remove()</a>, <a class="el" href="llite__mmap_8c_source.html#l00101">ll_fault_io_init()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="llite__mmap_8c_source.html#l00258">to_fault_error()</a>, <a class="el" href="structvvp__io.html#aa4cca354b98a062eac6e342355230fba">vvp_io::u</a>, <a class="el" href="llite__internal_8h_source.html#l00061">VM_FAULT_RETRY</a>, and <a class="el" href="vvp__internal_8h_source.html#l00209">vvp_env_io()</a>.</p>

<p>Referenced by <a class="el" href="llite__mmap_8c_source.html#l00343">ll_fault()</a>.</p>

</div>
</div>
<a class="anchor" id="afd22c6f04419302b337aa18c7c54f956"></a><!-- doxytag: member="llite_mmap.c::ll_fault_io_init" ref="afd22c6f04419302b337aa18c7c54f956" args="(struct vm_area_struct *vma, struct lu_env **env_ret, struct cl_env_nest *nest, pgoff_t index, unsigned long *ra_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structcl__io.html">cl_io</a>* ll_fault_io_init </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> **&nbsp;</td>
          <td class="paramname"> <em>env_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__env__nest.html">cl_env_nest</a> *&nbsp;</td>
          <td class="paramname"> <em>nest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pgoff_t&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&nbsp;</td>
          <td class="paramname"> <em>ra_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>API independent part for page fault initialization. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>vma</em>&nbsp;</td><td>- virtual memory area addressed to page fault </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>env</em>&nbsp;</td><td>- corespondent <a class="el" href="structlu__env.html" title="Environment.">lu_env</a> to processing </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nest</em>&nbsp;</td><td>- nested level </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>index</em>&nbsp;</td><td>- page index corespondent to fault.  ra_flags - vma readahead flags.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>allocated and initialized env for fault operation. </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>EINVAL</em>&nbsp;</td><td>if env can't allocated </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>other error codes from cl_io_init. </dd></dl>

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00101">101</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="structcl__io.html#a1a7759183426a4d21ab676823e0a8a11">cl_io::ci_fault</a>, <a class="el" href="cl__object_8h_source.html#l01763">cl_io::ci_lockreq</a>, <a class="el" href="cl__object_8h_source.html#l01820">cl_io::ci_need_restart</a>, <a class="el" href="cl__object_8h_source.html#l01752">cl_io::ci_obj</a>, <a class="el" href="cl__object_8h_source.html#l01712">CILR_MANDATORY</a>, <a class="el" href="cl__object_8h_source.html#l01439">cl_io_slice::cis_io</a>, <a class="el" href="cl__object_8h_source.html#l01372">CIT_FAULT</a>, <a class="el" href="cl__object_8c_source.html#l01079">cl_env_nested_get()</a>, <a class="el" href="cl__object_8c_source.html#l01104">cl_env_nested_put()</a>, <a class="el" href="cl__io_8c_source.html#l00103">cl_io_fini()</a>, <a class="el" href="cl__io_8c_source.html#l00211">cl_io_init()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00152">D_MMAP</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__internal_8h_source.html#l01369">ll_file_nolock()</a>, <a class="el" href="llite__internal_8h_source.html#l00332">ll_i2info()</a>, <a class="el" href="llite__internal_8h_source.html#l00244">ll_inode_info::lli_clob</a>, <a class="el" href="llite__internal_8h_source.html#l00078">LUSTRE_FPRIVATE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="structcl__io.html#a8b561db29f0b79fba4d14b66b9882530">cl_io::u</a>, <a class="el" href="vvp__internal_8h_source.html#l00066">vvp_io::vui_cl</a>, <a class="el" href="vvp__internal_8h_source.html#l00133">vvp_io::vui_fd</a>, <a class="el" href="vvp__internal_8h_source.html#l00209">vvp_env_io()</a>, and <a class="el" href="vvp__internal_8h_source.html#l00186">vvp_env_thread_io()</a>.</p>

<p>Referenced by <a class="el" href="llite__mmap_8c_source.html#l00288">ll_fault0()</a>, and <a class="el" href="llite__mmap_8c_source.html#l00177">ll_page_mkwrite0()</a>.</p>

</div>
</div>
<a class="anchor" id="ad850d32388ed2bf59cb3e8027653ba9c"></a><!-- doxytag: member="llite_mmap.c::ll_file_mmap" ref="ad850d32388ed2bf59cb3e8027653ba9c" args="(struct file *file, struct vm_area_struct *vma)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ll_file_mmap </td>
          <td>(</td>
          <td class="paramtype">struct file *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00485">485</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="llite__internal_8h_source.html#l01369">ll_file_nolock()</a>, <a class="el" href="llite__mmap_8c_source.html#l00057">ll_file_vm_ops</a>, <a class="el" href="llite__internal_8h_source.html#l01247">ll_glimpse_size()</a>, <a class="el" href="llite__internal_8h_source.html#l01090">ll_i2sbi()</a>, <a class="el" href="llite__internal_8h_source.html#l00737">ll_stats_ops_tally()</a>, <a class="el" href="llite__internal_8h_source.html#l00750">LPROC_LL_MAP</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ae9dcb3b5eef6e8ce61ee591fcde0800e"></a><!-- doxytag: member="llite_mmap.c::ll_page_mkwrite" ref="ae9dcb3b5eef6e8ce61ee591fcde0800e" args="(struct vm_area_struct *vma, struct vm_fault *vmf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ll_page_mkwrite </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_fault *&nbsp;</td>
          <td class="paramname"> <em>vmf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00384">384</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__internal_8h_source.html#l01105">ll_inode2fid()</a>, <a class="el" href="llite__mmap_8c_source.html#l00177">ll_page_mkwrite0()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="llite__internal_8h_source.html#l00061">VM_FAULT_RETRY</a>.</p>

</div>
</div>
<a class="anchor" id="a920bb350f4bfa3c7ba3981d449cbf5df"></a><!-- doxytag: member="llite_mmap.c::ll_page_mkwrite0" ref="a920bb350f4bfa3c7ba3981d449cbf5df" args="(struct vm_area_struct *vma, struct page *vmpage, bool *retry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ll_page_mkwrite0 </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct page *&nbsp;</td>
          <td class="paramname"> <em>vmpage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>retry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00177">177</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-prim_8c_source.html#l00117">cfs_block_sigsinv()</a>, <a class="el" href="linux-prim_8c_source.html#l00132">cfs_restore_sigs()</a>, <a class="el" href="structcl__io.html#a1a7759183426a4d21ab676823e0a8a11">cl_io::ci_fault</a>, <a class="el" href="cl__object_8h_source.html#l01752">cl_io::ci_obj</a>, <a class="el" href="cl__object_8h_source.html#l01819">cl_io::ci_result</a>, <a class="el" href="cl__object_8c_source.html#l01104">cl_env_nested_put()</a>, <a class="el" href="cl__io_8c_source.html#l00103">cl_io_fini()</a>, <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00152">D_MMAP</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="structvvp__io.html#a58c58a6a44d253e212e393909b368924">vvp_io::fault</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__mmap_8c_source.html#l00101">ll_fault_io_init()</a>, <a class="el" href="llite__internal_8h_source.html#l00284">ll_file_set_flag()</a>, <a class="el" href="llite__internal_8h_source.html#l00332">ll_i2info()</a>, <a class="el" href="llite__internal_8h_source.html#l00277">LLIF_DATA_MODIFIED</a>, <a class="el" href="structvvp__io.html#aa4cca354b98a062eac6e342355230fba">vvp_io::u</a>, <a class="el" href="structcl__io.html#a8b561db29f0b79fba4d14b66b9882530">cl_io::u</a>, <a class="el" href="vvp__internal_8h_source.html#l00209">vvp_env_io()</a>, and <a class="el" href="vvp__internal_8h_source.html#l00303">vvp_object_inode()</a>.</p>

<p>Referenced by <a class="el" href="llite__mmap_8c_source.html#l00384">ll_page_mkwrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a8d9439d2cabe466cddf9badbbd1da103"></a><!-- doxytag: member="llite_mmap.c::ll_teardown_mmaps" ref="a8d9439d2cabe466cddf9badbbd1da103" args="(struct address_space *mapping, __u64 first, __u64 last)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ll_teardown_mmaps </td>
          <td>(</td>
          <td class="paramtype">struct address_space *&nbsp;</td>
          <td class="paramname"> <em>mapping</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>first</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>last</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00463">463</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llite__internal_8h_source.html#l01050">ll_invalidate_page()</a>.</p>

</div>
</div>
<a class="anchor" id="af13a4ef8fe69aab6482b1e469d451227"></a><!-- doxytag: member="llite_mmap.c::ll_vm_close" ref="af13a4ef8fe69aab6482b1e469d451227" args="(struct vm_area_struct *vma)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ll_vm_close </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dual to <a class="el" href="llite__mmap_8c.html#aeead415972b72c50180ed33777eadb1f" title="To avoid cancel the locks covering mmapped region for lock cache pressure, we track...">ll_vm_open()</a>. </p>

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00449">449</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="vvp__object_8c_source.html#l00277">cl_inode2vvp()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, and <a class="el" href="vvp__internal_8h_source.html#l00233">vvp_object::vob_mmap_cnt</a>.</p>

</div>
</div>
<a class="anchor" id="aeead415972b72c50180ed33777eadb1f"></a><!-- doxytag: member="llite_mmap.c::ll_vm_open" ref="aeead415972b72c50180ed33777eadb1f" args="(struct vm_area_struct *vma)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ll_vm_open </td>
          <td>(</td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>To avoid cancel the locks covering mmapped region for lock cache pressure, we track the mapped vma count in <a class="el" href="structvvp__object.html#a8f1265402ca6c05691a88dbfd9ae2c39" title="Number of outstanding mmaps on this file.">vvp_object::vob_mmap_cnt</a>. </p>

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00434">434</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="vvp__object_8c_source.html#l00277">cl_inode2vvp()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, and <a class="el" href="vvp__internal_8h_source.html#l00233">vvp_object::vob_mmap_cnt</a>.</p>

</div>
</div>
<a class="anchor" id="a25cfecbc8c69892122b25b50200aabdc"></a><!-- doxytag: member="llite_mmap.c::our_vma" ref="a25cfecbc8c69892122b25b50200aabdc" args="(struct mm_struct *mm, unsigned long addr, size_t count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct vm_area_struct* our_vma </td>
          <td>(</td>
          <td class="paramtype">struct mm_struct *&nbsp;</td>
          <td class="paramname"> <em>mm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00068">68</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llite__mmap_8c_source.html#l00057">ll_file_vm_ops</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00047">ret</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="vvp__io_8c_source.html#l00389">vvp_mmap_locks()</a>.</p>

</div>
</div>
<a class="anchor" id="a925cdc15265963168a4993a5d71d756a"></a><!-- doxytag: member="llite_mmap.c::policy_from_vma" ref="a925cdc15265963168a4993a5d71d756a" args="(union ldlm_policy_data *policy, struct vm_area_struct *vma, unsigned long addr, size_t count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void policy_from_vma </td>
          <td>(</td>
          <td class="paramtype">union <a class="el" href="unionldlm__policy__data.html">ldlm_policy_data</a> *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct vm_area_struct *&nbsp;</td>
          <td class="paramname"> <em>vma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00059">59</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l02823">ldlm_extent::end</a>, <a class="el" href="lustre__dlm_8h_source.html#l00633">ldlm_policy_data::l_extent</a>, and <a class="el" href="lustre__idl_8h_source.html#l02822">ldlm_extent::start</a>.</p>

<p>Referenced by <a class="el" href="vvp__io_8c_source.html#l00389">vvp_mmap_locks()</a>.</p>

</div>
</div>
<a class="anchor" id="aab5c47ad1af42cfb258c309c45b1ba1c"></a><!-- doxytag: member="llite_mmap.c::to_fault_error" ref="aab5c47ad1af42cfb258c309c45b1ba1c" args="(int result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int to_fault_error </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>result</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00258">258</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>Referenced by <a class="el" href="llite__mmap_8c_source.html#l00288">ll_fault0()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a9e7e337eebf70ad0584d0fd21cbffec7"></a><!-- doxytag: member="llite_mmap.c::ll_file_vm_ops" ref="a9e7e337eebf70ad0584d0fd21cbffec7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct vm_operations_struct <a class="el" href="llite__mmap_8c.html#a9e7e337eebf70ad0584d0fd21cbffec7">ll_file_vm_ops</a><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .fault                  = <a class="code" href="llite__mmap_8c.html#a1f17027c75e7567ec6876f1cff8352a0">ll_fault</a>,
        .page_mkwrite           = <a class="code" href="llite__mmap_8c.html#ae9dcb3b5eef6e8ce61ee591fcde0800e">ll_page_mkwrite</a>,
        .open                   = <a class="code" href="llite__mmap_8c.html#aeead415972b72c50180ed33777eadb1f" title="To avoid cancel the locks covering mmapped region for lock cache pressure, we track...">ll_vm_open</a>,
        .close                  = <a class="code" href="llite__mmap_8c.html#af13a4ef8fe69aab6482b1e469d451227" title="Dual to ll_vm_open().">ll_vm_close</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="llite__mmap_8c_source.html#l00057">57</a> of file <a class="el" href="llite__mmap_8c_source.html">llite_mmap.c</a>.</p>

<p>Referenced by <a class="el" href="llite__mmap_8c_source.html#l00485">ll_file_mmap()</a>, and <a class="el" href="llite__mmap_8c_source.html#l00068">our_vma()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
