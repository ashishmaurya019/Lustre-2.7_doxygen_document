<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/lfsck/lfsck_namespace.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/lfsck/lfsck_namespace.c File Reference</h1><code>#include &lt;<a class="el" href="lustre__idl_8h_source.html">lustre/lustre_idl.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lu__object_8h_source.html">lu_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="dt__object_8h_source.html">dt_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="md__object_8h_source.html">md_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__fid_8h_source.html">lustre_fid.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__lib_8h_source.html">lustre_lib.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__user_8h_source.html">lustre/lustre_user.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="lfsck__internal_8h_source.html">lfsck_internal.h</a>&quot;</code><br/>

<p><a href="lfsck__namespace_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_LFSCK</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a19c2100412bfbb5ab9a17cf2d874d723">LFSCK_NAMESPACE_MAGIC_V1</a>&nbsp;&nbsp;&nbsp;0xA0629D03</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a9c35746893230ac753c6bc1945a1f3e7">LFSCK_NAMESPACE_MAGIC_V2</a>&nbsp;&nbsp;&nbsp;0xA0621A0B</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a82d42af0fc39bfd13ae79d2cefc87228">LFSCK_NAMESPACE_MAGIC</a>&nbsp;&nbsp;&nbsp;LFSCK_NAMESPACE_MAGIC_V2</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad1a9547330e31be9962c6d3b6a08cf87">lfsck_nameentry_check</a> { <a class="el" href="lfsck__namespace_8c.html#ad1a9547330e31be9962c6d3b6a08cf87a75dcfd4c9b74b219a76929f12f478532">LFSCK_NAMEENTRY_DEAD</a> =  1, 
<a class="el" href="lfsck__namespace_8c.html#ad1a9547330e31be9962c6d3b6a08cf87a6cb3e0557e2b26b4d791977d1daf4e22">LFSCK_NAMEENTRY_REMOVED</a> =  2, 
<a class="el" href="lfsck__namespace_8c.html#ad1a9547330e31be9962c6d3b6a08cf87a9670e05c5d595323ad79cd8da091f54a">LFSCK_NAMEENTRY_RECREATED</a> =  3
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlfsck__namespace__req.html">lfsck_namespace_req</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a7a32b814e4a5987e14ccb1369e1f7b84">lfsck_namespace_assistant_req_init</a> (struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *lfsck, struct <a class="el" href="structlfsck__assistant__object.html">lfsck_assistant_object</a> *lso, struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *ent, __u16 type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a9ffccbd64e91fd06e2a9c5767bc17191">lfsck_namespace_assistant_req_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__assistant__req.html">lfsck_assistant_req</a> *lar)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a37b9eff158775f8a482fb25382343af5">lfsck_namespace_le_to_cpu</a> (struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *dst, struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a305b08a2f4166bee61732a0c64296e3f">lfsck_namespace_cpu_to_le</a> (struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *dst, struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a349b9b3961df0a91f42b499c3abab2fc">lfsck_namespace_record_failure</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *lfsck, struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *ns)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a5711bbdc581dcec1c5088b0ffae352c5">lfsck_namespace_load_bitmap</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load the MDT bitmap from the <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> trace file.  <a href="#a5711bbdc581dcec1c5088b0ffae352c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a1e6d163cadde605f7e2873e9e6ec5813">lfsck_namespace_load</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load namespace LFSCK statistics information from the trace file.  <a href="#a1e6d163cadde605f7e2873e9e6ec5813"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a74273a76fe478a87236cf46e6ae119dd">lfsck_namespace_store</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a9e63fca987dc0d81727370fc252231a3">lfsck_namespace_load_one_trace_file</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bool reset)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ac493d3e42131fcf3d8000e59e40db534">lfsck_namespace_load_sub_trace_files</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, bool reset)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a05d06f560af974614737a05290553b46">lfsck_namespace_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad9e1b6d4d1e59c15c70f27ee5e2aa804">lfsck_namespace_trace_update</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, const __u8 flags, bool add)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the namespace LFSCK trace file for the given .  <a href="#ad9e1b6d4d1e59c15c70f27ee5e2aa804"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a85e6979b2c419199ab5aff81fe89fcd9">lfsck_namespace_check_exist</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *<a class="el" href="mdsrate_8c.html#a929b6cee0a8e867ee7380bf26947cef2">dir</a>, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a618a8ee469290e815f87aa15de828109">lfsck_declare_namespace_exec_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structthandle.html">thandle</a> *handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ae813731a3c21ac557857ceb6a94d2e2e">__lfsck_links_read</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#adfb08f2d55f4f6da3414e8382693f024">lfsck_namespace_links_remove</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove linkEA for the given object.  <a href="#adfb08f2d55f4f6da3414e8382693f024"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a1fd17a0728383078758cf519cd9b850c">lfsck_links_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structthandle.html">thandle</a> *handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a57465a4d86a6b06ac320b8f9e3c227f2">lfsck_namespace_unpack_linkea_entry</a> (struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlu__name.html">lu_name</a> *cname, struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, char *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a1d2cc4868b7e01d183e410580f9d7e03">lfsck_namespace_filter_linkea_entry</a> (struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlu__name.html">lu_name</a> *cname, struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, bool remove)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad708e8cbf0066910c33101b68ced4b13">lfsck_namespace_insert_orphan</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *orphan, const char *infix, const char *type, int *count)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert orphan into .lustre/lost+found/MDTxxxx/ locally.  <a href="#ad708e8cbf0066910c33101b68ced4b13"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a53b81d499b9b1b9690fcad51d21c1427">lfsck_namespace_insert_normal</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structdt__object.html">dt_object</a> *child, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add the specified name entry back to namespace.  <a href="#a53b81d499b9b1b9690fcad51d21c1427"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a4a450b87ff77309be1a4bf52fee1fc2d">lfsck_namespace_create_orphan_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *orphan, struct <a class="el" href="structlmv__mds__md__v1.html">lmv_mds_md_v1</a> *lmv)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create the specified orphan directory.  <a href="#a4a450b87ff77309be1a4bf52fee1fc2d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a72a7375c6ef2c14cd05a9a55ad3da1e8">lfsck_namespace_shrink_linkea</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlu__name.html">lu_name</a> *cname, struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, bool next)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove the specified entry from the linkEA.  <a href="#a72a7375c6ef2c14cd05a9a55ad3da1e8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a4822734b6aa13312b2a71d12ce4ab28f">lfsck_namespace_shrink_linkea_cond</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structdt__object.html">dt_object</a> *child, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlu__name.html">lu_name</a> *cname, struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Conditionally remove the specified entry from the linkEA.  <a href="#a4822734b6aa13312b2a71d12ce4ab28f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad283d8bb47b77c91603a1d7aa48429c2">lfsck_namespace_replace_cond</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structdt__object.html">dt_object</a> *child, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *cfid, const struct <a class="el" href="structlu__name.html">lu_name</a> *cname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Conditionally replace name entry in the parent.  <a href="#ad283d8bb47b77c91603a1d7aa48429c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a5e5221a7fc1e062d8b163cd4bb1789c5">lfsck_namespace_rebuild_linkea</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Overwrite the linkEA for the object with the given ldata.  <a href="#a5e5221a7fc1e062d8b163cd4bb1789c5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a7802d2fdae444eb243bebb9b92a8238a">lfsck_namespace_repair_dirent</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structdt__object.html">dt_object</a> *child, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const char *name2, __u16 type, bool update, bool dec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Repair invalid name entry.  <a href="#a7802d2fdae444eb243bebb9b92a8238a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad5af231029bc94278dfe1b3de62ed028">lfsck_namespace_repair_unmatched_pairs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, struct <a class="el" href="structlu__name.html">lu_name</a> *cname)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the ".." name entry for the given object.  <a href="#ad5af231029bc94278dfe1b3de62ed028"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a910102036ff7073f5ba4a5c3a93d070f">lfsck_namespace_dsd_orphan</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lh, enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *type)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle orphan  during Double Scan Directory.  <a href="#a910102036ff7073f5ba4a5c3a93d070f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a4fabce63d709dc7b848d14cb98ba4b49">lfsck_namespace_dsd_single</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *child, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lh, enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *type, bool *retry)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Double Scan Directory object for single linkEA entry case.  <a href="#a4fabce63d709dc7b848d14cb98ba4b49"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a5522cfa555ef445e721a3a7ea778e43a">lfsck_namespace_dsd_multiple</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *child, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid, struct <a class="el" href="structlinkea__data.html">linkea_data</a> *ldata, struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *lh, enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *type, bool lpf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Double Scan Directory object for multiple linkEA entries case.  <a href="#a5522cfa555ef445e721a3a7ea778e43a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a37a4d9f2ac5ee6c249ca3df8084c7492">lfsck_namespace_repair_nlink</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, struct <a class="el" href="structlu__attr.html">lu_attr</a> *la)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Repair the object's nlink attribute.  <a href="#a37a4d9f2ac5ee6c249ca3df8084c7492"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ae325f61d1cb5992dcfa9d517eee29246">lfsck_namespace_double_scan_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *child, __u8 flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Double scan the directory object for namespace LFSCK.  <a href="#ae325f61d1cb5992dcfa9d517eee29246"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad5bc2ba8f82ef41b2db07a6eab97de14">lfsck_namespace_double_scan_one</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *child, __u8 flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Double scan the MDT-object for namespace LFSCK.  <a href="#ad5bc2ba8f82ef41b2db07a6eab97de14"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a7c5175c8280843804a5ca390417ace53">lfsck_namespace_dump_statistics</a> (struct seq_file *m, struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *ns, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> checked_phase1, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> checked_phase2, __u32 time_phase1, __u32 time_phase2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a18699ca5aa4b2ed4f585d4d5bedc85e6">lfsck_namespace_release_lmv</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ada40ef96a7f56937374bd2da16368d4d">lfsck_namespace_check_for_double_scan</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ae158116b400b3d12724228b043761f7f">lfsck_namespace_reset</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, bool init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#af412aaf75ee32be7091bc2399affed67">lfsck_namespace_fail</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, bool new_checked)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a69ed57581ee5c277ba85f6ee64ed03ef">lfsck_namespace_close_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#abe2739624c3d1c8dd30afdb8a9812e4d">lfsck_namespace_open_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a9a60c074ced382fcecd77a3a73c1c77c">lfsck_namespace_checkpoint</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, bool init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ab2ee77ded1c034480fc269ac4fac1611">lfsck_namespace_prep</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__start__param.html">lfsck_start_param</a> *lsp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a75dee80f06cd10f45c480148b9cd5814">lfsck_namespace_exec_oit</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#aa63be6b0d3d407f18f23bb0ecb49ef75">lfsck_namespace_exec_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__assistant__object.html">lfsck_assistant_object</a> *lso, struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *ent, __u16 type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#afef1b3162903507c7adef97950a287c5">lfsck_namespace_post</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, int result, bool init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a17f11b589d37767bf7e639b0d57f5f90">lfsck_namespace_dump</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct seq_file *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a0d6ce687eca5ddba3a25a692a6a44f66">lfsck_namespace_double_scan</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a0be0aba17242ba44df760cf5da297c4d">lfsck_namespace_data_release</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#acddad66d7c5a987cbd5ea16fb9bf5ca9">lfsck_namespace_quit</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a9c7c8f304466860f4206d2054293b9a9">lfsck_namespace_in_notify</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *lr, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad7b062b63b886840e837319f427111d8">lfsck_namespace_repaired</a> (struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *ns, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad517fc62caf9881da7c0250d68c21a78">lfsck_namespace_query_all</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, __u32 *mdts_count, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *repaired)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad6f4495144243a75c74e39ce2644f797">lfsck_namespace_query</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *req, struct <a class="el" href="structlfsck__reply.html">lfsck_reply</a> *rep, struct <a class="el" href="structlfsck__query.html">lfsck_query</a> *que, int idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a499639286c429a090c0ba2f745b31363">lfsck_namespace_repair_dangling</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structdt__object.html">dt_object</a> *child, struct <a class="el" href="structlfsck__namespace__req.html">lfsck_namespace_req</a> *lnr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Repair dangling name entry.  <a href="#a499639286c429a090c0ba2f745b31363"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#aa516b1988fba812f0aaaac5d9b3f91e3">lfsck_namespace_assistant_handler_p1</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__assistant__req.html">lfsck_assistant_req</a> *lar)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ae11de1a13915ec51f3909ad805d87557">lfsck_namespace_scan_local_lpf_one</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *parent, struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *ent)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle one orphan under the backend /lost+found directory.  <a href="#ae11de1a13915ec51f3909ad805d87557"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a0483383299e60883a77f8f32ef785e95">lfsck_namespace_scan_local_lpf</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle orphans under the backend /lost+found directory.  <a href="#a0483383299e60883a77f8f32ef785e95"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a361e37f20f295dec3d297ed857d63eb0">lfsck_namespace_rescan_striped_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__lmv__unit.html">lfsck_lmv_unit</a> *llu)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rescan the striped directory after the master LMV EA reset.  <a href="#a361e37f20f295dec3d297ed857d63eb0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad0d5be77249b64e831d2018b418f3d91">lfsck_namespace_double_scan_one_trace_file</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, bool first)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a383cc51eaa18e5da6cdfd4c61433bb4d">lfsck_namespace_assistant_handler_p2</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#aed610ba73d60d4d5a123f21190efd1d4">lfsck_namespace_assistant_fill_pos</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__position.html">lfsck_position</a> *pos)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a52995e8f4dacd472d5177c77cd071de6">lfsck_namespace_double_scan_result</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, int rc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ac3d41c89e15343bfc2714a9506d29a34">lfsck_namespace_assistant_sync_failures_interpret</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, void *args, int rc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#ad1ea3a1f41c0dbb3831e08d0ae912776">lfsck_namespace_assistant_sync_failures</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *com, struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *lr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Notify remote LFSCK instances about former failures.  <a href="#ad1ea3a1f41c0dbb3831e08d0ae912776"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a10e7572a512be6782d27190bbe4f52cf">lfsck_verify_linkea</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, const struct <a class="el" href="structlu__name.html">lu_name</a> *cname, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify the specified linkEA entry for the given directory object.  <a href="#a10e7572a512be6782d27190bbe4f52cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a153a7a6d32e606e697c11f4054eedf1b">lfsck_links_get_first</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *obj, char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, struct <a class="el" href="structlu__fid.html">lu_fid</a> *pfid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the name and parent directory's FID from the first linkEA entry.  <a href="#a153a7a6d32e606e697c11f4054eedf1b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a3ab12cffcdd69732db02236b292c3e57">lfsck_update_name_entry</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *lfsck, struct <a class="el" href="structdt__object.html">dt_object</a> *<a class="el" href="mdsrate_8c.html#a929b6cee0a8e867ee7380bf26947cef2">dir</a>, const char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, __u32 type)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the object's name entry with the given FID.  <a href="#a3ab12cffcdd69732db02236b292c3e57"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a12be37000161af347ac970c78a35db56">lfsck_namespace_setup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *lfsck)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlfsck__operations.html">lfsck_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a22b695fa4b0249c401dc77e6a56d9a52">lfsck_namespace_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlfsck__assistant__operations.html">lfsck_assistant_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lfsck__namespace_8c.html#a3029bde916ae8c962df35eff77fcb1d8">lfsck_namespace_assistant_ops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="lfsck_namespace.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_LFSCK</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00031">31</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
<a class="anchor" id="a82d42af0fc39bfd13ae79d2cefc87228"></a><!-- doxytag: member="lfsck_namespace.c::LFSCK_NAMESPACE_MAGIC" ref="a82d42af0fc39bfd13ae79d2cefc87228" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LFSCK_NAMESPACE_MAGIC&nbsp;&nbsp;&nbsp;LFSCK_NAMESPACE_MAGIC_V2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00052">52</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l00495">lfsck_namespace_init()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00336">lfsck_namespace_load()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>.</p>

</div>
</div>
<a class="anchor" id="a19c2100412bfbb5ab9a17cf2d874d723"></a><!-- doxytag: member="lfsck_namespace.c::LFSCK_NAMESPACE_MAGIC_V1" ref="a19c2100412bfbb5ab9a17cf2d874d723" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LFSCK_NAMESPACE_MAGIC_V1&nbsp;&nbsp;&nbsp;0xA0629D03</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00044">44</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9c35746893230ac753c6bc1945a1f3e7"></a><!-- doxytag: member="lfsck_namespace.c::LFSCK_NAMESPACE_MAGIC_V2" ref="a9c35746893230ac753c6bc1945a1f3e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LFSCK_NAMESPACE_MAGIC_V2&nbsp;&nbsp;&nbsp;0xA0621A0B</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00045">45</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ad1a9547330e31be9962c6d3b6a08cf87"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_nameentry_check" ref="ad1a9547330e31be9962c6d3b6a08cf87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="lfsck__namespace_8c.html#ad1a9547330e31be9962c6d3b6a08cf87">lfsck_nameentry_check</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ad1a9547330e31be9962c6d3b6a08cf87a75dcfd4c9b74b219a76929f12f478532"></a><!-- doxytag: member="LFSCK_NAMEENTRY_DEAD" ref="ad1a9547330e31be9962c6d3b6a08cf87a75dcfd4c9b74b219a76929f12f478532" args="" -->LFSCK_NAMEENTRY_DEAD</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad1a9547330e31be9962c6d3b6a08cf87a6cb3e0557e2b26b4d791977d1daf4e22"></a><!-- doxytag: member="LFSCK_NAMEENTRY_REMOVED" ref="ad1a9547330e31be9962c6d3b6a08cf87a6cb3e0557e2b26b4d791977d1daf4e22" args="" -->LFSCK_NAMEENTRY_REMOVED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad1a9547330e31be9962c6d3b6a08cf87a9670e05c5d595323ad79cd8da091f54a"></a><!-- doxytag: member="LFSCK_NAMEENTRY_RECREATED" ref="ad1a9547330e31be9962c6d3b6a08cf87a9670e05c5d595323ad79cd8da091f54a" args="" -->LFSCK_NAMEENTRY_RECREATED</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00054">54</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae813731a3c21ac557857ceb6a94d2e2e"></a><!-- doxytag: member="lfsck_namespace.c::__lfsck_links_read" ref="ae813731a3c21ac557857ceb6a94d2e2e" args="(const struct lu_env *env, struct dt_object *obj, struct linkea_data *ldata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __lfsck_links_read </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00671">671</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="linkea_8c_source.html#l00047">linkea_init()</a>, <a class="el" href="lu__object_8c_source.html#l02333">LU_BUF_NULL</a>, <a class="el" href="lu__object_8c_source.html#l02362">lu_buf_realloc()</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, and <a class="el" href="lfsck__internal_8h_source.html#l01434">lfsck_links_read2()</a>.</p>

</div>
</div>
<a class="anchor" id="a618a8ee469290e815f87aa15de828109"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_declare_namespace_exec_dir" ref="a618a8ee469290e815f87aa15de828109" args="(const struct lu_env *env, struct dt_object *obj, struct thandle *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_declare_namespace_exec_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00653">653</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__linkea_8h_source.html#l00030">DEFAULT_LINKEA_SIZE</a>, <a class="el" href="dt__object_8h_source.html#l02514">dt_declare_xattr_del()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01123">lfsck_buf_get_const()</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>.</p>

</div>
</div>
<a class="anchor" id="a153a7a6d32e606e697c11f4054eedf1b"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_links_get_first" ref="a153a7a6d32e606e697c11f4054eedf1b" args="(const struct lu_env *env, struct dt_object *obj, char *name, struct lu_fid *pfid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_links_get_first </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the name and parent directory's FID from the first linkEA entry. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the object which get linkEA from </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>pointer to the buffer to hold the name in the first linkEA entry </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>pointer to the buffer to hold the parent directory's FID in the first linkEA entry</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06404">6404</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00042">linkea_data::ld_reclen</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="linkea_8c_source.html#l00097">linkea_entry_unpack()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00057">linkea_first_entry()</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>.</p>

<p>Referenced by <a class="el" href="lfsck__striped__dir_8c_source.html#l01672">lfsck_namespace_verify_stripe_slave()</a>, and <a class="el" href="lfsck__lib_8c_source.html#l01213">lfsck_verify_lpf_pairs()</a>.</p>

</div>
</div>
<a class="anchor" id="a1fd17a0728383078758cf519cd9b850c"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_links_write" ref="a1fd17a0728383078758cf519cd9b850c" args="(const struct lu_env *env, struct dt_object *obj, struct linkea_data *ldata, struct thandle *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_links_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00769">769</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l01123">lfsck_buf_get_const()</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>.</p>

</div>
</div>
<a class="anchor" id="aed610ba73d60d4d5a123f21190efd1d4"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_fill_pos" ref="aed610ba73d60d4d5a123f21190efd1d4" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_position *pos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_assistant_fill_pos </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__position.html">lfsck_position</a> *&nbsp;</td>
          <td class="paramname"> <em>pos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06153">6153</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00756">lfsck_assistant_req::lar_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00757">lfsck_assistant_req::lar_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lfsck__internal_8h_source.html#l00764">lfsck_namespace_req::lnr_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lfsck__internal_8h_source.html#l00079">lfsck_position::lp_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00076">lfsck_position::lp_dir_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00364">lfsck_assistant_object::lso_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00365">lfsck_assistant_object::lso_oit_cookie</a>, and <a class="el" href="list_8h_source.html#l00043">list_head::next</a>.</p>

</div>
</div>
<a class="anchor" id="aa516b1988fba812f0aaaac5d9b3f91e3"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_handler_p1" ref="aa516b1988fba812f0aaaac5d9b3f91e3" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_assistant_req *lar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_assistant_handler_p1 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__assistant__req.html">lfsck_assistant_req</a> *&nbsp;</td>
          <td class="paramname"> <em>lar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l05012">5012</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02203">dt_write_locked()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02529">dt_xattr_del()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="lustre__idl_8h_source.html#l00394">fid_seq_is_dot()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00427">lu_attr::la_nlink</a>, <a class="el" href="lfsck__internal_8h_source.html#l00842">lfsck_assistant_data::lad_advance_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00757">lfsck_assistant_req::lar_parent</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00061">LF_UPGRADE</a>, <a class="el" href="lfsck__lib_8c_source.html#l01982">lfsck_assistant_object_load()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00653">lfsck_declare_namespace_exec_dir()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01231">lfsck_dev_idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00526">lfsck_find_mdt_idx_by_fid()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00910">lfsck_is_valid_slave_name_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01403">lfsck_lad_set_bitmap()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00769">lfsck_links_write()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00494">lfsck_ltd2tgt()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01094">lfsck_name_get_const()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00628">lfsck_namespace_check_exist()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l02248">lfsck_namespace_handle_striped_master()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00238">lfsck_namespace_record_failure()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01473">lfsck_namespace_repair_bad_name_hash()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04790">lfsck_namespace_repair_dangling()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01990">lfsck_namespace_repair_dirent()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01817">lfsck_namespace_striped_dir_rescan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00525">lfsck_namespace_trace_update()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01247">lfsck_object_find_by_dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__lib_8c_source.html#l01796">lfsck_pos_fill()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01148">lfsck_pos_is_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="linkea_8c_source.html#l00171">linkea_links_find()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00601">lfsck_lmv::ll_lmv_master</a>, <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00172">lfsck_namespace::ln_items_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00202">lfsck_namespace::ln_mul_linked_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00128">LNIT_BAD_DIRENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00127">LNIT_BAD_TYPE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00125">LNIT_DANGLING</a>, <a class="el" href="lfsck__internal_8h_source.html#l00122">LNIT_NONE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00765">lfsck_namespace_req::lnr_attr</a>, <a class="el" href="lfsck__internal_8h_source.html#l00764">lfsck_namespace_req::lnr_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00763">lfsck_namespace_req::lnr_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lfsck__internal_8h_source.html#l00762">lfsck_namespace_req::lnr_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00769">lfsck_namespace_req::lnr_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00768">lfsck_namespace_req::lnr_namelen</a>, <a class="el" href="lfsck__internal_8h_source.html#l00767">lfsck_namespace_req::lnr_type</a>, <a class="el" href="lfsck__internal_8h_source.html#l00113">LNTF_CHECK_PARENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00114">LNTF_SKIP_NLINK</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00368">lfsck_assistant_object::lso_dead</a>, <a class="el" href="lfsck__internal_8h_source.html#l00364">lfsck_assistant_object::lso_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00448">lfsck_tgt_desc::ltd_tgt</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lustre__idl_8h_source.html#l00884">LUDA_REPAIR</a>, <a class="el" href="lustre__idl_8h_source.html#l00882">LUDA_UPGRADE</a>, <a class="el" href="lustre__idl_8h_source.html#l01021">lustre_handle_is_used()</a>, <a class="el" href="lustre__idl_8h_source.html#l00997">MDS_DIR_END_OFF</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, <a class="el" href="lfsck__internal_8h_source.html#l01072">name_is_dot_or_dotdot()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05869">lfsck_namespace_rescan_striped_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="a383cc51eaa18e5da6cdfd4c61433bb4d"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_handler_p2" ref="a383cc51eaa18e5da6cdfd4c61433bb4d" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_assistant_handler_p2 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06106">6106</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00559">lfsck_component::lc_new_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lfsck__internal_8h_source.html#l00548">lfsck_component::lc_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00551">lfsck_component::lc_time_next_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00051">LFSCK_CHECKPOINT_INTERVAL</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05977">lfsck_namespace_double_scan_one_trace_file()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05869">lfsck_namespace_rescan_striped_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05699">lfsck_namespace_scan_local_lpf()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00520">LFSCK_STF_COUNT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01453">lfsck_sub_trace_file_fid2idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00655">lfsck_instance::li_list_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00635">lfsck_instance::li_lock</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lfsck__internal_8h_source.html#l00619">lfsck_lmv_unit::llu_link</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a9ffccbd64e91fd06e2a9c5767bc17191"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_req_fini" ref="a9ffccbd64e91fd06e2a9c5767bc17191" args="(const struct lu_env *env, struct lfsck_assistant_req *lar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_assistant_req_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__assistant__req.html">lfsck_assistant_req</a> *&nbsp;</td>
          <td class="paramname"> <em>lar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00087">87</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00757">lfsck_assistant_req::lar_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l01487">lfsck_assistant_object_put()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00155">lfsck_lmv_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lfsck__internal_8h_source.html#l00762">lfsck_namespace_req::lnr_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00766">lfsck_namespace_req::lnr_size</a>, and <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03774">lfsck_namespace_close_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04094">lfsck_namespace_exec_dir()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l05869">lfsck_namespace_rescan_striped_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="a7a32b814e4a5987e14ccb1369e1f7b84"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_req_init" ref="a7a32b814e4a5987e14ccb1369e1f7b84" args="(struct lfsck_instance *lfsck, struct lfsck_assistant_object *lso, struct lu_dirent *ent, __u16 type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlfsck__namespace__req.html">lfsck_namespace_req</a>* lfsck_namespace_assistant_req_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *&nbsp;</td>
          <td class="paramname"> <em>lfsck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__assistant__object.html">lfsck_assistant_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lso</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *&nbsp;</td>
          <td class="paramname"> <em>ent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00061">61</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lfsck__internal_8h_source.html#l00756">lfsck_assistant_req::lar_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00757">lfsck_assistant_req::lar_parent</a>, <a class="el" href="lustre__idl_8h_source.html#l00908">lu_dirent::lde_attrs</a>, <a class="el" href="lustre__idl_8h_source.html#l00898">lu_dirent::lde_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l00900">lu_dirent::lde_hash</a>, <a class="el" href="lustre__idl_8h_source.html#l00913">lu_dirent::lde_name</a>, <a class="el" href="lustre__idl_8h_source.html#l00904">lu_dirent::lde_namelen</a>, <a class="el" href="lfsck__internal_8h_source.html#l01479">lfsck_assistant_object_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01445">lfsck_lmv_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00686">lfsck_instance::li_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00765">lfsck_namespace_req::lnr_attr</a>, <a class="el" href="lfsck__internal_8h_source.html#l00764">lfsck_namespace_req::lnr_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00763">lfsck_namespace_req::lnr_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lfsck__internal_8h_source.html#l00762">lfsck_namespace_req::lnr_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00769">lfsck_namespace_req::lnr_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00768">lfsck_namespace_req::lnr_namelen</a>, <a class="el" href="lfsck__internal_8h_source.html#l00766">lfsck_namespace_req::lnr_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00767">lfsck_namespace_req::lnr_type</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, and <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04094">lfsck_namespace_exec_dir()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l05869">lfsck_namespace_rescan_striped_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="ad1ea3a1f41c0dbb3831e08d0ae912776"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_sync_failures" ref="ad1ea3a1f41c0dbb3831e08d0ae912776" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_request *lr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_assistant_sync_failures </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *&nbsp;</td>
          <td class="paramname"> <em>lr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notify remote LFSCK instances about former failures. </p>
<p>The local LFSCK instance has recorded which MDTs have ever failed to respond some LFSCK verification requests (maybe because of <a class="el" href="structnetwork.html">network</a> issues or the MDT itself trouble). During the respond gap the MDT may missed some name entries verification, then the MDT cannot know whether related MDT-objects have been referenced by related name entries or not, then in the second-stage scanning, these MDT-objects will be regarded as orphan, if the MDT-object contains bad linkEA for back reference, then it will misguide the LFSCK to generate wrong name entry for repairing the orphan.</p>
<p>To avoid above trouble, when layout LFSCK finishes the first-stage scanning, it will scan the bitmap for the ever failed MDTs, and notify them that they have ever missed some name entries verification and should skip the handling for orphan MDT-objects.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lr</em>&nbsp;</td><td>pointer to the lfsck request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06245">6245</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00831">lfsck_assistant_data::lad_bitmap</a>, <a class="el" href="lfsck__internal_8h_source.html#l00837">lfsck_assistant_data::lad_incomplete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00833">lfsck_assistant_data::lad_touch_gen</a>, <a class="el" href="lfsck__internal_8h_source.html#l00741">lfsck_async_interpret_args::laia_ltd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__lib_8c_source.html#l02369">lfsck_async_request()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00494">lfsck_ltd2tgt()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l06210">lfsck_namespace_assistant_sync_failures_interpret()</a>, <a class="el" href="lustre__idl_8h_source.html#l02726">LFSCK_NOTIFY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03443">lfsck_request::lr_flags2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00450">lfsck_tgt_desc::ltd_exp</a>, <a class="el" href="lfsck__internal_8h_source.html#l00460">lfsck_tgt_desc::ltd_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00484">lfsck_tgt_descs::ltd_rw_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00880">lfsck_thread_info::lti_laia2</a>, <a class="el" href="client_8c_source.html#l00913">ptlrpc_prep_set()</a>, <a class="el" href="client_8c_source.html#l00973">ptlrpc_set_destroy()</a>, <a class="el" href="client_8c_source.html#l02260">ptlrpc_set_wait()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>.</p>

</div>
</div>
<a class="anchor" id="ac3d41c89e15343bfc2714a9506d29a34"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_sync_failures_interpret" ref="ac3d41c89e15343bfc2714a9506d29a34" args="(const struct lu_env *env, struct ptlrpc_request *req, void *args, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_assistant_sync_failures_interpret </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06210">6210</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00741">lfsck_async_interpret_args::laia_ltd</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00463">lfsck_tgt_desc::ltd_synced_failures</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06245">lfsck_namespace_assistant_sync_failures()</a>.</p>

</div>
</div>
<a class="anchor" id="a85e6979b2c419199ab5aff81fe89fcd9"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_check_exist" ref="a85e6979b2c419199ab5aff81fe89fcd9" args="(const struct lu_env *env, struct dt_object *dir, struct dt_object *obj, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_check_exist </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00628">628</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00055">LFSCK_NAMEENTRY_DEAD</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00057">LFSCK_NAMEENTRY_RECREATED</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00056">LFSCK_NAMEENTRY_REMOVED</a>, <a class="el" href="lfsck__internal_8h_source.html#l00862">lfsck_thread_info::lti_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l02248">lfsck_namespace_handle_striped_master()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l04790">lfsck_namespace_repair_dangling()</a>.</p>

</div>
</div>
<a class="anchor" id="ada40ef96a7f56937374bd2da16368d4d"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_check_for_double_scan" ref="ada40ef96a7f56937374bd2da16368d4d" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_check_for_double_scan </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03670">3670</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00427">lu_attr::la_nlink</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00525">lfsck_namespace_trace_update()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00112">LNTF_CHECK_LINKEA</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04005">lfsck_namespace_exec_oit()</a>.</p>

</div>
</div>
<a class="anchor" id="a9a60c074ced382fcecd77a3a73c1c77c"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_checkpoint" ref="a9a60c074ced382fcecd77a3a73c1c77c" args="(const struct lu_env *env, struct lfsck_component *com, bool init)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_checkpoint </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>init</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03866">3866</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00188">cfs_duration_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lfsck__internal_8h_source.html#l00050">HALF_SEC</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__lib_8c_source.html#l02531">lfsck_checkpoint_generic()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00684">lfsck_instance::li_pos_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00683">lfsck_instance::li_pos_current</a>, <a class="el" href="lfsck__internal_8h_source.html#l00662">lfsck_instance::li_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00160">lfsck_namespace::ln_pos_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00079">lfsck_position::lp_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00076">lfsck_position::lp_dir_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

</div>
</div>
<a class="anchor" id="a69ed57581ee5c277ba85f6ee64ed03ef"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_close_dir" ref="a69ed57581ee5c277ba85f6ee64ed03ef" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_close_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03774">3774</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lfsck__internal_8h_source.html#l00835">lfsck_assistant_data::lad_assistant_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00804">lfsck_assistant_data::lad_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00834">lfsck_assistant_data::lad_prefetched</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="lfsck__internal_8h_source.html#l00756">lfsck_assistant_req::lar_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00757">lfsck_assistant_req::lar_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__lib_8c_source.html#l01959">lfsck_assistant_object_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01445">lfsck_lmv_get()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00087">lfsck_namespace_assistant_req_fini()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00845">LFSCK_TMPBUF_LEN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00686">lfsck_instance::li_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00692">lfsck_instance::li_obj_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00683">lfsck_instance::li_pos_current</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00764">lfsck_namespace_req::lnr_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00763">lfsck_namespace_req::lnr_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lfsck__internal_8h_source.html#l00762">lfsck_namespace_req::lnr_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00766">lfsck_namespace_req::lnr_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="lustre__idl_8h_source.html#l00997">MDS_DIR_END_OFF</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, and <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>.</p>

</div>
</div>
<a class="anchor" id="a305b08a2f4166bee61732a0c64296e3f"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_cpu_to_le" ref="a305b08a2f4166bee61732a0c64296e3f" args="(struct lfsck_namespace *dst, struct lfsck_namespace *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_cpu_to_le </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>src</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00169">169</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="byteorder_8h_source.html#l00057">cpu_to_le32</a>, <a class="el" href="byteorder_8h_source.html#l00059">cpu_to_le64</a>, <a class="el" href="lustre__idl_8h_source.html#l00765">fid_cpu_to_le()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01193">lfsck_position_cpu_to_le()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00275">lfsck_namespace::ln_bitmap_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00178">lfsck_namespace::ln_dirs_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00175">lfsck_namespace::ln_items_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00172">lfsck_namespace::ln_items_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00237">lfsck_namespace::ln_local_lpf_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00231">lfsck_namespace::ln_local_lpf_moved</a>, <a class="el" href="lfsck__internal_8h_source.html#l00227">lfsck_namespace::ln_local_lpf_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00234">lfsck_namespace::ln_local_lpf_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, <a class="el" href="lfsck__internal_8h_source.html#l00202">lfsck_namespace::ln_mul_linked_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00187">lfsck_namespace::ln_objs_failed_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00184">lfsck_namespace::ln_objs_repaired_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00160">lfsck_namespace::ln_pos_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00249">lfsck_namespace::ln_striped_dirs_disabled</a>, <a class="el" href="lfsck__internal_8h_source.html#l00246">lfsck_namespace::ln_striped_dirs_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00243">lfsck_namespace::ln_striped_dirs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00240">lfsck_namespace::ln_striped_dirs_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00262">lfsck_namespace::ln_striped_shards_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00256">lfsck_namespace::ln_striped_shards_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00267">lfsck_namespace::ln_striped_shards_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00142">lfsck_namespace::ln_success_count</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00151">lfsck_namespace::ln_time_last_complete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00154">lfsck_namespace::ln_time_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00208">lfsck_namespace::ln_unknown_inconsistency</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a450b87ff77309be1a4bf52fee1fc2d"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_create_orphan_dir" ref="a4a450b87ff77309be1a4bf52fee1fc2d" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *orphan, struct lmv_mds_md_v1 *lmv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_create_orphan_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>orphan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlmv__mds__md__v1.html">lmv_mds_md_v1</a> *&nbsp;</td>
          <td class="paramname"> <em>lmv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create the specified orphan directory. </p>
<p>For the case that the parent MDT-object stored in some MDT-object's linkEA entry is lost, the LFSCK will re-create the parent object as an orphan and insert it into .lustre/lost+found/MDTxxxx/ directory with the name ${FID}-P-${conflict_version}.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>orphan</em>&nbsp;</td><td>pointer to the orphan MDT-object to be created </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lmv</em>&nbsp;</td><td>pointer to master LMV EA that will be set to the orphan</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01226">1226</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="structdt__object__operations.html#a00fed99bee94890d3e36719af00d5595">dt_object_operations::do_ah_init</a>, <a class="el" href="dt__object_8h_source.html#l01751">dt_object::do_ops</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="lfsck__lib_8c_source.html#l00542">dot</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02120">dt_create()</a>, <a class="el" href="dt__object_8h_source.html#l02103">dt_declare_create()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00450">LA_GID</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00445">LA_MTIME</a>, <a class="el" href="lu__object_8h_source.html#l00452">LA_TYPE</a>, <a class="el" href="lu__object_8h_source.html#l00449">LA_UID</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01231">lfsck_dev_idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01254">lfsck_find_dev_by_fid()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00526">lfsck_find_mdt_idx_by_fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01468">lfsck_lmv_header_cpu_to_le()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00678">lfsck_instance::li_lpf_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00679">lfsck_instance::li_lpf_root_obj</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="lustre__idl_8h_source.html#l02597">LMV_MAGIC</a>, <a class="el" href="lustre__idl_8h_source.html#l02577">lmv_mds_md_v1::lmv_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l02579">lmv_mds_md_v1::lmv_master_mdt_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00873">lfsck_thread_info::lti_dof</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00890">lfsck_thread_info::lti_hint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lfsck__internal_8h_source.html#l00860">lfsck_thread_info::lti_linkea_buf2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lfsck__internal_8h_source.html#l00897">lfsck_thread_info::lti_lmv2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00857">lfsck_thread_info::lti_name2</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>, and <a class="el" href="lustre__idl_8h_source.html#l01596">XATTR_NAME_LMV</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a0be0aba17242ba44df760cf5da297c4d"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_data_release" ref="a0be0aba17242ba44df760cf5da297c4d" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_data_release </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04406">4406</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00072">CFS_FREE_BITMAP</a>, <a class="el" href="lfsck__internal_8h_source.html#l00831">lfsck_assistant_data::lad_bitmap</a>, <a class="el" href="lfsck__internal_8h_source.html#l00817">lfsck_assistant_data::lad_mdt_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00820">lfsck_assistant_data::lad_mdt_phase1_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00823">lfsck_assistant_data::lad_mdt_phase2_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03647">lfsck_namespace_release_lmv()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lfsck__internal_8h_source.html#l00481">lfsck_tgt_descs::ltd_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00453">lfsck_tgt_desc::ltd_namespace_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00454">lfsck_tgt_desc::ltd_namespace_phase_list</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__net_8h_source.html#l01537">thread_is_init()</a>, and <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d6ce687eca5ddba3a25a692a6a44f66"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_double_scan" ref="a0d6ce687eca5ddba3a25a692a6a44f66" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_double_scan </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04380">4380</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00820">lfsck_assistant_data::lad_mdt_phase1_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00823">lfsck_assistant_data::lad_mdt_phase2_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__lib_8c_source.html#l02580">lfsck_double_scan_generic()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00481">lfsck_tgt_descs::ltd_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00454">lfsck_tgt_desc::ltd_namespace_phase_list</a>, and <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>.</p>

</div>
</div>
<a class="anchor" id="ae325f61d1cb5992dcfa9d517eee29246"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_double_scan_dir" ref="ae325f61d1cb5992dcfa9d517eee29246" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *child, __u8 flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_double_scan_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u8&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Double scan the directory object for namespace LFSCK. </p>
<p>This function will verify the &lt;parent, child&gt; pairs in the namespace tree: the parent references the child via some name entry that should be in the child's linkEA entry, the child should back references the parent via its ".." name entry.</p>
<p>The LFSCK will scan every linkEA entry in turn until find out the first matched pairs. If found, then all other linkEA entries will be dropped. If all the linkEA entries cannot match the ".." name entry, then there are serveral possible cases:</p>
<p>1) If there is only one linkEA entry, then trust it as long as the PFID in the linkEA entry is valid.</p>
<p>2) If there are multiple linkEA entries, then try to find the linkEA that matches the ".." name entry. If found, then all other entries are invalid; otherwise, it is quite possible that the ".." name entry is corrupted. Under such case, the LFSCK will rebuild the ".." name entry according to the first valid linkEA entry (both the parent and the name entry should exist).</p>
<p>3) If the directory object has no (valid) linkEA entry, then the directory object will be handled as pure orphan and inserted in the .lustre/lost+found/MDTxxxx/ with the name: ${self_FID}-${PFID}-D-${conflict_version}</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the directory object to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>flags</em>&nbsp;</td><td>to indicate the specical checking on the </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02990">2990</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02263">lfsck_namespace_dsd_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00861">lfsck_namespace_insert_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00714">lfsck_namespace_links_remove()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01545">lfsck_namespace_scan_shard()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00678">lfsck_instance::li_lpf_obj</a>, <a class="el" href="lustre__linkea_8h_source.html#l00057">linkea_first_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00256">lfsck_namespace::ln_striped_shards_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00267">lfsck_namespace::ln_striped_shards_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00208">lfsck_namespace::ln_unknown_inconsistency</a>, <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00123">LNIT_BAD_LINKEA</a>, <a class="el" href="lfsck__internal_8h_source.html#l00126">LNIT_MUL_REF</a>, <a class="el" href="lfsck__internal_8h_source.html#l00124">LNIT_UNMATCHED_PAIRS</a>, <a class="el" href="lfsck__internal_8h_source.html#l00112">LNTF_CHECK_LINKEA</a>, <a class="el" href="lfsck__internal_8h_source.html#l00113">LNTF_CHECK_PARENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00117">LNTF_RECHECK_NAME_HASH</a>, <a class="el" href="lfsck__internal_8h_source.html#l00116">LNTF_UNCERTAIN_LMV</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00145">LPF_ALL_TGT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00863">lfsck_thread_info::lti_fid2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00876">lfsck_thread_info::lti_tmpbuf</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l01021">lustre_handle_is_used()</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>.</p>

</div>
</div>
<a class="anchor" id="ad5bc2ba8f82ef41b2db07a6eab97de14"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_double_scan_one" ref="ad5bc2ba8f82ef41b2db07a6eab97de14" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *child, __u8 flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_double_scan_one </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u8&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Double scan the MDT-object for namespace LFSCK. </p>
<p>If the MDT-object contains invalid or repeated linkEA entries, then drop those entries from the linkEA; if the linkEA becomes empty or the object has no linkEA, then it is an orphan and will be added into the directory .lustre/lost+found/MDTxxxx/; if the remote parent is lost, then recreate the remote parent; if the name entry corresponding to some linkEA entry is lost, then add the name entry back to the namespace.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>flags</em>&nbsp;</td><td>some hints to indicate how the  should be handled</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03220">3220</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00427">lu_attr::la_nlink</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00948">lfsck_namespace_check_name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01226">lfsck_namespace_create_orphan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00791">lfsck_namespace_filter_linkea_entry()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01092">lfsck_namespace_insert_normal()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00861">lfsck_namespace_insert_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02853">lfsck_namespace_repair_nlink()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01711">lfsck_namespace_replace_cond()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01498">lfsck_namespace_shrink_linkea()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01624">lfsck_namespace_shrink_linkea_cond()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00779">lfsck_namespace_unpack_linkea_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00057">linkea_first_entry()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00068">linkea_next_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00862">lfsck_thread_info::lti_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00863">lfsck_thread_info::lti_fid2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05977">lfsck_namespace_double_scan_one_trace_file()</a>.</p>

</div>
</div>
<a class="anchor" id="ad0d5be77249b64e831d2018b418f3d91"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_double_scan_one_trace_file" ref="ad0d5be77249b64e831d2018b418f3d91" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, bool first)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_double_scan_one_trace_file </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>first</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l05977">5977</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00188">cfs_duration_sec()</a>, <a class="el" href="libcfs__fail_8h_source.html#l00139">CFS_FAIL_TIMEOUT</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="linux-time_8h_source.html#l00147">cfs_time_beforeq()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="structdt__index__operations.html#a16b19879e71b5cb1aaa459d731d580cb">dt_index_operations::dio_it</a>, <a class="el" href="dt__object_8h_source.html#l01753">dt_object::do_index_ops</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00786">fid_be_to_cpu()</a>, <a class="el" href="lustre__idl_8h_source.html#l00779">fid_cpu_to_be()</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00050">HALF_SEC</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00559">lfsck_component::lc_new_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00548">lfsck_component::lc_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00551">lfsck_component::lc_time_next_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00051">LFSCK_CHECKPOINT_INTERVAL</a>, <a class="el" href="lfsck__lib_8c_source.html#l01874">lfsck_control_speed_by_self()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00659">lfsck_instance::li_thread</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00187">lfsck_namespace::ln_objs_failed_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00184">lfsck_namespace::ln_objs_repaired_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="obd__support_8h_source.html#l00525">OBD_FAIL_LFSCK_DELAY3</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06106">lfsck_namespace_assistant_handler_p2()</a>.</p>

</div>
</div>
<a class="anchor" id="a52995e8f4dacd472d5177c77cd071de6"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_double_scan_result" ref="a52995e8f4dacd472d5177c77cd071de6" args="(const struct lu_env *env, struct lfsck_component *com, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_double_scan_result </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06171">6171</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00188">cfs_duration_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00050">HALF_SEC</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00548">lfsck_component::lc_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00055">LF_SCANNED_ONCE</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00725">lfsck_instance::li_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00142">lfsck_namespace::ln_success_count</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00151">lfsck_namespace::ln_time_last_complete</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00080">LS_COMPLETED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00083">LS_FAILED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00097">LS_PARTIAL</a>, and <a class="el" href="lustre__lfsck__user_8h_source.html#l00086">LS_STOPPED</a>.</p>

</div>
</div>
<a class="anchor" id="a5522cfa555ef445e721a3a7ea778e43a"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_dsd_multiple" ref="a5522cfa555ef445e721a3a7ea778e43a" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *child, const struct lu_fid *pfid, struct linkea_data *ldata, struct lustre_handle *lh, enum lfsck_namespace_inconsistency_type *type, bool lpf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_dsd_multiple </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>lpf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Double Scan Directory object for multiple linkEA entries case. </p>
<p>The given  has multiple linkEA entries. There is at most one linkEA entry will be valid, all the others will be removed. Firstly, the function will try to find out the linkEA entry for which the name entry exists under the given parent (). If there is no linkEA entry that matches the given ".." name entry, then tries to find out the first linkEA entry that both the parent and the name entry exist to rebuild a new ".." name entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the directory to be double scanned </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the FID corresponding to the ".." entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ldata</em>&nbsp;</td><td>pointer to the linkEA data for the given  </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lh</em>&nbsp;</td><td>ldlm lock handler for the given  </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>to tell the caller what the inconsistency is </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lpf</em>&nbsp;</td><td>true if the ".." entry is under lost+found/MDTxxxx/</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02604">2604</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02263">lfsck_namespace_dsd_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00791">lfsck_namespace_filter_linkea_entry()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01910">lfsck_namespace_rebuild_linkea()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01990">lfsck_namespace_repair_dirent()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02147">lfsck_namespace_repair_unmatched_pairs()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01711">lfsck_namespace_replace_cond()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00779">lfsck_namespace_unpack_linkea_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="linkea_8c_source.html#l00142">linkea_del_buf()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00057">linkea_first_entry()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00068">linkea_next_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00124">LNIT_UNMATCHED_PAIRS</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00861">lfsck_thread_info::lti_big_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00864">lfsck_thread_info::lti_fid3</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>.</p>

</div>
</div>
<a class="anchor" id="a910102036ff7073f5ba4a5c3a93d070f"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_dsd_orphan" ref="a910102036ff7073f5ba4a5c3a93d070f" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, const struct lu_fid *pfid, struct lustre_handle *lh, enum lfsck_namespace_inconsistency_type *type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_dsd_orphan </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle orphan  during Double Scan Directory. </p>
<p>Remove the 's current (invalid) linkEA entries, and insert it in the directory .lustre/lost+found/MDTxxxx/ with the name: ${FID}-${PFID}-D-${conflict_version}</p>
<p>The caller should take the ldlm lock before the calling.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the orphan object to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the new fid for the object's ".." name entry </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lh</em>&nbsp;</td><td>ldlm lock handler for the given  </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>to tell the caller what the inconsistency is</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02263">2263</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00861">lfsck_namespace_insert_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00714">lfsck_namespace_links_remove()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00126">LNIT_MUL_REF</a>, <a class="el" href="lfsck__internal_8h_source.html#l00876">lfsck_thread_info::lti_tmpbuf</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a4fabce63d709dc7b848d14cb98ba4b49"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_dsd_single" ref="a4fabce63d709dc7b848d14cb98ba4b49" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *child, const struct lu_fid *pfid, struct linkea_data *ldata, struct lustre_handle *lh, enum lfsck_namespace_inconsistency_type *type, bool *retry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_dsd_single </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__handle.html">lustre_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="lfsck__internal_8h.html#af23e062ce2b323adb6d73b5694a10e73">lfsck_namespace_inconsistency_type</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&nbsp;</td>
          <td class="paramname"> <em>retry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Double Scan Directory object for single linkEA entry case. </p>
<p>The given  has unique linkEA entry. If the linkEA entry is valid, then check whether the name is in the namespace or not, if not, add the missing name entry back to namespace. If the linkEA entry is invalid, then remove it and insert the  in the .lustre/lost+found/MDTxxxx/ as an orphan.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the directory to be double scanned </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the FID corresponding to the ".." entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ldata</em>&nbsp;</td><td>pointer to the linkEA data for the given  </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lh</em>&nbsp;</td><td>ldlm lock handler for the given  </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>to tell the caller what the inconsistency is </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>retry</em>&nbsp;</td><td>if found inconsistency, but the caller does not hold ldlm lock on the , then set  as true</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02328">2328</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00948">lfsck_namespace_check_name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01226">lfsck_namespace_create_orphan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02263">lfsck_namespace_dsd_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01092">lfsck_namespace_insert_normal()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00861">lfsck_namespace_insert_orphan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02147">lfsck_namespace_repair_unmatched_pairs()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01711">lfsck_namespace_replace_cond()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01498">lfsck_namespace_shrink_linkea()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01624">lfsck_namespace_shrink_linkea_cond()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00779">lfsck_namespace_unpack_linkea_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00841">lfsck_read_stripe_lmv()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00880">lfsck_shard_name_to_index()</a>, <a class="el" href="lustre__idl_8h_source.html#l02577">lmv_mds_md_v1::lmv_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l02600">LMV_MAGIC_STRIPE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>, <a class="el" href="lfsck__internal_8h_source.html#l00124">LNIT_UNMATCHED_PAIRS</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l00896">lfsck_thread_info::lti_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00876">lfsck_thread_info::lti_tmpbuf</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l01021">lustre_handle_is_used()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>.</p>

</div>
</div>
<a class="anchor" id="a17f11b589d37767bf7e639b0d57f5f90"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_dump" ref="a17f11b589d37767bf7e639b0d57f5f90" args="(const struct lu_env *env, struct lfsck_component *com, struct seq_file *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_dump </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04209">4209</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="linux-time_8h_source.html#l00188">cfs_duration_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="structdt__index__operations.html#a16b19879e71b5cb1aaa459d731d580cb">dt_index_operations::dio_it</a>, <a class="el" href="dt__object_8h_source.html#l01753">dt_object::do_index_ops</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00050">HALF_SEC</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00087">lfsck_bookmark::lb_version</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00548">lfsck_component::lc_time_last_checkpoint</a>, <a class="el" href="lfsck__lib_8c_source.html#l01741">lfsck_bits_dump()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00071">lfsck_flags_names</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03568">lfsck_namespace_dump_statistics()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00080">lfsck_param_names</a>, <a class="el" href="lfsck__lib_8c_source.html#l01779">lfsck_pos_dump()</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00111">lfsck_status2name()</a>, <a class="el" href="lfsck__lib_8c_source.html#l01767">lfsck_time_dump()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00707">lfsck_instance::li_cookie_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00730">lfsck_instance::li_current_oit_processed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00698">lfsck_instance::li_di_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00695">lfsck_instance::li_di_oit</a>, <a class="el" href="lfsck__internal_8h_source.html#l00635">lfsck_instance::li_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00692">lfsck_instance::li_obj_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00689">lfsck_instance::li_obj_oit</a>, <a class="el" href="lfsck__internal_8h_source.html#l00662">lfsck_instance::li_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00160">lfsck_namespace::ln_pos_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00151">lfsck_namespace::ln_time_last_complete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00154">lfsck_namespace::ln_time_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00079">lfsck_position::lp_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00076">lfsck_position::lp_dir_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00073">LS_SCANNING_PHASE1</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00077">LS_SCANNING_PHASE2</a>, <a class="el" href="lustre__idl_8h_source.html#l00997">MDS_DIR_END_OFF</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

</div>
</div>
<a class="anchor" id="a7c5175c8280843804a5ca390417ace53"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_dump_statistics" ref="a7c5175c8280843804a5ca390417ace53" args="(struct seq_file *m, struct lfsck_namespace *ns, __u64 checked_phase1, __u64 checked_phase2, __u32 time_phase1, __u32 time_phase2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_dump_statistics </td>
          <td>(</td>
          <td class="paramtype">struct seq_file *&nbsp;</td>
          <td class="paramname"> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>checked_phase1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>checked_phase2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>time_phase1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>time_phase2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03568">3568</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00178">lfsck_namespace::ln_dirs_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00175">lfsck_namespace::ln_items_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00172">lfsck_namespace::ln_items_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00237">lfsck_namespace::ln_local_lpf_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00231">lfsck_namespace::ln_local_lpf_moved</a>, <a class="el" href="lfsck__internal_8h_source.html#l00227">lfsck_namespace::ln_local_lpf_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00234">lfsck_namespace::ln_local_lpf_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00202">lfsck_namespace::ln_mul_linked_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00187">lfsck_namespace::ln_objs_failed_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00184">lfsck_namespace::ln_objs_repaired_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00249">lfsck_namespace::ln_striped_dirs_disabled</a>, <a class="el" href="lfsck__internal_8h_source.html#l00246">lfsck_namespace::ln_striped_dirs_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00243">lfsck_namespace::ln_striped_dirs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00240">lfsck_namespace::ln_striped_dirs_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00262">lfsck_namespace::ln_striped_shards_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00256">lfsck_namespace::ln_striped_shards_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00267">lfsck_namespace::ln_striped_shards_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00142">lfsck_namespace::ln_success_count</a>, <a class="el" href="lfsck__internal_8h_source.html#l00208">lfsck_namespace::ln_unknown_inconsistency</a>, <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>, and <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04209">lfsck_namespace_dump()</a>.</p>

</div>
</div>
<a class="anchor" id="aa63be6b0d3d407f18f23bb0ecb49ef75"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_exec_dir" ref="aa63be6b0d3d407f18f23bb0ecb49ef75" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_assistant_object *lso, struct lu_dirent *ent, __u16 type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_exec_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__assistant__object.html">lfsck_assistant_object</a> *&nbsp;</td>
          <td class="paramname"> <em>lso</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *&nbsp;</td>
          <td class="paramname"> <em>ent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04094">4094</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lfsck__internal_8h_source.html#l00835">lfsck_assistant_data::lad_assistant_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00804">lfsck_assistant_data::lad_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00834">lfsck_assistant_data::lad_prefetched</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="lfsck__internal_8h_source.html#l00756">lfsck_assistant_req::lar_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00096">lfsck_bookmark::lb_async_windows</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00087">lfsck_namespace_assistant_req_fini()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00061">lfsck_namespace_assistant_req_init()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00238">lfsck_namespace_record_failure()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00692">lfsck_instance::li_obj_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00659">lfsck_instance::li_thread</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00761">lfsck_namespace_req::lnr_lar</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a75dee80f06cd10f45c480148b9cd5814"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_exec_oit" ref="a75dee80f06cd10f45c480148b9cd5814" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_exec_oit </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04005">4005</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="fld__handler_8c_source.html#l00205">fld_local_lookup()</a>, <a class="el" href="seq__range_8h_source.html#l00091">fld_range_set_mdt()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__linkea_8h_source.html#l00042">linkea_data::ld_reclen</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l01231">lfsck_dev_idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01226">lfsck_dev_site()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03670">lfsck_namespace_check_for_double_scan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00714">lfsck_namespace_links_remove()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00238">lfsck_namespace_record_failure()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00525">lfsck_namespace_trace_update()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="linkea_8c_source.html#l00097">linkea_entry_unpack()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00057">linkea_first_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00178">lfsck_namespace::ln_dirs_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00112">LNTF_CHECK_LINKEA</a>, <a class="el" href="lfsck__internal_8h_source.html#l00113">LNTF_CHECK_PARENT</a>, <a class="el" href="lustre__idl_8h_source.html#l00156">lu_seq_range::lsr_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00863">lfsck_thread_info::lti_fid2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00895">lfsck_thread_info::lti_range</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

</div>
</div>
<a class="anchor" id="af412aaf75ee32be7091bc2399affed67"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_fail" ref="af412aaf75ee32be7091bc2399affed67" args="(const struct lu_env *env, struct lfsck_component *com, bool new_checked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_fail </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>new_checked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03762">3762</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l00238">lfsck_namespace_record_failure()</a>.</p>

</div>
</div>
<a class="anchor" id="a1d2cc4868b7e01d183e410580f9d7e03"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_filter_linkea_entry" ref="a1d2cc4868b7e01d183e410580f9d7e03" args="(struct linkea_data *ldata, struct lu_name *cname, struct lu_fid *pfid, bool remove)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_filter_linkea_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>remove</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00791">791</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00042">linkea_data::ld_reclen</a>, <a class="el" href="lustre__idl_8h_source.html#l03686">link_ea_entry::lee_reclen</a>, <a class="el" href="linkea_8c_source.html#l00142">linkea_del_buf()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00068">linkea_next_entry()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l01498">lfsck_namespace_shrink_linkea()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c7c8f304466860f4206d2054293b9a9"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_in_notify" ref="a9c7c8f304466860f4206d2054293b9a9" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_request *lr, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_in_notify </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *&nbsp;</td>
          <td class="paramname"> <em>lr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04473">4473</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00779">fid_cpu_to_be()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00817">lfsck_assistant_data::lad_mdt_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00823">lfsck_assistant_data::lad_mdt_phase2_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lustre__idl_8h_source.html#l03466">LE_PEER_EXIT</a>, <a class="el" href="lustre__idl_8h_source.html#l03460">LE_PHASE1_DONE</a>, <a class="el" href="lustre__idl_8h_source.html#l03461">LE_PHASE2_DONE</a>, <a class="el" href="lustre__idl_8h_source.html#l03471">LE_SET_LMV_MASTER</a>, <a class="el" href="lustre__idl_8h_source.html#l03472">LE_SET_LMV_SLAVE</a>, <a class="el" href="lustre__idl_8h_source.html#l03470">LE_SKIP_NLINK</a>, <a class="el" href="lustre__idl_8h_source.html#l03469">LE_SKIP_NLINK_DECLARE</a>, <a class="el" href="lustre__idl_8h_source.html#l03480">LEF_RECHECK_NAME_HASH</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00494">lfsck_ltd2tgt()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01264">lfsck_namespace_notify_lmv_master_local()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00525">lfsck_namespace_trace_update()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01283">lfsck_object_find_bottom()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01396">lfsck_phase2_next_ready()</a>, <a class="el" href="lfsck__lib_8c_source.html#l03213">lfsck_stop()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01453">lfsck_sub_trace_file_fid2idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00117">LNTF_RECHECK_NAME_HASH</a>, <a class="el" href="lfsck__internal_8h_source.html#l00114">LNTF_SKIP_NLINK</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00148">LPF_BROADCAST</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="lustre__idl_8h_source.html#l03430">lfsck_request::lr_event</a>, <a class="el" href="lustre__idl_8h_source.html#l03444">lfsck_request::lr_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l03432">lfsck_request::lr_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03443">lfsck_request::lr_flags2</a>, <a class="el" href="lustre__idl_8h_source.html#l03431">lfsck_request::lr_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03441">lfsck_request::lr_param</a>, <a class="el" href="lustre__idl_8h_source.html#l03436">lfsck_request::lr_status</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00219">lfsck_stop::ls_flags</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00218">lfsck_stop::ls_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00524">lfsck_sub_trace_obj::lsto_mutex</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00460">lfsck_tgt_desc::ltd_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00481">lfsck_tgt_descs::ltd_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00463">lfsck_tgt_desc::ltd_namespace_done</a>, <a class="el" href="lfsck__internal_8h_source.html#l00453">lfsck_tgt_desc::ltd_namespace_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00454">lfsck_tgt_desc::ltd_namespace_phase_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00864">lfsck_thread_info::lti_fid3</a>, <a class="el" href="lfsck__internal_8h_source.html#l00882">lfsck_thread_info::lti_stop</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>.</p>

</div>
</div>
<a class="anchor" id="a05d06f560af974614737a05290553b46"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_init" ref="a05d06f560af974614737a05290553b46" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00495">495</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00460">lfsck_namespace_load_sub_trace_files()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00052">LFSCK_NAMESPACE_MAGIC</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, and <a class="el" href="lustre__lfsck__user_8h_source.html#l00069">LS_INIT</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06514">lfsck_namespace_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a53b81d499b9b1b9690fcad51d21c1427"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_insert_normal" ref="a53b81d499b9b1b9690fcad51d21c1427" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct dt_object *child, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_insert_normal </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add the specified name entry back to namespace. </p>
<p>If there is a linkEA entry that back references a name entry under some parent directory, but such parent directory does not have the claimed name entry. On the other hand, the linkEA entries count is not larger than the MDT-object's hard link count. Under such case, it is quite possible that the name entry is lost. Then the LFSCK should add the name entry back to the namespace.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the directory under which the name entry will be inserted into </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the object referenced by the name entry that to be inserted into the parent </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>the name for the child in the parent directory</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01092">1092</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01310">lfsck_object_locate()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00669">lfsck_instance::li_next</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="ad708e8cbf0066910c33101b68ced4b13"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_insert_orphan" ref="ad708e8cbf0066910c33101b68ced4b13" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *orphan, const char *infix, const char *type, int *count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_insert_orphan </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>orphan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>infix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert orphan into .lustre/lost+found/MDTxxxx/ locally. </p>
<p>Add the specified orphan MDT-object to the .lustre/lost+found/MDTxxxx/ with the given type to generate the name, the detailed rules for name have been described as following.</p>
<p>The function also generates the linkEA corresponding to the name entry under the .lustre/lost+found/MDTxxxx/ for the orphan MDT-object.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>orphan</em>&nbsp;</td><td>pointer to the orphan MDT-object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>infix</em>&nbsp;</td><td>additional information for the orphan name, such as the FID for original </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>the type for describing why the orphan MDT-object is created. The rules are as following:</td></tr>
  </table>
  </dd>
</dl>
<p>type "D": The MDT-object is a directory, it may knows its parent but because there is no valid linkEA, the LFSCK cannot know where to put it back to the namespace. type "O": The MDT-object has no linkEA, and there is no name entry that references the MDT-object.</p>
<p>type "S": The orphan MDT-object is a shard of a striped directory</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="lfsck__layout_8c.html#a35a20296cb4b7c7e0095b01f2ed15ece" title="This function will create the MDT-object with the given (partial) LOV EA.">lfsck_layout_recreate_parent()</a> for more types.</dd></dl>
<p>The orphan name will be like: ${FID}-${infix}-${type}-${conflict_version}</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>count</em>&nbsp;</td><td>if some others inserted some linkEA entries by race, then return the linkEA entries count.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if needs to repair nothing </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00861">861</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00678">lfsck_instance::li_lpf_obj</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l00866">lfsck_thread_info::lti_la2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00860">lfsck_thread_info::lti_linkea_buf2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lfsck__internal_8h_source.html#l00856">lfsck_thread_info::lti_name</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l02076">MDS_INODELOCK_LOOKUP</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02263">lfsck_namespace_dsd_orphan()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a37b9eff158775f8a482fb25382343af5"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_le_to_cpu" ref="a37b9eff158775f8a482fb25382343af5" args="(struct lfsck_namespace *dst, struct lfsck_namespace *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_le_to_cpu </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>src</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00100">100</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l00772">fid_le_to_cpu()</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lfsck__internal_8h_source.html#l01185">lfsck_position_le_to_cpu()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00275">lfsck_namespace::ln_bitmap_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00178">lfsck_namespace::ln_dirs_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00175">lfsck_namespace::ln_items_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00172">lfsck_namespace::ln_items_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00237">lfsck_namespace::ln_local_lpf_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00231">lfsck_namespace::ln_local_lpf_moved</a>, <a class="el" href="lfsck__internal_8h_source.html#l00227">lfsck_namespace::ln_local_lpf_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00234">lfsck_namespace::ln_local_lpf_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, <a class="el" href="lfsck__internal_8h_source.html#l00202">lfsck_namespace::ln_mul_linked_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00187">lfsck_namespace::ln_objs_failed_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00184">lfsck_namespace::ln_objs_repaired_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00160">lfsck_namespace::ln_pos_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00249">lfsck_namespace::ln_striped_dirs_disabled</a>, <a class="el" href="lfsck__internal_8h_source.html#l00246">lfsck_namespace::ln_striped_dirs_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00243">lfsck_namespace::ln_striped_dirs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00240">lfsck_namespace::ln_striped_dirs_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00262">lfsck_namespace::ln_striped_shards_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00256">lfsck_namespace::ln_striped_shards_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00267">lfsck_namespace::ln_striped_shards_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00142">lfsck_namespace::ln_success_count</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00151">lfsck_namespace::ln_time_last_complete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00154">lfsck_namespace::ln_time_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00208">lfsck_namespace::ln_unknown_inconsistency</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l00336">lfsck_namespace_load()</a>.</p>

</div>
</div>
<a class="anchor" id="adfb08f2d55f4f6da3414e8382693f024"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_links_remove" ref="adfb08f2d55f4f6da3414e8382693f024" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_links_remove </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove linkEA for the given object. </p>
<p>The caller should take the ldlm lock before the calling.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00714">714</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02514">dt_declare_xattr_del()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02529">dt_xattr_del()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02990">lfsck_namespace_double_scan_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02263">lfsck_namespace_dsd_orphan()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l04005">lfsck_namespace_exec_oit()</a>.</p>

</div>
</div>
<a class="anchor" id="a1e6d163cadde605f7e2873e9e6ec5813"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_load" ref="a1e6d163cadde605f7e2873e9e6ec5813" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_load </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load namespace LFSCK statistics information from the trace file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00336">336</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00543">lfsck_component::lc_file_disk</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00553">lfsck_component::lc_file_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00539">lfsck_component::lc_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l01112">lfsck_buf_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00100">lfsck_namespace_le_to_cpu()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00052">LFSCK_NAMESPACE_MAGIC</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, and <a class="el" href="lustre__idl_8h_source.html#l01606">XATTR_NAME_LFSCK_NAMESPACE</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06514">lfsck_namespace_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a5711bbdc581dcec1c5088b0ffae352c5"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_load_bitmap" ref="a5711bbdc581dcec1c5088b0ffae352c5" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_load_bitmap </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load the MDT bitmap from the <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> trace file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure or data corruption </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00268">268</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00049">CFS_ALLOCATE_BITMAP()</a>, <a class="el" href="bitmap_8h_source.html#l00100">cfs_bitmap_check_empty()</a>, <a class="el" href="bitmap_8h_source.html#l00072">CFS_FREE_BITMAP</a>, <a class="el" href="bitmap_8h_source.html#l00062">CFS_RESET_BITMAP()</a>, <a class="el" href="bitmap_8h_source.html#l00041">cfs_bitmap::data</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00831">lfsck_assistant_data::lad_bitmap</a>, <a class="el" href="lfsck__internal_8h_source.html#l00837">lfsck_assistant_data::lad_incomplete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00539">lfsck_component::lc_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l01112">lfsck_buf_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="lfsck__internal_8h_source.html#l00275">lfsck_namespace::ln_bitmap_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00478">lfsck_tgt_descs::ltd_tgts_bitmap</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="bitmap_8h_source.html#l00040">cfs_bitmap::size</a>, <a class="el" href="cascading__rw_8c_source.html#l00061">size</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01603">XATTR_NAME_LFSCK_BITMAP</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03904">lfsck_namespace_prep()</a>.</p>

</div>
</div>
<a class="anchor" id="a9e63fca987dc0d81727370fc252231a3"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_load_one_trace_file" ref="a9e63fca987dc0d81727370fc252231a3" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, const char *name, bool reset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdt__object.html">dt_object</a>* lfsck_namespace_load_one_trace_file </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>reset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00438">438</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00594">dt_lfsck_features</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00673">lfsck_instance::li_los</a>, <a class="el" href="local__storage_8c_source.html#l00519">local_index_find_or_create()</a>, and <a class="el" href="local__storage_8c_source.html#l00630">local_object_unlink()</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l00460">lfsck_namespace_load_sub_trace_files()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>.</p>

</div>
</div>
<a class="anchor" id="ac493d3e42131fcf3d8000e59e40db534"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_load_sub_trace_files" ref="ac493d3e42131fcf3d8000e59e40db534" args="(const struct lu_env *env, struct lfsck_component *com, bool reset)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_load_sub_trace_files </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>reset</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00460">460</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="structdt__object__operations.html#ac317771bd9f0827b4d8fcec4d51a63c2">dt_object_operations::do_index_try</a>, <a class="el" href="dt__object_8h_source.html#l01751">dt_object::do_ops</a>, <a class="el" href="dt__object_8c_source.html#l00594">dt_lfsck_features</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lustre__disk_8h_source.html#l00076">LFSCK_NAMESPACE</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00438">lfsck_namespace_load_one_trace_file()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00520">LFSCK_STF_COUNT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00676">lfsck_instance::li_lfsck_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, and <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l00495">lfsck_namespace_init()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l06514">lfsck_namespace_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="abe2739624c3d1c8dd30afdb8a9812e4d"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_open_dir" ref="abe2739624c3d1c8dd30afdb8a9812e4d" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_open_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03837">3837</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01231">lfsck_dev_idx()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01672">lfsck_namespace_verify_stripe_slave()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00686">lfsck_instance::li_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00692">lfsck_instance::li_obj_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00593">lfsck_lmv::ll_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00601">lfsck_lmv::ll_lmv_master</a>, <a class="el" href="lfsck__internal_8h_source.html#l00601">lfsck_lmv::ll_lmv_updated</a>, <a class="el" href="lustre__idl_8h_source.html#l02579">lmv_mds_md_v1::lmv_master_mdt_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="afef1b3162903507c7adef97950a287c5"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_post" ref="afef1b3162903507c7adef97950a287c5" args="(const struct lu_env *env, struct lfsck_component *com, int result, bool init)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_post </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>init</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04152">4152</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00188">cfs_duration_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00152">cfs_time_current()</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00050">HALF_SEC</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00529">lfsck_component::lc_link</a>, <a class="el" href="lfsck__internal_8h_source.html#l00532">lfsck_component::lc_link_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00556">lfsck_component::lc_new_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00055">LF_SCANNED_ONCE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00061">LF_UPGRADE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03647">lfsck_namespace_release_lmv()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__lib_8c_source.html#l02551">lfsck_post_generic()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00649">lfsck_instance::li_list_double_scan</a>, <a class="el" href="lfsck__internal_8h_source.html#l00652">lfsck_instance::li_list_idle</a>, <a class="el" href="lfsck__internal_8h_source.html#l00635">lfsck_instance::li_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00684">lfsck_instance::li_pos_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00725">lfsck_instance::li_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00662">lfsck_instance::li_time_last_checkpoint</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00150">list_move_tail()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00157">lfsck_namespace::ln_time_last_checkpoint</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00083">LS_FAILED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00090">LS_PAUSED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00077">LS_SCANNING_PHASE2</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00086">LS_STOPPED</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ab2ee77ded1c034480fc269ac4fac1611"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_prep" ref="ab2ee77ded1c034480fc269ac4fac1611" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_start_param *lsp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_prep </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__start__param.html">lfsck_start_param</a> *&nbsp;</td>
          <td class="paramname"> <em>lsp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03904">3904</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00529">lfsck_component::lc_link</a>, <a class="el" href="lfsck__internal_8h_source.html#l00532">lfsck_component::lc_link_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00537">lfsck_component::lc_pos_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00055">LF_SCANNED_ONCE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00268">lfsck_namespace_load_bitmap()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01148">lfsck_pos_is_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01143">lfsck_pos_set_zero()</a>, <a class="el" href="lfsck__bookmark_8c_source.html#l00203">lfsck_set_param()</a>, <a class="el" href="lfsck__lib_8c_source.html#l02484">lfsck_start_assistant()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00730">lfsck_instance::li_drop_dryrun</a>, <a class="el" href="lfsck__internal_8h_source.html#l00646">lfsck_instance::li_list_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00649">lfsck_instance::li_list_double_scan</a>, <a class="el" href="lfsck__internal_8h_source.html#l00635">lfsck_instance::li_lock</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00150">list_move_tail()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00178">lfsck_namespace::ln_dirs_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00193">lfsck_namespace::ln_fid_latest_scanned_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00169">lfsck_namespace::ln_items_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00175">lfsck_namespace::ln_items_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00172">lfsck_namespace::ln_items_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00202">lfsck_namespace::ln_mul_linked_checked</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00181">lfsck_namespace::ln_objs_checked_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00187">lfsck_namespace::ln_objs_failed_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00184">lfsck_namespace::ln_objs_repaired_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00163">lfsck_namespace::ln_pos_last_checkpoint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00145">lfsck_namespace::ln_run_time_phase1</a>, <a class="el" href="lfsck__internal_8h_source.html#l00148">lfsck_namespace::ln_run_time_phase2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00249">lfsck_namespace::ln_striped_dirs_disabled</a>, <a class="el" href="lfsck__internal_8h_source.html#l00246">lfsck_namespace::ln_striped_dirs_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00243">lfsck_namespace::ln_striped_dirs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00240">lfsck_namespace::ln_striped_dirs_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00262">lfsck_namespace::ln_striped_shards_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00256">lfsck_namespace::ln_striped_shards_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00267">lfsck_namespace::ln_striped_shards_skipped</a>, <a class="el" href="lfsck__internal_8h_source.html#l00154">lfsck_namespace::ln_time_latest_start</a>, <a class="el" href="lfsck__internal_8h_source.html#l00208">lfsck_namespace::ln_unknown_inconsistency</a>, <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00079">lfsck_position::lp_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00076">lfsck_position::lp_dir_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00080">LS_COMPLETED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00073">LS_SCANNING_PHASE1</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00077">LS_SCANNING_PHASE2</a>, <a class="el" href="lustre__lfsck_8h_source.html#l00042">lfsck_start_param::lsp_start</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

</div>
</div>
<a class="anchor" id="ad6f4495144243a75c74e39ce2644f797"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_query" ref="ad6f4495144243a75c74e39ce2644f797" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_request *req, struct lfsck_reply *rep, struct lfsck_query *que, int idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_query </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__request.html">lfsck_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__reply.html">lfsck_reply</a> *&nbsp;</td>
          <td class="paramname"> <em>rep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__query.html">lfsck_query</a> *&nbsp;</td>
          <td class="paramname"> <em>que</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04720">4720</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lustre__idl_8h_source.html#l03481">LEF_QUERY_ALL</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04687">lfsck_namespace_query_all()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04669">lfsck_namespace_repaired()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00730">lfsck_instance::li_master</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lustre__idl_8h_source.html#l03432">lfsck_request::lr_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03454">lfsck_reply::lr_repaired</a>, <a class="el" href="lustre__idl_8h_source.html#l03452">lfsck_reply::lr_status</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00227">lfsck_query::lu_mdts_count</a>, and <a class="el" href="lustre__lfsck__user_8h_source.html#l00229">lfsck_query::lu_repaired</a>.</p>

</div>
</div>
<a class="anchor" id="ad517fc62caf9881da7c0250d68c21a78"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_query_all" ref="ad517fc62caf9881da7c0250d68c21a78" args="(const struct lu_env *env, struct lfsck_component *com, __u32 *mdts_count, __u64 *repaired)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_query_all </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>mdts_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>repaired</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04687">4687</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00494">lfsck_ltd2tgt()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04669">lfsck_namespace_repaired()</a>, <a class="el" href="lfsck__lib_8c_source.html#l02420">lfsck_query_all()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00458">lfsck_tgt_desc::ltd_namespace_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00456">lfsck_tgt_desc::ltd_namespace_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00484">lfsck_tgt_descs::ltd_rw_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00478">lfsck_tgt_descs::ltd_tgts_bitmap</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04720">lfsck_namespace_query()</a>.</p>

</div>
</div>
<a class="anchor" id="acddad66d7c5a987cbd5ea16fb9bf5ca9"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_quit" ref="acddad66d7c5a987cbd5ea16fb9bf5ca9" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_quit </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04443">4443</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00820">lfsck_assistant_data::lad_mdt_phase1_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00823">lfsck_assistant_data::lad_mdt_phase2_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="lfsck__internal_8h_source.html#l00826">lfsck_assistant_data::lad_thread</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03647">lfsck_namespace_release_lmv()</a>, <a class="el" href="lfsck__lib_8c_source.html#l02613">lfsck_quit_generic()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00704">lfsck_instance::li_mdt_descs</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="lfsck__internal_8h_source.html#l00481">lfsck_tgt_descs::ltd_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00454">lfsck_tgt_desc::ltd_namespace_phase_list</a>, <a class="el" href="lustre__net_8h_source.html#l01537">thread_is_init()</a>, and <a class="el" href="lustre__net_8h_source.html#l01542">thread_is_stopped()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e5221a7fc1e062d8b163cd4bb1789c5"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_rebuild_linkea" ref="a5e5221a7fc1e062d8b163cd4bb1789c5" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, struct linkea_data *ldata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_rebuild_linkea </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Overwrite the linkEA for the object with the given ldata. </p>
<p>The caller should take the ldlm lock before the calling.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ldata</em>&nbsp;</td><td>pointer to the new linkEA data</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01910">1910</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__striped__dir_8c_source.html#l01817">lfsck_namespace_striped_dir_rescan()</a>.</p>

</div>
</div>
<a class="anchor" id="a349b9b3961df0a91f42b499c3abab2fc"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_record_failure" ref="a349b9b3961df0a91f42b499c3abab2fc" args="(const struct lu_env *env, struct lfsck_instance *lfsck, struct lfsck_namespace *ns)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_record_failure </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *&nbsp;</td>
          <td class="paramname"> <em>lfsck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00238">238</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__lib_8c_source.html#l01796">lfsck_pos_fill()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01153">lfsck_pos_is_eq()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01148">lfsck_pos_is_zero()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00175">lfsck_namespace::ln_items_failed</a>, <a class="el" href="lfsck__internal_8h_source.html#l00166">lfsck_namespace::ln_pos_first_inconsistent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00079">lfsck_position::lp_dir_cookie</a>, <a class="el" href="lfsck__internal_8h_source.html#l00076">lfsck_position::lp_dir_parent</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, and <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04094">lfsck_namespace_exec_dir()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04005">lfsck_namespace_exec_oit()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l03762">lfsck_namespace_fail()</a>.</p>

</div>
</div>
<a class="anchor" id="a18699ca5aa4b2ed4f585d4d5bedc85e6"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_release_lmv" ref="a18699ca5aa4b2ed4f585d4d5bedc85e6" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_release_lmv </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03647">3647</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00155">lfsck_lmv_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00655">lfsck_instance::li_list_lmv</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lfsck__internal_8h_source.html#l00594">lfsck_lmv::ll_ref</a>, <a class="el" href="lfsck__internal_8h_source.html#l00620">lfsck_lmv_unit::llu_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00253">lfsck_namespace::ln_striped_dirs_skipped</a>, and <a class="el" href="list_8h_source.html#l00043">list_head::next</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04406">lfsck_namespace_data_release()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04152">lfsck_namespace_post()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l04443">lfsck_namespace_quit()</a>.</p>

</div>
</div>
<a class="anchor" id="a499639286c429a090c0ba2f745b31363"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_repair_dangling" ref="a499639286c429a090c0ba2f745b31363" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct dt_object *child, struct lfsck_namespace_req *lnr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_repair_dangling </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace__req.html">lfsck_namespace_req</a> *&nbsp;</td>
          <td class="paramname"> <em>lnr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Repair dangling name entry. </p>
<p>For the name entry with dangling reference, we need to repare the inconsistency according to the LFSCK sponsor's requirement:</p>
<p>1) Keep the inconsistency there and report the inconsistency case, then give the chance to the application to find related issues, and the users can make the decision about how to handle it with more human knownledge. (by default)</p>
<p>2) Re-create the missing MDT-object with the FID information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the dir object that contains the dangling name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the object corresponding to the dangling name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lnr</em>&nbsp;</td><td>pointer to the namespace request that contains the name's name, parent object, parent's LMV, and ect.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number if no need to repair </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zero</em>&nbsp;</td><td>for repaired successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04790">4790</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="structdt__object__operations.html#a00fed99bee94890d3e36719af00d5595">dt_object_operations::do_ah_init</a>, <a class="el" href="dt__object_8h_source.html#l01751">dt_object::do_ops</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="lfsck__lib_8c_source.html#l00542">dot</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02120">dt_create()</a>, <a class="el" href="dt__object_8h_source.html#l02103">dt_declare_create()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00444">LA_ATIME</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00450">LA_GID</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00445">LA_MTIME</a>, <a class="el" href="lu__object_8h_source.html#l00452">LA_TYPE</a>, <a class="el" href="lu__object_8h_source.html#l00449">LA_UID</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00293">LCK_PR</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01468">lfsck_lmv_header_cpu_to_le()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01094">lfsck_name_get_const()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00628">lfsck_namespace_check_exist()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01310">lfsck_object_locate()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l00880">lfsck_shard_name_to_index()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00669">lfsck_instance::li_next</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00593">lfsck_lmv::ll_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00601">lfsck_lmv::ll_lmv_master</a>, <a class="el" href="lustre__idl_8h_source.html#l02577">lmv_mds_md_v1::lmv_magic</a>, <a class="el" href="lustre__idl_8h_source.html#l02600">LMV_MAGIC_STRIPE</a>, <a class="el" href="lustre__idl_8h_source.html#l02579">lmv_mds_md_v1::lmv_master_mdt_index</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00762">lfsck_namespace_req::lnr_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00769">lfsck_namespace_req::lnr_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00768">lfsck_namespace_req::lnr_namelen</a>, <a class="el" href="lfsck__internal_8h_source.html#l00767">lfsck_namespace_req::lnr_type</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00157">LPF_CREATE_MDTOBJ</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00873">lfsck_thread_info::lti_dof</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00890">lfsck_thread_info::lti_hint</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lfsck__internal_8h_source.html#l00860">lfsck_thread_info::lti_linkea_buf2</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lfsck__internal_8h_source.html#l00897">lfsck_thread_info::lti_lmv2</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>, and <a class="el" href="lustre__idl_8h_source.html#l01596">XATTR_NAME_LMV</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, and <a class="el" href="lfsck__striped__dir_8c_source.html#l01817">lfsck_namespace_striped_dir_rescan()</a>.</p>

</div>
</div>
<a class="anchor" id="a7802d2fdae444eb243bebb9b92a8238a"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_repair_dirent" ref="a7802d2fdae444eb243bebb9b92a8238a" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct dt_object *child, const char *name, const char *name2, __u16 type, bool update, bool dec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_repair_dirent </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u16&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>update</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>dec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Repair invalid name entry. </p>
<p>If the name entry contains invalid information, such as bad file type or (and) corrupted object FID, then either remove the name entry or udpate the name entry with the given (right) information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the object referenced by the name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>the old name of the child under the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name2</em>&nbsp;</td><td>the new name of the child under the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>the type claimed by the name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>update</em>&nbsp;</td><td>update the name entry if true; otherwise, remove it </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dec</em>&nbsp;</td><td>decrease the parent nlink count if true</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01990">1990</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02292">dt_declare_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l02305">dt_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00525">lfsck_namespace_trace_update()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01310">lfsck_object_locate()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00669">lfsck_instance::li_next</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00112">LNTF_CHECK_LINKEA</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l02248">lfsck_namespace_handle_striped_master()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01817">lfsck_namespace_striped_dir_rescan()</a>, and <a class="el" href="lfsck__striped__dir_8c_source.html#l00334">lfsck_remove_dirent()</a>.</p>

</div>
</div>
<a class="anchor" id="a37a4d9f2ac5ee6c249ca3df8084c7492"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_repair_nlink" ref="a37a4d9f2ac5ee6c249ca3df8084c7492" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, struct lu_attr *la)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_repair_nlink </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__attr.html">lu_attr</a> *&nbsp;</td>
          <td class="paramname"> <em>la</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Repair the object's nlink attribute. </p>
<p>If all the known name entries have been verified, then the object's hard link attribute should match the object's linkEA entries count unless the object's has too much hard link to be recorded in the linkEA. Such cases should have been marked in the LFSCK trace file. Otherwise, trust the linkEA to update the object's nlink attribute.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>la</em>&nbsp;</td><td>pointer to buffer to object's attribute before and after the repairing</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02853">2853</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00779">fid_cpu_to_be()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00454">LA_NLINK</a>, <a class="el" href="lu__object_8h_source.html#l00427">lu_attr::la_nlink</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l00065">LF_INCOMPLETE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01434">lfsck_links_read2()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01453">lfsck_sub_trace_file_fid2idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lfsck__internal_8h_source.html#l00114">LNTF_SKIP_NLINK</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00864">lfsck_thread_info::lti_fid3</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>.</p>

</div>
</div>
<a class="anchor" id="ad5af231029bc94278dfe1b3de62ed028"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_repair_unmatched_pairs" ref="ad5af231029bc94278dfe1b3de62ed028" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, const struct lu_fid *pfid, struct lu_name *cname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_repair_unmatched_pairs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the ".." name entry for the given object. </p>
<p>The object's ".." is corrupted, this function will update the ".." name entry with the given pfid, and the linkEA with the given ldata.</p>
<p>The caller should take the ldlm lock before the calling.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the new fid for the object's ".." name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cname</em>&nbsp;</td><td>the name for the  in the parent directory</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l02147">2147</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="lfsck__lib_8c_source.html#l00543">dotdot</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00861">lfsck_thread_info::lti_big_buf</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="ad7b062b63b886840e837319f427111d8"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_repaired" ref="ad7b062b63b886840e837319f427111d8" args="(struct lfsck_namespace *ns, __u64 *count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_repaired </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlfsck__namespace.html">lfsck_namespace</a> *&nbsp;</td>
          <td class="paramname"> <em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04669">4669</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lfsck__internal_8h_source.html#l00221">lfsck_namespace::ln_bad_type_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00214">lfsck_namespace::ln_dangling_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00196">lfsck_namespace::ln_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00199">lfsck_namespace::ln_linkea_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00231">lfsck_namespace::ln_local_lpf_moved</a>, <a class="el" href="lfsck__internal_8h_source.html#l00224">lfsck_namespace::ln_lost_dirent_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00205">lfsck_namespace::ln_mul_linked_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00218">lfsck_namespace::ln_mul_ref_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00271">lfsck_namespace::ln_name_hash_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00190">lfsck_namespace::ln_objs_nlink_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00249">lfsck_namespace::ln_striped_dirs_disabled</a>, <a class="el" href="lfsck__internal_8h_source.html#l00243">lfsck_namespace::ln_striped_dirs_repaired</a>, <a class="el" href="lfsck__internal_8h_source.html#l00259">lfsck_namespace::ln_striped_shards_repaired</a>, and <a class="el" href="lfsck__internal_8h_source.html#l00211">lfsck_namespace::ln_unmatched_pairs_repaired</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l04720">lfsck_namespace_query()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l04687">lfsck_namespace_query_all()</a>.</p>

</div>
</div>
<a class="anchor" id="ad283d8bb47b77c91603a1d7aa48429c2"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_replace_cond" ref="ad283d8bb47b77c91603a1d7aa48429c2" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct dt_object *child, const struct lu_fid *cfid, const struct lu_name *cname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_replace_cond </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>cfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Conditionally replace name entry in the parent. </p>
<p>As required, the LFSCK may re-create the lost MDT-object for dangling name entry, but such repairing may be wrong because of bad FID in the name entry. As the LFSCK processing, the real MDT-object may be found, then the LFSCK should check whether the former re-created MDT-object has been modified or not, if not, then destroy it and update the name entry in the parent to reference the real MDT-object.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the MDT-object that may be the real MDT-object corresponding to the name entry in parent </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cfid</em>&nbsp;</td><td>the current FID in the name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cname</em>&nbsp;</td><td>contains the name of the child in the parent directory</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01711">1711</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02137">dt_declare_destroy()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02151">dt_destroy()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02588">dt_xattr_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01434">lfsck_links_read2()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01247">lfsck_object_find_by_dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01310">lfsck_object_locate()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00669">lfsck_instance::li_next</a>, <a class="el" href="linkea_8c_source.html#l00171">linkea_links_find()</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lu__object_8c_source.html#l02333">LU_BUF_NULL</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01594">XATTR_NAME_LOV</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a361e37f20f295dec3d297ed857d63eb0"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_rescan_striped_dir" ref="a361e37f20f295dec3d297ed857d63eb0" args="(const struct lu_env *env, struct lfsck_component *com, struct lfsck_lmv_unit *llu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_rescan_striped_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__lmv__unit.html">lfsck_lmv_unit</a> *&nbsp;</td>
          <td class="paramname"> <em>llu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rescan the striped directory after the master LMV EA reset. </p>
<p>Sometimes, the master LMV EA of the striped directory maybe lost, so when the namespace LFSCK engine scan the striped directory for the first time, it will be regarded as a normal directory. As the LFSCK processing, some other LFSCK instance on other MDT will find the shard of this striped dir, and find that the master MDT-object of the striped directory lost its LMV EA, then such remote LFSCK instance will regenerate the master LMV EA and notify the LFSCK instance on this MDT to rescan the striped directory.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>llu</em>&nbsp;</td><td>the <a class="el" href="structlfsck__lmv__unit.html">lfsck_lmv_unit</a> that contains the striped directory to be rescanned.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for LFSCK stopped/paused </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l05869">5869</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="structdt__index__operations.html#a16b19879e71b5cb1aaa459d731d580cb">dt_index_operations::dio_it</a>, <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="dt__object_8h_source.html#l01753">dt_object::do_index_ops</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00804">lfsck_assistant_data::lad_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00805">lfsck_assistant_data::lad_req_list</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__lib_8c_source.html#l01959">lfsck_assistant_object_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01487">lfsck_assistant_object_put()</a>, <a class="el" href="lfsck__engine_8c_source.html#l00297">lfsck_close_dir()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00087">lfsck_namespace_assistant_req_fini()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00061">lfsck_namespace_assistant_req_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01213">lfsck_object_get()</a>, <a class="el" href="lfsck__engine_8c_source.html#l00337">lfsck_open_dir()</a>, <a class="el" href="lfsck__engine_8c_source.html#l00042">lfsck_unpack_ent()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00713">lfsck_instance::li_args_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00707">lfsck_instance::li_cookie_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00698">lfsck_instance::li_di_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00686">lfsck_instance::li_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00692">lfsck_instance::li_obj_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00683">lfsck_instance::li_pos_current</a>, <a class="el" href="lfsck__internal_8h_source.html#l00659">lfsck_instance::li_thread</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lfsck__internal_8h_source.html#l00620">lfsck_lmv_unit::llu_lmv</a>, <a class="el" href="lfsck__internal_8h_source.html#l00621">lfsck_lmv_unit::llu_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00073">lfsck_position::lp_oit_cookie</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l01072">name_is_dot_or_dotdot()</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="structdt__index__operations_1_1dt__it__ops.html#a1b24018fcd837461771bb59a4d0c0d05">dt_index_operations::dt_it_ops::rec</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06106">lfsck_namespace_assistant_handler_p2()</a>.</p>

</div>
</div>
<a class="anchor" id="ae158116b400b3d12724228b043761f7f"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_reset" ref="ae158116b400b3d12724228b043761f7f" args="(const struct lu_env *env, struct lfsck_component *com, bool init)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_reset </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>init</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l03699">3699</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="bitmap_8h_source.html#l00062">CFS_RESET_BITMAP()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00831">lfsck_assistant_data::lad_bitmap</a>, <a class="el" href="lfsck__internal_8h_source.html#l00837">lfsck_assistant_data::lad_incomplete</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00539">lfsck_component::lc_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lustre__disk_8h_source.html#l00076">LFSCK_NAMESPACE</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00438">lfsck_namespace_load_one_trace_file()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00460">lfsck_namespace_load_sub_trace_files()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00052">LFSCK_NAMESPACE_MAGIC</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00369">lfsck_namespace_store()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00674">lfsck_instance::li_local_root_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00133">lfsck_namespace::ln_magic</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="lfsck__internal_8h_source.html#l00142">lfsck_namespace::ln_success_count</a>, <a class="el" href="lfsck__internal_8h_source.html#l00151">lfsck_namespace::ln_time_last_complete</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00069">LS_INIT</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03904">lfsck_namespace_prep()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l06514">lfsck_namespace_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a0483383299e60883a77f8f32ef785e95"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_scan_local_lpf" ref="a0483383299e60883a77f8f32ef785e95" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_scan_local_lpf </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle orphans under the backend /lost+found directory. </p>
<p>Some backend checker, such as e2fsck for ldiskfs may find some orphans and put them under the backend /lost+found directory that is invisible to client. The LFSCK will scan such directory, for the original client visible orphans, add their fids into the namespace LFSCK trace file, then the subsenquent namespace LFSCK second-stage scanning can handle them as other objects to be double scanned: either move back to normal namespace, or to the global visible orphan directory: /ROOT/.lustre/lost+found/MDTxxxx/</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l05699">5699</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__fail_8h_source.html#l00139">CFS_FAIL_TIMEOUT</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__idl_8h_source.html#l00477">fid_is_norm()</a>, <a class="el" href="lustre__fid_8h_source.html#l00312">fid_seq_in_fldb()</a>, <a class="el" href="fld__handler_8c_source.html#l00205">fld_local_lookup()</a>, <a class="el" href="seq__range_8h_source.html#l00091">fld_range_set_mdt()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00559">lfsck_component::lc_new_scanned</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__lib_8c_source.html#l01874">lfsck_control_speed_by_self()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01231">lfsck_dev_idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01226">lfsck_dev_site()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05560">lfsck_namespace_scan_local_lpf_one()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01247">lfsck_object_find_by_dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__engine_8c_source.html#l00042">lfsck_unpack_ent()</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00139">LPF_FAILOUT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00875">lfsck_thread_info::lti_key</a>, <a class="el" href="lfsck__internal_8h_source.html#l00895">lfsck_thread_info::lti_range</a>, <a class="el" href="fid__lib_8c_source.html#l00102">LU_BACKEND_LPF_FID</a>, <a class="el" href="lustre__idl_8h_source.html#l00872">LUDA_64BITHASH</a>, <a class="el" href="lustre__idl_8h_source.html#l00871">LUDA_TYPE</a>, <a class="el" href="lfsck__internal_8h_source.html#l01072">name_is_dot_or_dotdot()</a>, <a class="el" href="obd__support_8h_source.html#l00525">OBD_FAIL_LFSCK_DELAY3</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__net_8h_source.html#l01557">thread_is_running()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l06106">lfsck_namespace_assistant_handler_p2()</a>.</p>

</div>
</div>
<a class="anchor" id="ae11de1a13915ec51f3909ad805d87557"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_scan_local_lpf_one" ref="ae11de1a13915ec51f3909ad805d87557" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct lu_dirent *ent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_scan_local_lpf_one </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__dirent.html">lu_dirent</a> *&nbsp;</td>
          <td class="paramname"> <em>ent</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle one orphan under the backend /lost+found directory. </p>
<p>Insert the orphan FID into the namespace LFSCK trace file for further processing (via the subsequent namespace LFSCK second-stage scanning). At the same time, remove the orphan name entry from backend /lost+found directory. There is an interval between the orphan name entry removed from the backend /lost+found directory and the orphan FID in the LFSCK trace file handled. In such interval, the LFSCK can be reset, then all the FIDs recorded in the namespace LFSCK trace file will be dropped. To guarantee that the orphans can be found when LFSCK run next time without e2fsck again, when remove the orphan name entry, the LFSCK will set the orphan's ctime attribute as 1. Since normal applications cannot change the object's ctime attribute as 1. Then when LFSCK run next time, it can record the object (that ctime is 1) in the namespace LFSCK trace file during the first-stage scanning.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the object for the backend /lost+found </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ent</em>&nbsp;</td><td>pointer to the name entry for the target under the backend /lost+found</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>for repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if needs to repair nothing </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l05560">5560</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02253">dt_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02238">dt_declare_attr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02292">dt_declare_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8h_source.html#l02305">dt_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00779">fid_cpu_to_be()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00446">LA_CTIME</a>, <a class="el" href="lu__object_8h_source.html#l00415">lu_attr::la_ctime</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lustre__idl_8h_source.html#l00898">lu_dirent::lde_fid</a>, <a class="el" href="lustre__idl_8h_source.html#l00913">lu_dirent::lde_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01247">lfsck_object_find_by_dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01453">lfsck_sub_trace_file_fid2idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00115">LNTF_CHECK_ORPHAN</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00862">lfsck_thread_info::lti_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00865">lfsck_thread_info::lti_la</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="rename__many_8c_source.html#l00056">stop</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05699">lfsck_namespace_scan_local_lpf()</a>.</p>

</div>
</div>
<a class="anchor" id="a12be37000161af347ac970c78a35db56"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_setup" ref="a12be37000161af347ac970c78a35db56" args="(const struct lu_env *env, struct lfsck_instance *lfsck)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_setup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *&nbsp;</td>
          <td class="paramname"> <em>lfsck</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06514">6514</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8c_source.html#l00594">dt_lfsck_features</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00543">lfsck_component::lc_file_disk</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00553">lfsck_component::lc_file_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00529">lfsck_component::lc_link</a>, <a class="el" href="lfsck__internal_8h_source.html#l00532">lfsck_component::lc_link_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00539">lfsck_component::lc_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00541">lfsck_component::lc_ops</a>, <a class="el" href="lfsck__internal_8h_source.html#l00535">lfsck_component::lc_ref</a>, <a class="el" href="lfsck__internal_8h_source.html#l00534">lfsck_component::lc_sem</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lfsck__internal_8h_source.html#l00561">lfsck_component::lc_type</a>, <a class="el" href="lfsck__lib_8c_source.html#l01929">lfsck_assistant_data_init()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00318">lfsck_component_cleanup()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lustre__disk_8h_source.html#l00076">LFSCK_NAMESPACE</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00495">lfsck_namespace_init()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00336">lfsck_namespace_load()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00460">lfsck_namespace_load_sub_trace_files()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01219">lfsck_object_put()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00520">LFSCK_STF_COUNT</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00171">LFSCK_TYPE_NAMESPACE</a>, <a class="el" href="lfsck__internal_8h_source.html#l00670">lfsck_instance::li_bottom</a>, <a class="el" href="lfsck__internal_8h_source.html#l00646">lfsck_instance::li_list_dir</a>, <a class="el" href="lfsck__internal_8h_source.html#l00652">lfsck_instance::li_list_idle</a>, <a class="el" href="lfsck__internal_8h_source.html#l00641">lfsck_instance::li_list_scan</a>, <a class="el" href="lfsck__internal_8h_source.html#l00674">lfsck_instance::li_local_root_fid</a>, <a class="el" href="lfsck__internal_8h_source.html#l00635">lfsck_instance::li_lock</a>, <a class="el" href="lfsck__internal_8h_source.html#l00673">lfsck_instance::li_los</a>, <a class="el" href="lfsck__internal_8h_source.html#l00730">lfsck_instance::li_master</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00136">lfsck_namespace::ln_status</a>, <a class="el" href="local__storage_8c_source.html#l00519">local_index_find_or_create()</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00080">LS_COMPLETED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00094">LS_CRASHED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00083">LS_FAILED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00069">LS_INIT</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00090">LS_PAUSED</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00073">LS_SCANNING_PHASE1</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00077">LS_SCANNING_PHASE2</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00086">LS_STOPPED</a>, <a class="el" href="lfsck__internal_8h_source.html#l00524">lfsck_sub_trace_obj::lsto_mutex</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l03474">lfsck_register()</a>.</p>

</div>
</div>
<a class="anchor" id="a72a7375c6ef2c14cd05a9a55ad3da1e8"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_shrink_linkea" ref="a72a7375c6ef2c14cd05a9a55ad3da1e8" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *obj, struct linkea_data *ldata, struct lu_name *cname, struct lu_fid *pfid, bool next)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_shrink_linkea </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>next</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove the specified entry from the linkEA. </p>
<p>Locate the linkEA entry with the given  and , then remove this entry or the other entries those are repeated with this entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>pointer to the buffer that holds the linkEA </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cname</em>&nbsp;</td><td>the name for the child in the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the parent directory's FID for the linkEA </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>next</em>&nbsp;</td><td>if true, then remove the first found linkEA entry, and move the ldata-&gt;ld_lee to next entry</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01498">1498</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00090">lfsck_bookmark::lb_param</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00291">LCK_EX</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lfsck__internal_8h_source.html#l00058">LF_INCONSISTENT</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00415">lfsck_ibits_lock()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00436">lfsck_ibits_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01434">lfsck_links_read2()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00791">lfsck_namespace_filter_linkea_entry()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00681">lfsck_instance::li_bookmark_ram</a>, <a class="el" href="linkea_8c_source.html#l00142">linkea_del_buf()</a>, <a class="el" href="linkea_8c_source.html#l00171">linkea_links_find()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00139">lfsck_namespace::ln_flags</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>, <a class="el" href="lustre__lfsck__user_8h_source.html#l00142">LPF_DRYRUN</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__idl_8h_source.html#l02093">MDS_INODELOCK_XATTR</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l01624">lfsck_namespace_shrink_linkea_cond()</a>.</p>

</div>
</div>
<a class="anchor" id="a4822734b6aa13312b2a71d12ce4ab28f"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_shrink_linkea_cond" ref="a4822734b6aa13312b2a71d12ce4ab28f" args="(const struct lu_env *env, struct lfsck_component *com, struct dt_object *parent, struct dt_object *child, struct linkea_data *ldata, struct lu_name *cname, struct lu_fid *pfid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_shrink_linkea_cond </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>parent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>child</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Conditionally remove the specified entry from the linkEA. </p>
<p>Take the parent lock firstly, then check whether the specified name entry exists or not: if yes, do nothing; otherwise, call <a class="el" href="lfsck__namespace_8c.html#a72a7375c6ef2c14cd05a9a55ad3da1e8" title="Remove the specified entry from the linkEA.">lfsck_namespace_shrink_linkea()</a> to remove the linkea entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>parent</em>&nbsp;</td><td>pointer to the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>child</em>&nbsp;</td><td>pointer to the child object that holds the linkEA </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>pointer to the buffer that holds the linkEA </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cname</em>&nbsp;</td><td>the name for the child in the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the parent directory's FID for the linkEA</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>positive</em>&nbsp;</td><td>number for repaired cases </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if nothing to be repaired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l01624">1624</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="packet-lustre_8c_source.html#l00293">LCK_PR</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01206">lfsck_is_dead_obj()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01498">lfsck_namespace_shrink_linkea()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lustre__linkea_8h_source.html#l00068">linkea_next_entry()</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, <a class="el" href="lfsck__internal_8h_source.html#l00864">lfsck_thread_info::lti_fid3</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lustre__idl_8h_source.html#l00801">lu_fid_eq()</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a74273a76fe478a87236cf46e6ae119dd"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_store" ref="a74273a76fe478a87236cf46e6ae119dd" args="(const struct lu_env *env, struct lfsck_component *com)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lfsck_namespace_store </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00369">369</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="bitmap_8h_source.html#l00041">cfs_bitmap::data</a>, <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lfsck__internal_8h_source.html#l00831">lfsck_assistant_data::lad_bitmap</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lfsck__internal_8h_source.html#l00544">lfsck_component::lc_data</a>, <a class="el" href="lfsck__internal_8h_source.html#l00543">lfsck_component::lc_file_disk</a>, <a class="el" href="lfsck__internal_8h_source.html#l00542">lfsck_component::lc_file_ram</a>, <a class="el" href="lfsck__internal_8h_source.html#l00553">lfsck_component::lc_file_size</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00539">lfsck_component::lc_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l01112">lfsck_buf_get()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00169">lfsck_namespace_cpu_to_le()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00275">lfsck_namespace::ln_bitmap_size</a>, <a class="el" href="bitmap_8h_source.html#l00040">cfs_bitmap::size</a>, <a class="el" href="lustre__idl_8h_source.html#l01603">XATTR_NAME_LFSCK_BITMAP</a>, and <a class="el" href="lustre__idl_8h_source.html#l01606">XATTR_NAME_LFSCK_NAMESPACE</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03866">lfsck_namespace_checkpoint()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l05977">lfsck_namespace_double_scan_one_trace_file()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l06171">lfsck_namespace_double_scan_result()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l00495">lfsck_namespace_init()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04152">lfsck_namespace_post()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l03699">lfsck_namespace_reset()</a>.</p>

</div>
</div>
<a class="anchor" id="ad9e1b6d4d1e59c15c70f27ee5e2aa804"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_trace_update" ref="ad9e1b6d4d1e59c15c70f27ee5e2aa804" args="(const struct lu_env *env, struct lfsck_component *com, const struct lu_fid *fid, const __u8 flags, bool add)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_namespace_trace_update </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__component.html">lfsck_component</a> *&nbsp;</td>
          <td class="paramname"> <em>com</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const __u8&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>add</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the namespace LFSCK trace file for the given . </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>com</em>&nbsp;</td><td>pointer to the lfsck component </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>the fid which flags to be updated in the lfsck trace file </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>add</em>&nbsp;</td><td>true if add new flags, otherwise remove flags</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success or nothing to be done </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00525">525</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02654">dt_lookup()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00779">fid_cpu_to_be()</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lfsck__internal_8h_source.html#l00538">lfsck_component::lc_lfsck</a>, <a class="el" href="lfsck__internal_8h_source.html#l00540">lfsck_component::lc_sub_trace_objs</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01453">lfsck_sub_trace_file_fid2idx()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00524">lfsck_sub_trace_obj::lsto_mutex</a>, <a class="el" href="lfsck__internal_8h_source.html#l00523">lfsck_sub_trace_obj::lsto_obj</a>, <a class="el" href="lfsck__internal_8h_source.html#l00864">lfsck_thread_info::lti_fid3</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l05012">lfsck_namespace_assistant_handler_p1()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l03670">lfsck_namespace_check_for_double_scan()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04005">lfsck_namespace_exec_oit()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l02248">lfsck_namespace_handle_striped_master()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l04473">lfsck_namespace_in_notify()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l01990">lfsck_namespace_repair_dirent()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01817">lfsck_namespace_striped_dir_rescan()</a>, <a class="el" href="lfsck__striped__dir_8c_source.html#l01672">lfsck_namespace_verify_stripe_slave()</a>, and <a class="el" href="lfsck__striped__dir_8c_source.html#l00485">lfsck_record_lmv()</a>.</p>

</div>
</div>
<a class="anchor" id="a57465a4d86a6b06ac320b8f9e3c227f2"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_unpack_linkea_entry" ref="a57465a4d86a6b06ac320b8f9e3c227f2" args="(struct linkea_data *ldata, struct lu_name *cname, struct lu_fid *pfid, char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lfsck_namespace_unpack_linkea_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlinkea__data.html">linkea_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ldata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l00779">779</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="lustre__linkea_8h_source.html#l00041">linkea_data::ld_lee</a>, <a class="el" href="lustre__linkea_8h_source.html#l00042">linkea_data::ld_reclen</a>, <a class="el" href="linkea_8c_source.html#l00097">linkea_entry_unpack()</a>, <a class="el" href="lu__object_8h_source.html#l01297">lu_name::ln_name</a>, and <a class="el" href="lu__object_8h_source.html#l01298">lu_name::ln_namelen</a>.</p>

<p>Referenced by <a class="el" href="lfsck__namespace_8c_source.html#l03220">lfsck_namespace_double_scan_one()</a>, <a class="el" href="lfsck__namespace_8c_source.html#l02604">lfsck_namespace_dsd_multiple()</a>, and <a class="el" href="lfsck__namespace_8c_source.html#l02328">lfsck_namespace_dsd_single()</a>.</p>

</div>
</div>
<a class="anchor" id="a3ab12cffcdd69732db02236b292c3e57"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_update_name_entry" ref="a3ab12cffcdd69732db02236b292c3e57" args="(const struct lu_env *env, struct lfsck_instance *lfsck, struct dt_object *dir, const char *name, const struct lu_fid *fid, __u32 type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_update_name_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlfsck__instance.html">lfsck_instance</a> *&nbsp;</td>
          <td class="paramname"> <em>lfsck</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the object's name entry with the given FID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lfsck</em>&nbsp;</td><td>pointer to the lfsck instance </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dir</em>&nbsp;</td><td>pointer to the directory that holds the name entry </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>the name for the entry to be updated </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fid</em>&nbsp;</td><td>the new FID for the name entry referenced </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>the type for the name entry to be updated</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06441">6441</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00157">D_LFSCK</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02266">dt_declare_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02279">dt_ref_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="packet-lustre_8c_source.html#l00292">LCK_PW</a>, <a class="el" href="lfsck__internal_8h_source.html#l01138">lfsck_dto2fid()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01133">lfsck_lfsck2name()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00468">lfsck_lock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__lib_8c_source.html#l00520">lfsck_unlock()</a>, <a class="el" href="lfsck__internal_8h_source.html#l00893">lfsck_thread_info::lti_dt_rec</a>, <a class="el" href="lfsck__internal_8h_source.html#l00900">lfsck_thread_info::lti_llh</a>, <a class="el" href="lustre__idl_8h_source.html#l02079">MDS_INODELOCK_UPDATE</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="rename__many_8c_source.html#l00056">stop</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l01149">lfsck_update_lpf_entry()</a>, and <a class="el" href="lfsck__lib_8c_source.html#l01213">lfsck_verify_lpf_pairs()</a>.</p>

</div>
</div>
<a class="anchor" id="a10e7572a512be6782d27190bbe4f52cf"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_verify_linkea" ref="a10e7572a512be6782d27190bbe4f52cf" args="(const struct lu_env *env, struct dt_object *obj, const struct lu_name *cname, const struct lu_fid *pfid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lfsck_verify_linkea </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__name.html">lu_name</a> *&nbsp;</td>
          <td class="paramname"> <em>cname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>pfid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verify the specified linkEA entry for the given directory object. </p>
<p>If the object has no such linkEA entry or it has more other linkEA entries, then re-generate the linkEA with the given information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>pointer to the thread context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obj</em>&nbsp;</td><td>pointer to the <a class="el" href="structdt__object.html">dt_object</a> to be handled </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cname</em>&nbsp;</td><td>the name for the child in the parent directory </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>pfid</em>&nbsp;</td><td>the parent directory's FID for the linkEA</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>for success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error number on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06325">6325</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02543">dt_declare_xattr_set()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02559">dt_xattr_set()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00036">linkea_data::ld_buf</a>, <a class="el" href="lustre__linkea_8h_source.html#l00040">linkea_data::ld_leh</a>, <a class="el" href="lustre__idl_8h_source.html#l03675">link_ea_header::leh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03674">link_ea_header::leh_reccount</a>, <a class="el" href="lfsck__internal_8h_source.html#l01105">lfsck_buf_init()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01084">lfsck_env_info()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01423">lfsck_links_read()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01078">lfsck_obj2dev()</a>, <a class="el" href="lfsck__internal_8h_source.html#l01201">lfsck_object_type()</a>, <a class="el" href="linkea_8c_source.html#l00113">linkea_add_buf()</a>, <a class="el" href="linkea_8c_source.html#l00034">linkea_data_new()</a>, <a class="el" href="linkea_8c_source.html#l00171">linkea_links_find()</a>, <a class="el" href="lu__object_8h_source.html#l00910">LU_XATTR_CREATE</a>, <a class="el" href="lu__object_8h_source.html#l00909">LU_XATTR_REPLACE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, and <a class="el" href="lustre__idl_8h_source.html#l01598">XATTR_NAME_LINK</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l03474">lfsck_register()</a>, <a class="el" href="lfsck__lib_8c_source.html#l01371">lfsck_verify_lpf()</a>, and <a class="el" href="lfsck__lib_8c_source.html#l01213">lfsck_verify_lpf_pairs()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a3029bde916ae8c962df35eff77fcb1d8"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_assistant_ops" ref="a3029bde916ae8c962df35eff77fcb1d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlfsck__assistant__operations.html">lfsck_assistant_operations</a> <a class="el" href="lfsck__namespace_8c.html#a3029bde916ae8c962df35eff77fcb1d8">lfsck_namespace_assistant_ops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .la_handler_p1          = <a class="code" href="lfsck__namespace_8c.html#aa516b1988fba812f0aaaac5d9b3f91e3">lfsck_namespace_assistant_handler_p1</a>,
        .la_handler_p2          = <a class="code" href="lfsck__namespace_8c.html#a383cc51eaa18e5da6cdfd4c61433bb4d">lfsck_namespace_assistant_handler_p2</a>,
        .la_fill_pos            = <a class="code" href="lfsck__namespace_8c.html#aed610ba73d60d4d5a123f21190efd1d4">lfsck_namespace_assistant_fill_pos</a>,
        .la_double_scan_result  = <a class="code" href="lfsck__namespace_8c.html#a52995e8f4dacd472d5177c77cd071de6">lfsck_namespace_double_scan_result</a>,
        .la_req_fini            = <a class="code" href="lfsck__namespace_8c.html#a9ffccbd64e91fd06e2a9c5767bc17191">lfsck_namespace_assistant_req_fini</a>,
        .la_sync_failures       = <a class="code" href="lfsck__namespace_8c.html#ad1ea3a1f41c0dbb3831e08d0ae912776" title="Notify remote LFSCK instances about former failures.">lfsck_namespace_assistant_sync_failures</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l06303">6303</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
<a class="anchor" id="a22b695fa4b0249c401dc77e6a56d9a52"></a><!-- doxytag: member="lfsck_namespace.c::lfsck_namespace_ops" ref="a22b695fa4b0249c401dc77e6a56d9a52" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlfsck__operations.html">lfsck_operations</a> <a class="el" href="lfsck__namespace_8c.html#a22b695fa4b0249c401dc77e6a56d9a52">lfsck_namespace_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .lfsck_reset            = <a class="code" href="lfsck__namespace_8c.html#ae158116b400b3d12724228b043761f7f">lfsck_namespace_reset</a>,
        .lfsck_fail             = <a class="code" href="lfsck__namespace_8c.html#af412aaf75ee32be7091bc2399affed67">lfsck_namespace_fail</a>,
        .lfsck_close_dir        = <a class="code" href="lfsck__namespace_8c.html#a69ed57581ee5c277ba85f6ee64ed03ef">lfsck_namespace_close_dir</a>,
        .lfsck_open_dir         = <a class="code" href="lfsck__namespace_8c.html#abe2739624c3d1c8dd30afdb8a9812e4d">lfsck_namespace_open_dir</a>,
        .lfsck_checkpoint       = <a class="code" href="lfsck__namespace_8c.html#a9a60c074ced382fcecd77a3a73c1c77c">lfsck_namespace_checkpoint</a>,
        .lfsck_prep             = <a class="code" href="lfsck__namespace_8c.html#ab2ee77ded1c034480fc269ac4fac1611">lfsck_namespace_prep</a>,
        .lfsck_exec_oit         = <a class="code" href="lfsck__namespace_8c.html#a75dee80f06cd10f45c480148b9cd5814">lfsck_namespace_exec_oit</a>,
        .lfsck_exec_dir         = <a class="code" href="lfsck__namespace_8c.html#aa63be6b0d3d407f18f23bb0ecb49ef75">lfsck_namespace_exec_dir</a>,
        .lfsck_post             = <a class="code" href="lfsck__namespace_8c.html#afef1b3162903507c7adef97950a287c5">lfsck_namespace_post</a>,
        .lfsck_dump             = <a class="code" href="lfsck__namespace_8c.html#a17f11b589d37767bf7e639b0d57f5f90">lfsck_namespace_dump</a>,
        .lfsck_double_scan      = <a class="code" href="lfsck__namespace_8c.html#a0d6ce687eca5ddba3a25a692a6a44f66">lfsck_namespace_double_scan</a>,
        .lfsck_data_release     = <a class="code" href="lfsck__namespace_8c.html#a0be0aba17242ba44df760cf5da297c4d">lfsck_namespace_data_release</a>,
        .lfsck_quit             = <a class="code" href="lfsck__namespace_8c.html#acddad66d7c5a987cbd5ea16fb9bf5ca9">lfsck_namespace_quit</a>,
        .lfsck_in_notify        = <a class="code" href="lfsck__namespace_8c.html#a9c7c8f304466860f4206d2054293b9a9">lfsck_namespace_in_notify</a>,
        .lfsck_query            = <a class="code" href="lfsck__namespace_8c.html#ad6f4495144243a75c74e39ce2644f797">lfsck_namespace_query</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lfsck__namespace_8c_source.html#l04746">4746</a> of file <a class="el" href="lfsck__namespace_8c_source.html">lfsck_namespace.c</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:47 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
