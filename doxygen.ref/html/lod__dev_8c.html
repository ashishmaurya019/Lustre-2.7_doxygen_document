<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/lod/lod_dev.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/lod/lod_dev.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="md__object_8h_source.html">md_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__fid_8h_source.html">lustre_fid.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__param_8h_source.html">lustre_param.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__update_8h_source.html">lustre_update.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__log_8h_source.html">lustre_log.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="lod__internal_8h_source.html">lod_internal.h</a>&quot;</code><br/>

<p><a href="lod__dev_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlod__recovery__data.html">lod_recovery_data</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_MDS</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The Logical Object Device (LOD) layer manages access to striped objects (both regular files and directories).  <a href="#abda60744d497fcfe370cfd6b2d65c7ed"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#aaca46540ab83d116498e17243ac73833">lod_fld_lookup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid, __u32 *tgt, int *type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a9542c37e4f4695806e51423abda32fea">lod_device_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#a9195fd4ea14e00bbe2d9318d60694263" title="Finalize device.">lu_device_type_operations::ldto_device_fini()</a> for LOD.  <a href="#a9542c37e4f4695806e51423abda32fea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__object.html">lu_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a57b562bdcded602b848efc85f2e5c490">lod_object_alloc</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *hdr, struct <a class="el" href="structlu__device.html">lu_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">lu_device_operations::ldo_object_alloc()</a> for LOD.  <a href="#a57b562bdcded602b848efc85f2e5c490"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#aa977234426ff8546ba49495f50385282">lod_sub_process_config</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Process the config log for all sub device.  <a href="#aa977234426ff8546ba49495f50385282"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a6f80959e06ef56e1188e6e08ec60b428">lod_process_recovery_updates</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *llh, struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *rec, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">process update recovery record  <a href="#a6f80959e06ef56e1188e6e08ec60b428"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ae7ecb49ee35b0233cf02d67af71157a3">lod_sub_recovery_thread</a> (void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">recovery thread for update log  <a href="#ae7ecb49ee35b0233cf02d67af71157a3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a4d4f051722ccdd8cd00ba9ec986dfc67">lod_sub_fini_llog</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *<a class="el" href="obd_8c.html#a20057145635eb007e0621c11bc2d7176">thread</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">finish sub llog context  <a href="#a4d4f051722ccdd8cd00ba9ec986dfc67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a18aec61bfeeaf9843029b0b96b701be2">lodname2mdt_index</a> (char *lodname, __u32 *mdt_index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract MDT target index from a device name.  <a href="#a18aec61bfeeaf9843029b0b96b701be2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a580407458bfd72d5fde4a151dcb2e42f">lod_sub_init_llog</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structdt__device.html">dt_device</a> *dt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Init sub llog context.  <a href="#a580407458bfd72d5fde4a151dcb2e42f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a9d2a101a178e46aea9731c4d47a96076">lod_sub_stop_recovery_threads</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop sub recovery thread.  <a href="#a9d2a101a178e46aea9731c4d47a96076"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a85cddcc2846b69ac713ba4dbfd0346fa">lod_sub_fini_all_llogs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">finish all sub llog  <a href="#a85cddcc2846b69ac713ba4dbfd0346fa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a9df7d330dcf90481945898868b4cb937">lod_prepare_distribute_txn</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare distribute txn.  <a href="#a9df7d330dcf90481945898868b4cb937"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a1c789a39bf6b88d508f0dac88883a2fe">lod_fini_distribute_txn</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finish distribute txn.  <a href="#a1c789a39bf6b88d508f0dac88883a2fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ac2b7223c5ddbffeaae94eefafeacb6df">lod_process_config</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *dev, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae" title="process config specific for device.">lu_device_operations::ldo_process_config()</a> for LOD.  <a href="#ac2b7223c5ddbffeaae94eefafeacb6df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a5dcf38890c4189c7c72782185dabcea8">lod_recovery_complete</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">lu_device_operations::ldo_recovery_complete()</a> for LOD.  <a href="#a5dcf38890c4189c7c72782185dabcea8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a048c64bb5ed49d15acb528068422d009">lod_sub_init_llogs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Init update logs on all sub device.  <a href="#a048c64bb5ed49d15acb528068422d009"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a6bc73b13cbf5e0bb51abd0a79e6b73a6">lod_prepare</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *pdev, struct <a class="el" href="structlu__device.html">lu_device</a> *cdev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__operations.html#aae9b682bd4e9a56b8b74ef52ea9a77a9" title="initialize local objects for device.">lu_device_operations::ldo_prepare()</a> for LOD.  <a href="#a6bc73b13cbf5e0bb51abd0a79e6b73a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a4c0092593c142b2e2748456af52261d3">lod_root_get</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev, struct <a class="el" href="structlu__fid.html">lu_fid</a> *f)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#ad2a831d38be0be73f8a5498112e13b56" title="Return FID of root index object.">dt_device_operations::dt_root_get()</a> for LOD.  <a href="#a4c0092593c142b2e2748456af52261d3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#aceed31e89b7f3d934d252cac6bfc1efd">lod_statfs</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev, struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *sfs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_device_operations::dt_statfs()</a> for LOD.  <a href="#aceed31e89b7f3d934d252cac6bfc1efd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a28002e7a2598f4328875e0b4e28bd22d">lod_trans_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_device_operations::dt_trans_create()</a> for LOD.  <a href="#a28002e7a2598f4328875e0b4e28bd22d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ae983a440718cac156dfbeef30e94902e">lod_trans_start</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_device_operations::dt_trans_start()</a> for LOD.  <a href="#ae983a440718cac156dfbeef30e94902e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a2df506c5efa8c66c87fbd996e78c10e3">lod_trans_cb_add</a> (struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *dcb)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a2d96e472ae2a3326ed416f60a3314230">lod_add_noop_records</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structthandle.html">thandle</a> *th, int count)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add noop update to the update records  <a href="#a2d96e472ae2a3326ed416f60a3314230"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ab14f0ab246c1cdb3a433e44ce54346cb">lod_trans_stop</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_device_operations::dt_trans_stop()</a> for LOD.  <a href="#ab14f0ab246c1cdb3a433e44ce54346cb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a6be0139c54e038491f23522be76e4cc8">lod_conf_get</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structdt__device.html">dt_device</a> *dev, struct <a class="el" href="structdt__device__param.html">dt_device_param</a> *param)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a652ff54fee6fbc7f4a5dda78befe5489" title="Return device configuration data.">dt_device_operations::dt_conf_get()</a> for LOD.  <a href="#a6be0139c54e038491f23522be76e4cc8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a5665f5c830d6803c95dd3816b7a55139">lod_sync</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_device_operations::dt_sync()</a> for LOD.  <a href="#a5665f5c830d6803c95dd3816b7a55139"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a8eaff23b0df9d4cad621d33c7380a5a2">lod_ro</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#a03deb463a9aebe843829c31bbab1c34d" title="Make device read-only.">dt_device_operations::dt_ro()</a> for LOD.  <a href="#a8eaff23b0df9d4cad621d33c7380a5a2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#aedb2b67d829acbbb48640933e89e01ee">lod_commit_async</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structdt__device__operations.html#ab811b4bbba68f4edcab228e8d9f52d3c" title="Start transaction commit asynchronously.">dt_device_operations::dt_commit_async()</a> for LOD.  <a href="#aedb2b67d829acbbb48640933e89e01ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a879dc147c93c5c64efcc1fedd1ff942c">lod_connect_to_osd</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *cfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connect to a local OSD.  <a href="#a879dc147c93c5c64efcc1fedd1ff942c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#af36f92e59ae36d7598523b8cb9e2ddc7">lod_tgt_desc_init</a> (struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *ltd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate and initialize target table.  <a href="#af36f92e59ae36d7598523b8cb9e2ddc7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a3fb2c2f0fabbb47345f2a8bbc6026e8e">lod_init0</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlod__device.html">lod_device</a> *lod, struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *ldt, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *cfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize LOD device at setup.  <a href="#a3fb2c2f0fabbb47345f2a8bbc6026e8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a24b04502af64652e9bbc27ae8815bfd6">lod_device_free</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *lu)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#a190c1198c588f2ed23ab58052f4001bf" title="Free device.">lu_device_type_operations::ldto_device_free()</a> for LOD.  <a href="#a24b04502af64652e9bbc27ae8815bfd6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a01728d1d503ea85413471d33e293ab0b">lod_device_alloc</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *type, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *lcfg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structlu__device__type__operations.html#acc52dc96707f7a1e4fd5f44c6923e4c6" title="Allocate new device.">lu_device_type_operations::ldto_device_alloc()</a> for LOD.  <a href="#a01728d1d503ea85413471d33e293ab0b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a01d1aeee7d54b9087431e91816bbe4b9">lod_obd_connect</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> **exp, struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *cluuid, struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *data, void *localdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a248ee7dd4ea89c60d037c3094c9ca581">obd_ops::o_connect()</a> for LOD.  <a href="#a01d1aeee7d54b9087431e91816bbe4b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a5a6b12d9fe4bf049125fb6b6676bdb2d">lod_obd_disconnect</a> (struct <a class="el" href="structobd__export.html">obd_export</a> *exp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a1dfbddccaf8e568c531a466861c7df0b">obd_ops::o_disconnect()</a> for LOD.  <a href="#a5a6b12d9fe4bf049125fb6b6676bdb2d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a83bc7422d80ed1054837ee8bc041b251">LU_KEY_INIT</a> (lod, struct <a class="el" href="structlod__thread__info.html">lod_thread_info</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#acc7cb42504dd2185d9ccba25733dfd1f">lod_key_fini</a> (const struct <a class="el" href="structlu__context.html">lu_context</a> *ctx, struct <a class="el" href="structlu__context__key.html">lu_context_key</a> *key, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a530baf0bb8b0b8ca492ab7bf1a04313d">LU_CONTEXT_KEY_DEFINE</a> (lod, LCT_MD_THREAD)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a4985cde132cca52231eadca9b5ac293d">LU_TYPE_INIT_FINI</a> (lod,&amp;<a class="el" href="lod__internal_8h.html#a19d20b5ced2d424fce13df56975e68ca">lod_thread_key</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a537c9d13e61144f720c442dc1ec0aaff">lod_obd_get_info</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, __u32 keylen, void *key, __u32 *vallen, void *val)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of <a class="el" href="structobd__ops.html#a5b1e6cee59585a39cf3a4c75d5b3fbd7">obd_ops::o_get_info()</a> for LOD.  <a href="#a537c9d13e61144f720c442dc1ec0aaff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a19bff49051a7a6a242f538bdd20c784a">lod_obd_set_info_async</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, __u32 keylen, void *key, __u32 vallen, void *val, struct <a class="el" href="structptlrpc__request__set.html">ptlrpc_request_set</a> *set)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int __init&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#acc2f1d73956f2bc9bf783129d95d2172">lod_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void __exit&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ac28494dca0e6164623731a9d3e7f2e3e">lod_exit</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#adc10f40acba3bb9b2640e985276b0a7c">MODULE_AUTHOR</a> (&quot;OpenSFS, Inc. &lt;http://www.lustre.org/&gt;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a0d962c1e4005dbdadcb5be58b6eaa08d">MODULE_DESCRIPTION</a> (&quot;Lustre Logical Object Device (&quot;LUSTRE_LOD_NAME&quot;)&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ae9c321be2136fb8501887ee69dac11a2">MODULE_VERSION</a> (LUSTRE_VERSION_STRING)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ad94b36675e7eb067ea3ce6ff9e244a44">MODULE_LICENSE</a> (&quot;GPL&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a9f0f89c2545ed41ba1b7f7b9c7c95e29">module_init</a> (lod_init)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a260a476a86b914b91699b83d556c3633">module_exit</a> (lod_exit)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#adffaec81915db9ffe7637d375a61b2e4">lod_update_log_name</a> [] = &quot;update_log&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a6208ec56b58a20e08ca69e1896b28829">lod_update_log_dir_name</a> [] = &quot;update_log_dir&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct kmem_cache *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a20d9d14ad2c941c7f89468ffa4045273">lod_object_kmem</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct kmem_cache *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a6f0a57f9e9cbc5b128be06f53e46bc91">lod_txn_callback_kmem</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__kmem__descr.html">lu_kmem_descr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a4671c9dd142a6d2a3a7c74f9f5fea451">lod_caches</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__device__operations.html">lu_device_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a72093e53bdf476ef11cc91965a07991f">lod_lu_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdt__device__operations.html">dt_device_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a73cc554f264f4898099d51ce33ca75e3">lod_dt_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structlu__device__type__operations.html">lu_device_type_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#ad7e7a5e3f80f074a795c18e534fa3da8">lod_device_type_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structlu__device__type.html">lu_device_type</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a963cebf3067374bd6a8364e52399dfa0">lod_device_type</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structobd__ops.html">obd_ops</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lod__dev_8c.html#a00fa4dacd72ccd1310f0928988252877">lod_obd_device_ops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="lod_dev.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_MDS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The Logical Object Device (LOD) layer manages access to striped objects (both regular files and directories). </p>
<p>It implements the DT device and object APIs and is responsible for creating, storing, and loading striping information as an extended attribute of the underlying OSD object. LOD is the server side analog of the LOV and LMV layers on the client side.</p>
<p>Metadata LU object stack (layers of the same compound LU object, all have the same FID):</p>
<p>MDT | MD API MDD | DT API LOD / \ DT API OSD OSP</p>
<p>During LOD object initialization the localness or remoteness of the object FID dictates the choice between OSD and OSP.</p>
<p>An LOD object (file or directory) with N stripes (each has a different FID):</p>
<p>LOD | +---+---+---+...+ | | | | | S0 S1 S2 S3 S(N-1) OS[DP] objects, seen as DT objects by LOD</p>
<p>When upper layers must access an object's stripes (which are themselves OST or MDT LU objects) LOD finds these objects by their FIDs and stores them as an array of DT object pointers on the object. Declarations and operations on LOD objects are received by LOD (as DT object operations) and performed on the underlying OS[DP] object and (as needed) on the stripes. From the perspective of LOD, a stripe-less file (created by mknod() or open with O_LOV_DELAY_CREATE) is an object which does not yet have stripes, while a non-striped directory (created by mkdir()) is an object which will never have stripes.</p>
<p>The LOD layer also implements a small subset of the OBD device API to support MDT stack initialization and finalization (an MDD device connects and disconnects itself to and from the underlying LOD device), and pool management. In turn LOD uses the OBD device API to connect it self to the underlying OSD, and to connect itself to OSP devices representing the MDTs and OSTs that bear the stripes of its objects. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00090">90</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2d96e472ae2a3326ed416f60a3314230"></a><!-- doxytag: member="lod_dev.c::lod_add_noop_records" ref="a2d96e472ae2a3326ed416f60a3314230" args="(const struct lu_env *env, struct dt_device *dt, struct thandle *th, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_add_noop_records </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add noop update to the update records </p>
<p>Add noop updates to the update records, which is only used in test right now.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>dt device of lod </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>count</em>&nbsp;</td><td>the count of update records to be added.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if adding succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if adding fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01258">1258</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l00260">fid_zero()</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__internal_8h_source.html#l00297">lod_thread_info::lti_fid</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00640">update_record_pack</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01288">lod_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="aedb2b67d829acbbb48640933e89e01ee"></a><!-- doxytag: member="lod_dev.c::lod_commit_async" ref="aedb2b67d829acbbb48640933e89e01ee" args="(const struct lu_env *env, struct dt_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_commit_async </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#ab811b4bbba68f4edcab228e8d9f52d3c" title="Start transaction commit asynchronously.">dt_device_operations::dt_commit_async()</a> for LOD. </p>
<p>Asks local OSD to commit sooner.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01368">1368</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="dt__object_8h_source.html#l02645">dt_commit_async()</a>.</p>

</div>
</div>
<a class="anchor" id="a6be0139c54e038491f23522be76e4cc8"></a><!-- doxytag: member="lod_dev.c::lod_conf_get" ref="a6be0139c54e038491f23522be76e4cc8" args="(const struct lu_env *env, const struct dt_device *dev, struct dt_device_param *param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lod_conf_get </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device__param.html">dt_device_param</a> *&nbsp;</td>
          <td class="paramname"> <em>param</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a652ff54fee6fbc7f4a5dda78befe5489" title="Return device configuration data.">dt_device_operations::dt_conf_get()</a> for LOD. </p>
<p>Currently returns the configuration provided by the local OSD.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01308">1308</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="dt__object_8h_source.html#l02455">dt_conf_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a879dc147c93c5c64efcc1fedd1ff942c"></a><!-- doxytag: member="lod_dev.c::lod_connect_to_osd" ref="a879dc147c93c5c64efcc1fedd1ff942c" args="(const struct lu_env *env, struct lod_device *lod, struct lustre_cfg *cfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_connect_to_osd </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connect to a local OSD. </p>
<p>Used to connect to the local OSD at mount. OSD name is taken from the configuration command passed. This connection is used to identify LU site and pin the OSD from early removal.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cfg</em>&nbsp;</td><td>configuration command to apply</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01400">1400</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00169">lod_device::lod_child_exp</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="lustre__ver_8h_source.html#l00023">LUSTRE_VERSION_CODE</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__class_8h_source.html#l00796">obd_connect()</a>, <a class="el" href="lustre__idl_8h_source.html#l01184">OBD_CONNECT_VERSION</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00598">obd_device::obd_uuid</a>, <a class="el" href="lustre__idl_8h_source.html#l01336">obd_connect_data::ocd_connect_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01337">obd_connect_data::ocd_version</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01529">lod_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a01728d1d503ea85413471d33e293ab0b"></a><!-- doxytag: member="lod_dev.c::lod_device_alloc" ref="a01728d1d503ea85413471d33e293ab0b" args="(const struct lu_env *env, struct lu_device_type *type, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a>* lod_device_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#acc52dc96707f7a1e4fd5f44c6923e4c6" title="Allocate new device.">lu_device_type_operations::ldto_device_alloc()</a> for LOD. </p>
<p>Allocates LOD device and calls the helpers to initialize it.</p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01606">1606</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00157">dt_device_init()</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__dev_8c_source.html#l01586">lod_device_free()</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__dev_8c_source.html#l01529">lod_init0()</a>, and <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>.</p>

</div>
</div>
<a class="anchor" id="a9542c37e4f4695806e51423abda32fea"></a><!-- doxytag: member="lod_dev.c::lod_device_fini" ref="a9542c37e4f4695806e51423abda32fea" args="(const struct lu_env *env, struct lu_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a> * lod_device_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#a9195fd4ea14e00bbe2d9318d60694263" title="Finalize device.">lu_device_type_operations::ldto_device_fini()</a> for LOD. </p>
<p>Releases the internal resources used by LOD device.</p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01638">1638</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__lov_8c_source.html#l00490">lod_fini_tgt()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l01372">lod_pools_fini()</a>, <a class="el" href="lod__internal_8h.html#ae6724d20204fb807ac210a407aa84e08">lod_procfs_fini()</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a24b04502af64652e9bbc27ae8815bfd6"></a><!-- doxytag: member="lod_dev.c::lod_device_free" ref="a24b04502af64652e9bbc27ae8815bfd6" args="(const struct lu_env *env, struct lu_device *lu)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__device.html">lu_device</a>* lod_device_free </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lu</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__type__operations.html#a190c1198c588f2ed23ab58052f4001bf" title="Free device.">lu_device_type_operations::ldto_device_free()</a> for LOD. </p>
<p>Releases the memory allocated for LOD device.</p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01586">1586</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8c_source.html#l00164">dt_device_fini()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lu__object_8h_source.html#l00271">lu_device::ld_ref</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01606">lod_device_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="ac28494dca0e6164623731a9d3e7f2e3e"></a><!-- doxytag: member="lod_dev.c::lod_exit" ref="ac28494dca0e6164623731a9d3e7f2e3e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __exit lod_exit </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01978">1978</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="genops_8c_source.html#l00246">class_unregister_type()</a>, <a class="el" href="lu__object_8c_source.html#l02275">lu_kmem_fini()</a>, and <a class="el" href="obd_8h_source.html#l00452">LUSTRE_LOD_NAME</a>.</p>

</div>
</div>
<a class="anchor" id="a1c789a39bf6b88d508f0dac88883a2fe"></a><!-- doxytag: member="lod_dev.c::lod_fini_distribute_txn" ref="a1c789a39bf6b88d508f0dac88883a2fe" args="(const struct lu_env *env, struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lod_fini_distribute_txn </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finish distribute txn. </p>
<p>Release the resource holding by distribute txn, i.e. stop distribute txn thread.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00792">792</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="update__trans_8c_source.html#l01732">distribute_txn_fini()</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="aaca46540ab83d116498e17243ac73833"></a><!-- doxytag: member="lod_dev.c::lod_fld_lookup" ref="aaca46540ab83d116498e17243ac73833" args="(const struct lu_env *env, struct lod_device *lod, const struct lu_fid *fid, __u32 *tgt, int *type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_fld_lookup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>tgt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00121">121</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00525">fid_idif_ost_idx()</a>, <a class="el" href="lustre__idl_8h_source.html#l00462">fid_is_idif()</a>, <a class="el" href="lustre__idl_8h_source.html#l00793">fid_is_sane()</a>, <a class="el" href="lustre__idl_8h_source.html#l00492">fid_is_update_log()</a>, <a class="el" href="lustre__idl_8h_source.html#l00502">fid_is_update_log_dir()</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, <a class="el" href="lustre__fid_8h_source.html#l00312">fid_seq_in_fldb()</a>, <a class="el" href="seq__range_8h_source.html#l00081">fld_range_set_type()</a>, <a class="el" href="fld__handler_8c_source.html#l00241">fld_server_lookup()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_initialized</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__idl_8h_source.html#l00157">lu_seq_range::lsr_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l00156">lu_seq_range::lsr_index</a>, <a class="el" href="lustre__idl_8h_source.html#l00166">LU_SEQ_RANGE_MDT</a>, <a class="el" href="lustre__idl_8h_source.html#l00167">LU_SEQ_RANGE_OST</a>, <a class="el" href="lu__object_8h_source.html#l00661">lu_site2seq()</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__fid_8h_source.html#l00454">seq_server_site::ss_node_id</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00636">lod_generate_and_set_lovea()</a>, <a class="el" href="lod__object_8c_source.html#l04095">lod_object_init()</a>, <a class="el" href="lod__object_8c_source.html#l01462">lod_parse_dir_striping()</a>, <a class="el" href="lod__object_8c_source.html#l01406">lod_prep_lmv_md()</a>, and <a class="el" href="lod__sub__object_8c_source.html#l00057">lod_sub_get_thandle()</a>.</p>

</div>
</div>
<a class="anchor" id="acc2f1d73956f2bc9bf783129d95d2172"></a><!-- doxytag: member="lod_dev.c::lod_init" ref="acc2f1d73956f2bc9bf783129d95d2172" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __init lod_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01946">1946</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00167">class_register_type()</a>, <a class="el" href="genops_8c_source.html#l00103">class_search_type()</a>, <a class="el" href="lprocfs__status_8h_source.html#l00949">lprocfs_register()</a>, <a class="el" href="lu__object_8c_source.html#l02275">lu_kmem_fini()</a>, <a class="el" href="lu__object_8c_source.html#l02251">lu_kmem_init()</a>, <a class="el" href="obd_8h_source.html#l00452">LUSTRE_LOD_NAME</a>, <a class="el" href="obd_8h_source.html#l00464">LUSTRE_LOV_NAME</a>, <a class="el" href="lprocfs__status_8h_source.html#l00864">proc_lustre_root</a>, <a class="el" href="obd_8h_source.html#l00108">obd_type::typ_procroot</a>, and <a class="el" href="obd_8h_source.html#l00109">obd_type::typ_procsym</a>.</p>

</div>
</div>
<a class="anchor" id="a3fb2c2f0fabbb47345f2a8bbc6026e8e"></a><!-- doxytag: member="lod_dev.c::lod_init0" ref="a3fb2c2f0fabbb47345f2a8bbc6026e8e" args="(const struct lu_env *env, struct lod_device *lod, struct lu_device_type *ldt, struct lustre_cfg *cfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_init0 </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *&nbsp;</td>
          <td class="paramname"> <em>ldt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize LOD device at setup. </p>
<p>Initializes the given LOD device using the original configuration command. The function initiates a connection to the local OSD and initializes few internal structures like pools, target tables, etc.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ldt</em>&nbsp;</td><td>not used </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cfg</em>&nbsp;</td><td>configuration command</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01529">1529</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8h_source.html#l01724">dt_device::dd_ops</a>, <a class="el" href="dt__object_8h_source.html#l00082">dt_device_param::ddp_max_ea_size</a>, <a class="el" href="dt__object_8h_source.html#l02455">dt_conf_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="lod__internal_8h_source.html#l00169">lod_device::lod_child_exp</a>, <a class="el" href="lod__dev_8c_source.html#l01400">lod_connect_to_osd()</a>, <a class="el" href="lod__internal_8h_source.html#l00173">lod_device::lod_connects_lock</a>, <a class="el" href="lod__internal_8h_source.html#l00184">lod_device::lod_desc_lock</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00195">lod_device::lod_osd_max_easize</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l01372">lod_pools_fini()</a>, <a class="el" href="lod__lov_8c_source.html#l01280">lod_pools_init()</a>, <a class="el" href="lod__internal_8h.html#aa1423de5ddcf0377e6fcce6bd85cf936">lod_procfs_init()</a>, <a class="el" href="lod__dev_8c_source.html#l01495">lod_tgt_desc_init()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01606">lod_device_alloc()</a>.</p>

</div>
</div>
<a class="anchor" id="acc7cb42504dd2185d9ccba25733dfd1f"></a><!-- doxytag: member="lod_dev.c::lod_key_fini" ref="acc7cb42504dd2185d9ccba25733dfd1f" args="(const struct lu_context *ctx, struct lu_context_key *key, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lod_key_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__context.html">lu_context</a> *&nbsp;</td>
          <td class="paramname"> <em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__context__key.html">lu_context_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01749">1749</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00292">lod_thread_info::lti_ea_store</a>, <a class="el" href="lod__internal_8h_source.html#l00293">lod_thread_info::lti_ea_store_size</a>, <a class="el" href="lod__internal_8h_source.html#l00306">lod_thread_info::lti_linkea_buf</a>, <a class="el" href="lu__object_8c_source.html#l02339">lu_buf_free()</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, and <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>.</p>

</div>
</div>
<a class="anchor" id="a01d1aeee7d54b9087431e91816bbe4b9"></a><!-- doxytag: member="lod_dev.c::lod_obd_connect" ref="a01d1aeee7d54b9087431e91816bbe4b9" args="(const struct lu_env *env, struct obd_export **exp, struct obd_device *obd, struct obd_uuid *cluuid, struct obd_connect_data *data, void *localdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_obd_connect </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> **&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__uuid.html">obd_uuid</a> *&nbsp;</td>
          <td class="paramname"> <em>cluuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>localdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a248ee7dd4ea89c60d037c3094c9ca581">obd_ops::o_connect()</a> for LOD. </p>
<p>Used to track all the users of this specific LOD device, so the device stays up until the last user disconnected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export the caller will be using to access LOD </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obd</em>&nbsp;</td><td>OBD device representing LOD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cluuid</em>&nbsp;</td><td>unique identifier of the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>not used </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>localdata</em>&nbsp;</td><td>not used</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01678">1678</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="genops_8c_source.html#l01150">class_connect()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00153">D_CONFIG</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lod__internal_8h_source.html#l00174">lod_device::lod_connects</a>, <a class="el" href="lod__internal_8h_source.html#l00173">lod_device::lod_connects_lock</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a5a6b12d9fe4bf049125fb6b6676bdb2d"></a><!-- doxytag: member="lod_dev.c::lod_obd_disconnect" ref="a5a6b12d9fe4bf049125fb6b6676bdb2d" args="(struct obd_export *exp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_obd_disconnect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a1dfbddccaf8e568c531a466861c7df0b">obd_ops::o_disconnect()</a> for LOD. </p>
<p>When the caller doesn't need to use this LOD instance, it calls <a class="el" href="obd__class_8h.html#ad85654fa90b63bedfe72444557aacd35">obd_disconnect()</a> and LOD releases corresponding export/reference count. Once all the users gone, LOD device is released.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export provided to the caller in <a class="el" href="obd__class_8h.html#a84a51083a59bfff6555ea8d48a86a0f4" title="Create a new /a exp on device /a obd for the uuid /a cluuid.">obd_connect()</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01717">1717</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l01220">class_disconnect()</a>, <a class="el" href="obd__config_8c_source.html#l01909">class_manual_cleanup()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="lod__internal_8h_source.html#l00174">lod_device::lod_connects</a>, <a class="el" href="lod__internal_8h_source.html#l00173">lod_device::lod_connects_lock</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a537c9d13e61144f720c442dc1ec0aaff"></a><!-- doxytag: member="lod_dev.c::lod_obd_get_info" ref="a537c9d13e61144f720c442dc1ec0aaff" args="(const struct lu_env *env, struct obd_export *exp, __u32 keylen, void *key, __u32 *vallen, void *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_obd_get_info </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>keylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>vallen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>val</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structobd__ops.html#a5b1e6cee59585a39cf3a4c75d5b3fbd7">obd_ops::o_get_info()</a> for LOD. </p>
<p>Currently, there is only one supported key: KEY_OSP_CONNECTED , to provide the caller binary status whether LOD has seen connection to any OST target. It will also check if the MDT update log context being initialized (if needed).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>exp</em>&nbsp;</td><td>export of the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>keylen</em>&nbsp;</td><td>len of the key </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>key</em>&nbsp;</td><td>the key </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>vallen</em>&nbsp;</td><td>not used </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>val</em>&nbsp;</td><td>not used</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if a connection was seen </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EAGAIN</em>&nbsp;</td><td>if LOD isn't running yet or no connection has been seen yet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if not supported key is requested </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01811">1811</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="obd__support_8h_source.html#l00860">KEY_IS</a>, <a class="el" href="obd_8h_source.html#l00763">KEY_OSP_CONNECTED</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="lod__internal_8h_source.html#l00395">lod_foreach_mdt</a>, <a class="el" href="lod__internal_8h_source.html#l00391">lod_foreach_ost</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_active</a>, <a class="el" href="lod__internal_8h_source.html#l00121">lod_tgt_desc::ltd_exp</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00147">MDT_TGT</a>, <a class="el" href="obd__class_8h_source.html#l00505">obd_get_info()</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_set_up</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_stopping</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a19bff49051a7a6a242f538bdd20c784a"></a><!-- doxytag: member="lod_dev.c::lod_obd_set_info_async" ref="a19bff49051a7a6a242f538bdd20c784a" args="(const struct lu_env *env, struct obd_export *exp, __u32 keylen, void *key, __u32 vallen, void *val, struct ptlrpc_request_set *set)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_obd_set_info_async </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>keylen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>vallen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request__set.html">ptlrpc_request_set</a> *&nbsp;</td>
          <td class="paramname"> <em>set</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01876">1876</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="genops_8c_source.html#l00729">class_exp2obd()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lod__internal_8h_source.html#l00395">lod_foreach_mdt</a>, <a class="el" href="lod__internal_8h_source.html#l00391">lod_foreach_ost</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_active</a>, <a class="el" href="lod__internal_8h_source.html#l00121">lod_tgt_desc::ltd_exp</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00147">MDT_TGT</a>, <a class="el" href="obd_8h_source.html#l00595">obd_device::obd_lu_dev</a>, <a class="el" href="obd__class_8h_source.html#l00519">obd_set_info_async()</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, <a class="el" href="client_8c_source.html#l00913">ptlrpc_prep_set()</a>, <a class="el" href="client_8c_source.html#l00973">ptlrpc_set_destroy()</a>, <a class="el" href="client_8c_source.html#l02260">ptlrpc_set_wait()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a57b562bdcded602b848efc85f2e5c490"></a><!-- doxytag: member="lod_dev.c::lod_object_alloc" ref="a57b562bdcded602b848efc85f2e5c490" args="(const struct lu_env *env, const struct lu_object_header *hdr, struct lu_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structlu__object.html">lu_object</a>* lod_object_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *&nbsp;</td>
          <td class="paramname"> <em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">lu_device_operations::ldo_object_alloc()</a> for LOD. </p>
<p>Allocates and initializes LOD's slice in the given object.</p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00204">204</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01751">dt_object::do_ops</a>, <a class="el" href="dt__object_8c_source.html#l00170">dt_object_init()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lod__internal_8h_source.html#l00246">lod_object::ldo_obj</a>, <a class="el" href="lu__object_8h_source.html#l00476">lu_object::lo_ops</a>, <a class="el" href="lod__internal_8h_source.html#l00348">lod2lu_obj()</a>, <a class="el" href="lod__object_8c_source.html#l04264">lod_lu_obj_ops</a>, <a class="el" href="lod__internal_8h_source.html#l00353">lod_obj()</a>, <a class="el" href="lod__object_8c_source.html#l03982">lod_obj_ops</a>, <a class="el" href="lod__dev_8c_source.html#l00174">lod_object_kmem</a>, <a class="el" href="obd__support_8h_source.html#l00851">OBD_SLAB_ALLOC_PTR_GFP</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a6bc73b13cbf5e0bb51abd0a79e6b73a6"></a><!-- doxytag: member="lod_dev.c::lod_prepare" ref="a6bc73b13cbf5e0bb51abd0a79e6b73a6" args="(const struct lu_env *env, struct lu_device *pdev, struct lu_device *cdev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_prepare </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>pdev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>cdev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__operations.html#aae9b682bd4e9a56b8b74ef52ea9a77a9" title="initialize local objects for device.">lu_device_operations::ldo_prepare()</a> for LOD. </p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01105">1105</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8h_source.html#l02446">dt_root_get()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="structlu__device__operations.html#aae9b682bd4e9a56b8b74ef52ea9a77a9">lu_device_operations::ldo_prepare</a>, <a class="el" href="local__storage_8c_source.html#l00469">local_file_find_or_create_with_fid()</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_initialized</a>, <a class="el" href="lod__dev_8c_source.html#l00753">lod_prepare_distribute_txn()</a>, <a class="el" href="lod__dev_8c_source.html#l01072">lod_sub_init_llogs()</a>, <a class="el" href="lod__dev_8c_source.html#l00103">lod_update_log_dir_name</a>, <a class="el" href="lod__dev_8c_source.html#l00102">lod_update_log_name</a>, <a class="el" href="lod__internal_8h_source.html#l00297">lod_thread_info::lti_fid</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lu__object_8h_source.html#l00661">lu_site2seq()</a>, <a class="el" href="lustre__idl_8h_source.html#l00430">lu_update_log_dir_fid()</a>, <a class="el" href="lustre__idl_8h_source.html#l00423">lu_update_log_fid()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__fid_8h_source.html#l00454">seq_server_site::ss_node_id</a>.</p>

</div>
</div>
<a class="anchor" id="a9df7d330dcf90481945898868b4cb937"></a><!-- doxytag: member="lod_dev.c::lod_prepare_distribute_txn" ref="a9df7d330dcf90481945898868b4cb937" args="(const struct lu_env *env, struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_prepare_distribute_txn </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare distribute txn. </p>
<p>Prepare distribute txn structure for LOD</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em><a class="el" href="structlod__device.html">lod_device</a></em>&nbsp;</td><td>LOD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if preparation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if preparation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00753">753</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__object_8h_source.html#l00661">lu_site2seq()</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lu__target_8h_source.html#l00093">target_distribute_txn_data::tdtd_dt</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01105">lod_prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="ac2b7223c5ddbffeaae94eefafeacb6df"></a><!-- doxytag: member="lod_dev.c::lod_process_config" ref="ac2b7223c5ddbffeaae94eefafeacb6df" args="(const struct lu_env *env, struct lu_device *dev, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_process_config </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae" title="process config specific for device.">lu_device_operations::ldo_process_config()</a> for LOD. </p>
<p>The method is called by the configuration subsystem during setup, cleanup and when the configuration changes. The method processes few specific commands like adding/removing the targets, changing the runtime parameters.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dev</em>&nbsp;</td><td>lod device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lcfg</em>&nbsp;</td><td>configuration command to apply</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error</td></tr>
  </table>
  </dd>
</dl>
<p>The examples are below.</p>
<p>Add osc config log: marker 20 (flags=0x01, v2.2.49.56) lustre-OST0001 'add osc' add_uuid nid=192.168.122.162(0x20000c0a87aa2) 0: 1:nidxxx attach 0:lustre-OST0001-osc-MDT0001 1:osc 2:lustre-MDT0001-mdtlov_UUID setup 0:lustre-OST0001-osc-MDT0001 1:lustre-OST0001_UUID 2:nid lov_modify_tgts add 0:lustre-MDT0001-mdtlov 1:lustre-OST0001_UUID 2:1 3:1 marker 20 (flags=0x02, v2.2.49.56) lustre-OST0001 'add osc'</p>
<p>Add mdc config log: marker 10 (flags=0x01, v2.2.49.56) lustre-MDT0000 'add osp' add_uuid nid=192.168.122.162(0x20000c0a87aa2) 0: 1:nid attach 0:lustre-MDT0000-osp-MDT0001 1:osp 2:lustre-MDT0001-mdtlov_UUID setup 0:lustre-MDT0000-osp-MDT0001 1:lustre-MDT0000_UUID 2:nid modify_mdc_tgts add 0:lustre-MDT0001 1:lustre-MDT0000_UUID 2:0 3:1 marker 10 (flags=0x02, v2.2.49.56) lustre-MDT0000_UUID 'add osp' </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00840">840</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="genops_8c_source.html#l00429">class_name2obd()</a>, <a class="el" href="obd__config_8c_source.html#l01322">class_process_proc_param()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__cfg_8h_source.html#l00091">LCFG_ADD_MDC</a>, <a class="el" href="lustre__cfg_8h_source.html#l00075">LCFG_CLEANUP</a>, <a class="el" href="lustre__cfg_8h_source.html#l00130">lustre_cfg::lcfg_command</a>, <a class="el" href="lustre__cfg_8h_source.html#l00090">LCFG_LOV_ADD_INA</a>, <a class="el" href="lustre__cfg_8h_source.html#l00084">LCFG_LOV_ADD_OBD</a>, <a class="el" href="lustre__cfg_8h_source.html#l00085">LCFG_LOV_DEL_OBD</a>, <a class="el" href="lustre__cfg_8h_source.html#l00086">LCFG_PARAM</a>, <a class="el" href="lustre__cfg_8h_source.html#l00099">LCFG_PRE_CLEANUP</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae">lu_device_operations::ldo_process_config</a>, <a class="el" href="llog__osd_8c_source.html#l01872">llog_common_cat_ops</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="llog__obd_8c_source.html#l00146">llog_setup()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00169">lod_device::lod_child_exp</a>, <a class="el" href="lod__lov_8c_source.html#l00529">lod_del_device()</a>, <a class="el" href="lod__dev_8c_source.html#l00792">lod_fini_distribute_txn()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__dev_8c_source.html#l00720">lod_sub_fini_all_llogs()</a>, <a class="el" href="lod__dev_8c_source.html#l00482">lod_sub_fini_llog()</a>, <a class="el" href="lod__sub__object_8c_source.html#l00937">lod_sub_prep_llog()</a>, <a class="el" href="lod__dev_8c_source.html#l00239">lod_sub_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00676">lod_sub_stop_recovery_threads()</a>, <a class="el" href="lod__dev_8c_source.html#l00522">lodname2mdt_index()</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_active</a>, <a class="el" href="lod__internal_8h_source.html#l00124">lod_tgt_desc::ltd_index</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lu__object_8c_source.html#l01047">lu_dev_del_linkage()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00182">lustre_cfg_buf()</a>, <a class="el" href="lustre__cfg_8h_source.html#l00210">lustre_cfg_string()</a>, <a class="el" href="obd_8h_source.html#l00460">LUSTRE_MDC_NAME</a>, <a class="el" href="obd_8h_source.html#l00463">LUSTRE_OSC_NAME</a>, <a class="el" href="obd__class_8h_source.html#l00842">obd_disconnect()</a>, <a class="el" href="obd_8h_source.html#l00651">obd_device::obd_olg</a>, <a class="el" href="obd_8h_source.html#l00716">obd_device::obd_vars</a>, <a class="el" href="lustre__param_8h_source.html#l00114">PARAM_LOV</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a6f80959e06ef56e1188e6e08ec60b428"></a><!-- doxytag: member="lod_dev.c::lod_process_recovery_updates" ref="a6f80959e06ef56e1188e6e08ec60b428" args="(const struct lu_env *env, struct llog_handle *llh, struct llog_rec_hdr *rec, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_process_recovery_updates </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>llh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *&nbsp;</td>
          <td class="paramname"> <em>rec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>process update recovery record </p>
<p>Add the update recovery recode to the update recovery list in <a class="el" href="structlod__recovery__data.html">lod_recovery_data</a>. Then the recovery thread (target_recovery_thread) will redo these updates.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>log handle of update record </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>update record to be replayed </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>update recovery data which holds the necessary arguments for recovery (see struct <a class="el" href="structlod__recovery__data.html">lod_recovery_data</a>)</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the record is processed successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if the record processing fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00296">296</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="update__recovery_8c_source.html#l00373">insert_update_records_to_replay_list()</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lustre__idl_8h_source.html#l03346">llog_cookie::lgc_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03344">llog_cookie::lgc_lgl</a>, <a class="el" href="lustre__idl_8h_source.html#l03345">llog_cookie::lgc_subsys</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00372">lod_env_info()</a>, <a class="el" href="lod__dev_8c_source.html#l00522">lodname2mdt_index()</a>, <a class="el" href="lod__dev_8c_source.html#l00273">lod_recovery_data::lrd_lod</a>, <a class="el" href="lod__dev_8c_source.html#l00274">lod_recovery_data::lrd_ltd</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00124">lod_tgt_desc::ltd_index</a>, <a class="el" href="lod__internal_8h_source.html#l00309">lod_thread_info::lti_cookie</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_abort_recovery</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_stopping</a>, and <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00354">lod_sub_recovery_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a5dcf38890c4189c7c72782185dabcea8"></a><!-- doxytag: member="lod_dev.c::lod_recovery_complete" ref="a5dcf38890c4189c7c72782185dabcea8" args="(const struct lu_env *env, struct lu_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_recovery_complete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__device.html">lu_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">lu_device_operations::ldo_recovery_complete()</a> for LOD. </p>
<p>The method is called once the recovery is complete. This implementation distributes the notification to all the known targets.</p>
<p>see <a class="el" href="lu__object_8h.html">include/lu_object.h</a> for the details </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01029">1029</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">lu_device_operations::ldo_recovery_complete</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_recovery_completed</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00320">lu2lod_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a8eaff23b0df9d4cad621d33c7380a5a2"></a><!-- doxytag: member="lod_dev.c::lod_ro" ref="a8eaff23b0df9d4cad621d33c7380a5a2" args="(const struct lu_env *env, struct dt_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_ro </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a03deb463a9aebe843829c31bbab1c34d" title="Make device read-only.">dt_device_operations::dt_ro()</a> for LOD. </p>
<p>Turns local OSD read-only, used for the testing only.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01356">1356</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="dt__object_8h_source.html#l02473">dt_ro()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c0092593c142b2e2748456af52261d3"></a><!-- doxytag: member="lod_dev.c::lod_root_get" ref="a4c0092593c142b2e2748456af52261d3" args="(const struct lu_env *env, struct dt_device *dev, struct lu_fid *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_root_get </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#ad2a831d38be0be73f8a5498112e13b56" title="Return FID of root index object.">dt_device_operations::dt_root_get()</a> for LOD. </p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01184">1184</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="dt__object_8h_source.html#l02446">dt_root_get()</a>.</p>

</div>
</div>
<a class="anchor" id="aceed31e89b7f3d934d252cac6bfc1efd"></a><!-- doxytag: member="lod_dev.c::lod_statfs" ref="aceed31e89b7f3d934d252cac6bfc1efd" args="(const struct lu_env *env, struct dt_device *dev, struct obd_statfs *sfs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_statfs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__statfs.html">obd_statfs</a> *&nbsp;</td>
          <td class="paramname"> <em>sfs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_device_operations::dt_statfs()</a> for LOD. </p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01195">1195</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="dt__object_8h_source.html#l02437">dt_statfs()</a>.</p>

</div>
</div>
<a class="anchor" id="a85cddcc2846b69ac713ba4dbfd0346fa"></a><!-- doxytag: member="lod_dev.c::lod_sub_fini_all_llogs" ref="a85cddcc2846b69ac713ba4dbfd0346fa" args="(const struct lu_env *env, struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lod_sub_fini_all_llogs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>finish all sub llog </p>
<p>cleanup all of sub llog ctxt on the LOD.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device to do update recovery </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00720">720</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00192">lod_device::lod_child_recovery_thread</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__dev_8c_source.html#l00482">lod_sub_fini_llog()</a>, <a class="el" href="lod__internal_8h_source.html#l00127">lod_tgt_desc::ltd_recovery_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, and <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a4d4f051722ccdd8cd00ba9ec986dfc67"></a><!-- doxytag: member="lod_dev.c::lod_sub_fini_llog" ref="a4d4f051722ccdd8cd00ba9ec986dfc67" args="(const struct lu_env *env, struct dt_device *dt, struct ptlrpc_thread *thread)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lod_sub_fini_llog </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__thread.html">ptlrpc_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>thread</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>finish sub llog context </p>
<p>Stop update recovery thread for the sub device, then cleanup the correspondent llog ctxt.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device to do update recovery </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thread</em>&nbsp;</td><td>recovery thread on this sub device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00482">482</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="llog__cat_8c_source.html#l00271">llog_cat_close()</a>, <a class="el" href="llog__obd_8c_source.html#l00108">llog_cleanup()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, and <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00720">lod_sub_fini_all_llogs()</a>, and <a class="el" href="lod__dev_8c_source.html#l00578">lod_sub_init_llog()</a>.</p>

</div>
</div>
<a class="anchor" id="a580407458bfd72d5fde4a151dcb2e42f"></a><!-- doxytag: member="lod_dev.c::lod_sub_init_llog" ref="a580407458bfd72d5fde4a151dcb2e42f" args="(const struct lu_env *env, struct lod_device *lod, struct dt_device *dt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lod_sub_init_llog </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init sub llog context. </p>
<p>Setup update llog ctxt for update recovery threads, then start the recovery thread (lod_sub_recovery_thread) to read update llog from the correspondent MDT to do update recovery.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device to do update recovery </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dt</em>&nbsp;</td><td>sub dt device for which the recovery thread is</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if initialization succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if initialization fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00578">578</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lvfs_8h_source.html#l00061">lvfs_run_ctxt::dt</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="llog__osd_8c_source.html#l01872">llog_common_cat_ops</a>, <a class="el" href="llog__obd_8c_source.html#l00146">llog_setup()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00192">lod_device::lod_child_recovery_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__dev_8c_source.html#l00482">lod_sub_fini_llog()</a>, <a class="el" href="lod__dev_8c_source.html#l00354">lod_sub_recovery_thread()</a>, <a class="el" href="lod__dev_8c_source.html#l00522">lodname2mdt_index()</a>, <a class="el" href="lod__dev_8c_source.html#l00276">lod_recovery_data::lrd_idx</a>, <a class="el" href="lod__dev_8c_source.html#l00273">lod_recovery_data::lrd_lod</a>, <a class="el" href="lod__dev_8c_source.html#l00274">lod_recovery_data::lrd_ltd</a>, <a class="el" href="lod__dev_8c_source.html#l00275">lod_recovery_data::lrd_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00124">lod_tgt_desc::ltd_index</a>, <a class="el" href="lod__internal_8h_source.html#l00127">lod_tgt_desc::ltd_recovery_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00650">obd_device::obd_lvfs_ctxt</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00651">obd_device::obd_olg</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, and <a class="el" href="lod__dev_8c_source.html#l01072">lod_sub_init_llogs()</a>.</p>

</div>
</div>
<a class="anchor" id="a048c64bb5ed49d15acb528068422d009"></a><!-- doxytag: member="lod_dev.c::lod_sub_init_llogs" ref="a048c64bb5ed49d15acb528068422d009" args="(const struct lu_env *env, struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_sub_init_llogs </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init update logs on all sub device. </p>
<p>LOD initialize update logs on all of sub devices. Because the initialization process might need FLD lookup, see <a class="el" href="llog__osd_8c.html#a15a0048f1b7593c27f349f60d2d20bad" title="Implementation of the llog_operations::lop_open.">llog_osd_open()</a>-&gt;<a class="el" href="group__dt.html#gac653806b6ed3e5b8616d14fa74cecd72">dt_locate()</a>-&gt;...-&gt; <a class="el" href="lod__object_8c.html#a718ffb4659817d62ce24448b210c1163" title="Implementation of lu_object_operations::loo_object_init.">lod_object_init()</a>, this API has to be called after LOD is initialized. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if update log is initialized successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if initialization fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01072">1072</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_initialized</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__dev_8c_source.html#l00578">lod_sub_init_llog()</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01105">lod_prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="aa977234426ff8546ba49495f50385282"></a><!-- doxytag: member="lod_dev.c::lod_sub_process_config" ref="aa977234426ff8546ba49495f50385282" args="(const struct lu_env *env, struct lod_device *lod, struct lod_tgt_descs *ltd, struct lustre_cfg *lcfg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_sub_process_config </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *&nbsp;</td>
          <td class="paramname"> <em>lcfg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process the config log for all sub device. </p>
<p>The function goes through all the targets in the given table and apply given configuration command on to the targets. Used to cleanup the targets at unmount.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>LU environment provided by the caller </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target's table to go through </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lcfg</em>&nbsp;</td><td>configuration command to apply</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00239">239</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__cfg_8h_source.html#l00130">lustre_cfg::lcfg_command</a>, <a class="el" href="lu__object_8h_source.html#l00279">lu_device::ld_ops</a>, <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae">lu_device_operations::ldo_process_config</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, and <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="ae7ecb49ee35b0233cf02d67af71157a3"></a><!-- doxytag: member="lod_dev.c::lod_sub_recovery_thread" ref="ae7ecb49ee35b0233cf02d67af71157a3" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_sub_recovery_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>recovery thread for update log </p>
<p>Start recovery thread and prepare the sub llog, then it will retrieve the update records from the correpondent MDT and do recovery.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>arg</em>&nbsp;</td><td>pointer to the recovery data</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if recovery succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if recovery failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00354">354</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01024">LCT_LOCAL</a>, <a class="el" href="lu__object_8h_source.html#l00995">LCT_MD_THREAD</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="llog__cat_8c_source.html#l00271">llog_cat_close()</a>, <a class="el" href="llog__cat_8c_source.html#l00838">llog_cat_process()</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="lod__internal_8h_source.html#l00326">lod2lu_dev()</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00175">lod_device::lod_child_got_update_log</a>, <a class="el" href="lod__internal_8h_source.html#l00168">lod_device::lod_dt_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__dev_8c_source.html#l00296">lod_process_recovery_updates()</a>, <a class="el" href="lod__sub__object_8c_source.html#l00937">lod_sub_prep_llog()</a>, <a class="el" href="lod__dev_8c_source.html#l00276">lod_recovery_data::lrd_idx</a>, <a class="el" href="lod__dev_8c_source.html#l00273">lod_recovery_data::lrd_lod</a>, <a class="el" href="lod__dev_8c_source.html#l00274">lod_recovery_data::lrd_ltd</a>, <a class="el" href="lod__dev_8c_source.html#l00275">lod_recovery_data::lrd_thread</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__object_8h_source.html#l00619">lu_site::ls_top_dev</a>, <a class="el" href="lod__internal_8h_source.html#l00128">lod_tgt_desc::ltd_got_update_log</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00119">lod_tgt_desc::ltd_tgt</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_abort_recovery</a>, <a class="el" href="obd_8h_source.html#l00644">obd_device::obd_dev_lock</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00670">obd_device::obd_next_transno_waitq</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_stopping</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, <a class="el" href="lu__target_8h_source.html#l00114">target_distribute_txn_data::tdtd_recovery_threads_count</a>, <a class="el" href="lu__target_8h_source.html#l00115">target_distribute_txn_data::tdtd_recovery_threads_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00111">target_distribute_txn_data::tdtd_replay_ready</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00578">lod_sub_init_llog()</a>.</p>

</div>
</div>
<a class="anchor" id="a9d2a101a178e46aea9731c4d47a96076"></a><!-- doxytag: member="lod_dev.c::lod_sub_stop_recovery_threads" ref="a9d2a101a178e46aea9731c4d47a96076" args="(const struct lu_env *env, struct lod_device *lod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void lod_sub_stop_recovery_threads </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__device.html">lod_device</a> *&nbsp;</td>
          <td class="paramname"> <em>lod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop sub recovery thread. </p>
<p>Stop sub recovery thread on all subs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device to do update recovery </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00676">676</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00116">cfs_foreach_bit</a>, <a class="el" href="lod__internal_8h_source.html#l00192">lod_device::lod_child_recovery_thread</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00189">lod_device::lod_mdt_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00127">lod_tgt_desc::ltd_recovery_thread</a>, <a class="el" href="lod__internal_8h_source.html#l00142">LTD_TGT</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, and <a class="el" href="obd_8c_source.html#l00114">thread</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>.</p>

</div>
</div>
<a class="anchor" id="a5665f5c830d6803c95dd3816b7a55139"></a><!-- doxytag: member="lod_dev.c::lod_sync" ref="a5665f5c830d6803c95dd3816b7a55139" args="(const struct lu_env *env, struct dt_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_sync </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_device_operations::dt_sync()</a> for LOD. </p>
<p>Syncs all known OST targets. Very very expensive and used rarely by LFSCK now. Should not be used in general.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01323">1323</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, <a class="el" href="dt__object_8h_source.html#l02465">dt_sync()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lod__internal_8h_source.html#l00331">lod2obd()</a>, <a class="el" href="lod__internal_8h_source.html#l00170">lod_device::lod_child</a>, <a class="el" href="lod__internal_8h_source.html#l00391">lod_foreach_ost</a>, <a class="el" href="lod__lov_8c_source.html#l00055">lod_getref()</a>, <a class="el" href="lod__internal_8h_source.html#l00220">lod_ost_desc</a>, <a class="el" href="lod__internal_8h_source.html#l00187">lod_device::lod_ost_descs</a>, <a class="el" href="lod__lov_8c_source.html#l00073">lod_putref()</a>, <a class="el" href="lod__internal_8h_source.html#l00146">OST_TGT</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="af36f92e59ae36d7598523b8cb9e2ddc7"></a><!-- doxytag: member="lod_dev.c::lod_tgt_desc_init" ref="af36f92e59ae36d7598523b8cb9e2ddc7" args="(struct lod_tgt_descs *ltd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_tgt_desc_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlod__tgt__descs.html">lod_tgt_descs</a> *&nbsp;</td>
          <td class="paramname"> <em>ltd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate and initialize target table. </p>
<p>A helper function to initialize the target table and allocate a bitmap of the available targets.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ltd</em>&nbsp;</td><td>target's table to initialize</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>negated errno on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01495">1495</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="bitmap_8h_source.html#l00049">CFS_ALLOCATE_BITMAP()</a>, <a class="el" href="lod__internal_8h_source.html#l00158">lod_tgt_descs::ltd_death_row</a>, <a class="el" href="lod__internal_8h_source.html#l00162">lod_tgt_descs::ltd_mutex</a>, <a class="el" href="lod__internal_8h_source.html#l00160">lod_tgt_descs::ltd_refcount</a>, <a class="el" href="lod__internal_8h_source.html#l00164">lod_tgt_descs::ltd_rw_sem</a>, <a class="el" href="lod__internal_8h_source.html#l00156">lod_tgt_descs::ltd_tgt_bitmap</a>, <a class="el" href="lod__internal_8h_source.html#l00154">lod_tgt_descs::ltd_tgtnr</a>, <a class="el" href="lod__internal_8h_source.html#l00152">lod_tgt_descs::ltd_tgts_size</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01529">lod_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a2df506c5efa8c66c87fbd996e78c10e3"></a><!-- doxytag: member="lod_dev.c::lod_trans_cb_add" ref="a2df506c5efa8c66c87fbd996e78c10e3" args="(struct thandle *th, struct dt_txn_commit_cb *dcb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_trans_cb_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>dcb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01236">1236</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02077">dt_trans_cb_add()</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

</div>
</div>
<a class="anchor" id="a28002e7a2598f4328875e0b4e28bd22d"></a><!-- doxytag: member="lod_dev.c::lod_trans_create" ref="a28002e7a2598f4328875e0b4e28bd22d" args="(const struct lu_env *env, struct dt_device *dt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structthandle.html">thandle</a>* lod_trans_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_device_operations::dt_trans_create()</a> for LOD. </p>
<p>Creates a transaction using local (to this node) OSD.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01208">1208</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, and <a class="el" href="update__trans_8c_source.html#l00598">top_trans_create()</a>.</p>

</div>
</div>
<a class="anchor" id="ae983a440718cac156dfbeef30e94902e"></a><!-- doxytag: member="lod_dev.c::lod_trans_start" ref="ae983a440718cac156dfbeef30e94902e" args="(const struct lu_env *env, struct dt_device *dt, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_trans_start </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_device_operations::dt_trans_start()</a> for LOD. </p>
<p>Starts the set of local transactions using the targets involved in declare phase. Initial support for the distributed transactions.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01230">1230</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, and <a class="el" href="update__trans_8c_source.html#l00784">top_trans_start()</a>.</p>

</div>
</div>
<a class="anchor" id="ab14f0ab246c1cdb3a433e44ce54346cb"></a><!-- doxytag: member="lod_dev.c::lod_trans_stop" ref="ab14f0ab246c1cdb3a433e44ce54346cb" args="(const struct lu_env *env, struct dt_device *dt, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lod_trans_stop </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of <a class="el" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_device_operations::dt_trans_stop()</a> for LOD. </p>
<p>Stops the set of local transactions using the targets involved in declare phase. Initial support for the distributed transactions.</p>
<p>see <a class="el" href="dt__object_8h.html">include/dt_object.h</a> for the details. </p>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01288">1288</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="lod__internal_8h_source.html#l00336">dt2lod_dev()</a>, <a class="el" href="lod__dev_8c_source.html#l01258">lod_add_noop_records()</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00573">OBD_FAIL_SPLIT_UPDATE_REC</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="a18aec61bfeeaf9843029b0b96b701be2"></a><!-- doxytag: member="lod_dev.c::lodname2mdt_index" ref="a18aec61bfeeaf9843029b0b96b701be2" args="(char *lodname, __u32 *mdt_index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lodname2mdt_index </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>lodname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32 *&nbsp;</td>
          <td class="paramname"> <em>mdt_index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extract MDT target index from a device name. </p>
<p>a helper function to extract index from the given device name like "fsname-MDTxxxx-mdtlov"</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lodname</em>&nbsp;</td><td>device name </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>mdt_index</em>&nbsp;</td><td>extracted index</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>if the name is invalid </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00522">522</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00296">lod_process_recovery_updates()</a>, <a class="el" href="lod__dev_8c_source.html#l00578">lod_sub_init_llog()</a>, and <a class="el" href="lod__sub__object_8c_source.html#l00937">lod_sub_prep_llog()</a>.</p>

</div>
</div>
<a class="anchor" id="a530baf0bb8b0b8ca492ab7bf1a04313d"></a><!-- doxytag: member="lod_dev.c::LU_CONTEXT_KEY_DEFINE" ref="a530baf0bb8b0b8ca492ab7bf1a04313d" args="(lod, LCT_MD_THREAD)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_CONTEXT_KEY_DEFINE </td>
          <td>(</td>
          <td class="paramtype">lod&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LCT_MD_THREAD&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a83bc7422d80ed1054837ee8bc041b251"></a><!-- doxytag: member="lod_dev.c::LU_KEY_INIT" ref="a83bc7422d80ed1054837ee8bc041b251" args="(lod, struct lod_thread_info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_KEY_INIT </td>
          <td>(</td>
          <td class="paramtype">lod&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlod__thread__info.html">lod_thread_info</a>&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4985cde132cca52231eadca9b5ac293d"></a><!-- doxytag: member="lod_dev.c::LU_TYPE_INIT_FINI" ref="a4985cde132cca52231eadca9b5ac293d" args="(lod,&amp;lod_thread_key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LU_TYPE_INIT_FINI </td>
          <td>(</td>
          <td class="paramtype">lod&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&amp;&nbsp;</td>
          <td class="paramname"> <em>lod_thread_key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="adc10f40acba3bb9b2640e985276b0a7c"></a><!-- doxytag: member="lod_dev.c::MODULE_AUTHOR" ref="adc10f40acba3bb9b2640e985276b0a7c" args="(&quot;OpenSFS, Inc. &lt;http://www.lustre.org/&gt;&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_AUTHOR </td>
          <td>(</td>
          <td class="paramtype">&quot;&nbsp;</td>
          <td class="paramname"> <em>OpenSFS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Inc.&lt; http://www.lustre.org/&gt;&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0d962c1e4005dbdadcb5be58b6eaa08d"></a><!-- doxytag: member="lod_dev.c::MODULE_DESCRIPTION" ref="a0d962c1e4005dbdadcb5be58b6eaa08d" args="(&quot;Lustre Logical Object Device (&quot;LUSTRE_LOD_NAME&quot;)&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_DESCRIPTION </td>
          <td>(</td>
          <td class="paramtype">&quot;Lustre Logical Object Device (&quot;LUSTRE_LOD_NAME&quot;)&quot;&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a260a476a86b914b91699b83d556c3633"></a><!-- doxytag: member="lod_dev.c::module_exit" ref="a260a476a86b914b91699b83d556c3633" args="(lod_exit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_exit </td>
          <td>(</td>
          <td class="paramtype">lod_exit&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9f0f89c2545ed41ba1b7f7b9c7c95e29"></a><!-- doxytag: member="lod_dev.c::module_init" ref="a9f0f89c2545ed41ba1b7f7b9c7c95e29" args="(lod_init)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module_init </td>
          <td>(</td>
          <td class="paramtype">lod_init&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ad94b36675e7eb067ea3ce6ff9e244a44"></a><!-- doxytag: member="lod_dev.c::MODULE_LICENSE" ref="ad94b36675e7eb067ea3ce6ff9e244a44" args="(&quot;GPL&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_LICENSE </td>
          <td>(</td>
          <td class="paramtype">&quot;GPL&quot;&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae9c321be2136fb8501887ee69dac11a2"></a><!-- doxytag: member="lod_dev.c::MODULE_VERSION" ref="ae9c321be2136fb8501887ee69dac11a2" args="(LUSTRE_VERSION_STRING)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MODULE_VERSION </td>
          <td>(</td>
          <td class="paramtype">LUSTRE_VERSION_STRING&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a4671c9dd142a6d2a3a7c74f9f5fea451"></a><!-- doxytag: member="lod_dev.c::lod_caches" ref="a4671c9dd142a6d2a3a7c74f9f5fea451" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__kmem__descr.html">lu_kmem_descr</a> <a class="el" href="lod__dev_8c.html#a4671c9dd142a6d2a3a7c74f9f5fea451">lod_caches</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        {
                .ckd_cache = &amp;<a class="code" href="lod__dev_8c.html#a20d9d14ad2c941c7f89468ffa4045273">lod_object_kmem</a>,
                .ckd_name  = <span class="stringliteral">&quot;lod_obj&quot;</span>,
                .ckd_size  = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structlod__object.html">lod_object</a>)
        },
        {
                .ckd_cache = &amp;<a class="code" href="lod__dev_8c.html#a6f0a57f9e9cbc5b128be06f53e46bc91">lod_txn_callback_kmem</a>,
                .ckd_name  = <span class="stringliteral">&quot;lod_txn_callback&quot;</span>,
                .ckd_size  = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structdt__txn__callback.html" title="Transaction call-backs.">dt_txn_callback</a>)
        },
        {
                .ckd_cache = NULL
        }
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00178">178</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a963cebf3067374bd6a8364e52399dfa0"></a><!-- doxytag: member="lod_dev.c::lod_device_type" ref="a963cebf3067374bd6a8364e52399dfa0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__type.html">lu_device_type</a> <a class="el" href="lod__dev_8c.html#a963cebf3067374bd6a8364e52399dfa0">lod_device_type</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldt_tags     = <a class="code" href="group__lu.html#ggaa318f5b20c40de1d564f59dd72726345a5b8da75da353b465f5ddc30d87c931d9" title="this is data device">LU_DEVICE_DT</a>,
        .ldt_name     = <a class="code" href="obd_8h.html#af96412f3059a1c0f53e5fe8c598a17da">LUSTRE_LOD_NAME</a>,
        .ldt_ops      = &amp;<a class="code" href="lod__dev_8c.html#ad7e7a5e3f80f074a795c18e534fa3da8">lod_device_type_ops</a>,
        .ldt_ctx_tags = <a class="code" href="group__lu.html#ggad7e2d14b1b91480b0b25656f63169a0aa51f264f8e3ea36a381cf8aaaa9672752" title="Thread on md server.">LCT_MD_THREAD</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01784">1784</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad7e7a5e3f80f074a795c18e534fa3da8"></a><!-- doxytag: member="lod_dev.c::lod_device_type_ops" ref="ad7e7a5e3f80f074a795c18e534fa3da8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__type__operations.html">lu_device_type_operations</a> <a class="el" href="lod__dev_8c.html#ad7e7a5e3f80f074a795c18e534fa3da8">lod_device_type_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldto_init           = lod_type_init,
        .ldto_fini           = lod_type_fini,

        .ldto_start          = lod_type_start,
        .ldto_stop           = lod_type_stop,

        .ldto_device_alloc   = <a class="code" href="lod__dev_8c.html#a01728d1d503ea85413471d33e293ab0b" title="Implementation of lu_device_type_operations::ldto_device_alloc() for LOD.">lod_device_alloc</a>,
        .ldto_device_free    = <a class="code" href="lod__dev_8c.html#a24b04502af64652e9bbc27ae8815bfd6" title="Implementation of lu_device_type_operations::ldto_device_free() for LOD.">lod_device_free</a>,

        .ldto_device_fini    = <a class="code" href="lod__dev_8c.html#a9542c37e4f4695806e51423abda32fea" title="Implementation of lu_device_type_operations::ldto_device_fini() for LOD.">lod_device_fini</a>
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01771">1771</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a73cc554f264f4898099d51ce33ca75e3"></a><!-- doxytag: member="lod_dev.c::lod_dt_ops" ref="a73cc554f264f4898099d51ce33ca75e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdt__device__operations.html">dt_device_operations</a> <a class="el" href="lod__dev_8c.html#a73cc554f264f4898099d51ce33ca75e3">lod_dt_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .dt_root_get         = <a class="code" href="lod__dev_8c.html#a4c0092593c142b2e2748456af52261d3" title="Implementation of dt_device_operations::dt_root_get() for LOD.">lod_root_get</a>,
        .dt_statfs           = <a class="code" href="lod__dev_8c.html#aceed31e89b7f3d934d252cac6bfc1efd" title="Implementation of dt_device_operations::dt_statfs() for LOD.">lod_statfs</a>,
        .dt_trans_create     = <a class="code" href="lod__dev_8c.html#a28002e7a2598f4328875e0b4e28bd22d" title="Implementation of dt_device_operations::dt_trans_create() for LOD.">lod_trans_create</a>,
        .dt_trans_start      = <a class="code" href="lod__dev_8c.html#ae983a440718cac156dfbeef30e94902e" title="Implementation of dt_device_operations::dt_trans_start() for LOD.">lod_trans_start</a>,
        .dt_trans_stop       = <a class="code" href="lod__dev_8c.html#ab14f0ab246c1cdb3a433e44ce54346cb" title="Implementation of dt_device_operations::dt_trans_stop() for LOD.">lod_trans_stop</a>,
        .dt_conf_get         = <a class="code" href="lod__dev_8c.html#a6be0139c54e038491f23522be76e4cc8" title="Implementation of dt_device_operations::dt_conf_get() for LOD.">lod_conf_get</a>,
        .dt_sync             = <a class="code" href="lod__dev_8c.html#a5665f5c830d6803c95dd3816b7a55139" title="Implementation of dt_device_operations::dt_sync() for LOD.">lod_sync</a>,
        .dt_ro               = <a class="code" href="lod__dev_8c.html#a8eaff23b0df9d4cad621d33c7380a5a2" title="Implementation of dt_device_operations::dt_ro() for LOD.">lod_ro</a>,
        .dt_commit_async     = <a class="code" href="lod__dev_8c.html#aedb2b67d829acbbb48640933e89e01ee" title="Implementation of dt_device_operations::dt_commit_async() for LOD.">lod_commit_async</a>,
        .dt_trans_cb_add     = <a class="code" href="lod__dev_8c.html#a2df506c5efa8c66c87fbd996e78c10e3">lod_trans_cb_add</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01373">1373</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a72093e53bdf476ef11cc91965a07991f"></a><!-- doxytag: member="lod_dev.c::lod_lu_ops" ref="a72093e53bdf476ef11cc91965a07991f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__device__operations.html">lu_device_operations</a> <a class="el" href="lod__internal_8h.html#a72093e53bdf476ef11cc91965a07991f">lod_lu_ops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .ldo_object_alloc       = <a class="code" href="lod__dev_8c.html#a57b562bdcded602b848efc85f2e5c490" title="Implementation of lu_device_operations::ldo_object_alloc() for LOD.">lod_object_alloc</a>,
        .ldo_process_config     = <a class="code" href="lod__dev_8c.html#ac2b7223c5ddbffeaae94eefafeacb6df" title="Implementation of lu_device_operations::ldo_process_config() for LOD.">lod_process_config</a>,
        .ldo_recovery_complete  = <a class="code" href="lod__dev_8c.html#a5dcf38890c4189c7c72782185dabcea8" title="Implementation of lu_device_operations::ldo_recovery_complete() for LOD.">lod_recovery_complete</a>,
        .ldo_prepare            = <a class="code" href="lod__dev_8c.html#a6bc73b13cbf5e0bb51abd0a79e6b73a6" title="Implementation of lu_device_operations::ldo_prepare() for LOD.">lod_prepare</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01172">1172</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>Referenced by <a class="el" href="lod__internal_8h_source.html#l00315">lu_device_is_lod()</a>.</p>

</div>
</div>
<a class="anchor" id="a00fa4dacd72ccd1310f0928988252877"></a><!-- doxytag: member="lod_dev.c::lod_obd_device_ops" ref="a00fa4dacd72ccd1310f0928988252877" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structobd__ops.html">obd_ops</a> <a class="el" href="lod__dev_8c.html#a00fa4dacd72ccd1310f0928988252877">lod_obd_device_ops</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .o_owner        = THIS_MODULE,
        .o_connect      = <a class="code" href="lod__dev_8c.html#a01d1aeee7d54b9087431e91816bbe4b9" title="Implementation of obd_ops::o_connect() for LOD.">lod_obd_connect</a>,
        .o_disconnect   = <a class="code" href="lod__dev_8c.html#a5a6b12d9fe4bf049125fb6b6676bdb2d" title="Implementation of obd_ops::o_disconnect() for LOD.">lod_obd_disconnect</a>,
        .o_get_info     = <a class="code" href="lod__dev_8c.html#a537c9d13e61144f720c442dc1ec0aaff" title="Implementation of obd_ops::o_get_info() for LOD.">lod_obd_get_info</a>,
        .o_set_info_async = <a class="code" href="lod__dev_8c.html#a19bff49051a7a6a242f538bdd20c784a">lod_obd_set_info_async</a>,
        .o_pool_new     = <a class="code" href="lod__internal_8h.html#ac6fc44bfd045a27ab59c17185443c46a" title="Allocate a new pool for the specified device.">lod_pool_new</a>,
        .o_pool_rem     = <a class="code" href="lod__internal_8h.html#a84ae23967718a25e3168650a991f65c9" title="Remove the named target from the specified pool.">lod_pool_remove</a>,
        .o_pool_add     = <a class="code" href="lod__internal_8h.html#a0cab6622ab68dbb7af618ea38d371403" title="Add a single target device to the named pool.">lod_pool_add</a>,
        .o_pool_del     = <a class="code" href="lod__internal_8h.html#a6275dc528c9d9e9e83e762bc650bd75f" title="Remove the named pool from the OBD device.">lod_pool_del</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l01934">1934</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a20d9d14ad2c941c7f89468ffa4045273"></a><!-- doxytag: member="lod_dev.c::lod_object_kmem" ref="a20d9d14ad2c941c7f89468ffa4045273" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct kmem_cache* <a class="el" href="lod__internal_8h.html#a20d9d14ad2c941c7f89468ffa4045273">lod_object_kmem</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00174">174</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00204">lod_object_alloc()</a>, and <a class="el" href="lod__object_8c_source.html#l04222">lod_object_free()</a>.</p>

</div>
</div>
<a class="anchor" id="a6f0a57f9e9cbc5b128be06f53e46bc91"></a><!-- doxytag: member="lod_dev.c::lod_txn_callback_kmem" ref="a6f0a57f9e9cbc5b128be06f53e46bc91" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct kmem_cache* <a class="el" href="lod__dev_8c.html#a6f0a57f9e9cbc5b128be06f53e46bc91">lod_txn_callback_kmem</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00177">177</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6208ec56b58a20e08ca69e1896b28829"></a><!-- doxytag: member="lod_dev.c::lod_update_log_dir_name" ref="a6208ec56b58a20e08ca69e1896b28829" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="lod__dev_8c.html#a6208ec56b58a20e08ca69e1896b28829">lod_update_log_dir_name</a>[] = &quot;update_log_dir&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00103">103</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01105">lod_prepare()</a>.</p>

</div>
</div>
<a class="anchor" id="adffaec81915db9ffe7637d375a61b2e4"></a><!-- doxytag: member="lod_dev.c::lod_update_log_name" ref="adffaec81915db9ffe7637d375a61b2e4" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="lod__dev_8c.html#adffaec81915db9ffe7637d375a61b2e4">lod_update_log_name</a>[] = &quot;update_log&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lod__dev_8c_source.html#l00102">102</a> of file <a class="el" href="lod__dev_8c_source.html">lod_dev.c</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01105">lod_prepare()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
