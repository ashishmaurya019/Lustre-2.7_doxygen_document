<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lu_device_operations Struct Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lu_device_operations Struct Reference<br/>
<small>
[<a class="el" href="group__lu.html">lu</a>]</small>
</h1><!-- doxytag: class="lu_device_operations" -->
<p>Operations common for data and meta-data devices.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="lu__object_8h_source.html">lu_object.h</a>&gt;</code></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlu__object.html">lu_object</a> *(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0">ldo_object_alloc</a> )(const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *h, struct <a class="el" href="structlu__device.html">lu_device</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate object for the given device (without lower-layer parts).  <a href="#a2d0d0803131da38c837d16ab6f979fb0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae">ldo_process_config</a> )(const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">process config specific for device.  <a href="#a892c61097c7e02dd33e5a9148d339dae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">ldo_recovery_complete</a> )(const struct <a class="el" href="structlu__env.html">lu_env</a> *, struct <a class="el" href="structlu__device.html">lu_device</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__device__operations.html#aae9b682bd4e9a56b8b74ef52ea9a77a9">ldo_prepare</a> )(const struct <a class="el" href="structlu__env.html">lu_env</a> *, struct <a class="el" href="structlu__device.html">lu_device</a> *parent, struct <a class="el" href="structlu__device.html">lu_device</a> *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize local objects for device.  <a href="#aae9b682bd4e9a56b8b74ef52ea9a77a9"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Operations common for data and meta-data devices. </p>

<p>Definition at line <a class="el" href="lu__object_8h_source.html#l00109">109</a> of file <a class="el" href="lu__object_8h_source.html">lu_object.h</a>.</p>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="a2d0d0803131da38c837d16ab6f979fb0"></a><!-- doxytag: member="lu_device_operations::ldo_object_alloc" ref="a2d0d0803131da38c837d16ab6f979fb0" args=")(const struct lu_env *env, const struct lu_object_header *h, struct lu_device *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlu__object.html">lu_object</a>*(* <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0">lu_device_operations::ldo_object_alloc</a>)(const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct <a class="el" href="structlu__object__header.html">lu_object_header</a> *h, struct <a class="el" href="structlu__device.html">lu_device</a> *d)<code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate object for the given device (without lower-layer parts). </p>
<p>This is called by <a class="el" href="structlu__object__operations.html#a15b69dd7ca43e31bee4023da49fbb8a8" title="Allocate lower-layer parts of the object by calling lu_device_operations::ldo_object_alloc()...">lu_object_operations::loo_object_init()</a> from the parent layer, and should setup at least <a class="el" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lu_object::lo_dev</a> and <a class="el" href="structlu__object.html#a9a5e60cbf9d474fb4039dbb0d39e0a0f" title="Operations for this object.">lu_object::lo_ops</a> fields of resulting <a class="el" href="structlu__object.html" title="Layer in the layered object.">lu_object</a>.</p>
<p>Object creation protocol.</p>
<p>Due to design goal of avoiding recursion, object creation (see <a class="el" href="lu__object_8c.html#acfb33c7901c60e05b9561ef7c5f93f01" title="Allocate new object.">lu_object_alloc()</a>) is somewhat involved:</p>
<ul>
<li>first, <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">lu_device_operations::ldo_object_alloc()</a> method of the top-level device in the stack is called. It should allocate top level object (including <a class="el" href="structlu__object__header.html" title="&quot;Compound&quot; object, consisting of multiple layers.">lu_object_header</a>), but without any lower-layer sub-object(s).</li>
</ul>
<ul>
<li>then <a class="el" href="lu__object_8c.html#acfb33c7901c60e05b9561ef7c5f93f01" title="Allocate new object.">lu_object_alloc()</a> sets fid in the header of newly created object.</li>
</ul>
<ul>
<li>then <a class="el" href="structlu__object__operations.html#a15b69dd7ca43e31bee4023da49fbb8a8" title="Allocate lower-layer parts of the object by calling lu_device_operations::ldo_object_alloc()...">lu_object_operations::loo_object_init()</a> is called. It has to allocate lower-layer object(s). To do this, <a class="el" href="structlu__object__operations.html#a15b69dd7ca43e31bee4023da49fbb8a8" title="Allocate lower-layer parts of the object by calling lu_device_operations::ldo_object_alloc()...">lu_object_operations::loo_object_init()</a> calls <a class="el" href="structlu__device__operations.html#a2d0d0803131da38c837d16ab6f979fb0" title="Allocate object for the given device (without lower-layer parts).">ldo_object_alloc()</a> of the lower-layer device(s).</li>
</ul>
<ul>
<li>for all new objects allocated by <a class="el" href="structlu__object__operations.html#a15b69dd7ca43e31bee4023da49fbb8a8" title="Allocate lower-layer parts of the object by calling lu_device_operations::ldo_object_alloc()...">lu_object_operations::loo_object_init()</a> (and inserted into object stack), <a class="el" href="structlu__object__operations.html#a15b69dd7ca43e31bee4023da49fbb8a8" title="Allocate lower-layer parts of the object by calling lu_device_operations::ldo_object_alloc()...">lu_object_operations::loo_object_init()</a> is called again repeatedly, until no new objects are created.</li>
</ul>
<dl class="post"><dt><b>Postcondition:</b></dt><dd>ergo(!IS_ERR(result), result-&gt;lo_dev == d &amp;&amp; result-&gt;lo_ops != NULL); </dd></dl>

<p>Referenced by <a class="el" href="echo__client_8c_source.html#l00463">echo_object_init()</a>, <a class="el" href="lod__object_8c_source.html#l04095">lod_object_init()</a>, <a class="el" href="lovsub__object_8c_source.html#l00055">lovsub_object_init()</a>, <a class="el" href="local__storage_8c_source.html#l00041">ls_object_init()</a>, <a class="el" href="lu__object_8c_source.html#l00236">lu_object_alloc()</a>, <a class="el" href="mdd__object_8c_source.html#l00143">mdd_object_init()</a>, <a class="el" href="mdt__handler_8c_source.html#l04863">mdt_object_init()</a>, <a class="el" href="mgs__handler_8c_source.html#l01278">mgs_object_init()</a>, <a class="el" href="ofd__dev_8c_source.html#l00403">ofd_object_init()</a>, and <a class="el" href="vvp__object_8c_source.html#l00239">vvp_object_init()</a>.</p>

</div>
</div>
<a class="anchor" id="aae9b682bd4e9a56b8b74ef52ea9a77a9"></a><!-- doxytag: member="lu_device_operations::ldo_prepare" ref="aae9b682bd4e9a56b8b74ef52ea9a77a9" args=")(const struct lu_env *, struct lu_device *parent, struct lu_device *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="structlu__device__operations.html#aae9b682bd4e9a56b8b74ef52ea9a77a9">lu_device_operations::ldo_prepare</a>)(const struct <a class="el" href="structlu__env.html">lu_env</a> *, struct <a class="el" href="structlu__device.html">lu_device</a> *parent, struct <a class="el" href="structlu__device.html">lu_device</a> *dev)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize local objects for device. </p>
<p>this method called after layer has been initialized (after LCFG_SETUP stage) and before it starts serving user requests. </p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l01105">lod_prepare()</a>, <a class="el" href="mdd__device_8c_source.html#l00990">mdd_prepare()</a>, <a class="el" href="mdt__handler_8c_source.html#l04915">mdt_prepare()</a>, <a class="el" href="mdt__handler_8c_source.html#l04175">mdt_quota_init()</a>, <a class="el" href="ofd__dev_8c_source.html#l00576">ofd_prepare()</a>, and <a class="el" href="obd__mount__server_8c_source.html#l01275">server_start_targets()</a>.</p>

</div>
</div>
<a class="anchor" id="a892c61097c7e02dd33e5a9148d339dae"></a><!-- doxytag: member="lu_device_operations::ldo_process_config" ref="a892c61097c7e02dd33e5a9148d339dae" args=")(const struct lu_env *env, struct lu_device *, struct lustre_cfg *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="structlu__device__operations.html#a892c61097c7e02dd33e5a9148d339dae">lu_device_operations::ldo_process_config</a>)(const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__device.html">lu_device</a> *, struct <a class="el" href="structlustre__cfg.html">lustre_cfg</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>process config specific for device. </p>

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__dev_8c_source.html#l00840">lod_process_config()</a>, <a class="el" href="lod__dev_8c_source.html#l00239">lod_sub_process_config()</a>, <a class="el" href="obd__mount__server_8c_source.html#l00890">lustre_disconnect_lwp()</a>, <a class="el" href="mdd__device_8c_source.html#l00894">mdd_process_config()</a>, <a class="el" href="mdt__handler_8c_source.html#l04765">mdt_process_config()</a>, <a class="el" href="mdt__handler_8c_source.html#l03948">mdt_stack_fini()</a>, <a class="el" href="mdt__handler_8c_source.html#l03914">mdt_stack_pre_fini()</a>, <a class="el" href="ofd__dev_8c_source.html#l00319">ofd_process_config()</a>, and <a class="el" href="ofd__dev_8c_source.html#l00220">ofd_stack_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="a0786583fdaf5ff6bf3f4aaa4e48d3dd9"></a><!-- doxytag: member="lu_device_operations::ldo_recovery_complete" ref="a0786583fdaf5ff6bf3f4aaa4e48d3dd9" args=")(const struct lu_env *, struct lu_device *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* <a class="el" href="structlu__device__operations.html#a0786583fdaf5ff6bf3f4aaa4e48d3dd9">lu_device_operations::ldo_recovery_complete</a>)(const struct <a class="el" href="structlu__env.html">lu_env</a> *, struct <a class="el" href="structlu__device.html">lu_device</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="lod__lov_8c_source.html#l00207">lod_add_device()</a>, <a class="el" href="lod__dev_8c_source.html#l01029">lod_recovery_complete()</a>, <a class="el" href="mdd__device_8c_source.html#l00932">mdd_recovery_complete()</a>, <a class="el" href="mdt__handler_8c_source.html#l05951">mdt_postrecov()</a>, <a class="el" href="ofd__obd_8c_source.html#l00541">ofd_postrecov()</a>, and <a class="el" href="ofd__dev_8c_source.html#l00634">ofd_recovery_complete()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>lustre/include/<a class="el" href="lu__object_8h_source.html">lu_object.h</a></li>
</ul>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:53 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
