<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/obdclass/llog_osd.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/obdclass/llog_osd.c File Reference</h1><code>#include &lt;<a class="el" href="dt__object_8h_source.html">dt_object.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="llog__swab_8h_source.html">llog_swab.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__fid_8h_source.html">lustre_fid.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="llog__internal_8h_source.html">llog_internal.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="local__storage_8h_source.html">local_storage.h</a>&quot;</code><br/>

<p><a href="llog__osd_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_LOG</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a703162228e6b9d622f021dfdf98e2c5f">llog_osd_declare_new_object</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlocal__oid__storage.html">local_oid_storage</a> *los, struct <a class="el" href="structdt__object.html">dt_object</a> *o, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#ad999e480d8c46187a83855f78e8184ab" title="Create new llog file.">llog_operations::lop_declare_create</a>.  <a href="#a703162228e6b9d622f021dfdf98e2c5f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#ab55ed325ef6cc14db41407b7ccafb05e">llog_osd_create_new_object</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlocal__oid__storage.html">local_oid_storage</a> *los, struct <a class="el" href="structdt__object.html">dt_object</a> *o, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a5334de987fe3f3a3d5fc7c4a25abeffc">llog_operations::lop_create</a>.  <a href="#ab55ed325ef6cc14db41407b7ccafb05e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#af2003cfedd906dda94b841c2fe49426c">llog_osd_exist</a> (struct <a class="el" href="structllog__handle.html">llog_handle</a> *handle)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#ada3ec98e78c44d6186c26adf91f807a6" title="Opened llog may not exist and this must be checked where needed using the llog_exist()...">llog_operations::lop_exist</a>.  <a href="#af2003cfedd906dda94b841c2fe49426c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a405b25ccc88249c69bcc0091ee895ff5">llog_osd_pad</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *o, loff_t *off, int len, int index, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write a padding record to the llog.  <a href="#a405b25ccc88249c69bcc0091ee895ff5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#aa23ec0fdfb6ef404f70535025246a926">llog_osd_read_header</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *handle)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#aa56eaf539028c053fba807755f2e52c6">llog_operations::lop_read_header</a>.  <a href="#aa23ec0fdfb6ef404f70535025246a926"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#ae8c1da0561c89c2ba9f6d7abeaee107e">llog_osd_declare_write_rec</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *rec, int idx, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the llog_operations::lop_declare_write.  <a href="#ae8c1da0561c89c2ba9f6d7abeaee107e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a94ac29ab2a4d1639d8df2d91f623a463">llog_osd_write_rec</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *rec, struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *reccookie, int idx, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the llog_operations::lop_write.  <a href="#a94ac29ab2a4d1639d8df2d91f623a463"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a300bddd6538a482283063962bd9f9396">llog_skip_over</a> (struct <a class="el" href="structllog__handle.html">llog_handle</a> *lgh, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *off, int curr, int goal, __u32 chunk_size, bool force_mini_rec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">We can skip reading at least as many log blocks as the number of minimum sized log records we are skipping.  <a href="#a300bddd6538a482283063962bd9f9396"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#aa233b70a5febd6cf9ce5fec84281bdb9">changelog_block_trim_ext</a> (struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *hdr, struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *last_hdr, enum <a class="el" href="group__lustreuser.html#gafd9a43c6bdc39d72c3113806a84be46a">changelog_rec_flags</a> flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove optional fields that the client doesn't expect.  <a href="#aa233b70a5febd6cf9ce5fec84281bdb9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a3a0bc4e046edb33d59782631311f9713">llog_osd_next_block</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, int *cur_idx, int next_idx, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *cur_offset, void *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#ad0ec4a0a2f4dc80122b545f96bfafe19">llog_operations::lop_next_block</a>.  <a href="#a3a0bc4e046edb33d59782631311f9713"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#aa7acf12dc8cf42cc52a0a64417f7f92c">llog_osd_prev_block</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, int prev_idx, void *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a2c18ae2dbd35efba4c2ea1189d9b42bf">llog_operations::lop_prev_block</a>.  <a href="#aa7acf12dc8cf42cc52a0a64417f7f92c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a568471acd25c888f48423ff6144fb47c">llog_osd_dir_get</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__ctxt.html">llog_ctxt</a> *ctxt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is helper function to get llog directory object.  <a href="#a568471acd25c888f48423ff6144fb47c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a15a0048f1b7593c27f349f60d2d20bad">llog_osd_open</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *handle, struct <a class="el" href="structllog__logid.html">llog_logid</a> *logid, char *<a class="el" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, enum <a class="el" href="group__log.html#ga2f1ab12fceef20a1f6a2c3fbf3b28afa">llog_open_param</a> open_param)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a139a9f0deac13b8017cc19644232ecfb" title="Any llog file must be opened first using llog_open().">llog_operations::lop_open</a>.  <a href="#a15a0048f1b7593c27f349f60d2d20bad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#af4156e45907c009fd2628a45fcb44fe5">llog_osd_get_regular_fid_dir</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dto)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get dir for regular fid log object.  <a href="#af4156e45907c009fd2628a45fcb44fe5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a94087d848745b291cce9528317bc6a62">llog_osd_regular_fid_add_name_entry</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dto, struct <a class="el" href="structthandle.html">thandle</a> *th, bool declare)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add llog object with regular FID to name entry.  <a href="#a94087d848745b291cce9528317bc6a62"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a03f597a3138f4fa7b48751d3e64c891e">llog_osd_declare_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *res, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#ad999e480d8c46187a83855f78e8184ab" title="Create new llog file.">llog_operations::lop_declare_create</a>.  <a href="#a03f597a3138f4fa7b48751d3e64c891e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a11804ee62c8072b806f8fcd6e8875a94">llog_osd_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *res, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a5334de987fe3f3a3d5fc7c4a25abeffc">llog_operations::lop_create</a>.  <a href="#a11804ee62c8072b806f8fcd6e8875a94"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#ae2d64f268148debe83cd6efda5631ee5">llog_osd_close</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *handle)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#ad1e04ab8212c5c53d654ea391c870b28" title="Close llog file and calls llog_free_handle() implicitly.">llog_operations::lop_close</a>.  <a href="#ae2d64f268148debe83cd6efda5631ee5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#adb38958e697ad62fcc881e3b08bd0ca3">llog_osd_regular_fid_del_name_entry</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dto, struct <a class="el" href="structthandle.html">thandle</a> *th, bool declare)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">delete llog object name entry  <a href="#adb38958e697ad62fcc881e3b08bd0ca3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a3f22e9f58c9c979f1f742b103d4b38ca">llog_osd_declare_destroy</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a5ef863efa13a5e4eaf5920b176c9bd66">llog_operations::lop_declare_destroy</a>.  <a href="#a3f22e9f58c9c979f1f742b103d4b38ca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#aedeb99dc42e4ca4b7c5af87b83f65ef7">llog_osd_destroy</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__handle.html">llog_handle</a> *loghandle, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a12902ffa891d835b9dc331d13f58316a">llog_operations::lop_destroy</a>.  <a href="#aedeb99dc42e4ca4b7c5af87b83f65ef7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#af6da39451ffafd7d0da5fda66083bc94">llog_osd_setup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structobd__device.html">obd_device</a> *obd, struct <a class="el" href="structobd__llog__group.html">obd_llog_group</a> *olg, int ctxt_idx, struct <a class="el" href="structobd__device.html">obd_device</a> *disk_obd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#aa60c77a514c92bec4f788b6e624697a1">llog_operations::lop_setup</a>.  <a href="#af6da39451ffafd7d0da5fda66083bc94"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="llog__osd_8c.html#a0f88ba52baf14269662c58f42c69629f">llog_osd_cleanup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__ctxt.html">llog_ctxt</a> *ctxt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of the <a class="el" href="structllog__operations.html#a27c3479a9b5464a027e1be85e128bb5c">llog_operations::lop_cleanup</a>.  <a href="#a0f88ba52baf14269662c58f42c69629f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__log.html#gaf0dee2455ecbe5cbeeec044344224613">llog_osd_get_cat_list</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *d, int idx, int count, struct <a class="el" href="structllog__catid.html">llog_catid</a> *idarray, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the special file which contains the list of llog catalogs IDs.  <a href="group__log.html#gaf0dee2455ecbe5cbeeec044344224613"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__log.html#ga4b308f3bee04638c301ba0bead3ad070">llog_osd_put_cat_list</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *d, int idx, int count, struct <a class="el" href="structllog__catid.html">llog_catid</a> *idarray, const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write the special file which contains the list of llog catalogs IDs.  <a href="group__log.html#ga4b308f3bee04638c301ba0bead3ad070"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structllog__operations.html">llog_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__log.html#ga9fe78077b320f0957c7c7c3e8052aaaa">llog_osd_ops</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structllog__operations.html">llog_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__log.html#gaf91e7b25f0a5c9ca6385440f60b7b375">llog_common_cat_ops</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="llog_osd.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_LOG</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00045">45</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa233b70a5febd6cf9ce5fec84281bdb9"></a><!-- doxytag: member="llog_osd.c::changelog_block_trim_ext" ref="aa233b70a5febd6cf9ce5fec84281bdb9" args="(struct llog_rec_hdr *hdr, struct llog_rec_hdr *last_hdr, enum changelog_rec_flags flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void changelog_block_trim_ext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *&nbsp;</td>
          <td class="paramname"> <em>hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *&nbsp;</td>
          <td class="paramname"> <em>last_hdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__lustreuser.html#gafd9a43c6bdc39d72c3113806a84be46a">changelog_rec_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove optional fields that the client doesn't expect. </p>
<p>This is typically in order to ensure compatibility with older clients. It is assumed that since we exclusively remove fields, the block will be big enough to handle the remapped records. It is also assumed that records of a block have the same format (i.e.: the same features enabled).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>hdr</em>&nbsp;</td><td>Header of the block of records to remap. </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>last_hdr</em>&nbsp;</td><td>Last header, don't read past this point. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>flags</em>&nbsp;</td><td>Flags describing the fields to keep. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00787">787</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l03098">CHANGELOG_REC</a>, <a class="el" href="lustre__user_8h_source.html#l00969">changelog_remap_rec()</a>, <a class="el" href="lustre__user_8h_source.html#l00864">changelog_rec::cr_flags</a>, <a class="el" href="llog__internal_8h_source.html#l00101">llog_rec_hdr_next()</a>, and <a class="el" href="lustre__idl_8h_source.html#l03116">llog_rec_hdr::lrh_type</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l00820">llog_osd_next_block()</a>, and <a class="el" href="llog__osd_8c_source.html#l00998">llog_osd_prev_block()</a>.</p>

</div>
</div>
<a class="anchor" id="a0f88ba52baf14269662c58f42c69629f"></a><!-- doxytag: member="llog_osd.c::llog_osd_cleanup" ref="a0f88ba52baf14269662c58f42c69629f" args="(const struct lu_env *env, struct llog_ctxt *ctxt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_cleanup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__ctxt.html">llog_ctxt</a> *&nbsp;</td>
          <td class="paramname"> <em>ctxt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a27c3479a9b5464a027e1be85e128bb5c">llog_operations::lop_cleanup</a>. </p>
<p>This function cleanups the llog on local storage.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctxt</em>&nbsp;</td><td>the llog context</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01839">1839</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="lustre__log_8h_source.html#l00322">llog_ctxt::loc_los_named</a>, <a class="el" href="lustre__log_8h_source.html#l00321">llog_ctxt::loc_los_nameless</a>, and <a class="el" href="local__storage_8c_source.html#l00936">local_oid_storage_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="ae2d64f268148debe83cd6efda5631ee5"></a><!-- doxytag: member="llog_osd.c::llog_osd_close" ref="ae2d64f268148debe83cd6efda5631ee5" args="(const struct lu_env *env, struct llog_handle *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_close </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#ad1e04ab8212c5c53d654ea391c870b28" title="Close llog file and calls llog_free_handle() implicitly.">llog_operations::lop_close</a>. </p>
<p>This function closes the llog. It just put llog object and referenced local storage.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>handle</em>&nbsp;</td><td>llog handle of the current llog</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful llog close </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01561">1561</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="local__storage_8c_source.html#l00703">dt_los_put()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lu__object_8c_source.html#l00193">lu_object_put_nocache()</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="lustre__log_8h_source.html#l00284">llog_handle::private_data</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a11804ee62c8072b806f8fcd6e8875a94"></a><!-- doxytag: member="llog_osd.c::llog_osd_create" ref="a11804ee62c8072b806f8fcd6e8875a94" args="(const struct lu_env *env, struct llog_handle *res, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a5334de987fe3f3a3d5fc7c4a25abeffc">llog_operations::lop_create</a>. </p>
<p>This function creates the llog according with <a class="el" href="structllog__handle.html#afa5bbd13c6d5f5760b79ec0f01856a49">llog_handle::lgh_obj</a> and <a class="el" href="structllog__handle.html#a45fc53375d1efb244bdd0ee880c85191">llog_handle::lgh_name</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>res</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful create </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01473">1473</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8h_source.html#l02120">dt_create()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8h_source.html#l00447">LA_SIZE</a>, <a class="el" href="lu__object_8h_source.html#l00452">LA_TYPE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00055">llog_thread_info::lgi_dof</a>, <a class="el" href="llog__internal_8h_source.html#l00059">llog_thread_info::lgi_dt_rec</a>, <a class="el" href="llog__internal_8h_source.html#l00054">llog_thread_info::lgi_fid</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="llog__osd_8c_source.html#l00099">llog_osd_create_new_object()</a>, <a class="el" href="llog__osd_8c_source.html#l01120">llog_osd_dir_get()</a>, <a class="el" href="llog__osd_8c_source.html#l01342">llog_osd_regular_fid_add_name_entry()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="lustre__log__user_8h_source.html#l00046">logid_to_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__log_8h_source.html#l00284">llog_handle::private_data</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ab55ed325ef6cc14db41407b7ccafb05e"></a><!-- doxytag: member="llog_osd.c::llog_osd_create_new_object" ref="ab55ed325ef6cc14db41407b7ccafb05e" args="(const struct lu_env *env, struct local_oid_storage *los, struct dt_object *o, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_create_new_object </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlocal__oid__storage.html">local_oid_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>los</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a5334de987fe3f3a3d5fc7c4a25abeffc">llog_operations::lop_create</a>. </p>
<p>This function is a wrapper over local_storage API function <a class="el" href="group__dt.html#gaa288349ab34fbd660c1382182b57808b">local_object_create()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>los</em>&nbsp;</td><td>local_storage for bottom storage device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>o</em>&nbsp;</td><td><a class="el" href="structdt__object.html">dt_object</a> to create </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful creation of the new object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if creation was failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00099">99</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00055">llog_thread_info::lgi_dof</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, and <a class="el" href="local__storage_8c_source.html#l00251">local_object_create()</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01473">llog_osd_create()</a>.</p>

</div>
</div>
<a class="anchor" id="a03f597a3138f4fa7b48751d3e64c891e"></a><!-- doxytag: member="llog_osd.c::llog_osd_declare_create" ref="a03f597a3138f4fa7b48751d3e64c891e" args="(const struct lu_env *env, struct llog_handle *res, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_declare_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#ad999e480d8c46187a83855f78e8184ab" title="Create new llog file.">llog_operations::lop_declare_create</a>. </p>
<p>This function declares the llog create. It declares also name insert into llog directory in case of named llog.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>res</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful create declaration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01392">1392</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8h_source.html#l02103">dt_declare_create()</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8h_source.html#l00447">LA_SIZE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00055">llog_thread_info::lgi_dof</a>, <a class="el" href="llog__internal_8h_source.html#l00059">llog_thread_info::lgi_dt_rec</a>, <a class="el" href="llog__internal_8h_source.html#l00054">llog_thread_info::lgi_fid</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="llog__osd_8c_source.html#l00070">llog_osd_declare_new_object()</a>, <a class="el" href="llog__osd_8c_source.html#l01120">llog_osd_dir_get()</a>, <a class="el" href="llog__osd_8c_source.html#l01342">llog_osd_regular_fid_add_name_entry()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="lustre__log__user_8h_source.html#l00046">logid_to_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__log_8h_source.html#l00284">llog_handle::private_data</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a3f22e9f58c9c979f1f742b103d4b38ca"></a><!-- doxytag: member="llog_osd.c::llog_osd_declare_destroy" ref="a3f22e9f58c9c979f1f742b103d4b38ca" args="(const struct lu_env *env, struct llog_handle *loghandle, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_declare_destroy </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a5ef863efa13a5e4eaf5920b176c9bd66">llog_operations::lop_declare_destroy</a>. </p>
<p>This function declare destroys the llog and deletes also entry in the llog directory in case of named llog. Llog should be opened prior that.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful destroy </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01648">1648</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02137">dt_declare_destroy()</a>, <a class="el" href="dt__object_8h_source.html#l02292">dt_declare_ref_del()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="llog__osd_8c_source.html#l01120">llog_osd_dir_get()</a>, <a class="el" href="llog__osd_8c_source.html#l01604">llog_osd_regular_fid_del_name_entry()</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a703162228e6b9d622f021dfdf98e2c5f"></a><!-- doxytag: member="llog_osd.c::llog_osd_declare_new_object" ref="a703162228e6b9d622f021dfdf98e2c5f" args="(const struct lu_env *env, struct local_oid_storage *los, struct dt_object *o, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_declare_new_object </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlocal__oid__storage.html">local_oid_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>los</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#ad999e480d8c46187a83855f78e8184ab" title="Create new llog file.">llog_operations::lop_declare_create</a>. </p>
<p>This function is a wrapper over local_storage API function <a class="el" href="group__dt.html#gad041ecb776afdf707f6e829a043e7cc2">local_object_declare_create()</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>los</em>&nbsp;</td><td>local_storage for bottom storage device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>o</em>&nbsp;</td><td><a class="el" href="structdt__object.html">dt_object</a> to create </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful declaration of the new object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if declaration was failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00070">70</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00055">llog_thread_info::lgi_dof</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, and <a class="el" href="local__storage_8c_source.html#l00218">local_object_declare_create()</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01392">llog_osd_declare_create()</a>.</p>

</div>
</div>
<a class="anchor" id="ae8c1da0561c89c2ba9f6d7abeaee107e"></a><!-- doxytag: member="llog_osd.c::llog_osd_declare_write_rec" ref="ae8c1da0561c89c2ba9f6d7abeaee107e" args="(const struct lu_env *env, struct llog_handle *loghandle, struct llog_rec_hdr *rec, int idx, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_declare_write_rec </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *&nbsp;</td>
          <td class="paramname"> <em>rec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the llog_operations::lop_declare_write. </p>
<p>This function declares the new record write.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rec</em>&nbsp;</td><td>llog record header. This is a real header of the full llog record to write. This is the beginning of buffer to write, the length of buffer is stored in <em>rec::lrh_len</em> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>index of the llog record. If <em>idx</em> == -1 then this is append case, otherwise <em>idx</em> is the index of record to modify </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful declaration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if declaration failed </td></tr>
  </table>
  </dd>
</dl>

<p><p>the pad record can be inserted so take into account double record size</p>
</p>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00307">307</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02087">dt_declare_record_write()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__log_8h_source.html#l00325">llog_ctxt::loc_chunk_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="aedeb99dc42e4ca4b7c5af87b83f65ef7"></a><!-- doxytag: member="llog_osd.c::llog_osd_destroy" ref="aedeb99dc42e4ca4b7c5af87b83f65ef7" args="(const struct lu_env *env, struct llog_handle *loghandle, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_destroy </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a12902ffa891d835b9dc331d13f58316a">llog_operations::lop_destroy</a>. </p>
<p>This function destroys the llog and deletes also entry in the llog directory in case of named llog. Llog should be opened prior that. Destroy method is not part of external transaction and does everything inside.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful destroy </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01712">1712</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02151">dt_destroy()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="dt__object_8h_source.html#l02305">dt_ref_del()</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="llog__osd_8c_source.html#l01120">llog_osd_dir_get()</a>, <a class="el" href="llog__osd_8c_source.html#l01604">llog_osd_regular_fid_del_name_entry()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a568471acd25c888f48423ff6144fb47c"></a><!-- doxytag: member="llog_osd.c::llog_osd_dir_get" ref="a568471acd25c888f48423ff6144fb47c" args="(const struct lu_env *env, struct llog_ctxt *ctxt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdt__object.html">dt_object</a>* llog_osd_dir_get </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__ctxt.html">llog_ctxt</a> *&nbsp;</td>
          <td class="paramname"> <em>ctxt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is helper function to get llog directory object. </p>
<p>It is used by named llog operations to find/insert/delete llog entry from llog directory.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctxt</em>&nbsp;</td><td>llog context</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structdt__object.html">dt_object</a></em>&nbsp;</td><td>of llog directory </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR</em>&nbsp;</td><td>of negative value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01120">1120</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lvfs_8h_source.html#l00061">lvfs_run_ctxt::dt</a>, <a class="el" href="dt__object_8h_source.html#l02711">dt_info()</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8h_source.html#l02446">dt_root_get()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="dt__object_8h_source.html#l02700">dt_thread_info::dti_fid</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00320">llog_ctxt::loc_dir</a>, <a class="el" href="lustre__log_8h_source.html#l00312">llog_ctxt::loc_exp</a>, <a class="el" href="lu__object_8h_source.html#l00709">lu_object_get()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, and <a class="el" href="obd_8h_source.html#l00650">obd_device::obd_lvfs_ctxt</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01473">llog_osd_create()</a>, <a class="el" href="llog__osd_8c_source.html#l01392">llog_osd_declare_create()</a>, <a class="el" href="llog__osd_8c_source.html#l01648">llog_osd_declare_destroy()</a>, <a class="el" href="llog__osd_8c_source.html#l01712">llog_osd_destroy()</a>, and <a class="el" href="llog__osd_8c_source.html#l01168">llog_osd_open()</a>.</p>

</div>
</div>
<a class="anchor" id="af2003cfedd906dda94b841c2fe49426c"></a><!-- doxytag: member="llog_osd.c::llog_osd_exist" ref="af2003cfedd906dda94b841c2fe49426c" args="(struct llog_handle *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_exist </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#ada3ec98e78c44d6186c26adf91f807a6" title="Opened llog may not exist and this must be checked where needed using the llog_exist()...">llog_operations::lop_exist</a>. </p>
<p>This function checks that llog exists on storage.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>handle</em>&nbsp;</td><td>llog handle of the current llog</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>if llog object exists and is not just destroyed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>if llog doesn't exist or just destroyed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00124">124</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lu__object_8h_source.html#l00468">lu_object::lo_header</a>, and <a class="el" href="lu__object_8h_source.html#l00719">lu_object_is_dying()</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l00372">llog_osd_write_rec()</a>.</p>

</div>
</div>
<a class="anchor" id="af4156e45907c009fd2628a45fcb44fe5"></a><!-- doxytag: member="llog_osd.c::llog_osd_get_regular_fid_dir" ref="af4156e45907c009fd2628a45fcb44fe5" args="(const struct lu_env *env, struct dt_object *dto)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdt__object.html">dt_object</a>* llog_osd_get_regular_fid_dir </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dto</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get dir for regular fid log object. </p>
<p>Get directory for regular fid log object, and these regular fid log object will be inserted under this directory, to satisfy the FS consistency check, e2fsck etc.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dto</em>&nbsp;</td><td>llog object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the directory if it is found. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(negative</em>&nbsp;</td><td>errno) if it fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01295">1295</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l01926">dt_locate()</a>, <a class="el" href="dt__object_8c_source.html#l00184">dt_try_as_dir()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="seq__range_8h_source.html#l00109">fld_range_set_any()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00645">lu_site::ld_seq_site</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="llog__internal_8h_source.html#l00054">llog_thread_info::lgi_fid</a>, <a class="el" href="llog__internal_8h_source.html#l00060">llog_thread_info::lgi_range</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="structlu__server__fld.html#af5b50bd0685dbc4d18ba3b33b337e2cc">lu_server_fld::lsf_seq_lookup</a>, <a class="el" href="lustre__idl_8h_source.html#l00156">lu_seq_range::lsr_index</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lustre__idl_8h_source.html#l00430">lu_update_log_dir_fid()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01342">llog_osd_regular_fid_add_name_entry()</a>, and <a class="el" href="llog__osd_8c_source.html#l01604">llog_osd_regular_fid_del_name_entry()</a>.</p>

</div>
</div>
<a class="anchor" id="a3a0bc4e046edb33d59782631311f9713"></a><!-- doxytag: member="llog_osd.c::llog_osd_next_block" ref="a3a0bc4e046edb33d59782631311f9713" args="(const struct lu_env *env, struct llog_handle *loghandle, int *cur_idx, int next_idx, __u64 *cur_offset, void *buf, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_next_block </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>cur_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>next_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>cur_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#ad0ec4a0a2f4dc80122b545f96bfafe19">llog_operations::lop_next_block</a>. </p>
<p>This function finds the the next llog block to return which contains record with required index. It is main part of llog processing.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>cur_idx</em>&nbsp;</td><td>index preceeding cur_offset </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>next_idx</em>&nbsp;</td><td>target index to find </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>cur_offset</em>&nbsp;</td><td>furtherst point read in the file </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>pointer to data buffer to fill </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>len</em>&nbsp;</td><td>required len to read, it is usually llog chunk_size.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful buffer read </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00820">820</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="llog__osd_8c_source.html#l00787">changelog_block_trim_ext()</a>, <a class="el" href="lustre__user_8h_source.html#l00752">CLF_RENAME</a>, <a class="el" href="lustre__user_8h_source.html#l00751">CLF_VERSION</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8c_source.html#l00469">dt_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00266">llog_handle::lgh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="lustre__idl_8h_source.html#l03065">llog_logid::lgl_ogen</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l03312">llog_log_hdr::llh_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03307">llog_log_hdr::llh_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l03289">LLOG_F_EXT_JOBID</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__idl_8h_source.html#l03106">LLOG_REC_HDR_NEEDS_SWABBING</a>, <a class="el" href="llog__osd_8c_source.html#l00750">llog_skip_over()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l03115">llog_rec_hdr::lrh_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03122">llog_rec_tail::lrt_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03121">llog_rec_tail::lrt_len</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="llog__swab_8c_source.html#l00146">lustre_swab_llog_rec()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a15a0048f1b7593c27f349f60d2d20bad"></a><!-- doxytag: member="llog_osd.c::llog_osd_open" ref="a15a0048f1b7593c27f349f60d2d20bad" args="(const struct lu_env *env, struct llog_handle *handle, struct llog_logid *logid, char *name, enum llog_open_param open_param)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_open </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__logid.html">llog_logid</a> *&nbsp;</td>
          <td class="paramname"> <em>logid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__log.html#ga2f1ab12fceef20a1f6a2c3fbf3b28afa">llog_open_param</a>&nbsp;</td>
          <td class="paramname"> <em>open_param</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a139a9f0deac13b8017cc19644232ecfb" title="Any llog file must be opened first using llog_open().">llog_operations::lop_open</a>. </p>
<p>This function opens the llog by its logid or by name, it may open also non existent llog and assing then new id to it. The llog_open/llog_close pair works similar to lu_object_find/put, the object may not exist prior open. The result of open is just <a class="el" href="structdt__object.html">dt_object</a> in the llog header.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>handle</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>logid</em>&nbsp;</td><td>logid of llog to open (nameless llog) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>name of llog to open (named llog) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>open_param</em>&nbsp;</td><td>LLOG_OPEN_NEW - new llog, may not exist LLOG_OPEN_EXIST - old llog, must exist</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful open, <a class="el" href="structllog__handle.html#afa5bbd13c6d5f5760b79ec0f01856a49">llog_handle::lgh_obj</a> contains the <a class="el" href="structdt__object.html">dt_object</a> of the llog. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01168">1168</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lvfs_8h_source.html#l00061">lvfs_run_ctxt::dt</a>, <a class="el" href="dt__object_8c_source.html#l00236">dt_locate_at()</a>, <a class="el" href="dt__object_8c_source.html#l00224">dt_lookup_dir()</a>, <a class="el" href="local__storage_8c_source.html#l00689">dt_los_find()</a>, <a class="el" href="local__storage_8c_source.html#l00703">dt_los_put()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8h_source.html#l02165">dt_read_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02185">dt_read_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00209">obd_export::exp_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l00280">FID_SEQ_LLOG</a>, <a class="el" href="lustre__idl_8h_source.html#l00284">FID_SEQ_LLOG_NAME</a>, <a class="el" href="lustre__log__user_8h_source.html#l00060">fid_to_logid()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00054">llog_thread_info::lgi_fid</a>, <a class="el" href="lustre__log_8h_source.html#l00306">LLOG_CTXT_FLAG_NORMAL_FID</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__log_8h_source.html#l00065">LLOG_OPEN_NEW</a>, <a class="el" href="llog__osd_8c_source.html#l01120">llog_osd_dir_get()</a>, <a class="el" href="lustre__log_8h_source.html#l00312">llog_ctxt::loc_exp</a>, <a class="el" href="lu__object_8h_source.html#l00171">LOC_F_NEW</a>, <a class="el" href="lu__object_8h_source.html#l00187">lu_object_conf::loc_flags</a>, <a class="el" href="lustre__log_8h_source.html#l00319">llog_ctxt::loc_flags</a>, <a class="el" href="local__storage_8c_source.html#l00196">local_object_fid_generate()</a>, <a class="el" href="lustre__log__user_8h_source.html#l00046">logid_to_fid()</a>, <a class="el" href="local__storage_8c_source.html#l00142">ls_device_get()</a>, <a class="el" href="local__storage_8c_source.html#l00176">ls_device_put()</a>, <a class="el" href="local__storage_8h_source.html#l00068">ls_locate()</a>, <a class="el" href="local__storage_8h_source.html#l00050">ls_device::ls_los_mutex</a>, <a class="el" href="lu__object_8h_source.html#l00619">lu_site::ls_top_dev</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__class_8h_source.html#l00879">obd_fid_alloc()</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd_8h_source.html#l00650">obd_device::obd_lvfs_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00284">llog_handle::private_data</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a405b25ccc88249c69bcc0091ee895ff5"></a><!-- doxytag: member="llog_osd.c::llog_osd_pad" ref="a405b25ccc88249c69bcc0091ee895ff5" args="(const struct lu_env *env, struct dt_object *o, loff_t *off, int len, int index, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_pad </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t *&nbsp;</td>
          <td class="paramname"> <em>off</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write a padding record to the llog. </p>
<p>This function writes a padding record to the end of llog. That may be needed if llog contains records of variable size, e.g. config logs or changelogs. The padding record just aligns llog to the llog chunk_size boundary if the current record doesn't fit in the remaining space.</p>
<p>It allocates full length to avoid two separate writes for header and tail. Such 2-steps scheme needs extra protection and complex error handling.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>o</em>&nbsp;</td><td><a class="el" href="structdt__object.html">dt_object</a> to create </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>off</em>&nbsp;</td><td>pointer to the padding start offset </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>len</em>&nbsp;</td><td>padding length </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>index of the padding record in a llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful padding write </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if write failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00153">153</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__idl_8h_source.html#l03304">LLOG_MIN_REC_SIZE</a>, <a class="el" href="packet-lustre_8c_source.html#l00340">LLOG_PAD_MAGIC</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__idl_8h_source.html#l03115">llog_rec_hdr::lrh_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03116">llog_rec_hdr::lrh_type</a>, <a class="el" href="lustre__idl_8h_source.html#l03122">llog_rec_tail::lrt_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03121">llog_rec_tail::lrt_len</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__idl_8h_source.html#l03133">rec_tail()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l00372">llog_osd_write_rec()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7acf12dc8cf42cc52a0a64417f7f92c"></a><!-- doxytag: member="llog_osd.c::llog_osd_prev_block" ref="aa7acf12dc8cf42cc52a0a64417f7f92c" args="(const struct lu_env *env, struct llog_handle *loghandle, int prev_idx, void *buf, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_prev_block </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>prev_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#a2c18ae2dbd35efba4c2ea1189d9b42bf">llog_operations::lop_prev_block</a>. </p>
<p>This function finds the llog block to return which contains record with required index but in reverse order - from end of llog to the beginning. It is main part of reverse llog processing.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>prev_idx</em>&nbsp;</td><td>target index to find </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buf</em>&nbsp;</td><td>pointer to data buffer to fill </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>len</em>&nbsp;</td><td>required len to read, it is llog_chunk_size usually.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful buffer read </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00998">998</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="llog__osd_8c_source.html#l00787">changelog_block_trim_ext()</a>, <a class="el" href="lustre__user_8h_source.html#l00752">CLF_RENAME</a>, <a class="el" href="lustre__user_8h_source.html#l00751">CLF_VERSION</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l01790">dt_object_exists()</a>, <a class="el" href="dt__object_8c_source.html#l00469">dt_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="byteorder_8h_source.html#l00056">le32_to_cpu</a>, <a class="el" href="lustre__log_8h_source.html#l00278">llog_handle::lgh_ctxt</a>, <a class="el" href="lustre__log_8h_source.html#l00266">llog_handle::lgh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="lustre__idl_8h_source.html#l03065">llog_logid::lgl_ogen</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l03312">llog_log_hdr::llh_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03307">llog_log_hdr::llh_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l03289">LLOG_F_EXT_JOBID</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__idl_8h_source.html#l03106">LLOG_REC_HDR_NEEDS_SWABBING</a>, <a class="el" href="llog__osd_8c_source.html#l00750">llog_skip_over()</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l03115">llog_rec_hdr::lrh_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03122">llog_rec_tail::lrt_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03121">llog_rec_tail::lrt_len</a>, <a class="el" href="dt__object_8h_source.html#l01743">lu2dt_dev()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="llog__swab_8c_source.html#l00146">lustre_swab_llog_rec()</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="aa23ec0fdfb6ef404f70535025246a926"></a><!-- doxytag: member="llog_osd.c::llog_osd_read_header" ref="aa23ec0fdfb6ef404f70535025246a926" args="(const struct lu_env *env, struct llog_handle *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_read_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#aa56eaf539028c053fba807755f2e52c6">llog_operations::lop_read_header</a>. </p>
<p>This function reads the current llog header from the bottom storage device.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>handle</em>&nbsp;</td><td>llog handle of the current llog</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful header read </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if read failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00202">202</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8c_source.html#l00469">dt_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8h_source.html#l00447">LA_SIZE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00266">llog_handle::lgh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00267">llog_handle::lgh_hdr_size</a>, <a class="el" href="lustre__log_8h_source.html#l00273">llog_handle::lgh_last_idx</a>, <a class="el" href="lustre__log_8h_source.html#l00283">llog_handle::lgh_name</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lustre__log_8h_source.html#l00277">llog_handle::lgh_write_offset</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="llog__internal_8h_source.html#l00057">llog_thread_info::lgi_off</a>, <a class="el" href="lustre__idl_8h_source.html#l03312">llog_log_hdr::llh_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03307">llog_log_hdr::llh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00061">LLOG_EEMPTY</a>, <a class="el" href="lustre__idl_8h_source.html#l03296">LLOG_F_EXT_MASK</a>, <a class="el" href="lustre__idl_8h_source.html#l03333">LLOG_HDR_BITMAP_SIZE</a>, <a class="el" href="packet-lustre_8c_source.html#l00349">LLOG_HDR_MAGIC</a>, <a class="el" href="lustre__idl_8h_source.html#l03338">LLOG_HDR_TAIL</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__idl_8h_source.html#l03300">LLOG_MIN_CHUNK_SIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l03106">LLOG_REC_HDR_NEEDS_SWABBING</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03116">llog_rec_hdr::lrh_type</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="req-layout_8c_source.html#l00075">lustre_swab_llog_hdr</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a94087d848745b291cce9528317bc6a62"></a><!-- doxytag: member="llog_osd.c::llog_osd_regular_fid_add_name_entry" ref="a94087d848745b291cce9528317bc6a62" args="(const struct lu_env *env, struct dt_object *dto, struct thandle *th, bool declare)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_regular_fid_add_name_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>declare</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add llog object with regular FID to name entry. </p>
<p>Add llog object with regular FID to name space, and each llog object on each MDT will be /update_log_dir/[seq:oid:ver], so to satisfy the namespace consistency check, e2fsck etc.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dto</em>&nbsp;</td><td>llog object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>declare</em>&nbsp;</td><td>if it is declare or execution</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if insertion succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if insertion fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01342">1342</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02481">dt_declare_insert()</a>, <a class="el" href="dt__object_8h_source.html#l02497">dt_insert()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00477">fid_is_norm()</a>, <a class="el" href="llog__internal_8h_source.html#l00059">llog_thread_info::lgi_dt_rec</a>, <a class="el" href="llog__internal_8h_source.html#l00062">llog_thread_info::lgi_name</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="llog__osd_8c_source.html#l01295">llog_osd_get_regular_fid_dir()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="dt__object_8h_source.html#l02684">dt_insert_rec::rec_fid</a>, <a class="el" href="dt__object_8h_source.html#l02689">dt_insert_rec::rec_type</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01473">llog_osd_create()</a>, and <a class="el" href="llog__osd_8c_source.html#l01392">llog_osd_declare_create()</a>.</p>

</div>
</div>
<a class="anchor" id="adb38958e697ad62fcc881e3b08bd0ca3"></a><!-- doxytag: member="llog_osd.c::llog_osd_regular_fid_del_name_entry" ref="adb38958e697ad62fcc881e3b08bd0ca3" args="(const struct lu_env *env, struct dt_object *dto, struct thandle *th, bool declare)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_regular_fid_del_name_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>declare</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>delete llog object name entry </p>
<p>Delete llog object (with regular FID) from name space (under update_log_dir).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dto</em>&nbsp;</td><td>llog object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>declare</em>&nbsp;</td><td>if it is declare or execution</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if deletion succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if deletion fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01604">1604</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="mmap__sanity_8c_source.html#l00053">dir</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02615">dt_declare_delete()</a>, <a class="el" href="dt__object_8h_source.html#l02630">dt_delete()</a>, <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="dt__object_8h_source.html#l02175">dt_write_lock()</a>, <a class="el" href="dt__object_8h_source.html#l02194">dt_write_unlock()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l00477">fid_is_norm()</a>, <a class="el" href="llog__internal_8h_source.html#l00062">llog_thread_info::lgi_name</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="llog__osd_8c_source.html#l01295">llog_osd_get_regular_fid_dir()</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="mdt__coordinator_8c_source.html#l01693">name</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l01648">llog_osd_declare_destroy()</a>, and <a class="el" href="llog__osd_8c_source.html#l01712">llog_osd_destroy()</a>.</p>

</div>
</div>
<a class="anchor" id="af6da39451ffafd7d0da5fda66083bc94"></a><!-- doxytag: member="llog_osd.c::llog_osd_setup" ref="af6da39451ffafd7d0da5fda66083bc94" args="(const struct lu_env *env, struct obd_device *obd, struct obd_llog_group *olg, int ctxt_idx, struct obd_device *disk_obd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_setup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__llog__group.html">obd_llog_group</a> *&nbsp;</td>
          <td class="paramname"> <em>olg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ctxt_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>disk_obd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the <a class="el" href="structllog__operations.html#aa60c77a514c92bec4f788b6e624697a1">llog_operations::lop_setup</a>. </p>
<p>This function setup the llog on local storage.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obd</em>&nbsp;</td><td>obd device the llog belongs to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>olg</em>&nbsp;</td><td>the llog group, it is always zero group now. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctxt_idx</em>&nbsp;</td><td>the llog index, it defines the purpose of this llog. Every new llog type have to use own index. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>disk_obd</em>&nbsp;</td><td>the storage obd, where llog is stored.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful llog setup </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l01782">1782</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="lvfs_8h_source.html#l00061">lvfs_run_ctxt::dt</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00147">lu_fid::f_oid</a>, <a class="el" href="lustre__user_8h_source.html#l00145">lu_fid::f_seq</a>, <a class="el" href="lustre__user_8h_source.html#l00153">lu_fid::f_ver</a>, <a class="el" href="lustre__idl_8h_source.html#l00280">FID_SEQ_LLOG</a>, <a class="el" href="lustre__idl_8h_source.html#l00284">FID_SEQ_LLOG_NAME</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="llog__internal_8h_source.html#l00054">llog_thread_info::lgi_fid</a>, <a class="el" href="lustre__log_8h_source.html#l00367">llog_ctxt_get()</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__log_8h_source.html#l00322">llog_ctxt::loc_los_named</a>, <a class="el" href="lustre__log_8h_source.html#l00321">llog_ctxt::loc_los_nameless</a>, <a class="el" href="local__storage_8c_source.html#l00936">local_oid_storage_fini()</a>, <a class="el" href="local__storage_8c_source.html#l00803">local_oid_storage_init()</a>, <a class="el" href="obd_8h_source.html#l00650">obd_device::obd_lvfs_ctxt</a>, and <a class="el" href="obd_8h_source.html#l00582">obd_llog_group::olg_ctxts</a>.</p>

</div>
</div>
<a class="anchor" id="a94ac29ab2a4d1639d8df2d91f623a463"></a><!-- doxytag: member="llog_osd.c::llog_osd_write_rec" ref="a94ac29ab2a4d1639d8df2d91f623a463" args="(const struct lu_env *env, struct llog_handle *loghandle, struct llog_rec_hdr *rec, struct llog_cookie *reccookie, int idx, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int llog_osd_write_rec </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>loghandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__rec__hdr.html">llog_rec_hdr</a> *&nbsp;</td>
          <td class="paramname"> <em>rec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__cookie.html">llog_cookie</a> *&nbsp;</td>
          <td class="paramname"> <em>reccookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of the llog_operations::lop_write. </p>
<p>This function writes the new record in the llog or modify the existed one.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>loghandle</em>&nbsp;</td><td>llog handle of the current llog </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rec</em>&nbsp;</td><td>llog record header. This is a real header of the full llog record to write. This is the beginning of buffer to write, the length of buffer is stored in <em>rec::lrh_len</em> </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>reccookie</em>&nbsp;</td><td>pointer to the cookie to return back if needed. It is used for further cancel of this llog record. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>idx</em>&nbsp;</td><td>index of the llog record. If <em>idx</em> == -1 then this is append case, otherwise <em>idx</em> is the index of record to modify </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>current transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful write &amp;&amp; <em>reccookie</em> == NULL 1 on successful write &amp;&amp; <em>reccookie</em> != NULL </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>error if write failed </td></tr>
  </table>
  </dd>
</dl>

<p><p>The modification case. If idx set then the record with that index must be modified. There are three cases possible: 1) the common case is the llog header update (idx == 0) 2) the llog record modification during llog process. This is indicated by the <em>loghandle::lgh_cur_idx</em> &gt; 0. In that case the <em>loghandle::lgh_cur_offset</em> 3) otherwise this is assumed that llog consist of records of fixed size, i.e. catalog. The llog header must has llh_size field equal to record size. The record offset is calculated just by /a idx value</p>
<p>During modification we don't need extra header update because the bitmap and record count are not changed. The record header and tail remains the same too.</p>
<p>The lgh_cur_offset can be used only if index is the same.</p>
<p>The append case. The most common case of using llog. The new index is assigned to the new record, new bit is set in llog bitmap and llog count is incremented.</p>
<p>Make sure that records don't cross a chunk boundary, so we can process them page-at-a-time if needed. If it will cross a chunk boundary, write in a fake (but referenced) entry to pad the chunk.</p>
<p>NB: the caller should make sure only 1 process access the lgh_last_idx, e.g. append should be exclusive. Otherwise it might hit the assert.</p>
</p>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00372">372</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="fail_8c_source.html#l00039">cfs_fail_val</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="libcfs__debug_8h_source.html#l00141">D_OTHER</a>, <a class="el" href="lustre__user_8h_source.html#l00548">DFID</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8h_source.html#l01795">dt_object_remote()</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="lustre__compat_8h_source.html#l00270">ext2_clear_bit</a>, <a class="el" href="lustre__compat_8h_source.html#l00269">ext2_set_bit</a>, <a class="el" href="lustre__compat_8h_source.html#l00271">ext2_test_bit</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00447">LA_SIZE</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l03346">llog_cookie::lgc_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03344">llog_cookie::lgc_lgl</a>, <a class="el" href="lustre__idl_8h_source.html#l03345">llog_cookie::lgc_subsys</a>, <a class="el" href="lustre__log_8h_source.html#l00274">llog_handle::lgh_cur_idx</a>, <a class="el" href="lustre__log_8h_source.html#l00275">llog_handle::lgh_cur_offset</a>, <a class="el" href="lustre__log_8h_source.html#l00266">llog_handle::lgh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00264">llog_handle::lgh_hdr_mutex</a>, <a class="el" href="lustre__log_8h_source.html#l00265">llog_handle::lgh_id</a>, <a class="el" href="lustre__log_8h_source.html#l00273">llog_handle::lgh_last_idx</a>, <a class="el" href="lustre__log_8h_source.html#l00268">llog_handle::lgh_obj</a>, <a class="el" href="lustre__log_8h_source.html#l00277">llog_handle::lgh_write_offset</a>, <a class="el" href="llog__internal_8h_source.html#l00053">llog_thread_info::lgi_attr</a>, <a class="el" href="llog__internal_8h_source.html#l00056">llog_thread_info::lgi_buf</a>, <a class="el" href="llog__internal_8h_source.html#l00057">llog_thread_info::lgi_off</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l03310">llog_log_hdr::llh_bitmap_offset</a>, <a class="el" href="lustre__idl_8h_source.html#l03316">llog_log_hdr::llh_cat_idx</a>, <a class="el" href="lustre__idl_8h_source.html#l03309">llog_log_hdr::llh_count</a>, <a class="el" href="lustre__idl_8h_source.html#l03312">llog_log_hdr::llh_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03307">llog_log_hdr::llh_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l03311">llog_log_hdr::llh_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03328">llog_log_hdr::llh_tail</a>, <a class="el" href="packet-lustre_8c_source.html#l00356">LLOG_F_IS_CAT</a>, <a class="el" href="lustre__idl_8h_source.html#l03290">LLOG_F_IS_FIXSIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l03336">LLOG_HDR_BITMAP</a>, <a class="el" href="lustre__idl_8h_source.html#l03333">LLOG_HDR_BITMAP_SIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l03338">LLOG_HDR_TAIL</a>, <a class="el" href="lustre__log_8h_source.html#l00522">LLOG_HEADER_IDX</a>, <a class="el" href="llog__internal_8h_source.html#l00067">llog_info()</a>, <a class="el" href="lustre__log_8h_source.html#l00506">llog_is_full()</a>, <a class="el" href="lustre__idl_8h_source.html#l03046">LLOG_MDS_OST_ORIG_CTXT</a>, <a class="el" href="lustre__idl_8h_source.html#l03304">LLOG_MIN_REC_SIZE</a>, <a class="el" href="lustre__log_8h_source.html#l00521">LLOG_NEXT_IDX</a>, <a class="el" href="llog__osd_8c_source.html#l00124">llog_osd_exist()</a>, <a class="el" href="llog__osd_8c_source.html#l00153">llog_osd_pad()</a>, <a class="el" href="lustre__idl_8h_source.html#l03048">LLOG_SIZE_ORIG_CTXT</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lustre__idl_8h_source.html#l03115">llog_rec_hdr::lrh_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03116">llog_rec_hdr::lrh_type</a>, <a class="el" href="lustre__idl_8h_source.html#l03122">llog_rec_tail::lrt_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03121">llog_rec_tail::lrt_len</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lustre__idl_8h_source.html#l03092">MDS_SETATTR64_REC</a>, <a class="el" href="packet-lustre_8c_source.html#l00343">MDS_UNLINK_REC</a>, <a class="el" href="obd__support_8h_source.html#l00503">OBD_FAIL_CAT_RECORDS</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00250">OBD_FAIL_MDS_LLOG_CREATE_FAILED2</a>, <a class="el" href="obd__support_8h_source.html#l00618">OBD_FAIL_PRECHECK</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="packet-lustre_8c_source.html#l00341">OST_SZ_REC</a>, <a class="el" href="lustre__user_8h_source.html#l00549">PFID</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="lustre__idl_8h_source.html#l03126">REC_DATA</a>, <a class="el" href="lustre__idl_8h_source.html#l03129">REC_DATA_LEN</a>, <a class="el" href="lustre__idl_8h_source.html#l03133">rec_tail()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a300bddd6538a482283063962bd9f9396"></a><!-- doxytag: member="llog_osd.c::llog_skip_over" ref="a300bddd6538a482283063962bd9f9396" args="(struct llog_handle *lgh, __u64 *off, int curr, int goal, __u32 chunk_size, bool force_mini_rec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void llog_skip_over </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structllog__handle.html">llog_handle</a> *&nbsp;</td>
          <td class="paramname"> <em>lgh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>off</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>curr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>goal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>chunk_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force_mini_rec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>We can skip reading at least as many log blocks as the number of minimum sized log records we are skipping. </p>
<p>If it turns out that we are not far enough along the log (because the actual records are larger than minimum size) we just skip some more records.</p>
<p>Note: in llog_process_thread, it will use bitmap offset as the index to locate the record, which also includs some pad records, whose record size is very small, and it also does not consider pad record when recording minimum record size (otherwise min_record size might be too small), so in some rare cases, it might skip too much record for , see <a class="el" href="llog__osd_8c.html#a3a0bc4e046edb33d59782631311f9713" title="Implementation of the llog_operations::lop_next_block.">llog_osd_next_block()</a>.</p>
<p>When force_mini_rec is true, it means we have to use LLOG_MIN_REC_SIZE as the min record size to skip over, usually because in the previous try, it skip too much record, see loog_osd_next(prev)_block(). </p>

<p>Definition at line <a class="el" href="llog__osd_8c_source.html#l00750">750</a> of file <a class="el" href="llog__osd_8c_source.html">llog_osd.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="lustre__log_8h_source.html#l00266">llog_handle::lgh_hdr</a>, <a class="el" href="lustre__log_8h_source.html#l00273">llog_handle::lgh_last_idx</a>, <a class="el" href="lustre__idl_8h_source.html#l03312">llog_log_hdr::llh_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l03311">llog_log_hdr::llh_size</a>, <a class="el" href="lustre__idl_8h_source.html#l03290">LLOG_F_IS_FIXSIZE</a>, and <a class="el" href="lustre__idl_8h_source.html#l03304">LLOG_MIN_REC_SIZE</a>.</p>

<p>Referenced by <a class="el" href="llog__osd_8c_source.html#l00820">llog_osd_next_block()</a>, and <a class="el" href="llog__osd_8c_source.html#l00998">llog_osd_prev_block()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:49 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
