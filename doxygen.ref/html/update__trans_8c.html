<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/target/update_trans.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/target/update_trans.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="lu__target_8h_source.html">lu_target.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__log_8h_source.html">lustre_log.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__update_8h_source.html">lustre_update.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="tgt__internal_8h_source.html">tgt_internal.h</a>&gt;</code><br/>

<p><a href="update__trans_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdistribute__txn__bid__data.html">distribute_txn_bid_data</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_CLASS</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a6860723eb62b04e6dedadbfb1b72874e">top_multiple_thandle_dump</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt, __u32 mask)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dump top mulitple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.  <a href="#a6860723eb62b04e6dedadbfb1b72874e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a848152bc7d66d947f9b2fa40ec0dd521">sub_declare_updates_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *record, struct <a class="el" href="structthandle.html">thandle</a> *sub_th, size_t record_size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declare write update to sub device.  <a href="#a848152bc7d66d947f9b2fa40ec0dd521"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#aa8ae45a7f708e80aa045690cb9bdb932">sub_updates_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *record, struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *sub_th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">write update to sub device  <a href="#aa8ae45a7f708e80aa045690cb9bdb932"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#abd37ca098c73d8ca599d0cf4aea9b1dd">prepare_writing_updates</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare the update records.  <a href="#abd37ca098c73d8ca599d0cf4aea9b1dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a3242bf9c5913aba0e9ac4f63bb024649">distribute_txn_commit_thread_running</a> (struct <a class="el" href="structlu__target.html">lu_target</a> *lut)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#aecfd67692d42fcea96f80c329cfdf128">distribute_txn_commit_thread_stopped</a> (struct <a class="el" href="structlu__target.html">lu_target</a> *lut)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a1cab569ea52ae4435453516f2d47a27c">top_trans_committed_cb</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> commit callback.  <a href="#a1cab569ea52ae4435453516f2d47a27c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#abd4c2336b30be2ea7483ef3044cacb50">lookup_sub_thandle</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt, struct <a class="el" href="structdt__device.html">dt_device</a> *dt_dev)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a0d5350897e8c40320351e72ba090fa6c">create_sub_thandle</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt, struct <a class="el" href="structdt__device.html">dt_device</a> *dt_dev)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a25cc32349228a3fc16e9c4b996f806ea">sub_trans_commit_cb_internal</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt, struct <a class="el" href="structthandle.html">thandle</a> *sub_th, int err)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a333b3253396eb8f33a7877e59375cf9e">sub_trans_commit_cb</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *sub_th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *cb, int err)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> commit callback  <a href="#a333b3253396eb8f33a7877e59375cf9e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a06791c33a262520bbe0b57d27433103e">sub_thandle_register_commit_cb</a> (struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *st, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ab33e0c3ed2516275f8b62057138fa17c">sub_trans_stop_cb</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *sub_th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *cb, int err)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> stop call back.  <a href="#ab33e0c3ed2516275f8b62057138fa17c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ab7d41b17a8a89ee51e600a2d916d8f33">sub_thandle_register_stop_cb</a> (struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *st, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#aa345e2b1216b85fb0cfdb183553dc682">sub_thandle_trans_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th, struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *st)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.  <a href="#aa345e2b1216b85fb0cfdb183553dc682"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ac6f54ce638b398bc7fbb71605afbc6ad">top_trans_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *master_dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create the top transaction.  <a href="#ac6f54ce638b398bc7fbb71605afbc6ad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a8aecf09a24d01eb3155c4130bc14fcb3">declare_updates_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declare write update transaction.  <a href="#a8aecf09a24d01eb3155c4130bc14fcb3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#abd7c855bd1136242cfb1fe16f28ef04c">distribute_txn_assign_batchid</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *new)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assign batchid to the distribute transaction.  <a href="#abd7c855bd1136242cfb1fe16f28ef04c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a3200a46788d18886fc69a646f0ab85a6">distribute_txn_insert_by_batchid</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *new)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert distribute transaction to the distribute txn list.  <a href="#a3200a46788d18886fc69a646f0ab85a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a9bdd8f20a43397753e94ab4d45909310">prepare_multiple_node_trans</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare cross-MDT operation.  <a href="#a9bdd8f20a43397753e94ab4d45909310"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a8c42630ece7c32f323382e2b12371a69">top_trans_start</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *master_dev, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">start the top transaction.  <a href="#a8c42630ece7c32f323382e2b12371a69"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#aa95955ef1e126ee97ed42eb07d38248e">top_check_write_updates</a> (struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether we need write updates record.  <a href="#aa95955ef1e126ee97ed42eb07d38248e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ad7cc31b14ee872e5d25ee4b3fd30b65f">top_trans_is_stopped</a> (struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if top transaction is stopped.  <a href="#ad7cc31b14ee872e5d25ee4b3fd30b65f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ab63eb3ec2b599b7dd003d776b88fbdf8">top_trans_wait_result</a> (struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait result of top transaction.  <a href="#ab63eb3ec2b599b7dd003d776b88fbdf8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a165db60fce8230df959247137d37567d">top_trans_stop</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__device.html">dt_device</a> *master_dev, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop the top transaction.  <a href="#a165db60fce8230df959247137d37567d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#aa54680b77690cc5b396f50765afcbf88">top_trans_create_tmt</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> for <a class="el" href="structtop__thandle.html">top_thandle</a>.  <a href="#aa54680b77690cc5b396f50765afcbf88"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a7d5c2fc31b327c542345003592ca400a">create_sub_thandle_with_thandle</a> (struct <a class="el" href="structtop__thandle.html">top_thandle</a> *top_th, struct <a class="el" href="structthandle.html">thandle</a> *sub_th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a781f9ae7819e282238729641f99ddcf1">thandle_get_sub_by_dt</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structdt__device.html">dt_device</a> *sub_dt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.  <a href="#a781f9ae7819e282238729641f99ddcf1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#af9ad3167e880c03421c54495b1c62b59">top_multiple_thandle_destroy</a> (struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Top multiple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> destroy.  <a href="#af9ad3167e880c03421c54495b1c62b59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ada11ca7c8f743cd31fe1fefab799fe4f">distribute_txn_cancel_records</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *tmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel the update log on MDTs.  <a href="#ada11ca7c8f743cd31fe1fefab799fe4f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a8b84a30e3c7b1d7d8ef1b3b03585dca1">tdtd_ready_for_cancel_log</a> (struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if there are committed transaction.  <a href="#a8b84a30e3c7b1d7d8ef1b3b03585dca1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a89cd6df494e8c6a7d7accc69f788096c">distribute_txn_batchid_cb</a> (struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structthandle.html">thandle</a> *th, struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *cb, int err)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">callback of updating commit batchid  <a href="#a89cd6df494e8c6a7d7accc69f788096c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a5439421c680da901acf036df849549b7">distribute_txn_commit_batchid_update</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> batchid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the commit batchid in disk.  <a href="#a5439421c680da901acf036df849549b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#ac1ed10062edb008f133f31f10e1cca28">distribute_txn_commit_batchid_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Init commit batchid for distribute transaction.  <a href="#ac1ed10062edb008f133f31f10e1cca28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a6156dcbe371da48e22b61eb7f4a51da9">distribute_txn_commit_thread</a> (void *_arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">manage the distribute transaction thread  <a href="#a6156dcbe371da48e22b61eb7f4a51da9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#abfd37220ac46ae2aa4e3c0a49c434221">distribute_txn_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__target.html">lu_target</a> *lut, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd, __u32 index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start llog cancel thread.  <a href="#abfd37220ac46ae2aa4e3c0a49c434221"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="update__trans_8c.html#a46c70742822e1893992a3e7499e82d22">distribute_txn_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *tdtd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop llog cancel thread.  <a href="#a46c70742822e1893992a3e7499e82d22"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="update_trans.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_CLASS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00050">50</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0d5350897e8c40320351e72ba090fa6c"></a><!-- doxytag: member="update_trans.c::create_sub_thandle" ref="a0d5350897e8c40320351e72ba090fa6c" args="(struct top_multiple_thandle *tmt, struct dt_device *dt_dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsub__thandle.html">sub_thandle</a>* create_sub_thandle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00436">436</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, and <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01134">create_sub_thandle_with_thandle()</a>, and <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a7d5c2fc31b327c542345003592ca400a"></a><!-- doxytag: member="update_trans.c::create_sub_thandle_with_thandle" ref="a7d5c2fc31b327c542345003592ca400a" args="(struct top_thandle *top_th, struct thandle *sub_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structsub__thandle.html">sub_thandle</a>* create_sub_thandle_with_thandle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01134">1134</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="update__trans_8c_source.html#l00436">create_sub_thandle()</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00545">sub_thandle_register_stop_cb()</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01836">thandle::th_top</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01164">thandle_get_sub_by_dt()</a>.</p>

</div>
</div>
<a class="anchor" id="a8aecf09a24d01eb3155c4130bc14fcb3"></a><!-- doxytag: member="update_trans.c::declare_updates_write" ref="a8aecf09a24d01eb3155c4130bc14fcb3" args="(const struct lu_env *env, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int declare_updates_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Declare write update transaction. </p>
<p>Check if there are updates being recorded in this transaction, it will write the record into the disk.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tmt</em>&nbsp;</td><td>top multiple transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if writing succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if writing fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00638">638</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00112">sub_declare_updates_write()</a>, <a class="el" href="lustre__update_8h_source.html#l00298">top_multiple_thandle::tmt_record_size</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, and <a class="el" href="lustre__update_8h_source.html#l00273">thandle_update_records::tur_update_records</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00750">prepare_multiple_node_trans()</a>.</p>

</div>
</div>
<a class="anchor" id="abd7c855bd1136242cfb1fe16f28ef04c"></a><!-- doxytag: member="update_trans.c::distribute_txn_assign_batchid" ref="abd7c855bd1136242cfb1fe16f28ef04c" args="(struct top_multiple_thandle *new)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void distribute_txn_assign_batchid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>new</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Assign batchid to the distribute transaction. </p>
<p>Assign batchid to the distribute transaction</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tmt</em>&nbsp;</td><td>distribute transaction </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00667">667</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01774">dt2lu_dev()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00502">sub_thandle_register_commit_cb()</a>, <a class="el" href="lu__target_8h_source.html#l00090">target_distribute_txn_data::tdtd_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00099">target_distribute_txn_data::tdtd_list</a>, <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>, and <a class="el" href="lustre__update_8h_source.html#l00468">top_multiple_thandle_get()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00750">prepare_multiple_node_trans()</a>.</p>

</div>
</div>
<a class="anchor" id="a89cd6df494e8c6a7d7accc69f788096c"></a><!-- doxytag: member="update_trans.c::distribute_txn_batchid_cb" ref="a89cd6df494e8c6a7d7accc69f788096c" args="(struct lu_env *env, struct thandle *th, struct dt_txn_commit_cb *cb, int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void distribute_txn_batchid_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>callback of updating commit batchid </p>
<p>Updating commit batchid then wake up the commit thread to cancel the records.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to updating commit batchid </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>commit callback </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>result of <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01367">1367</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="update__trans_8c_source.html#l01353">distribute_txn_bid_data::dtbd_batchid</a>, <a class="el" href="update__trans_8c_source.html#l01352">distribute_txn_bid_data::dtbd_tdtd</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_no_transno</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00096">target_distribute_txn_data::tdtd_committed_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, and <a class="el" href="lu__target_8h_source.html#l00103">target_distribute_txn_data::tdtd_refcount</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01405">distribute_txn_commit_batchid_update()</a>.</p>

</div>
</div>
<a class="anchor" id="ada11ca7c8f743cd31fe1fefab799fe4f"></a><!-- doxytag: member="update_trans.c::distribute_txn_cancel_records" ref="ada11ca7c8f743cd31fe1fefab799fe4f" args="(const struct lu_env *env, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_cancel_records </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cancel the update log on MDTs. </p>
<p>Cancel the update log on MDTs then destroy the <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tmt</em>&nbsp;</td><td>the top multiple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> whose updates records will be cancelled.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if cancellation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if cancellation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01277">1277</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__user_8h_source.html#l00156">fid_is_zero()</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l03346">llog_cookie::lgc_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03344">llog_cookie::lgc_lgl</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="llog__cat_8c_source.html#l00673">llog_cat_cancel_records()</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00219">ost_id::oi_fid</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00314">sub_thandle_cookie::stc_cookie</a>, <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, and <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1ed10062edb008f133f31f10e1cca28"></a><!-- doxytag: member="update_trans.c::distribute_txn_commit_batchid_init" ref="ac1ed10062edb008f133f31f10e1cca28" args="(const struct lu_env *env, struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_commit_batchid_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init commit batchid for distribute transaction. </p>
<p>Initialize the batchid object and get commit batchid from the object.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute transaction whose batchid is initialized.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if initialization succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if initialization fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01474">1474</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="lustre__fid_8h_source.html#l00239">BATCHID_COMMITTED_OID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8c_source.html#l00388">dt_find_or_create()</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8c_source.html#l00469">dt_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="lustre__fid_8h_source.html#l00242">lu_local_obj_fid()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lu__target_8h_source.html#l00120">lu_target::lut_bottom</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lu__target_8h_source.html#l00092">target_distribute_txn_data::tdtd_batchid_obj</a>, <a class="el" href="lu__target_8h_source.html#l00096">target_distribute_txn_data::tdtd_committed_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="tgt__internal_8h_source.html#l00095">tgt_th_info()</a>, <a class="el" href="tgt__internal_8h_source.html#l00062">tgt_thread_info::tti_attr</a>, <a class="el" href="tgt__internal_8h_source.html#l00063">tgt_thread_info::tti_fid1</a>, <a class="el" href="structtgt__thread__info.html#a771b937e260fdbcc316028d045f4eda8">tgt_thread_info::tti_u</a>, and <a class="el" href="structtgt__thread__info.html#a7326e6aefe467eb228fe53e954db568b">tgt_thread_info::update</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a5439421c680da901acf036df849549b7"></a><!-- doxytag: member="update_trans.c::distribute_txn_commit_batchid_update" ref="a5439421c680da901acf036df849549b7" args="(const struct lu_env *env, struct target_distribute_txn_data *tdtd, __u64 batchid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_commit_batchid_update </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>batchid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the commit batchid in disk. </p>
<p>Update commit batchid in the disk, after this is committed, it can start to cancel the update records.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tdtd</em>&nbsp;</td><td>distribute transaction structure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>batchid</em>&nbsp;</td><td>commit batchid to be updated</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if update succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if update fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01405">1405</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="byteorder_8h_source.html#l00059">cpu_to_le64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="update__trans_8c_source.html#l01367">distribute_txn_batchid_cb()</a>, <a class="el" href="dt__object_8h_source.html#l02087">dt_declare_record_write()</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="dt__object_8h_source.html#l02077">dt_trans_cb_add()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="update__trans_8c_source.html#l01353">distribute_txn_bid_data::dtbd_batchid</a>, <a class="el" href="update__trans_8c_source.html#l01351">distribute_txn_bid_data::dtbd_cb</a>, <a class="el" href="update__trans_8c_source.html#l01352">distribute_txn_bid_data::dtbd_tdtd</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lu__target_8h_source.html#l00120">lu_target::lut_bottom</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="rename__many_8c_source.html#l00056">stop</a>, <a class="el" href="lu__target_8h_source.html#l00092">target_distribute_txn_data::tdtd_batchid_obj</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, and <a class="el" href="lu__target_8h_source.html#l00103">target_distribute_txn_data::tdtd_refcount</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a6156dcbe371da48e22b61eb7f4a51da9"></a><!-- doxytag: member="update_trans.c::distribute_txn_commit_thread" ref="a6156dcbe371da48e22b61eb7f4a51da9" args="(void *_arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_commit_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>_arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>manage the distribute transaction thread </p>
<p>Distribute transaction are linked to the list, and once the distribute transaction is committed, it will update the last committed batchid first, after it is committed, it will cancel the records.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>_arg</em>&nbsp;</td><td>argument for commit thread</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if thread is running successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if the thread can not be run. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01544">1544</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="update__trans_8c_source.html#l01277">distribute_txn_cancel_records()</a>, <a class="el" href="update__trans_8c_source.html#l01405">distribute_txn_commit_batchid_update()</a>, <a class="el" href="update__trans_8c_source.html#l00390">distribute_txn_commit_thread_running()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lu__object_8h_source.html#l01024">LCT_LOCAL</a>, <a class="el" href="lu__object_8h_source.html#l00995">LCT_MD_THREAD</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="list_8h_source.html#l00150">list_move_tail()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="lu__target_8h_source.html#l00123">lu_target::lut_tdtd_commit_thread</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00096">target_distribute_txn_data::tdtd_committed_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00099">target_distribute_txn_data::tdtd_list</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="update__trans_8c_source.html#l01330">tdtd_ready_for_cancel_log()</a>, <a class="el" href="lu__target_8h_source.html#l00103">target_distribute_txn_data::tdtd_refcount</a>, <a class="el" href="obd_8c_source.html#l00114">thread</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00290">top_multiple_thandle::tmt_commit_list</a>, <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00296">top_multiple_thandle::tmt_result</a>, <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>, and <a class="el" href="lustre__update_8h_source.html#l00473">top_multiple_thandle_put()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a3242bf9c5913aba0e9ac4f63bb024649"></a><!-- doxytag: member="update_trans.c::distribute_txn_commit_thread_running" ref="a3242bf9c5913aba0e9ac4f63bb024649" args="(struct lu_target *lut)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_commit_thread_running </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__target.html">lu_target</a> *&nbsp;</td>
          <td class="paramname"> <em>lut</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00390">390</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00123">lu_target::lut_tdtd_commit_thread</a>, <a class="el" href="lustre__net_8h_source.html#l01497">SVC_RUNNING</a>, and <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>, <a class="el" href="update__trans_8c_source.html#l01732">distribute_txn_fini()</a>, <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>, and <a class="el" href="update__trans_8c_source.html#l00408">top_trans_committed_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="aecfd67692d42fcea96f80c329cfdf128"></a><!-- doxytag: member="update_trans.c::distribute_txn_commit_thread_stopped" ref="aecfd67692d42fcea96f80c329cfdf128" args="(struct lu_target *lut)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int distribute_txn_commit_thread_stopped </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__target.html">lu_target</a> *&nbsp;</td>
          <td class="paramname"> <em>lut</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00396">396</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="lu__target_8h_source.html#l00123">lu_target::lut_tdtd_commit_thread</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, and <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01681">distribute_txn_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a46c70742822e1893992a3e7499e82d22"></a><!-- doxytag: member="update_trans.c::distribute_txn_fini" ref="a46c70742822e1893992a3e7499e82d22" args="(const struct lu_env *env, struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void distribute_txn_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop llog cancel thread. </p>
<p>Stop llog cancel(master/slave) thread on LOD and also destory all of transaction in the list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>cancel log thread to be stopped. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01732">1732</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="update__trans_8c_source.html#l00390">distribute_txn_commit_thread_running()</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="update__recovery_8c_source.html#l00534">dtrq_list_destroy()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="lu__target_8h_source.html#l00123">lu_target::lut_tdtd_commit_thread</a>, <a class="el" href="lustre__net_8h_source.html#l01494">SVC_STOPPED</a>, <a class="el" href="lustre__net_8h_source.html#l01495">SVC_STOPPING</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lustre__net_8h_source.html#l01515">ptlrpc_thread::t_flags</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00092">target_distribute_txn_data::tdtd_batchid_obj</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, and <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00792">lod_fini_distribute_txn()</a>.</p>

</div>
</div>
<a class="anchor" id="abfd37220ac46ae2aa4e3c0a49c434221"></a><!-- doxytag: member="update_trans.c::distribute_txn_init" ref="abfd37220ac46ae2aa4e3c0a49c434221" args="(const struct lu_env *env, struct lu_target *lut, struct target_distribute_txn_data *tdtd, __u32 index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int distribute_txn_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__target.html">lu_target</a> *&nbsp;</td>
          <td class="paramname"> <em>lut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start llog cancel thread. </p>
<p>Start llog cancel(master/slave) thread on LOD</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>cancel log thread to be started.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the thread is started successfully. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if the thread is not being started. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01681">1681</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="update__trans_8c_source.html#l01474">distribute_txn_commit_batchid_init()</a>, <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>, <a class="el" href="update__trans_8c_source.html#l00390">distribute_txn_commit_thread_running()</a>, <a class="el" href="update__trans_8c_source.html#l00396">distribute_txn_commit_thread_stopped()</a>, <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lu__target_8h_source.html#l00146">lu_target::lut_last_transno</a>, <a class="el" href="lu__target_8h_source.html#l00123">lu_target::lut_tdtd_commit_thread</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01532">ptlrpc_thread::t_ctl_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00090">target_distribute_txn_data::tdtd_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00099">target_distribute_txn_data::tdtd_list</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lu__target_8h_source.html#l00114">target_distribute_txn_data::tdtd_recovery_threads_count</a>, <a class="el" href="lu__target_8h_source.html#l00115">target_distribute_txn_data::tdtd_recovery_threads_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00103">target_distribute_txn_data::tdtd_refcount</a>, <a class="el" href="lu__target_8h_source.html#l00108">target_distribute_txn_data::tdtd_replay_finish_list</a>, <a class="el" href="lu__target_8h_source.html#l00106">target_distribute_txn_data::tdtd_replay_handler</a>, <a class="el" href="lu__target_8h_source.html#l00107">target_distribute_txn_data::tdtd_replay_list</a>, <a class="el" href="lu__target_8h_source.html#l00109">target_distribute_txn_data::tdtd_replay_list_lock</a>, and <a class="el" href="lu__target_8h_source.html#l00111">target_distribute_txn_data::tdtd_replay_ready</a>.</p>

<p>Referenced by <a class="el" href="lod__dev_8c_source.html#l00753">lod_prepare_distribute_txn()</a>.</p>

</div>
</div>
<a class="anchor" id="a3200a46788d18886fc69a646f0ab85a6"></a><!-- doxytag: member="update_trans.c::distribute_txn_insert_by_batchid" ref="a3200a46788d18886fc69a646f0ab85a6" args="(struct top_multiple_thandle *new)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void distribute_txn_insert_by_batchid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>new</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert distribute transaction to the distribute txn list. </p>
<p>Insert distribute transaction to the distribute txn list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>new</em>&nbsp;</td><td>the distribute txn to be inserted. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00694">694</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01774">dt2lu_dev()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="list_8h_source.html#l00472">list_for_each_entry_reverse</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00502">sub_thandle_register_commit_cb()</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, <a class="el" href="lu__target_8h_source.html#l00099">target_distribute_txn_data::tdtd_list</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00290">top_multiple_thandle::tmt_commit_list</a>, <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>, and <a class="el" href="lustre__update_8h_source.html#l00468">top_multiple_thandle_get()</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>.</p>

</div>
</div>
<a class="anchor" id="abd4c2336b30be2ea7483ef3044cacb50"></a><!-- doxytag: member="update_trans.c::lookup_sub_thandle" ref="abd4c2336b30be2ea7483ef3044cacb50" args="(struct top_multiple_thandle *tmt, struct dt_device *dt_dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsub__thandle.html">sub_thandle</a>* lookup_sub_thandle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>dt_dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00423">423</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, and <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, <a class="el" href="update__trans_8c_source.html#l01164">thandle_get_sub_by_dt()</a>, <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>, and <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a9bdd8f20a43397753e94ab4d45909310"></a><!-- doxytag: member="update_trans.c::prepare_multiple_node_trans" ref="a9bdd8f20a43397753e94ab4d45909310" args="(const struct lu_env *env, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int prepare_multiple_node_trans </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare cross-MDT operation. </p>
<p>Create the update record buffer to record updates for cross-MDT operation, add master sub transaction to tt_sub_trans_list, and declare the update writes.</p>
<p>During updates packing, all of parameters will be packed in tur_update_params, and updates will be packed in tur_update_records. Then in transaction stop, parameters and updates will be merged into one updates buffer.</p>
<p>And also master <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> will be added to the sub_th list, so it will be easy to track the commit status.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>top transaction handle</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if preparation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if preparation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00750">750</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="update__records_8c_source.html#l01161">check_and_prepare_update_record()</a>, <a class="el" href="update__trans_8c_source.html#l00638">declare_updates_write()</a>, <a class="el" href="update__trans_8c_source.html#l00667">distribute_txn_assign_batchid()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, <a class="el" href="tgt__internal_8h_source.html#l00271">update_env_info()</a>, and <a class="el" href="tgt__internal_8h_source.html#l00261">update_thread_info::uti_tur</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00784">top_trans_start()</a>.</p>

</div>
</div>
<a class="anchor" id="abd37ca098c73d8ca599d0cf4aea9b1dd"></a><!-- doxytag: member="update_trans.c::prepare_writing_updates" ref="abd37ca098c73d8ca599d0cf4aea9b1dd" args="(const struct lu_env *env, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int prepare_writing_updates </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepare the update records. </p>
<p>Merge params and ops into the update records, then initializing the update buffer.</p>
<p>During transaction execution phase, parameters and update ops are collected in two different buffers (see lod_updates_pack()), during transaction stop, it needs to be merged in one buffer, so it will be written in the update log.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tmt</em>&nbsp;</td><td><a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> for distribute txn</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if merging succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negaitive</em>&nbsp;</td><td>errno if merging fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00343">343</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="lustre__user_8h_source.html#l01295">cfs_size_round()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="lustre__idl_8h_source.html#l03116">llog_rec_hdr::lrh_type</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, <a class="el" href="lustre__update_8h_source.html#l00278">thandle_update_records::tur_update_param_count</a>, <a class="el" href="lustre__update_8h_source.html#l00277">thandle_update_records::tur_update_params</a>, <a class="el" href="lustre__update_8h_source.html#l00273">thandle_update_records::tur_update_records</a>, <a class="el" href="lustre__update_8h_source.html#l00274">thandle_update_records::tur_update_records_buf_size</a>, <a class="el" href="update__records_8c_source.html#l01017">tur_update_records_extend()</a>, <a class="el" href="lustre__update_8h_source.html#l00045">update_params_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l03101">UPDATE_REC</a>, <a class="el" href="update__records_8c_source.html#l00063">update_records_dump()</a>, <a class="el" href="lustre__update_8h_source.html#l00126">update_records_get_params()</a>, <a class="el" href="lustre__idl_8h_source.html#l04024">update_records::ur_batchid</a>, and <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="a848152bc7d66d947f9b2fa40ec0dd521"></a><!-- doxytag: member="update_trans.c::sub_declare_updates_write" ref="a848152bc7d66d947f9b2fa40ec0dd521" args="(const struct lu_env *env, struct llog_update_record *record, struct thandle *sub_th, size_t record_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sub_declare_updates_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *&nbsp;</td>
          <td class="paramname"> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>record_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Declare write update to sub device. </p>
<p>Declare Write updates llog records to the sub device during distribute transaction.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>record</em>&nbsp;</td><td>update records being written </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sub_th</em>&nbsp;</td><td>sub transaction handle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>record_size</em>&nbsp;</td><td>total update record size</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if writing succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if writing fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00112">112</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="llog_8c_source.html#l00939">llog_declare_add()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00325">llog_ctxt::loc_chunk_size</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, and <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00638">declare_updates_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a06791c33a262520bbe0b57d27433103e"></a><!-- doxytag: member="update_trans.c::sub_thandle_register_commit_cb" ref="a06791c33a262520bbe0b57d27433103e" args="(struct sub_thandle *st, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sub_thandle_register_commit_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00502">502</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00111">dt_txn_commit_cb::dcb_data</a>, <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l02077">dt_trans_cb_add()</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__update_8h_source.html#l00324">sub_thandle::st_commit_dcb</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00493">sub_trans_commit_cb()</a>, and <a class="el" href="lustre__update_8h_source.html#l00468">top_multiple_thandle_get()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00667">distribute_txn_assign_batchid()</a>, and <a class="el" href="update__trans_8c_source.html#l00694">distribute_txn_insert_by_batchid()</a>.</p>

</div>
</div>
<a class="anchor" id="ab7d41b17a8a89ee51e600a2d916d8f33"></a><!-- doxytag: member="update_trans.c::sub_thandle_register_stop_cb" ref="ab7d41b17a8a89ee51e600a2d916d8f33" args="(struct sub_thandle *st, struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sub_thandle_register_stop_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00545">545</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00111">dt_txn_commit_cb::dcb_data</a>, <a class="el" href="dt__object_8h_source.html#l00113">dt_txn_commit_cb::dcb_flags</a>, <a class="el" href="dt__object_8h_source.html#l00110">dt_txn_commit_cb::dcb_func</a>, <a class="el" href="dt__object_8h_source.html#l00109">dt_txn_commit_cb::dcb_linkage</a>, <a class="el" href="dt__object_8h_source.html#l00107">DCB_TRANS_STOP</a>, <a class="el" href="dt__object_8h_source.html#l02077">dt_trans_cb_add()</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lustre__update_8h_source.html#l00325">sub_thandle::st_stop_dcb</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, and <a class="el" href="update__trans_8c_source.html#l00522">sub_trans_stop_cb()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01134">create_sub_thandle_with_thandle()</a>, and <a class="el" href="update__trans_8c_source.html#l00567">sub_thandle_trans_create()</a>.</p>

</div>
</div>
<a class="anchor" id="aa345e2b1216b85fb0cfdb183553dc682"></a><!-- doxytag: member="update_trans.c::sub_thandle_trans_create" ref="aa345e2b1216b85fb0cfdb183553dc682" args="(const struct lu_env *env, struct top_thandle *top_th, struct sub_thandle *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sub_thandle_trans_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </p>
<p>Create transaction handle for <a class="el" href="structsub__thandle.html">sub_thandle</a></p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>st</em>&nbsp;</td><td><a class="el" href="structsub__thandle.html">sub_thandle</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if creation succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if creation fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00567">567</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00545">sub_thandle_register_stop_cb()</a>, <a class="el" href="dt__object_8h_source.html#l01836">thandle::th_top</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_wait_submit</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01137">update_recovery_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a333b3253396eb8f33a7877e59375cf9e"></a><!-- doxytag: member="update_trans.c::sub_trans_commit_cb" ref="a333b3253396eb8f33a7877e59375cf9e" args="(struct lu_env *env, struct thandle *sub_th, struct dt_txn_commit_cb *cb, int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sub_trans_commit_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> commit callback </p>
<p>Mark the sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to be committed and if all sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> are committed notify the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sub_th</em>&nbsp;</td><td>sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> being committed </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cb</em>&nbsp;</td><td>commit callback </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>err</em>&nbsp;</td><td>trans result </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00493">493</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00111">dt_txn_commit_cb::dcb_data</a>, and <a class="el" href="update__trans_8c_source.html#l00453">sub_trans_commit_cb_internal()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00502">sub_thandle_register_commit_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="a25cc32349228a3fc16e9c4b996f806ea"></a><!-- doxytag: member="update_trans.c::sub_trans_commit_cb_internal" ref="a25cc32349228a3fc16e9c4b996f806ea" args="(struct top_multiple_thandle *tmt, struct thandle *sub_th, int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sub_trans_commit_cb_internal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00453">453</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00326">sub_thandle::st_result</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="lustre__update_8h_source.html#l00296">top_multiple_thandle::tmt_result</a>, <a class="el" href="lustre__update_8h_source.html#l00288">top_multiple_thandle::tmt_sub_lock</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>, <a class="el" href="lustre__update_8h_source.html#l00473">top_multiple_thandle_put()</a>, and <a class="el" href="update__trans_8c_source.html#l00408">top_trans_committed_cb()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00493">sub_trans_commit_cb()</a>, and <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="ab33e0c3ed2516275f8b62057138fa17c"></a><!-- doxytag: member="update_trans.c::sub_trans_stop_cb" ref="ab33e0c3ed2516275f8b62057138fa17c" args="(struct lu_env *env, struct thandle *sub_th, struct dt_txn_commit_cb *cb, int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sub_trans_stop_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> stop call back. </p>
<p>After sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> is stopped, it will call this callback to notify the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to be stopped </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rc</em>&nbsp;</td><td>result of sub trans </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00522">522</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00111">dt_txn_commit_cb::dcb_data</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00326">sub_thandle::st_result</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_stopped</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="lustre__update_8h_source.html#l00294">top_multiple_thandle::tmt_stop_waitq</a>, and <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00545">sub_thandle_register_stop_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8ae45a7f708e80aa045690cb9bdb932"></a><!-- doxytag: member="update_trans.c::sub_updates_write" ref="aa8ae45a7f708e80aa045690cb9bdb932" args="(const struct lu_env *env, struct llog_update_record *record, struct sub_thandle *sub_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sub_updates_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structllog__update__record.html">llog_update_record</a> *&nbsp;</td>
          <td class="paramname"> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsub__thandle.html">sub_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>write update to sub device </p>
<p>Write llog update record to the sub device during distribute transaction. If it succeeds, llog cookie of the record will be returned by .</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>record</em>&nbsp;</td><td>update records being written </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sub_th</em>&nbsp;</td><td>sub transaction handle </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>cookie</em>&nbsp;</td><td>llog cookie of the update record.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if writing succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if writing fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00167">167</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="lustre__user_8h_source.html#l01295">cfs_size_round()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00045">LASSERTF</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l03346">llog_cookie::lgc_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03344">llog_cookie::lgc_lgl</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="llog_8c_source.html#l00918">llog_add()</a>, <a class="el" href="lustre__log_8h_source.html#l00375">llog_ctxt_put()</a>, <a class="el" href="lustre__log_8h_source.html#l00431">llog_get_context()</a>, <a class="el" href="lustre__idl_8h_source.html#l03304">LLOG_MIN_REC_SIZE</a>, <a class="el" href="lustre__update_8h_source.html#l00154">llog_update_record_size()</a>, <a class="el" href="lustre__idl_8h_source.html#l03057">LLOG_UPDATELOG_ORIG_CTXT</a>, <a class="el" href="lustre__log_8h_source.html#l00325">llog_ctxt::loc_chunk_size</a>, <a class="el" href="lustre__log_8h_source.html#l00316">llog_ctxt::loc_handle</a>, <a class="el" href="lustre__idl_8h_source.html#l03114">llog_rec_hdr::lrh_len</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04041">llog_update_record::lur_hdr</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="obd__support_8h_source.html#l00747">OBD_ALLOC_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00783">OBD_FREE_LARGE</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__idl_8h_source.html#l03819">object_update_param_size()</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="rename__many_8c_source.html#l00057">start</a>, <a class="el" href="lustre__update_8h_source.html#l00314">sub_thandle_cookie::stc_cookie</a>, <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>, <a class="el" href="lustre__update_8h_source.html#l00105">update_op_next_op()</a>, <a class="el" href="lustre__idl_8h_source.html#l04010">UPDATE_RECORD_CONTINUE</a>, <a class="el" href="update__records_8c_source.html#l00063">update_records_dump()</a>, <a class="el" href="lustre__update_8h_source.html#l00126">update_records_get_params()</a>, <a class="el" href="lustre__idl_8h_source.html#l04025">update_records::ur_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l04031">update_records::ur_ops</a>, <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>, and <a class="el" href="lustre__idl_8h_source.html#l04029">update_records::ur_update_count</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b84a30e3c7b1d7d8ef1b3b03585dca1"></a><!-- doxytag: member="update_trans.c::tdtd_ready_for_cancel_log" ref="a8b84a30e3c7b1d7d8ef1b3b03585dca1" args="(struct target_distribute_txn_data *tdtd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool tdtd_ready_for_cancel_log </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtarget__distribute__txn__data.html">target_distribute_txn_data</a> *&nbsp;</td>
          <td class="paramname"> <em>tdtd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if there are committed transaction. </p>
<p>Check if there are committed transaction in the distribute transaction list, then cancel the update records for those committed transaction. Because the distribute transaction in the list are sorted by batchid, and cancellation will be done by batchid order, so we only check the first the transaction(with lowest batchid) in the list.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lod</em>&nbsp;</td><td>lod device where cancel thread is</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>if it is ready </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>if it is not ready </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01330">1330</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="lu__target_8h_source.html#l00119">lu_target::lut_obd</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_recovering</a>, <a class="el" href="lu__target_8h_source.html#l00089">target_distribute_txn_data::tdtd_batchid_lock</a>, <a class="el" href="lu__target_8h_source.html#l00096">target_distribute_txn_data::tdtd_committed_batchid</a>, <a class="el" href="lu__target_8h_source.html#l00099">target_distribute_txn_data::tdtd_list</a>, <a class="el" href="lu__target_8h_source.html#l00091">target_distribute_txn_data::tdtd_lut</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, and <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a781f9ae7819e282238729641f99ddcf1"></a><!-- doxytag: member="update_trans.c::thandle_get_sub_by_dt" ref="a781f9ae7819e282238729641f99ddcf1" args="(const struct lu_env *env, struct thandle *th, struct dt_device *sub_dt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthandle.html">thandle</a>* thandle_get_sub_by_dt </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>sub_dt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </p>
<p>Get sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> from the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> according to the sub <a class="el" href="structdt__device.html">dt_device</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> on the top layer. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>sub_dt</em>&nbsp;</td><td>sub <a class="el" href="structdt__device.html">dt_device</a> used to get sub transaction</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a></em>&nbsp;</td><td>of sub transaction if succeed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>PTR_ERR(errno)</em>&nbsp;</td><td>if failed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01164">1164</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="update__trans_8c_source.html#l01134">create_sub_thandle_with_thandle()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="update__trans_8c_source.html#l00423">lookup_sub_thandle()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_wait_submit</a>, <a class="el" href="lustre__update_8h_source.html#l00284">top_multiple_thandle::tmt_master_sub_dt</a>, <a class="el" href="update__trans_8c_source.html#l01112">top_trans_create_tmt()</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>.</p>

<p>Referenced by <a class="el" href="mdd__dir_8c_source.html#l01188">mdd_declare_links_add()</a>, <a class="el" href="mdd__dir_8c_source.html#l01149">mdd_links_write()</a>, <a class="el" href="osp__trans_8c_source.html#l01227">osp_get_storage_thandle()</a>, <a class="el" href="osp__sync_8c_source.html#l00357">osp_sync_add_rec()</a>, <a class="el" href="osp__sync_8c_source.html#l00294">osp_sync_declare_add()</a>, and <a class="el" href="lustre__update_8h_source.html#l00454">thandle_get_sub()</a>.</p>

</div>
</div>
<a class="anchor" id="aa95955ef1e126ee97ed42eb07d38248e"></a><!-- doxytag: member="update_trans.c::top_check_write_updates" ref="aa95955ef1e126ee97ed42eb07d38248e" args="(struct top_thandle *top_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool top_check_write_updates </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check whether we need write updates record. </p>
<p>Check if the updates for the <a class="el" href="structtop__thandle.html">top_thandle</a> needs to be writen to all targets. Only if the transaction succeeds and the updates number &gt; 2, it will write the updates,</p>
<p>[in] top_th top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>if it needs to write updates </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>if it does not need to write updates </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00844">844</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>, <a class="el" href="lustre__update_8h_source.html#l00273">thandle_update_records::tur_update_records</a>, and <a class="el" href="lustre__idl_8h_source.html#l04029">update_records::ur_update_count</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="af9ad3167e880c03421c54495b1c62b59"></a><!-- doxytag: member="update_trans.c::top_multiple_thandle_destroy" ref="af9ad3167e880c03421c54495b1c62b59" args="(struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void top_multiple_thandle_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Top multiple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> destroy. </p>
<p>Destroy multiple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> and all its sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tmt</em>&nbsp;</td><td><a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> to be destroyed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01242">1242</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>, <a class="el" href="lustre__update_8h_source.html#l00297">top_multiple_thandle::tmt_magic</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, and <a class="el" href="lustre__update_8h_source.html#l00282">TOP_THANDLE_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="lustre__update_8h_source.html#l00473">top_multiple_thandle_put()</a>.</p>

</div>
</div>
<a class="anchor" id="a6860723eb62b04e6dedadbfb1b72874e"></a><!-- doxytag: member="update_trans.c::top_multiple_thandle_dump" ref="a6860723eb62b04e6dedadbfb1b72874e" args="(struct top_multiple_thandle *tmt, __u32 mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void top_multiple_thandle_dump </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dump top mulitple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </p>
<p>Dump top multiple <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> and all of its sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to the debug log.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td>debug mask </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em></em>&nbsp;</td><td><a class="el" href="structtop__thandle.html">top_thandle</a> to be dumped </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00069">69</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="lustre__idl_8h_source.html#l03346">llog_cookie::lgc_index</a>, <a class="el" href="lustre__idl_8h_source.html#l03344">llog_cookie::lgc_lgl</a>, <a class="el" href="lustre__idl_8h_source.html#l03064">llog_logid::lgl_oi</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00323">sub_thandle::st_cookie_list</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_stopped</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="lustre__update_8h_source.html#l00314">sub_thandle_cookie::stc_cookie</a>, <a class="el" href="lustre__update_8h_source.html#l00315">sub_thandle_cookie::stc_list</a>, <a class="el" href="lustre__update_8h_source.html#l00295">top_multiple_thandle::tmt_batchid</a>, <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00297">top_multiple_thandle::tmt_magic</a>, <a class="el" href="lustre__update_8h_source.html#l00284">top_multiple_thandle::tmt_master_sub_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00285">top_multiple_thandle::tmt_refcount</a>, <a class="el" href="lustre__update_8h_source.html#l00296">top_multiple_thandle::tmt_result</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, and <a class="el" href="lustre__update_8h_source.html#l00282">TOP_THANDLE_MAGIC</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00667">distribute_txn_assign_batchid()</a>, <a class="el" href="update__trans_8c_source.html#l01277">distribute_txn_cancel_records()</a>, <a class="el" href="update__trans_8c_source.html#l01544">distribute_txn_commit_thread()</a>, <a class="el" href="update__trans_8c_source.html#l00694">distribute_txn_insert_by_batchid()</a>, <a class="el" href="update__trans_8c_source.html#l00453">sub_trans_commit_cb_internal()</a>, and <a class="el" href="update__trans_8c_source.html#l00408">top_trans_committed_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="a1cab569ea52ae4435453516f2d47a27c"></a><!-- doxytag: member="update_trans.c::top_trans_committed_cb" ref="a1cab569ea52ae4435453516f2d47a27c" args="(struct top_multiple_thandle *tmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void top_trans_committed_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>tmt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> commit callback. </p>
<p>This callback will be called when all of sub transactions are committed.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to be committed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00408">408</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="update__trans_8c_source.html#l00390">distribute_txn_commit_thread_running()</a>, <a class="el" href="dt__object_8h_source.html#l01774">dt2lu_dev()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00283">lu_device::ld_site</a>, <a class="el" href="lu__object_8h_source.html#l00649">lu_site::ls_tgt</a>, <a class="el" href="lu__target_8h_source.html#l00122">lu_target::lut_tdtd</a>, <a class="el" href="libcfs__debug_8h_source.html#l00358">RETURN_EXIT</a>, <a class="el" href="lu__target_8h_source.html#l00102">target_distribute_txn_data::tdtd_commit_thread_waitq</a>, <a class="el" href="lustre__update_8h_source.html#l00299">top_multiple_thandle::tmt_committed</a>, <a class="el" href="lustre__update_8h_source.html#l00284">top_multiple_thandle::tmt_master_sub_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00285">top_multiple_thandle::tmt_refcount</a>, and <a class="el" href="update__trans_8c_source.html#l00069">top_multiple_thandle_dump()</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00453">sub_trans_commit_cb_internal()</a>.</p>

</div>
</div>
<a class="anchor" id="ac6f54ce638b398bc7fbb71605afbc6ad"></a><!-- doxytag: member="update_trans.c::top_trans_create" ref="ac6f54ce638b398bc7fbb71605afbc6ad" args="(const struct lu_env *env, struct dt_device *master_dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structthandle.html">thandle</a>* top_trans_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>master_dev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create the top transaction. </p>
<p>Create the top transaction on the master device. It will create a top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> and a sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> on the master device.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>master_dev</em>&nbsp;</td><td>master_dev the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> will be created</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the created <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR(errno)</em>&nbsp;</td><td>if creation failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00598">598</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="obd__support_8h_source.html#l00705">OBD_ALLOC_GFP</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="dt__object_8h_source.html#l01841">thandle::th_tags</a>, <a class="el" href="dt__object_8h_source.html#l01836">thandle::th_top</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_wait_submit</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, and <a class="el" href="lod__dev_8c_source.html#l01208">lod_trans_create()</a>.</p>

</div>
</div>
<a class="anchor" id="aa54680b77690cc5b396f50765afcbf88"></a><!-- doxytag: member="update_trans.c::top_trans_create_tmt" ref="aa54680b77690cc5b396f50765afcbf88" args="(const struct lu_env *env, struct top_thandle *top_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int top_trans_create_tmt </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create <a class="el" href="structtop__multiple__thandle.html">top_multiple_thandle</a> for <a class="el" href="structtop__thandle.html">top_thandle</a>. </p>
<p>Create top_mutilple_thandle to manage the mutiple node transaction for <a class="el" href="structtop__thandle.html">top_thandle</a>, and it also needs to add master sub <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> to the sub trans list now.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>top_th</em>&nbsp;</td><td>the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if creation succeeds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if creation fails </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l01112">1112</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="lustre__update_8h_source.html#l00290">top_multiple_thandle::tmt_commit_list</a>, <a class="el" href="lustre__update_8h_source.html#l00297">top_multiple_thandle::tmt_magic</a>, <a class="el" href="lustre__update_8h_source.html#l00285">top_multiple_thandle::tmt_refcount</a>, <a class="el" href="lustre__update_8h_source.html#l00294">top_multiple_thandle::tmt_stop_waitq</a>, <a class="el" href="lustre__update_8h_source.html#l00288">top_multiple_thandle::tmt_sub_lock</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="lustre__update_8h_source.html#l00282">TOP_THANDLE_MAGIC</a>, and <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, and <a class="el" href="update__trans_8c_source.html#l01164">thandle_get_sub_by_dt()</a>.</p>

</div>
</div>
<a class="anchor" id="ad7cc31b14ee872e5d25ee4b3fd30b65f"></a><!-- doxytag: member="update_trans.c::top_trans_is_stopped" ref="ad7cc31b14ee872e5d25ee4b3fd30b65f" args="(struct top_thandle *top_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool top_trans_is_stopped </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if top transaction is stopped. </p>
<p>Check if top transaction is stopped, only if all sub transaction is stopped, then the top transaction is stopped.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>top_th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>if the top transaction is stopped. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>if the top transaction is not stopped. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00882">882</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__update_8h_source.html#l00326">sub_thandle::st_result</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_stopped</a>, <a class="el" href="lustre__update_8h_source.html#l00329">sub_thandle::st_sub_list</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00912">top_trans_wait_result()</a>.</p>

</div>
</div>
<a class="anchor" id="a8c42630ece7c32f323382e2b12371a69"></a><!-- doxytag: member="update_trans.c::top_trans_start" ref="a8c42630ece7c32f323382e2b12371a69" args="(const struct lu_env *env, struct dt_device *master_dev, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int top_trans_start </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>master_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>start the top transaction. </p>
<p>Start all of its sub transactions, then start master sub transaction.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>master_dev</em>&nbsp;</td><td>master_dev the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> will be start </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if transaction start succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if start fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00784">784</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l02054">dt_trans_start()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="update__trans_8c_source.html#l00750">prepare_multiple_node_trans()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_started</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_local</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, <a class="el" href="dt__object_8h_source.html#l01841">thandle::th_tags</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, and <a class="el" href="lod__dev_8c_source.html#l01230">lod_trans_start()</a>.</p>

</div>
</div>
<a class="anchor" id="a165db60fce8230df959247137d37567d"></a><!-- doxytag: member="update_trans.c::top_trans_stop" ref="a165db60fce8230df959247137d37567d" args="(const struct lu_env *env, struct dt_device *master_dev, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int top_trans_stop </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__device.html">dt_device</a> *&nbsp;</td>
          <td class="paramname"> <em>master_dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop the top transaction. </p>
<p>Stop the transaction on the master device first, then stop transactions on other sub devices.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>master_dev</em>&nbsp;</td><td>master_dev the top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> will be created </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if stop transaction succeeds. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>errno if stop transaction fails. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00935">935</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="dt__object_8h_source.html#l01723">dt_device::dd_lu_dev</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00287">lu_device::ld_obd</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="update__trans_8c_source.html#l00423">lookup_sub_thandle()</a>, <a class="el" href="llog__test_8c_source.html#l00947">lur</a>, <a class="el" href="lustre__idl_8h_source.html#l04042">llog_update_record::lur_update_rec</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="update__trans_8c_source.html#l00343">prepare_writing_updates()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__update_8h_source.html#l00322">sub_thandle::st_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00332">sub_thandle::st_started</a>, <a class="el" href="lustre__update_8h_source.html#l00321">sub_thandle::st_sub_th</a>, <a class="el" href="update__trans_8c_source.html#l00453">sub_trans_commit_cb_internal()</a>, <a class="el" href="update__trans_8c_source.html#l00167">sub_updates_write()</a>, <a class="el" href="tgt__internal_8h_source.html#l00095">tgt_th_info()</a>, <a class="el" href="dt__object_8h_source.html#l01828">thandle::th_dev</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_local</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="dt__object_8h_source.html#l01848">thandle::th_sync</a>, <a class="el" href="dt__object_8h_source.html#l01841">thandle::th_tags</a>, <a class="el" href="lustre__update_8h_source.html#l00290">top_multiple_thandle::tmt_commit_list</a>, <a class="el" href="lustre__update_8h_source.html#l00284">top_multiple_thandle::tmt_master_sub_dt</a>, <a class="el" href="lustre__update_8h_source.html#l00296">top_multiple_thandle::tmt_result</a>, <a class="el" href="lustre__update_8h_source.html#l00287">top_multiple_thandle::tmt_sub_thandle_list</a>, <a class="el" href="lustre__update_8h_source.html#l00292">top_multiple_thandle::tmt_update_records</a>, <a class="el" href="update__trans_8c_source.html#l00844">top_check_write_updates()</a>, <a class="el" href="lustre__update_8h_source.html#l00473">top_multiple_thandle_put()</a>, <a class="el" href="update__trans_8c_source.html#l00912">top_trans_wait_result()</a>, <a class="el" href="lustre__update_8h_source.html#l00308">top_thandle::tt_master_sub_thandle</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>, <a class="el" href="tgt__internal_8h_source.html#l00066">tgt_thread_info::tti_transno</a>, <a class="el" href="lustre__update_8h_source.html#l00277">thandle_update_records::tur_update_params</a>, <a class="el" href="lustre__update_8h_source.html#l00273">thandle_update_records::tur_update_records</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, <a class="el" href="lustre__idl_8h_source.html#l04023">update_records::ur_master_transno</a>, and <a class="el" href="lustre__idl_8h_source.html#l04030">update_records::ur_param_count</a>.</p>

<p>Referenced by <a class="el" href="update__recovery_8c_source.html#l01285">distribute_txn_replay_handle()</a>, and <a class="el" href="lod__dev_8c_source.html#l01288">lod_trans_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="ab63eb3ec2b599b7dd003d776b88fbdf8"></a><!-- doxytag: member="update_trans.c::top_trans_wait_result" ref="ab63eb3ec2b599b7dd003d776b88fbdf8" args="(struct top_thandle *top_th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int top_trans_wait_result </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structtop__thandle.html">top_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>top_th</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait result of top transaction. </p>
<p>Wait until all sub transaction get its result.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>top_th</em>&nbsp;</td><td>top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>result of top <a class="el" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="update__trans_8c_source.html#l00912">912</a> of file <a class="el" href="update__trans_8c_source.html">update_trans.c</a>.</p>

<p>References <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="dt__object_8h_source.html#l01845">thandle::th_result</a>, <a class="el" href="lustre__update_8h_source.html#l00294">top_multiple_thandle::tmt_stop_waitq</a>, <a class="el" href="update__trans_8c_source.html#l00882">top_trans_is_stopped()</a>, <a class="el" href="lustre__update_8h_source.html#l00310">top_thandle::tt_multiple_thandle</a>, and <a class="el" href="lustre__update_8h_source.html#l00306">top_thandle::tt_super</a>.</p>

<p>Referenced by <a class="el" href="update__trans_8c_source.html#l00935">top_trans_stop()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:51 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
