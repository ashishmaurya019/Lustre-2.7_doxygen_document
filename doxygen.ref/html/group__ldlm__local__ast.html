<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: Default AST handlers for local locks</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Default AST handlers for local locks<br/>
<small>
[<a class="el" href="group__LDLM.html">Lustre Distributed Lock Manager</a>]</small>
</h1>
<p>These AST handlers are typically used for server-side local locks and are also used by client-side lock handlers to perform minimum level base processing.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__local__ast.html#ga9962ac0cc2bd7e279cf0b977d822feb3">ldlm_blocking_ast_nocheck</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A helper to build a blocking AST function.  <a href="#ga9962ac0cc2bd7e279cf0b977d822feb3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__local__ast.html#gacc93548bb07532aa1d816dee71bd2ecb">ldlm_blocking_ast</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock, struct <a class="el" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *desc, void *data, int flag)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Server blocking AST.  <a href="#gacc93548bb07532aa1d816dee71bd2ecb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__local__ast.html#ga158dc17797fe9252638377c70f5f9558">ldlm_glimpse_ast</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock, void *reqp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implements <a class="el" href="structldlm__lock.html#aaa0d1608f452158ab011eecc6f978058" title="Lock glimpse handler.">ldlm_lock::l_glimpse_ast</a> for extent locks acquired on the server.  <a href="#ga158dc17797fe9252638377c70f5f9558"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__local__ast.html#ga44a28deab27f79e7a1ab7e77c7a59208">ldlm_completion_ast_async</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Implementation of -&gt;l_completion_ast() for a client, that doesn't wait until lock is granted.  <a href="#ga44a28deab27f79e7a1ab7e77c7a59208"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ldlm__local__ast.html#gaae5738d417a8624f65b5418d57fef359">ldlm_completion_ast</a> (struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *lock, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generic LDLM "completion" AST.  <a href="#gaae5738d417a8624f65b5418d57fef359"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>These AST handlers are typically used for server-side local locks and are also used by client-side lock handlers to perform minimum level base processing. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gacc93548bb07532aa1d816dee71bd2ecb"></a><!-- doxytag: member="lustre_dlm.h::ldlm_blocking_ast" ref="gacc93548bb07532aa1d816dee71bd2ecb" args="(struct ldlm_lock *lock, struct ldlm_lock_desc *desc, void *data, int flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_blocking_ast </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Server blocking AST. </p>
<p>-&gt;l_blocking_ast() callback for LDLM locks acquired by server-side OBDs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lock</em>&nbsp;</td><td>the lock which blocks a request or cancelling lock </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>desc</em>&nbsp;</td><td>unused </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>unused </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flag</em>&nbsp;</td><td>indicates whether this cancelling or blocking callback </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__ldlm__local__ast.html#ga9962ac0cc2bd7e279cf0b977d822feb3" title="A helper to build a blocking AST function.">ldlm_blocking_ast_nocheck</a> </dd></dl>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00354">354</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__dlm_8h_source.html#l00741">ldlm_lock::l_blocking_ast</a>, <a class="el" href="ldlm__request_8c_source.html#l00354">ldlm_blocking_ast()</a>, <a class="el" href="ldlm__request_8c_source.html#l00315">ldlm_blocking_ast_nocheck()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00104">LDLM_CB_CANCELING</a>, <a class="el" href="l__lock_8c_source.html#l00051">lock_res_and_lock()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="l__lock_8c_source.html#l00067">unlock_res_and_lock()</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l00355">__lfsck_ibits_lock()</a>, <a class="el" href="ldlm__request_8c_source.html#l00354">ldlm_blocking_ast()</a>, <a class="el" href="lfsck__layout_8c_source.html#l01954">lfsck_layout_slave_conditional_destroy()</a>, <a class="el" href="mdt__reint_8c_source.html#l01250">mdt_rename_lock()</a>, <a class="el" href="mgs__handler_8c_source.html#l00227">mgs_revoke_lock()</a>, <a class="el" href="ofd__obd_8c_source.html#l00984">ofd_destroy_by_fid()</a>, and <a class="el" href="tgt__handler_8c_source.html#l01676">tgt_extent_lock()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9962ac0cc2bd7e279cf0b977d822feb3"></a><!-- doxytag: member="lustre_dlm.h::ldlm_blocking_ast_nocheck" ref="ga9962ac0cc2bd7e279cf0b977d822feb3" args="(struct ldlm_lock *lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_blocking_ast_nocheck </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A helper to build a blocking AST function. </p>
<p>Perform a common operation for blocking ASTs: defferred lock cancellation.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lock</em>&nbsp;</td><td>the lock blocking or canceling AST was called on </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="mdt__internal_8h.html#a0f14f148a9871f9053ce49edbfe6788d" title="Blocking AST for mdt locks.">mdt_blocking_ast</a> </dd>
<dd>
<a class="el" href="group__ldlm__local__ast.html#gacc93548bb07532aa1d816dee71bd2ecb" title="Server blocking AST.">ldlm_blocking_ast</a> </dd></dl>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00315">315</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__dlm_8h_source.html#l00784">ldlm_lock::l_readers</a>, <a class="el" href="lustre__dlm_8h_source.html#l00785">ldlm_lock::l_writers</a>, <a class="el" href="lustre__dlm_8h_source.html#l00616">LCF_ASYNC</a>, <a class="el" href="ldlm__request_8c_source.html#l01345">ldlm_cli_cancel()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="ldlm__lock_8c_source.html#l00582">ldlm_lock2handle()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00175">ldlm_set_cbpending</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="l__lock_8c_source.html#l00067">unlock_res_and_lock()</a>.</p>

<p>Referenced by <a class="el" href="ldlm__request_8c_source.html#l00354">ldlm_blocking_ast()</a>, and <a class="el" href="mdt__handler_8c_source.html#l02308">mdt_blocking_ast()</a>.</p>

</div>
</div>
<a class="anchor" id="gaae5738d417a8624f65b5418d57fef359"></a><!-- doxytag: member="lustre_dlm.h::ldlm_completion_ast" ref="gaae5738d417a8624f65b5418d57fef359" args="(struct ldlm_lock *lock, __u64 flags, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_completion_ast </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generic LDLM "completion" AST. </p>
<p>This is called in several cases:</p>
<ul>
<li>when a reply to an ENQUEUE RPC is received from the server (<a class="el" href="group__ldlm__cli__api.html#gac421005283912bb5186b035013aa58c0" title="Finishing portion of client lock enqueue code.">ldlm_cli_enqueue_fini()</a>). Lock might be granted or not granted at this point (determined by flags);</li>
</ul>
<ul>
<li>when LDLM_CP_CALLBACK RPC comes to client to notify it that lock has been granted;</li>
</ul>
<ul>
<li>when ldlm_lock_match(LDLM_FL_LVB_READY) is about to wait until lock gets correct lvb;</li>
</ul>
<ul>
<li>to force all locks when resource is destroyed (<a class="el" href="ldlm__resource_8c.html#a6565fc42cf1ce9bca4abb49cf55cefa8" title="Cancel and destroy all locks on a resource.">cleanup_resource()</a>);</li>
</ul>
<ul>
<li>during lock conversion (not used currently).</li>
</ul>
<p>If lock is not granted in the first case, this function waits until second or penultimate cases happen in some other thread. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00230">230</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="linux-time_8h_source.html#l00182">cfs_time_seconds()</a>, <a class="el" href="obd_8h_source.html#l00162">client_obd::cl_import</a>, <a class="el" href="genops_8c_source.html#l00729">class_exp2obd()</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__import_8h_source.html#l00239">obd_import::imp_conn_cnt</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="ldlm__request_8c_source.html#l00077">interrupted_completion_wait()</a>, <a class="el" href="ldlm__internal_8h_source.html#l00309">is_granted_or_cancelled()</a>, <a class="el" href="lustre__dlm_8h_source.html#l00759">ldlm_lock::l_conn_export</a>, <a class="el" href="lustre__dlm_8h_source.html#l00797">ldlm_lock::l_last_activity</a>, <a class="el" href="lustre__lib_8h_source.html#l00329">l_wait_event</a>, <a class="el" href="lustre__dlm_8h_source.html#l00791">ldlm_lock::l_waitq</a>, <a class="el" href="ldlm__request_8c_source.html#l00160">ldlm_completion_tail()</a>, <a class="el" href="ldlm__request_8c_source.html#l00142">ldlm_cp_timeout()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="ldlm__request_8c_source.html#l00090">ldlm_expired_completion_wait()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00370">LDLM_FL_BLOCKED_MASK</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00179">LDLM_FL_WAIT_NOREPROC</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00101">ldlm_is_no_timeout</a>, <a class="el" href="lustre__dlm_8h_source.html#l01006">ldlm_lock_to_ns()</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00161">ldlm_set_fail_loc</a>, <a class="el" href="ldlm__request_8c_source.html#l00083">lock_wait_data::lwd_conn_cnt</a>, <a class="el" href="ldlm__request_8c_source.html#l00082">lock_wait_data::lwd_lock</a>, <a class="el" href="lustre__lib_8h_source.html#l00209">LWI_INTR</a>, <a class="el" href="lustre__lib_8h_source.html#l00189">LWI_TIMEOUT_INTR</a>, <a class="el" href="lustre__dlm_8h_source.html#l00518">ns_is_client()</a>, <a class="el" href="obd__support_8h_source.html#l00622">OBD_FAIL_CHECK_RESET</a>, <a class="el" href="obd__support_8h_source.html#l00352">OBD_FAIL_LDLM_CP_BL_RACE</a>, <a class="el" href="obd__support_8h_source.html#l00351">OBD_FAIL_LDLM_INTR_CP_AST</a>, <a class="el" href="obd__support_8h_source.html#l00628">OBD_FAIL_ONCE</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="gnilnd__modparams_8c_source.html#l00052">timeout</a>, and <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>.</p>

<p>Referenced by <a class="el" href="lfsck__lib_8c_source.html#l00355">__lfsck_ibits_lock()</a>, <a class="el" href="echo_8c_source.html#l00548">echo_setup()</a>, <a class="el" href="lfsck__layout_8c_source.html#l01954">lfsck_layout_slave_conditional_destroy()</a>, <a class="el" href="file_8c_source.html#l04076">ll_layout_refresh_locked()</a>, <a class="el" href="xattr__cache_8c_source.html#l00311">ll_xattr_find_get_lock()</a>, <a class="el" href="mdc__locks_8c_source.html#l01077">mdc_intent_lock()</a>, <a class="el" href="mdt__internal_8h_source.html#l00959">mdt_fid_lock()</a>, <a class="el" href="mdt__reint_8c_source.html#l00378">mdt_lock_slaves()</a>, <a class="el" href="mdt__handler_8c_source.html#l02431">mdt_remote_object_lock()</a>, <a class="el" href="mdt__reint_8c_source.html#l01250">mdt_rename_lock()</a>, <a class="el" href="mgc__request_8c_source.html#l01049">mgc_enqueue()</a>, <a class="el" href="mgs__handler_8c_source.html#l00166">mgs_completion_ast_generic()</a>, <a class="el" href="ofd__obd_8c_source.html#l00984">ofd_destroy_by_fid()</a>, <a class="el" href="osc__lock_8c_source.html#l00743">osc_lock_build_einfo()</a>, <a class="el" href="statahead_8c_source.html#l00726">sa_prep_data()</a>, and <a class="el" href="tgt__handler_8c_source.html#l01676">tgt_extent_lock()</a>.</p>

</div>
</div>
<a class="anchor" id="ga44a28deab27f79e7a1ab7e77c7a59208"></a><!-- doxytag: member="lustre_dlm.h::ldlm_completion_ast_async" ref="ga44a28deab27f79e7a1ab7e77c7a59208" args="(struct ldlm_lock *lock, __u64 flags, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_completion_ast_async </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implementation of -&gt;l_completion_ast() for a client, that doesn't wait until lock is granted. </p>
<p>Suitable for locks enqueued through <a class="el" href="structptlrpcd.html">ptlrpcd</a>, of other threads that cannot block for long. </p>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00188">188</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__dlm_8h_source.html#l00694">ldlm_lock::l_resource</a>, <a class="el" href="lustre__dlm_8h_source.html#l00791">ldlm_lock::l_waitq</a>, <a class="el" href="ldlm__request_8c_source.html#l00160">ldlm_completion_tail()</a>, <a class="el" href="lustre__dlm_8h_source.html#l01168">LDLM_DEBUG</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00370">LDLM_FL_BLOCKED_MASK</a>, <a class="el" href="lustre__dlm__flags_8h_source.html#l00179">LDLM_FL_WAIT_NOREPROC</a>, <a class="el" href="ldlm__lock_8c_source.html#l02147">ldlm_reprocess_all()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ga158dc17797fe9252638377c70f5f9558"></a><!-- doxytag: member="lustre_dlm.h::ldlm_glimpse_ast" ref="ga158dc17797fe9252638377c70f5f9558" args="(struct ldlm_lock *lock, void *reqp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ldlm_glimpse_ast </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldlm__lock.html">ldlm_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>reqp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Implements <a class="el" href="structldlm__lock.html#aaa0d1608f452158ab011eecc6f978058" title="Lock glimpse handler.">ldlm_lock::l_glimpse_ast</a> for extent locks acquired on the server. </p>
<p>Returning -ELDLM_NO_LOCK_DATA actually works, but the reason for that is rather subtle: with OST-side locking, it may so happen that _all_ extent locks are held by the OST. If client wants to obtain the current file size it calls <a class="el" href="llite__internal_8h.html#ab9e3a3237fae2c31cd430d7eb9135469">ll_glimpse_size()</a>, and (as all locks are held only on the server), this dummy glimpse callback fires and does nothing. The client still receives the correct file size due to the following fragment of code in ldlm_cb_interpret():</p>
<p>if (rc == -ELDLM_NO_LOCK_DATA) { LDLM_DEBUG(lock, "lost race - client has a lock but no" "inode"); ldlm_res_lvbo_update(lock-&gt;l_resource, NULL, 1); }</p>
<p>That is, after the glimpse returns this error, <a class="el" href="ofd__lvb_8c.html#a8f035d65c5f1fe2223d91482d3dfb16e" title="Implementation of ldlm_valblock_ops::lvbo_update for OFD.">ofd_lvbo_update()</a> is called and returns the updated file attributes from the inode to the client.</p>
<p>See also comment in <a class="el" href="ofd__dlm_8c.html#abe0aad5ebcdfc374de558116d45cbff1" title="OFD lock intent policy.">ofd_intent_policy()</a> on why servers must set a non-NULL l_glimpse_ast when grabbing DLM locks. Otherwise, the server will assume that the object is in the process of being destroyed.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lock</em>&nbsp;</td><td>DLM lock being glimpsed, unused </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>reqp</em>&nbsp;</td><td>pointer to <a class="el" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a>, unused</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-ELDLM_NO_LOCK_DATA</em>&nbsp;</td><td>to get attributes from disk object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ldlm__request_8c_source.html#l00407">407</a> of file <a class="el" href="ldlm__request_8c_source.html">ldlm_request.c</a>.</p>

<p>References <a class="el" href="lustre__dlm_8h_source.html#l00080">ELDLM_NO_LOCK_DATA</a>.</p>

<p>Referenced by <a class="el" href="tgt__handler_8c_source.html#l01676">tgt_extent_lock()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:52 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
