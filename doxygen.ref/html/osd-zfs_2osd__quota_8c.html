<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/osd-zfs/osd_quota.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/osd-zfs/osd_quota.c File Reference</h1><code>#include &lt;<a class="el" href="lustre__quota_8h_source.html">lustre_quota.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="osd-zfs_2osd__internal_8h_source.html">osd_internal.h</a>&quot;</code><br/>

<p><a href="osd-zfs_2osd__quota_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a52fef34f90b0782384e3d9081685cb54">osd_quota_fid2dmu</a> (const struct <a class="el" href="structlu__fid.html">lu_fid</a> *fid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to retrieve DMU object id from fid for accounting object.  <a href="#a52fef34f90b0782384e3d9081685cb54"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a4ade1eaa153f285e5a976d887865aedf">osd_objset_user_iused</a> (struct <a class="el" href="structosd__device.html">osd_device</a> *osd, uint64_t uidbytes)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to estimate the number of inodes in use for a give uid/gid from the block usage.  <a href="#a4ade1eaa153f285e5a976d887865aedf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#abcfa7cac1bb24cd5dc754d4f10b8166a">osd_acct_index_lookup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dtobj, struct dt_rec *dtrec, const struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *dtkey)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Space Accounting Management.  <a href="#abcfa7cac1bb24cd5dc754d4f10b8166a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct dt_it *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#af2a88602af15c39623023acf9e22ad82">osd_it_acct_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structdt__object.html">dt_object</a> *dt, __u32 attr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize osd Iterator for given osd index object.  <a href="#af2a88602af15c39623023acf9e22ad82"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#ae81118705ec1495afcb4579a50ccdb26">osd_it_acct_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free given iterator.  <a href="#ae81118705ec1495afcb4579a50ccdb26"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a0b43e5b349726cbf44905ddd0f0228da">osd_it_acct_next</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move on to the next valid entry.  <a href="#a0b43e5b349726cbf44905ddd0f0228da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a8f402ea7336497ab5ff04beda7653247">osd_it_acct_key</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return pointer to the key under iterator.  <a href="#a8f402ea7336497ab5ff04beda7653247"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a2aa578c373a121880800ef37fc1f96f0">osd_it_acct_key_size</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return size of key under iterator (in bytes).  <a href="#a2aa578c373a121880800ef37fc1f96f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a99c4c3437600946721b068de5b50b83b">osd_zap_cursor_retrieve_value</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, zap_cursor_t *zc, char *<a class="el" href="lnet_2utils_2debug_8c.html#a1fe855c208bc17a51a4d34fefdb2d5b1">buf</a>, int buf_size, int *bytes_read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a2184eb67ee89e15ec3eba22ba80758da">osd_it_acct_rec</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct dt_it *di, struct dt_rec *dtrec, __u32 attr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return pointer to the record under iterator.  <a href="#a2184eb67ee89e15ec3eba22ba80758da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a2ea6df6e8090fc753e38229333cdf986">osd_it_acct_store</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns cookie for current Iterator position.  <a href="#a2ea6df6e8090fc753e38229333cdf986"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#ab27f0094dfd99d2cd2a2b8f1abbf2369">osd_it_acct_load</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const struct dt_it *di, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> hash)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Restore iterator from cookie.  <a href="#ab27f0094dfd99d2cd2a2b8f1abbf2369"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#aadb0023f23418507b702ad1a75b09d31">osd_it_acct_get</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct dt_it *di, const struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *key)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move Iterator to record specified by <em>key</em>, if the <em>key</em> isn't found, move to the first valid record.  <a href="#aadb0023f23418507b702ad1a75b09d31"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#ad8fa0a75091ff5b37865165d003994f1">osd_it_acct_put</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct dt_it *di)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release Iterator.  <a href="#ad8fa0a75091ff5b37865165d003994f1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#a39f3d9fe1d32f995bffdbd9e7fd01b6b">osd_declare_quota</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structosd__device.html">osd_device</a> *osd, qid_t uid, qid_t gid, long long space, struct <a class="el" href="structosd__thandle.html">osd_thandle</a> *oh, bool is_blk, int *flags, bool force)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Quota Enforcement Management.  <a href="#a39f3d9fe1d32f995bffdbd9e7fd01b6b"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdt__index__operations.html">dt_index_operations</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="osd-zfs_2osd__quota_8c.html#ae44c2ce6357b0f5ccb5abf0ef60d23ba">osd_acct_index_ops</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Index and Iterator operations for accounting objects.  <a href="#ae44c2ce6357b0f5ccb5abf0ef60d23ba"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="abcfa7cac1bb24cd5dc754d4f10b8166a"></a><!-- doxytag: member="osd_quota.c::osd_acct_index_lookup" ref="abcfa7cac1bb24cd5dc754d4f10b8166a" args="(const struct lu_env *env, struct dt_object *dtobj, struct dt_rec *dtrec, const struct dt_key *dtkey)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_acct_index_lookup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dtobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_rec *&nbsp;</td>
          <td class="paramname"> <em>dtrec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td>
          <td class="paramname"> <em>dtkey</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Space Accounting Management. </p>
<p>Return space usage consumed by a given uid or gid. Block usage is accurrate since it is maintained by DMU itself. However, DMU does not provide inode accounting, so the inodes in use is estimated from the block usage and statfs information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>env</em>&nbsp;</td><td>- is the environment passed by the caller </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtobj</em>&nbsp;</td><td>- is the accounting object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtrec</em>&nbsp;</td><td>- is the record to fill with space usage information </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtkey</em>&nbsp;</td><td>- is the id the of the user or group for which we would like to access disk usage.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>+ve</em>&nbsp;</td><td>- success : exact match </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>- failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00088">88</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="lustre__idl_8h_source.html#l01929">lquota_acct_rec::bspace</a>, <a class="el" href="parallel__grouplock_8c_source.html#l00078">buf</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00155">D_QUOTA</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l01930">lquota_acct_rec::ispace</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00250">osd_device::od_os</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00267">osd_device::od_quota_iused_est</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00285">osd_device::od_svname</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00319">osd_object::oo_db</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00905">osd_dt_obj()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00884">osd_obj2dev()</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00049">osd_objset_user_iused()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00037">osd_quota_fid2dmu()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00588">osd_thread_info::oti_buf</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a39f3d9fe1d32f995bffdbd9e7fd01b6b"></a><!-- doxytag: member="osd_quota.c::osd_declare_quota" ref="a39f3d9fe1d32f995bffdbd9e7fd01b6b" args="(const struct lu_env *env, struct osd_device *osd, qid_t uid, qid_t gid, long long space, struct osd_thandle *oh, bool is_blk, int *flags, bool force)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int osd_declare_quota </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosd__device.html">osd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qid_t&nbsp;</td>
          <td class="paramname"> <em>uid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">qid_t&nbsp;</td>
          <td class="paramname"> <em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long&nbsp;</td>
          <td class="paramname"> <em>space</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosd__thandle.html">osd_thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>oh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>is_blk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>force</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Quota Enforcement Management. </p>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00482">482</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__quota_8h_source.html#l00191">lquota_id_info::lqi_id</a>, <a class="el" href="lustre__quota_8h_source.html#l00205">lquota_id_info::lqi_is_blk</a>, <a class="el" href="lustre__quota_8h_source.html#l00199">lquota_id_info::lqi_space</a>, <a class="el" href="lustre__quota_8h_source.html#l00195">lquota_id_info::lqi_type</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00289">osd_device::od_quota_slave</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00362">osd_thandle::ot_quota_trans</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00615">osd_thread_info::oti_qi</a>, <a class="el" href="lustre__idl_8h_source.html#l01851">lquota_id::qid_gid</a>, <a class="el" href="lustre__idl_8h_source.html#l01850">lquota_id::qid_uid</a>, <a class="el" href="qsd__handler_8c_source.html#l00825">qsd_op_begin()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="osd__object_8c_source.html#l01126">osd_declare_object_create()</a>, <a class="el" href="osd__object_8c_source.html#l00508">osd_declare_object_destroy()</a>, <a class="el" href="osd-zfs_2osd__io_8c_source.html#l00876">osd_declare_punch()</a>, <a class="el" href="osd-zfs_2osd__io_8c_source.html#l00154">osd_declare_write()</a>, and <a class="el" href="osd-zfs_2osd__io_8c_source.html#l00567">osd_declare_write_commit()</a>.</p>

</div>
</div>
<a class="anchor" id="ae81118705ec1495afcb4579a50ccdb26"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_fini" ref="ae81118705ec1495afcb4579a50ccdb26" args="(const struct lu_env *env, struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osd_it_acct_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free given iterator. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00194">194</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00478">osd_it_quota::oiq_obj</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00116">osd_object::oo_dt</a>, and <a class="el" href="osd__index_8c_source.html#l00130">osd_zap_cursor_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="aadb0023f23418507b702ad1a75b09d31"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_get" ref="aadb0023f23418507b702ad1a75b09d31" args="(const struct lu_env *env, struct dt_it *di, const struct dt_key *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_it_acct_get </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a> *&nbsp;</td>
          <td class="paramname"> <em>key</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move Iterator to record specified by <em>key</em>, if the <em>key</em> isn't found, move to the first valid record. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>key</em>&nbsp;</td><td>- uid or gid</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>+ve</em>&nbsp;</td><td>- di points to exact matched key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>- di points to the first valid record </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>- failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00421">421</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00383">osd_it_acct_load()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="af2a88602af15c39623023acf9e22ad82"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_init" ref="af2a88602af15c39623023acf9e22ad82" args="(const struct lu_env *env, struct dt_object *dt, __u32 attr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct dt_it* osd_it_acct_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdt__object.html">dt_object</a> *&nbsp;</td>
          <td class="paramname"> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>attr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize osd Iterator for given osd index object. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dt</em>&nbsp;</td><td>- osd index object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>attr</em>&nbsp;</td><td>- not used </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00151">151</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lu__object_8h_source.html#l00840">lu_object_exists</a>, <a class="el" href="lu__object_8h_source.html#l00770">lu_object_fid()</a>, <a class="el" href="lu__object_8h_source.html#l00709">lu_object_get()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00250">osd_device::od_os</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00478">osd_it_quota::oiq_obj</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00103">osd_it_quota::oiq_oid</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00878">osd_dev()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00905">osd_dt_obj()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00037">osd_quota_fid2dmu()</a>, <a class="el" href="osd__index_8c_source.html#l00115">osd_zap_cursor_init()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a8f402ea7336497ab5ff04beda7653247"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_key" ref="a8f402ea7336497ab5ff04beda7653247" args="(const struct lu_env *env, const struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="dt__object_8c.html#aa088e3c821ba20ee0bd6bad2f8ece91c">dt_key</a>* osd_it_acct_key </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return pointer to the key under iterator. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00236">236</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="dt__object_8c_source.html#l00058">dt_key</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00484">osd_it_quota::oiq_id</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00189">osd_thread_info::oti_za</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a2aa578c373a121880800ef37fc1f96f0"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_key_size" ref="a2aa578c373a121880800ef37fc1f96f0" args="(const struct lu_env *env, const struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_it_acct_key_size </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return size of key under iterator (in bytes). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00258">258</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ab27f0094dfd99d2cd2a2b8f1abbf2369"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_load" ref="ab27f0094dfd99d2cd2a2b8f1abbf2369" args="(const struct lu_env *env, const struct dt_it *di, __u64 hash)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_it_acct_load </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>hash</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Restore iterator from cookie. </p>
<p>if the <em>hash</em> isn't found, restore the first valid record.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hash</em>&nbsp;</td><td>- iterator location cookie</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>+ve</em>&nbsp;</td><td>- di points to exact matched key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>- di points to the first valid record </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>- failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00383">383</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00250">osd_device::od_os</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00478">osd_it_quota::oiq_obj</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00103">osd_it_quota::oiq_oid</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00884">osd_obj2dev()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd__index_8c_source.html#l00130">osd_zap_cursor_fini()</a>, <a class="el" href="osd__index_8c_source.html#l00115">osd_zap_cursor_init()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00189">osd_thread_info::oti_za</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00421">osd_it_acct_get()</a>.</p>

</div>
</div>
<a class="anchor" id="a0b43e5b349726cbf44905ddd0f0228da"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_next" ref="a0b43e5b349726cbf44905ddd0f0228da" args="(const struct lu_env *env, struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_it_acct_next </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move on to the next valid entry. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>+ve</em>&nbsp;</td><td>- iterator reached the end </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>- iterator has not reached the end yet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>- unexpected failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00215">215</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00189">osd_thread_info::oti_za</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ad8fa0a75091ff5b37865165d003994f1"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_put" ref="ad8fa0a75091ff5b37865165d003994f1" args="(const struct lu_env *env, struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osd_it_acct_put </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release Iterator. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00437">437</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2184eb67ee89e15ec3eba22ba80758da"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_rec" ref="a2184eb67ee89e15ec3eba22ba80758da" args="(const struct lu_env *env, const struct dt_it *di, struct dt_rec *dtrec, __u32 attr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_it_acct_rec </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dt_rec *&nbsp;</td>
          <td class="paramname"> <em>dtrec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>attr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return pointer to the record under iterator. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>attr</em>&nbsp;</td><td>- not used </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00308">308</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="lustre__idl_8h_source.html#l01929">lquota_acct_rec::bspace</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00155">D_QUOTA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__idl_8h_source.html#l01930">lquota_acct_rec::ispace</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00250">osd_device::od_os</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00267">osd_device::od_quota_iused_est</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00285">osd_device::od_svname</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00478">osd_it_quota::oiq_obj</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00319">osd_object::oo_db</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00884">osd_obj2dev()</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00049">osd_objset_user_iused()</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00269">osd_zap_cursor_retrieve_value()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00189">osd_thread_info::oti_za</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

</div>
</div>
<a class="anchor" id="a2ea6df6e8090fc753e38229333cdf986"></a><!-- doxytag: member="osd_quota.c::osd_it_acct_store" ref="a2ea6df6e8090fc753e38229333cdf986" args="(const struct lu_env *env, const struct dt_it *di)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> osd_it_acct_store </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct dt_it *&nbsp;</td>
          <td class="paramname"> <em>di</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns cookie for current Iterator position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>di</em>&nbsp;</td><td>- osd iterator </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00363">363</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00108">osd_it_quota::oiq_reset</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00105">osd_it_quota::oiq_zc</a>, <a class="el" href="osd__index_8c_source.html#l00098">osd_zap_cursor_serialize()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="a4ade1eaa153f285e5a976d887865aedf"></a><!-- doxytag: member="osd_quota.c::osd_objset_user_iused" ref="a4ade1eaa153f285e5a976d887865aedf" args="(struct osd_device *osd, uint64_t uidbytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t osd_objset_user_iused </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosd__device.html">osd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>osd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&nbsp;</td>
          <td class="paramname"> <em>uidbytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to estimate the number of inodes in use for a give uid/gid from the block usage. </p>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00049">49</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00260">osd_device::od_max_blksz</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00250">osd_device::od_os</a>, and <a class="el" href="osd-zfs_2osd__handler_8c_source.html#l00368">osd_objs_count_estimate()</a>.</p>

<p>Referenced by <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00088">osd_acct_index_lookup()</a>, and <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00308">osd_it_acct_rec()</a>.</p>

</div>
</div>
<a class="anchor" id="a52fef34f90b0782384e3d9081685cb54"></a><!-- doxytag: member="osd_quota.c::osd_quota_fid2dmu" ref="a52fef34f90b0782384e3d9081685cb54" args="(const struct lu_fid *fid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t osd_quota_fid2dmu </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__fid.html">lu_fid</a> *&nbsp;</td>
          <td class="paramname"> <em>fid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to retrieve DMU object id from fid for accounting object. </p>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00037">37</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="lustre__fid_8h_source.html#l00224">ACCT_GROUP_OID</a>, <a class="el" href="lustre__fid_8h_source.html#l00283">fid_is_acct()</a>, <a class="el" href="lustre__idl_8h_source.html#l00249">fid_oid()</a>, and <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>.</p>

<p>Referenced by <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00088">osd_acct_index_lookup()</a>, and <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00151">osd_it_acct_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a99c4c3437600946721b068de5b50b83b"></a><!-- doxytag: member="osd_quota.c::osd_zap_cursor_retrieve_value" ref="a99c4c3437600946721b068de5b50b83b" args="(const struct lu_env *env, zap_cursor_t *zc, char *buf, int buf_size, int *bytes_read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osd_zap_cursor_retrieve_value </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">zap_cursor_t *&nbsp;</td>
          <td class="paramname"> <em>zc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buf_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>bytes_read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00269">269</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>References <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="osd-ldiskfs_2osd__internal_8h_source.html#l00938">osd_oti_get()</a>, <a class="el" href="osd-zfs_2osd__internal_8h_source.html#l00189">osd_thread_info::oti_za</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00308">osd_it_acct_rec()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ae44c2ce6357b0f5ccb5abf0ef60d23ba"></a><!-- doxytag: member="osd_quota.c::osd_acct_index_ops" ref="ae44c2ce6357b0f5ccb5abf0ef60d23ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdt__index__operations.html">dt_index_operations</a> <a class="el" href="osd-zfs_2osd__quota_8c.html#ae44c2ce6357b0f5ccb5abf0ef60d23ba">osd_acct_index_ops</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
        .dio_lookup = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#abcfa7cac1bb24cd5dc754d4f10b8166a" title="Return space usage (blocks &amp;amp; inodes) consumed by a given uid or gid.">osd_acct_index_lookup</a>,
        .dio_it     = {
                .init           = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#af2a88602af15c39623023acf9e22ad82" title="Initialize osd Iterator for given osd index object.">osd_it_acct_init</a>,
                .fini           = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#ae81118705ec1495afcb4579a50ccdb26" title="Free given iterator.">osd_it_acct_fini</a>,
                .get            = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#aadb0023f23418507b702ad1a75b09d31" title="Move Iterator to record specified by key, if the key isn&amp;#39;t found, move to the...">osd_it_acct_get</a>,
                .put            = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#ad8fa0a75091ff5b37865165d003994f1" title="Release Iterator.">osd_it_acct_put</a>,
                .next           = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#a0b43e5b349726cbf44905ddd0f0228da" title="Move on to the next valid entry.">osd_it_acct_next</a>,
                .key            = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#a8f402ea7336497ab5ff04beda7653247" title="Return pointer to the key under iterator.">osd_it_acct_key</a>,
                .key_size       = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#a2aa578c373a121880800ef37fc1f96f0" title="Return size of key under iterator (in bytes).">osd_it_acct_key_size</a>,
                .rec            = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#a2184eb67ee89e15ec3eba22ba80758da" title="Return pointer to the record under iterator.">osd_it_acct_rec</a>,
                .store          = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#a2ea6df6e8090fc753e38229333cdf986" title="Returns cookie for current Iterator position.">osd_it_acct_store</a>,
                .load           = <a class="code" href="osd-ldiskfs_2osd__quota_8c.html#ab27f0094dfd99d2cd2a2b8f1abbf2369" title="Restore iterator from cookie.">osd_it_acct_load</a>
        }
}
</pre></div>
<p>Index and Iterator operations for accounting objects. </p>
<p>Quota/Accounting handling. </p>

<p>Definition at line <a class="el" href="osd-zfs_2osd__quota_8c_source.html#l00444">444</a> of file <a class="el" href="osd-zfs_2osd__quota_8c_source.html">osd_quota.c</a>.</p>

<p>Referenced by <a class="el" href="osd-ldiskfs_2osd__handler_8c_source.html#l03676">osd_index_try()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
