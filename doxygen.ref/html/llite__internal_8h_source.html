<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/llite/llite_internal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/llite/llite_internal.h</h1><a href="llite__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2003, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef LLITE_INTERNAL_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define LLITE_INTERNAL_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="lustre__debug_8h.html">lustre_debug.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="lustre__ver_8h.html">lustre_ver.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="lustre__disk_8h.html">lustre_disk.h</a>&gt;</span>  <span class="comment">/* for s2sbi */</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="lustre__eacl_8h.html">lustre_eacl.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="lustre__linkea_8h.html">lustre_linkea.h</a>&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">/* for struct cl_lock_descr and struct cl_io */</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="cl__object_8h.html">cl_object.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="lustre__lmv_8h.html">lustre_lmv.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="lustre__mdc_8h.html">lustre_mdc.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="lustre__intent_8h.html">lustre_intent.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;linux/compat.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;linux/aio.h&gt;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="vvp__internal_8h.html">vvp_internal.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="range__lock_8h.html">range_lock.h</a>&quot;</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#ifndef FMODE_EXEC</span>
<a name="l00057"></a><a class="code" href="llite__internal_8h.html#a2d1a84e39a0dca905e506a9d7b1762db">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define FMODE_EXEC 0</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="preprocessor">#ifndef VM_FAULT_RETRY</span>
<a name="l00061"></a><a class="code" href="llite__internal_8h.html#afce004fda583cc29c035d211adc95fc7">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define VM_FAULT_RETRY 0</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="comment">/* Kernel 3.1 kills LOOKUP_CONTINUE, LOOKUP_PARENT is equivalent to it.</span>
<a name="l00065"></a>00065 <span class="comment"> * seem kernel commit 49084c3bb2055c401f3493c13edae14d49128ca0 */</span>
<a name="l00066"></a>00066 <span class="preprocessor">#ifndef LOOKUP_CONTINUE</span>
<a name="l00067"></a><a class="code" href="llite__internal_8h.html#a8c50e18c0fa22ee4ae4b955c0a53e442">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define LOOKUP_CONTINUE LOOKUP_PARENT</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00071"></a><a class="code" href="llite__internal_8h.html#a6a3d8dda2e26d8284e6eec75dd386d44">00071</a> <span class="preprocessor">#define LL_DIR_END_OFF          0x7fffffffffffffffULL</span>
<a name="l00072"></a><a class="code" href="llite__internal_8h.html#ab0848a8e3f43988b51cf4e94126f09c4">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_DIR_END_OFF_32BIT    0x7fffffffUL</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 <span class="comment">/* 4UL * 1024 * 1024 */</span>
<a name="l00075"></a><a class="code" href="llite__internal_8h.html#adec2733519d878656bb727979b43d441">00075</a> <span class="preprocessor">#define LL_MAX_BLKSIZE_BITS 22</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="llite__internal_8h.html#afd65dd6f6497317885b1a36c3efa79cd">00077</a> <span class="preprocessor">#define LL_IT2STR(it) ((it) ? ldlm_it2str((it)-&gt;it_op) : &quot;0&quot;)</span>
<a name="l00078"></a><a class="code" href="llite__internal_8h.html#a1f9e295f76a7260a10bdacaa5345d7a3">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define LUSTRE_FPRIVATE(file) ((file)-&gt;private_data)</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>
<a name="l00080"></a><a class="code" href="structll__dentry__data.html">00080</a> <span class="keyword">struct </span><a class="code" href="structll__dentry__data.html">ll_dentry_data</a> {
<a name="l00081"></a><a class="code" href="structll__dentry__data.html#a6a467a06386115fe75f5712e268e61cd">00081</a>         <span class="keyword">struct </span><a class="code" href="structlookup__intent.html">lookup_intent</a>            *<a class="code" href="structll__dentry__data.html#a6a467a06386115fe75f5712e268e61cd">lld_it</a>;
<a name="l00082"></a><a class="code" href="structll__dentry__data.html#afb44554ffc4ed4dbde8a5a8785be3c57">00082</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                    <a class="code" href="structll__dentry__data.html#afb44554ffc4ed4dbde8a5a8785be3c57">lld_sa_generation</a>;
<a name="l00083"></a><a class="code" href="structll__dentry__data.html#a278fdcfd28592d7d5c4cd7146a8f7590">00083</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                    <a class="code" href="structll__dentry__data.html#a278fdcfd28592d7d5c4cd7146a8f7590">lld_invalid</a>:1;
<a name="l00084"></a><a class="code" href="structll__dentry__data.html#af79841fd27e6f7059f0a8c77a5a29f01">00084</a>         <span class="keyword">struct </span>rcu_head                 <a class="code" href="structll__dentry__data.html#af79841fd27e6f7059f0a8c77a5a29f01">lld_rcu_head</a>;
<a name="l00085"></a>00085 };
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">00087</a> <span class="preprocessor">#define ll_d2d(de) ((struct ll_dentry_data*)((de)-&gt;d_fsdata))</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="llite__internal_8h.html#af90d040c6ba96843eed2aab706cf1e9c">00089</a> <span class="preprocessor">#define LLI_INODE_MAGIC                 0x111d0de5</span>
<a name="l00090"></a><a class="code" href="llite__internal_8h.html#a7cf9c291a6bd6748d8be70f930c5ab89">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define LLI_INODE_DEAD                  0xdeadd00d</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>
<a name="l00092"></a>00092 <span class="comment">/* remote client permission cache */</span>
<a name="l00093"></a><a class="code" href="llite__internal_8h.html#a7597b0a67e5fe1441e239bdddef6671e">00093</a> <span class="preprocessor">#define REMOTE_PERM_HASHSIZE 16</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="structll__getname__data.html">00095</a> <span class="keyword">struct </span><a class="code" href="structll__getname__data.html">ll_getname_data</a> {
<a name="l00096"></a>00096 <span class="preprocessor">#ifdef HAVE_DIR_CONTEXT</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>        <span class="keyword">struct </span>dir_context      ctx;
<a name="l00098"></a>00098 <span class="preprocessor">#endif</span>
<a name="l00099"></a><a class="code" href="structll__getname__data.html#a4fa9b102704688053e1aa7592352ee8f">00099</a> <span class="preprocessor"></span>        <span class="keywordtype">char</span>            *<a class="code" href="structll__getname__data.html#a4fa9b102704688053e1aa7592352ee8f">lgd_name</a>;      <span class="comment">/* points to a buffer with NAME_MAX+1 size */</span>
<a name="l00100"></a><a class="code" href="structll__getname__data.html#a91ac27b9bb967a9a260e73b2c657efd3">00100</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>   <a class="code" href="structll__getname__data.html#a91ac27b9bb967a9a260e73b2c657efd3">lgd_fid</a>;        <span class="comment">/* target fid we are looking for */</span>
<a name="l00101"></a><a class="code" href="structll__getname__data.html#af1596f74f506c51cd79ea931fdbe6842">00101</a>         <span class="keywordtype">int</span>             <a class="code" href="structll__getname__data.html#af1596f74f506c51cd79ea931fdbe6842">lgd_found</a>;      <span class="comment">/* inode matched? */</span>
<a name="l00102"></a>00102 };
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/* llite setxid/access permission for user on remote client */</span>
<a name="l00105"></a><a class="code" href="structll__remote__perm.html">00105</a> <span class="keyword">struct </span><a class="code" href="structll__remote__perm.html">ll_remote_perm</a> {
<a name="l00106"></a><a class="code" href="structll__remote__perm.html#abaa95998e3a38602026dc987913dcae4">00106</a>         <span class="keyword">struct </span><a class="code" href="structhlist__node.html">hlist_node</a>       <a class="code" href="structll__remote__perm.html#abaa95998e3a38602026dc987913dcae4">lrp_list</a>;
<a name="l00107"></a><a class="code" href="structll__remote__perm.html#ab40125362879c6a536699506eeca7207">00107</a>         uid_t                   <a class="code" href="structll__remote__perm.html#ab40125362879c6a536699506eeca7207">lrp_uid</a>;
<a name="l00108"></a><a class="code" href="structll__remote__perm.html#a08528da440ce3628dae1f1a7c488f43f">00108</a>         gid_t                   <a class="code" href="structll__remote__perm.html#a08528da440ce3628dae1f1a7c488f43f">lrp_gid</a>;
<a name="l00109"></a><a class="code" href="structll__remote__perm.html#ad0a21d5cf51b72d46b1605d965acd3fd">00109</a>         uid_t                   <a class="code" href="structll__remote__perm.html#ad0a21d5cf51b72d46b1605d965acd3fd">lrp_fsuid</a>;
<a name="l00110"></a><a class="code" href="structll__remote__perm.html#afb97e39098625e131990c3529a24da6b">00110</a>         gid_t                   <a class="code" href="structll__remote__perm.html#afb97e39098625e131990c3529a24da6b">lrp_fsgid</a>;
<a name="l00111"></a><a class="code" href="structll__remote__perm.html#a43926234b47a0794a51f6bf27573126e">00111</a>         <span class="keywordtype">int</span>                     <a class="code" href="structll__remote__perm.html#a43926234b47a0794a51f6bf27573126e">lrp_access_perm</a>; <span class="comment">/* MAY_READ/WRITE/EXEC, this</span>
<a name="l00112"></a>00112 <span class="comment">                                                    is access permission with</span>
<a name="l00113"></a>00113 <span class="comment">                                                    lrp_fsuid/lrp_fsgid. */</span>
<a name="l00114"></a>00114 };
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="structll__grouplock.html">00116</a> <span class="keyword">struct </span><a class="code" href="structll__grouplock.html">ll_grouplock</a> {
<a name="l00117"></a><a class="code" href="structll__grouplock.html#a1d7b9c5fa0a9dbac39dc51734377a4a2">00117</a>         <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>   *<a class="code" href="structll__grouplock.html#a1d7b9c5fa0a9dbac39dc51734377a4a2">lg_env</a>;
<a name="l00118"></a><a class="code" href="structll__grouplock.html#ab0768c816d031107a4dbcf9d0e74c5ab">00118</a>         <span class="keyword">struct </span><a class="code" href="structcl__io.html" title="State for io.">cl_io</a>    *<a class="code" href="structll__grouplock.html#ab0768c816d031107a4dbcf9d0e74c5ab">lg_io</a>;
<a name="l00119"></a><a class="code" href="structll__grouplock.html#a896ec36fbb2162b2dec653d6f2ba9491">00119</a>         <span class="keyword">struct </span><a class="code" href="structcl__lock.html" title="Layered client lock.">cl_lock</a>  *<a class="code" href="structll__grouplock.html#a896ec36fbb2162b2dec653d6f2ba9491">lg_lock</a>;
<a name="l00120"></a><a class="code" href="structll__grouplock.html#a16c9c154f7c7c492806f0617094b92e7">00120</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>    <a class="code" href="structll__grouplock.html#a16c9c154f7c7c492806f0617094b92e7">lg_gid</a>;
<a name="l00121"></a>00121 };
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="structll__inode__info.html">00123</a> <span class="keyword">struct </span><a class="code" href="structll__inode__info.html">ll_inode_info</a> {
<a name="l00124"></a><a class="code" href="structll__inode__info.html#a2400b9d23e901deea03bacad45a66c3a">00124</a>         __u32                           <a class="code" href="structll__inode__info.html#a2400b9d23e901deea03bacad45a66c3a">lli_inode_magic</a>;
<a name="l00125"></a><a class="code" href="structll__inode__info.html#ab26120f711689aa58ad2392cfea5c86e">00125</a>         spinlock_t                      <a class="code" href="structll__inode__info.html#ab26120f711689aa58ad2392cfea5c86e">lli_lock</a>;
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">00127</a>         <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>          <a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">lli_flags</a>;
<a name="l00128"></a><a class="code" href="structll__inode__info.html#ac329730cb8ffface37db4f11f7232a55">00128</a>         <span class="keyword">struct </span>posix_acl                *<a class="code" href="structll__inode__info.html#ac329730cb8ffface37db4f11f7232a55">lli_posix_acl</a>;
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="structll__inode__info.html#ac35758fd0f40a45328a4101a7e3ae148">00130</a>         <span class="keyword">struct </span><a class="code" href="structhlist__head.html">hlist_head</a>               *<a class="code" href="structll__inode__info.html#ac35758fd0f40a45328a4101a7e3ae148">lli_remote_perms</a>;
<a name="l00131"></a><a class="code" href="structll__inode__info.html#ad873cc7aff76634b35d4ae7c1235a396">00131</a>         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#ad873cc7aff76634b35d4ae7c1235a396">lli_rmtperm_mutex</a>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="comment">/* identifying fields for both metadata and data stacks. */</span>
<a name="l00134"></a><a class="code" href="structll__inode__info.html#aef478f050fe920050e3eb6dc483ac4d0">00134</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>                   <a class="code" href="structll__inode__info.html#aef478f050fe920050e3eb6dc483ac4d0">lli_fid</a>;
<a name="l00135"></a>00135         <span class="comment">/* master inode fid for stripe directory */</span>
<a name="l00136"></a><a class="code" href="structll__inode__info.html#a2aa37aace3e68e929ce63c3e4d687c41">00136</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>                   <a class="code" href="structll__inode__info.html#a2aa37aace3e68e929ce63c3e4d687c41">lli_pfid</a>;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="comment">/* open count currently used by capability only, indicate whether</span>
<a name="l00139"></a>00139 <span class="comment">         * capability needs renewal */</span>
<a name="l00140"></a><a class="code" href="structll__inode__info.html#aab37de44bea8833d4c7a4f314b915de6">00140</a>         atomic_t                        <a class="code" href="structll__inode__info.html#aab37de44bea8833d4c7a4f314b915de6">lli_open_count</a>;
<a name="l00141"></a><a class="code" href="structll__inode__info.html#a14ce09c412f531a00045dd9ce0a04e51">00141</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>                      <a class="code" href="structll__inode__info.html#a14ce09c412f531a00045dd9ce0a04e51">lli_rmtperm_time</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <span class="comment">/* We need all three because every inode may be opened in different</span>
<a name="l00144"></a>00144 <span class="comment">         * modes */</span>
<a name="l00145"></a><a class="code" href="structll__inode__info.html#a0bcbe8457e6b4e16cbcd25e0e062c0ca">00145</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a>       *<a class="code" href="structll__inode__info.html#a0bcbe8457e6b4e16cbcd25e0e062c0ca">lli_mds_read_och</a>;
<a name="l00146"></a><a class="code" href="structll__inode__info.html#a4c5c6b0a5c954c1c9053a4f2e05581c4">00146</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a>       *<a class="code" href="structll__inode__info.html#a4c5c6b0a5c954c1c9053a4f2e05581c4">lli_mds_write_och</a>;
<a name="l00147"></a><a class="code" href="structll__inode__info.html#a50d44c164421c62fda2a51951c999860">00147</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a>       *<a class="code" href="structll__inode__info.html#a50d44c164421c62fda2a51951c999860">lli_mds_exec_och</a>;
<a name="l00148"></a><a class="code" href="structll__inode__info.html#a1d0538b31593fbf05d97aade3ae36316">00148</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                           <a class="code" href="structll__inode__info.html#a1d0538b31593fbf05d97aade3ae36316">lli_open_fd_read_count</a>;
<a name="l00149"></a><a class="code" href="structll__inode__info.html#a2c576b3b69960b2d501d18793311ff26">00149</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                           <a class="code" href="structll__inode__info.html#a2c576b3b69960b2d501d18793311ff26">lli_open_fd_write_count</a>;
<a name="l00150"></a><a class="code" href="structll__inode__info.html#a2c1139ea76cf0c9e3dd18422d4c84b7a">00150</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                           <a class="code" href="structll__inode__info.html#a2c1139ea76cf0c9e3dd18422d4c84b7a">lli_open_fd_exec_count</a>;
<a name="l00151"></a>00151         <span class="comment">/* Protects access to och pointers and their usage counters */</span>
<a name="l00152"></a><a class="code" href="structll__inode__info.html#ae31e82df811d95bd4d667495a52d06ae">00152</a>         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#ae31e82df811d95bd4d667495a52d06ae">lli_och_mutex</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="structll__inode__info.html#a392ab1dfe4b74a5e3ad4d6b706739eb1">00154</a>         <span class="keyword">struct </span>inode                    <a class="code" href="structll__inode__info.html#a392ab1dfe4b74a5e3ad4d6b706739eb1">lli_vfs_inode</a>;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="comment">/* the most recent timestamps obtained from mds */</span>
<a name="l00157"></a><a class="code" href="structll__inode__info.html#a83ad0f68272ad9900e3785704c9d7250">00157</a>         s64                             <a class="code" href="structll__inode__info.html#a83ad0f68272ad9900e3785704c9d7250">lli_atime</a>;
<a name="l00158"></a><a class="code" href="structll__inode__info.html#a3b8cdb4d534a616e06e9e15789b8a0dc">00158</a>         s64                             <a class="code" href="structll__inode__info.html#a3b8cdb4d534a616e06e9e15789b8a0dc">lli_mtime</a>;
<a name="l00159"></a><a class="code" href="structll__inode__info.html#a4d4322aa44d3adfa33c4346be39132e9">00159</a>         s64                             <a class="code" href="structll__inode__info.html#a4d4322aa44d3adfa33c4346be39132e9">lli_ctime</a>;
<a name="l00160"></a><a class="code" href="structll__inode__info.html#aeda2c647901ddcc73e6419155d932ed2">00160</a>         spinlock_t                      <a class="code" href="structll__inode__info.html#aeda2c647901ddcc73e6419155d932ed2">lli_agl_lock</a>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <span class="comment">/* Try to make the d::member and f::member are aligned. Before using</span>
<a name="l00163"></a>00163 <span class="comment">         * these members, make clear whether it is directory or not. */</span>
<a name="l00164"></a>00164         <span class="keyword">union </span>{
<a name="l00165"></a>00165                 <span class="comment">/* for directory */</span>
<a name="l00166"></a>00166                 <span class="keyword">struct </span>{
<a name="l00167"></a>00167                         <span class="comment">/* serialize normal readdir and statahead-readdir. */</span>
<a name="l00168"></a><a class="code" href="structll__inode__info.html#ad1b497c81812d46d87fbf00d07d2db1a">00168</a>                         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#ad1b497c81812d46d87fbf00d07d2db1a">lli_readdir_mutex</a>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170                         <span class="comment">/* metadata statahead */</span>
<a name="l00171"></a>00171                         <span class="comment">/* since parent-child threads can share the same @file</span>
<a name="l00172"></a>00172 <span class="comment">                         * struct, &quot;opendir_key&quot; is the token when dir close for</span>
<a name="l00173"></a>00173 <span class="comment">                         * case of parent exit before child -- it is me should</span>
<a name="l00174"></a>00174 <span class="comment">                         * cleanup the dir readahead. */</span>
<a name="l00175"></a><a class="code" href="structll__inode__info.html#a621c368f7b173c4e0d7f5d3ca2d25bd5">00175</a>                         <span class="keywordtype">void</span>                           *<a class="code" href="structll__inode__info.html#a621c368f7b173c4e0d7f5d3ca2d25bd5">lli_opendir_key</a>;
<a name="l00176"></a><a class="code" href="structll__inode__info.html#a122df9b8baf81c806dd794deda210cbe">00176</a>                         <span class="keyword">struct </span><a class="code" href="structll__statahead__info.html">ll_statahead_info</a>       *<a class="code" href="structll__inode__info.html#a122df9b8baf81c806dd794deda210cbe">lli_sai</a>;
<a name="l00177"></a>00177                         <span class="comment">/* protect statahead stuff. */</span>
<a name="l00178"></a><a class="code" href="structll__inode__info.html#ab3abe8f92696364280d5c1e033709fb5">00178</a>                         spinlock_t                      <a class="code" href="structll__inode__info.html#ab3abe8f92696364280d5c1e033709fb5">lli_sa_lock</a>;
<a name="l00179"></a>00179                         <span class="comment">/* &quot;opendir_pid&quot; is the token when lookup/revalid</span>
<a name="l00180"></a>00180 <span class="comment">                         * -- I am the owner of dir statahead. */</span>
<a name="l00181"></a><a class="code" href="structll__inode__info.html#afe34fc379bdc834cb4e183690dcb7fa8">00181</a>                         pid_t                           <a class="code" href="structll__inode__info.html#afe34fc379bdc834cb4e183690dcb7fa8">lli_opendir_pid</a>;
<a name="l00182"></a>00182                         <span class="comment">/* stat will try to access statahead entries or start</span>
<a name="l00183"></a>00183 <span class="comment">                         * statahead if this flag is set, and this flag will be</span>
<a name="l00184"></a>00184 <span class="comment">                         * set upon dir open, and cleared when dir is closed,</span>
<a name="l00185"></a>00185 <span class="comment">                         * statahead hit ratio is too low, or start statahead</span>
<a name="l00186"></a>00186 <span class="comment">                         * thread failed. */</span>
<a name="l00187"></a><a class="code" href="structll__inode__info.html#af8a5e03d50d04de28a5dbccb5ab461f8">00187</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                    <a class="code" href="structll__inode__info.html#af8a5e03d50d04de28a5dbccb5ab461f8">lli_sa_enabled</a>:1;
<a name="l00188"></a>00188                         <span class="comment">/* generation for statahead */</span>
<a name="l00189"></a><a class="code" href="structll__inode__info.html#a8f1bf8ff20a08970a34060c48090d1c6">00189</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                    <a class="code" href="structll__inode__info.html#a8f1bf8ff20a08970a34060c48090d1c6">lli_sa_generation</a>;
<a name="l00190"></a>00190                         <span class="comment">/* directory stripe information */</span>
<a name="l00191"></a><a class="code" href="structll__inode__info.html#ac5675b18a23c3bd16d3eec10c178058c">00191</a>                         <span class="keyword">struct </span><a class="code" href="structlmv__stripe__md.html">lmv_stripe_md</a>            *<a class="code" href="structll__inode__info.html#ac5675b18a23c3bd16d3eec10c178058c">lli_lsm_md</a>;
<a name="l00192"></a>00192                         <span class="comment">/* default directory stripe offset.  This is extracted</span>
<a name="l00193"></a>00193 <span class="comment">                         * from the &quot;dmv&quot; xattr in order to decide which MDT to</span>
<a name="l00194"></a>00194 <span class="comment">                         * create a subdirectory on.  The MDS itself fetches</span>
<a name="l00195"></a>00195 <span class="comment">                         * &quot;dmv&quot; and gets the rest of the default layout itself</span>
<a name="l00196"></a>00196 <span class="comment">                         * (count, hash, etc). */</span>
<a name="l00197"></a><a class="code" href="structll__inode__info.html#aa7ab71a536f99b85591b5310c654621f">00197</a>                         __u32                           <a class="code" href="structll__inode__info.html#aa7ab71a536f99b85591b5310c654621f">lli_def_stripe_offset</a>;
<a name="l00198"></a>00198                 };
<a name="l00199"></a>00199 
<a name="l00200"></a>00200                 <span class="comment">/* for non-directory */</span>
<a name="l00201"></a>00201                 <span class="keyword">struct </span>{
<a name="l00202"></a><a class="code" href="structll__inode__info.html#a44820ad8a3b61393fa0fcf4df8b038d8">00202</a>                         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#a44820ad8a3b61393fa0fcf4df8b038d8">lli_size_mutex</a>;
<a name="l00203"></a><a class="code" href="structll__inode__info.html#a1977d9ce2d44226ed16034d8486bc9d5">00203</a>                         <span class="keywordtype">char</span>                           *<a class="code" href="structll__inode__info.html#a1977d9ce2d44226ed16034d8486bc9d5">lli_symlink_name</a>;
<a name="l00204"></a>00204                         <span class="comment">/*</span>
<a name="l00205"></a>00205 <span class="comment">                         * struct rw_semaphore {</span>
<a name="l00206"></a>00206 <span class="comment">                         *    signed long       count;     // align d.d_def_acl</span>
<a name="l00207"></a>00207 <span class="comment">                         *    spinlock_t        wait_lock; // align d.d_sa_lock</span>
<a name="l00208"></a>00208 <span class="comment">                         *    struct list_head wait_list;</span>
<a name="l00209"></a>00209 <span class="comment">                         * }</span>
<a name="l00210"></a>00210 <span class="comment">                         */</span>
<a name="l00211"></a><a class="code" href="structll__inode__info.html#a09e6e02ebbfe892586f1d806d05edb4c">00211</a>                         <span class="keyword">struct </span>rw_semaphore             <a class="code" href="structll__inode__info.html#a09e6e02ebbfe892586f1d806d05edb4c">lli_trunc_sem</a>;
<a name="l00212"></a><a class="code" href="structll__inode__info.html#a057479c4e62ba6d51358db0dc96fffd7">00212</a>                         <span class="keyword">struct </span><a class="code" href="structrange__lock__tree.html">range_lock_tree</a>          <a class="code" href="structll__inode__info.html#a057479c4e62ba6d51358db0dc96fffd7">lli_write_tree</a>;
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="structll__inode__info.html#a0b71405fdf752fa586f8cd68d4b6e981">00214</a>                         <span class="keyword">struct </span>rw_semaphore             <a class="code" href="structll__inode__info.html#a0b71405fdf752fa586f8cd68d4b6e981">lli_glimpse_sem</a>;
<a name="l00215"></a><a class="code" href="structll__inode__info.html#ab59a121494126f64ce246c005f99ba1e">00215</a>                         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>                      <a class="code" href="structll__inode__info.html#ab59a121494126f64ce246c005f99ba1e">lli_glimpse_time</a>;
<a name="l00216"></a><a class="code" href="structll__inode__info.html#a3d11619720c0cc9a22f69d30d6d98daa">00216</a>                         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structll__inode__info.html#a3d11619720c0cc9a22f69d30d6d98daa">lli_agl_list</a>;
<a name="l00217"></a><a class="code" href="structll__inode__info.html#a0d0d1e7e09d5429e18129cc3fbb685e3">00217</a>                         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                           <a class="code" href="structll__inode__info.html#a0d0d1e7e09d5429e18129cc3fbb685e3">lli_agl_index</a>;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219                         <span class="comment">/* for writepage() only to communicate to fsync */</span>
<a name="l00220"></a><a class="code" href="structll__inode__info.html#ad55f3e2713a42cb7e1a33c449ad70f02">00220</a>                         <span class="keywordtype">int</span>                             <a class="code" href="structll__inode__info.html#ad55f3e2713a42cb7e1a33c449ad70f02">lli_async_rc</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222                         <span class="comment">/*</span>
<a name="l00223"></a>00223 <span class="comment">                         * whenever a process try to read/write the file, the</span>
<a name="l00224"></a>00224 <span class="comment">                         * jobid of the process will be saved here, and it&apos;ll</span>
<a name="l00225"></a>00225 <span class="comment">                         * be packed into the write PRC when flush later.</span>
<a name="l00226"></a>00226 <span class="comment">                         *</span>
<a name="l00227"></a>00227 <span class="comment">                         * so the read/write statistics for jobid will not be</span>
<a name="l00228"></a>00228 <span class="comment">                         * accurate if the file is shared by different jobs.</span>
<a name="l00229"></a>00229 <span class="comment">                         */</span>
<a name="l00230"></a><a class="code" href="structll__inode__info.html#a616d9cff12d932b257332eefdc4b571d">00230</a>                         <span class="keywordtype">char</span>                    <a class="code" href="structll__inode__info.html#a616d9cff12d932b257332eefdc4b571d">lli_jobid</a>[<a class="code" href="group__lustreuser.html#ga0c0d05b1c505aa119e08771fbc1f0f72">LUSTRE_JOBID_SIZE</a>];
<a name="l00231"></a>00231                 };
<a name="l00232"></a>00232         };
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="comment">/* XXX: For following frequent used members, although they maybe special</span>
<a name="l00235"></a>00235 <span class="comment">         *      used for non-directory object, it is some time-wasting to check</span>
<a name="l00236"></a>00236 <span class="comment">         *      whether the object is directory or not before using them. On the</span>
<a name="l00237"></a>00237 <span class="comment">         *      other hand, currently, sizeof(f) &gt; sizeof(d), it cannot reduce</span>
<a name="l00238"></a>00238 <span class="comment">         *      the &quot;ll_inode_info&quot; size even if moving those members into u.f.</span>
<a name="l00239"></a>00239 <span class="comment">         *      So keep them out side.</span>
<a name="l00240"></a>00240 <span class="comment">         *</span>
<a name="l00241"></a>00241 <span class="comment">         *      In the future, if more members are added only for directory,</span>
<a name="l00242"></a>00242 <span class="comment">         *      some of the following members can be moved into u.f.</span>
<a name="l00243"></a>00243 <span class="comment">         */</span>
<a name="l00244"></a><a class="code" href="structll__inode__info.html#a1c6f23ae28245bc9a587dd4a1806aeda">00244</a>         <span class="keyword">struct </span><a class="code" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a>                *<a class="code" href="structll__inode__info.html#a1c6f23ae28245bc9a587dd4a1806aeda">lli_clob</a>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="comment">/* mutex to request for layout lock exclusively. */</span>
<a name="l00247"></a><a class="code" href="structll__inode__info.html#a0db4bd870e005c45e9dab74d7ff6d237">00247</a>         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#a0db4bd870e005c45e9dab74d7ff6d237">lli_layout_mutex</a>;
<a name="l00248"></a>00248         <span class="comment">/* Layout version, protected by lli_layout_lock */</span>
<a name="l00249"></a><a class="code" href="structll__inode__info.html#a8aa1ab28e115ddc035e96310d24021c6">00249</a>         __u32                           <a class="code" href="structll__inode__info.html#a8aa1ab28e115ddc035e96310d24021c6">lli_layout_gen</a>;
<a name="l00250"></a><a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">00250</a>         spinlock_t                      <a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">lli_layout_lock</a>;
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="structll__inode__info.html#a618e1ec842b926f50d4e32bb5511a3aa">00252</a>         <span class="keyword">struct </span>rw_semaphore             <a class="code" href="structll__inode__info.html#a618e1ec842b926f50d4e32bb5511a3aa">lli_xattrs_list_rwsem</a>;
<a name="l00253"></a><a class="code" href="structll__inode__info.html#a2fcee6176a48a18a0068939d688eb5f8">00253</a>         <span class="keyword">struct </span>mutex                    <a class="code" href="structll__inode__info.html#a2fcee6176a48a18a0068939d688eb5f8">lli_xattrs_enq_lock</a>;
<a name="l00254"></a><a class="code" href="structll__inode__info.html#a6d477965836d8bad52a916997c5119c3">00254</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structll__inode__info.html#a6d477965836d8bad52a916997c5119c3">lli_xattrs</a>; <span class="comment">/* ll_xattr_entry-&gt;xe_list */</span>
<a name="l00255"></a>00255 };
<a name="l00256"></a>00256 
<a name="l00257"></a><a class="code" href="llite__internal_8h.html#a48055559021fb6438ac1bc9eee2f1c80">00257</a> <span class="keyword">static</span> <span class="keyword">inline</span> __u32 <a class="code" href="llite__internal_8h.html#a48055559021fb6438ac1bc9eee2f1c80">ll_layout_version_get</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli)
<a name="l00258"></a>00258 {
<a name="l00259"></a>00259         __u32 gen;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         spin_lock(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">lli_layout_lock</a>);
<a name="l00262"></a>00262         gen = lli-&gt;<a class="code" href="structll__inode__info.html#a8aa1ab28e115ddc035e96310d24021c6">lli_layout_gen</a>;
<a name="l00263"></a>00263         spin_unlock(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">lli_layout_lock</a>);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">return</span> gen;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="llite__internal_8h.html#abc2f8523a15ec20149b6f8f5851fcc3d">00268</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#abc2f8523a15ec20149b6f8f5851fcc3d">ll_layout_version_set</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli, __u32 gen)
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270         spin_lock(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">lli_layout_lock</a>);
<a name="l00271"></a>00271         lli-&gt;<a class="code" href="structll__inode__info.html#a8aa1ab28e115ddc035e96310d24021c6">lli_layout_gen</a> = gen;
<a name="l00272"></a>00272         spin_unlock(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#ab4cd2f15b236316b37c05aa4b1b5f611">lli_layout_lock</a>);
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">00275</a> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">ll_file_flags</a> {
<a name="l00276"></a>00276         <span class="comment">/* File data is modified. */</span>
<a name="l00277"></a><a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598acf48748a8bd919cc6f0c5eb36337c6f5">00277</a>         <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598acf48748a8bd919cc6f0c5eb36337c6f5">LLIF_DATA_MODIFIED</a>      = 0,
<a name="l00278"></a>00278         <span class="comment">/* File is being restored */</span>
<a name="l00279"></a><a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598a4fb84e84facab6ff43c438a7d89a950f">00279</a>         <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598a4fb84e84facab6ff43c438a7d89a950f">LLIF_FILE_RESTORING</a>     = 1,
<a name="l00280"></a>00280         <span class="comment">/* Xattr cache is attached to the file */</span>
<a name="l00281"></a><a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598acbc6b66810d64cbb886bccf9e3982591">00281</a>         <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598acbc6b66810d64cbb886bccf9e3982591">LLIF_XATTR_CACHE</a>        = 2,
<a name="l00282"></a>00282 };
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="llite__internal_8h.html#afb097a3705c4096995777fc51149518b">00284</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#afb097a3705c4096995777fc51149518b">ll_file_set_flag</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli,
<a name="l00285"></a>00285                                     <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">ll_file_flags</a> flag)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287         set_bit(flag, &amp;lli-&gt;<a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">lli_flags</a>);
<a name="l00288"></a>00288 }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="llite__internal_8h.html#af5f86c202cbdebf5e1912eb036a0353a">00290</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#af5f86c202cbdebf5e1912eb036a0353a">ll_file_clear_flag</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli,
<a name="l00291"></a>00291                                       <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">ll_file_flags</a> flag)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293         clear_bit(flag, &amp;lli-&gt;<a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">lli_flags</a>);
<a name="l00294"></a>00294 }
<a name="l00295"></a>00295 
<a name="l00296"></a><a class="code" href="llite__internal_8h.html#a35f7748e3e39f66365a83a93cfd2b1dd">00296</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="llite__internal_8h.html#a35f7748e3e39f66365a83a93cfd2b1dd">ll_file_test_flag</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli,
<a name="l00297"></a>00297                                      <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">ll_file_flags</a> flag)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299         <span class="keywordflow">return</span> test_bit(flag, &amp;lli-&gt;<a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">lli_flags</a>);
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a><a class="code" href="llite__internal_8h.html#a4dbbfffbb24fd0611a1baadd92ed587d">00302</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="llite__internal_8h.html#a4dbbfffbb24fd0611a1baadd92ed587d">ll_file_test_and_clear_flag</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli,
<a name="l00303"></a>00303                                                <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aaf0d8ccf4e5b88ade37ea6ccaa027598">ll_file_flags</a> flag)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305         <span class="keywordflow">return</span> test_and_clear_bit(flag, &amp;lli-&gt;<a class="code" href="structll__inode__info.html#afbc2718544383168e245caeebbb66759">lli_flags</a>);
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a6218ad7ef04b817916859fcaa933a521">ll_xattr_cache_destroy</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ace26221d59e2ce4bc476c563a704efcb">ll_xattr_cache_get</a>(<span class="keyword">struct</span> inode *inode,
<a name="l00311"></a>00311                         <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l00312"></a>00312                         <span class="keywordtype">char</span> *buffer,
<a name="l00313"></a>00313                         <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>,
<a name="l00314"></a>00314                         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> valid);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a546428ef95d7654e8d802e51674bdf19">ll_init_security</a>(<span class="keyword">struct</span> dentry *dentry,
<a name="l00317"></a>00317                             <span class="keyword">struct</span> inode *inode,
<a name="l00318"></a>00318                             <span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="comment">/*</span>
<a name="l00321"></a>00321 <span class="comment"> * Locking to guarantee consistency of non-atomic updates to long long i_size,</span>
<a name="l00322"></a>00322 <span class="comment"> * consistency between file size and KMS.</span>
<a name="l00323"></a>00323 <span class="comment"> *</span>
<a name="l00324"></a>00324 <span class="comment"> * Implemented by -&gt;lli_size_mutex and -&gt;lsm_lock, nested in that order.</span>
<a name="l00325"></a>00325 <span class="comment"> */</span>
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#abd9a2a4733d2a18d3bee3f2e7ec4cf0f">ll_inode_size_lock</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00328"></a>00328 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ad0cf559e21155fa6fbe751e55394ab41">ll_inode_size_unlock</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">// FIXME: replace the name of this with LL_I to conform to kernel stuff</span>
<a name="l00331"></a>00331 <span class="comment">// static inline struct ll_inode_info *LL_I(struct inode *inode)</span>
<a name="l00332"></a><a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">00332</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structll__inode__info.html">ll_inode_info</a> *<a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">ll_i2info</a>(<span class="keyword">struct</span> inode *inode)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334         <span class="keywordflow">return</span> container_of(inode, <span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a>, <a class="code" href="structll__inode__info.html#a392ab1dfe4b74a5e3ad4d6b706739eb1">lli_vfs_inode</a>);
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="comment">/* default to about 64M of readahead on a given system. */</span>
<a name="l00338"></a><a class="code" href="llite__internal_8h.html#a3b838020699de2e8c89d67875dc8606a">00338</a> <span class="preprocessor">#define SBI_DEFAULT_READAHEAD_MAX       (64UL &lt;&lt; (20 - PAGE_CACHE_SHIFT))</span>
<a name="l00339"></a>00339 <span class="preprocessor"></span>
<a name="l00340"></a>00340 <span class="comment">/* default to read-ahead full files smaller than 2MB on the second read */</span>
<a name="l00341"></a><a class="code" href="llite__internal_8h.html#ac10f274bbde249096bed70e1433a649c">00341</a> <span class="preprocessor">#define SBI_DEFAULT_READAHEAD_WHOLE_MAX (2UL &lt;&lt; (20 - PAGE_CACHE_SHIFT))</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>
<a name="l00343"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707">00343</a> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707">ra_stat</a> {
<a name="l00344"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aabc8dd5fd052b9f7527529f0be29b093">00344</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aabc8dd5fd052b9f7527529f0be29b093">RA_STAT_HIT</a> = 0,
<a name="l00345"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a6bde7259be6cbb6f8ddb1adb0984832a">00345</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a6bde7259be6cbb6f8ddb1adb0984832a">RA_STAT_MISS</a>,
<a name="l00346"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a61174321a8b783fdcfeead7e6f0e01dc">00346</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a61174321a8b783fdcfeead7e6f0e01dc">RA_STAT_DISTANT_READPAGE</a>,
<a name="l00347"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a510f4a2dc82402ec39475ef0067336ab">00347</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a510f4a2dc82402ec39475ef0067336ab">RA_STAT_MISS_IN_WINDOW</a>,
<a name="l00348"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a5bae15a28ecdde557d48d7376639ef76">00348</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a5bae15a28ecdde557d48d7376639ef76">RA_STAT_FAILED_GRAB_PAGE</a>,
<a name="l00349"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a0bfcceab0a41cbb9e3e910bdafb2af8a">00349</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a0bfcceab0a41cbb9e3e910bdafb2af8a">RA_STAT_FAILED_MATCH</a>,
<a name="l00350"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aa17079a09c0b3853cd807a9e765d938e">00350</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aa17079a09c0b3853cd807a9e765d938e">RA_STAT_DISCARDED</a>,
<a name="l00351"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707afb38dadd9d1414a8a96f00ab62e02c9c">00351</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707afb38dadd9d1414a8a96f00ab62e02c9c">RA_STAT_ZERO_LEN</a>,
<a name="l00352"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a55caa06082a996562a70b24ce6b1cfa2">00352</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a55caa06082a996562a70b24ce6b1cfa2">RA_STAT_ZERO_WINDOW</a>,
<a name="l00353"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a5e4ca0f6e47ec04ac5b6249822ae860c">00353</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a5e4ca0f6e47ec04ac5b6249822ae860c">RA_STAT_EOF</a>,
<a name="l00354"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aa288684f3d332f1f62e6a97069eb269f">00354</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aa288684f3d332f1f62e6a97069eb269f">RA_STAT_MAX_IN_FLIGHT</a>,
<a name="l00355"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a9870dc6da0fd3716b09cf5b1914bbead">00355</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a9870dc6da0fd3716b09cf5b1914bbead">RA_STAT_WRONG_GRAB_PAGE</a>,
<a name="l00356"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a40d79b4d3e045816038988b6742b1c9d">00356</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707a40d79b4d3e045816038988b6742b1c9d">RA_STAT_FAILED_REACH_END</a>,
<a name="l00357"></a><a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aee05b3be5fc92743d8fc7518482c34ea">00357</a>         <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707aee05b3be5fc92743d8fc7518482c34ea">_NR_RA_STAT</a>,
<a name="l00358"></a>00358 };
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="structll__ra__info.html">00360</a> <span class="keyword">struct </span><a class="code" href="structll__ra__info.html">ll_ra_info</a> {
<a name="l00361"></a><a class="code" href="structll__ra__info.html#ae4b6bddde37b70f2ea90bc2b6c0e18f0">00361</a>         atomic_t        <a class="code" href="structll__ra__info.html#ae4b6bddde37b70f2ea90bc2b6c0e18f0">ra_cur_pages</a>;
<a name="l00362"></a><a class="code" href="structll__ra__info.html#a85334f21cbee80e73a47f411fa894db6">00362</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__ra__info.html#a85334f21cbee80e73a47f411fa894db6">ra_max_pages</a>;
<a name="l00363"></a><a class="code" href="structll__ra__info.html#a0a41d9bc6192616d5137589a468eac38">00363</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__ra__info.html#a0a41d9bc6192616d5137589a468eac38">ra_max_pages_per_file</a>;
<a name="l00364"></a><a class="code" href="structll__ra__info.html#a189876f037d41812689afd05e4ef4b12">00364</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__ra__info.html#a189876f037d41812689afd05e4ef4b12">ra_max_read_ahead_whole_pages</a>;
<a name="l00365"></a>00365 };
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">/* ra_io_arg will be filled in the beginning of ll_readahead with</span>
<a name="l00368"></a>00368 <span class="comment"> * ras_lock, then the following ll_read_ahead_pages will read RA</span>
<a name="l00369"></a>00369 <span class="comment"> * pages according to this arg, all the items in this structure are</span>
<a name="l00370"></a>00370 <span class="comment"> * counted by page index.</span>
<a name="l00371"></a>00371 <span class="comment"> */</span>
<a name="l00372"></a><a class="code" href="structra__io__arg.html">00372</a> <span class="keyword">struct </span><a class="code" href="structra__io__arg.html">ra_io_arg</a> {
<a name="l00373"></a><a class="code" href="structra__io__arg.html#a678282fb469e8a999ac4bea59ff3e7ec">00373</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#a678282fb469e8a999ac4bea59ff3e7ec">ria_start</a>;  <span class="comment">/* start offset of read-ahead*/</span>
<a name="l00374"></a><a class="code" href="structra__io__arg.html#abb4ac74e752dd1bfb8db8af13e3ffffa">00374</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#abb4ac74e752dd1bfb8db8af13e3ffffa">ria_end</a>;    <span class="comment">/* end offset of read-ahead*/</span>
<a name="l00375"></a><a class="code" href="structra__io__arg.html#ab6a255ae9b21057c02297be18e2c1e6e">00375</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#ab6a255ae9b21057c02297be18e2c1e6e">ria_reserved</a>; <span class="comment">/* reserved pages for read-ahead */</span>
<a name="l00376"></a><a class="code" href="structra__io__arg.html#a97f4b29afa1c083ca133bb705df717d5">00376</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#a97f4b29afa1c083ca133bb705df717d5">ria_end_min</a>;  <span class="comment">/* minimum end to cover current read */</span>
<a name="l00377"></a><a class="code" href="structra__io__arg.html#a39f772508b4382a7283ed33bfb49893b">00377</a>         <span class="keywordtype">bool</span>          <a class="code" href="structra__io__arg.html#a39f772508b4382a7283ed33bfb49893b">ria_eof</a>;    <span class="comment">/* reach end of file */</span>
<a name="l00378"></a>00378         <span class="comment">/* If stride read pattern is detected, ria_stoff means where</span>
<a name="l00379"></a>00379 <span class="comment">         * stride read is started. Note: for normal read-ahead, the</span>
<a name="l00380"></a>00380 <span class="comment">         * value here is meaningless, and also it will not be accessed*/</span>
<a name="l00381"></a><a class="code" href="structra__io__arg.html#ae9317e39a5e9f2e7188496fe51fecf44">00381</a>         pgoff_t <a class="code" href="structra__io__arg.html#ae9317e39a5e9f2e7188496fe51fecf44">ria_stoff</a>;
<a name="l00382"></a>00382         <span class="comment">/* ria_length and ria_pages are the length and pages length in the</span>
<a name="l00383"></a>00383 <span class="comment">         * stride I/O mode. And they will also be used to check whether</span>
<a name="l00384"></a>00384 <span class="comment">         * it is stride I/O read-ahead in the read-ahead pages*/</span>
<a name="l00385"></a><a class="code" href="structra__io__arg.html#a9b45dbcf8895ef469127f42da11c333c">00385</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#a9b45dbcf8895ef469127f42da11c333c">ria_length</a>;
<a name="l00386"></a><a class="code" href="structra__io__arg.html#abf1c3993d8ba0c585b487ae690f4af8e">00386</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structra__io__arg.html#abf1c3993d8ba0c585b487ae690f4af8e">ria_pages</a>;
<a name="l00387"></a>00387 };
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/* LL_HIST_MAX=32 causes an overflow */</span>
<a name="l00390"></a><a class="code" href="llite__internal_8h.html#ae922aa1f00aff3dd39a40f356576234b">00390</a> <span class="preprocessor">#define LL_HIST_MAX 28</span>
<a name="l00391"></a><a class="code" href="llite__internal_8h.html#abd7eefb60d15c07e23791e3ad56f9663">00391</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_HIST_START 12 </span><span class="comment">/* buckets start at 2^12 = 4k */</span>
<a name="l00392"></a><a class="code" href="llite__internal_8h.html#abc98e4b426d366fbc6eff54f67debecf">00392</a> <span class="preprocessor">#define LL_PROCESS_HIST_MAX 10</span>
<a name="l00393"></a><a class="code" href="structper__process__info.html">00393</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structper__process__info.html">per_process_info</a> {
<a name="l00394"></a><a class="code" href="structper__process__info.html#ae1f9869f1482fab144b34eef12d7d1a4">00394</a>         pid_t <a class="code" href="structper__process__info.html#ae1f9869f1482fab144b34eef12d7d1a4">pid</a>;
<a name="l00395"></a><a class="code" href="structper__process__info.html#a4e092cf0c29edad9f2836ff76ff9a320">00395</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a> <a class="code" href="structper__process__info.html#a4e092cf0c29edad9f2836ff76ff9a320">pp_r_hist</a>;
<a name="l00396"></a><a class="code" href="structper__process__info.html#a9ffa05ea1f0f75fa4a1054f444757e98">00396</a>         <span class="keyword">struct </span><a class="code" href="structobd__histogram.html">obd_histogram</a> <a class="code" href="structper__process__info.html#a9ffa05ea1f0f75fa4a1054f444757e98">pp_w_hist</a>;
<a name="l00397"></a>00397 };
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="comment">/* pp_extents[LL_PROCESS_HIST_MAX] will hold the combined process info */</span>
<a name="l00400"></a><a class="code" href="structll__rw__extents__info.html">00400</a> <span class="keyword">struct </span><a class="code" href="structll__rw__extents__info.html">ll_rw_extents_info</a> {
<a name="l00401"></a><a class="code" href="structll__rw__extents__info.html#a97da69839e1ecc3b45dad532b252420d">00401</a>         <span class="keyword">struct </span><a class="code" href="structper__process__info.html">per_process_info</a> <a class="code" href="structll__rw__extents__info.html#a97da69839e1ecc3b45dad532b252420d">pp_extents</a>[<a class="code" href="llite__internal_8h.html#abc98e4b426d366fbc6eff54f67debecf">LL_PROCESS_HIST_MAX</a> + 1];
<a name="l00402"></a>00402 };
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="llite__internal_8h.html#a526b6295116ccc5cadb164606dec90f0">00404</a> <span class="preprocessor">#define LL_OFFSET_HIST_MAX 100</span>
<a name="l00405"></a><a class="code" href="structll__rw__process__info.html">00405</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structll__rw__process__info.html">ll_rw_process_info</a> {
<a name="l00406"></a><a class="code" href="structll__rw__process__info.html#a519c42cf27901ccab762953633c0e8c3">00406</a>         pid_t                     <a class="code" href="structll__rw__process__info.html#a519c42cf27901ccab762953633c0e8c3">rw_pid</a>;
<a name="l00407"></a><a class="code" href="structll__rw__process__info.html#a53e902e81665c393cd7c38dd798dd8f3">00407</a>         <span class="keywordtype">int</span>                       <a class="code" href="structll__rw__process__info.html#a53e902e81665c393cd7c38dd798dd8f3">rw_op</a>;
<a name="l00408"></a><a class="code" href="structll__rw__process__info.html#aba6e6e53894bc9c8fa1d3b898285f6f5">00408</a>         loff_t                    <a class="code" href="structll__rw__process__info.html#aba6e6e53894bc9c8fa1d3b898285f6f5">rw_range_start</a>;
<a name="l00409"></a><a class="code" href="structll__rw__process__info.html#a0958026b71bbf2512a7dd78e66a4564a">00409</a>         loff_t                    <a class="code" href="structll__rw__process__info.html#a0958026b71bbf2512a7dd78e66a4564a">rw_range_end</a>;
<a name="l00410"></a><a class="code" href="structll__rw__process__info.html#a24462f7d3b323ed7b36c0791595a1ebc">00410</a>         loff_t                    <a class="code" href="structll__rw__process__info.html#a24462f7d3b323ed7b36c0791595a1ebc">rw_last_file_pos</a>;
<a name="l00411"></a><a class="code" href="structll__rw__process__info.html#a68f36d3ea0ae71d1ea8a458af1e61366">00411</a>         loff_t                    <a class="code" href="structll__rw__process__info.html#a68f36d3ea0ae71d1ea8a458af1e61366">rw_offset</a>;
<a name="l00412"></a><a class="code" href="structll__rw__process__info.html#a7340679917645461ae87073fe978a4bb">00412</a>         <span class="keywordtype">size_t</span>                    <a class="code" href="structll__rw__process__info.html#a7340679917645461ae87073fe978a4bb">rw_smallest_extent</a>;
<a name="l00413"></a><a class="code" href="structll__rw__process__info.html#ac78ad98ebd02489b3d106832c5c09de3">00413</a>         <span class="keywordtype">size_t</span>                    <a class="code" href="structll__rw__process__info.html#ac78ad98ebd02489b3d106832c5c09de3">rw_largest_extent</a>;
<a name="l00414"></a><a class="code" href="structll__rw__process__info.html#ac9bbe6e36c773e177ce4d87ad54ba470">00414</a>         <span class="keyword">struct </span><a class="code" href="structll__file__data.html">ll_file_data</a>      *<a class="code" href="structll__rw__process__info.html#ac9bbe6e36c773e177ce4d87ad54ba470">rw_last_file</a>;
<a name="l00415"></a>00415 };
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8">00417</a> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8">stats_track_type</a> {
<a name="l00418"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a67b379465edea27963de74af65d0fd9e">00418</a>         <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a67b379465edea27963de74af65d0fd9e">STATS_TRACK_ALL</a> = 0,  <span class="comment">/* track all processes */</span>
<a name="l00419"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a75b2ba0af06295a74958efdb404acdc9">00419</a>         <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a75b2ba0af06295a74958efdb404acdc9">STATS_TRACK_PID</a>,      <span class="comment">/* track process with this pid */</span>
<a name="l00420"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a1bbb1ca80f864ab1a411028a4de7972d">00420</a>         <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a1bbb1ca80f864ab1a411028a4de7972d">STATS_TRACK_PPID</a>,     <span class="comment">/* track processes with this ppid */</span>
<a name="l00421"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a5800c4ef786f03492ea0f1c2cbe6fc57">00421</a>         <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a5800c4ef786f03492ea0f1c2cbe6fc57">STATS_TRACK_GID</a>,      <span class="comment">/* track processes with this gid */</span>
<a name="l00422"></a><a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a5867673912cb6d57cbd6c5c66e4da57a">00422</a>         <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8a5867673912cb6d57cbd6c5c66e4da57a">STATS_TRACK_LAST</a>,
<a name="l00423"></a>00423 };
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 <span class="comment">/* flags for sbi-&gt;ll_flags */</span>
<a name="l00426"></a><a class="code" href="llite__internal_8h.html#a68b33f8795031361448800ead47273b1">00426</a> <span class="preprocessor">#define LL_SBI_NOLCK             0x01 </span><span class="comment">/* DLM locking disabled (directio-only) */</span>
<a name="l00427"></a><a class="code" href="llite__internal_8h.html#a408b4c4fadc37e173b27b8c2514582b5">00427</a> <span class="preprocessor">#define LL_SBI_CHECKSUM          0x02 </span><span class="comment">/* checksum each page as it&apos;s written */</span>
<a name="l00428"></a><a class="code" href="llite__internal_8h.html#a11af3ff7a377957cc7239bb6f2397cb6">00428</a> <span class="preprocessor">#define LL_SBI_FLOCK             0x04</span>
<a name="l00429"></a><a class="code" href="llite__internal_8h.html#a9fb4d07e0391a63f75645321b745f205">00429</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_SBI_USER_XATTR        0x08 </span><span class="comment">/* support user xattr */</span>
<a name="l00430"></a><a class="code" href="llite__internal_8h.html#a41c0bc096214b6e14eaccb283392eb53">00430</a> <span class="preprocessor">#define LL_SBI_ACL               0x10 </span><span class="comment">/* support ACL */</span>
<a name="l00431"></a><a class="code" href="llite__internal_8h.html#aa13fa29fe790dd1e43f485ea30989e79">00431</a> <span class="preprocessor">#define LL_SBI_RMT_CLIENT        0x40 </span><span class="comment">/* remote client */</span>
<a name="l00432"></a><a class="code" href="llite__internal_8h.html#a58900e4962f7fcf1d980184cfa77de5a">00432</a> <span class="preprocessor">#define LL_SBI_MDS_CAPA          0x80 </span><span class="comment">/* support mds capa, obsolete */</span>
<a name="l00433"></a><a class="code" href="llite__internal_8h.html#a7b003b7f9f36648a2a50e9af03382758">00433</a> <span class="preprocessor">#define LL_SBI_OSS_CAPA         0x100 </span><span class="comment">/* support oss capa, obsolete */</span>
<a name="l00434"></a><a class="code" href="llite__internal_8h.html#a3b653a8aa89f58fe039eb3ae74e66e41">00434</a> <span class="preprocessor">#define LL_SBI_LOCALFLOCK       0x200 </span><span class="comment">/* Local flocks support by kernel */</span>
<a name="l00435"></a><a class="code" href="llite__internal_8h.html#a339ceaddd7c3abc5339e66b6073026bf">00435</a> <span class="preprocessor">#define LL_SBI_LRU_RESIZE       0x400 </span><span class="comment">/* lru resize support */</span>
<a name="l00436"></a><a class="code" href="llite__internal_8h.html#a4ba804f72b6e0dec415cfa8c749df950">00436</a> <span class="preprocessor">#define LL_SBI_LAZYSTATFS       0x800 </span><span class="comment">/* lazystatfs mount option */</span>
<a name="l00437"></a>00437 <span class="comment">/*      LL_SBI_SOM_PREVIEW     0x1000    SOM preview mount option, obsolete */</span>
<a name="l00438"></a><a class="code" href="llite__internal_8h.html#a9da8fe91e5eb1427355b4cb1e5608883">00438</a> <span class="preprocessor">#define LL_SBI_32BIT_API       0x2000 </span><span class="comment">/* generate 32 bit inodes. */</span>
<a name="l00439"></a><a class="code" href="llite__internal_8h.html#aabe5eff83fa69ac7f8210025037b7222">00439</a> <span class="preprocessor">#define LL_SBI_64BIT_HASH      0x4000 </span><span class="comment">/* support 64-bits dir hash/offset */</span>
<a name="l00440"></a><a class="code" href="llite__internal_8h.html#ad990324d46f34c792b83a456aa9160e8">00440</a> <span class="preprocessor">#define LL_SBI_AGL_ENABLED     0x8000 </span><span class="comment">/* enable agl */</span>
<a name="l00441"></a><a class="code" href="llite__internal_8h.html#abb6d55e341509a326b97fb773f1c8efe">00441</a> <span class="preprocessor">#define LL_SBI_VERBOSE        0x10000 </span><span class="comment">/* verbose mount/umount */</span>
<a name="l00442"></a><a class="code" href="llite__internal_8h.html#a8797f99db97384acceaf5e262f969b50">00442</a> <span class="preprocessor">#define LL_SBI_LAYOUT_LOCK    0x20000 </span><span class="comment">/* layout lock support */</span>
<a name="l00443"></a><a class="code" href="llite__internal_8h.html#a45ef75591bea5a599ae11ffb5e61240e">00443</a> <span class="preprocessor">#define LL_SBI_USER_FID2PATH  0x40000 </span><span class="comment">/* allow fid2path by unprivileged users */</span>
<a name="l00444"></a><a class="code" href="llite__internal_8h.html#aaff34474710038ad6c5c2eeab820b6dd">00444</a> <span class="preprocessor">#define LL_SBI_XATTR_CACHE    0x80000 </span><span class="comment">/* support for xattr cache */</span>
<a name="l00445"></a><a class="code" href="llite__internal_8h.html#a848246ca52a726e1237d65808e596096">00445</a> <span class="preprocessor">#define LL_SBI_NOROOTSQUASH  0x100000 </span><span class="comment">/* do not apply root squash */</span>
<a name="l00446"></a><a class="code" href="llite__internal_8h.html#a94db8396f4e8217c7e76e43a89989b4f">00446</a> <span class="preprocessor">#define LL_SBI_ALWAYS_PING   0x200000 </span><span class="comment">/* always ping even if server</span>
<a name="l00447"></a>00447 <span class="comment">                                       * suppress_pings */</span>
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="llite__internal_8h.html#a7901049ea3ee1b197365b06cfc9027bc">00449</a> <span class="preprocessor">#define LL_SBI_FLAGS {  \</span>
<a name="l00450"></a>00450 <span class="preprocessor">        &quot;nolck&quot;,        \</span>
<a name="l00451"></a>00451 <span class="preprocessor">        &quot;checksum&quot;,     \</span>
<a name="l00452"></a>00452 <span class="preprocessor">        &quot;flock&quot;,        \</span>
<a name="l00453"></a>00453 <span class="preprocessor">        &quot;user_xattr&quot;,   \</span>
<a name="l00454"></a>00454 <span class="preprocessor">        &quot;acl&quot;,          \</span>
<a name="l00455"></a>00455 <span class="preprocessor">        &quot;???&quot;,          \</span>
<a name="l00456"></a>00456 <span class="preprocessor">        &quot;rmt_client&quot;,   \</span>
<a name="l00457"></a>00457 <span class="preprocessor">        &quot;mds_capa&quot;,     \</span>
<a name="l00458"></a>00458 <span class="preprocessor">        &quot;oss_capa&quot;,     \</span>
<a name="l00459"></a>00459 <span class="preprocessor">        &quot;flock&quot;,        \</span>
<a name="l00460"></a>00460 <span class="preprocessor">        &quot;lru_resize&quot;,   \</span>
<a name="l00461"></a>00461 <span class="preprocessor">        &quot;lazy_statfs&quot;,  \</span>
<a name="l00462"></a>00462 <span class="preprocessor">        &quot;som&quot;,          \</span>
<a name="l00463"></a>00463 <span class="preprocessor">        &quot;32bit_api&quot;,    \</span>
<a name="l00464"></a>00464 <span class="preprocessor">        &quot;64bit_hash&quot;,   \</span>
<a name="l00465"></a>00465 <span class="preprocessor">        &quot;agl&quot;,          \</span>
<a name="l00466"></a>00466 <span class="preprocessor">        &quot;verbose&quot;,      \</span>
<a name="l00467"></a>00467 <span class="preprocessor">        &quot;layout&quot;,       \</span>
<a name="l00468"></a>00468 <span class="preprocessor">        &quot;user_fid2path&quot;,\</span>
<a name="l00469"></a>00469 <span class="preprocessor">        &quot;xattr_cache&quot;,  \</span>
<a name="l00470"></a>00470 <span class="preprocessor">        &quot;norootsquash&quot;, \</span>
<a name="l00471"></a>00471 <span class="preprocessor">        &quot;always_ping&quot;,  \</span>
<a name="l00472"></a>00472 <span class="preprocessor">}</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>
<a name="l00474"></a><a class="code" href="llite__internal_8h.html#abd2284fcfc4e716b512108a59ccc59c0">00474</a> <span class="preprocessor">#define RCE_HASHES      32</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span>
<a name="l00476"></a><a class="code" href="structrmtacl__ctl__entry.html">00476</a> <span class="keyword">struct </span><a class="code" href="structrmtacl__ctl__entry.html">rmtacl_ctl_entry</a> {
<a name="l00477"></a><a class="code" href="structrmtacl__ctl__entry.html#af28c68a151b520dbadbc211bd2f8198a">00477</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       <a class="code" href="structrmtacl__ctl__entry.html#af28c68a151b520dbadbc211bd2f8198a">rce_list</a>;
<a name="l00478"></a><a class="code" href="structrmtacl__ctl__entry.html#adca5d4e7b419761e0b7d356484403f2a">00478</a>         pid_t            <a class="code" href="structrmtacl__ctl__entry.html#adca5d4e7b419761e0b7d356484403f2a">rce_key</a>; <span class="comment">/* hash key */</span>
<a name="l00479"></a><a class="code" href="structrmtacl__ctl__entry.html#a18d3281ef6c1d5c18dcc337e7f443cb5">00479</a>         <span class="keywordtype">int</span>              <a class="code" href="structrmtacl__ctl__entry.html#a18d3281ef6c1d5c18dcc337e7f443cb5">rce_ops</a>; <span class="comment">/* acl operation type */</span>
<a name="l00480"></a>00480 };
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="structrmtacl__ctl__table.html">00482</a> <span class="keyword">struct </span><a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> {
<a name="l00483"></a><a class="code" href="structrmtacl__ctl__table.html#a4e53229273ea40bcc840ef7dc2c572e5">00483</a>         spinlock_t      <a class="code" href="structrmtacl__ctl__table.html#a4e53229273ea40bcc840ef7dc2c572e5">rct_lock</a>;
<a name="l00484"></a><a class="code" href="structrmtacl__ctl__table.html#a38937f4dd3cc59a300874fdc91c47ed8">00484</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structrmtacl__ctl__table.html#a38937f4dd3cc59a300874fdc91c47ed8">rct_entries</a>[<a class="code" href="llite__internal_8h.html#abd2284fcfc4e716b512108a59ccc59c0">RCE_HASHES</a>];
<a name="l00485"></a>00485 };
<a name="l00486"></a>00486 
<a name="l00487"></a><a class="code" href="llite__internal_8h.html#a1f36c255eed7b94ee29d14c438a2cb99">00487</a> <span class="preprocessor">#define EE_HASHES       32</span>
<a name="l00488"></a>00488 <span class="preprocessor"></span>
<a name="l00489"></a><a class="code" href="structeacl__entry.html">00489</a> <span class="keyword">struct </span><a class="code" href="structeacl__entry.html">eacl_entry</a> {
<a name="l00490"></a><a class="code" href="structeacl__entry.html#ad5c7f5b6eda1c8a330057588fb9f8a26">00490</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>            <a class="code" href="structeacl__entry.html#ad5c7f5b6eda1c8a330057588fb9f8a26">ee_list</a>;
<a name="l00491"></a><a class="code" href="structeacl__entry.html#a128e63dd2fd8ac053829161d3ed0c6ff">00491</a>         pid_t                 <a class="code" href="structeacl__entry.html#a128e63dd2fd8ac053829161d3ed0c6ff">ee_key</a>; <span class="comment">/* hash key */</span>
<a name="l00492"></a><a class="code" href="structeacl__entry.html#acdf557ce1df9bbaf53520378830f90f0">00492</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>         <a class="code" href="structeacl__entry.html#acdf557ce1df9bbaf53520378830f90f0">ee_fid</a>;
<a name="l00493"></a><a class="code" href="structeacl__entry.html#a464b15fbcc1ad0043ee9d1f45d3fb7a8">00493</a>         <span class="keywordtype">int</span>                   <a class="code" href="structeacl__entry.html#a464b15fbcc1ad0043ee9d1f45d3fb7a8">ee_type</a>; <span class="comment">/* ACL type for ACCESS or DEFAULT */</span>
<a name="l00494"></a><a class="code" href="structeacl__entry.html#aee30db39119e6cd44dad1fdae90f1f89">00494</a>         ext_acl_xattr_header *<a class="code" href="structeacl__entry.html#aee30db39119e6cd44dad1fdae90f1f89">ee_acl</a>;
<a name="l00495"></a>00495 };
<a name="l00496"></a>00496 
<a name="l00497"></a><a class="code" href="structeacl__table.html">00497</a> <span class="keyword">struct </span><a class="code" href="structeacl__table.html">eacl_table</a> {
<a name="l00498"></a><a class="code" href="structeacl__table.html#a285aba6c05c9534e2257490bd6d1b98e">00498</a>         spinlock_t      <a class="code" href="structeacl__table.html#a285aba6c05c9534e2257490bd6d1b98e">et_lock</a>;
<a name="l00499"></a><a class="code" href="structeacl__table.html#a327a9e66ecd926012c7fb1f47effa74f">00499</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structeacl__table.html#a327a9e66ecd926012c7fb1f47effa74f">et_entries</a>[<a class="code" href="llite__internal_8h.html#a1f36c255eed7b94ee29d14c438a2cb99">EE_HASHES</a>];
<a name="l00500"></a>00500 };
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 <span class="comment">/* This is embedded into llite super-blocks to keep track of connect</span>
<a name="l00504"></a>00504 <span class="comment"> * flags (capabilities) supported by all imports given mount is</span>
<a name="l00505"></a>00505 <span class="comment"> * connected to. */</span>
<a name="l00506"></a><a class="code" href="structlustre__client__ocd.html">00506</a> <span class="keyword">struct </span><a class="code" href="structlustre__client__ocd.html">lustre_client_ocd</a> {
<a name="l00507"></a>00507         <span class="comment">/* This is conjunction of connect_flags across all imports</span>
<a name="l00508"></a>00508 <span class="comment">         * (LOVs) this mount is connected to. This field is updated by</span>
<a name="l00509"></a>00509 <span class="comment">         * cl_ocd_update() under -&gt;lco_lock. */</span>
<a name="l00510"></a><a class="code" href="structlustre__client__ocd.html#ac75d4bc729e2c757ed45caf86d5bac26">00510</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                    <a class="code" href="structlustre__client__ocd.html#ac75d4bc729e2c757ed45caf86d5bac26">lco_flags</a>;
<a name="l00511"></a><a class="code" href="structlustre__client__ocd.html#a81fd77cb216c0f98fcec4e52577dec79">00511</a>         <span class="keyword">struct </span>mutex             <a class="code" href="structlustre__client__ocd.html#a81fd77cb216c0f98fcec4e52577dec79">lco_lock</a>;
<a name="l00512"></a><a class="code" href="structlustre__client__ocd.html#a9009b7db01bb51190fd339e78a433aa7">00512</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structlustre__client__ocd.html#a9009b7db01bb51190fd339e78a433aa7">lco_md_exp</a>;
<a name="l00513"></a><a class="code" href="structlustre__client__ocd.html#a9afea4445741369fa2646aff5d984638">00513</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structlustre__client__ocd.html#a9afea4445741369fa2646aff5d984638">lco_dt_exp</a>;
<a name="l00514"></a>00514 };
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="structll__sb__info.html">00516</a> <span class="keyword">struct </span><a class="code" href="structll__sb__info.html">ll_sb_info</a> {
<a name="l00517"></a>00517         <span class="comment">/* this protects pglist and ra_info.  It isn&apos;t safe to</span>
<a name="l00518"></a>00518 <span class="comment">         * grab from interrupt contexts */</span>
<a name="l00519"></a><a class="code" href="structll__sb__info.html#aeaeeaa1f0eb07c0f888d80e2daa6e41d">00519</a>         spinlock_t                <a class="code" href="structll__sb__info.html#aeaeeaa1f0eb07c0f888d80e2daa6e41d">ll_lock</a>;
<a name="l00520"></a><a class="code" href="structll__sb__info.html#adb10faa6c0cb4ad3261467fadda545e5">00520</a>         spinlock_t                <a class="code" href="structll__sb__info.html#adb10faa6c0cb4ad3261467fadda545e5">ll_pp_extent_lock</a>; <span class="comment">/* pp_extent entry*/</span>
<a name="l00521"></a><a class="code" href="structll__sb__info.html#aeaaec6af82f81cc58564a76f490f9a43">00521</a>         spinlock_t                <a class="code" href="structll__sb__info.html#aeaaec6af82f81cc58564a76f490f9a43">ll_process_lock</a>; <span class="comment">/* ll_rw_process_info */</span>
<a name="l00522"></a><a class="code" href="structll__sb__info.html#a25ee81ac624a32525c05b98c22f52a97">00522</a>         <span class="keyword">struct </span><a class="code" href="structobd__uuid.html">obd_uuid</a>           <a class="code" href="structll__sb__info.html#a25ee81ac624a32525c05b98c22f52a97">ll_sb_uuid</a>;
<a name="l00523"></a><a class="code" href="structll__sb__info.html#a585b00d59707c91ff10eb0e6a571cbba">00523</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>        *<a class="code" href="structll__sb__info.html#a585b00d59707c91ff10eb0e6a571cbba">ll_md_exp</a>;
<a name="l00524"></a><a class="code" href="structll__sb__info.html#a61faad034a2b0a333fd791c6b4b26a4f">00524</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>        *<a class="code" href="structll__sb__info.html#a61faad034a2b0a333fd791c6b4b26a4f">ll_dt_exp</a>;
<a name="l00525"></a><a class="code" href="structll__sb__info.html#a881a23d4686c787b6e97661e51fd788a">00525</a>         <span class="keyword">struct </span>proc_dir_entry*    <a class="code" href="structll__sb__info.html#a881a23d4686c787b6e97661e51fd788a">ll_proc_root</a>;
<a name="l00526"></a><a class="code" href="structll__sb__info.html#ad9f356efbfe9a3b78976fb0160b002e4">00526</a>         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>             <a class="code" href="structll__sb__info.html#ad9f356efbfe9a3b78976fb0160b002e4">ll_root_fid</a>; <span class="comment">/* root object fid */</span>
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="structll__sb__info.html#a061ecc4031c73d1bdcc404752b53e300">00528</a>         <span class="keywordtype">int</span>                       <a class="code" href="structll__sb__info.html#a061ecc4031c73d1bdcc404752b53e300">ll_flags</a>;
<a name="l00529"></a><a class="code" href="structll__sb__info.html#a4d99fed96dba170ecbe7e77e0cec270c">00529</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#a78c5cb18c34b488f1b139f11d93b9f33">ll_umounting</a>:1,
<a name="l00530"></a>00530                                   <a class="code" href="structll__sb__info.html#a4d99fed96dba170ecbe7e77e0cec270c">ll_xattr_cache_enabled</a>:1,
<a name="l00531"></a>00531                                   <a class="code" href="structll__sb__info.html#ad8098ec0964f276bd4cbf09bb3e32776">ll_client_common_fill_super_succeeded</a>:1;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <span class="comment">/* per-conn chain of SBs */</span>
<a name="l00534"></a><a class="code" href="structll__sb__info.html#a2e2dc999581317e1d8828988a700d019">00534</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                <a class="code" href="structll__sb__info.html#a2e2dc999581317e1d8828988a700d019">ll_conn_chain</a>;
<a name="l00535"></a><a class="code" href="structll__sb__info.html#af52f2f64382bfabed7efbd38fb3b9204">00535</a>         <span class="keyword">struct </span><a class="code" href="structlustre__client__ocd.html">lustre_client_ocd</a>  <a class="code" href="structll__sb__info.html#af52f2f64382bfabed7efbd38fb3b9204">ll_lco</a>;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="comment">/*please don&apos;t ask -p*/</span>
<a name="l00538"></a><a class="code" href="structll__sb__info.html#a4736ca594614e99a9e2d6d13e0e679de">00538</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structll__sb__info.html#a4736ca594614e99a9e2d6d13e0e679de">ll_orphan_dentry_list</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a><a class="code" href="structll__sb__info.html#a162d2b2bfbeeb010d13f2f2d1f48c29a">00540</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>     *<a class="code" href="structll__sb__info.html#a162d2b2bfbeeb010d13f2f2d1f48c29a">ll_stats</a>; <span class="comment">/* lprocfs stats counter */</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542         <span class="comment">/* Used to track &quot;unstable&quot; pages on a client, and maintain a</span>
<a name="l00543"></a>00543 <span class="comment">         * LRU list of clean pages. An &quot;unstable&quot; page is defined as</span>
<a name="l00544"></a>00544 <span class="comment">         * any page which is sent to a server as part of a bulk request,</span>
<a name="l00545"></a>00545 <span class="comment">         * but is uncommitted to stable storage. */</span>
<a name="l00546"></a><a class="code" href="structll__sb__info.html#a254eae91e31382ef4e9c41c0fd960349">00546</a>         <span class="keyword">struct </span><a class="code" href="structcl__client__cache.html" title="Data structure managing a client&amp;#39;s cached pages.">cl_client_cache</a>   *<a class="code" href="structll__sb__info.html#a254eae91e31382ef4e9c41c0fd960349">ll_cache</a>;
<a name="l00547"></a>00547 
<a name="l00548"></a><a class="code" href="structll__sb__info.html#a45ab8c63990d49678f28426217d99a60">00548</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>     *<a class="code" href="structll__sb__info.html#a45ab8c63990d49678f28426217d99a60">ll_ra_stats</a>;
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="structll__sb__info.html#ac92a6e1b2c259626b4fa321be9ae99b8">00550</a>         <span class="keyword">struct </span><a class="code" href="structll__ra__info.html">ll_ra_info</a>         <a class="code" href="structll__ra__info.html">ll_ra_info</a>;
<a name="l00551"></a><a class="code" href="structll__sb__info.html#ac0d79c48c4222ec0c1660114efb59a52">00551</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#ac0d79c48c4222ec0c1660114efb59a52">ll_namelen</a>;
<a name="l00552"></a><a class="code" href="structll__sb__info.html#a379a68c4a9372fd9c08374b5807df431">00552</a>         <span class="keyword">struct </span>file_operations   *<a class="code" href="structll__sb__info.html#a379a68c4a9372fd9c08374b5807df431">ll_fop</a>;
<a name="l00553"></a>00553 
<a name="l00554"></a><a class="code" href="structll__sb__info.html#a8b689cbc8d73eb18477d970899357feb">00554</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#a8b689cbc8d73eb18477d970899357feb">ll_md_brw_pages</a>; <span class="comment">/* readdir pages per RPC */</span>
<a name="l00555"></a>00555 
<a name="l00556"></a><a class="code" href="structll__sb__info.html#a826a35f6e7cf5cfa3797231d8aa644f7">00556</a>         <span class="keyword">struct </span><a class="code" href="structlu__site.html" title="lu_site is a &amp;quot;compartment&amp;quot; within which objects are unique, and LRU discipline...">lu_site</a>           *<a class="code" href="structll__sb__info.html#a826a35f6e7cf5cfa3797231d8aa644f7">ll_site</a>;
<a name="l00557"></a><a class="code" href="structll__sb__info.html#a5a296cb7eedc72d425f9a2c859e1cb35">00557</a>         <span class="keyword">struct </span><a class="code" href="structcl__device.html" title="Device in the client stack.">cl_device</a>         *<a class="code" href="structll__sb__info.html#a5a296cb7eedc72d425f9a2c859e1cb35">ll_cl</a>;
<a name="l00558"></a>00558         <span class="comment">/* Statistics */</span>
<a name="l00559"></a><a class="code" href="structll__sb__info.html#ac917c5f175cf598407ab052c7b86e3e7">00559</a>         <span class="keyword">struct </span><a class="code" href="structll__rw__extents__info.html">ll_rw_extents_info</a> <a class="code" href="structll__rw__extents__info.html">ll_rw_extents_info</a>;
<a name="l00560"></a><a class="code" href="structll__sb__info.html#a2830ab5e52e3bb1e0c030593e99030b6">00560</a>         <span class="keywordtype">int</span>                       <a class="code" href="structll__sb__info.html#a2830ab5e52e3bb1e0c030593e99030b6">ll_extent_process_count</a>;
<a name="l00561"></a><a class="code" href="structll__sb__info.html#a6d4c36676d639b2955bac47add969686">00561</a>         <span class="keyword">struct </span><a class="code" href="structll__rw__process__info.html">ll_rw_process_info</a> <a class="code" href="structll__rw__process__info.html">ll_rw_process_info</a>[<a class="code" href="llite__internal_8h.html#abc98e4b426d366fbc6eff54f67debecf">LL_PROCESS_HIST_MAX</a>];
<a name="l00562"></a><a class="code" href="structll__sb__info.html#a8a8bc284e87a2fa28d968982636bc352">00562</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#a8a8bc284e87a2fa28d968982636bc352">ll_offset_process_count</a>;
<a name="l00563"></a><a class="code" href="structll__sb__info.html#ad1cb351dafe80da7b0796bb77086fb93">00563</a>         <span class="keyword">struct </span><a class="code" href="structll__rw__process__info.html">ll_rw_process_info</a> <a class="code" href="structll__sb__info.html#ad1cb351dafe80da7b0796bb77086fb93">ll_rw_offset_info</a>[<a class="code" href="llite__internal_8h.html#a526b6295116ccc5cadb164606dec90f0">LL_OFFSET_HIST_MAX</a>];
<a name="l00564"></a><a class="code" href="structll__sb__info.html#a04d93e43597f3dbb56718037ccd9cf1f">00564</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#a04d93e43597f3dbb56718037ccd9cf1f">ll_rw_offset_entry_count</a>;
<a name="l00565"></a><a class="code" href="structll__sb__info.html#a20febacf344cb50cf22a982235cd9cb8">00565</a>         <span class="keywordtype">int</span>                       <a class="code" href="structll__sb__info.html#a20febacf344cb50cf22a982235cd9cb8">ll_stats_track_id</a>;
<a name="l00566"></a><a class="code" href="structll__sb__info.html#a65b8c47b1cc2d13371892403c17a0897">00566</a>         <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#a599c15bff50dbfafe99798a0715521d8">stats_track_type</a>     <a class="code" href="structll__sb__info.html#a65b8c47b1cc2d13371892403c17a0897">ll_stats_track_type</a>;
<a name="l00567"></a><a class="code" href="structll__sb__info.html#aec2617ff29580308d6e1d064fd315b00">00567</a>         <span class="keywordtype">int</span>                       <a class="code" href="structll__sb__info.html#aec2617ff29580308d6e1d064fd315b00">ll_rw_stats_on</a>;
<a name="l00568"></a>00568 
<a name="l00569"></a>00569         <span class="comment">/* metadata stat-ahead */</span>
<a name="l00570"></a><a class="code" href="structll__sb__info.html#a5dde0f879ae7c197cbb3e42392862411">00570</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structll__sb__info.html#a5dde0f879ae7c197cbb3e42392862411">ll_sa_max</a>;     <span class="comment">/* max statahead RPCs */</span>
<a name="l00571"></a><a class="code" href="structll__sb__info.html#a907f4363658bc3e70b963b69377101e9">00571</a>         atomic_t                  <a class="code" href="structll__sb__info.html#a907f4363658bc3e70b963b69377101e9">ll_sa_total</a>;   <span class="comment">/* statahead thread started</span>
<a name="l00572"></a>00572 <span class="comment">                                                  * count */</span>
<a name="l00573"></a><a class="code" href="structll__sb__info.html#a9c868330d338edfa12fac7147c1e59d4">00573</a>         atomic_t                  <a class="code" href="structll__sb__info.html#a9c868330d338edfa12fac7147c1e59d4">ll_sa_wrong</a>;   <span class="comment">/* statahead thread stopped for</span>
<a name="l00574"></a>00574 <span class="comment">                                                  * low hit ratio */</span>
<a name="l00575"></a><a class="code" href="structll__sb__info.html#afc700f29fc050c6cd8908dcfd93f28d1">00575</a>         atomic_t                  <a class="code" href="structll__sb__info.html#afc700f29fc050c6cd8908dcfd93f28d1">ll_sa_running</a>; <span class="comment">/* running statahead thread</span>
<a name="l00576"></a>00576 <span class="comment">                                                  * count */</span>
<a name="l00577"></a><a class="code" href="structll__sb__info.html#a9b2d3c39122a4c909eb28b07bb7ad530">00577</a>         atomic_t                  <a class="code" href="structll__sb__info.html#a9b2d3c39122a4c909eb28b07bb7ad530">ll_agl_total</a>;  <span class="comment">/* AGL thread started count */</span>
<a name="l00578"></a>00578 
<a name="l00579"></a><a class="code" href="structll__sb__info.html#a77d1f43fc311b6b45ef68e8c4eafe6d0">00579</a>         dev_t                     <a class="code" href="structll__sb__info.html#a77d1f43fc311b6b45ef68e8c4eafe6d0">ll_sdev_orig</a>; <span class="comment">/* save s_dev before assign for</span>
<a name="l00580"></a>00580 <span class="comment">                                                 * clustred nfs */</span>
<a name="l00581"></a><a class="code" href="structll__sb__info.html#afae77af1f3393e6de41a468bcd02088f">00581</a>         <span class="keyword">struct </span><a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a>   <a class="code" href="structll__sb__info.html#afae77af1f3393e6de41a468bcd02088f">ll_rct</a>;
<a name="l00582"></a><a class="code" href="structll__sb__info.html#a26f363c656bfbb7bcf46911a3379a733">00582</a>         <span class="keyword">struct </span><a class="code" href="structeacl__table.html">eacl_table</a>         <a class="code" href="structll__sb__info.html#a26f363c656bfbb7bcf46911a3379a733">ll_et</a>;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584         <span class="comment">/* root squash */</span>
<a name="l00585"></a><a class="code" href="structll__sb__info.html#a0a4b7f96b5e8a382928dfd734689e549">00585</a>         <span class="keyword">struct </span><a class="code" href="structroot__squash__info.html">root_squash_info</a>   <a class="code" href="structll__sb__info.html#a0a4b7f96b5e8a382928dfd734689e549">ll_squash</a>;
<a name="l00586"></a>00586 };
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="comment">/*</span>
<a name="l00589"></a>00589 <span class="comment"> * per file-descriptor read-ahead data.</span>
<a name="l00590"></a>00590 <span class="comment"> */</span>
<a name="l00591"></a><a class="code" href="structll__readahead__state.html">00591</a> <span class="keyword">struct </span><a class="code" href="structll__readahead__state.html">ll_readahead_state</a> {
<a name="l00592"></a><a class="code" href="structll__readahead__state.html#a82cc9d4508f372e295b63d14598b963d">00592</a>         spinlock_t  <a class="code" href="structll__readahead__state.html#a82cc9d4508f372e295b63d14598b963d">ras_lock</a>;
<a name="l00593"></a>00593         <span class="comment">/*</span>
<a name="l00594"></a>00594 <span class="comment">         * index of the last page that read(2) needed and that wasn&apos;t in the</span>
<a name="l00595"></a>00595 <span class="comment">         * cache. Used by ras_update() to detect seeks.</span>
<a name="l00596"></a>00596 <span class="comment">         *</span>
<a name="l00597"></a>00597 <span class="comment">         * XXX nikita: if access seeks into cached region, Lustre doesn&apos;t see</span>
<a name="l00598"></a>00598 <span class="comment">         * this.</span>
<a name="l00599"></a>00599 <span class="comment">         */</span>
<a name="l00600"></a><a class="code" href="structll__readahead__state.html#a37637c73613ea40718c805064d5524e2">00600</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#a37637c73613ea40718c805064d5524e2">ras_last_readpage</a>;
<a name="l00601"></a>00601         <span class="comment">/*</span>
<a name="l00602"></a>00602 <span class="comment">         * number of pages read after last read-ahead window reset. As window</span>
<a name="l00603"></a>00603 <span class="comment">         * is reset on each seek, this is effectively a number of consecutive</span>
<a name="l00604"></a>00604 <span class="comment">         * accesses. Maybe -&gt;ras_accessed_in_window is better name.</span>
<a name="l00605"></a>00605 <span class="comment">         *</span>
<a name="l00606"></a>00606 <span class="comment">         * XXX nikita: window is also reset (by ras_update()) when Lustre</span>
<a name="l00607"></a>00607 <span class="comment">         * believes that memory pressure evicts read-ahead pages. In that</span>
<a name="l00608"></a>00608 <span class="comment">         * case, it probably doesn&apos;t make sense to expand window to</span>
<a name="l00609"></a>00609 <span class="comment">         * PTLRPC_MAX_BRW_PAGES on the third access.</span>
<a name="l00610"></a>00610 <span class="comment">         */</span>
<a name="l00611"></a><a class="code" href="structll__readahead__state.html#abfeec69ac8af14e13fffb031e493a33c">00611</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#abfeec69ac8af14e13fffb031e493a33c">ras_consecutive_pages</a>;
<a name="l00612"></a>00612         <span class="comment">/*</span>
<a name="l00613"></a>00613 <span class="comment">         * number of read requests after the last read-ahead window reset</span>
<a name="l00614"></a>00614 <span class="comment">         * As window is reset on each seek, this is effectively the number</span>
<a name="l00615"></a>00615 <span class="comment">         * on consecutive read request and is used to trigger read-ahead.</span>
<a name="l00616"></a>00616 <span class="comment">         */</span>
<a name="l00617"></a><a class="code" href="structll__readahead__state.html#a298bce0dbc513680f7a6ad5615432a27">00617</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#a298bce0dbc513680f7a6ad5615432a27">ras_consecutive_requests</a>;
<a name="l00618"></a>00618         <span class="comment">/*</span>
<a name="l00619"></a>00619 <span class="comment">         * Parameters of current read-ahead window. Handled by</span>
<a name="l00620"></a>00620 <span class="comment">         * ras_update(). On the initial access to the file or after a seek,</span>
<a name="l00621"></a>00621 <span class="comment">         * window is reset to 0. After 3 consecutive accesses, window is</span>
<a name="l00622"></a>00622 <span class="comment">         * expanded to PTLRPC_MAX_BRW_PAGES. Afterwards, window is enlarged by</span>
<a name="l00623"></a>00623 <span class="comment">         * PTLRPC_MAX_BRW_PAGES chunks up to -&gt;ra_max_pages.</span>
<a name="l00624"></a>00624 <span class="comment">         */</span>
<a name="l00625"></a><a class="code" href="structll__readahead__state.html#aec7300817c6fa718ab8cecb399ed61ad">00625</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#aec7300817c6fa718ab8cecb399ed61ad">ras_window_start</a>, <a class="code" href="structll__readahead__state.html#a6e44f0ceec083d0f3ad86900f7ac5839">ras_window_len</a>;
<a name="l00626"></a>00626         <span class="comment">/*</span>
<a name="l00627"></a>00627 <span class="comment">         * Optimal RPC size. It decides how many pages will be sent</span>
<a name="l00628"></a>00628 <span class="comment">         * for each read-ahead.</span>
<a name="l00629"></a>00629 <span class="comment">         */</span>
<a name="l00630"></a><a class="code" href="structll__readahead__state.html#acc01aed419f4f0015564f181180b4217">00630</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#acc01aed419f4f0015564f181180b4217">ras_rpc_size</a>;
<a name="l00631"></a>00631         <span class="comment">/*</span>
<a name="l00632"></a>00632 <span class="comment">         * Where next read-ahead should start at. This lies within read-ahead</span>
<a name="l00633"></a>00633 <span class="comment">         * window. Read-ahead window is read in pieces rather than at once</span>
<a name="l00634"></a>00634 <span class="comment">         * because: 1. lustre limits total number of pages under read-ahead by</span>
<a name="l00635"></a>00635 <span class="comment">         * -&gt;ra_max_pages (see ll_ra_count_get()), 2. client cannot read pages</span>
<a name="l00636"></a>00636 <span class="comment">         * not covered by DLM lock.</span>
<a name="l00637"></a>00637 <span class="comment">         */</span>
<a name="l00638"></a><a class="code" href="structll__readahead__state.html#aceb996d6e8e80b40d3695fa95efd8efb">00638</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#aceb996d6e8e80b40d3695fa95efd8efb">ras_next_readahead</a>;
<a name="l00639"></a>00639         <span class="comment">/*</span>
<a name="l00640"></a>00640 <span class="comment">         * Total number of ll_file_read requests issued, reads originating</span>
<a name="l00641"></a>00641 <span class="comment">         * due to mmap are not counted in this total.  This value is used to</span>
<a name="l00642"></a>00642 <span class="comment">         * trigger full file read-ahead after multiple reads to a small file.</span>
<a name="l00643"></a>00643 <span class="comment">         */</span>
<a name="l00644"></a><a class="code" href="structll__readahead__state.html#a8ffa86ae13c80cd9a9de626548b64725">00644</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#a8ffa86ae13c80cd9a9de626548b64725">ras_requests</a>;
<a name="l00645"></a>00645         <span class="comment">/*</span>
<a name="l00646"></a>00646 <span class="comment">         * Page index with respect to the current request, these value</span>
<a name="l00647"></a>00647 <span class="comment">         * will not be accurate when dealing with reads issued via mmap.</span>
<a name="l00648"></a>00648 <span class="comment">         */</span>
<a name="l00649"></a><a class="code" href="structll__readahead__state.html#ab6841c1afb7fc7f104031b7104a9fc40">00649</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#ab6841c1afb7fc7f104031b7104a9fc40">ras_request_index</a>;
<a name="l00650"></a>00650         <span class="comment">/*</span>
<a name="l00651"></a>00651 <span class="comment">         * The following 3 items are used for detecting the stride I/O</span>
<a name="l00652"></a>00652 <span class="comment">         * mode.</span>
<a name="l00653"></a>00653 <span class="comment">         * In stride I/O mode,</span>
<a name="l00654"></a>00654 <span class="comment">         * ...............|-----data-----|****gap*****|--------|******|....</span>
<a name="l00655"></a>00655 <span class="comment">         *    offset      |-stride_pages-|-stride_gap-|</span>
<a name="l00656"></a>00656 <span class="comment">         * ras_stride_offset = offset;</span>
<a name="l00657"></a>00657 <span class="comment">         * ras_stride_length = stride_pages + stride_gap;</span>
<a name="l00658"></a>00658 <span class="comment">         * ras_stride_pages = stride_pages;</span>
<a name="l00659"></a>00659 <span class="comment">         * Note: all these three items are counted by pages.</span>
<a name="l00660"></a>00660 <span class="comment">         */</span>
<a name="l00661"></a><a class="code" href="structll__readahead__state.html#adb3cca04a10e8d997787ef6f20de6545">00661</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#adb3cca04a10e8d997787ef6f20de6545">ras_stride_length</a>;
<a name="l00662"></a><a class="code" href="structll__readahead__state.html#aa96161b235f555cc0e33a2f7c2bc59fc">00662</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#aa96161b235f555cc0e33a2f7c2bc59fc">ras_stride_pages</a>;
<a name="l00663"></a><a class="code" href="structll__readahead__state.html#accf5b4929516314c871f4450d823244f">00663</a>         pgoff_t         <a class="code" href="structll__readahead__state.html#accf5b4929516314c871f4450d823244f">ras_stride_offset</a>;
<a name="l00664"></a>00664         <span class="comment">/*</span>
<a name="l00665"></a>00665 <span class="comment">         * number of consecutive stride request count, and it is similar as</span>
<a name="l00666"></a>00666 <span class="comment">         * ras_consecutive_requests, but used for stride I/O mode.</span>
<a name="l00667"></a>00667 <span class="comment">         * Note: only more than 2 consecutive stride request are detected,</span>
<a name="l00668"></a>00668 <span class="comment">         * stride read-ahead will be enable</span>
<a name="l00669"></a>00669 <span class="comment">         */</span>
<a name="l00670"></a><a class="code" href="structll__readahead__state.html#aa15c33312130e978024447293b629cde">00670</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="structll__readahead__state.html#aa15c33312130e978024447293b629cde">ras_consecutive_stride_requests</a>;
<a name="l00671"></a>00671 };
<a name="l00672"></a>00672 
<a name="l00673"></a>00673 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="llite__internal_8h.html#a24c8e0d3a5c045fe2af0114ff0afb629">ll_file_data_slab</a>;
<a name="l00674"></a>00674 <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>;
<a name="l00675"></a><a class="code" href="structll__file__data.html">00675</a> <span class="keyword">struct </span><a class="code" href="structll__file__data.html">ll_file_data</a> {
<a name="l00676"></a><a class="code" href="structll__file__data.html#ab4cf6ca649dac7a2006ba6df58afb4ea">00676</a>         <span class="keyword">struct </span><a class="code" href="structll__readahead__state.html">ll_readahead_state</a> <a class="code" href="structll__file__data.html#ab4cf6ca649dac7a2006ba6df58afb4ea">fd_ras</a>;
<a name="l00677"></a><a class="code" href="structll__file__data.html#a0d100df16fc54cdfda6b64725d814848">00677</a>         <span class="keyword">struct </span><a class="code" href="structll__grouplock.html">ll_grouplock</a> <a class="code" href="structll__file__data.html#a0d100df16fc54cdfda6b64725d814848">fd_grouplock</a>;
<a name="l00678"></a><a class="code" href="structll__file__data.html#a62905c12fd4aae0432f3bf35fe51483a">00678</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structll__file__data.html#a62905c12fd4aae0432f3bf35fe51483a">lfd_pos</a>;
<a name="l00679"></a><a class="code" href="structll__file__data.html#a1ca772c352d7461a07dabf7b7bb4b663">00679</a>         __u32 <a class="code" href="structll__file__data.html#a1ca772c352d7461a07dabf7b7bb4b663">fd_flags</a>;
<a name="l00680"></a><a class="code" href="structll__file__data.html#a9499943e1bbb736f978146cdf1eb78c9">00680</a>         fmode_t <a class="code" href="structll__file__data.html#a9499943e1bbb736f978146cdf1eb78c9">fd_omode</a>;
<a name="l00681"></a>00681         <span class="comment">/* openhandle if lease exists for this file.</span>
<a name="l00682"></a>00682 <span class="comment">         * Borrow lli-&gt;lli_och_mutex to protect assignment */</span>
<a name="l00683"></a><a class="code" href="structll__file__data.html#afb29c85989fab50645b382259c2dbbd0">00683</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a> *<a class="code" href="structll__file__data.html#afb29c85989fab50645b382259c2dbbd0">fd_lease_och</a>;
<a name="l00684"></a><a class="code" href="structll__file__data.html#aae1cfe6ea4534a4d38f23cdb4b0ca2a9">00684</a>         <span class="keyword">struct </span><a class="code" href="structobd__client__handle.html">obd_client_handle</a> *<a class="code" href="structll__file__data.html#aae1cfe6ea4534a4d38f23cdb4b0ca2a9">fd_och</a>;
<a name="l00685"></a><a class="code" href="structll__file__data.html#a8038923f9a41e2e24accdc500b464f90">00685</a>         <span class="keyword">struct </span>file *<a class="code" href="structll__file__data.html#a8038923f9a41e2e24accdc500b464f90">fd_file</a>;
<a name="l00686"></a>00686         <span class="comment">/* Indicate whether need to report failure when close.</span>
<a name="l00687"></a>00687 <span class="comment">         * true: failure is known, not report again.</span>
<a name="l00688"></a>00688 <span class="comment">         * false: unknown failure, should report. */</span>
<a name="l00689"></a><a class="code" href="structll__file__data.html#a304fc654a3d8507c97aa0a7e0f5c8f8c">00689</a>         <span class="keywordtype">bool</span> <a class="code" href="structll__file__data.html#a304fc654a3d8507c97aa0a7e0f5c8f8c">fd_write_failed</a>;
<a name="l00690"></a><a class="code" href="structll__file__data.html#a8db070c388520631f1f17ad8bd5e5331">00690</a>         rwlock_t <a class="code" href="structll__file__data.html#a8db070c388520631f1f17ad8bd5e5331">fd_lock</a>; <span class="comment">/* protect lcc list */</span>
<a name="l00691"></a><a class="code" href="structll__file__data.html#a6827e521276596fa89fbc6b3c08bce89">00691</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="structll__file__data.html#a6827e521276596fa89fbc6b3c08bce89">fd_lccs</a>; <span class="comment">/* list of ll_cl_context */</span>
<a name="l00692"></a>00692 };
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="keyword">extern</span> spinlock_t <a class="code" href="llite__internal_8h.html#a280e1318a152cb884738e4c77707e854">inode_lock</a>;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="keyword">extern</span> <span class="keyword">struct </span>proc_dir_entry *<a class="code" href="llite__internal_8h.html#a25d43acc21a631ce37899a7125cb2e3e">proc_lustre_fs_root</a>;
<a name="l00697"></a>00697 
<a name="l00698"></a><a class="code" href="llite__internal_8h.html#a3e8acbfa01c5874f2ae5d756400200f1">00698</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>inode *<a class="code" href="llite__internal_8h.html#a3e8acbfa01c5874f2ae5d756400200f1">ll_info2i</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli)
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700         <span class="keywordflow">return</span> &amp;lli-&gt;<a class="code" href="structll__inode__info.html#a392ab1dfe4b74a5e3ad4d6b706739eb1">lli_vfs_inode</a>;
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 __u32 <a class="code" href="llite__internal_8h.html#ad06fcb09475df35ba344d75382a5e943">ll_i2suppgid</a>(<span class="keyword">struct</span> inode *i);
<a name="l00704"></a>00704 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#aa4142ff4ff3ad9e24b381d4564744be6">ll_i2gids</a>(__u32 *suppgids, <span class="keyword">struct</span> inode *i1,<span class="keyword">struct</span> inode *i2);
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="llite__internal_8h.html#a8510c6afefff08b9f3752f3599b155b7">00706</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a8510c6afefff08b9f3752f3599b155b7">ll_need_32bit_api</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi)
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708 <span class="preprocessor">#if BITS_PER_LONG == 32</span>
<a name="l00709"></a>00709 <span class="preprocessor"></span>        <span class="keywordflow">return</span> 1;
<a name="l00710"></a>00710 <span class="preprocessor">#elif defined(CONFIG_COMPAT)</span>
<a name="l00711"></a>00711 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(is_compat_task() || (sbi-&gt;<a class="code" href="structll__sb__info.html#a061ecc4031c73d1bdcc404752b53e300">ll_flags</a> &amp; <a class="code" href="llite__internal_8h.html#a9da8fe91e5eb1427355b4cb1e5608883">LL_SBI_32BIT_API</a>));
<a name="l00712"></a>00712 <span class="preprocessor">#else</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(sbi-&gt;<a class="code" href="structll__sb__info.html#a061ecc4031c73d1bdcc404752b53e300">ll_flags</a> &amp; <a class="code" href="llite__internal_8h.html#a9da8fe91e5eb1427355b4cb1e5608883">LL_SBI_32BIT_API</a>);
<a name="l00714"></a>00714 <span class="preprocessor">#endif</span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>}
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a5eff0015062b1ba269ef6c0d7b32a4e0">ll_ras_enter</a>(<span class="keyword">struct</span> file *f);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="comment">/* llite/lcommon_misc.c */</span>
<a name="l00720"></a>00720 <span class="keywordtype">int</span> <a class="code" href="lcommon__misc_8c.html#a68f09c5d0805b6bf8d5e0f323900c9a0" title="This function is used as an upcall-callback hooked by liblustre and llite clients...">cl_ocd_update</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *host, <span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *watched,
<a name="l00721"></a>00721                   <span class="keyword">enum</span> <a class="code" href="obd_8h.html#a2edf5111b5e48090a5f07f11a420c5cc">obd_notify_event</a> ev, <span class="keywordtype">void</span> *owner, <span class="keywordtype">void</span> *data);
<a name="l00722"></a>00722 <span class="keywordtype">int</span> <a class="code" href="lcommon__misc_8c.html#a373733bddc1a55f1cf035d34dcabe2a2">cl_get_grouplock</a>(<span class="keyword">struct</span> <a class="code" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a> *obj, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> gid, <span class="keywordtype">int</span> nonblock,
<a name="l00723"></a>00723                      <span class="keyword">struct</span> <a class="code" href="structll__grouplock.html">ll_grouplock</a> *lg);
<a name="l00724"></a>00724 <span class="keywordtype">void</span> <a class="code" href="lcommon__misc_8c.html#a033cfe6fdb3ff72dc6fbaf2081d67f38">cl_put_grouplock</a>(<span class="keyword">struct</span> <a class="code" href="structll__grouplock.html">ll_grouplock</a> *lg);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="comment">/* llite/lproc_llite.c */</span>
<a name="l00727"></a>00727 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00728"></a>00728 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ab90ccf04cc8471cd8a4279f124e69b89">lprocfs_register_mountpoint</a>(<span class="keyword">struct</span> proc_dir_entry *parent,
<a name="l00729"></a>00729                                 <span class="keyword">struct</span> super_block *sb, <span class="keywordtype">char</span> *osc, <span class="keywordtype">char</span> *mdc);
<a name="l00730"></a>00730 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a783edf5148d4eed0f10602aa8c4a2dae">lprocfs_unregister_mountpoint</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi);
<a name="l00731"></a>00731 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ad13e8595f0029594dbc5d3d95842ee84">ll_stats_ops_tally</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, <span class="keywordtype">int</span> count);
<a name="l00732"></a>00732 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a> lprocfs_llite_obd_vars[];
<a name="l00733"></a>00733 <span class="preprocessor">#else</span>
<a name="l00734"></a><a class="code" href="llite__internal_8h.html#ab90ccf04cc8471cd8a4279f124e69b89">00734</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ab90ccf04cc8471cd8a4279f124e69b89">lprocfs_register_mountpoint</a>(<span class="keyword">struct</span> proc_dir_entry *parent,
<a name="l00735"></a>00735                         <span class="keyword">struct</span> super_block *sb, <span class="keywordtype">char</span> *osc, <span class="keywordtype">char</span> *mdc){<span class="keywordflow">return</span> 0;}
<a name="l00736"></a><a class="code" href="llite__internal_8h.html#a783edf5148d4eed0f10602aa8c4a2dae">00736</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a783edf5148d4eed0f10602aa8c4a2dae">lprocfs_unregister_mountpoint</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi) {}
<a name="l00737"></a><a class="code" href="llite__internal_8h.html#ad13e8595f0029594dbc5d3d95842ee84">00737</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ad13e8595f0029594dbc5d3d95842ee84">ll_stats_ops_tally</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">int</span> <a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, <span class="keywordtype">int</span> count) {}
<a name="l00738"></a>00738 <span class="preprocessor">#endif</span>
<a name="l00739"></a>00739 <span class="preprocessor"></span>
<a name="l00740"></a>00740 <span class="keyword">enum</span> {
<a name="l00741"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a10fc3eecea75a4f377608f88ea9f41a1">00741</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a10fc3eecea75a4f377608f88ea9f41a1">LPROC_LL_DIRTY_HITS</a>,
<a name="l00742"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5d1dc2423112ec6c318ae2b333752ca5">00742</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5d1dc2423112ec6c318ae2b333752ca5">LPROC_LL_DIRTY_MISSES</a>,
<a name="l00743"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a35163d9f80b8a97248dd9b18862637d9">00743</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a35163d9f80b8a97248dd9b18862637d9">LPROC_LL_READ_BYTES</a>,
<a name="l00744"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6611d270ecc14fa3f6f832e8046c0e51">00744</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6611d270ecc14fa3f6f832e8046c0e51">LPROC_LL_WRITE_BYTES</a>,
<a name="l00745"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5acda908e9e8b6dc399e62a515c0785f5e">00745</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5acda908e9e8b6dc399e62a515c0785f5e">LPROC_LL_BRW_READ</a>,
<a name="l00746"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6e524705543627c62dcba8f6f4cb8192">00746</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6e524705543627c62dcba8f6f4cb8192">LPROC_LL_BRW_WRITE</a>,
<a name="l00747"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5ca0f57bc8656c6e61e42cf70d4c3f8f">00747</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5ca0f57bc8656c6e61e42cf70d4c3f8f">LPROC_LL_IOCTL</a>,
<a name="l00748"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a2089d782bbdf9dbf551968c25b7a3759">00748</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a2089d782bbdf9dbf551968c25b7a3759">LPROC_LL_OPEN</a>,
<a name="l00749"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a1d9e23a7ad0aebb7e3c121e5ce50e86e">00749</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a1d9e23a7ad0aebb7e3c121e5ce50e86e">LPROC_LL_RELEASE</a>,
<a name="l00750"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a19c470e771adaba6439733773e2f1ce4">00750</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a19c470e771adaba6439733773e2f1ce4">LPROC_LL_MAP</a>,
<a name="l00751"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ab6a8328498bc4f672575a2ca9dacbdd3">00751</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ab6a8328498bc4f672575a2ca9dacbdd3">LPROC_LL_LLSEEK</a>,
<a name="l00752"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6fc0199e5f939f03d70609a83e0007b6">00752</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6fc0199e5f939f03d70609a83e0007b6">LPROC_LL_FSYNC</a>,
<a name="l00753"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a72624b33849bc0afb0f8f965d09cab79">00753</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a72624b33849bc0afb0f8f965d09cab79">LPROC_LL_READDIR</a>,
<a name="l00754"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8b64e649a222aeb0927076643661f62f">00754</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8b64e649a222aeb0927076643661f62f">LPROC_LL_SETATTR</a>,
<a name="l00755"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ae2c0e6444a570b2c4c819b4da82b271c">00755</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ae2c0e6444a570b2c4c819b4da82b271c">LPROC_LL_TRUNC</a>,
<a name="l00756"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a0816b2f64dc599c3c61b75eeb6f4801d">00756</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a0816b2f64dc599c3c61b75eeb6f4801d">LPROC_LL_FLOCK</a>,
<a name="l00757"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ad058c51ca99a8c43d4b8c1f7fd2e5375">00757</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ad058c51ca99a8c43d4b8c1f7fd2e5375">LPROC_LL_GETATTR</a>,
<a name="l00758"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6cde60f2dd63e01584c9857d53e5c7fd">00758</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a6cde60f2dd63e01584c9857d53e5c7fd">LPROC_LL_CREATE</a>,
<a name="l00759"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a94973022e3e0e20295988608b5e783f6">00759</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a94973022e3e0e20295988608b5e783f6">LPROC_LL_LINK</a>,
<a name="l00760"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7e94435215592cd1f14d729dc04af627">00760</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7e94435215592cd1f14d729dc04af627">LPROC_LL_UNLINK</a>,
<a name="l00761"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a594de216296239651beb29171ea565b8">00761</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a594de216296239651beb29171ea565b8">LPROC_LL_SYMLINK</a>,
<a name="l00762"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a1132b7fdec2ce8bafe8b3d7196e9d406">00762</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a1132b7fdec2ce8bafe8b3d7196e9d406">LPROC_LL_MKDIR</a>,
<a name="l00763"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5024ea2b456a9bd3897d0a982838de18">00763</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a5024ea2b456a9bd3897d0a982838de18">LPROC_LL_RMDIR</a>,
<a name="l00764"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a05c04e3f80db98e7bc31072ecbef5785">00764</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a05c04e3f80db98e7bc31072ecbef5785">LPROC_LL_MKNOD</a>,
<a name="l00765"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5adc25a5e5e171cc3eacce08b423bc28aa">00765</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5adc25a5e5e171cc3eacce08b423bc28aa">LPROC_LL_RENAME</a>,
<a name="l00766"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8023763d45cacec1eb240804e0a4976c">00766</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8023763d45cacec1eb240804e0a4976c">LPROC_LL_STAFS</a>,
<a name="l00767"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a02bc24cc349ba8484baaa3c1c9fe255b">00767</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a02bc24cc349ba8484baaa3c1c9fe255b">LPROC_LL_ALLOC_INODE</a>,
<a name="l00768"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7cc4b0963fc5675b5cf7afb4d47cf3ec">00768</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7cc4b0963fc5675b5cf7afb4d47cf3ec">LPROC_LL_SETXATTR</a>,
<a name="l00769"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ae6cbbecb3bb25bff674a2bea31d6dafc">00769</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ae6cbbecb3bb25bff674a2bea31d6dafc">LPROC_LL_GETXATTR</a>,
<a name="l00770"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a198e03803acce858e5dfb54b954b79a8">00770</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a198e03803acce858e5dfb54b954b79a8">LPROC_LL_GETXATTR_HITS</a>,
<a name="l00771"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a0bdd1c8741cb11e98fff812dcb50e505">00771</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a0bdd1c8741cb11e98fff812dcb50e505">LPROC_LL_LISTXATTR</a>,
<a name="l00772"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8ce8fa82b4087d2a8216fdd24ce61a72">00772</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a8ce8fa82b4087d2a8216fdd24ce61a72">LPROC_LL_REMOVEXATTR</a>,
<a name="l00773"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ad8cdcdadf30fa01ed982efa690e83fb2">00773</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5ad8cdcdadf30fa01ed982efa690e83fb2">LPROC_LL_INODE_PERM</a>,
<a name="l00774"></a><a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7967b7d431451e4feffeff19926a3f7d">00774</a>         <a class="code" href="llite__internal_8h.html#a78372742882dccd1c13323dbd66c25c5a7967b7d431451e4feffeff19926a3f7d">LPROC_LL_FILE_OPCODES</a>
<a name="l00775"></a>00775 };
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="comment">/* llite/dir.c */</span>
<a name="l00778"></a><a class="code" href="structll__dir__chain.html">00778</a> <span class="keyword">struct </span><a class="code" href="structll__dir__chain.html">ll_dir_chain</a> {
<a name="l00779"></a>00779 };
<a name="l00780"></a>00780 
<a name="l00781"></a><a class="code" href="llite__internal_8h.html#a6ae4e23d2ebb99ffc9870bf8524c37c2">00781</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a6ae4e23d2ebb99ffc9870bf8524c37c2">ll_dir_chain_init</a>(<span class="keyword">struct</span> <a class="code" href="structll__dir__chain.html">ll_dir_chain</a> *chain)
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783 }
<a name="l00784"></a>00784 
<a name="l00785"></a><a class="code" href="llite__internal_8h.html#a545c50c16c49c23341bcdce18f0bcea0">00785</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a545c50c16c49c23341bcdce18f0bcea0">ll_dir_chain_fini</a>(<span class="keyword">struct</span> <a class="code" href="structll__dir__chain.html">ll_dir_chain</a> *chain)
<a name="l00786"></a>00786 {
<a name="l00787"></a>00787 }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span>file_operations <a class="code" href="dir_8c.html#a66da0db9bdc04362a81cc4fafe8b56b6">ll_dir_operations</a>;
<a name="l00790"></a>00790 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span>inode_operations <a class="code" href="llite__internal_8h.html#a8b1d8db001753cde6caea59cd2dadb98">ll_dir_inode_operations</a>;
<a name="l00791"></a>00791 <span class="preprocessor">#ifdef HAVE_DIR_CONTEXT</span>
<a name="l00792"></a>00792 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a0becafca92b5a5061f857d9d10844954">ll_dir_read</a>(<span class="keyword">struct</span> inode *inode, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *pos, <span class="keyword">struct</span> <a class="code" href="structmd__op__data.html">md_op_data</a> *op_data,
<a name="l00793"></a>00793                 <span class="keyword">struct</span> dir_context *ctx);
<a name="l00794"></a>00794 <span class="preprocessor">#else</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a0becafca92b5a5061f857d9d10844954">ll_dir_read</a>(<span class="keyword">struct</span> inode *inode, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *pos, <span class="keyword">struct</span> <a class="code" href="structmd__op__data.html">md_op_data</a> *op_data,
<a name="l00796"></a>00796                 <span class="keywordtype">void</span> *cookie, filldir_t filldir);
<a name="l00797"></a>00797 <span class="preprocessor">#endif</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a1aff8da586bd84f694e721478e32827a">ll_get_mdt_idx</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00799"></a>00799 <span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a4b67ef8b120e0ebe58224f0081232b0d">ll_get_mdt_idx_by_fid</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00800"></a>00800 <span class="keyword">struct </span>page *<a class="code" href="dir_8c.html#a252cd1012e3753c4add6cdd2cad85fd0">ll_get_dir_page</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keyword">struct</span> <a class="code" href="structmd__op__data.html">md_op_data</a> *op_data,
<a name="l00801"></a>00801                              <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> offset, <span class="keyword">struct</span> <a class="code" href="structll__dir__chain.html">ll_dir_chain</a> *chain);
<a name="l00802"></a>00802 <span class="keywordtype">void</span> <a class="code" href="dir_8c.html#a2cc8bab6f0014a701581e84a4010f9cd">ll_release_page</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> page *page, <span class="keywordtype">bool</span> <span class="keyword">remove</span>);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">/* llite/namei.c */</span>
<a name="l00805"></a>00805 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span>inode_operations <a class="code" href="llite__internal_8h.html#a2ace3db54f16548044764299fcf12808">ll_special_inode_operations</a>;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="keyword">struct </span>inode *<a class="code" href="llite__internal_8h.html#a67762f9d333c217f8701f14c5ad54987" title="Get an inode by inode number(), which is already instantiated by the intent lookup)...">ll_iget</a>(<span class="keyword">struct</span> super_block *sb, ino_t hash,
<a name="l00808"></a>00808                       <span class="keyword">struct</span> <a class="code" href="structlustre__md.html">lustre_md</a> *lic);
<a name="l00809"></a>00809 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a1ca6e14a2c1b6ccb32a6a1697c195c7b">ll_test_inode_by_fid</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> *opaque);
<a name="l00810"></a>00810 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#af71dd40c0f56909e141376df051b83b4">ll_md_blocking_ast</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *, <span class="keyword">struct</span> <a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *,
<a name="l00811"></a>00811                        <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flag);
<a name="l00812"></a>00812 <span class="keyword">struct </span>dentry *<a class="code" href="llite__internal_8h.html#a1b455f8f27f2053743d2132151148020">ll_splice_alias</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> dentry *de);
<a name="l00813"></a>00813 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ae8b23eb678ce4a112ea066d3d85e0a6a" title="Remove dir entry.">ll_rmdir_entry</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> namelen);
<a name="l00814"></a>00814 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a325a963199843daf62a0be9476853918">ll_update_times</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *request, <span class="keyword">struct</span> inode *inode);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="comment">/* llite/rw.c */</span>
<a name="l00817"></a>00817 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ab51b68b2e83fe6eaaa9671ab2ea6d99e">ll_writepage</a>(<span class="keyword">struct</span> page *page, <span class="keyword">struct</span> writeback_control *wbc);
<a name="l00818"></a>00818 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ae51a60b4d6ef300160f3c41a4614eb33">ll_writepages</a>(<span class="keyword">struct</span> address_space *, <span class="keyword">struct</span> writeback_control *wbc);
<a name="l00819"></a>00819 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a954d6fff50ef9df0e978ef4db6e6298b">ll_readpage</a>(<span class="keyword">struct</span> file *file, <span class="keyword">struct</span> page *page);
<a name="l00820"></a>00820 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#aacf57a431690a9a58fb22aa716db9a08">ll_readahead_init</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structll__readahead__state.html">ll_readahead_state</a> *ras);
<a name="l00821"></a>00821 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#accb15db357042724b04ac2f7adb84c0b">vvp_io_write_commit</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structcl__io.html" title="State for io.">cl_io</a> *io);
<a name="l00822"></a>00822 <span class="keyword">struct </span><a class="code" href="structll__cl__context.html">ll_cl_context</a> *<a class="code" href="llite__internal_8h.html#ab2510a81624583c2ff2079393f3eb777">ll_cl_find</a>(<span class="keyword">struct</span> file *file);
<a name="l00823"></a>00823 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a2d954b94b6e6471c84e342f51b54cbdc">ll_cl_add</a>(<span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structcl__io.html" title="State for io.">cl_io</a> *io);
<a name="l00824"></a>00824 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a07e77793bd039002b79432ec45cfc729">ll_cl_remove</a>(<span class="keyword">struct</span> file *file, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span>address_space_operations <a class="code" href="llite__internal_8h.html#a802bf4948753b0ded7dd2dd9c2b386f5">ll_aops</a>;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="comment">/* llite/file.c */</span>
<a name="l00829"></a>00829 <span class="keyword">extern</span> <span class="keyword">struct </span>file_operations <a class="code" href="file_8c.html#aad68d2b9148120523f1e46bee31b14f9">ll_file_operations</a>;
<a name="l00830"></a>00830 <span class="keyword">extern</span> <span class="keyword">struct </span>file_operations <a class="code" href="file_8c.html#a74663ca5f06b4393f96e5001777ae1b7">ll_file_operations_flock</a>;
<a name="l00831"></a>00831 <span class="keyword">extern</span> <span class="keyword">struct </span>file_operations <a class="code" href="file_8c.html#a6e4db99bf8de8ce8e24f2c753782dca0">ll_file_operations_noflock</a>;
<a name="l00832"></a>00832 <span class="keyword">extern</span> <span class="keyword">struct </span>inode_operations <a class="code" href="file_8c.html#a7ded3b43962e9fd8fba0087cc7faaa90">ll_file_inode_operations</a>;
<a name="l00833"></a>00833 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a0617074fd91a394b5e385f7006093058" title="test if some locks matching bits and l_req_mode are acquiredbits can be in different...">ll_have_md_lock</a>(<span class="keyword">struct</span> inode *inode, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *bits,
<a name="l00834"></a>00834                            <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> l_req_mode);
<a name="l00835"></a>00835 <span class="keyword">extern</span> <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="file_8c.html#afae34889a41cb38904550a02c82e5f99">ll_take_md_lock</a>(<span class="keyword">struct</span> inode *inode, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> bits,
<a name="l00836"></a>00836                                       <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags,
<a name="l00837"></a>00837                                       <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#aa74dd0b574db12023c97215de31d0637">ll_file_open</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file);
<a name="l00840"></a>00840 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a3bc9157679435b46f834741207896073">ll_file_release</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file);
<a name="l00841"></a>00841 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#ac6d1485bf1884fea2c285563aae2da51" title="Close inode open handle.">ll_release_openhandle</a>(<span class="keyword">struct</span> dentry *, <span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *);
<a name="l00842"></a>00842 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a72ad5fc7204977ef854b59c40575fe9f">ll_md_real_close</a>(<span class="keyword">struct</span> inode *inode, fmode_t fmode);
<a name="l00843"></a>00843 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a59de7dff1c456d2f9f567e9faa7d980d">ll_rw_stats_tally</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, pid_t pid,
<a name="l00844"></a>00844                               <span class="keyword">struct</span> <a class="code" href="structll__file__data.html">ll_file_data</a> *file, loff_t pos,
<a name="l00845"></a>00845                               <span class="keywordtype">size_t</span> count, <span class="keywordtype">int</span> rw);
<a name="l00846"></a>00846 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a296d53393c74f49054fedce6acac8e13">ll_getattr</a>(<span class="keyword">struct</span> vfsmount *mnt, <span class="keyword">struct</span> dentry *de, <span class="keyword">struct</span> kstat *stat);
<a name="l00847"></a>00847 <span class="keyword">struct </span>posix_acl *<a class="code" href="file_8c.html#a17740e5b2534ad3be442f70217831e57">ll_get_acl</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> type);
<a name="l00848"></a>00848 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a3e57f029b18ca34827332b557080f850">ll_migrate</a>(<span class="keyword">struct</span> inode *parent, <span class="keyword">struct</span> file *file, <span class="keywordtype">int</span> mdtidx,
<a name="l00849"></a>00849                <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> namelen);
<a name="l00850"></a>00850 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a327b6b6b09b1c091a5c6dc05f1f41ad6">ll_get_fid_by_name</a>(<span class="keyword">struct</span> inode *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l00851"></a>00851                        <span class="keywordtype">int</span> namelen, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keyword">struct</span> inode **inode);
<a name="l00852"></a>00852 <span class="preprocessor">#ifdef HAVE_GENERIC_PERMISSION_4ARGS</span>
<a name="l00853"></a>00853 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a496700a533be84b5911e049b53eed9b2">ll_inode_permission</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> mask, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags);
<a name="l00854"></a>00854 <span class="preprocessor">#else</span>
<a name="l00855"></a>00855 <span class="preprocessor"></span><span class="preprocessor"># ifndef HAVE_INODE_PERMISION_2ARGS</span>
<a name="l00856"></a>00856 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a496700a533be84b5911e049b53eed9b2">ll_inode_permission</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> mask, <span class="keyword">struct</span> nameidata *nd);
<a name="l00857"></a>00857 <span class="preprocessor"># else</span>
<a name="l00858"></a>00858 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a496700a533be84b5911e049b53eed9b2">ll_inode_permission</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> mask);
<a name="l00859"></a>00859 <span class="preprocessor"># endif</span>
<a name="l00860"></a>00860 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00861"></a>00861 <span class="preprocessor"></span>
<a name="l00862"></a>00862 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a4c15cd8e9ec1c37f79d348837642cb33">ll_lov_setstripe_ea_info</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file,
<a name="l00863"></a>00863                              <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>  flags, <span class="keyword">struct</span> <a class="code" href="group__lustreuser.html#ga9c004c151be5b9c6f1886530cbd17136">lov_user_md</a> *lum,
<a name="l00864"></a>00864                              <span class="keywordtype">int</span> lum_size);
<a name="l00865"></a>00865 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a7bcdd1598909bde27c0ad103f39b76d2">ll_lov_getstripe_ea_info</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdsrate_8c.html#ab49244970ed5ca30989c2dab2129de34">filename</a>,
<a name="l00866"></a>00866                              <span class="keyword">struct</span> <a class="code" href="group__lustreidl.html#ga120d1e282e1d65132fbcd7f17ae908c7">lov_mds_md</a> **lmm, <span class="keywordtype">int</span> *lmm_size,
<a name="l00867"></a>00867                              <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **request);
<a name="l00868"></a>00868 <span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a1d2e95c2fe9223c7f6217cebd9dfb422">ll_dir_setstripe</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="group__lustreuser.html#ga9c004c151be5b9c6f1886530cbd17136">lov_user_md</a> *lump,
<a name="l00869"></a>00869                      <span class="keywordtype">int</span> set_default);
<a name="l00870"></a>00870 <span class="keywordtype">int</span> <a class="code" href="dir_8c.html#a61a3bfb99fbd368040679a9f59d8ba7b" title="This function will be used to get default LOV/LMV/Default LMV  will be used to indicate...">ll_dir_getstripe</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> **lmmp,
<a name="l00871"></a>00871                      <span class="keywordtype">int</span> *lmm_size, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **request,
<a name="l00872"></a>00872                      u64 valid);
<a name="l00873"></a>00873 <span class="preprocessor">#ifdef HAVE_FILE_FSYNC_4ARGS</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a6a8a62adc93b58d6b8a8fa595a679d23">ll_fsync</a>(<span class="keyword">struct</span> file *file, loff_t <a class="code" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>, loff_t <a class="code" href="mdsrate_8c.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>, <span class="keywordtype">int</span> data);
<a name="l00875"></a>00875 <span class="preprocessor">#elif defined(HAVE_FILE_FSYNC_2ARGS)</span>
<a name="l00876"></a>00876 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a6a8a62adc93b58d6b8a8fa595a679d23">ll_fsync</a>(<span class="keyword">struct</span> file *file, <span class="keywordtype">int</span> data);
<a name="l00877"></a>00877 <span class="preprocessor">#else</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a6a8a62adc93b58d6b8a8fa595a679d23">ll_fsync</a>(<span class="keyword">struct</span> file *file, <span class="keyword">struct</span> dentry *dentry, <span class="keywordtype">int</span> data);
<a name="l00879"></a>00879 <span class="preprocessor">#endif</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="file_8c.html#a3bedf7e284e40a33585ec35c11696e6e">ll_merge_attr</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> inode *inode);
<a name="l00881"></a>00881 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#ab25c22981eeca3484266cc0c4180a85f">ll_fid2path</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *arg);
<a name="l00882"></a>00882 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a2042771d3fe6ff450d5ce477a8631d4e">ll_data_version</a>(<span class="keyword">struct</span> inode *inode, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *data_version, <span class="keywordtype">int</span> flags);
<a name="l00883"></a>00883 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#ae2c997e354bc1e8c1224401aaf17a54a">ll_hsm_release</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00884"></a>00884 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a351d7d449bcc0980c68009f8206eba37">ll_hsm_state_set</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structhsm__state__set.html">hsm_state_set</a> *hss);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 <span class="comment">/* llite/dcache.c */</span>
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 <span class="keywordtype">int</span> <a class="code" href="dcache_8c.html#aa01eba068384399c49be7347a116595e">ll_d_init</a>(<span class="keyword">struct</span> dentry *de);
<a name="l00889"></a>00889 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span>dentry_operations <a class="code" href="dcache_8c.html#a519b233462b53aec180d34da236ca55a">ll_d_ops</a>;
<a name="l00890"></a>00890 <span class="keywordtype">void</span> <a class="code" href="dcache_8c.html#a69e35e19f520e51dc46bd97a7721ebf1">ll_intent_drop_lock</a>(<span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *);
<a name="l00891"></a>00891 <span class="keywordtype">void</span> <a class="code" href="dcache_8c.html#a9024654ab9e3ef7cf259744a2e242cb8">ll_intent_release</a>(<span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *);
<a name="l00892"></a>00892 <span class="keywordtype">void</span> <a class="code" href="dcache_8c.html#aa4c4fd6c24125ea068a32608646875f6">ll_invalidate_aliases</a>(<span class="keyword">struct</span> inode *);
<a name="l00893"></a>00893 <span class="keywordtype">void</span> <a class="code" href="dcache_8c.html#a0f47424b8bfd9f83f2f383a9a991c751">ll_lookup_finish_locks</a>(<span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *it, <span class="keyword">struct</span> dentry *dentry);
<a name="l00894"></a>00894 <span class="keywordtype">int</span> <a class="code" href="dcache_8c.html#a6620129f328a87c61d97bda32fed1013">ll_revalidate_it_finish</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *request,
<a name="l00895"></a>00895                             <span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *it, <span class="keyword">struct</span> dentry *de);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="comment">/* llite/llite_lib.c */</span>
<a name="l00898"></a>00898 <span class="keyword">extern</span> <span class="keyword">struct </span>super_operations <a class="code" href="llite__internal_8h.html#a288c28bc3c4379c04b481aab90788909">lustre_super_operations</a>;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ad11f393f43587a307c26829e92fa1a6b">ll_lli_init</a>(<span class="keyword">struct</span> <a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli);
<a name="l00901"></a>00901 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a7673d784531bda14764e2a0465706768">ll_fill_super</a>(<span class="keyword">struct</span> super_block *sb, <span class="keyword">struct</span> vfsmount *mnt);
<a name="l00902"></a>00902 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ace6db7b23947bd7496447b92f298d7f1">ll_put_super</a>(<span class="keyword">struct</span> super_block *sb);
<a name="l00903"></a>00903 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a81737fb362933b0a82b52b804b130557">ll_kill_super</a>(<span class="keyword">struct</span> super_block *sb);
<a name="l00904"></a>00904 <span class="keyword">struct </span>inode *<a class="code" href="llite__internal_8h.html#aa2ed3a253197ec8b6e64dacb60b15ebb">ll_inode_from_resource_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l00905"></a>00905 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a2c59539fb5b0038072dc3b1163f8c638">ll_dir_clear_lsm_md</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00906"></a>00906 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ab33370f0705f2f02dbb8793c99967d55">ll_clear_inode</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00907"></a>00907 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a2a049f3fb15b3dfea40ada349ad7fdad">ll_setattr_raw</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keyword">struct</span> iattr *attr, <span class="keywordtype">bool</span> hsm_import);
<a name="l00908"></a>00908 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ac81bde41cf4fce997db9e8cf78f6560d">ll_setattr</a>(<span class="keyword">struct</span> dentry *de, <span class="keyword">struct</span> iattr *attr);
<a name="l00909"></a>00909 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ab38723c6de014284c7694e8549b62397">ll_statfs</a>(<span class="keyword">struct</span> dentry *de, <span class="keyword">struct</span> kstatfs *sfs);
<a name="l00910"></a>00910 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a6fd6bbfa4c71d6b7e9bb61bbe6cc152a">ll_statfs_internal</a>(<span class="keyword">struct</span> super_block *sb, <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs,
<a name="l00911"></a>00911                        <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> max_age, __u32 flags);
<a name="l00912"></a>00912 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a0c83fc048ec23ee1e5ae3405a11ba7c9">ll_update_inode</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structlustre__md.html">lustre_md</a> *md);
<a name="l00913"></a>00913 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a8054a805e5eed9d641d0333b4a3730a7">ll_read_inode2</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> *opaque);
<a name="l00914"></a>00914 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ae06f04ca6e5b53ec7fcb09522c69145c">ll_delete_inode</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00915"></a>00915 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a0f09966d3bf8534f9d60f538d2bc803e">ll_iocontrol</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file,
<a name="l00916"></a>00916                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg);
<a name="l00917"></a>00917 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#aec141ad5af48251642ee56c44b47d7b2">ll_flush_ctx</a>(<span class="keyword">struct</span> inode *inode);
<a name="l00918"></a>00918 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ab7e27b5664ac237ef50beca85e485ff3">ll_umount_begin</a>(<span class="keyword">struct</span> super_block *sb);
<a name="l00919"></a>00919 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a61d8c2a9c5d6f307cefb51e647b580e2">ll_remount_fs</a>(<span class="keyword">struct</span> super_block *sb, <span class="keywordtype">int</span> *flags, <span class="keywordtype">char</span> *data);
<a name="l00920"></a>00920 <span class="preprocessor">#ifdef HAVE_SUPEROPS_USE_DENTRY</span>
<a name="l00921"></a>00921 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a38ba3176166b3ec769e5f960f57e1083">ll_show_options</a>(<span class="keyword">struct</span> seq_file *seq, <span class="keyword">struct</span> dentry *dentry);
<a name="l00922"></a>00922 <span class="preprocessor">#else</span>
<a name="l00923"></a>00923 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a38ba3176166b3ec769e5f960f57e1083">ll_show_options</a>(<span class="keyword">struct</span> seq_file *seq, <span class="keyword">struct</span> vfsmount *vfs);
<a name="l00924"></a>00924 <span class="preprocessor">#endif</span>
<a name="l00925"></a>00925 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a5737589ff8d20ea6b350f56feb52d2a8">ll_dirty_page_discard_warn</a>(<span class="keyword">struct</span> page *page, <span class="keywordtype">int</span> ioret);
<a name="l00926"></a>00926 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ad39fdc29c590800d9ba10fba0b1340df">ll_prep_inode</a>(<span class="keyword">struct</span> inode **inode, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l00927"></a>00927                   <span class="keyword">struct</span> super_block *, <span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *);
<a name="l00928"></a>00928 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a8b4508b974dacb1648d4a596ec193334">lustre_dump_dentry</a>(<span class="keyword">struct</span> dentry *, <span class="keywordtype">int</span> recur);
<a name="l00929"></a>00929 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a0e2156f693404fcbdcddd320eb7cc416">ll_obd_statfs</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">void</span> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *arg);
<a name="l00930"></a>00930 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a2ba125c7b3be17c263ca8eb17c5ba690">ll_get_max_mdsize</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">int</span> *max_mdsize);
<a name="l00931"></a>00931 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a377617c867af0404164a0149829b3053" title="Get the value of the default_easize parameter.">ll_get_default_mdsize</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">int</span> *default_mdsize);
<a name="l00932"></a>00932 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a2d890ae195c71fefd28f32b41c3f757b" title="Set the default_easize parameter to the given value.">ll_set_default_mdsize</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">int</span> default_mdsize);
<a name="l00933"></a>00933 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ac07a332d168e4dab8ee5144d049d1ce1">ll_process_config</a>(<span class="keyword">struct</span> <a class="code" href="structlustre__cfg.html">lustre_cfg</a> *lcfg);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 <span class="keyword">enum</span> {
<a name="l00936"></a><a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26a6486061a49fcca4e3a8241a16f04196d">00936</a>         <a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26a6486061a49fcca4e3a8241a16f04196d">LUSTRE_OPC_MKDIR</a>        = 0,
<a name="l00937"></a><a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26ae25538788bfa0ff46b7bac07fac97753">00937</a>         <a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26ae25538788bfa0ff46b7bac07fac97753">LUSTRE_OPC_SYMLINK</a>      = 1,
<a name="l00938"></a><a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26abb01e96fce3d59ce948319513fbc99a0">00938</a>         <a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26abb01e96fce3d59ce948319513fbc99a0">LUSTRE_OPC_MKNOD</a>        = 2,
<a name="l00939"></a><a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26a5b9ba5736e91aa046be67322c94ee376">00939</a>         <a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26a5b9ba5736e91aa046be67322c94ee376">LUSTRE_OPC_CREATE</a>       = 3,
<a name="l00940"></a><a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26ab00f57fd8f623a54019762e13517d55a">00940</a>         <a class="code" href="llite__internal_8h.html#a2d5492e116eebd5075f247d21fb9db26ab00f57fd8f623a54019762e13517d55a">LUSTRE_OPC_ANY</a>          = 5,
<a name="l00941"></a>00941 };
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 <span class="keyword">struct </span><a class="code" href="structmd__op__data.html">md_op_data</a> *<a class="code" href="llite__internal_8h.html#ac34edcba0eb7e2d7a41584440be3499e">ll_prep_md_op_data</a>(<span class="keyword">struct</span> <a class="code" href="structmd__op__data.html">md_op_data</a> *<a class="code" href="structmd__op__data.html#a92923c286cac10ce4ddf7d7fe499843a">op_data</a>,
<a name="l00944"></a>00944                                       <span class="keyword">struct</span> inode *i1, <span class="keyword">struct</span> inode *i2,
<a name="l00945"></a>00945                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">size_t</span> namelen,
<a name="l00946"></a>00946                                       __u32 <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, __u32 opc, <span class="keywordtype">void</span> *data);
<a name="l00947"></a>00947 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a0c828a482695c0557ded62b65a6be7b2">ll_finish_md_op_data</a>(<span class="keyword">struct</span> <a class="code" href="structmd__op__data.html">md_op_data</a> *<a class="code" href="structmd__op__data.html#a92923c286cac10ce4ddf7d7fe499843a">op_data</a>);
<a name="l00948"></a>00948 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a63fa10176838849f668887fd5c3d96f3" title="Get obd name by cmd, and copy out to user space.">ll_get_obd_name</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg);
<a name="l00949"></a>00949 <span class="keywordtype">char</span> *<a class="code" href="llite__internal_8h.html#a062f0e61f0787610659db3043a5d09b7" title="Get lustre file system name by sbi.">ll_get_fsname</a>(<span class="keyword">struct</span> super_block *sb, <span class="keywordtype">char</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> buflen);
<a name="l00950"></a>00950 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ac07ff1ce7034ec5bdd36270bc6653c32">ll_compute_rootsquash_state</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi);
<a name="l00951"></a>00951 ssize_t <a class="code" href="llite__internal_8h.html#a31b312e1b507acc0deab34d5285bdbc1">ll_copy_user_md</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__lustreuser.html#ga9c004c151be5b9c6f1886530cbd17136">lov_user_md</a> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *md,
<a name="l00952"></a>00952                         <span class="keyword">struct</span> <a class="code" href="group__lustreuser.html#ga9c004c151be5b9c6f1886530cbd17136">lov_user_md</a> **kbuf);
<a name="l00953"></a>00953 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ac9048a4b57925e73e4dd683c9ac49d6b" title="Cleanup the open handle that is cached on MDT-side.">ll_open_cleanup</a>(<span class="keyword">struct</span> super_block *sb, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *open_req);
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 <span class="comment">/* Compute expected user md size when passing in a md from user space */</span>
<a name="l00956"></a><a class="code" href="llite__internal_8h.html#a58971844ce0812389da55df867a7b942">00956</a> <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t <a class="code" href="llite__internal_8h.html#a58971844ce0812389da55df867a7b942">ll_lov_user_md_size</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="group__lustreuser.html#ga9c004c151be5b9c6f1886530cbd17136">lov_user_md</a> *lum)
<a name="l00957"></a>00957 {
<a name="l00958"></a>00958         <span class="keywordflow">switch</span> (lum-&gt;lmm_magic) {
<a name="l00959"></a>00959         <span class="keywordflow">case</span> <a class="code" href="group__lustreuser.html#ga81d55e6256b6cf7a4664d49f4d02928d">LOV_USER_MAGIC_V1</a>:
<a name="l00960"></a>00960                 <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structlov__user__md__v1.html">lov_user_md_v1</a>);
<a name="l00961"></a>00961         <span class="keywordflow">case</span> <a class="code" href="group__lustreuser.html#gade10fb540dbbc743f2a3140ca3bb4811">LOV_USER_MAGIC_V3</a>:
<a name="l00962"></a>00962                 <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structlov__user__md__v3.html">lov_user_md_v3</a>);
<a name="l00963"></a>00963         <span class="keywordflow">case</span> <a class="code" href="group__lustreuser.html#ga45d8f3dbfd52624efe358a3f3bd3057f">LOV_USER_MAGIC_SPECIFIC</a>:
<a name="l00964"></a>00964                 <span class="keywordflow">if</span> (lum-&gt;lmm_stripe_count &gt; <a class="code" href="group__lustreuser.html#ga75a3c7e4964e86373dae6fd732947acf">LOV_MAX_STRIPE_COUNT</a>)
<a name="l00965"></a>00965                         <span class="keywordflow">return</span> -EINVAL;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967                 <span class="keywordflow">return</span> <a class="code" href="group__lustreuser.html#gade3b274a79957505f7006249ff946451">lov_user_md_size</a>(lum-&gt;lmm_stripe_count,
<a name="l00968"></a>00968                                         <a class="code" href="group__lustreuser.html#ga45d8f3dbfd52624efe358a3f3bd3057f">LOV_USER_MAGIC_SPECIFIC</a>);
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971         <span class="keywordflow">return</span> -EINVAL;
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 <span class="comment">/* llite/llite_nfs.c */</span>
<a name="l00975"></a>00975 <span class="keyword">extern</span> <span class="keyword">struct </span>export_operations <a class="code" href="llite__internal_8h.html#aa4a76e066cd08f15344402af58a28c88">lustre_export_operations</a>;
<a name="l00976"></a>00976 __u32 <a class="code" href="llite__internal_8h.html#a5e4ed4a627c15c42fe260ab4d829c712">get_uuid2int</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> len);
<a name="l00977"></a>00977 <span class="keyword">struct </span>inode *<a class="code" href="llite__internal_8h.html#a03b77b30d2913350e95781764d04cca4">search_inode_for_lustre</a>(<span class="keyword">struct</span> super_block *sb,
<a name="l00978"></a>00978                                       <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l00979"></a>00979 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a4ff5f5e37a9bc5c89ace3bd469160cb9">ll_dir_get_parent_fid</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *parent_fid);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 <span class="comment">/* llite/symlink.c */</span>
<a name="l00982"></a>00982 <span class="keyword">extern</span> <span class="keyword">struct </span>inode_operations <a class="code" href="llite__internal_8h.html#a7346469d689ce5f44a46d1adb388ad2a">ll_fast_symlink_inode_operations</a>;
<a name="l00983"></a>00983 
<a name="l00987"></a><a class="code" href="structvvp__io__args.html">00987</a> <span class="keyword">struct </span><a class="code" href="structvvp__io__args.html" title="IO arguments for various VFS I/O interfaces.">vvp_io_args</a> {
<a name="l00989"></a><a class="code" href="structvvp__io__args.html#a4dbdc30e68d1afd9ec36494c96abb7c3">00989</a>         <span class="keyword">enum</span> <a class="code" href="vvp__internal_8h.html#a956f63e5aea746f0a9c9aac0f9f9ae9f">vvp_io_subtype</a> <a class="code" href="structvvp__io__args.html#a4dbdc30e68d1afd9ec36494c96abb7c3" title="normal/sendfile/splice">via_io_subtype</a>;
<a name="l00990"></a>00990 
<a name="l00991"></a>00991         <span class="keyword">union </span>{
<a name="l00992"></a>00992                 <span class="keyword">struct </span>{
<a name="l00993"></a><a class="code" href="structvvp__io__args.html#a01a2910b15db16796de472ff9de00069">00993</a>                         <span class="keyword">struct </span>kiocb      *<a class="code" href="structvvp__io__args.html#a01a2910b15db16796de472ff9de00069">via_iocb</a>;
<a name="l00994"></a><a class="code" href="structvvp__io__args.html#a08cd756385c18a533b0bb5f23f2bdaf4">00994</a>                         <span class="keyword">struct </span>iov_iter   *<a class="code" href="structvvp__io__args.html#a08cd756385c18a533b0bb5f23f2bdaf4">via_iter</a>;
<a name="l00995"></a>00995                 } <a class="code" href="structvvp__io__args.html#afb542a8545c8182d435167d2abc60851">normal</a>;
<a name="l00996"></a>00996                 <span class="keyword">struct </span>{
<a name="l00997"></a><a class="code" href="structvvp__io__args.html#a13935f10e6b46d95cdc2bedce6cbed66">00997</a>                         <span class="keyword">struct </span>pipe_inode_info  *<a class="code" href="structvvp__io__args.html#a13935f10e6b46d95cdc2bedce6cbed66">via_pipe</a>;
<a name="l00998"></a><a class="code" href="structvvp__io__args.html#ae0862f2c479c4a4cc07809eebb473e8e">00998</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>       <a class="code" href="structvvp__io__args.html#ae0862f2c479c4a4cc07809eebb473e8e">via_flags</a>;
<a name="l00999"></a>00999                 } <a class="code" href="structvvp__io__args.html#a05ab796973006da79fe006222a07091f">splice</a>;
<a name="l01000"></a>01000         } <a class="code" href="structvvp__io__args.html#ad97e675c591bead41d5751ce5309a4c0">u</a>;
<a name="l01001"></a>01001 };
<a name="l01002"></a>01002 
<a name="l01003"></a><a class="code" href="structll__cl__context.html">01003</a> <span class="keyword">struct </span><a class="code" href="structll__cl__context.html">ll_cl_context</a> {
<a name="l01004"></a><a class="code" href="structll__cl__context.html#aabbdadf624c67146bbdb7a35c2776cbb">01004</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structll__cl__context.html#aabbdadf624c67146bbdb7a35c2776cbb">lcc_list</a>;
<a name="l01005"></a><a class="code" href="structll__cl__context.html#a036ba57809d5ba050b954b3aa12e914c">01005</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structll__cl__context.html#a036ba57809d5ba050b954b3aa12e914c">lcc_cookie</a>;
<a name="l01006"></a><a class="code" href="structll__cl__context.html#a76d789534e3e7f23dc7b55b93d81c33d">01006</a>         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a>     *<a class="code" href="structll__cl__context.html#a76d789534e3e7f23dc7b55b93d81c33d">lcc_env</a>;
<a name="l01007"></a><a class="code" href="structll__cl__context.html#afad8c1d2676db26bc5b81d4fe10e1f01">01007</a>         <span class="keyword">struct </span><a class="code" href="structcl__io.html" title="State for io.">cl_io</a>            *<a class="code" href="structll__cl__context.html#afad8c1d2676db26bc5b81d4fe10e1f01">lcc_io</a>;
<a name="l01008"></a><a class="code" href="structll__cl__context.html#a135d6102b74a3ab27e7e1dd0db5e4555">01008</a>         <span class="keyword">struct </span><a class="code" href="structcl__page.html" title="Fields are protected by the lock on struct page, except for atomics and immutables...">cl_page</a>          *<a class="code" href="structll__cl__context.html#a135d6102b74a3ab27e7e1dd0db5e4555">lcc_page</a>;
<a name="l01009"></a>01009 };
<a name="l01010"></a>01010 
<a name="l01011"></a><a class="code" href="structll__thread__info.html">01011</a> <span class="keyword">struct </span><a class="code" href="structll__thread__info.html">ll_thread_info</a> {
<a name="l01012"></a><a class="code" href="structll__thread__info.html#abed5bc9daa06a36a5ad67384243e2c9a">01012</a>         <span class="keyword">struct </span>iovec            <a class="code" href="structll__thread__info.html#abed5bc9daa06a36a5ad67384243e2c9a">lti_local_iov</a>;
<a name="l01013"></a><a class="code" href="structll__thread__info.html#a2df3be1d0ab2357c3a6e2fd8b7f0dd87">01013</a>         <span class="keyword">struct </span><a class="code" href="structvvp__io__args.html" title="IO arguments for various VFS I/O interfaces.">vvp_io_args</a>      <a class="code" href="structll__thread__info.html#a2df3be1d0ab2357c3a6e2fd8b7f0dd87">lti_args</a>;
<a name="l01014"></a><a class="code" href="structll__thread__info.html#a7f5b39f17334a8675ff84297ec1fb2ff">01014</a>         <span class="keyword">struct </span><a class="code" href="structra__io__arg.html">ra_io_arg</a>        <a class="code" href="structll__thread__info.html#a7f5b39f17334a8675ff84297ec1fb2ff">lti_ria</a>;
<a name="l01015"></a><a class="code" href="structll__thread__info.html#adc876d5e8124fb87c1aacea0aa31e50d">01015</a>         <span class="keyword">struct </span>kiocb            <a class="code" href="structll__thread__info.html#adc876d5e8124fb87c1aacea0aa31e50d">lti_kiocb</a>;
<a name="l01016"></a><a class="code" href="structll__thread__info.html#a9cf93e3cbab71083e331984fb7ad3f58">01016</a>         <span class="keyword">struct </span><a class="code" href="structll__cl__context.html">ll_cl_context</a>    <a class="code" href="structll__thread__info.html#a9cf93e3cbab71083e331984fb7ad3f58">lti_io_ctx</a>;
<a name="l01017"></a>01017 };
<a name="l01018"></a>01018 
<a name="l01019"></a>01019 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__context__key.html" title="Key.">lu_context_key</a> <a class="code" href="llite__internal_8h.html#a09beb5a0817515c5efc7f8efc009e066">ll_thread_key</a>;
<a name="l01020"></a>01020 
<a name="l01021"></a><a class="code" href="llite__internal_8h.html#abc206592189aa72cb0c8596dd03e6536">01021</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structll__thread__info.html">ll_thread_info</a> *<a class="code" href="llite__internal_8h.html#abc206592189aa72cb0c8596dd03e6536">ll_env_info</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env)
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023         <span class="keyword">struct </span><a class="code" href="structll__thread__info.html">ll_thread_info</a> *lti;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025         lti = <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;<a class="code" href="llite__internal_8h.html#a09beb5a0817515c5efc7f8efc009e066">ll_thread_key</a>);
<a name="l01026"></a>01026         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(lti != NULL);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028         <span class="keywordflow">return</span> lti;
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01031"></a><a class="code" href="llite__internal_8h.html#ae93f574b0e1d47c7151fe47151eed81b">01031</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structvvp__io__args.html" title="IO arguments for various VFS I/O interfaces.">vvp_io_args</a> *<a class="code" href="llite__internal_8h.html#ae93f574b0e1d47c7151fe47151eed81b">ll_env_args</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01032"></a>01032                                               <span class="keyword">enum</span> <a class="code" href="vvp__internal_8h.html#a956f63e5aea746f0a9c9aac0f9f9ae9f">vvp_io_subtype</a> type)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034         <span class="keyword">struct </span><a class="code" href="structvvp__io__args.html" title="IO arguments for various VFS I/O interfaces.">vvp_io_args</a> *via = &amp;<a class="code" href="llite__internal_8h.html#abc206592189aa72cb0c8596dd03e6536">ll_env_info</a>(env)-&gt;<a class="code" href="structll__thread__info.html#a2df3be1d0ab2357c3a6e2fd8b7f0dd87">lti_args</a>;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036         via-&gt;<a class="code" href="structvvp__io__args.html#a4dbdc30e68d1afd9ec36494c96abb7c3" title="normal/sendfile/splice">via_io_subtype</a> = type;
<a name="l01037"></a>01037 
<a name="l01038"></a>01038         <span class="keywordflow">return</span> via;
<a name="l01039"></a>01039 }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041 <span class="comment">/* llite/llite_mmap.c */</span>
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a8d9439d2cabe466cddf9badbbd1da103">ll_teardown_mmaps</a>(<span class="keyword">struct</span> address_space *<a class="code" href="lsupport_8c.html#a204e0f2b3e5eb394897a119a9bf17b01">mapping</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> first, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> last);
<a name="l01044"></a>01044 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ad850d32388ed2bf59cb3e8027653ba9c">ll_file_mmap</a>(<span class="keyword">struct</span> file * file, <span class="keyword">struct</span> vm_area_struct * vma);
<a name="l01045"></a>01045 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a925cdc15265963168a4993a5d71d756a">policy_from_vma</a>(<span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy, <span class="keyword">struct</span> vm_area_struct *vma,
<a name="l01046"></a>01046                      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr, <span class="keywordtype">size_t</span> count);
<a name="l01047"></a>01047 <span class="keyword">struct </span>vm_area_struct *<a class="code" href="llite__internal_8h.html#a25cfecbc8c69892122b25b50200aabdc">our_vma</a>(<span class="keyword">struct</span> mm_struct *mm, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr,
<a name="l01048"></a>01048                                <span class="keywordtype">size_t</span> count);
<a name="l01049"></a>01049 
<a name="l01050"></a><a class="code" href="llite__internal_8h.html#a071fdf92c810e274b4ca070e56cae9fa">01050</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a071fdf92c810e274b4ca070e56cae9fa">ll_invalidate_page</a>(<span class="keyword">struct</span> page *vmpage)
<a name="l01051"></a>01051 {
<a name="l01052"></a>01052         <span class="keyword">struct </span>address_space *<a class="code" href="lsupport_8c.html#a204e0f2b3e5eb394897a119a9bf17b01">mapping</a> = vmpage-&gt;mapping;
<a name="l01053"></a>01053         loff_t offset = vmpage-&gt;index &lt;&lt; PAGE_CACHE_SHIFT;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(PageLocked(vmpage));
<a name="l01056"></a>01056         <span class="keywordflow">if</span> (mapping == NULL)
<a name="l01057"></a>01057                 <span class="keywordflow">return</span>;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059         <span class="comment">/*</span>
<a name="l01060"></a>01060 <span class="comment">         * truncate_complete_page() calls</span>
<a name="l01061"></a>01061 <span class="comment">         * a_ops-&gt;invalidatepage()-&gt;cl_page_delete()-&gt;vvp_page_delete().</span>
<a name="l01062"></a>01062 <span class="comment">         */</span>
<a name="l01063"></a>01063         <a class="code" href="llite__internal_8h.html#a8d9439d2cabe466cddf9badbbd1da103">ll_teardown_mmaps</a>(mapping, offset, offset + PAGE_CACHE_SIZE);
<a name="l01064"></a>01064         <a class="code" href="lustre__patchless__compat_8h.html#a3c53f8058e857f5da70d1d58e1349411">truncate_complete_page</a>(mapping, vmpage);
<a name="l01065"></a>01065 }
<a name="l01066"></a>01066 
<a name="l01067"></a><a class="code" href="llite__internal_8h.html#a87c04229045e7df803e165ec9b454bd4">01067</a> <span class="preprocessor">#define    ll_s2sbi(sb)        (s2lsi(sb)-&gt;lsi_llsbi)</span>
<a name="l01068"></a>01068 <span class="preprocessor"></span>
<a name="l01069"></a>01069 <span class="comment">/* don&apos;t need an addref as the sb_info should be holding one */</span>
<a name="l01070"></a><a class="code" href="llite__internal_8h.html#a56e5ae26af9f6e65f1afb06378b9f5bc">01070</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *<a class="code" href="llite__internal_8h.html#a56e5ae26af9f6e65f1afb06378b9f5bc">ll_s2dtexp</a>(<span class="keyword">struct</span> super_block *sb)
<a name="l01071"></a>01071 {
<a name="l01072"></a>01072         <span class="keywordflow">return</span> <a class="code" href="llite__internal_8h.html#a87c04229045e7df803e165ec9b454bd4">ll_s2sbi</a>(sb)-&gt;ll_dt_exp;
<a name="l01073"></a>01073 }
<a name="l01074"></a>01074 
<a name="l01075"></a>01075 <span class="comment">/* don&apos;t need an addref as the sb_info should be holding one */</span>
<a name="l01076"></a><a class="code" href="llite__internal_8h.html#a830a60308c8fd66bbf4d0cac2415733f">01076</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *<a class="code" href="llite__internal_8h.html#a830a60308c8fd66bbf4d0cac2415733f">ll_s2mdexp</a>(<span class="keyword">struct</span> super_block *sb)
<a name="l01077"></a>01077 {
<a name="l01078"></a>01078         <span class="keywordflow">return</span> <a class="code" href="llite__internal_8h.html#a87c04229045e7df803e165ec9b454bd4">ll_s2sbi</a>(sb)-&gt;ll_md_exp;
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a><a class="code" href="llite__internal_8h.html#a6c0a5931834f7e3fbdcbc3600c40dbf2">01081</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structclient__obd.html">client_obd</a> *<a class="code" href="llite__internal_8h.html#a6c0a5931834f7e3fbdcbc3600c40dbf2">sbi2mdc</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *obd = sbi-&gt;<a class="code" href="structll__sb__info.html#a585b00d59707c91ff10eb0e6a571cbba">ll_md_exp</a>-&gt;<a class="code" href="structobd__export.html#ab0e9778c418ab982cb6befb298b38368" title="Obd device of this export.">exp_obd</a>;
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (obd == NULL)
<a name="l01085"></a>01085                 <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01086"></a>01086         <span class="keywordflow">return</span> &amp;obd-&gt;<a class="code" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">u</a>.<a class="code" href="structobd__device.html#aab14b15f2359afc1da23bbc47decdd0c">cli</a>;
<a name="l01087"></a>01087 }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="comment">// FIXME: replace the name of this with LL_SB to conform to kernel stuff</span>
<a name="l01090"></a><a class="code" href="llite__internal_8h.html#aded7f20309c0a2768de0c6351247527a">01090</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structll__sb__info.html">ll_sb_info</a> *<a class="code" href="llite__internal_8h.html#aded7f20309c0a2768de0c6351247527a">ll_i2sbi</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01091"></a>01091 {
<a name="l01092"></a>01092         <span class="keywordflow">return</span> <a class="code" href="llite__internal_8h.html#a87c04229045e7df803e165ec9b454bd4">ll_s2sbi</a>(inode-&gt;i_sb);
<a name="l01093"></a>01093 }
<a name="l01094"></a>01094 
<a name="l01095"></a><a class="code" href="llite__internal_8h.html#acc7c02cdec4cfada9f0d5b9867b10f68">01095</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *<a class="code" href="llite__internal_8h.html#acc7c02cdec4cfada9f0d5b9867b10f68">ll_i2dtexp</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097         <span class="keywordflow">return</span> <a class="code" href="llite__internal_8h.html#a56e5ae26af9f6e65f1afb06378b9f5bc">ll_s2dtexp</a>(inode-&gt;i_sb);
<a name="l01098"></a>01098 }
<a name="l01099"></a>01099 
<a name="l01100"></a><a class="code" href="llite__internal_8h.html#a21770edaabc37cf891b3b258d54720e9">01100</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *<a class="code" href="llite__internal_8h.html#a21770edaabc37cf891b3b258d54720e9">ll_i2mdexp</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01101"></a>01101 {
<a name="l01102"></a>01102         <span class="keywordflow">return</span> <a class="code" href="llite__internal_8h.html#a830a60308c8fd66bbf4d0cac2415733f">ll_s2mdexp</a>(inode-&gt;i_sb);
<a name="l01103"></a>01103 }
<a name="l01104"></a>01104 
<a name="l01105"></a><a class="code" href="llite__internal_8h.html#a3f20d3ffc26568e83b4acbf9e106f44d">01105</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *<a class="code" href="llite__internal_8h.html#a3f20d3ffc26568e83b4acbf9e106f44d">ll_inode2fid</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01106"></a>01106 {
<a name="l01107"></a>01107         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid;
<a name="l01108"></a>01108 
<a name="l01109"></a>01109         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(inode != NULL);
<a name="l01110"></a>01110         fid = &amp;<a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">ll_i2info</a>(inode)-&gt;<a class="code" href="structll__inode__info.html#aef478f050fe920050e3eb6dc483ac4d0">lli_fid</a>;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112         <span class="keywordflow">return</span> fid;
<a name="l01113"></a>01113 }
<a name="l01114"></a>01114 
<a name="l01115"></a><a class="code" href="llite__internal_8h.html#a8ef7d34408356820b97724de4fd73d2c">01115</a> <span class="keyword">static</span> <span class="keyword">inline</span> loff_t <a class="code" href="llite__internal_8h.html#a8ef7d34408356820b97724de4fd73d2c">ll_file_maxbytes</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01116"></a>01116 {
<a name="l01117"></a>01117         <span class="keyword">struct </span><a class="code" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a> *obj = <a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">ll_i2info</a>(inode)-&gt;<a class="code" href="structll__inode__info.html#a1c6f23ae28245bc9a587dd4a1806aeda">lli_clob</a>;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119         <span class="keywordflow">if</span> (obj == NULL)
<a name="l01120"></a>01120                 <span class="keywordflow">return</span> MAX_LFS_FILESIZE;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122         <span class="keywordflow">return</span> <a class="code" href="osc__internal_8h.html#a571fb08c9d47c410a616edec580ff121">min_t</a>(loff_t, <a class="code" href="group__cl__object.html#gaa30ca80e8a50712e8ccf910be0bf0845">cl_object_maxbytes</a>(obj), MAX_LFS_FILESIZE);
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment">/* llite/xattr.c */</span>
<a name="l01126"></a>01126 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#abc2ddedfc641284707d3b0d1841922a3">ll_setxattr</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l01127"></a>01127                 <span class="keyword">const</span> <span class="keywordtype">void</span> *value, <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <span class="keywordtype">int</span> flags);
<a name="l01128"></a>01128 ssize_t <a class="code" href="llite__internal_8h.html#a705797a3631232c1108cfa4862b33d48">ll_getxattr</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l01129"></a>01129                     <span class="keywordtype">void</span> *buffer, <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);
<a name="l01130"></a>01130 ssize_t <a class="code" href="llite__internal_8h.html#a267f288aaa54c4f2c5f58b784ae12167">ll_listxattr</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);
<a name="l01131"></a>01131 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a38bdae160a0182cca8ed5275747df6c0">ll_removexattr</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 <span class="comment">/* llite/remote_perm.c */</span>
<a name="l01134"></a>01134 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="llite__internal_8h.html#a3a45f24bb43338c28086abd2565520f5">ll_remote_perm_cachep</a>;
<a name="l01135"></a>01135 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="llite__internal_8h.html#ad521c0c3ca1e5330b17b4968eb0c6b57">ll_rmtperm_hash_cachep</a>;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#aee6428fe7cdbc3ef3041e09d297ad5e2">free_rmtperm_hash</a>(<span class="keyword">struct</span> <a class="code" href="structhlist__head.html">hlist_head</a> *hash);
<a name="l01138"></a>01138 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ad4ee26bb88a6c1d5441b1fe8a186f308">ll_update_remote_perm</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structmdt__remote__perm.html">mdt_remote_perm</a> *perm);
<a name="l01139"></a>01139 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a933ba5104d61c9478f1c9a5474a0b6a5">lustre_check_remote_perm</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> mask);
<a name="l01140"></a>01140 
<a name="l01144"></a>01144 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ad1a287088b4f6ed1e3475442aaadb775" title="Common IO arguments for various VFS I/O interfaces.">cl_sb_init</a>(<span class="keyword">struct</span> super_block *sb);
<a name="l01145"></a>01145 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a62081c5fc5b83eeaee368194680ee4e6">cl_sb_fini</a>(<span class="keyword">struct</span> super_block *sb);
<a name="l01146"></a>01146 
<a name="l01147"></a><a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25">01147</a> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25">ras_update_flags</a> {
<a name="l01148"></a><a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25a173cd58a500aea32781556bf04b3fee6">01148</a>         <a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25a173cd58a500aea32781556bf04b3fee6">LL_RAS_HIT</a>  = 0x1,
<a name="l01149"></a><a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25aab83dcd9d94a6fb3089df6d46b27b10f">01149</a>         <a class="code" href="llite__internal_8h.html#a2cd107d26101da2106fefbd737205f25aab83dcd9d94a6fb3089df6d46b27b10f">LL_RAS_MMAP</a> = 0x2
<a name="l01150"></a>01150 };
<a name="l01151"></a>01151 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#adf5e0c80c127e2f5523b4b13c5b87e6c">ll_ra_count_put</a>(<span class="keyword">struct</span> <a class="code" href="structll__sb__info.html">ll_sb_info</a> *sbi, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> len);
<a name="l01152"></a>01152 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ae365e173e1d32458f878340ea231f95b">ll_ra_stats_inc</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#a0dbd2cebb432db43590d9bd246b66707">ra_stat</a> which);
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 <span class="comment">/* llite/llite_rmtacl.c */</span>
<a name="l01155"></a>01155 <span class="preprocessor">#ifdef CONFIG_FS_POSIX_ACL</span>
<a name="l01156"></a>01156 <span class="preprocessor"></span>u64 rce_ops2valid(<span class="keywordtype">int</span> ops);
<a name="l01157"></a>01157 <span class="keyword">struct </span><a class="code" href="structrmtacl__ctl__entry.html">rmtacl_ctl_entry</a> *rct_search(<span class="keyword">struct</span> <a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> *rct, pid_t key);
<a name="l01158"></a>01158 <span class="keywordtype">int</span> rct_add(<span class="keyword">struct</span> <a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> *rct, pid_t key, <span class="keywordtype">int</span> ops);
<a name="l01159"></a>01159 <span class="keywordtype">int</span> rct_del(<span class="keyword">struct</span> <a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> *rct, pid_t key);
<a name="l01160"></a>01160 <span class="keywordtype">void</span> rct_init(<span class="keyword">struct</span> <a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> *rct);
<a name="l01161"></a>01161 <span class="keywordtype">void</span> rct_fini(<span class="keyword">struct</span> <a class="code" href="structrmtacl__ctl__table.html">rmtacl_ctl_table</a> *rct);
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 <span class="keywordtype">void</span> ee_free(<span class="keyword">struct</span> <a class="code" href="structeacl__entry.html">eacl_entry</a> *ee);
<a name="l01164"></a>01164 <span class="keywordtype">int</span> ee_add(<span class="keyword">struct</span> <a class="code" href="structeacl__table.html">eacl_table</a> *et, pid_t key, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keywordtype">int</span> type,
<a name="l01165"></a>01165            ext_acl_xattr_header *<a class="code" href="it__test_8c.html#a65579ed4f1bdcc045f97e6ccee22e9a9">header</a>);
<a name="l01166"></a>01166 <span class="keyword">struct </span><a class="code" href="structeacl__entry.html">eacl_entry</a> *et_search_del(<span class="keyword">struct</span> <a class="code" href="structeacl__table.html">eacl_table</a> *et, pid_t key,
<a name="l01167"></a>01167                                  <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keywordtype">int</span> type);
<a name="l01168"></a>01168 <span class="keywordtype">void</span> et_search_free(<span class="keyword">struct</span> <a class="code" href="structeacl__table.html">eacl_table</a> *et, pid_t key);
<a name="l01169"></a>01169 <span class="keywordtype">void</span> et_init(<span class="keyword">struct</span> <a class="code" href="structeacl__table.html">eacl_table</a> *et);
<a name="l01170"></a>01170 <span class="keywordtype">void</span> et_fini(<span class="keyword">struct</span> <a class="code" href="structeacl__table.html">eacl_table</a> *et);
<a name="l01171"></a>01171 <span class="preprocessor">#endif</span>
<a name="l01172"></a>01172 <span class="preprocessor"></span>
<a name="l01173"></a>01173 <span class="comment">/* statahead.c */</span>
<a name="l01174"></a>01174 
<a name="l01175"></a><a class="code" href="llite__internal_8h.html#a36a4a18cc67701c130e028b8f16ede43">01175</a> <span class="preprocessor">#define LL_SA_RPC_MIN           2</span>
<a name="l01176"></a><a class="code" href="llite__internal_8h.html#a3f01f3de437ba2b942b6333d94584ccf">01176</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_SA_RPC_DEF           32</span>
<a name="l01177"></a><a class="code" href="llite__internal_8h.html#a006f3a9f2262d860e487ab232f578af7">01177</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_SA_RPC_MAX           8192</span>
<a name="l01178"></a>01178 <span class="preprocessor"></span>
<a name="l01179"></a><a class="code" href="llite__internal_8h.html#ae5212e9398051d37b4dd3431dce4639e">01179</a> <span class="preprocessor">#define LL_SA_CACHE_BIT         5</span>
<a name="l01180"></a><a class="code" href="llite__internal_8h.html#ad596c61205789f418a1a71e3566dc530">01180</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_SA_CACHE_SIZE        (1 &lt;&lt; LL_SA_CACHE_BIT)</span>
<a name="l01181"></a><a class="code" href="llite__internal_8h.html#ae08e141baccea5c8641e600b8735c7a6">01181</a> <span class="preprocessor"></span><span class="preprocessor">#define LL_SA_CACHE_MASK        (LL_SA_CACHE_SIZE - 1)</span>
<a name="l01182"></a>01182 <span class="preprocessor"></span>
<a name="l01183"></a>01183 <span class="comment">/* per inode struct, for dir only */</span>
<a name="l01184"></a><a class="code" href="structll__statahead__info.html">01184</a> <span class="keyword">struct </span><a class="code" href="structll__statahead__info.html">ll_statahead_info</a> {
<a name="l01185"></a><a class="code" href="structll__statahead__info.html#aa7f641a47e82ff3cf34d23379f507259">01185</a>         <span class="keyword">struct </span>dentry          *<a class="code" href="structll__statahead__info.html#aa7f641a47e82ff3cf34d23379f507259">sai_dentry</a>;
<a name="l01186"></a><a class="code" href="structll__statahead__info.html#af77f304abf485d45a80034868093adc0">01186</a>         atomic_t                <a class="code" href="structll__statahead__info.html#af77f304abf485d45a80034868093adc0">sai_refcount</a>;   <span class="comment">/* when access this struct, hold</span>
<a name="l01187"></a>01187 <span class="comment">                                                 * refcount */</span>
<a name="l01188"></a><a class="code" href="structll__statahead__info.html#a40ff2dd73101bc32a3a8102312e36dc1">01188</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structll__statahead__info.html#a40ff2dd73101bc32a3a8102312e36dc1">sai_max</a>;        <span class="comment">/* max ahead of lookup */</span>
<a name="l01189"></a><a class="code" href="structll__statahead__info.html#a320a29ca1c41908f4ab640844785eb42">01189</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#a320a29ca1c41908f4ab640844785eb42">sai_sent</a>;       <span class="comment">/* stat requests sent count */</span>
<a name="l01190"></a><a class="code" href="structll__statahead__info.html#a55ce14b442aff2431bf2d6745ded44f5">01190</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#a55ce14b442aff2431bf2d6745ded44f5">sai_replied</a>;    <span class="comment">/* stat requests which received</span>
<a name="l01191"></a>01191 <span class="comment">                                                 * reply */</span>
<a name="l01192"></a><a class="code" href="structll__statahead__info.html#aefbbb78e3d1f78bfbaf17952bb65037c">01192</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#aefbbb78e3d1f78bfbaf17952bb65037c">sai_index</a>;      <span class="comment">/* index of statahead entry */</span>
<a name="l01193"></a><a class="code" href="structll__statahead__info.html#a0f4b0284d768127549ddb94f8ca76fcc">01193</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#a0f4b0284d768127549ddb94f8ca76fcc">sai_index_wait</a>; <span class="comment">/* index of entry which is the</span>
<a name="l01194"></a>01194 <span class="comment">                                                 * caller is waiting for */</span>
<a name="l01195"></a><a class="code" href="structll__statahead__info.html#aa056601b5a0d3550a3a902966f70d1e5">01195</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#aa056601b5a0d3550a3a902966f70d1e5">sai_hit</a>;        <span class="comment">/* hit count */</span>
<a name="l01196"></a><a class="code" href="structll__statahead__info.html#ad8f39532e437697e8bb7265527c3b8e2">01196</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structll__statahead__info.html#ad8f39532e437697e8bb7265527c3b8e2">sai_miss</a>;       <span class="comment">/* miss count:</span>
<a name="l01197"></a>01197 <span class="comment">                                                 * for &quot;ls -al&quot; case, includes</span>
<a name="l01198"></a>01198 <span class="comment">                                                 * hidden dentry miss;</span>
<a name="l01199"></a>01199 <span class="comment">                                                 * for &quot;ls -l&quot; case, it does not</span>
<a name="l01200"></a>01200 <span class="comment">                                                 * include hidden dentry miss.</span>
<a name="l01201"></a>01201 <span class="comment">                                                 * &quot;sai_miss_hidden&quot; is used for</span>
<a name="l01202"></a>01202 <span class="comment">                                                 * the later case.</span>
<a name="l01203"></a>01203 <span class="comment">                                                 */</span>
<a name="l01204"></a><a class="code" href="structll__statahead__info.html#ab3bf62a4c8f85b9dd89a5850282aee2a">01204</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structll__statahead__info.html#ab3bf62a4c8f85b9dd89a5850282aee2a">sai_consecutive_miss</a>; <span class="comment">/* consecutive miss */</span>
<a name="l01205"></a><a class="code" href="structll__statahead__info.html#a2717533848811329135060793864843c">01205</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structll__statahead__info.html#a2717533848811329135060793864843c">sai_miss_hidden</a>;<span class="comment">/* &quot;ls -al&quot;, but first dentry</span>
<a name="l01206"></a>01206 <span class="comment">                                                 * is not a hidden one */</span>
<a name="l01207"></a><a class="code" href="structll__statahead__info.html#ae9074750a4a0a2b0acb72398fd55b8ae">01207</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structll__statahead__info.html#ae9074750a4a0a2b0acb72398fd55b8ae">sai_skip_hidden</a>;<span class="comment">/* skipped hidden dentry count</span>
<a name="l01208"></a>01208 <span class="comment">                                                 */</span>
<a name="l01209"></a><a class="code" href="structll__statahead__info.html#a7f9dbd6747c32e92633dd7733386add2">01209</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structll__statahead__info.html#a7f9dbd6747c32e92633dd7733386add2">sai_ls_all</a>:1,   <span class="comment">/* &quot;ls -al&quot;, do stat-ahead for</span>
<a name="l01210"></a>01210 <span class="comment">                                                 * hidden entries */</span>
<a name="l01211"></a>01211                                 <a class="code" href="structll__statahead__info.html#a58192e03773d6c24e263cd6f036c9bb5">sai_agl_valid</a>:1,<span class="comment">/* AGL is valid for the dir */</span>
<a name="l01212"></a>01212                                 <a class="code" href="structll__statahead__info.html#acd531e7d868ca415eb0fce4b9908d669">sai_in_readpage</a>:1;<span class="comment">/* statahead is in readdir()*/</span>
<a name="l01213"></a><a class="code" href="structll__statahead__info.html#aa04c2bb9ebe02c5cc0d721a0340600e8">01213</a>         wait_queue_head_t       <a class="code" href="structll__statahead__info.html#aa04c2bb9ebe02c5cc0d721a0340600e8">sai_waitq</a>;      <span class="comment">/* stat-ahead wait queue */</span>
<a name="l01214"></a><a class="code" href="structll__statahead__info.html#aaae7457e8bb49775b1d298ffa70b7b53">01214</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__thread.html" title="Definition of server service thread structure.">ptlrpc_thread</a>    <a class="code" href="structll__statahead__info.html#aaae7457e8bb49775b1d298ffa70b7b53">sai_thread</a>;     <span class="comment">/* stat-ahead thread */</span>
<a name="l01215"></a><a class="code" href="structll__statahead__info.html#ab687786889ef7c67882846773f48edbc">01215</a>         <span class="keyword">struct </span><a class="code" href="structptlrpc__thread.html" title="Definition of server service thread structure.">ptlrpc_thread</a>    <a class="code" href="structll__statahead__info.html#ab687786889ef7c67882846773f48edbc">sai_agl_thread</a>; <span class="comment">/* AGL thread */</span>
<a name="l01216"></a><a class="code" href="structll__statahead__info.html#aed6c8a43407bbda1891d5f38f47e3360">01216</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structll__statahead__info.html#aed6c8a43407bbda1891d5f38f47e3360">sai_interim_entries</a>; <span class="comment">/* entries which got async</span>
<a name="l01217"></a>01217 <span class="comment">                                                      * stat reply, but not</span>
<a name="l01218"></a>01218 <span class="comment">                                                      * instantiated */</span>
<a name="l01219"></a><a class="code" href="structll__statahead__info.html#abc5cada77adcc7137c18d9bd44b19341">01219</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structll__statahead__info.html#abc5cada77adcc7137c18d9bd44b19341">sai_entries</a>;    <span class="comment">/* completed entries */</span>
<a name="l01220"></a><a class="code" href="structll__statahead__info.html#a48f8249b3897c87933e93fbfa617e205">01220</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structll__statahead__info.html#a48f8249b3897c87933e93fbfa617e205">sai_agls</a>;       <span class="comment">/* AGLs to be sent */</span>
<a name="l01221"></a><a class="code" href="structll__statahead__info.html#a13948639a43776ddf246f921680f7f0f">01221</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structll__statahead__info.html#a13948639a43776ddf246f921680f7f0f">sai_cache</a>[<a class="code" href="llite__internal_8h.html#ad596c61205789f418a1a71e3566dc530">LL_SA_CACHE_SIZE</a>];
<a name="l01222"></a><a class="code" href="structll__statahead__info.html#a41a711b41e0ffbb0fe137d26a0212a39">01222</a>         spinlock_t              <a class="code" href="structll__statahead__info.html#a41a711b41e0ffbb0fe137d26a0212a39">sai_cache_lock</a>[<a class="code" href="llite__internal_8h.html#ad596c61205789f418a1a71e3566dc530">LL_SA_CACHE_SIZE</a>];
<a name="l01223"></a><a class="code" href="structll__statahead__info.html#a5641da5d7f8b58a133b4ac3c62a4ea6c">01223</a>         atomic_t                <a class="code" href="structll__statahead__info.html#a5641da5d7f8b58a133b4ac3c62a4ea6c">sai_cache_count</a>; <span class="comment">/* entry count in cache */</span>
<a name="l01224"></a>01224 };
<a name="l01225"></a>01225 
<a name="l01226"></a>01226 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a0aef1ef3595bbbc55ef4ed9773c7f75d" title="statahead entry function, this is called when client getattr on a file, it will start...">ll_statahead</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keyword">struct</span> dentry **dentry, <span class="keywordtype">bool</span> unplug);
<a name="l01227"></a>01227 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a9a5a865fbd37de5c69eb05da2d109ad4">ll_authorize_statahead</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keywordtype">void</span> *key);
<a name="l01228"></a>01228 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#add6150d3978c67b6537417ebf15efc77">ll_deauthorize_statahead</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keywordtype">void</span> *key);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 <span class="comment">/* glimpse.c */</span>
<a name="l01231"></a>01231 blkcnt_t <a class="code" href="glimpse_8c.html#ab9acd2547f497f2aaefd06f5ca1ed7c1">dirty_cnt</a>(<span class="keyword">struct</span> inode *inode);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233 <span class="keywordtype">int</span> <a class="code" href="glimpse_8c.html#aebad32c672ab5559756ef106da202aaa">cl_glimpse_size0</a>(<span class="keyword">struct</span> inode *inode, <span class="keywordtype">int</span> agl);
<a name="l01234"></a>01234 <span class="keywordtype">int</span> <a class="code" href="glimpse_8c.html#a63c89421dc4a98fa4c40e4354f136c8d">cl_glimpse_lock</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structcl__io.html" title="State for io.">cl_io</a> *io,
<a name="l01235"></a>01235                     <span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a> *clob, <span class="keywordtype">int</span> agl);
<a name="l01236"></a>01236 
<a name="l01237"></a><a class="code" href="llite__internal_8h.html#ac9d2c2d3f99ac7dd310654b0fadace83">01237</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ac9d2c2d3f99ac7dd310654b0fadace83">cl_glimpse_size</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01238"></a>01238 {
<a name="l01239"></a>01239         <span class="keywordflow">return</span> <a class="code" href="glimpse_8c.html#aebad32c672ab5559756ef106da202aaa">cl_glimpse_size0</a>(inode, 0);
<a name="l01240"></a>01240 }
<a name="l01241"></a>01241 
<a name="l01242"></a><a class="code" href="llite__internal_8h.html#a5e338f1a3f27198da6e6badebd731636">01242</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a5e338f1a3f27198da6e6badebd731636">cl_agl</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01243"></a>01243 {
<a name="l01244"></a>01244         <span class="keywordflow">return</span> <a class="code" href="glimpse_8c.html#aebad32c672ab5559756ef106da202aaa">cl_glimpse_size0</a>(inode, 1);
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a><a class="code" href="llite__internal_8h.html#ab9e3a3237fae2c31cd430d7eb9135469">01247</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ab9e3a3237fae2c31cd430d7eb9135469">ll_glimpse_size</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249         <span class="keyword">struct </span><a class="code" href="structll__inode__info.html">ll_inode_info</a> *lli = <a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">ll_i2info</a>(inode);
<a name="l01250"></a>01250         <span class="keywordtype">int</span> rc;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252         down_read(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#a0b71405fdf752fa586f8cd68d4b6e981">lli_glimpse_sem</a>);
<a name="l01253"></a>01253         rc = <a class="code" href="llite__internal_8h.html#ac9d2c2d3f99ac7dd310654b0fadace83">cl_glimpse_size</a>(inode);
<a name="l01254"></a>01254         lli-&gt;<a class="code" href="structll__inode__info.html#ab59a121494126f64ce246c005f99ba1e">lli_glimpse_time</a> = <a class="code" href="linux-time_8h.html#adc63a7977338536b551ccc795e5a9148">cfs_time_current</a>();
<a name="l01255"></a>01255         up_read(&amp;lli-&gt;<a class="code" href="structll__inode__info.html#a0b71405fdf752fa586f8cd68d4b6e981">lli_glimpse_sem</a>);
<a name="l01256"></a>01256         <span class="keywordflow">return</span> rc;
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 <span class="comment">/* dentry may statahead when statahead is enabled and current process has opened</span>
<a name="l01260"></a>01260 <span class="comment"> * parent directory, and this dentry hasn&apos;t accessed statahead cache before */</span>
<a name="l01261"></a>01261 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l01262"></a><a class="code" href="llite__internal_8h.html#aa7d309cc0d4b56b5037c9d93f5b671ab">01262</a> <a class="code" href="llite__internal_8h.html#aa7d309cc0d4b56b5037c9d93f5b671ab">dentry_may_statahead</a>(<span class="keyword">struct</span> inode *<a class="code" href="mmap__sanity_8c.html#a73da71b9c136e698a3ccaa1366e455a8">dir</a>, <span class="keyword">struct</span> dentry *dentry)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264         <span class="keyword">struct </span><a class="code" href="structll__inode__info.html">ll_inode_info</a>  *lli;
<a name="l01265"></a>01265         <span class="keyword">struct </span><a class="code" href="structll__dentry__data.html">ll_dentry_data</a> *ldd;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267         <span class="keywordflow">if</span> (<a class="code" href="llite__internal_8h.html#aded7f20309c0a2768de0c6351247527a">ll_i2sbi</a>(dir)-&gt;ll_sa_max == 0)
<a name="l01268"></a>01268                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270         lli = <a class="code" href="llite__internal_8h.html#ab207ad07a4a0e720f9326add66c1ead7">ll_i2info</a>(dir);
<a name="l01271"></a>01271 
<a name="l01272"></a>01272         <span class="comment">/* statahead is not allowed for this dir, there may be three causes:</span>
<a name="l01273"></a>01273 <span class="comment">         * 1. dir is not opened.</span>
<a name="l01274"></a>01274 <span class="comment">         * 2. statahead hit ratio is too low.</span>
<a name="l01275"></a>01275 <span class="comment">         * 3. previous stat started statahead thread failed. */</span>
<a name="l01276"></a>01276         <span class="keywordflow">if</span> (!lli-&gt;<a class="code" href="structll__inode__info.html#af8a5e03d50d04de28a5dbccb5ab461f8">lli_sa_enabled</a>)
<a name="l01277"></a>01277                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279         <span class="comment">/* not the same process, don&apos;t statahead */</span>
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (lli-&gt;<a class="code" href="structll__inode__info.html#afe34fc379bdc834cb4e183690dcb7fa8">lli_opendir_pid</a> != <a class="code" href="linux_2libcfs_8h.html#a9fce95151f16556044079367a03239bb">current_pid</a>())
<a name="l01281"></a>01281                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01282"></a>01282 
<a name="l01283"></a>01283         <span class="comment">/*</span>
<a name="l01284"></a>01284 <span class="comment">         * When stating a dentry, kernel may trigger &apos;revalidate&apos; or &apos;lookup&apos;</span>
<a name="l01285"></a>01285 <span class="comment">         * multiple times, eg. for &apos;getattr&apos;, &apos;getxattr&apos; and etc.</span>
<a name="l01286"></a>01286 <span class="comment">         * For patchless client, lookup intent is not accurate, which may</span>
<a name="l01287"></a>01287 <span class="comment">         * misguide statahead. For example:</span>
<a name="l01288"></a>01288 <span class="comment">         * The &apos;revalidate&apos; call for &apos;getattr&apos; and &apos;getxattr&apos; of a dentry will</span>
<a name="l01289"></a>01289 <span class="comment">         * have the same intent -- IT_GETATTR, while one dentry should access</span>
<a name="l01290"></a>01290 <span class="comment">         * statahead cache once, otherwise statahead windows is messed up.</span>
<a name="l01291"></a>01291 <span class="comment">         * The solution is as following:</span>
<a name="l01292"></a>01292 <span class="comment">         * Assign &apos;lld_sa_generation&apos; with &apos;lli_sa_generation&apos; when a dentry</span>
<a name="l01293"></a>01293 <span class="comment">         * IT_GETATTR for the first time, and subsequent IT_GETATTR will</span>
<a name="l01294"></a>01294 <span class="comment">         * bypass interacting with statahead cache by checking</span>
<a name="l01295"></a>01295 <span class="comment">         * &apos;lld_sa_generation == lli-&gt;lli_sa_generation&apos;.</span>
<a name="l01296"></a>01296 <span class="comment">         */</span>
<a name="l01297"></a>01297         ldd = <a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">ll_d2d</a>(dentry);
<a name="l01298"></a>01298         <span class="keywordflow">if</span> (ldd != NULL &amp;&amp; ldd-&gt;<a class="code" href="structll__dentry__data.html#afb44554ffc4ed4dbde8a5a8785be3c57">lld_sa_generation</a> == lli-&gt;<a class="code" href="structll__inode__info.html#a8f1bf8ff20a08970a34060c48090d1c6">lli_sa_generation</a>)
<a name="l01299"></a>01299                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01302"></a>01302 }
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 <span class="comment">/* llite ioctl register support rountine */</span>
<a name="l01305"></a><a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795">01305</a> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795">llioc_iter</a> {
<a name="l01306"></a><a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795ab7743c52088fbc39847cb0b2be9bc159">01306</a>         <a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795ab7743c52088fbc39847cb0b2be9bc159">LLIOC_CONT</a> = 0,
<a name="l01307"></a><a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795ae4b877c3ed36bd20f5341657755d48d3">01307</a>         <a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795ae4b877c3ed36bd20f5341657755d48d3">LLIOC_STOP</a>
<a name="l01308"></a>01308 };
<a name="l01309"></a>01309 
<a name="l01310"></a><a class="code" href="llite__internal_8h.html#a2ec0d486f7a9e37462794a09da312daa">01310</a> <span class="preprocessor">#define LLIOC_MAX_CMD           256</span>
<a name="l01311"></a>01311 <span class="preprocessor"></span>
<a name="l01312"></a>01312 <span class="comment">/*</span>
<a name="l01313"></a>01313 <span class="comment"> * Rules to write a callback function:</span>
<a name="l01314"></a>01314 <span class="comment"> *</span>
<a name="l01315"></a>01315 <span class="comment"> * Parameters:</span>
<a name="l01316"></a>01316 <span class="comment"> *  @magic: Dynamic ioctl call routine will feed this vaule with the pointer</span>
<a name="l01317"></a>01317 <span class="comment"> *      returned to ll_iocontrol_register.  Callback functions should use this</span>
<a name="l01318"></a>01318 <span class="comment"> *      data to check the potential collasion of ioctl cmd. If collasion is</span>
<a name="l01319"></a>01319 <span class="comment"> *      found, callback function should return LLIOC_CONT.</span>
<a name="l01320"></a>01320 <span class="comment"> *  @rcp: The result of ioctl command.</span>
<a name="l01321"></a>01321 <span class="comment"> *</span>
<a name="l01322"></a>01322 <span class="comment"> *  Return values:</span>
<a name="l01323"></a>01323 <span class="comment"> *      If @magic matches the pointer returned by ll_iocontrol_data, the</span>
<a name="l01324"></a>01324 <span class="comment"> *      callback should return LLIOC_STOP; return LLIOC_STOP otherwise.</span>
<a name="l01325"></a>01325 <span class="comment"> */</span>
<a name="l01326"></a>01326 <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="llite__internal_8h.html#aa24705c91135269499f54807b2bd5795">llioc_iter</a> (*<a class="code" href="llite__internal_8h.html#aee85ea999569c95db185285c59658b57">llioc_callback_t</a>)(<span class="keyword">struct </span>inode *inode,
<a name="l01327"></a>01327                 <span class="keyword">struct </span>file *file, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg,
<a name="l01328"></a>01328                 <span class="keywordtype">void</span> *magic, <span class="keywordtype">int</span> *rcp);
<a name="l01329"></a>01329 
<a name="l01330"></a>01330 <span class="comment">/* export functions */</span>
<a name="l01331"></a>01331 <span class="comment">/* Register ioctl block dynamatically for a regular file.</span>
<a name="l01332"></a>01332 <span class="comment"> *</span>
<a name="l01333"></a>01333 <span class="comment"> * @cmd: the array of ioctl command set</span>
<a name="l01334"></a>01334 <span class="comment"> * @count: number of commands in the @cmd</span>
<a name="l01335"></a>01335 <span class="comment"> * @cb: callback function, it will be called if an ioctl command is found to</span>
<a name="l01336"></a>01336 <span class="comment"> *      belong to the command list @cmd.</span>
<a name="l01337"></a>01337 <span class="comment"> *</span>
<a name="l01338"></a>01338 <span class="comment"> * Return vaule:</span>
<a name="l01339"></a>01339 <span class="comment"> *      A magic pointer will be returned if success;</span>
<a name="l01340"></a>01340 <span class="comment"> *      otherwise, NULL will be returned.</span>
<a name="l01341"></a>01341 <span class="comment"> * */</span>
<a name="l01342"></a>01342 <span class="keywordtype">void</span> *<a class="code" href="file_8c.html#aa6602720fc6befce1e8707bab687f3bb">ll_iocontrol_register</a>(<a class="code" href="llite__internal_8h.html#aee85ea999569c95db185285c59658b57">llioc_callback_t</a> <a class="code" href="it__test_8c.html#a3edc96db5310d665bb056d7adc554a8f">cb</a>, <span class="keywordtype">int</span> count, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>);
<a name="l01343"></a>01343 <span class="keywordtype">void</span> <a class="code" href="file_8c.html#aefa099972409606d30e4060ec128f02e">ll_iocontrol_unregister</a>(<span class="keywordtype">void</span> *magic);
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a9b7ba8c39623584747a624db89e26f64" title="Called to make sure a portion of file has been written out.">cl_sync_file_range</a>(<span class="keyword">struct</span> inode *inode, loff_t <a class="code" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>, loff_t <a class="code" href="mdsrate_8c.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>,
<a name="l01346"></a>01346                        <span class="keyword">enum</span> <a class="code" href="group__cl__io.html#gabb7d5d07a2e68b82b9b13cac60256a7d">cl_fsync_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <span class="keywordtype">int</span> ignore_layout);
<a name="l01347"></a>01347 
<a name="l01349"></a><a class="code" href="structll__dio__pages.html">01349</a> <span class="keyword">struct </span><a class="code" href="structll__dio__pages.html" title="direct write pages">ll_dio_pages</a> {
<a name="l01352"></a><a class="code" href="structll__dio__pages.html#ac4d2abbf5f44eee9a86745ab72d32f7f">01352</a>         <span class="keyword">struct </span>page **<a class="code" href="structll__dio__pages.html#ac4d2abbf5f44eee9a86745ab72d32f7f" title="page array to be written.">ldp_pages</a>;
<a name="l01353"></a>01353         <span class="comment">/* offset of each page */</span>
<a name="l01354"></a><a class="code" href="structll__dio__pages.html#aa975fd9b628710c27932ed8d59c64bd4">01354</a>         loff_t       *<a class="code" href="structll__dio__pages.html#aa975fd9b628710c27932ed8d59c64bd4">ldp_offsets</a>;
<a name="l01358"></a><a class="code" href="structll__dio__pages.html#a72da02e97ddceba28158b05082b4d24d">01358</a>         loff_t        <a class="code" href="structll__dio__pages.html#a72da02e97ddceba28158b05082b4d24d" title="if ldp_offsets is NULL, it means a sequential pages to be written, then this is the...">ldp_start_offset</a>;
<a name="l01360"></a><a class="code" href="structll__dio__pages.html#a096c5345f7ca74c4d70c90521268c72e">01360</a>         <span class="keywordtype">size_t</span>        <a class="code" href="structll__dio__pages.html#a096c5345f7ca74c4d70c90521268c72e" title="how many bytes are to be written.">ldp_size</a>;
<a name="l01362"></a><a class="code" href="structll__dio__pages.html#a58824b230272b23f48db9aab8de8e3b9">01362</a>         <span class="keywordtype">int</span>           <a class="code" href="structll__dio__pages.html#a58824b230272b23f48db9aab8de8e3b9" title="# of pages in the array.">ldp_nr</a>;
<a name="l01363"></a>01363 };
<a name="l01364"></a>01364 
<a name="l01365"></a>01365 <span class="keyword">extern</span> ssize_t <a class="code" href="llite__internal_8h.html#ac0ca6fc051a5150f12811796212c1c2a">ll_direct_rw_pages</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structcl__io.html" title="State for io.">cl_io</a> *io,
<a name="l01366"></a>01366                                   <span class="keywordtype">int</span> rw, <span class="keyword">struct</span> inode *inode,
<a name="l01367"></a>01367                                   <span class="keyword">struct</span> <a class="code" href="structll__dio__pages.html" title="direct write pages">ll_dio_pages</a> *pv);
<a name="l01368"></a>01368 
<a name="l01369"></a><a class="code" href="llite__internal_8h.html#a63fb9c42288e8e7a4cac928c15ec9bea">01369</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a63fb9c42288e8e7a4cac928c15ec9bea">ll_file_nolock</a>(<span class="keyword">const</span> <span class="keyword">struct</span> file *file)
<a name="l01370"></a>01370 {
<a name="l01371"></a>01371         <span class="keyword">struct </span><a class="code" href="structll__file__data.html">ll_file_data</a> *fd = <a class="code" href="llite__internal_8h.html#a1f9e295f76a7260a10bdacaa5345d7a3">LUSTRE_FPRIVATE</a>(file);
<a name="l01372"></a>01372         <span class="keyword">struct </span>inode *inode = file-&gt;f_path.dentry-&gt;d_inode;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(fd != NULL);
<a name="l01375"></a>01375         <span class="keywordflow">return</span> ((fd-&gt;<a class="code" href="structll__file__data.html#a1ca772c352d7461a07dabf7b7bb4b663">fd_flags</a> &amp; <a class="code" href="group__lustreuser.html#ga651713d25f27378cd44d975c9ad7d0fe">LL_FILE_IGNORE_LOCK</a>) ||
<a name="l01376"></a>01376                 (<a class="code" href="llite__internal_8h.html#aded7f20309c0a2768de0c6351247527a">ll_i2sbi</a>(inode)-&gt;ll_flags &amp; <a class="code" href="llite__internal_8h.html#a68b33f8795031361448800ead47273b1">LL_SBI_NOLCK</a>));
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a><a class="code" href="llite__internal_8h.html#af575f5a19230246b843970b24306c51c">01379</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#af575f5a19230246b843970b24306c51c">ll_set_lock_data</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct</span> inode *inode,
<a name="l01380"></a>01380                                     <span class="keyword">struct</span> <a class="code" href="structlookup__intent.html">lookup_intent</a> *it, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *bits)
<a name="l01381"></a>01381 {
<a name="l01382"></a>01382         <span class="keywordflow">if</span> (!it-&gt;<a class="code" href="structlookup__intent.html#ae107d2240bebad05f5164fb875f130fe">it_lock_set</a>) {
<a name="l01383"></a>01383                 <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a> handle;
<a name="l01384"></a>01384 
<a name="l01385"></a>01385                 <span class="comment">/* If this inode is a remote object, it will get two</span>
<a name="l01386"></a>01386 <span class="comment">                 * separate locks in different namespaces, Master MDT,</span>
<a name="l01387"></a>01387 <span class="comment">                 * where the name entry is, will grant LOOKUP lock,</span>
<a name="l01388"></a>01388 <span class="comment">                 * remote MDT, where the object is, will grant</span>
<a name="l01389"></a>01389 <span class="comment">                 * UPDATE|PERM lock. The inode will be attched to both</span>
<a name="l01390"></a>01390 <span class="comment">                 * LOOKUP and PERM locks, so revoking either locks will</span>
<a name="l01391"></a>01391 <span class="comment">                 * case the dcache being cleared */</span>
<a name="l01392"></a>01392                 <span class="keywordflow">if</span> (it-&gt;<a class="code" href="structlookup__intent.html#a970117248f871736eb6fe13e7a27d49b">it_remote_lock_mode</a>) {
<a name="l01393"></a>01393                         handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a> = it-&gt;<a class="code" href="structlookup__intent.html#a6b29e7791d50e21fc2e73bd770d3273a">it_remote_lock_handle</a>;
<a name="l01394"></a>01394                         <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a6aee38fab1cf469167142783354b03e0">D_DLMTRACE</a>, <span class="stringliteral">&quot;setting l_data to inode &quot;</span><a class="code" href="group__lustreuser.html#gada965b87689690ab45635c329842df61">DFID</a>
<a name="l01395"></a>01395                                <span class="stringliteral">&quot;(%p) for remote lock &quot;</span><a class="code" href="libcfs_2include_2libcfs_2types_8h.html#abd4b7b7675c19f574aa3c3cd3a7f770f">LPX64</a><span class="stringliteral">&quot;\n&quot;</span>,
<a name="l01396"></a>01396                                <a class="code" href="group__lustreuser.html#ga00397843677b819317199a3198f5ecc2">PFID</a>(<a class="code" href="llite__internal_8h.html#a3f20d3ffc26568e83b4acbf9e106f44d">ll_inode2fid</a>(inode)), inode,
<a name="l01397"></a>01397                                handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a>);
<a name="l01398"></a>01398                         <a class="code" href="obd__class_8h.html#afef00b54bc35de2519563cfcc8b166c1">md_set_lock_data</a>(exp, &amp;handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a>, inode, NULL);
<a name="l01399"></a>01399                 }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401                 handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a> = it-&gt;<a class="code" href="structlookup__intent.html#a2ab792bc338599522f249bb6751dbe7d">it_lock_handle</a>;
<a name="l01402"></a>01402 
<a name="l01403"></a>01403                 <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a6aee38fab1cf469167142783354b03e0">D_DLMTRACE</a>, <span class="stringliteral">&quot;setting l_data to inode &quot;</span><a class="code" href="group__lustreuser.html#gada965b87689690ab45635c329842df61">DFID</a><span class="stringliteral">&quot;(%p)&quot;</span>
<a name="l01404"></a>01404                        <span class="stringliteral">&quot; for lock &quot;</span><a class="code" href="libcfs_2include_2libcfs_2types_8h.html#abd4b7b7675c19f574aa3c3cd3a7f770f">LPX64</a><span class="stringliteral">&quot;\n&quot;</span>,
<a name="l01405"></a>01405                        <a class="code" href="group__lustreuser.html#ga00397843677b819317199a3198f5ecc2">PFID</a>(<a class="code" href="llite__internal_8h.html#a3f20d3ffc26568e83b4acbf9e106f44d">ll_inode2fid</a>(inode)), inode, handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a>);
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                 <a class="code" href="obd__class_8h.html#afef00b54bc35de2519563cfcc8b166c1">md_set_lock_data</a>(exp, &amp;handle.<a class="code" href="structlustre__handle.html#a735d65d1a27d9cafdc17245e4574000a">cookie</a>, inode,
<a name="l01408"></a>01408                                  &amp;it-&gt;<a class="code" href="structlookup__intent.html#a6519c8b3815453ca4c3a2c8d4cb558a6">it_lock_bits</a>);
<a name="l01409"></a>01409                 it-&gt;<a class="code" href="structlookup__intent.html#ae107d2240bebad05f5164fb875f130fe">it_lock_set</a> = 1;
<a name="l01410"></a>01410         }
<a name="l01411"></a>01411 
<a name="l01412"></a>01412         <span class="keywordflow">if</span> (bits != NULL)
<a name="l01413"></a>01413                 *bits = it-&gt;<a class="code" href="structlookup__intent.html#a6519c8b3815453ca4c3a2c8d4cb558a6">it_lock_bits</a>;
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 
<a name="l01416"></a><a class="code" href="llite__internal_8h.html#a6efa2c896e017d1085309f62a75cb25e">01416</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a6efa2c896e017d1085309f62a75cb25e">ll_lock_dcache</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01417"></a>01417 {
<a name="l01418"></a>01418 <span class="preprocessor">#ifdef HAVE_DCACHE_LOCK</span>
<a name="l01419"></a>01419 <span class="preprocessor"></span>        spin_lock(&amp;dcache_lock);
<a name="l01420"></a>01420 <span class="preprocessor">#else</span>
<a name="l01421"></a>01421 <span class="preprocessor"></span>        spin_lock(&amp;inode-&gt;i_lock);
<a name="l01422"></a>01422 <span class="preprocessor">#endif</span>
<a name="l01423"></a>01423 <span class="preprocessor"></span>}
<a name="l01424"></a>01424 
<a name="l01425"></a><a class="code" href="llite__internal_8h.html#a8e7ed29910a2e9f632cc70f2687315b9">01425</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a8e7ed29910a2e9f632cc70f2687315b9">ll_unlock_dcache</a>(<span class="keyword">struct</span> inode *inode)
<a name="l01426"></a>01426 {
<a name="l01427"></a>01427 <span class="preprocessor">#ifdef HAVE_DCACHE_LOCK</span>
<a name="l01428"></a>01428 <span class="preprocessor"></span>        spin_unlock(&amp;dcache_lock);
<a name="l01429"></a>01429 <span class="preprocessor">#else</span>
<a name="l01430"></a>01430 <span class="preprocessor"></span>        spin_unlock(&amp;inode-&gt;i_lock);
<a name="l01431"></a>01431 <span class="preprocessor">#endif</span>
<a name="l01432"></a>01432 <span class="preprocessor"></span>}
<a name="l01433"></a>01433 
<a name="l01434"></a><a class="code" href="llite__internal_8h.html#a85d59822f11ee5cf9df7a8b3a02ae0eb">01434</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a85d59822f11ee5cf9df7a8b3a02ae0eb">d_lustre_invalid</a>(<span class="keyword">const</span> <span class="keyword">struct</span> dentry *dentry)
<a name="l01435"></a>01435 {
<a name="l01436"></a>01436         <span class="keyword">struct </span><a class="code" href="structll__dentry__data.html">ll_dentry_data</a> *lld = <a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">ll_d2d</a>(dentry);
<a name="l01437"></a>01437 
<a name="l01438"></a>01438         <span class="keywordflow">return</span> (lld == NULL) || lld-&gt;<a class="code" href="structll__dentry__data.html#a278fdcfd28592d7d5c4cd7146a8f7590">lld_invalid</a>;
<a name="l01439"></a>01439 }
<a name="l01440"></a>01440 
<a name="l01441"></a><a class="code" href="llite__internal_8h.html#ab2c6ed8d6462a88cb8c3a277d97a927d">01441</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#ab2c6ed8d6462a88cb8c3a277d97a927d">__d_lustre_invalidate</a>(<span class="keyword">struct</span> dentry *dentry)
<a name="l01442"></a>01442 {
<a name="l01443"></a>01443         <span class="keyword">struct </span><a class="code" href="structll__dentry__data.html">ll_dentry_data</a> *lld = <a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">ll_d2d</a>(dentry);
<a name="l01444"></a>01444 
<a name="l01445"></a>01445         <span class="keywordflow">if</span> (lld != NULL)
<a name="l01446"></a>01446                 lld-&gt;<a class="code" href="structll__dentry__data.html#a278fdcfd28592d7d5c4cd7146a8f7590">lld_invalid</a> = 1;
<a name="l01447"></a>01447 }
<a name="l01448"></a>01448 
<a name="l01449"></a>01449 <span class="comment">/*</span>
<a name="l01450"></a>01450 <span class="comment"> * Mark dentry INVALID, if dentry refcount is zero (this is normally case for</span>
<a name="l01451"></a>01451 <span class="comment"> * ll_md_blocking_ast), unhash this dentry, and let dcache to reclaim it later;</span>
<a name="l01452"></a>01452 <span class="comment"> * else dput() of the last refcount will unhash this dentry and kill it.</span>
<a name="l01453"></a>01453 <span class="comment"> */</span>
<a name="l01454"></a><a class="code" href="llite__internal_8h.html#a92cde24076413a12d4045102b030808e">01454</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a92cde24076413a12d4045102b030808e">d_lustre_invalidate</a>(<span class="keyword">struct</span> dentry *dentry, <span class="keywordtype">int</span> nested)
<a name="l01455"></a>01455 {
<a name="l01456"></a>01456         <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#ab87dc30a6ce46c938b359437fc7cc662">D_DENTRY</a>, <span class="stringliteral">&quot;invalidate dentry %.*s (%p) parent %p inode %p &quot;</span>
<a name="l01457"></a>01457                <span class="stringliteral">&quot;refc %d\n&quot;</span>, dentry-&gt;d_name.len, dentry-&gt;d_name.name, dentry,
<a name="l01458"></a>01458                dentry-&gt;d_parent, dentry-&gt;d_inode, <a class="code" href="lustre__patchless__compat_8h.html#a73e730841e6bbf8f27f896b6f2764317">ll_d_count</a>(dentry));
<a name="l01459"></a>01459 
<a name="l01460"></a>01460         spin_lock_nested(&amp;dentry-&gt;d_lock,
<a name="l01461"></a>01461                          nested ? DENTRY_D_LOCK_NESTED : DENTRY_D_LOCK_NORMAL);
<a name="l01462"></a>01462         <a class="code" href="llite__internal_8h.html#ab2c6ed8d6462a88cb8c3a277d97a927d">__d_lustre_invalidate</a>(dentry);
<a name="l01463"></a>01463         <span class="comment">/*</span>
<a name="l01464"></a>01464 <span class="comment">         * We should be careful about dentries created by d_obtain_alias().</span>
<a name="l01465"></a>01465 <span class="comment">         * These dentries are not put in the dentry tree, instead they are</span>
<a name="l01466"></a>01466 <span class="comment">         * linked to sb-&gt;s_anon through dentry-&gt;d_hash.</span>
<a name="l01467"></a>01467 <span class="comment">         * shrink_dcache_for_umount() shrinks the tree and sb-&gt;s_anon list.</span>
<a name="l01468"></a>01468 <span class="comment">         * If we unhashed such a dentry, unmount would not be able to find</span>
<a name="l01469"></a>01469 <span class="comment">         * it and busy inodes would be reported.</span>
<a name="l01470"></a>01470 <span class="comment">         */</span>
<a name="l01471"></a>01471         <span class="keywordflow">if</span> (<a class="code" href="lustre__patchless__compat_8h.html#a73e730841e6bbf8f27f896b6f2764317">ll_d_count</a>(dentry) == 0 &amp;&amp; !(dentry-&gt;d_flags &amp; DCACHE_DISCONNECTED))
<a name="l01472"></a>01472                 __d_drop(dentry);
<a name="l01473"></a>01473         spin_unlock(&amp;dentry-&gt;d_lock);
<a name="l01474"></a>01474 }
<a name="l01475"></a>01475 
<a name="l01476"></a><a class="code" href="llite__internal_8h.html#a042f363cbfc4c8b56baf96867c02d1a5">01476</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a042f363cbfc4c8b56baf96867c02d1a5">d_lustre_revalidate</a>(<span class="keyword">struct</span> dentry *dentry)
<a name="l01477"></a>01477 {
<a name="l01478"></a>01478         spin_lock(&amp;dentry-&gt;d_lock);
<a name="l01479"></a>01479         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(<a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">ll_d2d</a>(dentry) != NULL);
<a name="l01480"></a>01480         <a class="code" href="llite__internal_8h.html#ae8292e6297c0806fdadc56d658ad209b">ll_d2d</a>(dentry)-&gt;lld_invalid = 0;
<a name="l01481"></a>01481         spin_unlock(&amp;dentry-&gt;d_lock);
<a name="l01482"></a>01482 }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#aad0e01b10871ba010c5c5bf16715cac3">ll_layout_conf</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structcl__object__conf.html" title="Description of the client object configuration.">cl_object_conf</a> *conf);
<a name="l01485"></a>01485 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a6097aa05b339d83f30b9116d71e3a8cf" title="This function checks if there exists a LAYOUT lock on the client side, or enqueues...">ll_layout_refresh</a>(<span class="keyword">struct</span> inode *inode, __u32 *gen);
<a name="l01486"></a>01486 <span class="keywordtype">int</span> <a class="code" href="file_8c.html#a9ddb9a2a80df52ed287dad8a9c7bc12f" title="This function send a restore request to the MDT.">ll_layout_restore</a>(<span class="keyword">struct</span> inode *inode, loff_t <a class="code" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> length);
<a name="l01487"></a>01487 
<a name="l01488"></a>01488 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#ae15783ba66f3eb4b365054de918d3f3b">ll_xattr_init</a>(<span class="keywordtype">void</span>);
<a name="l01489"></a>01489 <span class="keywordtype">void</span> <a class="code" href="llite__internal_8h.html#a92164220fab4a79ac9d40af0aef4781e">ll_xattr_fini</a>(<span class="keywordtype">void</span>);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a80064dd1fa9ba3ed46e5a1266a1f0900">ll_getxattr_common</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l01492"></a>01492                        <span class="keywordtype">void</span> *buffer, <span class="keywordtype">size_t</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> valid);
<a name="l01493"></a>01493 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a477c186c9df2480d495743692ae75553">ll_page_sync_io</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structcl__io.html" title="State for io.">cl_io</a> *io,
<a name="l01494"></a>01494                     <span class="keyword">struct</span> <a class="code" href="structcl__page.html" title="Fields are protected by the lock on struct page, except for atomics and immutables...">cl_page</a> *page, <span class="keyword">enum</span> <a class="code" href="group__cl__page.html#ga419215a2ca4eeab85983de8ca5a16a02" title="Requested transfer type.">cl_req_type</a> crt);
<a name="l01495"></a>01495 
<a name="l01496"></a>01496 <span class="keywordtype">int</span> <a class="code" href="llite__internal_8h.html#a7f3efefc1a3acba8a6dd6929a6c4429f" title="Get parent FID and name of an identified link.">ll_getparent</a>(<span class="keyword">struct</span> file *file, <span class="keyword">struct</span> <a class="code" href="structgetparent.html" title="path2parent request/reply structures">getparent</a> <a class="code" href="ioctl_8h.html#ace6f17999da4ea3b93c4227beafcab95">__user</a> *arg);
<a name="l01497"></a>01497 
<a name="l01498"></a>01498 <span class="comment">/* lcommon_cl.c */</span>
<a name="l01499"></a>01499 <span class="keywordtype">int</span> <a class="code" href="lcommon__cl_8c.html#ab4ddeb93e9aa9cac230107519e85c12b">cl_setattr_ost</a>(<span class="keyword">struct</span> <a class="code" href="structcl__object.html" title="Sub-class of lu_object with methods common for objects on the client stacks.">cl_object</a> *obj, <span class="keyword">const</span> <span class="keyword">struct</span> iattr *attr,
<a name="l01500"></a>01500                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> attr_flags);
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *<a class="code" href="lcommon__cl_8c.html#a0f1d0a2f44b41752a5c6f50d524f2678" title="An `emergency&amp;#39; environment used by cl_inode_fini() when cl_env_get() fails.">cl_inode_fini_env</a>;
<a name="l01503"></a>01503 <span class="keyword">extern</span> __u16 <a class="code" href="lcommon__cl_8c.html#a1ab14f15a78e26f3eaedd5a100900643">cl_inode_fini_refcheck</a>;
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 <span class="keywordtype">int</span> <a class="code" href="lcommon__cl_8c.html#ab5a34b3106b1f1d8fe6705b5c568f0c6" title="Initialize or update CLIO structures for regular files when new meta-data arrives...">cl_file_inode_init</a>(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> <a class="code" href="structlustre__md.html">lustre_md</a> *md);
<a name="l01506"></a>01506 <span class="keywordtype">void</span> <a class="code" href="lcommon__cl_8c.html#a522981af77da3b98a01c053f7e18a0c6">cl_inode_fini</a>(<span class="keyword">struct</span> inode *inode);
<a name="l01507"></a>01507 
<a name="l01508"></a>01508 u64 <a class="code" href="lcommon__cl_8c.html#a2bbbb914dc13833adb36e85b8a2fc5e0" title="build inode number from passed ">cl_fid_build_ino</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid, <span class="keywordtype">int</span> api32);
<a name="l01509"></a>01509 u32 <a class="code" href="lcommon__cl_8c.html#a97bb21550c942b0f86706150334462cb" title="build inode generation from passed .">cl_fid_build_gen</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l01510"></a>01510 
<a name="l01511"></a>01511 <span class="preprocessor">#endif </span><span class="comment">/* LLITE_INTERNAL_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:36 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
