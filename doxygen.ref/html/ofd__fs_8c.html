<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ofd/ofd_fs.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ofd/ofd_fs.c File Reference</h1><code>#include &quot;<a class="el" href="ofd__internal_8h_source.html">ofd_internal.h</a>&quot;</code><br/>

<p><a href="ofd__fs_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_FILTER</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#aad0ed2371c99ff9007c8963b60bb47d5">ofd_precreate_batch</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, int batch)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Restrict precreate batch count by its upper limit.  <a href="#aad0ed2371c99ff9007c8963b60bb47d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a6507e38efbceeb8037a85d4a4a7a0e74">ofd_seq_get</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, u64 seq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get <a class="el" href="structofd__seq.html">ofd_seq</a> for <em>seq</em>.  <a href="#a6507e38efbceeb8037a85d4a4a7a0e74"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a1a85189347d12ff0d970c7a49b5a6331">ofd_seq_put</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__seq.html">ofd_seq</a> *oseq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Drop a reference to <a class="el" href="structofd__seq.html">ofd_seq</a>.  <a href="#a1a85189347d12ff0d970c7a49b5a6331"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#aed2ed593511fc8bfd8956710f694853e">ofd_seq_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, struct <a class="el" href="structofd__seq.html">ofd_seq</a> *new_seq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a new <a class="el" href="structofd__seq.html">ofd_seq</a> to the given OFD device.  <a href="#aed2ed593511fc8bfd8956710f694853e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">u64&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a98c3a57bca104c0247e3bf2c9edde525">ofd_seq_last_oid</a> (struct <a class="el" href="structofd__seq.html">ofd_seq</a> *oseq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get last object ID for the given sequence.  <a href="#a98c3a57bca104c0247e3bf2c9edde525"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a53b878498f900554e87c79dd176abe9f">ofd_seq_last_oid_set</a> (struct <a class="el" href="structofd__seq.html">ofd_seq</a> *oseq, u64 id)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set new last object ID for the given sequence.  <a href="#a53b878498f900554e87c79dd176abe9f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a0e8216b91fa99c0ef833dc36059f25e9">ofd_seq_last_oid_write</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, struct <a class="el" href="structofd__seq.html">ofd_seq</a> *oseq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update last used OID on disk for the given sequence.  <a href="#a0e8216b91fa99c0ef833dc36059f25e9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a8f93cf4635e61de2e21e4f0dc390310f">ofd_deregister_seq_exp</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deregister LWP items for FLDB and SEQ client on OFD.  <a href="#a8f93cf4635e61de2e21e4f0dc390310f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#ae02685312fe3304a8d1cff430670dfae">ofd_fld_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop FLDB server on OFD.  <a href="#ae02685312fe3304a8d1cff430670dfae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a6ed155b23c822c61f6eacf4eda65d847">ofd_seqs_free</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free sequence structures on OFD.  <a href="#a6ed155b23c822c61f6eacf4eda65d847"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#aaf7ceb2e214dd8f5f7bfb79bfde55294">ofd_seqs_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stop FLDB and SEQ services on OFD.  <a href="#aaf7ceb2e214dd8f5f7bfb79bfde55294"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#ad84239bc5d9db54e5bdc961bb89924c0">ofd_seq_load</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, u64 seq)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return <a class="el" href="structofd__seq.html">ofd_seq</a> structure filled with valid data.  <a href="#ad84239bc5d9db54e5bdc961bb89924c0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a1d3691e650a4383abfc240697039120f">ofd_fld_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, const char *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize local FLDB server.  <a href="#a1d3691e650a4383abfc240697039120f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a5ac224ea9d8b5437305c36af66bfcba7">ofd_register_lwp_callback</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update local FLDB copy from master server.  <a href="#a5ac224ea9d8b5437305c36af66bfcba7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#ac01787fe23ba7713603e28f13a2153f3">ofd_register_seq_exp</a> (struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get LWP exports from LWP connection for local FLDB server and SEQ client.  <a href="#ac01787fe23ba7713603e28f13a2153f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a8e0f9a8309ee9b967ccc0f52efaa8a80">ofd_seqs_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize SEQ and FLD service on OFD.  <a href="#a8e0f9a8309ee9b967ccc0f52efaa8a80"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a09cb79bda92756a3fff7a04dcf19f75b">ofd_fs_setup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd, struct <a class="el" href="structobd__device.html">obd_device</a> *obd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize storage for the OFD.  <a href="#a09cb79bda92756a3fff7a04dcf19f75b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ofd__fs_8c.html#a289144fa393d3d5eacc6e494dfb3aef6">ofd_fs_cleanup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structofd__device.html">ofd_device</a> *ofd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cleanup service files on OFD.  <a href="#a289144fa393d3d5eacc6e494dfb3aef6"></a><br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="ofd_fs.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_FILTER</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00045">45</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8f93cf4635e61de2e21e4f0dc390310f"></a><!-- doxytag: member="ofd_fs.c::ofd_deregister_seq_exp" ref="a8f93cf4635e61de2e21e4f0dc390310f" args="(struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_deregister_seq_exp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deregister LWP items for FLDB and SEQ client on OFD. </p>
<p>LWP is lightweight proxy - simplified connection between servers. It is used for FID Location Database (FLDB) and sequence (SEQ) client-server interactions.</p>
<p>This function is used during server cleanup process to free LWP items that were previously set up upon OFD start.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00259">259</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="lustre__fid_8h_source.html#l00353">lu_client_seq::lcs_exp</a>, <a class="el" href="lustre__fld_8h_source.html#l00085">lu_server_fld::lsf_control_exp</a>, <a class="el" href="obd__mount__server_8c_source.html#l00458">lustre_deregister_lwp_item()</a>, <a class="el" href="ofd__internal_8h_source.html#l00186">ofd_device::ofd_seq_site</a>, <a class="el" href="lustre__fid_8h_source.html#l00475">seq_server_site::ss_client_seq</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00332">ofd_seqs_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="ae02685312fe3304a8d1cff430670dfae"></a><!-- doxytag: member="ofd_fs.c::ofd_fld_fini" ref="ae02685312fe3304a8d1cff430670dfae" args="(const struct lu_env *env, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ofd_fld_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop FLDB server on OFD. </p>
<p>This function is part of OFD cleanup process.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00283">283</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="fld__handler_8c_source.html#l00487">fld_server_fini()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00186">ofd_device::ofd_seq_site</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00332">ofd_seqs_fini()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00572">ofd_seqs_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a1d3691e650a4383abfc240697039120f"></a><!-- doxytag: member="ofd_fs.c::ofd_fld_init" ref="a1d3691e650a4383abfc240697039120f" args="(const struct lu_env *env, const char *uuid, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_fld_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize local FLDB server. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>uuid</em>&nbsp;</td><td>unique name for this FLDS server </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful initialization </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00449">449</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="fld__handler_8c_source.html#l00443">fld_server_init()</a>, <a class="el" href="lustre__idl_8h_source.html#l00167">LU_SEQ_RANGE_OST</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__internal_8h_source.html#l00186">ofd_device::ofd_seq_site</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00572">ofd_seqs_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a289144fa393d3d5eacc6e494dfb3aef6"></a><!-- doxytag: member="ofd_fs.c::ofd_fs_cleanup" ref="a289144fa393d3d5eacc6e494dfb3aef6" args="(const struct lu_env *env, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_fs_cleanup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Cleanup service files on OFD. </p>
<p>This function syncs whole OFD device and close "health check" file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00666">666</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00277">CWARN</a>, <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="dt__object_8h_source.html#l02465">dt_sync()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00126">ofd_device::ofd_health_check_file</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, and <a class="el" href="ofd__fs_8c_source.html#l00332">ofd_seqs_fini()</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l02983">ofd_fini()</a>, and <a class="el" href="ofd__dev_8c_source.html#l02814">ofd_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="a09cb79bda92756a3fff7a04dcf19f75b"></a><!-- doxytag: member="ofd_fs.c::ofd_fs_setup" ref="a09cb79bda92756a3fff7a04dcf19f75b" args="(const struct lu_env *env, struct ofd_device *ofd, struct obd_device *obd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_fs_setup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__device.html">obd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>obd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize storage for the OFD. </p>
<p>This function sets up service files for OFD. Currently, the only service file is "health_check".</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>obd</em>&nbsp;</td><td>OBD device (unused now)</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful setup </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00621">621</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8c_source.html#l00388">dt_find_or_create()</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ofd__internal_8h_source.html#l00299">ofd_thread_info::fti_attr</a>, <a class="el" href="ofd__internal_8h_source.html#l00315">ofd_thread_info::fti_dof</a>, <a class="el" href="ofd__internal_8h_source.html#l00298">ofd_thread_info::fti_fid</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lustre__fid_8h_source.html#l00242">lu_local_obj_fid()</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00212">OBD_FAIL_MDS_FS_SETUP</a>, <a class="el" href="ofd__internal_8h_source.html#l00126">ofd_device::ofd_health_check_file</a>, <a class="el" href="lustre__fid_8h_source.html#l00232">OFD_HEALTH_CHECK_OID</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__fs_8c_source.html#l00332">ofd_seqs_fini()</a>, <a class="el" href="ofd__fs_8c_source.html#l00572">ofd_seqs_init()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l02814">ofd_init0()</a>.</p>

</div>
</div>
<a class="anchor" id="aad0ed2371c99ff9007c8963b60bb47d5"></a><!-- doxytag: member="ofd_fs.c::ofd_precreate_batch" ref="aad0ed2371c99ff9007c8963b60bb47d5" args="(struct ofd_device *ofd, int batch)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_precreate_batch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>batch</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Restrict precreate batch count by its upper limit. </p>
<p>The precreate batch count is a number of precreates to do in single transaction. It has upper limit - <a class="el" href="structofd__device.html#ab0c56062b60a7f9e5ca8f21d798433b5">ofd_device::ofd_precreate_batch</a> value which shouldn't be exceeded.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>batch</em>&nbsp;</td><td>number of updates in the batch</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>\a</em>&nbsp;</td><td>batch limited by <a class="el" href="structofd__device.html#ab0c56062b60a7f9e5ca8f21d798433b5">ofd_device::ofd_precreate_batch</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00061">61</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="ofd__internal_8h_source.html#l00136">ofd_device::ofd_batch_lock</a>, and <a class="el" href="ofd__internal_8h_source.html#l00135">ofd_device::ofd_precreate_batch</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01084">ofd_echo_create()</a>, and <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a5ac224ea9d8b5437305c36af66bfcba7"></a><!-- doxytag: member="ofd_fs.c::ofd_register_lwp_callback" ref="a5ac224ea9d8b5437305c36af66bfcba7" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_register_lwp_callback </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update local FLDB copy from master server. </p>
<p>This callback is called when LWP is connected to the server. It retrieves its FLDB entries from MDT0, and it only happens when upgrading the existing file system to 2.6.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful FLDB update </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value in case if failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00483">483</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="fld__handler_8c_source.html#l00128">fld_update_from_controller()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lu__object_8h_source.html#l00999">LCT_DT_THREAD</a>, <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="lustre__fld_8h_source.html#l00109">lu_server_fld::lsf_new</a>, <a class="el" href="lu__object_8c_source.html#l01881">lu_env_fini()</a>, <a class="el" href="lu__object_8c_source.html#l01869">lu_env_init()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00186">ofd_device::ofd_seq_site</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00527">ofd_register_seq_exp()</a>.</p>

</div>
</div>
<a class="anchor" id="ac01787fe23ba7713603e28f13a2153f3"></a><!-- doxytag: member="ofd_fs.c::ofd_register_seq_exp" ref="ac01787fe23ba7713603e28f13a2153f3" args="(struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ofd_register_seq_exp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get LWP exports from LWP connection for local FLDB server and SEQ client. </p>
<p>This function is part of setup process and initialize FLDB server and SEQ client, so they may work with remote servers.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful export get </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00527">527</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__fid_8h_source.html#l00353">lu_client_seq::lcs_exp</a>, <a class="el" href="lustre__fld_8h_source.html#l00085">lu_server_fld::lsf_control_exp</a>, <a class="el" href="obd__mount__server_8c_source.html#l00458">lustre_deregister_lwp_item()</a>, <a class="el" href="obd__mount__server_8c_source.html#l00405">lustre_register_lwp_item()</a>, <a class="el" href="lustre__user_8h_source.html#l00316">MAX_OBD_NAME</a>, <a class="el" href="obd__support_8h_source.html#l00708">OBD_ALLOC</a>, <a class="el" href="obd__support_8h_source.html#l00776">OBD_FREE</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__fs_8c_source.html#l00483">ofd_register_lwp_callback()</a>, <a class="el" href="ofd__internal_8h_source.html#l00186">ofd_device::ofd_seq_site</a>, <a class="el" href="lustre__fid_8h_source.html#l00475">seq_server_site::ss_client_seq</a>, <a class="el" href="lustre__fid_8h_source.html#l00458">seq_server_site::ss_server_fld</a>, and <a class="el" href="obd__mount__server_8c_source.html#l00349">tgt_name2lwp_name()</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00572">ofd_seqs_init()</a>.</p>

</div>
</div>
<a class="anchor" id="aed2ed593511fc8bfd8956710f694853e"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_add" ref="aed2ed593511fc8bfd8956710f694853e" args="(const struct lu_env *env, struct ofd_device *ofd, struct ofd_seq *new_seq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structofd__seq.html">ofd_seq</a>* ofd_seq_add </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>new_seq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a new <a class="el" href="structofd__seq.html">ofd_seq</a> to the given OFD device. </p>
<p>First it checks if there is already existent <a class="el" href="structofd__seq.html">ofd_seq</a> with the same sequence number as used by <em>new_seq</em>. If such <a class="el" href="structofd__seq.html">ofd_seq</a> is not found then the <em>new_seq</em> is added to the list of all <a class="el" href="structofd__seq.html">ofd_seq</a> structures else the <em>new_seq</em> is dropped and the found <a class="el" href="structofd__seq.html">ofd_seq</a> is returned back.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>new_seq</em>&nbsp;</td><td>new <a class="el" href="structofd__seq.html">ofd_seq</a> to be added</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structofd__seq.html">ofd_seq</a></em>&nbsp;</td><td>structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00134">134</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="ofd__internal_8h_source.html#l00134">ofd_device::ofd_seq_count</a>, <a class="el" href="ofd__internal_8h_source.html#l00132">ofd_device::ofd_seq_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00133">ofd_device::ofd_seq_list_lock</a>, <a class="el" href="ofd__fs_8c_source.html#l00109">ofd_seq_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00107">ofd_seq::os_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="ofd__internal_8h_source.html#l00111">ofd_seq::os_refc</a>, and <a class="el" href="lustre__idl_8h_source.html#l00531">ostid_seq()</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>.</p>

</div>
</div>
<a class="anchor" id="a6507e38efbceeb8037a85d4a4a7a0e74"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_get" ref="a6507e38efbceeb8037a85d4a4a7a0e74" args="(struct ofd_device *ofd, u64 seq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structofd__seq.html">ofd_seq</a>* ofd_seq_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&nbsp;</td>
          <td class="paramname"> <em>seq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get <a class="el" href="structofd__seq.html">ofd_seq</a> for <em>seq</em>. </p>
<p>Function finds appropriate structure by <em>seq</em> number and increases the reference counter of that structure.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seq</em>&nbsp;</td><td>sequence number, FID sequence number usually</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pointer</em>&nbsp;</td><td>to the requested <a class="el" href="structofd__seq.html">ofd_seq</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if <a class="el" href="structofd__seq.html">ofd_seq</a> is not found </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00084">84</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="ofd__internal_8h_source.html#l00132">ofd_device::ofd_seq_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00133">ofd_device::ofd_seq_list_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00107">ofd_seq::os_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="ofd__internal_8h_source.html#l00111">ofd_seq::os_refc</a>, and <a class="el" href="lustre__idl_8h_source.html#l00531">ostid_seq()</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01461">ofd_orphans_destroy()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>.</p>

</div>
</div>
<a class="anchor" id="a98c3a57bca104c0247e3bf2c9edde525"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_last_oid" ref="a98c3a57bca104c0247e3bf2c9edde525" args="(struct ofd_seq *oseq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u64 ofd_seq_last_oid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>oseq</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get last object ID for the given sequence. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oseq</em>&nbsp;</td><td>OFD sequence structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>last object ID for this sequence </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00164">164</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="ofd__internal_8h_source.html#l00109">ofd_seq::os_last_oid_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, and <a class="el" href="lustre__idl_8h_source.html#l00546">ostid_id()</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01084">ofd_echo_create()</a>, <a class="el" href="ofd__dev_8c_source.html#l01136">ofd_get_info_hdl()</a>, <a class="el" href="ofd__dev_8c_source.html#l01461">ofd_orphans_destroy()</a>, <a class="el" href="ofd__objects_8c_source.html#l00206">ofd_precreate_objects()</a>, <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00204">ofd_seq_last_oid_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a53b878498f900554e87c79dd176abe9f"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_last_oid_set" ref="a53b878498f900554e87c79dd176abe9f" args="(struct ofd_seq *oseq, u64 id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_seq_last_oid_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>oseq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set new last object ID for the given sequence. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oseq</em>&nbsp;</td><td>OFD sequence </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>id</em>&nbsp;</td><td>the new OID to set </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00181">181</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__private_8h_source.html#l00309">likely</a>, <a class="el" href="ofd__internal_8h_source.html#l00109">ofd_seq::os_last_oid_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="lustre__idl_8h_source.html#l00546">ostid_id()</a>, and <a class="el" href="lustre__idl_8h_source.html#l00594">ostid_set_id()</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__dev_8c_source.html#l01461">ofd_orphans_destroy()</a>, <a class="el" href="ofd__objects_8c_source.html#l00206">ofd_precreate_objects()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>.</p>

</div>
</div>
<a class="anchor" id="a0e8216b91fa99c0ef833dc36059f25e9"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_last_oid_write" ref="a0e8216b91fa99c0ef833dc36059f25e9" args="(const struct lu_env *env, struct ofd_device *ofd, struct ofd_seq *oseq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_seq_last_oid_write </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>oseq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update last used OID on disk for the given sequence. </p>
<p>The last used object ID is stored persistently on disk and must be written when updated. This function writes the sequence data. The format is just an object ID of the latest used object FID. Each ID is stored in per-sequence file.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oseq</em>&nbsp;</td><td><a class="el" href="structofd__seq.html">ofd_seq</a> structure with data to write</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful write of data from <em>oseq</em> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00204">204</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="byteorder_8h_source.html#l00059">cpu_to_le64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00130">D_INODE</a>, <a class="el" href="lustre__user_8h_source.html#l00223">DOSTID</a>, <a class="el" href="dt__object_8h_source.html#l02087">dt_declare_record_write()</a>, <a class="el" href="dt__object_8c_source.html#l00504">dt_record_write()</a>, <a class="el" href="dt__object_8h_source.html#l02047">dt_trans_create()</a>, <a class="el" href="dt__object_8h_source.html#l02062">dt_trans_start_local()</a>, <a class="el" href="dt__object_8h_source.html#l02070">dt_trans_stop()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00317">ofd_thread_info::fti_off</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__fs_8c_source.html#l00164">ofd_seq_last_oid()</a>, <a class="el" href="ofd__internal_8h_source.html#l00112">ofd_seq::os_lastid_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="lustre__user_8h_source.html#l00224">POSTID</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01461">ofd_orphans_destroy()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>.</p>

</div>
</div>
<a class="anchor" id="ad84239bc5d9db54e5bdc961bb89924c0"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_load" ref="ad84239bc5d9db54e5bdc961bb89924c0" args="(const struct lu_env *env, struct ofd_device *ofd, u64 seq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structofd__seq.html">ofd_seq</a>* ofd_seq_load </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&nbsp;</td>
          <td class="paramname"> <em>seq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return <a class="el" href="structofd__seq.html">ofd_seq</a> structure filled with valid data. </p>
<p>This function gets the <a class="el" href="structofd__seq.html">ofd_seq</a> by sequence number and read corresponding data from disk.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>seq</em>&nbsp;</td><td>sequence number</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structofd__seq.html">ofd_seq</a></em>&nbsp;</td><td>structure filled with data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ERR_PTR</em>&nbsp;</td><td>pointer on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00362">362</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="fsx_8c_source.html#l01082">cleanup()</a>, <a class="el" href="dt__object_8h_source.html#l00396">dt_object_format::dof_type</a>, <a class="el" href="dt__object_8h_source.html#l02225">dt_attr_get()</a>, <a class="el" href="dt__object_8c_source.html#l00388">dt_find_or_create()</a>, <a class="el" href="dt__object_8c_source.html#l00192">dt_mode_to_dft()</a>, <a class="el" href="dt__object_8c_source.html#l00490">dt_record_read()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="ofd__internal_8h_source.html#l00299">ofd_thread_info::fti_attr</a>, <a class="el" href="ofd__internal_8h_source.html#l00316">ofd_thread_info::fti_buf</a>, <a class="el" href="ofd__internal_8h_source.html#l00315">ofd_thread_info::fti_dof</a>, <a class="el" href="ofd__internal_8h_source.html#l00298">ofd_thread_info::fti_fid</a>, <a class="el" href="ofd__internal_8h_source.html#l00317">ofd_thread_info::fti_off</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="lu__object_8h_source.html#l00419">lu_attr::la_mode</a>, <a class="el" href="lu__object_8h_source.html#l00448">LA_MODE</a>, <a class="el" href="lu__object_8h_source.html#l00409">lu_attr::la_size</a>, <a class="el" href="lu__object_8h_source.html#l00439">lu_attr::la_valid</a>, <a class="el" href="lu__object_8h_source.html#l01335">lu_buf::lb_buf</a>, <a class="el" href="lu__object_8h_source.html#l01336">lu_buf::lb_len</a>, <a class="el" href="byteorder_8h_source.html#l00058">le64_to_cpu</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__disk_8h_source.html#l00344">lr_server_data::lsd_osd_index</a>, <a class="el" href="lustre__fid_8h_source.html#l00318">lu_last_id_fid()</a>, <a class="el" href="lu__target_8h_source.html#l00144">lu_target::lut_lsd</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00501">ofd_info()</a>, <a class="el" href="ofd__internal_8h_source.html#l00046">OFD_INIT_OBJID</a>, <a class="el" href="ofd__internal_8h_source.html#l00125">ofd_device::ofd_lut</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00118">ofd_device::ofd_osd</a>, <a class="el" href="ofd__fs_8c_source.html#l00134">ofd_seq_add()</a>, <a class="el" href="ofd__fs_8c_source.html#l00084">ofd_seq_get()</a>, <a class="el" href="ofd__fs_8c_source.html#l00181">ofd_seq_last_oid_set()</a>, <a class="el" href="ofd__fs_8c_source.html#l00204">ofd_seq_last_oid_write()</a>, <a class="el" href="ofd__fs_8c_source.html#l00109">ofd_seq_put()</a>, <a class="el" href="ofd__internal_8h_source.html#l00110">ofd_seq::os_create_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00109">ofd_seq::os_last_oid_lock</a>, <a class="el" href="ofd__internal_8h_source.html#l00112">ofd_seq::os_lastid_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00107">ofd_seq::os_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00108">ofd_seq::os_oi</a>, <a class="el" href="ofd__internal_8h_source.html#l00111">ofd_seq::os_refc</a>, <a class="el" href="lustre__idl_8h_source.html#l00561">ostid_set_seq()</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01084">ofd_echo_create()</a>, <a class="el" href="ofd__dev_8c_source.html#l01136">ofd_get_info_hdl()</a>, <a class="el" href="ofd__io_8c_source.html#l00685">ofd_preprw()</a>, and <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a85189347d12ff0d970c7a49b5a6331"></a><!-- doxytag: member="ofd_fs.c::ofd_seq_put" ref="a1a85189347d12ff0d970c7a49b5a6331" args="(const struct lu_env *env, struct ofd_seq *oseq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_seq_put </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__seq.html">ofd_seq</a> *&nbsp;</td>
          <td class="paramname"> <em>oseq</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Drop a reference to <a class="el" href="structofd__seq.html">ofd_seq</a>. </p>
<p>The paired function to the <a class="el" href="ofd__fs_8c.html#a6507e38efbceeb8037a85d4a4a7a0e74" title="Get ofd_seq for seq.">ofd_seq_get()</a>. It decrease the reference counter of the <a class="el" href="structofd__seq.html">ofd_seq</a> structure and free it if that reference was last one.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>oseq</em>&nbsp;</td><td><a class="el" href="structofd__seq.html">ofd_seq</a> structure to put </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00109">109</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="dt__object_8h_source.html#l01750">dt_object::do_lu</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="lu__object_8c_source.html#l00097">lu_object_put()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="ofd__internal_8h_source.html#l00112">ofd_seq::os_lastid_obj</a>, <a class="el" href="ofd__internal_8h_source.html#l00107">ofd_seq::os_list</a>, and <a class="el" href="ofd__internal_8h_source.html#l00111">ofd_seq::os_refc</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l01553">ofd_create_hdl()</a>, <a class="el" href="ofd__obd_8c_source.html#l01084">ofd_echo_create()</a>, <a class="el" href="ofd__dev_8c_source.html#l01136">ofd_get_info_hdl()</a>, <a class="el" href="ofd__dev_8c_source.html#l01461">ofd_orphans_destroy()</a>, <a class="el" href="ofd__io_8c_source.html#l00685">ofd_preprw()</a>, <a class="el" href="ofd__io_8c_source.html#l00524">ofd_preprw_write()</a>, <a class="el" href="ofd__fs_8c_source.html#l00134">ofd_seq_add()</a>, <a class="el" href="ofd__fs_8c_source.html#l00362">ofd_seq_load()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00304">ofd_seqs_free()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf7ceb2e214dd8f5f7bfb79bfde55294"></a><!-- doxytag: member="ofd_fs.c::ofd_seqs_fini" ref="aaf7ceb2e214dd8f5f7bfb79bfde55294" args="(const struct lu_env *env, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_seqs_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stop FLDB and SEQ services on OFD. </p>
<p>This function is part of OFD cleanup process.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00332">332</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="ofd__fs_8c_source.html#l00259">ofd_deregister_seq_exp()</a>, <a class="el" href="ofd__dev_8c_source.html#l00802">ofd_fid_fini()</a>, <a class="el" href="ofd__fs_8c_source.html#l00283">ofd_fld_fini()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__internal_8h_source.html#l00132">ofd_device::ofd_seq_list</a>, and <a class="el" href="ofd__fs_8c_source.html#l00304">ofd_seqs_free()</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00666">ofd_fs_cleanup()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00621">ofd_fs_setup()</a>.</p>

</div>
</div>
<a class="anchor" id="a6ed155b23c822c61f6eacf4eda65d847"></a><!-- doxytag: member="ofd_fs.c::ofd_seqs_free" ref="a6ed155b23c822c61f6eacf4eda65d847" args="(const struct lu_env *env, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ofd_seqs_free </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free sequence structures on OFD. </p>
<p>This function is part of OFD cleanup process, it goes through the list of <a class="el" href="structofd__seq.html">ofd_seq</a> structures stored in <a class="el" href="structofd__device.html">ofd_device</a> structure and frees them.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00304">304</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="list_8h_source.html#l00125">list_del_init()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00484">list_for_each_entry_safe</a>, <a class="el" href="list_8h_source.html#l00137">list_move()</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="ofd__internal_8h_source.html#l00132">ofd_device::ofd_seq_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00133">ofd_device::ofd_seq_list_lock</a>, <a class="el" href="ofd__fs_8c_source.html#l00109">ofd_seq_put()</a>, and <a class="el" href="ofd__internal_8h_source.html#l00107">ofd_seq::os_list</a>.</p>

<p>Referenced by <a class="el" href="ofd__dev_8c_source.html#l00528">ofd_lfsck_out_notify()</a>, and <a class="el" href="ofd__fs_8c_source.html#l00332">ofd_seqs_fini()</a>.</p>

</div>
</div>
<a class="anchor" id="a8e0f9a8309ee9b967ccc0f52efaa8a80"></a><!-- doxytag: member="ofd_fs.c::ofd_seqs_init" ref="a8e0f9a8309ee9b967ccc0f52efaa8a80" args="(const struct lu_env *env, struct ofd_device *ofd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ofd_seqs_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structofd__device.html">ofd_device</a> *&nbsp;</td>
          <td class="paramname"> <em>ofd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize SEQ and FLD service on OFD. </p>
<p>This is part of OFD setup process.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>execution environment </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ofd</em>&nbsp;</td><td>OFD device</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on successful services initialization </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>negative</em>&nbsp;</td><td>value on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ofd__fs_8c_source.html#l00572">572</a> of file <a class="el" href="ofd__fs_8c_source.html">ofd_fs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="list_8h_source.html#l00048">INIT_LIST_HEAD</a>, <a class="el" href="ofd__dev_8c_source.html#l00802">ofd_fid_fini()</a>, <a class="el" href="ofd__dev_8c_source.html#l00824">ofd_fid_init()</a>, <a class="el" href="ofd__fs_8c_source.html#l00283">ofd_fld_fini()</a>, <a class="el" href="ofd__fs_8c_source.html#l00449">ofd_fld_init()</a>, <a class="el" href="ofd__internal_8h_source.html#l00212">ofd_name()</a>, <a class="el" href="ofd__fs_8c_source.html#l00527">ofd_register_seq_exp()</a>, <a class="el" href="ofd__internal_8h_source.html#l00134">ofd_device::ofd_seq_count</a>, <a class="el" href="ofd__internal_8h_source.html#l00132">ofd_device::ofd_seq_list</a>, <a class="el" href="ofd__internal_8h_source.html#l00133">ofd_device::ofd_seq_list_lock</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

<p>Referenced by <a class="el" href="ofd__fs_8c_source.html#l00621">ofd_fs_setup()</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:49 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
