<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/ptlrpc/import.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lustre/ptlrpc/import.c File Reference</h1><code>#include &lt;linux/kthread.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__support_8h_source.html">obd_support.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__ha_8h_source.html">lustre_ha.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__import_8h_source.html">lustre_import.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="lustre__export_8h_source.html">lustre_export.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd_8h_source.html">obd.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__cksum_8h_source.html">obd_cksum.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="obd__class_8h_source.html">obd_class.h</a>&gt;</code><br/>
<code>#include &quot;<a class="el" href="ptlrpc__internal_8h_source.html">ptlrpc_internal.h</a>&quot;</code><br/>

<p><a href="import_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__connect__async__args.html">ptlrpc_connect_async_args</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#abda60744d497fcfe370cfd6b2d65c7ed">DEBUG_SUBSYSTEM</a>&nbsp;&nbsp;&nbsp;S_RPC</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a3de03177c9f4fec86c7e0a83ab9001cd">IMPORT_SET_STATE_NOLOCK</a>(imp, <a class="el" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#ae4aba243472b9c8742ae27a0fb771496">IMPORT_SET_STATE</a>(imp, <a class="el" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#ae1dbc0e8b13fa127b76f4e195c07a542">UUID_STR</a>&nbsp;&nbsp;&nbsp;&quot;_UUID&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a5ff1a7cec13aa759273ebfad19a2bc5b">__import_set_state</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, enum <a class="el" href="group__export.html#ga342f8de0ae2ad4b6cb54d4072d7a97a0">lustre_imp_state</a> <a class="el" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Updates import <em>imp</em> current state to provided <em>state</em> value Helper function.  <a href="#a5ff1a7cec13aa759273ebfad19a2bc5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga6ad1e58ff4d334ea76093692cc976932">ptlrpc_import_enter_resend</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#abf9dd3227d5b5708fc3626392ca5a018">ptlrpc_connect_interpret</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *request, void *data, int rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">interpret_reply callback for connect RPCs.  <a href="#abf9dd3227d5b5708fc3626392ca5a018"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gae24ff0ea3f19794b41cb4da94ffa9ce2">ptlrpc_import_recovery_state_machine</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is the state machine for client-side recovery on import.  <a href="group__net.html#gae24ff0ea3f19794b41cb4da94ffa9ce2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga4197d19954bc0ced2fd5063ce62b9373">ptlrpc_init_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga7c5dee1feb43474335f9a79fa06e173f">deuuidify</a> (char *<a class="el" href="llog__test_8c.html#aaa83f069991aa91e0383af81ef30f13f">uuid</a>, const char *prefix, char **uuid_start, int *uuid_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a08bb6b823019ef9a42f65210821e8750">ptlrpc_set_import_discon</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, __u32 conn_cnt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if import was FULL, false if import was already not connected.  <a href="#a08bb6b823019ef9a42f65210821e8750"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a6f848065aeee4853de0698588bd4c6e5">ptlrpc_deactivate_and_unlock_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ha.html#gaa2f5b15ea43e40d5cf0ade40337705a5">ptlrpc_deactivate_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a899bee6eb9894ef42cc503d9061166a5">ptlrpc_inflight_deadline</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, time_t now)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a5c0a8df4161b05ea75d51762a038fba0">ptlrpc_inflight_timeout</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ha.html#ga5301cdfd160cb1e18f119fbc8fac3252">ptlrpc_invalidate_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function will invalidate the import, if necessary, then block for all the RPC completions, and finally notify the obd to invalidate its state (ie cancel locks, clear pending requests, etc).  <a href="group__ha.html#ga5301cdfd160cb1e18f119fbc8fac3252"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ha.html#gade2892381fe2d1cb83a0afd69c454850">ptlrpc_activate_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ha.html#ga1498bfee146a727a917aa03b64128a74">ptlrpc_pinger_force</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ha.html#ga06f34c2863693ef75e87b52a27e8b24a">ptlrpc_fail_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, __u32 conn_cnt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga8143184eaf22d5624ea42473dd4e8acc">ptlrpc_reconnect_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#abe79b9cf130d9c2d4a64e983fa718e12">import_select_connection</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connection on import <em>imp</em> is changed to another one (if more than one is present).  <a href="#abe79b9cf130d9c2d4a64e983fa718e12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#aaf33859b8fb1c64e11831214604f7bab">ptlrpc_first_transno</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *transno)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gae524031a54066bf23dda2ad572bbcfdf">ptlrpc_connect_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attempt to (re)connect import <em>imp</em>.  <a href="group__net.html#gae524031a54066bf23dda2ad572bbcfdf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a8f2208d965db2d3f69f46ecf89980bc3">ptlrpc_maybe_ping_import_soon</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#ad1f7e9b7bda44fae555c9835805c31a1">ptlrpc_busy_reconnect</a> (int rc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a8b23bff25d925645bed6b82eb9514c9d">ptlrpc_connect_set_flags</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *ocd, <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> old_connect_flags, struct <a class="el" href="structobd__export.html">obd_export</a> *exp, int init_connect)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a41d5115f707fbbf0bda9956bfcf1011f">ptlrpc_prepare_replay</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add all replay requests back to unreplied list before start replay, so that we can make sure the known replied XID is always increased only even if when replaying requests.  <a href="#a41d5115f707fbbf0bda9956bfcf1011f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a267f9b27e0f188aad3d20300bafe5903">completed_replay_interpret</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req, void *data, int rc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">interpret callback for "completed replay" RPCs.  <a href="#a267f9b27e0f188aad3d20300bafe5903"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a2973325f33cdae5dee6c0787f0339609">signal_completed_replay</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Let server know that we have no requests to replay anymore.  <a href="#a2973325f33cdae5dee6c0787f0339609"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#aac6da6897c797f41634d98a43ca0b810">ptlrpc_invalidate_import_thread</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">In kernel code all import invalidation happens in its own separate thread, so that whatever application happened to encounter a problem could still be killed or otherwise continue.  <a href="#aac6da6897c797f41634d98a43ca0b810"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#gab498b6deeff2988de567a762bcb6e9ad">ptlrpc_disconnect_import</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, int noclose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__net.html#ga01a4895dc2c01104ef9b4b6998d76729">ptlrpc_cleanup_imp</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__export.html#ga7f701ef24e4393b42eb56ffc4777a1d8">at_measured</a> (struct <a class="el" href="structadaptive__timeout.html">adaptive_timeout</a> *at, unsigned int val)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__export.html#ga10463580b3fccbe5eb64e6a26026612a">import_at_get_index</a> (struct <a class="el" href="structobd__import.html">obd_import</a> *imp, int portal)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__export.html#gac018b3cde737ca787e95380e27734ffd">at_min</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__export.html#gad437939efbc33a157b6f386ac4a92ecb">at_max</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abda60744d497fcfe370cfd6b2d65c7ed"></a><!-- doxytag: member="import.c::DEBUG_SUBSYSTEM" ref="abda60744d497fcfe370cfd6b2d65c7ed" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_SUBSYSTEM&nbsp;&nbsp;&nbsp;S_RPC</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00041">41</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae4aba243472b9c8742ae27a0fb771496"></a><!-- doxytag: member="import.c::IMPORT_SET_STATE" ref="ae4aba243472b9c8742ae27a0fb771496" args="(imp, state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMPORT_SET_STATE</td>
          <td>(</td>
          <td class="paramtype">imp, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                    \
        spin_lock(&amp;imp-&gt;imp_lock);                                      \
        <a class="code" href="import_8c.html#a3de03177c9f4fec86c7e0a83ab9001cd">IMPORT_SET_STATE_NOLOCK</a>(imp, <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>);                            \
        spin_unlock(&amp;imp-&gt;imp_lock);                                    \
} <span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="import_8c_source.html#l00099">99</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>, <a class="el" href="import_8c_source.html#l00984">ptlrpc_connect_interpret()</a>, <a class="el" href="import_8c_source.html#l01550">ptlrpc_disconnect_import()</a>, <a class="el" href="import_8c_source.html#l00106">ptlrpc_import_enter_resend()</a>, <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>, and <a class="el" href="import_8c_source.html#l01403">ptlrpc_invalidate_import_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a3de03177c9f4fec86c7e0a83ab9001cd"></a><!-- doxytag: member="import.c::IMPORT_SET_STATE_NOLOCK" ref="a3de03177c9f4fec86c7e0a83ab9001cd" args="(imp, state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IMPORT_SET_STATE_NOLOCK</td>
          <td>(</td>
          <td class="paramtype">imp, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                           \
        <span class="keywordflow">if</span> (imp-&gt;imp_state != <a class="code" href="group__export.html#gga342f8de0ae2ad4b6cb54d4072d7a97a0a51283f733218c7aab1314ba1fa004d34">LUSTRE_IMP_CLOSED</a>) {                             \
               <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a125b66aada63eaccd986e27e8dac1ab2">D_HA</a>, <span class="stringliteral">&quot;%p %s: changing import state from %s to %s\n&quot;</span>,    \
                      imp, <a class="code" href="obd_8h.html#a2f78844a2990c9d3de540a098f26264e">obd2cli_tgt</a>(imp-&gt;imp_obd),                          \
                      <a class="code" href="group__export.html#ga6c3a9e64905d0f9132b76f6379b43f0b" title="Returns test string representation of numeric import state state.">ptlrpc_import_state_name</a>(imp-&gt;imp_state),                \
                      <a class="code" href="group__export.html#ga6c3a9e64905d0f9132b76f6379b43f0b" title="Returns test string representation of numeric import state state.">ptlrpc_import_state_name</a>(<a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>));                        \
               <a class="code" href="import_8c.html#a5ff1a7cec13aa759273ebfad19a2bc5b" title="Updates import imp current state to provided state value Helper function.">__import_set_state</a>(imp, <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>);                                 \
        }                                                                      \
} <span class="keywordflow">while</span>(0)
</pre></div>
<p>Definition at line <a class="el" href="import_8c_source.html#l00088">88</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l01642">ptlrpc_cleanup_imp()</a>, <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>, <a class="el" href="import_8c_source.html#l01550">ptlrpc_disconnect_import()</a>, and <a class="el" href="import_8c_source.html#l00163">ptlrpc_set_import_discon()</a>.</p>

</div>
</div>
<a class="anchor" id="ae1dbc0e8b13fa127b76f4e195c07a542"></a><!-- doxytag: member="import.c::UUID_STR" ref="ae1dbc0e8b13fa127b76f4e195c07a542" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UUID_STR&nbsp;&nbsp;&nbsp;&quot;_UUID&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00136">136</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00137">deuuidify()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a5ff1a7cec13aa759273ebfad19a2bc5b"></a><!-- doxytag: member="import.c::__import_set_state" ref="a5ff1a7cec13aa759273ebfad19a2bc5b" args="(struct obd_import *imp, enum lustre_imp_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __import_set_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__export.html#ga342f8de0ae2ad4b6cb54d4072d7a97a0">lustre_imp_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Updates import <em>imp</em> current state to provided <em>state</em> value Helper function. </p>
<p>Must be called under imp_lock. </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l00064">64</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="lustre__import_8h_source.html#l00232">obd_import::imp_replay_state</a>, <a class="el" href="lustre__import_8h_source.html#l00230">obd_import::imp_state</a>, <a class="el" href="lustre__import_8h_source.html#l00234">obd_import::imp_state_hist</a>, <a class="el" href="lustre__import_8h_source.html#l00235">obd_import::imp_state_hist_idx</a>, <a class="el" href="lustre__import_8h_source.html#l00153">IMP_STATE_HIST_LEN</a>, <a class="el" href="lustre__import_8h_source.html#l00155">import_state_hist::ish_state</a>, <a class="el" href="lustre__import_8h_source.html#l00156">import_state_hist::ish_time</a>, <a class="el" href="lustre__import_8h_source.html#l00098">LUSTRE_IMP_CLOSED</a>, <a class="el" href="lustre__import_8h_source.html#l00101">LUSTRE_IMP_CONNECTING</a>, <a class="el" href="lustre__import_8h_source.html#l00100">LUSTRE_IMP_DISCON</a>, <a class="el" href="lustre__import_8h_source.html#l00099">LUSTRE_IMP_NEW</a>, <a class="el" href="lustre__import_8h_source.html#l00102">LUSTRE_IMP_REPLAY</a>, <a class="el" href="lustre__import_8h_source.html#l00103">LUSTRE_IMP_REPLAY_LOCKS</a>, and <a class="el" href="lustre__import_8h_source.html#l00104">LUSTRE_IMP_REPLAY_WAIT</a>.</p>

</div>
</div>
<a class="anchor" id="a267f9b27e0f188aad3d20300bafe5903"></a><!-- doxytag: member="import.c::completed_replay_interpret" ref="a267f9b27e0f188aad3d20300bafe5903" args="(const struct lu_env *env, struct ptlrpc_request *req, void *data, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int completed_replay_interpret </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>interpret callback for "completed replay" RPCs. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="import_8c.html#a2973325f33cdae5dee6c0787f0339609" title="Let server know that we have no requests to replay anymore.">signal_completed_replay</a> </dd></dl>

<p>Definition at line <a class="el" href="import_8c_source.html#l01338">1338</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="libcfs__debug_8h_source.html#l00139">D_WARNING</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="lustre__import_8h_source.html#l00224">obd_import::imp_replay_inflight</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_vbr_failed</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>, <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01104">ptlrpc_request::rq_import</a>, and <a class="el" href="lustre__net_8h_source.html#l00957">ptlrpc_request::rq_status</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l01368">signal_completed_replay()</a>.</p>

</div>
</div>
<a class="anchor" id="abe79b9cf130d9c2d4a64e983fa718e12"></a><!-- doxytag: member="import.c::import_select_connection" ref="abe79b9cf130d9c2d4a64e983fa718e12" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int import_select_connection </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connection on import <em>imp</em> is changed to another one (if more than one is present). </p>
<p>We typically chose connection that we have not tried to connect to the longest </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l00503">503</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00373">at_get()</a>, <a class="el" href="import_8c_source.html#l01665">at_measured()</a>, <a class="el" href="lustre__import_8h_source.html#l00348">at_reset()</a>, <a class="el" href="lustre__net_8h_source.html#l00521">ptlrpc_connection::c_peer</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="linux-time_8h_source.html#l00248">cfs_time_before_64()</a>, <a class="el" href="linux-time_8h_source.html#l00253">cfs_time_beforeq_64()</a>, <a class="el" href="linux-time_8h_source.html#l00235">cfs_time_current_64</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="obd__support_8h_source.html#l00136">CONNECTION_SWITCH_INC</a>, <a class="el" href="obd__support_8h_source.html#l00135">CONNECTION_SWITCH_MAX</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="import_8c_source.html#l00137">deuuidify()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00217">obd_export::exp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00089">imp_at::iat_net_latency</a>, <a class="el" href="lustre__import_8h_source.html#l00323">obd_import::imp_at</a>, <a class="el" href="lustre__import_8h_source.html#l00271">obd_import::imp_conn_current</a>, <a class="el" href="lustre__import_8h_source.html#l00267">obd_import::imp_conn_list</a>, <a class="el" href="lustre__import_8h_source.html#l00170">obd_import::imp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00168">obd_import::imp_dlm_handle</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_force_reconnect</a>, <a class="el" href="lustre__import_8h_source.html#l00264">obd_import::imp_last_success_conn</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="nidstr_8h_source.html#l00077">libcfs_nid2str()</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00045">LPU64</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, <a class="el" href="lnet_2include_2lnet_2types_8h_source.html#l00304">lnet_process_id_t::nid</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="lustre__import_8h_source.html#l00143">obd_import_conn::oic_conn</a>, <a class="el" href="lustre__import_8h_source.html#l00141">obd_import_conn::oic_item</a>, <a class="el" href="lustre__import_8h_source.html#l00149">obd_import_conn::oic_last_attempt</a>, <a class="el" href="lustre__import_8h_source.html#l00145">obd_import_conn::oic_uuid</a>, <a class="el" href="connection_8c_source.html#l00128">ptlrpc_connection_addref()</a>, <a class="el" href="connection_8c_source.html#l00091">ptlrpc_connection_put()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>.</p>

</div>
</div>
<a class="anchor" id="ad1f7e9b7bda44fae555c9835805c31a1"></a><!-- doxytag: member="import.c::ptlrpc_busy_reconnect" ref="ad1f7e9b7bda44fae555c9835805c31a1" args="(int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_busy_reconnect </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00790">790</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00984">ptlrpc_connect_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="abf9dd3227d5b5708fc3626392ca5a018"></a><!-- doxytag: member="import.c::ptlrpc_connect_interpret" ref="abf9dd3227d5b5708fc3626392ca5a018" args="(const struct lu_env *env, struct ptlrpc_request *request, void *data, int rc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_connect_interpret </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>interpret_reply callback for connect RPCs. </p>
<p>Looks into returned status of connect operation and decides what to do with the import - i.e enter recovery, promote it to full state for normal operations of disconnect it due to an error. </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l00984">984</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>, <a class="el" href="lustre__import_8h_source.html#l00362">at_reinit()</a>, <a class="el" href="lustre__net_8h_source.html#l00523">ptlrpc_connection::c_remote_uuid</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l00708">class_conn2export()</a>, <a class="el" href="genops_8c_source.html#l00812">class_export_put()</a>, <a class="el" href="lustre__idl_8h_source.html#l01017">lustre_handle::cookie</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="libcfs__debug_8h_source.html#l00139">D_WARNING</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__export_8h_source.html#l00243">obd_export::exp_connect_data</a>, <a class="el" href="lustre__export_8h_source.html#l00304">exp_connect_flags()</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="lustre__import_8h_source.html#l00089">imp_at::iat_net_latency</a>, <a class="el" href="lustre__import_8h_source.html#l00323">obd_import::imp_at</a>, <a class="el" href="lustre__import_8h_source.html#l00195">obd_import::imp_committed_list</a>, <a class="el" href="lustre__import_8h_source.html#l00271">obd_import::imp_conn_current</a>, <a class="el" href="lustre__import_8h_source.html#l00316">obd_import::imp_connect_data</a>, <a class="el" href="lustre__import_8h_source.html#l00317">obd_import::imp_connect_flags_orig</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_connect_tried</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_connected</a>, <a class="el" href="lustre__import_8h_source.html#l00170">obd_import::imp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00168">obd_import::imp_dlm_handle</a>, <a class="el" href="lustre__import_8h_source.html#l00131">IMP_EVENT_OCD</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_force_reconnect</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_force_verify</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_invalid</a>, <a class="el" href="lustre__import_8h_source.html#l00246">obd_import::imp_last_replay_transno</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_pingable</a>, <a class="el" href="lustre__import_8h_source.html#l00217">obd_import::imp_recovery_waitq</a>, <a class="el" href="lustre__import_8h_source.html#l00260">obd_import::imp_remote_handle</a>, <a class="el" href="lustre__import_8h_source.html#l00196">obd_import::imp_replay_cursor</a>, <a class="el" href="lustre__import_8h_source.html#l00232">obd_import::imp_replay_state</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_replayable</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_resend_replay</a>, <a class="el" href="lustre__import_8h_source.html#l00230">obd_import::imp_state</a>, <a class="el" href="import_8c_source.html#l00099">IMPORT_SET_STATE</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00285">LCONSOLE_ERROR_MSG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00046">LPD64</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="lustre__import_8h_source.html#l00098">LUSTRE_IMP_CLOSED</a>, <a class="el" href="lustre__import_8h_source.html#l00100">LUSTRE_IMP_DISCON</a>, <a class="el" href="lustre__import_8h_source.html#l00107">LUSTRE_IMP_EVICTED</a>, <a class="el" href="lustre__import_8h_source.html#l00106">LUSTRE_IMP_FULL</a>, <a class="el" href="lustre__import_8h_source.html#l00105">LUSTRE_IMP_RECOVER</a>, <a class="el" href="lustre__import_8h_source.html#l00102">LUSTRE_IMP_REPLAY</a>, <a class="el" href="lustre__import_8h_source.html#l00103">LUSTRE_IMP_REPLAY_LOCKS</a>, <a class="el" href="pack__generic_8c_source.html#l00923">lustre_msg_get_handle()</a>, <a class="el" href="pack__generic_8c_source.html#l01044">lustre_msg_get_last_committed()</a>, <a class="el" href="pack__generic_8c_source.html#l00892">lustre_msg_get_op_flags()</a>, <a class="el" href="pack__generic_8c_source.html#l01234">lustre_msg_get_service_time()</a>, <a class="el" href="lustre__ver_8h_source.html#l00023">LUSTRE_VERSION_CODE</a>, <a class="el" href="lustre__idl_8h_source.html#l01169">MSG_CONNECT_RECONNECT</a>, <a class="el" href="lustre__idl_8h_source.html#l01168">MSG_CONNECT_RECOVERING</a>, <a class="el" href="lustre__idl_8h_source.html#l01170">MSG_CONNECT_REPLAYABLE</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, <a class="el" href="lustre__idl_8h_source.html#l01213">OBD_CONNECT_FID</a>, <a class="el" href="lustre__idl_8h_source.html#l01235">OBD_CONNECT_LIGHTWEIGHT</a>, <a class="el" href="lustre__idl_8h_source.html#l01209">OBD_CONNECT_MDS_MDS</a>, <a class="el" href="lustre__idl_8h_source.html#l01184">OBD_CONNECT_VERSION</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00603">obd_device::obd_no_recov</a>, <a class="el" href="lustre__ver_8h_source.html#l00021">OBD_OCD_VERSION_FIX</a>, <a class="el" href="lustre__ver_8h_source.html#l00018">OBD_OCD_VERSION_MAJOR</a>, <a class="el" href="lustre__ver_8h_source.html#l00019">OBD_OCD_VERSION_MINOR</a>, <a class="el" href="lustre__ver_8h_source.html#l00020">OBD_OCD_VERSION_PATCH</a>, <a class="el" href="obd_8h_source.html#l00655">obd_device::obd_self_export</a>, <a class="el" href="lustre__idl_8h_source.html#l01336">obd_connect_data::ocd_connect_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01350">obd_connect_data::ocd_instance</a>, <a class="el" href="lustre__idl_8h_source.html#l01337">obd_connect_data::ocd_version</a>, <a class="el" href="import_8c_source.html#l00057">ptlrpc_connect_async_args::pcaa_initial_connect</a>, <a class="el" href="import_8c_source.html#l00056">ptlrpc_connect_async_args::pcaa_peer_committed</a>, <a class="el" href="import_8c_source.html#l00399">ptlrpc_activate_import()</a>, <a class="el" href="client_8c_source.html#l00357">ptlrpc_at_adj_net_latency()</a>, <a class="el" href="import_8c_source.html#l00790">ptlrpc_busy_reconnect()</a>, <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>, <a class="el" href="import_8c_source.html#l00795">ptlrpc_connect_set_flags()</a>, <a class="el" href="import_8c_source.html#l00233">ptlrpc_deactivate_import()</a>, <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>, <a class="el" href="import_8c_source.html#l00778">ptlrpc_maybe_ping_import_soon()</a>, <a class="el" href="import_8c_source.html#l00952">ptlrpc_prepare_replay()</a>, <a class="el" href="lustre__req__layout_8h_source.html#l00059">RCL_SERVER</a>, <a class="el" href="layout_8c_source.html#l02263">req_capsule_get_size()</a>, <a class="el" href="layout_8c_source.html#l02158">req_capsule_server_get()</a>, <a class="el" href="layout_8c_source.html#l02186">req_capsule_server_sized_get()</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00047">ret</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="layout_8c_source.html#l01026">RMF_CONNECT_DATA</a>, <a class="el" href="lustre__net_8h_source.html#l01104">ptlrpc_request::rq_import</a>, <a class="el" href="lustre__net_8h_source.html#l01121">ptlrpc_request::rq_pill</a>, <a class="el" href="lustre__net_8h_source.html#l01032">ptlrpc_request::rq_repmsg</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b23bff25d925645bed6b82eb9514c9d"></a><!-- doxytag: member="import.c::ptlrpc_connect_set_flags" ref="a8b23bff25d925645bed6b82eb9514c9d" args="(struct obd_import *imp, struct obd_connect_data *ocd, __u64 old_connect_flags, struct obd_export *exp, int init_connect)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_connect_set_flags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__connect__data.html">obd_connect_data</a> *&nbsp;</td>
          <td class="paramname"> <em>ocd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>&nbsp;</td>
          <td class="paramname"> <em>old_connect_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structobd__export.html">obd_export</a> *&nbsp;</td>
          <td class="paramname"> <em>exp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>init_connect</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00795">795</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l00523">ptlrpc_connection::c_remote_uuid</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="obd__cksum_8h_source.html#l00170">cksum_type_select()</a>, <a class="el" href="obd__cksum_8h_source.html#l00122">cksum_types_supported_client()</a>, <a class="el" href="obd_8h_source.html#l00312">client_obd::cl_checksum</a>, <a class="el" href="obd_8h_source.html#l00316">client_obd::cl_cksum_type</a>, <a class="el" href="obd_8h_source.html#l00297">client_obd::cl_max_mod_rpcs_in_flight</a>, <a class="el" href="obd_8h_source.html#l00244">client_obd::cl_max_pages_per_rpc</a>, <a class="el" href="obd_8h_source.html#l00314">client_obd::cl_supp_cksum_types</a>, <a class="el" href="obd_8h_source.html#l00699">obd_device::cli</a>, <a class="el" href="obd_8h_source.html#l01215">client_adjust_max_dirty()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="lustre__export_8h_source.html#l00304">exp_connect_flags()</a>, <a class="el" href="lustre__import_8h_source.html#l00271">obd_import::imp_conn_current</a>, <a class="el" href="lustre__import_8h_source.html#l00267">obd_import::imp_conn_list</a>, <a class="el" href="lustre__import_8h_source.html#l00317">obd_import::imp_connect_flags_orig</a>, <a class="el" href="lustre__import_8h_source.html#l00315">obd_import::imp_connect_op</a>, <a class="el" href="lustre__import_8h_source.html#l00170">obd_import::imp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00264">obd_import::imp_last_success_conn</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00321">obd_import::imp_msghdr_flags</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="list_8h_source.html#l00076">list_add()</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="libcfs_2include_2libcfs_2types_8h_source.html#l00047">LPX64</a>, <a class="el" href="obd_8h_source.html#l00466">LUSTRE_MGC_NAME</a>, <a class="el" href="lustre__ver_8h_source.html#l00023">LUSTRE_VERSION_CODE</a>, <a class="el" href="packet-lustre_8c_source.html#l00206">MDS_CONNECT</a>, <a class="el" href="packet-lustre_8c_source.html#l00309">MGS_CONNECT</a>, <a class="el" href="lustre__idl_8h_source.html#l01044">MSGHDR_AT_SUPPORT</a>, <a class="el" href="lustre__idl_8h_source.html#l01045">MSGHDR_CKSUM_INCOMPAT18</a>, <a class="el" href="lustre__dlm_8h_source.html#l00389">ldlm_namespace::ns_connect_flags</a>, <a class="el" href="lustre__dlm_8h_source.html#l00392">ldlm_namespace::ns_orig_connect_flags</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, <a class="el" href="lustre__idl_8h_source.html#l01390">OBD_CKSUM_ADLER</a>, <a class="el" href="lustre__idl_8h_source.html#l01207">OBD_CONNECT_AT</a>, <a class="el" href="lustre__idl_8h_source.html#l01201">OBD_CONNECT_BRW_SIZE</a>, <a class="el" href="lustre__idl_8h_source.html#l01212">OBD_CONNECT_CKSUM</a>, <a class="el" href="lustre__idl_8h_source.html#l01191">OBD_CONNECT_IBITS</a>, <a class="el" href="lustre__idl_8h_source.html#l01266">OBD_CONNECT_MNE_SWAB</a>, <a class="el" href="lustre__idl_8h_source.html#l01244">OBD_CONNECT_MULTIMODRPCS</a>, <a class="el" href="lustre__idl_8h_source.html#l01184">OBD_CONNECT_VERSION</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="obd_8h_source.html#l00641">obd_device::obd_namespace</a>, <a class="el" href="lustre__ver_8h_source.html#l00021">OBD_OCD_VERSION_FIX</a>, <a class="el" href="lustre__ver_8h_source.html#l00018">OBD_OCD_VERSION_MAJOR</a>, <a class="el" href="lustre__ver_8h_source.html#l00019">OBD_OCD_VERSION_MINOR</a>, <a class="el" href="lustre__ver_8h_source.html#l00020">OBD_OCD_VERSION_PATCH</a>, <a class="el" href="obd_8h_source.html#l00592">obd_device::obd_type</a>, <a class="el" href="lustre__idl_8h_source.html#l01340">obd_connect_data::ocd_brw_size</a>, <a class="el" href="lustre__idl_8h_source.html#l01348">obd_connect_data::ocd_cksum_types</a>, <a class="el" href="lustre__idl_8h_source.html#l01336">obd_connect_data::ocd_connect_flags</a>, <a class="el" href="lustre__idl_8h_source.html#l01356">obd_connect_data::ocd_maxmodrpcs</a>, <a class="el" href="lustre__idl_8h_source.html#l01337">obd_connect_data::ocd_version</a>, <a class="el" href="lustre__import_8h_source.html#l00141">obd_import_conn::oic_item</a>, <a class="el" href="lustre__import_8h_source.html#l00149">obd_import_conn::oic_last_attempt</a>, <a class="el" href="lustre__net_8h_source.html#l00105">PTLRPC_MAX_BRW_PAGES</a>, <a class="el" href="obd_8h_source.html#l00111">obd_type::typ_name</a>, <a class="el" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">obd_device::u</a>, <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00984">ptlrpc_connect_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a6f848065aeee4853de0698588bd4c6e5"></a><!-- doxytag: member="import.c::ptlrpc_deactivate_and_unlock_import" ref="a6f848065aeee4853de0698588bd4c6e5" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_deactivate_and_unlock_import </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00213">213</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__import_8h_source.html#l00128">IMP_EVENT_INACTIVE</a>, <a class="el" href="lustre__import_8h_source.html#l00237">obd_import::imp_generation</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_invalid</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, and <a class="el" href="client_8c_source.html#l03045">ptlrpc_abort_inflight()</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00233">ptlrpc_deactivate_import()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf33859b8fb1c64e11831214604f7bab"></a><!-- doxytag: member="import.c::ptlrpc_first_transno" ref="aaf33859b8fb1c64e11831214604f7bab" args="(struct obd_import *imp, __u64 *transno)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_first_transno </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *&nbsp;</td>
          <td class="paramname"> <em>transno</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00612">612</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00146">D_ERROR</a>, <a class="el" href="lustre__net_8h_source.html#l01302">DEBUG_REQ</a>, <a class="el" href="lustre__import_8h_source.html#l00195">obd_import::imp_committed_list</a>, <a class="el" href="lustre__import_8h_source.html#l00183">obd_import::imp_replay_list</a>, <a class="el" href="libcfs__private_8h_source.html#l00281">LBUG</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00043">list_head::next</a>, and <a class="el" href="lustre__net_8h_source.html#l01034">ptlrpc_request::rq_transno</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00648">ptlrpc_connect_import()</a>.</p>

</div>
</div>
<a class="anchor" id="a899bee6eb9894ef42cc503d9061166a5"></a><!-- doxytag: member="import.c::ptlrpc_inflight_deadline" ref="a899bee6eb9894ef42cc503d9061166a5" args="(struct ptlrpc_request *req, time_t now)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int ptlrpc_inflight_deadline </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>now</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00241">241</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l01119">ptlrpc_request::rq_deadline</a>, <a class="el" href="lustre__net_8h_source.html#l01009">ptlrpc_request::rq_phase</a>, <a class="el" href="lustre__net_8h_source.html#l00719">RQ_PHASE_BULK</a>, <a class="el" href="lustre__net_8h_source.html#l00717">RQ_PHASE_NEW</a>, <a class="el" href="lustre__net_8h_source.html#l00718">RQ_PHASE_RPC</a>, <a class="el" href="lustre__net_8h_source.html#l01117">ptlrpc_request::rq_sent</a>, <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_timedout</a>, and <a class="el" href="lustre__net_8h_source.html#l00968">ptlrpc_request::rq_waiting</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00264">ptlrpc_inflight_timeout()</a>.</p>

</div>
</div>
<a class="anchor" id="a5c0a8df4161b05ea75d51762a038fba0"></a><!-- doxytag: member="import.c::ptlrpc_inflight_timeout" ref="a5c0a8df4161b05ea75d51762a038fba0" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int ptlrpc_inflight_timeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00264">264</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="linux-time_8h_source.html#l00157">cfs_time_current_sec()</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00184">obd_import::imp_sending_list</a>, <a class="el" href="list_8h_source.html#l00242">list_entry</a>, <a class="el" href="list_8h_source.html#l00266">list_for_each_safe</a>, <a class="el" href="lnet_2utils_2debug_8c_source.html#l00068">max</a>, <a class="el" href="createmany_8c_source.html#l00069">now()</a>, <a class="el" href="import_8c_source.html#l00241">ptlrpc_inflight_deadline()</a>, <a class="el" href="lustre__net_8h_source.html#l00962">ptlrpc_request::rq_list</a>, and <a class="el" href="gnilnd__modparams_8c_source.html#l00052">timeout</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00286">ptlrpc_invalidate_import()</a>.</p>

</div>
</div>
<a class="anchor" id="aac6da6897c797f41634d98a43ca0b810"></a><!-- doxytag: member="import.c::ptlrpc_invalidate_import_thread" ref="aac6da6897c797f41634d98a43ca0b810" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ptlrpc_invalidate_import_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>In kernel code all import invalidation happens in its own separate thread, so that whatever application happened to encounter a problem could still be killed or otherwise continue. </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l01403">1403</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l00523">ptlrpc_connection::c_remote_uuid</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="genops_8c_source.html#l01015">class_import_put()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__import_8h_source.html#l00170">obd_import::imp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="import_8c_source.html#l00099">IMPORT_SET_STATE</a>, <a class="el" href="libcfs_2libcfs_2debug_8c_source.html#l00251">libcfs_debug_dumplog()</a>, <a class="el" href="lustre__import_8h_source.html#l00105">LUSTRE_IMP_RECOVER</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, <a class="el" href="class__obd_8c_source.html#l00077">obd_dump_on_eviction</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>, <a class="el" href="import_8c_source.html#l00286">ptlrpc_invalidate_import()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, and <a class="el" href="lustre__user_8h_source.html#l00492">obd_uuid::uuid</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f2208d965db2d3f69f46ecf89980bc3"></a><!-- doxytag: member="import.c::ptlrpc_maybe_ping_import_soon" ref="a8f2208d965db2d3f69f46ecf89980bc3" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_maybe_ping_import_soon </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="import_8c_source.html#l00778">778</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_force_verify</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, and <a class="el" href="pinger_8c_source.html#l00565">ptlrpc_pinger_wake_up()</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00984">ptlrpc_connect_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a41d5115f707fbbf0bda9956bfcf1011f"></a><!-- doxytag: member="import.c::ptlrpc_prepare_replay" ref="a41d5115f707fbbf0bda9956bfcf1011f" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ptlrpc_prepare_replay </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add all replay requests back to unreplied list before start replay, so that we can make sure the known replied XID is always increased only even if when replaying requests. </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l00952">952</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00195">obd_import::imp_committed_list</a>, <a class="el" href="lustre__import_8h_source.html#l00202">obd_import::imp_known_replied_xid</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00183">obd_import::imp_replay_list</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_resend_replay</a>, <a class="el" href="lustre__import_8h_source.html#l00230">obd_import::imp_state</a>, <a class="el" href="list_8h_source.html#l00161">list_empty()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__import_8h_source.html#l00102">LUSTRE_IMP_REPLAY</a>, <a class="el" href="client_8c_source.html#l00658">ptlrpc_add_unreplied()</a>, <a class="el" href="client_8c_source.html#l01272">ptlrpc_known_replied_xid()</a>, and <a class="el" href="lustre__net_8h_source.html#l01045">ptlrpc_request::rq_replay_list</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00984">ptlrpc_connect_interpret()</a>.</p>

</div>
</div>
<a class="anchor" id="a08bb6b823019ef9a42f65210821e8750"></a><!-- doxytag: member="import.c::ptlrpc_set_import_discon" ref="a08bb6b823019ef9a42f65210821e8750" args="(struct obd_import *imp, __u32 conn_cnt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ptlrpc_set_import_discon </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">__u32&nbsp;</td>
          <td class="paramname"> <em>conn_cnt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns true if import was FULL, false if import was already not connected. </p>
<p>- import to be disconnected  - connection count (epoch) of the request that timed out and caused the disconnection. In some cases, multiple inflight requests can fail to a single target (e.g. OST bulk requests) and if one has already caused a reconnection (increasing the import-&gt;conn_cnt) the older failure should not also cause a reconnection. If zero it forces a reconnect. </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l00163">163</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__net_8h_source.html#l00521">ptlrpc_connection::c_peer</a>, <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="lustre__net_8h_source.html#l00535">ptlrpc_client::cli_name</a>, <a class="el" href="libcfs__debug_8h_source.html#l00148">D_HA</a>, <a class="el" href="import_8c_source.html#l00137">deuuidify()</a>, <a class="el" href="lustre__import_8h_source.html#l00172">obd_import::imp_client</a>, <a class="el" href="lustre__import_8h_source.html#l00239">obd_import::imp_conn_cnt</a>, <a class="el" href="lustre__import_8h_source.html#l00170">obd_import::imp_connection</a>, <a class="el" href="lustre__import_8h_source.html#l00127">IMP_EVENT_DISCON</a>, <a class="el" href="lustre__import_8h_source.html#l00274">obd_import::imp_lock</a>, <a class="el" href="lustre__import_8h_source.html#l00205">obd_import::imp_obd</a>, <a class="el" href="lustre__import_8h_source.html#l00277">obd_import::imp_replayable</a>, <a class="el" href="lustre__import_8h_source.html#l00230">obd_import::imp_state</a>, <a class="el" href="import_8c_source.html#l00088">IMPORT_SET_STATE_NOLOCK</a>, <a class="el" href="libcfs__debug_8h_source.html#l00285">LCONSOLE_ERROR_MSG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00284">LCONSOLE_WARN</a>, <a class="el" href="libcfs_2libcfs_2debug_8c_source.html#l00251">libcfs_debug_dumplog()</a>, <a class="el" href="nidstr_8h_source.html#l00077">libcfs_nid2str()</a>, <a class="el" href="lustre__import_8h_source.html#l00100">LUSTRE_IMP_DISCON</a>, <a class="el" href="lustre__import_8h_source.html#l00106">LUSTRE_IMP_FULL</a>, <a class="el" href="lnet_2include_2lnet_2types_8h_source.html#l00304">lnet_process_id_t::nid</a>, <a class="el" href="obd_8h_source.html#l00332">obd2cli_tgt</a>, <a class="el" href="class__obd_8c_source.html#l00075">obd_dump_on_timeout</a>, <a class="el" href="obd_8h_source.html#l00599">obd_device::obd_name</a>, and <a class="el" href="lustre__import_8h_source.html#l00111">ptlrpc_import_state_name()</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l00429">ptlrpc_fail_import()</a>, <a class="el" href="import_8c_source.html#l00450">ptlrpc_reconnect_import()</a>, <a class="el" href="recover_8c_source.html#l00333">ptlrpc_recover_import()</a>, and <a class="el" href="recover_8c_source.html#l00249">ptlrpc_request_handle_notconn()</a>.</p>

</div>
</div>
<a class="anchor" id="a2973325f33cdae5dee6c0787f0339609"></a><!-- doxytag: member="import.c::signal_completed_replay" ref="a2973325f33cdae5dee6c0787f0339609" args="(struct obd_import *imp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int signal_completed_replay </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobd__import.html">obd_import</a> *&nbsp;</td>
          <td class="paramname"> <em>imp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Let server know that we have no requests to replay anymore. </p>
<p>Achieved by just sending a PING request </p>

<p>Definition at line <a class="el" href="import_8c_source.html#l01368">1368</a> of file <a class="el" href="import_8c_source.html">import.c</a>.</p>

<p>References <a class="el" href="lustre__import_8h_source.html#l00379">AT_OFF</a>, <a class="el" href="import_8c_source.html#l01338">completed_replay_interpret()</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="lustre__import_8h_source.html#l00224">obd_import::imp_replay_inflight</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__import_8h_source.html#l00104">LUSTRE_IMP_REPLAY_WAIT</a>, <a class="el" href="pack__generic_8c_source.html#l00848">lustre_msg_add_flags()</a>, <a class="el" href="packet-lustre_8c_source.html#l00076">LUSTRE_OBD_VERSION</a>, <a class="el" href="lustre__idl_8h_source.html#l01162">MSG_LOCK_REPLAY_DONE</a>, <a class="el" href="lustre__idl_8h_source.html#l01161">MSG_REQ_REPLAY_DONE</a>, <a class="el" href="obd__support_8h_source.html#l00619">OBD_FAIL_CHECK</a>, <a class="el" href="obd__support_8h_source.html#l00412">OBD_FAIL_PTLRPC_FINISH_REPLAY</a>, <a class="el" href="packet-lustre_8c_source.html#l00303">OBD_PING</a>, <a class="el" href="client_8c_source.html#l00891">ptlrpc_request_alloc_pack()</a>, <a class="el" href="pack__generic_8c_source.html#l01551">ptlrpc_request_set_replen()</a>, <a class="el" href="ptlrpcd_8c_source.html#l00268">ptlrpcd_add_req()</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01030">ptlrpc_request::rq_reqmsg</a>, <a class="el" href="lustre__net_8h_source.html#l01113">ptlrpc_request::rq_timeout</a>, <a class="el" href="layout_8c_source.html#l01270">RQF_OBD_PING</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="import_8c_source.html#l01449">ptlrpc_import_recovery_state_machine()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a4113eb4f3c62d84a17df957bc9d6c1b9"></a><!-- doxytag: member="import.c::at_history" ref="a4113eb4f3c62d84a17df957bc9d6c1b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="import_8c.html#a4113eb4f3c62d84a17df957bc9d6c1b9">at_history</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="class__obd_8c_source.html#l00099">99</a> of file <a class="el" href="class__obd_8c_source.html">class_obd.c</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:50 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
