<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/include/lustre_dlm.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/include/lustre_dlm.h</h1><a href="lustre__dlm_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2010, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00048"></a>00048 <span class="preprocessor">#ifndef _LUSTRE_DLM_H__</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#define _LUSTRE_DLM_H__</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="lustre__lib_8h.html">lustre_lib.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="lustre__net_8h.html">lustre_net.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="lustre__import_8h.html">lustre_import.h</a>&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="lustre__handles_8h.html">lustre_handles.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="interval__tree_8h.html">interval_tree.h</a>&gt;</span> <span class="comment">/* for interval_node{}, ldlm_extent */</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="lu__ref_8h.html">lu_ref.h</a>&gt;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="lustre__dlm__flags_8h.html" title="The flags and collections of flags (masks) for.">lustre_dlm_flags.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="keyword">struct </span><a class="code" href="structobd__ops.html">obd_ops</a>;
<a name="l00061"></a>00061 <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>;
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="group__LDLM.html#ga281358eddc378923c68a44476ad434ae">00063</a> <span class="preprocessor">#define OBD_LDLM_DEVICENAME  &quot;ldlm&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="group__LDLM.html#gac60d99ba1ee452e88e798028c77a6ee2">00065</a> <span class="preprocessor">#define LDLM_DEFAULT_LRU_SIZE (100 * num_online_cpus())</span>
<a name="l00066"></a><a class="code" href="group__LDLM.html#ga9aa31582e16bd5db20efd0ad4ba2922e">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define LDLM_DEFAULT_MAX_ALIVE (cfs_time_seconds(3900)) </span><span class="comment">/* 65 min */</span>
<a name="l00067"></a><a class="code" href="group__LDLM.html#gad0d5691a254c18afb27cbe41e96e18dc">00067</a> <span class="preprocessor">#define LDLM_CTIME_AGE_LIMIT (10)</span>
<a name="l00068"></a><a class="code" href="group__LDLM.html#ga8a89bf73dae43048239ae31f0f4f776f">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define LDLM_DEFAULT_PARALLEL_AST_LIMIT 1024</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7">00073</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7" title="LDLM non-error return states.">ldlm_error</a> {
<a name="l00074"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a469cbc24e6549b934f26184a5a78230e">00074</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a469cbc24e6549b934f26184a5a78230e">ELDLM_OK</a>                = 0,
<a name="l00075"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a6545cc9db51172495cf36a4c88abca7d">00075</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a6545cc9db51172495cf36a4c88abca7d">ELDLM_LOCK_MATCHED</a>      = 1,
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7aad827eee63f1fb0bd13912b82915f6f5">00077</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7aad827eee63f1fb0bd13912b82915f6f5">ELDLM_LOCK_CHANGED</a>      = 300,
<a name="l00078"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a28c1d219b7543f767cee582a9daf0ee4">00078</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a28c1d219b7543f767cee582a9daf0ee4">ELDLM_LOCK_ABORTED</a>      = 301,
<a name="l00079"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7ad2b452e88a337a4a273ac71919544a61">00079</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7ad2b452e88a337a4a273ac71919544a61">ELDLM_LOCK_REPLACED</a>     = 302,
<a name="l00080"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a1e8fbbeb38571f8585669ab5c6b8b826">00080</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7a1e8fbbeb38571f8585669ab5c6b8b826">ELDLM_NO_LOCK_DATA</a>      = 303,
<a name="l00081"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7adc752fef82372dea573a2efc868d937d">00081</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7adc752fef82372dea573a2efc868d937d">ELDLM_LOCK_WOULDBLOCK</a>   = 304,
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7af441d44d6cd8360c0690ee5d3dcae1e6">00083</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7af441d44d6cd8360c0690ee5d3dcae1e6">ELDLM_NAMESPACE_EXISTS</a>  = 400,
<a name="l00084"></a><a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7ad3bcb2932ca3f78b679bce01f6890410">00084</a>         <a class="code" href="group__LDLM.html#ggaa2fbd012972eb2b2d0653c8df02964f7ad3bcb2932ca3f78b679bce01f6890410">ELDLM_BAD_NAMESPACE</a>     = 401,
<a name="l00085"></a>00085 };
<a name="l00086"></a>00086 
<a name="l00094"></a><a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd">00094</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> {
<a name="l00095"></a><a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">00095</a>         <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a> = 0x01,
<a name="l00096"></a><a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">00096</a>         <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a> = 0x02
<a name="l00097"></a>00097 };
<a name="l00098"></a>00098 
<a name="l00103"></a><a class="code" href="group__LDLM.html#gac91b29eaa6987e07656d85e9e139ca3f">00103</a> <span class="preprocessor">#define LDLM_CB_BLOCKING    1</span>
<a name="l00104"></a><a class="code" href="group__LDLM.html#ga5d94274920487243f51d4942f163b947">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define LDLM_CB_CANCELING   2</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="group__LDLM.html#ga646c49fc0ba78c1d5b30d7ef0b6fcc64">00140</a> <span class="preprocessor">#define LCK_COMPAT_EX  LCK_NL</span>
<a name="l00141"></a><a class="code" href="group__LDLM.html#ga0770471a8652e45673670fea9548e43b">00141</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_PW  (LCK_COMPAT_EX | LCK_CR)</span>
<a name="l00142"></a><a class="code" href="group__LDLM.html#ga74166fe3a7e2cf51787984249cffe774">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_PR  (LCK_COMPAT_PW | LCK_PR)</span>
<a name="l00143"></a><a class="code" href="group__LDLM.html#ga972ad785641586babf8f2b9c07db438f">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_CW  (LCK_COMPAT_PW | LCK_CW)</span>
<a name="l00144"></a><a class="code" href="group__LDLM.html#ga0d0f660e4e3edea1831b6216c617b3a7">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_CR  (LCK_COMPAT_CW | LCK_PR | LCK_PW)</span>
<a name="l00145"></a><a class="code" href="group__LDLM.html#ga47b10c6ee643a2e1c1710814e425008f">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_NL  (LCK_COMPAT_CR | LCK_EX | LCK_GROUP)</span>
<a name="l00146"></a><a class="code" href="group__LDLM.html#ga24e6e4b3c28390e97d02f7852d804297">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_GROUP  (LCK_GROUP | LCK_NL)</span>
<a name="l00147"></a><a class="code" href="group__LDLM.html#gac19878e62234fb5258f7c8761a3e4d61">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define LCK_COMPAT_COS (LCK_COS)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>
<a name="l00150"></a>00150 <span class="keyword">extern</span> <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="group__LDLM.html#ga3cf0131341b6663da454ede83009988b">lck_compat_array</a>[];
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="group__LDLM.html#ga6c0f99a4b156117149e846fee0571ca1">00152</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga6c0f99a4b156117149e846fee0571ca1">lockmode_verify</a>(<span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(mode &gt; <a class="code" href="packet-lustre_8c.html#aeb765b44eb9880500021b97a963db8e9">LCK_MINMODE</a> &amp;&amp; mode &lt; <a class="code" href="group__lustreidl.html#gga78e7c1d7ad283002413a597e75aa7441a0fef13ae3cb670960e19ead2b7d2ad7a">LCK_MAXMODE</a>);
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="group__LDLM.html#ga26ec85b7dbc46f65a8e212ce53366a9a">00157</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga26ec85b7dbc46f65a8e212ce53366a9a">lockmode_compat</a>(<span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> exist_mode,
<a name="l00158"></a>00158                                   <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> new_mode)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160         <span class="keywordflow">return</span> <a class="code" href="group__LDLM.html#ga3cf0131341b6663da454ede83009988b">lck_compat_array</a>[exist_mode] &amp; new_mode;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">/*</span>
<a name="l00164"></a>00164 <span class="comment"> *</span>
<a name="l00165"></a>00165 <span class="comment"> * cluster name spaces</span>
<a name="l00166"></a>00166 <span class="comment"> *</span>
<a name="l00167"></a>00167 <span class="comment"> */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="group__LDLM.html#ga051e68d1bff6a791da6164eda988c466">00169</a> <span class="preprocessor">#define DLM_OST_NAMESPACE 1</span>
<a name="l00170"></a><a class="code" href="group__LDLM.html#gae53cad77171aae681bc27e8cf30fda42">00170</a> <span class="preprocessor"></span><span class="preprocessor">#define DLM_MDS_NAMESPACE 2</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00172"></a>00172 <span class="comment">/* XXX</span>
<a name="l00173"></a>00173 <span class="comment">   - do we just separate this by security domains and use a prefix for</span>
<a name="l00174"></a>00174 <span class="comment">     multiple namespaces in the same domain?</span>
<a name="l00175"></a>00175 <span class="comment">   -</span>
<a name="l00176"></a>00176 <span class="comment">*/</span>
<a name="l00177"></a>00177 
<a name="l00197"></a>00197 <span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a>;
<a name="l00198"></a>00198 <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a>;
<a name="l00199"></a>00199 <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a>;
<a name="l00200"></a>00200 <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a>;
<a name="l00201"></a>00201 
<a name="l00210"></a><a class="code" href="structldlm__pool__ops.html">00210</a> <span class="keyword">struct </span><a class="code" href="structldlm__pool__ops.html" title="Operations on LDLM pools.">ldlm_pool_ops</a> {
<a name="l00212"></a>00212         int (*<a class="code" href="structldlm__pool__ops.html#a75962de74b46fb3860525973a666e5d8" title="Recalculate pool pl usage.">po_recalc</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l00214"></a>00214         int (*<a class="code" href="structldlm__pool__ops.html#a9dc6d1eed72b8ba0b93703beda792e7e" title="Cancel at least nr locks from pool pl.">po_shrink</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keywordtype">int</span> nr, gfp_t gfp_mask);
<a name="l00215"></a>00215         int (*<a class="code" href="structldlm__pool__ops.html#aba4fb6c158e4a7031909ab4702618125">po_setup</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keywordtype">int</span> limit);
<a name="l00216"></a>00216 };
<a name="l00217"></a>00217 
<a name="l00219"></a><a class="code" href="group__LDLM.html#gadbb6d2680a2d2d7ab15623b03f058edc">00219</a> <span class="preprocessor">#define LDLM_POOLS_THREAD_PERIOD (1)</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span>
<a name="l00222"></a><a class="code" href="group__LDLM.html#ga7712344fc932485bff52275c2193484a">00222</a> <span class="preprocessor">#define LDLM_POOLS_MODEST_MARGIN_SHIFT (4)</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>
<a name="l00225"></a><a class="code" href="group__LDLM.html#ga41802548f309704722be627a3d83e310">00225</a> <span class="preprocessor">#define LDLM_POOL_SRV_DEF_RECALC_PERIOD (1)</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>
<a name="l00228"></a><a class="code" href="group__LDLM.html#ga032adcd4a0ffd13b0425ae6dc9fb4033">00228</a> <span class="preprocessor">#define LDLM_POOL_CLI_DEF_RECALC_PERIOD (10)</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>
<a name="l00235"></a><a class="code" href="structldlm__pool.html">00235</a> <span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> {
<a name="l00237"></a><a class="code" href="structldlm__pool.html#ab2986bba59ff6c04b3982248e2a7c181">00237</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structldlm__pool.html#ab2986bba59ff6c04b3982248e2a7c181" title="Pool proc directory.">pl_proc_dir</a>;
<a name="l00239"></a><a class="code" href="structldlm__pool.html#a89240de10e824db8fac2fd21094b5f3f">00239</a>         <span class="keywordtype">char</span>                    <a class="code" href="structldlm__pool.html#a89240de10e824db8fac2fd21094b5f3f" title="Pool name, must be long enough to hold compound proc entry name.">pl_name</a>[100];
<a name="l00241"></a><a class="code" href="structldlm__pool.html#a642d87a0c1cf7a9f8d877b39592a5777">00241</a>         spinlock_t              <a class="code" href="structldlm__pool.html#a642d87a0c1cf7a9f8d877b39592a5777" title="Lock for protecting SLV/CLV updates.">pl_lock</a>;
<a name="l00243"></a><a class="code" href="structldlm__pool.html#a9791258c58863bb1b6ff328c56a8ec18">00243</a>         atomic_t                <a class="code" href="structldlm__pool.html#a9791258c58863bb1b6ff328c56a8ec18" title="Number of allowed locks in in pool, both, client and server side.">pl_limit</a>;
<a name="l00245"></a><a class="code" href="structldlm__pool.html#a15c414c0af5977fc76d43a95d51685ec">00245</a>         atomic_t                <a class="code" href="structldlm__pool.html#a15c414c0af5977fc76d43a95d51685ec" title="Number of granted locks in.">pl_granted</a>;
<a name="l00247"></a><a class="code" href="structldlm__pool.html#a7882e1a6bc842ba72166181c34ada060">00247</a>         atomic_t                <a class="code" href="structldlm__pool.html#a7882e1a6bc842ba72166181c34ada060" title="Grant rate per T.">pl_grant_rate</a>;
<a name="l00249"></a><a class="code" href="structldlm__pool.html#aefee7a8d44a2e788d5c58cc8f28352ce">00249</a>         atomic_t                <a class="code" href="structldlm__pool.html#aefee7a8d44a2e788d5c58cc8f28352ce" title="Cancel rate per T.">pl_cancel_rate</a>;
<a name="l00251"></a><a class="code" href="structldlm__pool.html#acade01349f55725f8b547e276f715512">00251</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__pool.html#acade01349f55725f8b547e276f715512" title="Server lock volume (SLV).">pl_server_lock_volume</a>;
<a name="l00253"></a><a class="code" href="structldlm__pool.html#abca345719a283ee66ccd3e556ad145ce">00253</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__pool.html#abca345719a283ee66ccd3e556ad145ce" title="Current biggest client lock volume.">pl_client_lock_volume</a>;
<a name="l00256"></a><a class="code" href="structldlm__pool.html#acc0d11b444349e406cfbdd2c1da2080a">00256</a>         atomic_t                <a class="code" href="structldlm__pool.html#acc0d11b444349e406cfbdd2c1da2080a" title="Lock volume factor.">pl_lock_volume_factor</a>;
<a name="l00258"></a><a class="code" href="structldlm__pool.html#a39b28165f98fbcaf5d1603300b17e7f8">00258</a>         time_t                  <a class="code" href="structldlm__pool.html#a39b28165f98fbcaf5d1603300b17e7f8" title="Time when last SLV from server was obtained.">pl_recalc_time</a>;
<a name="l00260"></a><a class="code" href="structldlm__pool.html#a7a9867251c2f7391063e97be2f4556cc">00260</a>         time_t                  <a class="code" href="structldlm__pool.html#a7a9867251c2f7391063e97be2f4556cc" title="Recalculation period for pool.">pl_recalc_period</a>;
<a name="l00262"></a><a class="code" href="structldlm__pool.html#a0dc49dca65067a62111027456887ba8e">00262</a>         <span class="keyword">struct </span><a class="code" href="structldlm__pool__ops.html" title="Operations on LDLM pools.">ldlm_pool_ops</a>    *<a class="code" href="structldlm__pool.html#a0dc49dca65067a62111027456887ba8e" title="Recalculation and shrink operations.">pl_ops</a>;
<a name="l00264"></a><a class="code" href="structldlm__pool.html#aed45013765b4e40def0a9e49102c47ef">00264</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__pool.html#aed45013765b4e40def0a9e49102c47ef" title="Number of planned locks for next period.">pl_grant_plan</a>;
<a name="l00266"></a><a class="code" href="structldlm__pool.html#a5e0fd6323eb7e828e7e32bf038b156e9">00266</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>    *<a class="code" href="structldlm__pool.html#a5e0fd6323eb7e828e7e32bf038b156e9" title="Pool statistics.">pl_stats</a>;
<a name="l00267"></a>00267 };
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="group__LDLM.html#ga07447890235da125e60400b2dee48626">00269</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#ga07447890235da125e60400b2dee48626">ldlm_res_policy</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *, <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> **,
<a name="l00270"></a>00270                                <span class="keywordtype">void</span> *req_cookie, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>,
<a name="l00271"></a>00271                                <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, <span class="keywordtype">void</span> *data);
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="group__LDLM.html#gab397db2317d35a64df513cd6072de20c">00273</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#gab397db2317d35a64df513cd6072de20c">ldlm_cancel_cbt</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l00274"></a>00274 
<a name="l00288"></a><a class="code" href="structldlm__valblock__ops.html">00288</a> <span class="keyword">struct </span><a class="code" href="structldlm__valblock__ops.html" title="LVB operations.">ldlm_valblock_ops</a> {
<a name="l00289"></a>00289         int (*<a class="code" href="structldlm__valblock__ops.html#a163fdf3cd2200c7fed6efeffc10a9f9a">lvbo_init</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l00290"></a>00290         int (*<a class="code" href="structldlm__valblock__ops.html#a2a67bc2634b21d63b85e93494b74a067">lvbo_update</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l00291"></a>00291                            <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *r,
<a name="l00292"></a>00292                            <span class="keywordtype">int</span> increase);
<a name="l00293"></a>00293         int (*<a class="code" href="structldlm__valblock__ops.html#a1f9bba68aafe55b885f59f0ab69cca88">lvbo_free</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l00294"></a>00294         <span class="comment">/* Return size of lvb data appropriate RPC size can be reserved */</span>
<a name="l00295"></a>00295         int (*<a class="code" href="structldlm__valblock__ops.html#ab6db7ae145623d30b6700052ac56367c">lvbo_size</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l00296"></a>00296         <span class="comment">/* Called to fill in lvb data to RPC buffer @buf */</span>
<a name="l00297"></a>00297         int (*<a class="code" href="structldlm__valblock__ops.html#aa3569cda637416d3f27f7a4f1de678ef">lvbo_fill</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> buflen);
<a name="l00298"></a>00298 };
<a name="l00299"></a>00299 
<a name="l00304"></a><a class="code" href="group__LDLM.html#gafcd8eee315d3a7e1313596efd678d77e">00304</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gafcd8eee315d3a7e1313596efd678d77e" title="LDLM pools related, type of lock pool in the namespace.">ldlm_appetite</a> {
<a name="l00305"></a><a class="code" href="group__LDLM.html#ggafcd8eee315d3a7e1313596efd678d77eac02de5a88f2822d394681c400959434d">00305</a>         <a class="code" href="group__LDLM.html#ggafcd8eee315d3a7e1313596efd678d77eac02de5a88f2822d394681c400959434d">LDLM_NAMESPACE_GREEDY</a> = 1 &lt;&lt; 0,
<a name="l00306"></a><a class="code" href="group__LDLM.html#ggafcd8eee315d3a7e1313596efd678d77ea779499ef38fbd29e9e2a3cb0b5a69e6a">00306</a>         <a class="code" href="group__LDLM.html#ggafcd8eee315d3a7e1313596efd678d77ea779499ef38fbd29e9e2a3cb0b5a69e6a">LDLM_NAMESPACE_MODEST</a> = 1 &lt;&lt; 1
<a name="l00307"></a>00307 };
<a name="l00308"></a>00308 
<a name="l00313"></a><a class="code" href="group__LDLM.html#ga79f569c8af2bddcadd03bb0f5252c5a5">00313</a> <span class="preprocessor">#define NS_DEFAULT_MAX_NOLOCK_BYTES 0</span>
<a name="l00314"></a><a class="code" href="group__LDLM.html#ga222ec4eb7473a27407d03b6219387330">00314</a> <span class="preprocessor"></span><span class="preprocessor">#define NS_DEFAULT_CONTENTION_SECONDS 2</span>
<a name="l00315"></a><a class="code" href="group__LDLM.html#ga04cc41bb0ea0cb2dbb2b743ddef676d3">00315</a> <span class="preprocessor"></span><span class="preprocessor">#define NS_DEFAULT_CONTENDED_LOCKS 32</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00317"></a><a class="code" href="structldlm__ns__bucket.html">00317</a> <span class="keyword">struct </span><a class="code" href="structldlm__ns__bucket.html">ldlm_ns_bucket</a> {
<a name="l00319"></a><a class="code" href="structldlm__ns__bucket.html#ad43f98ed5b7709ac0f3a6cb8b615afd2">00319</a>         <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a>      *<a class="code" href="structldlm__ns__bucket.html#ad43f98ed5b7709ac0f3a6cb8b615afd2" title="back pointer to namespace">nsb_namespace</a>;
<a name="l00325"></a><a class="code" href="structldlm__ns__bucket.html#a1048b7de1fc1e4463b2f10d642771e02">00325</a>         <span class="keyword">struct </span><a class="code" href="structadaptive__timeout.html">adaptive_timeout</a>     <a class="code" href="structldlm__ns__bucket.html#a1048b7de1fc1e4463b2f10d642771e02" title="Estimated lock callback time.">nsb_at_estimate</a>;
<a name="l00329"></a><a class="code" href="structldlm__ns__bucket.html#aedf440d3f2ddbdb3a41bf6ddd806a570">00329</a>         <span class="keywordtype">int</span>                         <a class="code" href="structldlm__ns__bucket.html#aedf440d3f2ddbdb3a41bf6ddd806a570" title="Which res in the bucket should we start with the reclaim.">nsb_reclaim_start</a>;
<a name="l00330"></a>00330 };
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="keyword">enum</span> {
<a name="l00334"></a><a class="code" href="group__LDLM.html#ggae8a3b6a5d0d3244ed73924ab2421a0d0ac9ce485ce53eddc4df436c8df18871e4">00334</a>         <a class="code" href="group__LDLM.html#ggae8a3b6a5d0d3244ed73924ab2421a0d0ac9ce485ce53eddc4df436c8df18871e4" title="LDLM namespace lock stats.">LDLM_NSS_LOCKS</a>          = 0,
<a name="l00335"></a><a class="code" href="group__LDLM.html#ggae8a3b6a5d0d3244ed73924ab2421a0d0a6598fd5fe5e1403bf48c2f02a018d2e6">00335</a>         <a class="code" href="group__LDLM.html#ggae8a3b6a5d0d3244ed73924ab2421a0d0a6598fd5fe5e1403bf48c2f02a018d2e6">LDLM_NSS_LAST</a>
<a name="l00336"></a>00336 };
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="group__LDLM.html#ga516147f10f1ca82e556a7f8c3ee5d6ff">00338</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga516147f10f1ca82e556a7f8c3ee5d6ff">ldlm_ns_type</a> {
<a name="l00339"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffaf5e8bcf861bcd7b236cb287da70a974e">00339</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffaf5e8bcf861bcd7b236cb287da70a974e" title="invalid type">LDLM_NS_TYPE_UNKNOWN</a> = 0,       
<a name="l00340"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffaabe8a36130ca1ffe942ad581cc3b7d50">00340</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffaabe8a36130ca1ffe942ad581cc3b7d50" title="MDC namespace.">LDLM_NS_TYPE_MDC</a>,               
<a name="l00341"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffa6f51895209e33fae55026bc462d17ed1">00341</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffa6f51895209e33fae55026bc462d17ed1" title="MDT namespace.">LDLM_NS_TYPE_MDT</a>,               
<a name="l00342"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffab42df29b6de6da3b65b3db2496efe009">00342</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffab42df29b6de6da3b65b3db2496efe009" title="OSC namespace.">LDLM_NS_TYPE_OSC</a>,               
<a name="l00343"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffabaac77dbb962ddbffeb7d4092d38c141">00343</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffabaac77dbb962ddbffeb7d4092d38c141" title="OST namespace.">LDLM_NS_TYPE_OST</a>,               
<a name="l00344"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffabdcaf331de52005bd3c5c67979a44601">00344</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffabdcaf331de52005bd3c5c67979a44601" title="MGC namespace.">LDLM_NS_TYPE_MGC</a>,               
<a name="l00345"></a><a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffa8fcb201d020caf855369cdcb8796ec9b">00345</a>         <a class="code" href="group__LDLM.html#gga516147f10f1ca82e556a7f8c3ee5d6ffa8fcb201d020caf855369cdcb8796ec9b" title="MGT namespace.">LDLM_NS_TYPE_MGT</a>,               
<a name="l00346"></a>00346 };
<a name="l00347"></a>00347 
<a name="l00369"></a><a class="code" href="structldlm__namespace.html">00369</a> <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> {
<a name="l00371"></a><a class="code" href="structldlm__namespace.html#a861f213cc95d91ddc758f7619db49469">00371</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>       *<a class="code" href="structldlm__namespace.html#a861f213cc95d91ddc758f7619db49469" title="Backward link to OBD, required for LDLM pool to store new SLV.">ns_obd</a>;
<a name="l00372"></a>00372 
<a name="l00374"></a><a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1">00374</a>         <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a>          <a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a>;
<a name="l00375"></a>00375 
<a name="l00377"></a><a class="code" href="structldlm__namespace.html#ab98b19e574d298fcacdc25f5badb919d">00377</a>         <span class="keyword">struct </span><a class="code" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a>         *<a class="code" href="structldlm__namespace.html#ab98b19e574d298fcacdc25f5badb919d" title="Resource hash table for namespace.">ns_rs_hash</a>;
<a name="l00378"></a>00378 
<a name="l00380"></a><a class="code" href="structldlm__namespace.html#a034ee07f43b36accc62bc6675f482775">00380</a>         spinlock_t              <a class="code" href="structldlm__namespace.html#a034ee07f43b36accc62bc6675f482775" title="serialize">ns_lock</a>;
<a name="l00381"></a>00381 
<a name="l00383"></a><a class="code" href="structldlm__namespace.html#af68b79de9de6a850ff2b37e76dc912a2">00383</a>         atomic_t                <a class="code" href="structldlm__namespace.html#af68b79de9de6a850ff2b37e76dc912a2" title="big refcount (by bucket)">ns_bref</a>;
<a name="l00384"></a>00384 
<a name="l00389"></a><a class="code" href="structldlm__namespace.html#a1efbbd32b149bd60a68ab1a83efbf9e1">00389</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__namespace.html#a1efbbd32b149bd60a68ab1a83efbf9e1" title="Namespace connect flags supported by server (may be changed via /proc, LRU resize...">ns_connect_flags</a>;
<a name="l00390"></a>00390 
<a name="l00392"></a><a class="code" href="structldlm__namespace.html#a74faeaa0971d5791adbd547b56587e71">00392</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__namespace.html#a74faeaa0971d5791adbd547b56587e71" title="Client side original connect flags supported by server.">ns_orig_connect_flags</a>;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394         <span class="comment">/* namespace proc dir entry */</span>
<a name="l00395"></a><a class="code" href="structldlm__namespace.html#a89c5a0896aa52ccbfb56bb7774b696dd">00395</a>         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structldlm__namespace.html#a89c5a0896aa52ccbfb56bb7774b696dd">ns_proc_dir_entry</a>;
<a name="l00396"></a>00396 
<a name="l00401"></a><a class="code" href="structldlm__namespace.html#a8c57114258d97d4cf01886c70d7d783e">00401</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__namespace.html#a8c57114258d97d4cf01886c70d7d783e" title="Position in global namespace list linking all namespaces on the node.">ns_list_chain</a>;
<a name="l00402"></a>00402 
<a name="l00413"></a><a class="code" href="structldlm__namespace.html#a203e42ef1191d6bee7e44cf9a84f33b5">00413</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__namespace.html#a203e42ef1191d6bee7e44cf9a84f33b5" title="List of unused locks for this namespace.">ns_unused_list</a>;
<a name="l00415"></a><a class="code" href="structldlm__namespace.html#a56c1d5c8f5cbe01e64cb7f7332b070b7">00415</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__namespace.html#a56c1d5c8f5cbe01e64cb7f7332b070b7" title="Number of locks in the LRU list above.">ns_nr_unused</a>;
<a name="l00416"></a>00416 
<a name="l00422"></a><a class="code" href="structldlm__namespace.html#a08c00f4038e8a7006e7b9f90925b35d8">00422</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structldlm__namespace.html#a08c00f4038e8a7006e7b9f90925b35d8" title="Maximum number of locks permitted in the LRU.">ns_max_unused</a>;
<a name="l00424"></a><a class="code" href="structldlm__namespace.html#af724ff88b3b153ab98f5d8810649c7a9">00424</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structldlm__namespace.html#af724ff88b3b153ab98f5d8810649c7a9" title="Maximum allowed age (last used time) for locks in the LRU.">ns_max_age</a>;
<a name="l00429"></a><a class="code" href="structldlm__namespace.html#adc7b7a0c4f178a005d87586c89aa795e">00429</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structldlm__namespace.html#adc7b7a0c4f178a005d87586c89aa795e" title="Server only: number of times we evicted clients due to lack of reply to ASTs.">ns_timeouts</a>;
<a name="l00436"></a><a class="code" href="structldlm__namespace.html#a5f1eb6d28c1931a67d95431364d1bbb9">00436</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structldlm__namespace.html#a5f1eb6d28c1931a67d95431364d1bbb9" title="Number of seconds since the file change time after which the MDT will return an UPDATE...">ns_ctime_age_limit</a>;
<a name="l00437"></a>00437 
<a name="l00443"></a><a class="code" href="structldlm__namespace.html#ad65196442e16b2fe16ba78bd3cf099e0">00443</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structldlm__namespace.html#ad65196442e16b2fe16ba78bd3cf099e0" title="Used to rate-limit ldlm_namespace_dump calls.">ns_next_dump</a>;
<a name="l00444"></a>00444 
<a name="l00446"></a><a class="code" href="structldlm__namespace.html#a926bc3bad4997f595bdde4644119dac2">00446</a>         <a class="code" href="group__LDLM.html#ga07447890235da125e60400b2dee48626">ldlm_res_policy</a>         <a class="code" href="structldlm__namespace.html#a926bc3bad4997f595bdde4644119dac2" title="&amp;quot;policy&amp;quot; function that does actual lock conflict determination">ns_policy</a>;
<a name="l00447"></a>00447 
<a name="l00452"></a><a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48">00452</a>         <span class="keyword">struct </span><a class="code" href="structldlm__valblock__ops.html" title="LVB operations.">ldlm_valblock_ops</a> *<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>;
<a name="l00453"></a>00453 
<a name="l00458"></a><a class="code" href="structldlm__namespace.html#a32d408160b08443bb500ae49149c6026">00458</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structldlm__namespace.html#a32d408160b08443bb500ae49149c6026" title="Used by filter code to store pointer to OBD of the service.">ns_lvbp</a>;
<a name="l00459"></a>00459 
<a name="l00464"></a><a class="code" href="structldlm__namespace.html#ae07ddb792934957b5f53441e78d6653c">00464</a>         wait_queue_head_t       <a class="code" href="structldlm__namespace.html#ae07ddb792934957b5f53441e78d6653c" title="Wait queue used by __ldlm_namespace_free.">ns_waitq</a>;
<a name="l00466"></a><a class="code" href="structldlm__namespace.html#aa7af6cd55b6e2bfa2b4cfc6134bb51e3">00466</a>         <span class="keyword">struct </span><a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a>        <a class="code" href="structldlm__namespace.html#aa7af6cd55b6e2bfa2b4cfc6134bb51e3" title="LDLM pool structure for this namespace.">ns_pool</a>;
<a name="l00468"></a><a class="code" href="structldlm__namespace.html#a8a1c4127f625c55c2a7d4288690ec3b9">00468</a>         <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gafcd8eee315d3a7e1313596efd678d77e" title="LDLM pools related, type of lock pool in the namespace.">ldlm_appetite</a>      <a class="code" href="structldlm__namespace.html#a8a1c4127f625c55c2a7d4288690ec3b9" title="Definition of how eagerly unused locks will be released from LRU.">ns_appetite</a>;
<a name="l00469"></a>00469 
<a name="l00475"></a><a class="code" href="structldlm__namespace.html#a622fd8d8e6a4cc60a0c158c25c15322a">00475</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structldlm__namespace.html#a622fd8d8e6a4cc60a0c158c25c15322a" title="If more than ns_contended_locks are found, the resource is considered to be contended...">ns_contended_locks</a>;
<a name="l00476"></a>00476 
<a name="l00481"></a><a class="code" href="structldlm__namespace.html#a98fd882dc7b49bba86b79efe3db05c77">00481</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structldlm__namespace.html#a98fd882dc7b49bba86b79efe3db05c77" title="The resources in this namespace remember contended state during ns_contention_time...">ns_contention_time</a>;
<a name="l00482"></a>00482 
<a name="l00489"></a><a class="code" href="structldlm__namespace.html#ab3fcbe9cd534ae1716b36a788a48c955">00489</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structldlm__namespace.html#ab3fcbe9cd534ae1716b36a788a48c955" title="Limit size of contended extent locks, in bytes.">ns_max_nolock_size</a>;
<a name="l00490"></a>00490 
<a name="l00492"></a><a class="code" href="structldlm__namespace.html#a26fcded328106ccb6693c3c66cc7a95d">00492</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structldlm__namespace.html#a26fcded328106ccb6693c3c66cc7a95d" title="Limit of parallel AST RPC count.">ns_max_parallel_ast</a>;
<a name="l00493"></a>00493 
<a name="l00498"></a><a class="code" href="structldlm__namespace.html#a0f4c5e671459369ab9813cfda1ff69f1">00498</a>         <a class="code" href="group__LDLM.html#gab397db2317d35a64df513cd6072de20c">ldlm_cancel_cbt</a>         <a class="code" href="structldlm__namespace.html#a0f4c5e671459369ab9813cfda1ff69f1" title="Callback to check if a lock is good to be canceled by ELC or during recovery.">ns_cancel</a>;
<a name="l00499"></a>00499 
<a name="l00501"></a><a class="code" href="structldlm__namespace.html#a73e6656374075468f72ce93b58d84518">00501</a>         <span class="keyword">struct </span><a class="code" href="structlprocfs__stats.html">lprocfs_stats</a>    *<a class="code" href="structldlm__namespace.html#a73e6656374075468f72ce93b58d84518" title="LDLM lock stats.">ns_stats</a>;
<a name="l00502"></a>00502 
<a name="l00507"></a><a class="code" href="structldlm__namespace.html#ab8fdfb8d21e09d1eb92b6efd68e5420e">00507</a>         <span class="keywordtype">unsigned</span>                <a class="code" href="structldlm__namespace.html#ab8fdfb8d21e09d1eb92b6efd68e5420e" title="Flag to indicate namespace is being freed.">ns_stopping</a>:1;
<a name="l00508"></a>00508 
<a name="l00512"></a><a class="code" href="structldlm__namespace.html#a71d94a2dda3fbfe92f095fe589cddbb5">00512</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__namespace.html#a71d94a2dda3fbfe92f095fe589cddbb5" title="Which bucket should we start with the lock reclaim.">ns_reclaim_start</a>;
<a name="l00513"></a>00513 };
<a name="l00514"></a>00514 
<a name="l00518"></a><a class="code" href="group__LDLM.html#gae9d5e1e0b2f2985e97aca30f2f1a145b">00518</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gae9d5e1e0b2f2985e97aca30f2f1a145b" title="Returns 1 if namespace ns is a client namespace.">ns_is_client</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns)
<a name="l00519"></a>00519 {
<a name="l00520"></a>00520         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns != NULL);
<a name="l00521"></a>00521         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(!(ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> &amp; ~(<a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a> |
<a name="l00522"></a>00522                                     <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a>)));
<a name="l00523"></a>00523         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a> ||
<a name="l00524"></a>00524                 ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a>);
<a name="l00525"></a>00525         <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a>;
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00531"></a><a class="code" href="group__LDLM.html#ga31d7e8c3808dd5cd2e15aea3257e4097">00531</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga31d7e8c3808dd5cd2e15aea3257e4097" title="Returns 1 if namespace ns is a server namespace.">ns_is_server</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns)
<a name="l00532"></a>00532 {
<a name="l00533"></a>00533         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns != NULL);
<a name="l00534"></a>00534         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(!(ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> &amp; ~(<a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a> |
<a name="l00535"></a>00535                                     <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a>)));
<a name="l00536"></a>00536         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defda7b389ca5799b0c65fd290cfe04e34143">LDLM_NAMESPACE_CLIENT</a> ||
<a name="l00537"></a>00537                 ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a>);
<a name="l00538"></a>00538         <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structldlm__namespace.html#aca43e10db23e506ba81318223e2fe0f1" title="Flag indicating if namespace is on client instead of server.">ns_client</a> == <a class="code" href="group__LDLM.html#ggac4b4584603b76e6cc86c82a64f59defdad589556d4b2a4f1a2f0793c32688d90d">LDLM_NAMESPACE_SERVER</a>;
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00544"></a><a class="code" href="group__LDLM.html#ga1f4b542b9827f58e6dd3823356c2fd4f">00544</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga1f4b542b9827f58e6dd3823356c2fd4f" title="Returns 1 if namespace ns supports early lock cancel (ELC).">ns_connect_cancelset</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns != NULL);
<a name="l00547"></a>00547         <span class="keywordflow">return</span> !!(ns-&gt;<a class="code" href="structldlm__namespace.html#a1efbbd32b149bd60a68ab1a83efbf9e1" title="Namespace connect flags supported by server (may be changed via /proc, LRU resize...">ns_connect_flags</a> &amp; <a class="code" href="group__lustreidl.html#ga8aedd0fe2dafb0142593611a9986db7c">OBD_CONNECT_CANCELSET</a>);
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00553"></a><a class="code" href="group__LDLM.html#gac757615521e2e49225316a38d68c5a7c">00553</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gac757615521e2e49225316a38d68c5a7c" title="Returns 1 if this namespace supports lru_resize.">ns_connect_lru_resize</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns != NULL);
<a name="l00556"></a>00556         <span class="keywordflow">return</span> !!(ns-&gt;<a class="code" href="structldlm__namespace.html#a1efbbd32b149bd60a68ab1a83efbf9e1" title="Namespace connect flags supported by server (may be changed via /proc, LRU resize...">ns_connect_flags</a> &amp; <a class="code" href="group__lustreidl.html#gad7c613e0467ffdb2add882ff9c75f8bb">OBD_CONNECT_LRU_RESIZE</a>);
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="group__LDLM.html#gaf469134f642cdcfacd9f0a9e21365111">00559</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaf469134f642cdcfacd9f0a9e21365111">ns_register_cancel</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l00560"></a>00560                                       <a class="code" href="group__LDLM.html#gab397db2317d35a64df513cd6072de20c">ldlm_cancel_cbt</a> arg)
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns != NULL);
<a name="l00563"></a>00563         ns-&gt;<a class="code" href="structldlm__namespace.html#a0f4c5e671459369ab9813cfda1ff69f1" title="Callback to check if a lock is good to be canceled by ELC or during recovery.">ns_cancel</a> = arg;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a>;
<a name="l00567"></a>00567 
<a name="l00569"></a><a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378">00569</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock,
<a name="l00570"></a>00570                                       <span class="keyword">struct </span><a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *<span class="keyword">new</span>, <span class="keywordtype">void</span> *data,
<a name="l00571"></a>00571                                       <span class="keywordtype">int</span> flag);
<a name="l00573"></a><a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257">00573</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257" title="Type for completion callback function of a lock.">ldlm_completion_callback</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags,
<a name="l00574"></a>00574                                         <span class="keywordtype">void</span> *data);
<a name="l00576"></a><a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d">00576</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d" title="Type for glimpse callback function of a lock.">ldlm_glimpse_callback</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">void</span> *data);
<a name="l00577"></a>00577 
<a name="l00579"></a><a class="code" href="structldlm__glimpse__work.html">00579</a> <span class="keyword">struct </span><a class="code" href="structldlm__glimpse__work.html" title="Work list for sending GL ASTs to multiple locks.">ldlm_glimpse_work</a> {
<a name="l00580"></a><a class="code" href="structldlm__glimpse__work.html#a5d2c4771d20dd798885113b572ff50a0">00580</a>         <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a>        *<a class="code" href="structldlm__glimpse__work.html#a5d2c4771d20dd798885113b572ff50a0">gl_lock</a>; <span class="comment">/* lock to glimpse */</span>
<a name="l00581"></a><a class="code" href="structldlm__glimpse__work.html#ae6b3af3e3fcf243c4e8a62774506c229">00581</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structldlm__glimpse__work.html#ae6b3af3e3fcf243c4e8a62774506c229">gl_list</a>; <span class="comment">/* linkage to other gl work structs */</span>
<a name="l00582"></a><a class="code" href="structldlm__glimpse__work.html#a9a1f41b4028550412b5db88c7d45f7a7">00582</a>         __u32                    <a class="code" href="structldlm__glimpse__work.html#a9a1f41b4028550412b5db88c7d45f7a7">gl_flags</a>;<span class="comment">/* see LDLM_GL_WORK_* below */</span>
<a name="l00583"></a><a class="code" href="structldlm__glimpse__work.html#ac96f24af981e9a10b25cda782092767f">00583</a>         <span class="keyword">union </span><a class="code" href="unionldlm__gl__desc.html">ldlm_gl_desc</a>      *<a class="code" href="structldlm__glimpse__work.html#ac96f24af981e9a10b25cda782092767f">gl_desc</a>; <span class="comment">/* glimpse descriptor to be packed in</span>
<a name="l00584"></a>00584 <span class="comment">                                           * glimpse callback request */</span>
<a name="l00585"></a>00585 };
<a name="l00586"></a>00586 
<a name="l00588"></a><a class="code" href="group__LDLM.html#ga003105401547ae27f8ae4d9b4c232f27">00588</a> <span class="preprocessor">#define LDLM_GL_WORK_NOFREE 0x1</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>
<a name="l00591"></a><a class="code" href="structldlm__interval.html">00591</a> <span class="keyword">struct </span><a class="code" href="structldlm__interval.html" title="Interval node data for each LDLM_EXTENT lock.">ldlm_interval</a> {
<a name="l00592"></a><a class="code" href="structldlm__interval.html#a2773067fdb60e5400cd07d13423b5fcf">00592</a>         <span class="keyword">struct </span><a class="code" href="structinterval__node.html">interval_node</a>    <a class="code" href="structldlm__interval.html#a2773067fdb60e5400cd07d13423b5fcf">li_node</a>;  <span class="comment">/* node for tree management */</span>
<a name="l00593"></a><a class="code" href="structldlm__interval.html#a9d2d127bfeb7268eb0321a7025f9a467">00593</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__interval.html#a9d2d127bfeb7268eb0321a7025f9a467">li_group</a>; <span class="comment">/* the locks which have the same</span>
<a name="l00594"></a>00594 <span class="comment">                                           * policy - group of the policy */</span>
<a name="l00595"></a>00595 };
<a name="l00596"></a><a class="code" href="group__LDLM.html#gae83cd198e77c1f09846f131fd1b76dee">00596</a> <span class="preprocessor">#define to_ldlm_interval(n) container_of(n, struct ldlm_interval, li_node)</span>
<a name="l00597"></a>00597 <span class="preprocessor"></span>
<a name="l00604"></a><a class="code" href="structldlm__interval__tree.html">00604</a> <span class="keyword">struct </span><a class="code" href="structldlm__interval__tree.html" title="Interval tree for extent locks.">ldlm_interval_tree</a> {
<a name="l00606"></a><a class="code" href="structldlm__interval__tree.html#a4e6883b3a87d6a8ee0ad6ca2b667a9b5">00606</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__interval__tree.html#a4e6883b3a87d6a8ee0ad6ca2b667a9b5" title="Tree size.">lit_size</a>;
<a name="l00607"></a><a class="code" href="structldlm__interval__tree.html#aa773dffdabe09a10201b0ca70e3c55fb">00607</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>          <a class="code" href="structldlm__interval__tree.html#aa773dffdabe09a10201b0ca70e3c55fb">lit_mode</a>;  <span class="comment">/* lock mode */</span>
<a name="l00608"></a><a class="code" href="structldlm__interval__tree.html#a82b5330de76ad4223fbef3004b3aefbf">00608</a>         <span class="keyword">struct </span><a class="code" href="structinterval__node.html">interval_node</a>    *<a class="code" href="structldlm__interval__tree.html#a82b5330de76ad4223fbef3004b3aefbf">lit_root</a>; <span class="comment">/* actual ldlm_interval */</span>
<a name="l00609"></a>00609 };
<a name="l00610"></a>00610 
<a name="l00612"></a><a class="code" href="group__LDLM.html#ga5eaa516285c80b8a6bb5f879fa3191b9">00612</a> <span class="preprocessor">#define LUSTRE_TRACKS_LOCK_EXP_REFS (0)</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span>
<a name="l00615"></a><a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9">00615</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> {
<a name="l00616"></a><a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9a280acd6e88765fc97a4833aa18e30968">00616</a>         <a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9a280acd6e88765fc97a4833aa18e30968">LCF_ASYNC</a>       = 0x1, <span class="comment">/* Cancel locks asynchronously. */</span>
<a name="l00617"></a><a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9af745ae50a795037166be155b3a00183d">00617</a>         <a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9af745ae50a795037166be155b3a00183d">LCF_LOCAL</a>       = 0x2, <span class="comment">/* Cancel locks locally, not notifing server */</span>
<a name="l00618"></a><a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9acec66c002c870ae3b45fbd09ad15ad16">00618</a>         <a class="code" href="group__LDLM.html#gga0b718c2d27bc15f43205e50e4da16ec9acec66c002c870ae3b45fbd09ad15ad16">LCF_BL_AST</a>      = 0x4, <span class="comment">/* Cancel LDLM_FL_BL_AST locks in the same RPC */</span>
<a name="l00619"></a>00619 };
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="structldlm__flock.html">00621</a> <span class="keyword">struct </span><a class="code" href="structldlm__flock.html">ldlm_flock</a> {
<a name="l00622"></a><a class="code" href="structldlm__flock.html#af1888e9cd42e92fe252184e9b122158e">00622</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structldlm__flock.html#af1888e9cd42e92fe252184e9b122158e">start</a>;
<a name="l00623"></a><a class="code" href="structldlm__flock.html#aea58b97e9fed16b453a5c8d152106f07">00623</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structldlm__flock.html#aea58b97e9fed16b453a5c8d152106f07">end</a>;
<a name="l00624"></a><a class="code" href="structldlm__flock.html#a26a812dc9d6d13978ad8ad3b3ad00409">00624</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structldlm__flock.html#a26a812dc9d6d13978ad8ad3b3ad00409">owner</a>;
<a name="l00625"></a><a class="code" href="structldlm__flock.html#af59eda5ea88d0113fa4023358f240e3e">00625</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="structldlm__flock.html#af59eda5ea88d0113fa4023358f240e3e">blocking_owner</a>;
<a name="l00626"></a><a class="code" href="structldlm__flock.html#a97614b3b3514e7a15768f3c644f6c047">00626</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *<a class="code" href="structldlm__flock.html#a97614b3b3514e7a15768f3c644f6c047">blocking_export</a>;
<a name="l00627"></a>00627         <span class="comment">/* Protected by the hash lock */</span>
<a name="l00628"></a><a class="code" href="structldlm__flock.html#a175b1a96dd9e135653aca7de50b42c67">00628</a>         __u32 <a class="code" href="structldlm__flock.html#a175b1a96dd9e135653aca7de50b42c67">blocking_refs</a>;
<a name="l00629"></a><a class="code" href="structldlm__flock.html#a9981459fe3346752576c65719b7aa6c7">00629</a>         __u32 <a class="code" href="structldlm__flock.html#a9981459fe3346752576c65719b7aa6c7">pid</a>;
<a name="l00630"></a>00630 };
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="unionldlm__policy__data.html">00632</a> <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> {
<a name="l00633"></a><a class="code" href="unionldlm__policy__data.html#a236126dd74c519fec18188164e86c73d">00633</a>         <span class="keyword">struct </span><a class="code" href="structldlm__extent.html">ldlm_extent</a> <a class="code" href="unionldlm__policy__data.html#a236126dd74c519fec18188164e86c73d">l_extent</a>;
<a name="l00634"></a><a class="code" href="unionldlm__policy__data.html#a5246d9917bd811be735c048927c1b43c">00634</a>         <span class="keyword">struct </span><a class="code" href="structldlm__flock.html">ldlm_flock</a> <a class="code" href="unionldlm__policy__data.html#a5246d9917bd811be735c048927c1b43c">l_flock</a>;
<a name="l00635"></a><a class="code" href="unionldlm__policy__data.html#a6d8b68c43c1ab750df044bdd2efade68">00635</a>         <span class="keyword">struct </span><a class="code" href="structldlm__inodebits.html">ldlm_inodebits</a> <a class="code" href="unionldlm__policy__data.html#a6d8b68c43c1ab750df044bdd2efade68">l_inodebits</a>;
<a name="l00636"></a>00636 };
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga82466f1300e6e9395e768b7336c0ac46" title="Converts lock policy from local format to on the wire lock_desc format.">ldlm_convert_policy_to_wire</a>(<span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type,
<a name="l00639"></a>00639                                  <span class="keyword">const</span> <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *lpolicy,
<a name="l00640"></a>00640                                  <span class="keyword">union</span> <a class="code" href="unionldlm__wire__policy__data.html">ldlm_wire_policy_data</a> *wpolicy);
<a name="l00641"></a>00641 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga0f272b273065dc0d916fcb5c6b61d656" title="Converts lock policy from on the wire lock_desc format to local format.">ldlm_convert_policy_to_local</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type,
<a name="l00642"></a>00642                                   <span class="keyword">const</span> <span class="keyword">union</span> <a class="code" href="unionldlm__wire__policy__data.html">ldlm_wire_policy_data</a> *wpolicy,
<a name="l00643"></a>00643                                   <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *lpolicy);
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">00645</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> {
<a name="l00646"></a><a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622bab1967a2d167089505571b25c0a6547f2">00646</a>         <a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622bab1967a2d167089505571b25c0a6547f2">LVB_T_NONE</a>      = 0,
<a name="l00647"></a><a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622ba2ae75dc7422531699cd74001225a39e2">00647</a>         <a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622ba2ae75dc7422531699cd74001225a39e2">LVB_T_OST</a>       = 1,
<a name="l00648"></a><a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622baaab44131ef0d4c55db5843cebc2cd7be">00648</a>         <a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622baaab44131ef0d4c55db5843cebc2cd7be">LVB_T_LQUOTA</a>    = 2,
<a name="l00649"></a><a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622ba0a84718eea4af0a71dee79c2d1d535e4">00649</a>         <a class="code" href="group__LDLM.html#gga2e4dbf6d38ddcec566ec40c96391622ba0a84718eea4af0a71dee79c2d1d535e4">LVB_T_LAYOUT</a>    = 3,
<a name="l00650"></a>00650 };
<a name="l00651"></a>00651 
<a name="l00655"></a><a class="code" href="group__LDLM.html#ga23d29567f6cc8a2df9416fe89a728b0e">00655</a> <span class="preprocessor">#define LDLM_GID_ANY  ((__u64)-1)</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>
<a name="l00666"></a><a class="code" href="structldlm__lock.html">00666</a> <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> {
<a name="l00678"></a><a class="code" href="structldlm__lock.html#af6bfe0ab210b608d0fa59ee6e95841ec">00678</a>         <span class="keyword">struct </span><a class="code" href="structportals__handle.html">portals_handle</a>   <a class="code" href="structldlm__lock.html#af6bfe0ab210b608d0fa59ee6e95841ec" title="Local lock handle.">l_handle</a>;
<a name="l00684"></a><a class="code" href="structldlm__lock.html#acd61f904bdcdfee7845701368db6003d">00684</a>         atomic_t                <a class="code" href="structldlm__lock.html#acd61f904bdcdfee7845701368db6003d" title="Lock reference count.">l_refc</a>;
<a name="l00689"></a><a class="code" href="structldlm__lock.html#ab7ff3f52f4765c133758c21e0d224a8b">00689</a>         spinlock_t              <a class="code" href="structldlm__lock.html#ab7ff3f52f4765c133758c21e0d224a8b" title="Internal spinlock protects l_resource.">l_lock</a>;
<a name="l00694"></a><a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f">00694</a>         <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a>    *<a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f" title="Pointer to actual resource this lock is in.">l_resource</a>;
<a name="l00699"></a><a class="code" href="structldlm__lock.html#a039f73a41d5d8a655eff3b056963847d">00699</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a039f73a41d5d8a655eff3b056963847d" title="List item for client side LRU list.">l_lru</a>;
<a name="l00705"></a><a class="code" href="structldlm__lock.html#a64ad5a636aec3f0825f1eea9df1a5734">00705</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a64ad5a636aec3f0825f1eea9df1a5734" title="Linkage to resource&amp;#39;s lock queues according to current lock state.">l_res_link</a>;
<a name="l00709"></a><a class="code" href="structldlm__lock.html#abc34b7aa1202f2a2830f825ba7918f2d">00709</a>         <span class="keyword">struct </span><a class="code" href="structldlm__interval.html" title="Interval node data for each LDLM_EXTENT lock.">ldlm_interval</a>    *<a class="code" href="structldlm__lock.html#abc34b7aa1202f2a2830f825ba7918f2d" title="Tree node for ldlm_extent.">l_tree_node</a>;
<a name="l00714"></a><a class="code" href="structldlm__lock.html#aa9c7b6de27615654aab63f1b924df9a6">00714</a>         <span class="keyword">struct </span><a class="code" href="structhlist__node.html">hlist_node</a>       <a class="code" href="structldlm__lock.html#aa9c7b6de27615654aab63f1b924df9a6" title="Per export hash of locks.">l_exp_hash</a>;
<a name="l00719"></a><a class="code" href="structldlm__lock.html#a89387ae7cb253ca09998dce444eac825">00719</a>         <span class="keyword">struct </span><a class="code" href="structhlist__node.html">hlist_node</a>       <a class="code" href="structldlm__lock.html#a89387ae7cb253ca09998dce444eac825" title="Per export hash of flock locks.">l_exp_flock_hash</a>;
<a name="l00724"></a><a class="code" href="structldlm__lock.html#a4c3ab4e1a3ec7f022d954251e6eafa67">00724</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>          <a class="code" href="structldlm__lock.html#a4c3ab4e1a3ec7f022d954251e6eafa67" title="Requested mode.">l_req_mode</a>;
<a name="l00728"></a><a class="code" href="structldlm__lock.html#a714ebd7977f069a111bf98aa7b202167">00728</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>          <a class="code" href="structldlm__lock.html#a714ebd7977f069a111bf98aa7b202167" title="Granted mode, also protected by lr_lock.">l_granted_mode</a>;
<a name="l00730"></a><a class="code" href="structldlm__lock.html#aa8070acdaa6bb825842083d710f8a935">00730</a>         <a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257" title="Type for completion callback function of a lock.">ldlm_completion_callback</a> <a class="code" href="structldlm__lock.html#aa8070acdaa6bb825842083d710f8a935" title="Lock completion handler pointer.">l_completion_ast</a>;
<a name="l00741"></a><a class="code" href="structldlm__lock.html#ac1baaa1cb6f8c57cd0e574dff1dcdfd8">00741</a>         <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>  <a class="code" href="structldlm__lock.html#ac1baaa1cb6f8c57cd0e574dff1dcdfd8" title="Lock blocking AST handler pointer.">l_blocking_ast</a>;
<a name="l00747"></a><a class="code" href="structldlm__lock.html#aaa0d1608f452158ab011eecc6f978058">00747</a>         <a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d" title="Type for glimpse callback function of a lock.">ldlm_glimpse_callback</a>   <a class="code" href="structldlm__lock.html#aaa0d1608f452158ab011eecc6f978058" title="Lock glimpse handler.">l_glimpse_ast</a>;
<a name="l00748"></a>00748 
<a name="l00754"></a><a class="code" href="structldlm__lock.html#a60b23d06e26065065d0bac47ace905b0">00754</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structldlm__lock.html#a60b23d06e26065065d0bac47ace905b0" title="Lock export.">l_export</a>;
<a name="l00759"></a><a class="code" href="structldlm__lock.html#ae11dfeaaf68f7217bc5defa97b58b1b1">00759</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structldlm__lock.html#ae11dfeaaf68f7217bc5defa97b58b1b1" title="Lock connection export.">l_conn_export</a>;
<a name="l00760"></a>00760 
<a name="l00766"></a><a class="code" href="structldlm__lock.html#a2c6e6f83512b652ba6563740a3d3487e">00766</a>         <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a>    <a class="code" href="structldlm__lock.html#a2c6e6f83512b652ba6563740a3d3487e" title="Remote lock handle.">l_remote_handle</a>;
<a name="l00767"></a>00767 
<a name="l00772"></a><a class="code" href="structldlm__lock.html#a30dc0349b0b525d72e9a3a92ad19ff79">00772</a>         <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a>  <a class="code" href="structldlm__lock.html#a30dc0349b0b525d72e9a3a92ad19ff79" title="Representation of private data specific for a lock type.">l_policy_data</a>;
<a name="l00773"></a>00773 
<a name="l00778"></a><a class="code" href="structldlm__lock.html#a52cb4e433ee43b7326bfbb652c3d0598">00778</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__lock.html#a52cb4e433ee43b7326bfbb652c3d0598" title="Lock state flags.">l_flags</a>;
<a name="l00779"></a>00779 
<a name="l00784"></a><a class="code" href="structldlm__lock.html#abb8a2696003a5ba2a21c2365ecc2d275">00784</a>         __u32                   <a class="code" href="structldlm__lock.html#abb8a2696003a5ba2a21c2365ecc2d275" title="Lock r/w usage counters.">l_readers</a>;
<a name="l00785"></a><a class="code" href="structldlm__lock.html#a9d7d1e3aae30e19867dd45c9de95b6f9">00785</a>         __u32                   <a class="code" href="structldlm__lock.html#a9d7d1e3aae30e19867dd45c9de95b6f9">l_writers</a>;
<a name="l00791"></a><a class="code" href="structldlm__lock.html#a0ca58a0480ef9503c3548499e27c2e43">00791</a>         wait_queue_head_t       <a class="code" href="structldlm__lock.html#a0ca58a0480ef9503c3548499e27c2e43" title="If the lock is granted, a process sleeps on this waitq to learn when it&amp;#39;s no...">l_waitq</a>;
<a name="l00792"></a>00792 
<a name="l00797"></a><a class="code" href="structldlm__lock.html#af1f00870111fa501c0fb07a97c642fb1">00797</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structldlm__lock.html#af1f00870111fa501c0fb07a97c642fb1" title="Seconds.">l_last_activity</a>;
<a name="l00798"></a>00798 
<a name="l00803"></a><a class="code" href="structldlm__lock.html#ae5c325b0e0c567e7a32fa97d4aeb0796">00803</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structldlm__lock.html#ae5c325b0e0c567e7a32fa97d4aeb0796" title="Time last used by e.g.">l_last_used</a>;
<a name="l00804"></a>00804 
<a name="l00806"></a><a class="code" href="structldlm__lock.html#af103e96dfac8d06fe14a472577c0f7f6">00806</a>         <span class="keyword">struct </span><a class="code" href="structldlm__extent.html">ldlm_extent</a>      <a class="code" href="structldlm__lock.html#af103e96dfac8d06fe14a472577c0f7f6" title="Originally requested extent for the extent lock.">l_req_extent</a>;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808         <span class="comment">/*</span>
<a name="l00809"></a>00809 <span class="comment">         * Client-side-only members.</span>
<a name="l00810"></a>00810 <span class="comment">         */</span>
<a name="l00811"></a>00811 
<a name="l00812"></a><a class="code" href="structldlm__lock.html#ad9dc493ac24012a9a530f85cbb56fa25">00812</a>         <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>         <a class="code" href="structldlm__lock.html#ad9dc493ac24012a9a530f85cbb56fa25">l_lvb_type</a>;
<a name="l00813"></a>00813 
<a name="l00818"></a><a class="code" href="structldlm__lock.html#af9af59e08968100a683ab5f5d595a495">00818</a>         __u32                   <a class="code" href="structldlm__lock.html#af9af59e08968100a683ab5f5d595a495" title="Temporary storage for a LVB received during an enqueue operation.">l_lvb_len</a>;
<a name="l00819"></a><a class="code" href="structldlm__lock.html#a58e99cf39e7033e1a504afccc043f318">00819</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structldlm__lock.html#a58e99cf39e7033e1a504afccc043f318">l_lvb_data</a>;
<a name="l00820"></a>00820 
<a name="l00822"></a><a class="code" href="structldlm__lock.html#acb54919a43db8f99a336c67e0988fdb8">00822</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structldlm__lock.html#acb54919a43db8f99a336c67e0988fdb8" title="Private storage for lock user.">l_ast_data</a>;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824         <span class="comment">/*</span>
<a name="l00825"></a>00825 <span class="comment">         * Server-side-only members.</span>
<a name="l00826"></a>00826 <span class="comment">         */</span>
<a name="l00827"></a>00827 
<a name="l00833"></a><a class="code" href="structldlm__lock.html#a4f6fa304d22507684a9483ecaf67c646">00833</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structldlm__lock.html#a4f6fa304d22507684a9483ecaf67c646" title="Connection cookie for the client originating the operation.">l_client_cookie</a>;
<a name="l00834"></a>00834 
<a name="l00843"></a><a class="code" href="structldlm__lock.html#a464e73d6b8dbeeb1f94f4235cc71b02a">00843</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a464e73d6b8dbeeb1f94f4235cc71b02a" title="List item for locks waiting for cancellation from clients.">l_pending_chain</a>;
<a name="l00844"></a>00844 
<a name="l00852"></a><a class="code" href="structldlm__lock.html#a693ba0644779a6c1c5a1f5c056de82a8">00852</a>         <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>              <a class="code" href="structldlm__lock.html#a693ba0644779a6c1c5a1f5c056de82a8" title="Set when lock is sent a blocking AST.">l_callback_timeout</a>;
<a name="l00853"></a>00853 
<a name="l00855"></a><a class="code" href="structldlm__lock.html#aa353839ecc6943a9c21f0ace1e220b8d">00855</a>         __u32                   <a class="code" href="structldlm__lock.html#aa353839ecc6943a9c21f0ace1e220b8d" title="Local PID of process which created this lock.">l_pid</a>;
<a name="l00856"></a>00856 
<a name="l00863"></a><a class="code" href="structldlm__lock.html#a7ba79dbc765caf7ab179a9a3dfd20b2b">00863</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__lock.html#a7ba79dbc765caf7ab179a9a3dfd20b2b" title="Number of times blocking AST was sent for this lock.">l_bl_ast_run</a>;
<a name="l00865"></a><a class="code" href="structldlm__lock.html#a21d60a379e0f50f97d14bde7dada4fb2">00865</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a21d60a379e0f50f97d14bde7dada4fb2" title="List item ldlm_add_ast_work_item() for case of blocking ASTs.">l_bl_ast</a>;
<a name="l00867"></a><a class="code" href="structldlm__lock.html#a7b43a74ce7191faf551c2ca62c880f10">00867</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a7b43a74ce7191faf551c2ca62c880f10" title="List item ldlm_add_ast_work_item() for case of completion ASTs.">l_cp_ast</a>;
<a name="l00869"></a><a class="code" href="structldlm__lock.html#a0f992bff4dba5d9c54588678ca261614">00869</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#a0f992bff4dba5d9c54588678ca261614" title="For ldlm_add_ast_work_item() for &amp;quot;revoke&amp;quot; AST used in COS.">l_rk_ast</a>;
<a name="l00870"></a>00870 
<a name="l00875"></a><a class="code" href="structldlm__lock.html#a61acd4dac2bc438e612c7ec0382dc2e4">00875</a>         <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a>        *<a class="code" href="structldlm__lock.html#a61acd4dac2bc438e612c7ec0382dc2e4" title="Pointer to a conflicting lock that caused blocking AST to be sent for this lock.">l_blocking_lock</a>;
<a name="l00876"></a>00876 
<a name="l00881"></a><a class="code" href="structldlm__lock.html#aa26a328bc8c2e6eff25c62c2d6e8c9ee">00881</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#aa26a328bc8c2e6eff25c62c2d6e8c9ee" title="Protected by lr_lock, linkages to &amp;quot;skip lists&amp;quot;.">l_sl_mode</a>;
<a name="l00882"></a><a class="code" href="structldlm__lock.html#ad4634b2ff8d252a3a8a81b0bb1db5464">00882</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#ad4634b2ff8d252a3a8a81b0bb1db5464">l_sl_policy</a>;
<a name="l00883"></a>00883 
<a name="l00885"></a><a class="code" href="structldlm__lock.html#a2cc84a3989e5b197caffa7a0fe014f27">00885</a>         <span class="keyword">struct </span><a class="code" href="structlu__ref.html">lu_ref</a>           <a class="code" href="structldlm__lock.html#a2cc84a3989e5b197caffa7a0fe014f27" title="Reference tracking structure to debug leaked locks.">l_reference</a>;
<a name="l00886"></a>00886 <span class="preprocessor">#if LUSTRE_TRACKS_LOCK_EXP_REFS</span>
<a name="l00887"></a>00887 <span class="preprocessor"></span>        <span class="comment">/* Debugging stuff for bug 20498, for tracking export references. */</span>
<a name="l00889"></a>00889         <span class="keywordtype">int</span>                     l_exp_refs_nr;
<a name="l00891"></a>00891         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        l_exp_refs_link;
<a name="l00893"></a>00893         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *l_exp_refs_target;
<a name="l00894"></a>00894 <span class="preprocessor">#endif</span>
<a name="l00895"></a>00895 <span class="preprocessor"></span>
<a name="l00901"></a><a class="code" href="structldlm__lock.html#adb27b96d85f21b4b27ca59159d8316ec">00901</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__lock.html#adb27b96d85f21b4b27ca59159d8316ec" title="export blocking dlm lock list, protected by l_export-&amp;gt;exp_bl_list_lock.">l_exp_list</a>;
<a name="l00902"></a>00902 };
<a name="l00903"></a>00903 
<a name="l00905"></a><a class="code" href="group__LDLM.html#ga5d4a0edfc41ee022966d492b8fa6bf0d">00905</a> <span class="preprocessor">#define l_transno l_client_cookie</span>
<a name="l00906"></a>00906 <span class="preprocessor"></span>
<a name="l00909"></a><a class="code" href="group__LDLM.html#ga23707c2e0c762c2638ee3bfa714f74de">00909</a> <span class="preprocessor">#define l_slc_link l_rk_ast</span>
<a name="l00910"></a>00910 <span class="preprocessor"></span>
<a name="l00922"></a><a class="code" href="structldlm__resource.html">00922</a> <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> {
<a name="l00923"></a><a class="code" href="structldlm__resource.html#aa615289f68134c817fd7aa1be8328c55">00923</a>         <span class="keyword">struct </span><a class="code" href="structldlm__ns__bucket.html">ldlm_ns_bucket</a>   *<a class="code" href="structldlm__resource.html#aa615289f68134c817fd7aa1be8328c55">lr_ns_bucket</a>;
<a name="l00924"></a>00924 
<a name="l00929"></a><a class="code" href="structldlm__resource.html#a36fa46d26cd7396ca5fb4984ab93ebed">00929</a>         <span class="keyword">struct </span><a class="code" href="structhlist__node.html">hlist_node</a>       <a class="code" href="structldlm__resource.html#a36fa46d26cd7396ca5fb4984ab93ebed" title="List item for list in namespace hash.">lr_hash</a>;
<a name="l00930"></a>00930 
<a name="l00932"></a><a class="code" href="structldlm__resource.html#af0ecca35646f6539567647ea604b9cc4">00932</a>         atomic_t                <a class="code" href="structldlm__resource.html#af0ecca35646f6539567647ea604b9cc4" title="Reference count for this resource.">lr_refcount</a>;
<a name="l00933"></a>00933 
<a name="l00935"></a><a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2">00935</a>         spinlock_t              <a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2" title="Spinlock to protect locks under this resource.">lr_lock</a>;
<a name="l00936"></a>00936 
<a name="l00941"></a><a class="code" href="structldlm__resource.html#aeb092453fc0c7d4db2ae7cd3dddd593a">00941</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__resource.html#aeb092453fc0c7d4db2ae7cd3dddd593a" title="protected by lr_lock">lr_granted</a>;
<a name="l00943"></a><a class="code" href="structldlm__resource.html#a29e2572837238205fc2e5180618d1fd5">00943</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__resource.html#a29e2572837238205fc2e5180618d1fd5" title="List of locks waiting to change their granted mode (converted).">lr_converting</a>;
<a name="l00947"></a><a class="code" href="structldlm__resource.html#af6bf768c2b52a0303d2118ce6a5190b6">00947</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__resource.html#af6bf768c2b52a0303d2118ce6a5190b6" title="List of locks that could not be granted due to conflicts and that are waiting for...">lr_waiting</a>;
<a name="l00951"></a><a class="code" href="structldlm__resource.html#aa749561d4248b6066c028d44def461dc">00951</a>         <span class="keyword">struct </span><a class="code" href="structldlm__res__id.html">ldlm_res_id</a>      <a class="code" href="structldlm__resource.html#aa749561d4248b6066c028d44def461dc" title="Resource name.">lr_name</a>;
<a name="l00952"></a>00952 
<a name="l00956"></a><a class="code" href="structldlm__resource.html#a177993de61d12f737e4652ce8490b4d1">00956</a>         <span class="keyword">struct </span><a class="code" href="structldlm__interval__tree.html" title="Interval tree for extent locks.">ldlm_interval_tree</a> *<a class="code" href="structldlm__resource.html#a177993de61d12f737e4652ce8490b4d1" title="Interval trees (only for extent locks) for all modes of this resource.">lr_itree</a>;
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         <span class="keyword">union </span>{
<a name="l00962"></a><a class="code" href="structldlm__resource.html#a01c434e73fbed05a8f16a1c0197f6dee">00962</a>                 <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a>      <a class="code" href="structldlm__resource.html#a01c434e73fbed05a8f16a1c0197f6dee" title="When the resource was considered as contended, used only on server side.">lr_contention_time</a>;
<a name="l00966"></a><a class="code" href="structldlm__resource.html#a8d169945f0f0d3b471280c3b18fe8fc1">00966</a>                 <span class="keyword">struct </span>inode    *<a class="code" href="structldlm__resource.html#a8d169945f0f0d3b471280c3b18fe8fc1" title="Associated inode, used only on client side.">lr_lvb_inode</a>;
<a name="l00967"></a>00967         };
<a name="l00968"></a>00968 
<a name="l00970"></a><a class="code" href="structldlm__resource.html#a49b3d8776d2a7ff57e963c988d1de5cf">00970</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a>          <a class="code" href="structldlm__resource.html#a49b3d8776d2a7ff57e963c988d1de5cf" title="Type of locks this resource can hold.">lr_type</a>; <span class="comment">/* LDLM_{PLAIN,EXTENT,FLOCK,IBITS} */</span>
<a name="l00971"></a>00971 
<a name="l00976"></a><a class="code" href="structldlm__resource.html#a32f7f043a25b2f5d37653bb0dffbeb0a">00976</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__resource.html#a32f7f043a25b2f5d37653bb0dffbeb0a" title="Server-side-only lock value block elements.">lr_lvb_len</a>;
<a name="l00977"></a><a class="code" href="structldlm__resource.html#a4aad09ec65c41c458fd1912e1f6784c4">00977</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structldlm__resource.html#a4aad09ec65c41c458fd1912e1f6784c4">lr_lvb_mutex</a>;
<a name="l00979"></a><a class="code" href="structldlm__resource.html#ad1c519bba417a9b3cafde71095e4cb52">00979</a>         <span class="keywordtype">void</span>                    *<a class="code" href="structldlm__resource.html#ad1c519bba417a9b3cafde71095e4cb52" title="protected by lr_lock">lr_lvb_data</a>;
<a name="l00981"></a><a class="code" href="structldlm__resource.html#a980f91829722a000b144ba6aabdfea6e">00981</a>         <span class="keywordtype">bool</span>                    <a class="code" href="structldlm__resource.html#a980f91829722a000b144ba6aabdfea6e" title="is lvb initialized ?">lr_lvb_initialized</a>;
<a name="l00982"></a>00982 
<a name="l00984"></a><a class="code" href="structldlm__resource.html#a5313c4407b408d5d1a9e183559eb85e2">00984</a>         <span class="keyword">struct </span><a class="code" href="structlu__ref.html">lu_ref</a>           <a class="code" href="structldlm__resource.html#a5313c4407b408d5d1a9e183559eb85e2" title="List of references to this resource.">lr_reference</a>;
<a name="l00985"></a>00985 };
<a name="l00986"></a>00986 
<a name="l00987"></a><a class="code" href="group__LDLM.html#ga8d888511805f9240f67510e7b149938c">00987</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="group__LDLM.html#ga8d888511805f9240f67510e7b149938c">ldlm_has_layout</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock)
<a name="l00988"></a>00988 {
<a name="l00989"></a>00989         <span class="keywordflow">return</span> lock-&gt;<a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f" title="Pointer to actual resource this lock is in.">l_resource</a>-&gt;<a class="code" href="structldlm__resource.html#a49b3d8776d2a7ff57e963c988d1de5cf" title="Type of locks this resource can hold.">lr_type</a> == <a class="code" href="packet-lustre_8c.html#afca8e3fd80560e42cd0c6013d34af412">LDLM_IBITS</a> &amp;&amp;
<a name="l00990"></a>00990                 lock-&gt;<a class="code" href="structldlm__lock.html#a30dc0349b0b525d72e9a3a92ad19ff79" title="Representation of private data specific for a lock type.">l_policy_data</a>.<a class="code" href="unionldlm__policy__data.html#a6d8b68c43c1ab750df044bdd2efade68">l_inodebits</a>.<a class="code" href="structldlm__inodebits.html#ab5ac21017af5d925dd81a7699544ea07">bits</a> &amp; <a class="code" href="group__lustreidl.html#gaf34fee0fbb2e192ee380c7553bd9be9e">MDS_INODELOCK_LAYOUT</a>;
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">char</span> *
<a name="l00994"></a><a class="code" href="group__LDLM.html#gad993dd3adae260ee3796898ec494d3cc">00994</a> <a class="code" href="group__LDLM.html#gad993dd3adae260ee3796898ec494d3cc">ldlm_ns_name</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns)
<a name="l00995"></a>00995 {
<a name="l00996"></a>00996         <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structldlm__namespace.html#ab98b19e574d298fcacdc25f5badb919d" title="Resource hash table for namespace.">ns_rs_hash</a>-&gt;<a class="code" href="structcfs__hash.html#a08d0891326130dcdfbd39d6d85aa3dd3" title="name of htable">hs_name</a>;
<a name="l00997"></a>00997 }
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *
<a name="l01000"></a><a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">01000</a> <a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res)
<a name="l01001"></a>01001 {
<a name="l01002"></a>01002         <span class="keywordflow">return</span> res-&gt;<a class="code" href="structldlm__resource.html#aa615289f68134c817fd7aa1be8328c55">lr_ns_bucket</a>-&gt;<a class="code" href="structldlm__ns__bucket.html#ad43f98ed5b7709ac0f3a6cb8b615afd2" title="back pointer to namespace">nsb_namespace</a>;
<a name="l01003"></a>01003 }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *
<a name="l01006"></a><a class="code" href="group__LDLM.html#gaebd5b336cb74307b3f15e7b922e20294">01006</a> <a class="code" href="group__LDLM.html#gaebd5b336cb74307b3f15e7b922e20294">ldlm_lock_to_ns</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock)
<a name="l01007"></a>01007 {
<a name="l01008"></a>01008         <span class="keywordflow">return</span> <a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(lock-&gt;<a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f" title="Pointer to actual resource this lock is in.">l_resource</a>);
<a name="l01009"></a>01009 }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">char</span> *
<a name="l01012"></a><a class="code" href="group__LDLM.html#ga3cfe3f5a492fdb04c6c46dbd7b91bcb0">01012</a> <a class="code" href="group__LDLM.html#ga3cfe3f5a492fdb04c6c46dbd7b91bcb0">ldlm_lock_to_ns_name</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock)
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014         <span class="keywordflow">return</span> <a class="code" href="group__LDLM.html#gad993dd3adae260ee3796898ec494d3cc">ldlm_ns_name</a>(<a class="code" href="group__LDLM.html#gaebd5b336cb74307b3f15e7b922e20294">ldlm_lock_to_ns</a>(lock));
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structadaptive__timeout.html">adaptive_timeout</a> *
<a name="l01018"></a><a class="code" href="group__LDLM.html#ga8e3dcd014075af79a7f3b9d089769837">01018</a> <a class="code" href="group__LDLM.html#ga8e3dcd014075af79a7f3b9d089769837">ldlm_lock_to_ns_at</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020         <span class="keywordflow">return</span> &amp;lock-&gt;<a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f" title="Pointer to actual resource this lock is in.">l_resource</a>-&gt;<a class="code" href="structldlm__resource.html#aa615289f68134c817fd7aa1be8328c55">lr_ns_bucket</a>-&gt;<a class="code" href="structldlm__ns__bucket.html#a1048b7de1fc1e4463b2f10d642771e02" title="Estimated lock callback time.">nsb_at_estimate</a>;
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a><a class="code" href="group__LDLM.html#ga0ce4a4a1e256dd8b6243c96eb669bc71">01023</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga0ce4a4a1e256dd8b6243c96eb669bc71">ldlm_lvbo_init</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res)
<a name="l01024"></a>01024 {
<a name="l01025"></a>01025         <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns = <a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(res);
<a name="l01026"></a>01026         <span class="keywordtype">int</span> rc = 0;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028         <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a> == NULL || ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#a163fdf3cd2200c7fed6efeffc10a9f9a">lvbo_init</a> == NULL ||
<a name="l01029"></a>01029             res-&gt;<a class="code" href="structldlm__resource.html#a980f91829722a000b144ba6aabdfea6e" title="is lvb initialized ?">lr_lvb_initialized</a>)
<a name="l01030"></a>01030                 <span class="keywordflow">return</span> 0;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032         mutex_lock(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a4aad09ec65c41c458fd1912e1f6784c4">lr_lvb_mutex</a>);
<a name="l01033"></a>01033         <span class="comment">/* Did we lose the race? */</span>
<a name="l01034"></a>01034         <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structldlm__resource.html#a980f91829722a000b144ba6aabdfea6e" title="is lvb initialized ?">lr_lvb_initialized</a>) {
<a name="l01035"></a>01035                 mutex_unlock(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a4aad09ec65c41c458fd1912e1f6784c4">lr_lvb_mutex</a>);
<a name="l01036"></a>01036                 <span class="keywordflow">return</span> 0;
<a name="l01037"></a>01037         }
<a name="l01038"></a>01038         rc = ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#a163fdf3cd2200c7fed6efeffc10a9f9a">lvbo_init</a>(res);
<a name="l01039"></a>01039         <span class="keywordflow">if</span> (rc &lt; 0) {
<a name="l01040"></a>01040                 <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a6aee38fab1cf469167142783354b03e0">D_DLMTRACE</a>, <span class="stringliteral">&quot;lvbo_init failed for resource : rc = %d\n&quot;</span>,
<a name="l01041"></a>01041                        rc);
<a name="l01042"></a>01042                 <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structldlm__resource.html#ad1c519bba417a9b3cafde71095e4cb52" title="protected by lr_lock">lr_lvb_data</a> != NULL) {
<a name="l01043"></a>01043                         <a class="code" href="obd__support_8h.html#a9bf49373d607ed467488261f133e5e49">OBD_FREE</a>(res-&gt;<a class="code" href="structldlm__resource.html#ad1c519bba417a9b3cafde71095e4cb52" title="protected by lr_lock">lr_lvb_data</a>, res-&gt;<a class="code" href="structldlm__resource.html#a32f7f043a25b2f5d37653bb0dffbeb0a" title="Server-side-only lock value block elements.">lr_lvb_len</a>);
<a name="l01044"></a>01044                         res-&gt;<a class="code" href="structldlm__resource.html#ad1c519bba417a9b3cafde71095e4cb52" title="protected by lr_lock">lr_lvb_data</a> = NULL;
<a name="l01045"></a>01045                 }
<a name="l01046"></a>01046                 res-&gt;<a class="code" href="structldlm__resource.html#a32f7f043a25b2f5d37653bb0dffbeb0a" title="Server-side-only lock value block elements.">lr_lvb_len</a> = rc;
<a name="l01047"></a>01047         } <span class="keywordflow">else</span> {
<a name="l01048"></a>01048                 res-&gt;<a class="code" href="structldlm__resource.html#a980f91829722a000b144ba6aabdfea6e" title="is lvb initialized ?">lr_lvb_initialized</a> = <span class="keyword">true</span>;
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050         mutex_unlock(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a4aad09ec65c41c458fd1912e1f6784c4">lr_lvb_mutex</a>);
<a name="l01051"></a>01051         <span class="keywordflow">return</span> rc;
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01054"></a><a class="code" href="group__LDLM.html#ga177ac9912af912c52cd450e3bf11acb5">01054</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga177ac9912af912c52cd450e3bf11acb5">ldlm_lvbo_size</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock)
<a name="l01055"></a>01055 {
<a name="l01056"></a>01056         <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns = <a class="code" href="group__LDLM.html#gaebd5b336cb74307b3f15e7b922e20294">ldlm_lock_to_ns</a>(lock);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058         <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a> != NULL &amp;&amp; ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#ab6db7ae145623d30b6700052ac56367c">lvbo_size</a> != NULL)
<a name="l01059"></a>01059                 <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#ab6db7ae145623d30b6700052ac56367c">lvbo_size</a>(lock);
<a name="l01060"></a>01060 
<a name="l01061"></a>01061         <span class="keywordflow">return</span> 0;
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01064"></a><a class="code" href="group__LDLM.html#ga4ce8965091314ccd3278e3695205c1c7">01064</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga4ce8965091314ccd3278e3695205c1c7">ldlm_lvbo_fill</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>, <span class="keywordtype">int</span> len)
<a name="l01065"></a>01065 {
<a name="l01066"></a>01066         <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns = <a class="code" href="group__LDLM.html#gaebd5b336cb74307b3f15e7b922e20294">ldlm_lock_to_ns</a>(lock);
<a name="l01067"></a>01067         <span class="keywordtype">int</span> rc;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a> != NULL) {
<a name="l01070"></a>01070                 <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#aa3569cda637416d3f27f7a4f1de678ef">lvbo_fill</a> != NULL);
<a name="l01071"></a>01071                 <span class="comment">/* init lvb now if not already */</span>
<a name="l01072"></a>01072                 rc = <a class="code" href="group__LDLM.html#ga0ce4a4a1e256dd8b6243c96eb669bc71">ldlm_lvbo_init</a>(lock-&gt;<a class="code" href="structldlm__lock.html#a41f4592eb59ed0c94d85e9fa67acfa6f" title="Pointer to actual resource this lock is in.">l_resource</a>);
<a name="l01073"></a>01073                 <span class="keywordflow">if</span> (rc &lt; 0) {
<a name="l01074"></a>01074                         <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;lock %p: delayed lvb init failed (rc %d)&quot;</span>,
<a name="l01075"></a>01075                                lock, rc);
<a name="l01076"></a>01076                         <span class="keywordflow">return</span> rc;
<a name="l01077"></a>01077                 }
<a name="l01078"></a>01078                 <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#aa3569cda637416d3f27f7a4f1de678ef">lvbo_fill</a>(lock, buf, len);
<a name="l01079"></a>01079         }
<a name="l01080"></a>01080         <span class="keywordflow">return</span> 0;
<a name="l01081"></a>01081 }
<a name="l01082"></a>01082 
<a name="l01083"></a><a class="code" href="structldlm__ast__work.html">01083</a> <span class="keyword">struct </span><a class="code" href="structldlm__ast__work.html">ldlm_ast_work</a> {
<a name="l01084"></a><a class="code" href="structldlm__ast__work.html#ae52e9e0e3c46cc1d96c7e4821ea36f45">01084</a>         <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a>       *<a class="code" href="structldlm__ast__work.html#ae52e9e0e3c46cc1d96c7e4821ea36f45">w_lock</a>;
<a name="l01085"></a><a class="code" href="structldlm__ast__work.html#af422bc3273472217380734e777431be4">01085</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__ast__work.html#af422bc3273472217380734e777431be4">w_blocking</a>;
<a name="l01086"></a><a class="code" href="structldlm__ast__work.html#a3e2b4100fc2b29a04b00cfe16a5a3131">01086</a>         <span class="keyword">struct </span><a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a>   <a class="code" href="structldlm__ast__work.html#a3e2b4100fc2b29a04b00cfe16a5a3131">w_desc</a>;
<a name="l01087"></a><a class="code" href="structldlm__ast__work.html#a443415b78ebaddc79182c2fca3faad14">01087</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structldlm__ast__work.html#a443415b78ebaddc79182c2fca3faad14">w_list</a>;
<a name="l01088"></a><a class="code" href="structldlm__ast__work.html#a15d7cd9bb8b7183622f85522b929e3d1">01088</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__ast__work.html#a15d7cd9bb8b7183622f85522b929e3d1">w_flags</a>;
<a name="l01089"></a><a class="code" href="structldlm__ast__work.html#ab5b4a4ed9778511dcfd61a289d44a64d">01089</a>         <span class="keywordtype">void</span>                   *<a class="code" href="structldlm__ast__work.html#ab5b4a4ed9778511dcfd61a289d44a64d">w_data</a>;
<a name="l01090"></a><a class="code" href="structldlm__ast__work.html#abe2ed2ce7c7351331017df4c878ccf6e">01090</a>         <span class="keywordtype">int</span>                     <a class="code" href="structldlm__ast__work.html#abe2ed2ce7c7351331017df4c878ccf6e">w_datalen</a>;
<a name="l01091"></a>01091 };
<a name="l01092"></a>01092 
<a name="l01096"></a><a class="code" href="structldlm__enqueue__info.html">01096</a> <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> {
<a name="l01097"></a><a class="code" href="structldlm__enqueue__info.html#a6b87487abead59973262624bf9f90eb0">01097</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a>  <a class="code" href="structldlm__enqueue__info.html#a6b87487abead59973262624bf9f90eb0">ei_type</a>;        
<a name="l01098"></a><a class="code" href="structldlm__enqueue__info.html#af97991a29b4940204cb0bef4bafeb678">01098</a>         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a>  <a class="code" href="structldlm__enqueue__info.html#af97991a29b4940204cb0bef4bafeb678" title="Type of the lock being enqueued.">ei_mode</a>;        
<a name="l01099"></a><a class="code" href="structldlm__enqueue__info.html#abf96eb0f7a2c82dc89872dedfe64b223">01099</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#abf96eb0f7a2c82dc89872dedfe64b223" title="Mode of the lock being enqueued.">ei_cb_bl</a>;      
<a name="l01100"></a><a class="code" href="structldlm__enqueue__info.html#a24cf0bf24a24a88c75acbddc1d61b33f">01100</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#a24cf0bf24a24a88c75acbddc1d61b33f" title="blocking lock callback">ei_cb_local_bl</a>; 
<a name="l01101"></a><a class="code" href="structldlm__enqueue__info.html#a08e843216d2e582b026fb5379fac9814">01101</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#a08e843216d2e582b026fb5379fac9814" title="blocking local lock callback">ei_cb_cp</a>;      
<a name="l01102"></a><a class="code" href="structldlm__enqueue__info.html#a486fcd5061cb4cb937812c7979d568b3">01102</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#a486fcd5061cb4cb937812c7979d568b3" title="lock completion callback">ei_cb_gl</a>;      
<a name="l01103"></a><a class="code" href="structldlm__enqueue__info.html#af0ba62d8b646a2164ec979fb9bca48d4">01103</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#af0ba62d8b646a2164ec979fb9bca48d4" title="lock glimpse callback">ei_cbdata</a>;     
<a name="l01104"></a><a class="code" href="structldlm__enqueue__info.html#abb00c3085d1654b9fd3cf6842ff82e60">01104</a>         <span class="keywordtype">void</span>            *<a class="code" href="structldlm__enqueue__info.html#abb00c3085d1654b9fd3cf6842ff82e60" title="Data to be passed into callbacks.">ei_namespace</a>;  
<a name="l01105"></a><a class="code" href="structldlm__enqueue__info.html#ab7eaef7f96129b8b5f0c9d37f481ea02">01105</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="structldlm__enqueue__info.html#afb3bba9ba05dd54bce7d863dbad3a8cb" title="lock namespace">ei_enq_slave</a>:1, 
<a name="l01106"></a>01106                         <a class="code" href="structldlm__enqueue__info.html#ab7eaef7f96129b8b5f0c9d37f481ea02" title="whether enqueue slave stripes">ei_nonblock</a>:1;  
<a name="l01107"></a>01107 };
<a name="l01108"></a>01108 
<a name="l01109"></a><a class="code" href="group__LDLM.html#gacc5fbacf11637d2acac3440b4dbe56f6">01109</a> <span class="preprocessor">#define ei_res_id       ei_cb_gl</span>
<a name="l01110"></a>01110 <span class="preprocessor"></span>
<a name="l01111"></a>01111 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structobd__ops.html">obd_ops</a> <a class="code" href="group__LDLM.html#ga84fad911c326a86839530f221c86f7e7">ldlm_obd_ops</a>;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="group__LDLM.html#gaacf06e33756d242222391e67857d6e14">ldlm_lockname</a>[];
<a name="l01114"></a>01114 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="group__LDLM.html#ga0ec36144688c37580c1c66f547ba3c08">ldlm_typename</a>[];
<a name="l01115"></a>01115 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__LDLM.html#gad3450a8071d042dd92be8f2a9177e112">ldlm_it2str</a>(<span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga9c053c844f0d79b44f18bb65850a6081">ldlm_intent_flags</a> it);
<a name="l01116"></a>01116 
<a name="l01122"></a><a class="code" href="group__LDLM.html#gae27210c0d51e6f38e3b5f2ff08793f97">01122</a> <span class="preprocessor">#define LDLM_DEBUG_NOLOCK(format, a...)                 \</span>
<a name="l01123"></a>01123 <span class="preprocessor">        CDEBUG(D_DLMTRACE, &quot;### &quot; format &quot;\n&quot; , ##a)</span>
<a name="l01124"></a>01124 <span class="preprocessor"></span>
<a name="l01129"></a>01129 <span class="preprocessor">#ifdef LIBCFS_DEBUG</span>
<a name="l01130"></a>01130 <span class="preprocessor"></span><span class="preprocessor">#define ldlm_lock_debug(msgdata, mask, cdls, lock, fmt, a...) do {      \</span>
<a name="l01131"></a>01131 <span class="preprocessor">        CFS_CHECK_STACK(msgdata, mask, cdls);                           \</span>
<a name="l01132"></a>01132 <span class="preprocessor">                                                                        \</span>
<a name="l01133"></a>01133 <span class="preprocessor">        if (((mask) &amp; D_CANTMASK) != 0 ||                               \</span>
<a name="l01134"></a>01134 <span class="preprocessor">            ((libcfs_debug &amp; (mask)) != 0 &amp;&amp;                            \</span>
<a name="l01135"></a>01135 <span class="preprocessor">             (libcfs_subsystem_debug &amp; DEBUG_SUBSYSTEM) != 0))          \</span>
<a name="l01136"></a>01136 <span class="preprocessor">                _ldlm_lock_debug(lock, msgdata, fmt, ##a);              \</span>
<a name="l01137"></a>01137 <span class="preprocessor">} while(0)</span>
<a name="l01138"></a>01138 <span class="preprocessor"></span>
<a name="l01139"></a>01139 <span class="keywordtype">void</span> <a class="code" href="ldlm__lock_8c.html#a5d1086a76031792f1974149627c1f338" title="Print lock information with custom message into debug log.">_ldlm_lock_debug</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock,
<a name="l01140"></a>01140                       <span class="keyword">struct</span> <a class="code" href="structlibcfs__debug__msg__data.html">libcfs_debug_msg_data</a> *data,
<a name="l01141"></a>01141                       <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l01142"></a>01142         <a class="code" href="fid_8mod_8c.html#a804f230e6220e338767d15b94fc5801d">__attribute__</a> ((format (printf, 3, 4)));
<a name="l01143"></a>01143 
<a name="l01147"></a>01147 <span class="preprocessor">#define LDLM_DEBUG_LIMIT(mask, lock, fmt, a...) do {                         \</span>
<a name="l01148"></a>01148 <span class="preprocessor">        static struct cfs_debug_limit_state _ldlm_cdls;                      \</span>
<a name="l01149"></a>01149 <span class="preprocessor">        LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, mask, &amp;_ldlm_cdls);              \</span>
<a name="l01150"></a>01150 <span class="preprocessor">        ldlm_lock_debug(&amp;msgdata, mask, &amp;_ldlm_cdls, lock, &quot;### &quot; fmt , ##a);\</span>
<a name="l01151"></a>01151 <span class="preprocessor">} while (0)</span>
<a name="l01152"></a>01152 <span class="preprocessor"></span>
<a name="l01153"></a>01153 <span class="preprocessor">#define LDLM_ERROR(lock, fmt, a...) LDLM_DEBUG_LIMIT(D_ERROR, lock, fmt, ## a)</span>
<a name="l01154"></a>01154 <span class="preprocessor"></span><span class="preprocessor">#define LDLM_WARN(lock, fmt, a...)  LDLM_DEBUG_LIMIT(D_WARNING, lock, fmt, ## a)</span>
<a name="l01155"></a>01155 <span class="preprocessor"></span>
<a name="l01157"></a>01157 <span class="preprocessor">#define LDLM_DEBUG(lock, fmt, a...)   do {                                  \</span>
<a name="l01158"></a>01158 <span class="preprocessor">        if (likely(lock != NULL)) {                                         \</span>
<a name="l01159"></a>01159 <span class="preprocessor">                LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, D_DLMTRACE, NULL);      \</span>
<a name="l01160"></a>01160 <span class="preprocessor">                ldlm_lock_debug(&amp;msgdata, D_DLMTRACE, NULL, lock,           \</span>
<a name="l01161"></a>01161 <span class="preprocessor">                                &quot;### &quot; fmt , ##a);                          \</span>
<a name="l01162"></a>01162 <span class="preprocessor">        } else {                                                            \</span>
<a name="l01163"></a>01163 <span class="preprocessor">                LDLM_DEBUG_NOLOCK(&quot;no dlm lock: &quot; fmt, ##a);                \</span>
<a name="l01164"></a>01164 <span class="preprocessor">        }                                                                   \</span>
<a name="l01165"></a>01165 <span class="preprocessor">} while (0)</span>
<a name="l01166"></a>01166 <span class="preprocessor"></span><span class="preprocessor">#else </span><span class="comment">/* !LIBCFS_DEBUG */</span>
<a name="l01167"></a><a class="code" href="group__LDLM.html#ga1e2b479743aab3ba4119e5c751a6f188">01167</a> <span class="preprocessor"># define LDLM_DEBUG_LIMIT(mask, lock, fmt, a...) ((void)0)</span>
<a name="l01168"></a><a class="code" href="group__LDLM.html#gad8d04218a1ba26d32ea36a1f5aebc505">01168</a> <span class="preprocessor"></span><span class="preprocessor"># define LDLM_DEBUG(lock, fmt, a...) ((void)0)</span>
<a name="l01169"></a><a class="code" href="group__LDLM.html#ga658466373582d350c15ffa570d598c35">01169</a> <span class="preprocessor"></span><span class="preprocessor"># define LDLM_ERROR(lock, fmt, a...) ((void)0)</span>
<a name="l01170"></a>01170 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01171"></a>01171 <span class="preprocessor"></span>
<a name="l01172"></a><a class="code" href="group__LDLM.html#ga4b5fe8de6c014f23ce08ae949daef596">01172</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#ga4b5fe8de6c014f23ce08ae949daef596">ldlm_processing_policy</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags,
<a name="l01173"></a>01173                                       <span class="keywordtype">int</span> first_enq, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7" title="LDLM non-error return states.">ldlm_error</a> *err,
<a name="l01174"></a>01174                                       <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *work_list);
<a name="l01175"></a>01175 
<a name="l01180"></a><a class="code" href="group__LDLM.html#gae6f33fb4095ce2a0e694892623aee022">01180</a> <span class="preprocessor">#define LDLM_ITER_CONTINUE 1 </span><span class="comment">/* keep iterating */</span>
<a name="l01181"></a><a class="code" href="group__LDLM.html#ga7232aeca0a992a2e812f6d639de7ea6b">01181</a> <span class="preprocessor">#define LDLM_ITER_STOP     2 </span><span class="comment">/* stop iterating */</span>
<a name="l01182"></a>01182 
<a name="l01183"></a><a class="code" href="group__LDLM.html#ga755fb40aeaf77f3a7d1591645ce49ce3">01183</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#ga755fb40aeaf77f3a7d1591645ce49ce3">ldlm_iterator_t</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *, <span class="keywordtype">void</span> *);
<a name="l01184"></a><a class="code" href="group__LDLM.html#gadc68d2afc94858f99c2d2306f8285273">01184</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__LDLM.html#gadc68d2afc94858f99c2d2306f8285273">ldlm_res_iterator_t</a>)(<span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *, <span class="keywordtype">void</span> *);
<a name="l01185"></a>01185 
<a name="l01191"></a>01191 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__iterator.html#ga69027ce9d6df10f0f7616afe7f57e41b">ldlm_resource_foreach</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res, <a class="code" href="group__LDLM.html#ga755fb40aeaf77f3a7d1591645ce49ce3">ldlm_iterator_t</a> iter,
<a name="l01192"></a>01192                           <span class="keywordtype">void</span> *closure);
<a name="l01193"></a>01193 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__iterator.html#ga4388dfb252bc19c385f53fac404c94d1">ldlm_namespace_foreach</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <a class="code" href="group__LDLM.html#ga755fb40aeaf77f3a7d1591645ce49ce3">ldlm_iterator_t</a> iter,
<a name="l01194"></a>01194                             <span class="keywordtype">void</span> *closure);
<a name="l01195"></a>01195 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__iterator.html#ga5c86e4d6012bca73aa85350d7b74b130">ldlm_resource_iterate</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *,
<a name="l01196"></a>01196                           <a class="code" href="group__LDLM.html#ga755fb40aeaf77f3a7d1591645ce49ce3">ldlm_iterator_t</a> iter, <span class="keywordtype">void</span> *data);
<a name="l01199"></a>01199 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga878ffb8d1a87e3787eb2bb6170fed457">ldlm_replay_locks</a>(<span class="keyword">struct</span> <a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *imp);
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 <span class="comment">/* ldlm_flock.c */</span>
<a name="l01202"></a>01202 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga921f8d85541cbe1fa330b9a12080103f" title="Flock completion callback function.">ldlm_flock_completion_ast</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, <span class="keywordtype">void</span> *data);
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="comment">/* ldlm_extent.c */</span>
<a name="l01205"></a>01205 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="group__LDLM.html#gaa9bd1ddd8fa94d5bb36d9ab2499148f3">ldlm_extent_shift_kms</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> old_kms);
<a name="l01206"></a>01206 
<a name="l01207"></a><a class="code" href="structldlm__callback__suite.html">01207</a> <span class="keyword">struct </span><a class="code" href="structldlm__callback__suite.html">ldlm_callback_suite</a> {
<a name="l01208"></a><a class="code" href="structldlm__callback__suite.html#a4c1b732aa92423047630fbaa3f2c2560">01208</a>         <a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257" title="Type for completion callback function of a lock.">ldlm_completion_callback</a> <a class="code" href="structldlm__callback__suite.html#a4c1b732aa92423047630fbaa3f2c2560">lcs_completion</a>;
<a name="l01209"></a><a class="code" href="structldlm__callback__suite.html#a2eade66b42b768d5ebb7b2862ddd3c76">01209</a>         <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>   <a class="code" href="structldlm__callback__suite.html#a2eade66b42b768d5ebb7b2862ddd3c76">lcs_blocking</a>;
<a name="l01210"></a><a class="code" href="structldlm__callback__suite.html#af417a6af1c4ae1d61e850e8b6760f271">01210</a>         <a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d" title="Type for glimpse callback function of a lock.">ldlm_glimpse_callback</a>    <a class="code" href="structldlm__callback__suite.html#af417a6af1c4ae1d61e850e8b6760f271">lcs_glimpse</a>;
<a name="l01211"></a>01211 };
<a name="l01212"></a>01212 
<a name="l01213"></a>01213 <span class="comment">/* ldlm_lockd.c */</span>
<a name="l01214"></a>01214 <span class="preprocessor">#ifdef HAVE_SERVER_SUPPORT</span>
<a name="l01215"></a>01215 <span class="preprocessor"></span>
<a name="l01220"></a>01220 <span class="keywordtype">int</span> ldlm_server_blocking_ast(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *, <span class="keyword">struct</span> <a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *,
<a name="l01221"></a>01221                              <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flag);
<a name="l01222"></a>01222 <span class="keywordtype">int</span> ldlm_server_completion_ast(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, <span class="keywordtype">void</span> *data);
<a name="l01223"></a>01223 <span class="keywordtype">int</span> ldlm_server_glimpse_ast(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">void</span> *data);
<a name="l01224"></a>01224 <span class="keywordtype">int</span> ldlm_glimpse_locks(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l01225"></a>01225                        <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *gl_work_list);
<a name="l01233"></a>01233 <span class="keywordtype">int</span> ldlm_handle_enqueue(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req, <a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257" title="Type for completion callback function of a lock.">ldlm_completion_callback</a>,
<a name="l01234"></a>01234                         <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a>, <a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d" title="Type for glimpse callback function of a lock.">ldlm_glimpse_callback</a>);
<a name="l01235"></a>01235 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gab2f8268913fc19a29b9d39248d3cbf0d">ldlm_handle_enqueue0</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01236"></a>01236                          <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__request.html">ldlm_request</a> *dlm_req,
<a name="l01237"></a>01237                          <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__callback__suite.html">ldlm_callback_suite</a> *cbs);
<a name="l01238"></a>01238 <span class="keywordtype">int</span> ldlm_handle_convert(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req);
<a name="l01239"></a>01239 <span class="keywordtype">int</span> ldlm_handle_convert0(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01240"></a>01240                          <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__request.html">ldlm_request</a> *dlm_req);
<a name="l01241"></a>01241 <span class="keywordtype">int</span> ldlm_handle_cancel(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req);
<a name="l01242"></a>01242 <span class="keywordtype">int</span> ldlm_request_cancel(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01243"></a>01243                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__request.html">ldlm_request</a> *dlm_req,
<a name="l01244"></a>01244                         <span class="keywordtype">int</span> first, <span class="keyword">enum</span> <a class="code" href="group__export.html#ga7c3ee0f07b2302a9cce270b277897d4e">lustre_at_flags</a> flags);
<a name="l01247"></a>01247 <span class="keywordtype">void</span> ldlm_revoke_export_locks(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l01248"></a>01248 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ldlm_bl_timeout(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01249"></a>01249 <span class="preprocessor">#endif</span>
<a name="l01250"></a>01250 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga2efedea3f32b10e36e3bcf7dc9aa44d2">ldlm_del_waiting_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01251"></a>01251 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gad3d835ffc8ea5737e46381b9772cc224">ldlm_refresh_waiting_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">int</span> <a class="code" href="gnilnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);
<a name="l01252"></a>01252 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga2582912f032081101820c56da0dbfb76">ldlm_get_ref</a>(<span class="keywordtype">void</span>);
<a name="l01253"></a>01253 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gabab5acbe0d24c0a37be4893ae6e00dcf">ldlm_put_ref</a>(<span class="keywordtype">void</span>);
<a name="l01254"></a>01254 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gaa1ae45d9f2b5213f12d150a3806e03b4">ldlm_init_export</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l01255"></a>01255 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga20871b8557c0afe94cb45c2d64cbd31f">ldlm_destroy_export</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l01256"></a>01256 <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *<a class="code" href="group__LDLM.html#gad7430abbe52b72b069536f6f99336d94">ldlm_request_lock</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258 <span class="comment">/* ldlm_lock.c */</span>
<a name="l01259"></a>01259 <span class="preprocessor">#ifdef HAVE_SERVER_SUPPORT</span>
<a name="l01260"></a>01260 <span class="preprocessor"></span><a class="code" href="group__LDLM.html#ga4b5fe8de6c014f23ce08ae949daef596">ldlm_processing_policy</a> ldlm_get_processing_policy(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l01261"></a>01261 <span class="preprocessor">#endif</span>
<a name="l01262"></a>01262 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga70d54ed9384416cd5e19fc593dac071f">ldlm_register_intent</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <a class="code" href="group__LDLM.html#ga07447890235da125e60400b2dee48626">ldlm_res_policy</a> arg);
<a name="l01263"></a>01263 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga35362f3605ec8dec52464f153c932c85" title="Fills in handle for LDLM lock lock into supplied lockh Does not take any references...">ldlm_lock2handle</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock,
<a name="l01264"></a>01264                       <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh);
<a name="l01265"></a>01265 <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *<a class="code" href="group__LDLM.html#gabac2ce09f8215c4f05a3a8113fa72545" title="Obtain a lock reference by handle.">__ldlm_handle2lock</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags);
<a name="l01266"></a>01266 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga0a466989372b56e3cde1edae472be066" title="Helper function to call blocking AST for LDLM lock lock in a &amp;quot;cancelling&amp;quot;...">ldlm_cancel_callback</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *);
<a name="l01267"></a>01267 <span class="keywordtype">int</span> <a class="code" href="ldlm__internal_8h.html#a9e17e885fc9439a175832779a2198eb5">ldlm_lock_remove_from_lru</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *);
<a name="l01268"></a>01268 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga098ec9c63984ffbe25f17174b376b1a0" title="Set opaque data into the lock that only makes sense to upper layer.">ldlm_lock_set_data</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keywordtype">void</span> *data);
<a name="l01269"></a>01269 
<a name="l01273"></a><a class="code" href="group__LDLM.html#ga362da0472f4016a927cc50b1163585e4">01273</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *<a class="code" href="group__LDLM.html#ga362da0472f4016a927cc50b1163585e4" title="Obtain a lock reference by its handle.">ldlm_handle2lock</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *h)
<a name="l01274"></a>01274 {
<a name="l01275"></a>01275         <span class="keywordflow">return</span> <a class="code" href="group__LDLM.html#gabac2ce09f8215c4f05a3a8113fa72545" title="Obtain a lock reference by handle.">__ldlm_handle2lock</a>(h, 0);
<a name="l01276"></a>01276 }
<a name="l01277"></a>01277 
<a name="l01278"></a><a class="code" href="group__LDLM.html#ga597fb61624bdd33a92ba76a5a67679d4">01278</a> <span class="preprocessor">#define LDLM_LOCK_REF_DEL(lock) \</span>
<a name="l01279"></a>01279 <span class="preprocessor">        lu_ref_del(&amp;lock-&gt;l_reference, &quot;handle&quot;, current)</span>
<a name="l01280"></a>01280 <span class="preprocessor"></span>
<a name="l01281"></a>01281 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *
<a name="l01282"></a><a class="code" href="group__LDLM.html#gaee7a1e25a9767f6e3bdbade69a15764f">01282</a> <a class="code" href="group__LDLM.html#gaee7a1e25a9767f6e3bdbade69a15764f">ldlm_handle2lock_long</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *h, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags)
<a name="l01283"></a>01283 {
<a name="l01284"></a>01284         <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286         lock = <a class="code" href="group__LDLM.html#gabac2ce09f8215c4f05a3a8113fa72545" title="Obtain a lock reference by handle.">__ldlm_handle2lock</a>(h, flags);
<a name="l01287"></a>01287         <span class="keywordflow">if</span> (lock != NULL)
<a name="l01288"></a>01288                 <a class="code" href="group__LDLM.html#ga597fb61624bdd33a92ba76a5a67679d4">LDLM_LOCK_REF_DEL</a>(lock);
<a name="l01289"></a>01289         <span class="keywordflow">return</span> lock;
<a name="l01290"></a>01290 }
<a name="l01291"></a>01291 
<a name="l01296"></a><a class="code" href="group__LDLM.html#ga4e79f430a220b667aaffb6b9c90d8de6">01296</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga4e79f430a220b667aaffb6b9c90d8de6" title="Update Lock Value Block Operations (LVBO) on a resource taking into account data...">ldlm_res_lvbo_update</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l01297"></a>01297                                        <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req, <span class="keywordtype">int</span> increase)
<a name="l01298"></a>01298 {
<a name="l01299"></a>01299         <span class="keywordtype">int</span> rc;
<a name="l01300"></a>01300 
<a name="l01301"></a>01301         <span class="comment">/* delayed lvb init may be required */</span>
<a name="l01302"></a>01302         rc = <a class="code" href="group__LDLM.html#ga0ce4a4a1e256dd8b6243c96eb669bc71">ldlm_lvbo_init</a>(res);
<a name="l01303"></a>01303         <span class="keywordflow">if</span> (rc &lt; 0) {
<a name="l01304"></a>01304                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;delayed lvb init failed (rc %d)\n&quot;</span>, rc);
<a name="l01305"></a>01305                 <span class="keywordflow">return</span> rc;
<a name="l01306"></a>01306         }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308         <span class="keywordflow">if</span> (<a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(res)-&gt;ns_lvbo &amp;&amp;
<a name="l01309"></a>01309             <a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(res)-&gt;ns_lvbo-&gt;lvbo_update) {
<a name="l01310"></a>01310                 <span class="keywordflow">return</span> <a class="code" href="group__LDLM.html#ga2f90eea238f99079aa6e2ee64c623e43">ldlm_res_to_ns</a>(res)-&gt;<a class="code" href="structldlm__namespace.html#ac6fc5806130bda67b8685acdb93ccf48" title="LVB operations for this namespace.">ns_lvbo</a>-&gt;<a class="code" href="structldlm__valblock__ops.html#a2a67bc2634b21d63b85e93494b74a067">lvbo_update</a>(res, req,
<a name="l01311"></a>01311                                                                  increase);
<a name="l01312"></a>01312         }
<a name="l01313"></a>01313         <span class="keywordflow">return</span> 0;
<a name="l01314"></a>01314 }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga7dac0446d813ef65c24c0831b6d1a519" title="Rather arbitrary mapping from LDLM error codes to errno values.">ldlm_error2errno</a>(<span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7" title="LDLM non-error return states.">ldlm_error</a> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01317"></a>01317 <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gaa2fbd012972eb2b2d0653c8df02964f7" title="LDLM non-error return states.">ldlm_error</a> <a class="code" href="group__LDLM.html#ga9d483fecb156d6db20dc2bfc1d6f11be" title="Dual to ldlm_error2errno(): maps errno values back to enum ldlm_error.">ldlm_errno2error</a>(<span class="keywordtype">int</span> err_no); <span class="comment">/* don&apos;t call it `errno&apos;: this</span>
<a name="l01318"></a>01318 <span class="comment">                                               * confuses user-space. */</span>
<a name="l01319"></a>01319 <span class="preprocessor">#if LUSTRE_TRACKS_LOCK_EXP_REFS</span>
<a name="l01320"></a>01320 <span class="preprocessor"></span><span class="keywordtype">void</span> ldlm_dump_export_locks(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp);
<a name="l01321"></a>01321 <span class="preprocessor">#endif</span>
<a name="l01322"></a>01322 <span class="preprocessor"></span>
<a name="l01327"></a><a class="code" href="group__LDLM.html#ga5945b4d89a157c2e0fb6d955b3bf0c3f">01327</a> <span class="preprocessor">#define LDLM_LOCK_PUT(lock)                     \</span>
<a name="l01328"></a>01328 <span class="preprocessor">do {                                            \</span>
<a name="l01329"></a>01329 <span class="preprocessor">        LDLM_LOCK_REF_DEL(lock);                \</span>
<a name="l01330"></a>01330 <span class="preprocessor">        </span><span class="comment">/*LDLM_DEBUG((lock), &quot;put&quot;);*/</span>          \
<a name="l01331"></a>01331         ldlm_lock_put(lock);                    \
<a name="l01332"></a>01332 } while (0)
<a name="l01333"></a>01333 
<a name="l01338"></a><a class="code" href="group__LDLM.html#gaf3357d35be5378aa299677e298c5a625">01338</a> <span class="preprocessor">#define LDLM_LOCK_RELEASE(lock)                 \</span>
<a name="l01339"></a>01339 <span class="preprocessor">do {                                            \</span>
<a name="l01340"></a>01340 <span class="preprocessor">        </span><span class="comment">/*LDLM_DEBUG((lock), &quot;put&quot;);*/</span>          \
<a name="l01341"></a>01341         ldlm_lock_put(lock);                    \
<a name="l01342"></a>01342 } while (0)
<a name="l01343"></a>01343 
<a name="l01344"></a><a class="code" href="group__LDLM.html#ga9c871836dbef822ef90080b3d6569c5f">01344</a> <span class="preprocessor">#define LDLM_LOCK_GET(lock)                     \</span>
<a name="l01345"></a>01345 <span class="preprocessor">({                                              \</span>
<a name="l01346"></a>01346 <span class="preprocessor">        ldlm_lock_get(lock);                    \</span>
<a name="l01347"></a>01347 <span class="preprocessor">        </span><span class="comment">/*LDLM_DEBUG((lock), &quot;get&quot;);*/</span>          \
<a name="l01348"></a>01348         lock;                                   \
<a name="l01349"></a>01349 })
<a name="l01350"></a>01350 
<a name="l01351"></a><a class="code" href="group__LDLM.html#gaec77446f52676c0679185593ce8e58e3">01351</a> <span class="preprocessor">#define ldlm_lock_list_put(head, member, count)                 \</span>
<a name="l01352"></a>01352 <span class="preprocessor">({                                                              \</span>
<a name="l01353"></a>01353 <span class="preprocessor">        struct ldlm_lock *_lock, *_next;                        \</span>
<a name="l01354"></a>01354 <span class="preprocessor">        int c = count;                                          \</span>
<a name="l01355"></a>01355 <span class="preprocessor">        list_for_each_entry_safe(_lock, _next, head, member) {  \</span>
<a name="l01356"></a>01356 <span class="preprocessor">                if (c-- == 0)                                   \</span>
<a name="l01357"></a>01357 <span class="preprocessor">                        break;                                  \</span>
<a name="l01358"></a>01358 <span class="preprocessor">                list_del_init(&amp;_lock-&gt;member);                  \</span>
<a name="l01359"></a>01359 <span class="preprocessor">                LDLM_LOCK_RELEASE(_lock);                       \</span>
<a name="l01360"></a>01360 <span class="preprocessor">        }                                                       \</span>
<a name="l01361"></a>01361 <span class="preprocessor">        LASSERT(c &lt;= 0);                                        \</span>
<a name="l01362"></a>01362 <span class="preprocessor">})</span>
<a name="l01363"></a>01363 <span class="preprocessor"></span>
<a name="l01364"></a>01364 <span class="keyword">struct </span><a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *<a class="code" href="group__LDLM.html#gac526504450a40715c8e25fbab715689e" title="Get a reference on a lock.">ldlm_lock_get</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01365"></a>01365 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga5e363707438fb69f9253f2ab8bf4c5e6" title="Release lock reference.">ldlm_lock_put</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01366"></a>01366 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga833125f7d72f8e77cb16c031c56dd2a0" title="Destroys a LDLM lock lock.">ldlm_lock_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01367"></a>01367 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga7b4cfac056355ba992b1b7d9bfbaa25b" title="Fill in &amp;quot;on the wire&amp;quot; representation for given LDLM lock into supplied...">ldlm_lock2desc</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keyword">struct</span> <a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *desc);
<a name="l01368"></a>01368 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga2d77135057c3b9123a3ae5704752c946" title="Add specified reader/writer reference to LDLM lock with handle lockh.">ldlm_lock_addref</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>);
<a name="l01369"></a>01369 <span class="keywordtype">int</span>  <a class="code" href="group__LDLM.html#ga580d951cff91ebd5c1d2a7588d4c2ea3" title="Attempts to add reader/writer reference to a lock with handle lockh, and fails if...">ldlm_lock_addref_try</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh,
<a name="l01370"></a>01370                           <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>);
<a name="l01371"></a>01371 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga82ed1d0d1d2788cad8813e69df77d625" title="Decrease reader/writer refcount for LDLM lock with handle lockh.">ldlm_lock_decref</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>);
<a name="l01372"></a>01372 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gad236a9af5f0845e1046060a55419914b" title="Decrease reader/writer refcount for LDLM lock with handle lockh and mark it for subsequent...">ldlm_lock_decref_and_cancel</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh,
<a name="l01373"></a>01373                                  <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>);
<a name="l01374"></a>01374 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga3f34c3286a49d3d2f1e4b16029647a5b">ldlm_lock_fail_match_locked</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01375"></a>01375 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gae911593eccfe0aa5995935808b646d2a">ldlm_lock_fail_match</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01376"></a>01376 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga9e8b401ed51dda94f553670e73872135" title="Mark lock as &amp;quot;matchable&amp;quot; by OST.">ldlm_lock_allow_match</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01377"></a>01377 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gab9c1d858901b9d9a4db13ffbad095fb6" title="Mark lock as &amp;quot;matchable&amp;quot; by OST.">ldlm_lock_allow_match_locked</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01378"></a>01378 <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="group__LDLM.html#ga1373811e4c4edbb039f1da1ca7947b03" title="Attempt to find a lock with specified properties.">ldlm_lock_match</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags,
<a name="l01379"></a>01379                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type,
<a name="l01380"></a>01380                                <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>,
<a name="l01381"></a>01381                                <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *, <span class="keywordtype">int</span> unref);
<a name="l01382"></a>01382 <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="group__LDLM.html#ga396833924edeb2118df4fdff47aa7489">ldlm_revalidate_lock_handle</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh,
<a name="l01383"></a>01383                                            <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *bits);
<a name="l01384"></a>01384 <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *<a class="code" href="group__LDLM.html#gaeeab5a5dbe0a5b966d52f388b69eed3f" title="Attempt to convert already granted lock to a different mode.">ldlm_lock_convert</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock,
<a name="l01385"></a>01385                                         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> new_mode, __u32 *flags);
<a name="l01386"></a>01386 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga1ae32c9c745cefc485fd39cf0054e2ef" title="Downgrade an exclusive lock.">ldlm_lock_downgrade</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> new_mode);
<a name="l01387"></a>01387 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gadec8a773eb3b13c995cf35a4d013393b" title="Attempts to cancel LDLM lock lock that has no reader/writer references.">ldlm_lock_cancel</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01388"></a>01388 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga6fea368fc4ea7002b0dcd068bbe8771a" title="Try to grant all waiting locks on a resource.">ldlm_reprocess_all</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l01389"></a>01389 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga6a893da5c75236bb6f573e2484d4eecc" title="Iterate through all resources on a namespace attempting to grant waiting locks.">ldlm_reprocess_all_ns</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns);
<a name="l01390"></a>01390 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga5f3ca6b2c348db5cd17b45c0e2b99ba8" title="Print lock with lock handle lockh description into debug log.">ldlm_lock_dump_handle</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh);
<a name="l01391"></a>01391 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaff973b12d9e531ff04c69b478d6750cb" title="Remove skiplist-enabled LDLM lock req from granted list.">ldlm_unlink_lock_skiplist</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *req);
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="comment">/* resource.c */</span>
<a name="l01394"></a>01394 <span class="keyword">struct </span><a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *<a class="code" href="group__LDLM.html#ga4b345e88ea06fc28c099254650b75c38" title="Create and initialize new empty namespace.">ldlm_namespace_new</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l01395"></a>01395                                           <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client,
<a name="l01396"></a>01396                                           <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gafcd8eee315d3a7e1313596efd678d77e" title="LDLM pools related, type of lock pool in the namespace.">ldlm_appetite</a> apt,
<a name="l01397"></a>01397                                           <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga516147f10f1ca82e556a7f8c3ee5d6ff">ldlm_ns_type</a> ns_type);
<a name="l01398"></a>01398 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gacfe66a2d51a46f0bf611952a83119bbc" title="Cancel and destroy all locks in the namespace.">ldlm_namespace_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags);
<a name="l01399"></a>01399 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaa7271dfc42956d8d75b2435a22c83832" title="Performs various cleanups for passed ns to make it drop refc and be ready for freeing...">ldlm_namespace_free_prior</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01400"></a>01400                                <span class="keyword">struct</span> <a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *imp,
<a name="l01401"></a>01401                                <span class="keywordtype">int</span> force);
<a name="l01402"></a>01402 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga10faf90111f6da7206f8b140b8d98fed" title="Performs freeing memory structures related to ns.">ldlm_namespace_free_post</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns);
<a name="l01403"></a>01403 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga9f9b87f84a794b96c043799f3840765c" title="Cleanup the resource, and free namespace.">ldlm_namespace_free</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01404"></a>01404                          <span class="keyword">struct</span> <a class="code" href="structobd__import.html" title="Defintion of PortalRPC import structure.">obd_import</a> *imp, <span class="keywordtype">int</span> force);
<a name="l01405"></a>01405 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga1403410a2012b2c625b74126ffcb2089" title="Register ns in the list of namespaces.">ldlm_namespace_register</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client);
<a name="l01406"></a>01406 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaf842bf901a93420ecbc2365d778b3a4b" title="Unregister ns from the list of namespaces.">ldlm_namespace_unregister</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01407"></a>01407                                <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client);
<a name="l01408"></a>01408 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga1399afd082a31b5066cefa9093eec736">ldlm_namespace_get</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns);
<a name="l01409"></a>01409 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga2418ea6dcbcd76ad54666a106b23b891">ldlm_namespace_put</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns);
<a name="l01410"></a>01410 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga8047d7cda49f6bf14c41a5105c55a378">ldlm_proc_setup</a>(<span class="keywordtype">void</span>);
<a name="l01411"></a>01411 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l01412"></a>01412 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga03d9eac35193176ee999b155838ccfe8">ldlm_proc_cleanup</a>(<span class="keywordtype">void</span>);
<a name="l01413"></a>01413 <span class="preprocessor">#else</span>
<a name="l01414"></a><a class="code" href="group__LDLM.html#ga03d9eac35193176ee999b155838ccfe8">01414</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga03d9eac35193176ee999b155838ccfe8">ldlm_proc_cleanup</a>(<span class="keywordtype">void</span>) {}
<a name="l01415"></a>01415 <span class="preprocessor">#endif</span>
<a name="l01416"></a>01416 <span class="preprocessor"></span>
<a name="l01417"></a>01417 <span class="comment">/* resource.c - internal */</span>
<a name="l01418"></a>01418 <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *<a class="code" href="group__LDLM.html#ga083fb1ea92619c4b2e526633c3a486fb" title="Return a reference to resource with given name, creating it if necessary.">ldlm_resource_get</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01419"></a>01419                                         <span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *parent,
<a name="l01420"></a>01420                                         <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *,
<a name="l01421"></a>01421                                         <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type, <span class="keywordtype">int</span> create);
<a name="l01422"></a>01422 <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *<a class="code" href="group__LDLM.html#ga41b0bd74d466ccd76abb0adfcc3fbe8a">ldlm_resource_getref</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l01423"></a>01423 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga9ba8220d356d680f204b8882db1c50c9">ldlm_resource_putref</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res);
<a name="l01424"></a>01424 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaee0426408b282c2c2606c218f79dcd9a" title="Add a lock into a given resource into specified lock list.">ldlm_resource_add_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l01425"></a>01425                             <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *<a class="code" href="writemany_8c.html#af39400667a953a7c5c34e3964aa1ce9f">head</a>,
<a name="l01426"></a>01426                             <span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01427"></a>01427 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga12496ecd5cca95892b66801ab8428b97">ldlm_resource_unlink_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01428"></a>01428 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gadb1efc6cf4a9e128dd2a25c78685f2de">ldlm_res2desc</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res, <span class="keyword">struct</span> <a class="code" href="structldlm__resource__desc.html">ldlm_resource_desc</a> *desc);
<a name="l01429"></a>01429 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga70a63f0359188ff0526655c7c664ef1d" title="Print information about all locks in all namespaces on this node to debug log.">ldlm_dump_all_namespaces</a>(<span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client, <span class="keywordtype">int</span> level);
<a name="l01430"></a>01430 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga72eedaa0c612fbc5daad8d622e0502f1" title="Print information about all locks in this namespace on this node to debug log.">ldlm_namespace_dump</a>(<span class="keywordtype">int</span> level, <span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *);
<a name="l01431"></a>01431 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga6abb0daf1a4f9af18526f4a14c5fbf0c" title="Print information about all locks in this resource to debug log.">ldlm_resource_dump</a>(<span class="keywordtype">int</span> level, <span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *);
<a name="l01432"></a>01432 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gafd6a07a826f7d2789696e472dd81adc2" title="Moves LDLM lock lock to another resource.">ldlm_lock_change_resource</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *, <span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *,
<a name="l01433"></a>01433                               <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *);
<a name="l01434"></a>01434 
<a name="l01435"></a><a class="code" href="group__LDLM.html#ga605a491c960028a1b607ba7d2477eca1">01435</a> <span class="preprocessor">#define LDLM_RESOURCE_ADDREF(res) do {                                  \</span>
<a name="l01436"></a>01436 <span class="preprocessor">        lu_ref_add_atomic(&amp;(res)-&gt;lr_reference, __FUNCTION__, current);  \</span>
<a name="l01437"></a>01437 <span class="preprocessor">} while (0)</span>
<a name="l01438"></a>01438 <span class="preprocessor"></span>
<a name="l01439"></a><a class="code" href="group__LDLM.html#gabcad3c4dc7bec07ec9942a817293935a">01439</a> <span class="preprocessor">#define LDLM_RESOURCE_DELREF(res) do {                                  \</span>
<a name="l01440"></a>01440 <span class="preprocessor">        lu_ref_del(&amp;(res)-&gt;lr_reference, __FUNCTION__, current);  \</span>
<a name="l01441"></a>01441 <span class="preprocessor">} while (0)</span>
<a name="l01442"></a>01442 <span class="preprocessor"></span>
<a name="l01443"></a>01443 <span class="comment">/* ldlm_request.c */</span>
<a name="l01444"></a>01444 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#gadc8dcde45df7d4bea889736aca442600">ldlm_expired_completion_wait</a>(<span class="keywordtype">void</span> *data);
<a name="l01450"></a>01450 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__local__ast.html#ga9962ac0cc2bd7e279cf0b977d822feb3" title="A helper to build a blocking AST function.">ldlm_blocking_ast_nocheck</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01451"></a>01451 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__local__ast.html#gacc93548bb07532aa1d816dee71bd2ecb" title="Server blocking AST.">ldlm_blocking_ast</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keyword">struct</span> <a class="code" href="structldlm__lock__desc.html">ldlm_lock_desc</a> *desc,
<a name="l01452"></a>01452                       <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flag);
<a name="l01453"></a>01453 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__local__ast.html#ga158dc17797fe9252638377c70f5f9558" title="Implements ldlm_lock::l_glimpse_ast for extent locks acquired on the server.">ldlm_glimpse_ast</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <span class="keywordtype">void</span> *reqp);
<a name="l01454"></a>01454 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__local__ast.html#ga44a28deab27f79e7a1ab7e77c7a59208" title="Implementation of -&amp;gt;l_completion_ast() for a client, that doesn&amp;#39;t wait until...">ldlm_completion_ast_async</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, <span class="keywordtype">void</span> *data);
<a name="l01455"></a>01455 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__local__ast.html#gaae5738d417a8624f65b5418d57fef359" title="Generic LDLM &amp;quot;completion&amp;quot; AST.">ldlm_completion_ast</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> flags, <span class="keywordtype">void</span> *data);
<a name="l01462"></a>01462 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gac3edcad1b11e283d6ef8455a2b598b07" title="Client-side lock enqueue.">ldlm_cli_enqueue</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> **reqp,
<a name="l01463"></a>01463                      <span class="keyword">struct</span> <a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *einfo,
<a name="l01464"></a>01464                      <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *res_id,
<a name="l01465"></a>01465                      <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> <span class="keyword">const</span> *policy, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags,
<a name="l01466"></a>01466                      <span class="keywordtype">void</span> *lvb, __u32 lvb_len, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>,
<a name="l01467"></a>01467                      <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keywordtype">int</span> async);
<a name="l01468"></a>01468 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga9fe4c63a5cd0fe654e29fd11aea415cc">ldlm_prep_enqueue_req</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp,
<a name="l01469"></a>01469                           <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01470"></a>01470                           <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *cancels,
<a name="l01471"></a>01471                           <span class="keywordtype">int</span> count);
<a name="l01472"></a>01472 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gabae59a7ebeed8c6fd60b22f03cf88e1f" title="Cancel LRU locks and pack them into the enqueue request.">ldlm_prep_elc_req</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01473"></a>01473                       <span class="keywordtype">int</span> <a class="code" href="packet-lnet_8c.html#a0a5c5891c90b30e72f5cfca80915338e">version</a>, <span class="keywordtype">int</span> opc, <span class="keywordtype">int</span> canceloff,
<a name="l01474"></a>01474                       <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *cancels, <span class="keywordtype">int</span> count);
<a name="l01475"></a>01475 
<a name="l01476"></a>01476 <span class="keyword">struct </span><a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *<a class="code" href="group__ldlm__cli__api.html#ga4bde4e4e32bab2c971297a5f065dec66">ldlm_enqueue_pack</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keywordtype">int</span> lvb_len);
<a name="l01477"></a>01477 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gab2f8268913fc19a29b9d39248d3cbf0d">ldlm_handle_enqueue0</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01478"></a>01478                          <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__request.html">ldlm_request</a> *dlm_req,
<a name="l01479"></a>01479                          <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__callback__suite.html">ldlm_callback_suite</a> *cbs);
<a name="l01480"></a>01480 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gac421005283912bb5186b035013aa58c0" title="Finishing portion of client lock enqueue code.">ldlm_cli_enqueue_fini</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01481"></a>01481                           <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type, __u8 with_policy,
<a name="l01482"></a>01482                           <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags, <span class="keywordtype">void</span> *lvb,
<a name="l01483"></a>01483                           __u32 lvb_len,
<a name="l01484"></a>01484                           <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keywordtype">int</span> rc);
<a name="l01485"></a>01485 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga1fc673f7fb2c06baaa796f09afc33487" title="Enqueue a local lock (typically on a server).">ldlm_cli_enqueue_local</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01486"></a>01486                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *res_id,
<a name="l01487"></a>01487                            <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga5ced9a6707006817f5e2409b368f36b5">ldlm_type</a> type, <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy,
<a name="l01488"></a>01488                            <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *flags,
<a name="l01489"></a>01489                            <a class="code" href="group__LDLM.html#gac111233b56bdf7a4767dcd7a2f15b378" title="Type for blocking callback function of a lock.">ldlm_blocking_callback</a> blocking,
<a name="l01490"></a>01490                            <a class="code" href="group__LDLM.html#gac03b996dc38f767ddd9b2f5ae779b257" title="Type for completion callback function of a lock.">ldlm_completion_callback</a> completion,
<a name="l01491"></a>01491                            <a class="code" href="group__LDLM.html#ga6e5c291246d5e6fb302d99a6111cb03d" title="Type for glimpse callback function of a lock.">ldlm_glimpse_callback</a> glimpse,
<a name="l01492"></a>01492                            <span class="keywordtype">void</span> *data, __u32 lvb_len, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a> <a class="code" href="group__LDLM.html#ga2e4dbf6d38ddcec566ec40c96391622b">lvb_type</a>,
<a name="l01493"></a>01493                            <span class="keyword">const</span> <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *client_cookie,
<a name="l01494"></a>01494                            <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh);
<a name="l01495"></a>01495 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga2a5622167fd1e1543cef0addb8634f09">ldlm_cli_convert</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh, <span class="keywordtype">int</span> new_mode,
<a name="l01496"></a>01496                      __u32 *flags);
<a name="l01497"></a>01497 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga83cbdc7f471f1c21e1200fb94d5be170" title="Update client&amp;#39;s OBD pool related fields with new SLV and Limit from req.">ldlm_cli_update_pool</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req);
<a name="l01498"></a>01498 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga0237477d402999ab81f2b2447fceebc9" title="Client side lock cancel.">ldlm_cli_cancel</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lockh,
<a name="l01499"></a>01499                     <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> cancel_flags);
<a name="l01500"></a>01500 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga8067f82d5a14a84d1c103d2de469501a" title="Cancel all locks on a namespace (or a specific resource, if given) that have 0 readers/writers...">ldlm_cli_cancel_unused</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *,
<a name="l01501"></a>01501                            <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags, <span class="keywordtype">void</span> *opaque);
<a name="l01502"></a>01502 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga56914f0205e9d377eeceb78f8db71f66" title="Cancel all locks on a resource that have 0 readers/writers.">ldlm_cli_cancel_unused_resource</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01503"></a>01503                                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structldlm__res__id.html">ldlm_res_id</a> *res_id,
<a name="l01504"></a>01504                                     <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy,
<a name="l01505"></a>01505                                     <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>,
<a name="l01506"></a>01506                                     <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags, <span class="keywordtype">void</span> *opaque);
<a name="l01507"></a>01507 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga677e9f9ff5fbe2174b139fe8c2b77b70" title="Prepare and send a batched cancel RPC.">ldlm_cli_cancel_req</a>(<span class="keyword">struct</span> <a class="code" href="structobd__export.html" title="Export structure.">obd_export</a> *exp, <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *<a class="code" href="writemany_8c.html#af39400667a953a7c5c34e3964aa1ce9f">head</a>,
<a name="l01508"></a>01508                         <span class="keywordtype">int</span> count, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags);
<a name="l01509"></a>01509 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga2fab73fddf169b2202e11527226f7253" title="Find and cancel locally unused locks found on resource, matched to the given policy...">ldlm_cancel_resource_local</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l01510"></a>01510                                <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *cancels,
<a name="l01511"></a>01511                                <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy,
<a name="l01512"></a>01512                                <span class="keyword">enum</span> <a class="code" href="group__lustreidl.html#ga78e7c1d7ad283002413a597e75aa7441">ldlm_mode</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> lock_flags,
<a name="l01513"></a>01513                                <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> cancel_flags,
<a name="l01514"></a>01514                                <span class="keywordtype">void</span> *opaque);
<a name="l01515"></a>01515 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#gac7dcd18ff549bf7b777a067e1c374149" title="Locally cancel up to count locks in list cancels.">ldlm_cli_cancel_list_local</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *cancels, <span class="keywordtype">int</span> count,
<a name="l01516"></a>01516                                <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags);
<a name="l01517"></a>01517 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__cli__api.html#ga96adcececc3c547888075de942fa1872" title="Cancel client-side locks from a list and send/prepare cancel RPCs to the server.">ldlm_cli_cancel_list</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *<a class="code" href="writemany_8c.html#af39400667a953a7c5c34e3964aa1ce9f">head</a>, <span class="keywordtype">int</span> count,
<a name="l01518"></a>01518                          <span class="keyword">struct</span> <a class="code" href="structptlrpc__request.html" title="Represents remote procedure call.">ptlrpc_request</a> *req,
<a name="l01519"></a>01519                          <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#ga0b718c2d27bc15f43205e50e4da16ec9" title="Cancel flags.">ldlm_cancel_flags</a> flags);
<a name="l01522"></a>01522 <span class="comment">/* mds/handler.c */</span>
<a name="l01523"></a>01523 <span class="comment">/* This has to be here because recursive inclusion sucks. */</span>
<a name="l01524"></a>01524 <span class="keywordtype">int</span> <a class="code" href="group__LDLM.html#ga372b1e5c9e8be8bd6bbd2c3e279ec146">intent_disposition</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__reply.html">ldlm_reply</a> *rep, <span class="keywordtype">int</span> flag);
<a name="l01525"></a>01525 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga3b01cf0ee883cc9a25d74ca83032a529">intent_set_disposition</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__reply.html">ldlm_reply</a> *rep, <span class="keywordtype">int</span> flag);
<a name="l01526"></a>01526 
<a name="l01531"></a><a class="code" href="group__LDLM.html#gade643efde1936c79a28d8a944592c5c0">01531</a> <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gade643efde1936c79a28d8a944592c5c0" title="&amp;quot;Modes&amp;quot; of acquiring lock_res, necessary to tell lockdep that taking more...">lock_res_type</a> {
<a name="l01532"></a><a class="code" href="group__LDLM.html#ggade643efde1936c79a28d8a944592c5c0ad775dfdebf93887431d72e62cbe354d5">01532</a>         <a class="code" href="group__LDLM.html#ggade643efde1936c79a28d8a944592c5c0ad775dfdebf93887431d72e62cbe354d5">LRT_NORMAL</a>,
<a name="l01533"></a><a class="code" href="group__LDLM.html#ggade643efde1936c79a28d8a944592c5c0a4a0f0c6e05a64fe747ae65a84f5485f6">01533</a>         <a class="code" href="group__LDLM.html#ggade643efde1936c79a28d8a944592c5c0a4a0f0c6e05a64fe747ae65a84f5485f6">LRT_NEW</a>
<a name="l01534"></a>01534 };
<a name="l01535"></a>01535 
<a name="l01537"></a><a class="code" href="group__LDLM.html#ga83aa57fc458f3a4c11022b4dad580a21">01537</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga83aa57fc458f3a4c11022b4dad580a21" title="Lock resource.">lock_res</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res)
<a name="l01538"></a>01538 {
<a name="l01539"></a>01539         spin_lock(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2" title="Spinlock to protect locks under this resource.">lr_lock</a>);
<a name="l01540"></a>01540 }
<a name="l01541"></a>01541 
<a name="l01543"></a><a class="code" href="group__LDLM.html#gaf8e33b62440b4b67aaf93c301ce81fb8">01543</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaf8e33b62440b4b67aaf93c301ce81fb8" title="Lock resource with a way to instruct lockdep code about nestedness-safe.">lock_res_nested</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res,
<a name="l01544"></a>01544                                    <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gade643efde1936c79a28d8a944592c5c0" title="&amp;quot;Modes&amp;quot; of acquiring lock_res, necessary to tell lockdep that taking more...">lock_res_type</a> <a class="code" href="mdsrate_8c.html#a000e34997df38c2005a83d63e67d9282">mode</a>)
<a name="l01545"></a>01545 {
<a name="l01546"></a>01546         spin_lock_nested(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2" title="Spinlock to protect locks under this resource.">lr_lock</a>, mode);
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01550"></a><a class="code" href="group__LDLM.html#ga3f0f8c873e05a9986550f5a8c245e6d5">01550</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#ga3f0f8c873e05a9986550f5a8c245e6d5" title="Unlock resource.">unlock_res</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res)
<a name="l01551"></a>01551 {
<a name="l01552"></a>01552         spin_unlock(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2" title="Spinlock to protect locks under this resource.">lr_lock</a>);
<a name="l01553"></a>01553 }
<a name="l01554"></a>01554 
<a name="l01556"></a><a class="code" href="group__LDLM.html#gafcd013e3a5397cfa341646d8522d2563">01556</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gafcd013e3a5397cfa341646d8522d2563" title="Check if resource is already locked, assert if not.">check_res_locked</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> *res)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558         assert_spin_locked(&amp;res-&gt;<a class="code" href="structldlm__resource.html#a59919dc6ad73a289dd28c061319f68f2" title="Spinlock to protect locks under this resource.">lr_lock</a>);
<a name="l01559"></a>01559 }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 <span class="keyword">struct </span><a class="code" href="structldlm__resource.html" title="LDLM resource description.">ldlm_resource</a> * <a class="code" href="group__LDLM.html#ga7ea7aa073d254d8500c07d2664cbecf9" title="Lock a lock and its resource.">lock_res_and_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01562"></a>01562 <span class="keywordtype">void</span> <a class="code" href="group__LDLM.html#gaf9b19facd1a8bb3cdfcac5047159f15e" title="Unlock a lock and its resource previously locked with lock_res_and_lock.">unlock_res_and_lock</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01563"></a>01563 
<a name="l01564"></a>01564 <span class="comment">/* ldlm_pool.c */</span>
<a name="l01569"></a>01569 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga62c0bae20b27c228a6a95b1f5f709def">ldlm_pools_recalc</a>(<span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client);
<a name="l01570"></a>01570 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga44ebef9472dfd93565f00c732ce8f48c">ldlm_pools_init</a>(<span class="keywordtype">void</span>);
<a name="l01571"></a>01571 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#ga552d83683bf6c964495814d4a7d84ed3">ldlm_pools_fini</a>(<span class="keywordtype">void</span>);
<a name="l01572"></a>01572 
<a name="l01573"></a>01573 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga8cf541fbfeea526220613be372ce3f3d">ldlm_pool_init</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keyword">struct</span> <a class="code" href="structldlm__namespace.html" title="LDLM Namespace.">ldlm_namespace</a> *ns,
<a name="l01574"></a>01574                    <span class="keywordtype">int</span> idx, <span class="keyword">enum</span> <a class="code" href="group__LDLM.html#gac4b4584603b76e6cc86c82a64f59defd" title="LDLM namespace type.">ldlm_side</a> client);
<a name="l01575"></a>01575 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga61e03406b0b195b65919453eec83dfe1">ldlm_pool_shrink</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keywordtype">int</span> nr, gfp_t gfp_mask);
<a name="l01576"></a>01576 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#gaf1c062ef2187faf09e583eb98e8e8f49">ldlm_pool_fini</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01577"></a>01577 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga041ed4c0aefbb7ec8ff9b77611d38171">ldlm_pool_setup</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keywordtype">int</span> limit);
<a name="l01578"></a>01578 <span class="keywordtype">int</span> <a class="code" href="group__ldlm__pools.html#ga3f06734aa7a7cc1f3d45bca82fe4187a">ldlm_pool_recalc</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01579"></a>01579 __u32 <a class="code" href="group__ldlm__pools.html#gad8ff1738580bce67d3cec5e5cb0feb62">ldlm_pool_get_lvf</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01580"></a>01580 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="group__ldlm__pools.html#gaac53b32f5d6284e23d8f651a64be8329">ldlm_pool_get_slv</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01581"></a>01581 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> <a class="code" href="group__ldlm__pools.html#gaf2dd194eb55c33690dfd1c5b4e5790a8">ldlm_pool_get_clv</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01582"></a>01582 __u32 <a class="code" href="group__ldlm__pools.html#gac69aa09cf742784c7ed1ccda3e0a58bd">ldlm_pool_get_limit</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl);
<a name="l01583"></a>01583 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#ga58fbe50f8d22eb4ca1c2f7154a170f57">ldlm_pool_set_slv</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> slv);
<a name="l01584"></a>01584 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#gae672143c81f2f116807d9b7d5e802b4a">ldlm_pool_set_clv</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> clv);
<a name="l01585"></a>01585 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#gad47116d5db4f08a56753558701eb9dde">ldlm_pool_set_limit</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, __u32 limit);
<a name="l01586"></a>01586 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#ga21e6217aed8780dd95a988ce8db5c97e">ldlm_pool_add</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01587"></a>01587 <span class="keywordtype">void</span> <a class="code" href="group__ldlm__pools.html#ga330ae96aa430791191fec656505cc4d5">ldlm_pool_del</a>(<span class="keyword">struct</span> <a class="code" href="structldlm__pool.html" title="LDLM pool structure to track granted locks.">ldlm_pool</a> *pl, <span class="keyword">struct</span> <a class="code" href="structldlm__lock.html" title="LDLM lock structure.">ldlm_lock</a> *lock);
<a name="l01590"></a>01590 <span class="preprocessor">#endif</span>
<a name="l01591"></a>01591 <span class="preprocessor"></span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:35 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
