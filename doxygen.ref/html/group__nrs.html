<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: Network Request Scheduler</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Network Request Scheduler<br/>
<small>
[<a class="el" href="group__net.html">net</a>]</small>
</h1>
<p>Service compatibility function; the policy is compatible with all services.  
<a href="#_details">More...</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__pol__ops.html">ptlrpc_nrs_pol_ops</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS policy operations.  <a href="structptlrpc__nrs__pol__ops.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html">ptlrpc_nrs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS head.  <a href="structptlrpc__nrs.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__pol__conf.html">ptlrpc_nrs_pol_conf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS policy registering descriptor.  <a href="structptlrpc__nrs__pol__desc.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__pol__info.html">ptlrpc_nrs_pol_info</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS policy information.  <a href="structptlrpc__nrs__pol__info.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__policy.html">ptlrpc_nrs_policy</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS policy.  <a href="structptlrpc__nrs__policy.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__resource.html">ptlrpc_nrs_resource</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS resource.  <a href="structptlrpc__nrs__resource.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs__request.html">ptlrpc_nrs_request</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS request.  <a href="structptlrpc__nrs__request.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga6b62bacadc4bb1dd50a3ec89faf25e48">NRS_POL_NAME_MAX</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga352850be609f28c94c8969d5ff9f1fe8">NRS_POL_ARG_MAX</a>&nbsp;&nbsp;&nbsp;16</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef bool(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga105d7800dea02f8936595c3bb231d065">nrs_pol_desc_compat_t</a> )(const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *desc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service compatibility predicate; this determines whether a policy is adequate for handling RPCs of a particular PTLRPC service.  <a href="#ga105d7800dea02f8936595c3bb231d065"></a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#gaa3db631148675f8074864fa452691540">ptlrpc_nrs_ctl</a> { <a class="el" href="group__nrs.html#ggaa3db631148675f8074864fa452691540a321baf9361db3da24cdfa83280bad032">PTLRPC_NRS_CTL_INVALID</a>, 
<a class="el" href="group__nrs.html#ggaa3db631148675f8074864fa452691540acd5d2cd7790ab425869163314eae0e70">PTLRPC_NRS_CTL_START</a>, 
<a class="el" href="group__nrs.html#ggaa3db631148675f8074864fa452691540a23993a7a787dd0c72c216e7a4b7531e5">PTLRPC_NRS_CTL_STOP</a>, 
<a class="el" href="group__nrs.html#ggaa3db631148675f8074864fa452691540a543ec0e517ec44e1af95c5137d28f80b">PTLRPC_NRS_CTL_1ST_POL_SPEC</a> =  0x20
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>NRS control operations. </p>
 <a href="group__nrs.html#gaa3db631148675f8074864fa452691540">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga6ea16220314a76d72e40776a753ad5e8">nrs_policy_flags</a> { <a class="el" href="group__nrs.html#gga6ea16220314a76d72e40776a753ad5e8ad327b4b9e26d26b5620cfdb682ca0b4c">PTLRPC_NRS_FL_FALLBACK</a> =  (1 &lt;&lt; 0), 
<a class="el" href="group__nrs.html#gga6ea16220314a76d72e40776a753ad5e8a274b96449b8debe8a3aadf811d78b8aa">PTLRPC_NRS_FL_REG_START</a> =  (1 &lt;&lt; 1), 
<a class="el" href="group__nrs.html#gga6ea16220314a76d72e40776a753ad5e8a35947833fd282bc0e5a01eb24fc3791a">PTLRPC_NRS_FL_REG_EXTERN</a> =  (1 &lt;&lt; 2)
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Policy flags. </p>
 <a href="group__nrs.html#ga6ea16220314a76d72e40776a753ad5e8">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga79e63c48a144326744316f397c52a883">ptlrpc_nrs_queue_type</a> { <a class="el" href="group__nrs.html#gga79e63c48a144326744316f397c52a883a2c17707997f37ba22024fb895b796fab">PTLRPC_NRS_QUEUE_REG</a> =  (1 &lt;&lt; 0), 
<a class="el" href="group__nrs.html#gga79e63c48a144326744316f397c52a883a66f9b7007f946555d79ff8d7bf4cf67a">PTLRPC_NRS_QUEUE_HP</a> =  (1 &lt;&lt; 1), 
<a class="el" href="group__nrs.html#gga79e63c48a144326744316f397c52a883a96a357e154fce62299ed458d57fac394">PTLRPC_NRS_QUEUE_BOTH</a> =  (PTLRPC_NRS_QUEUE_REG | PTLRPC_NRS_QUEUE_HP)
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>NRS queue type. </p>
 <a href="group__nrs.html#ga79e63c48a144326744316f397c52a883">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga843285b91fa9672fdf0fcc93b4387971">ptlrpc_nrs_pol_state</a> { <br/>
&nbsp;&nbsp;<a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a2ef3aa72b5e4987d1c4e789c31dffdba">NRS_POL_STATE_INVALID</a>, 
<a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a60ca6b44260cb20198b1d5d4747a6257">NRS_POL_STATE_STOPPED</a>, 
<a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a3e737ea7aa14781899e40eb0343c9a39">NRS_POL_STATE_STOPPING</a>, 
<a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a6198482c4c72e590f9009efb54f424ec">NRS_POL_STATE_STARTING</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a8da4904dfb7ba56810332673912a76cb">NRS_POL_STATE_STARTED</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>NRS policy state. </p>
 <a href="group__nrs.html#ga843285b91fa9672fdf0fcc93b4387971">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="group__nrs.html#gga550cb4231d535863c55643bbd2d3c6baa9be98a40eaa84f611091b058ce3a4f38">NRS_RES_FALLBACK</a>, 
<a class="el" href="group__nrs.html#gga550cb4231d535863c55643bbd2d3c6baa7785a43e8697c1ef492db488044151c5">NRS_RES_PRIMARY</a>, 
<a class="el" href="group__nrs.html#gga550cb4231d535863c55643bbd2d3c6baa376edf48428fd666fdc66928adade336">NRS_RES_MAX</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga5de7e78460dcd401c48a46cf67ac9851">ptlrpc_nrs_policy_register</a> (struct <a class="el" href="structptlrpc__nrs__pol__conf.html">ptlrpc_nrs_pol_conf</a> *conf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Registers a new policy with NRS core.  <a href="#ga5de7e78460dcd401c48a46cf67ac9851"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#gafa9c71a2f34f3e56750abaeba0d358f8">ptlrpc_nrs_policy_unregister</a> (struct <a class="el" href="structptlrpc__nrs__pol__conf.html">ptlrpc_nrs_pol_conf</a> *conf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregisters a previously registered policy with NRS core.  <a href="#gafa9c71a2f34f3e56750abaeba0d358f8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#gae517dc74ee0bcadf3b53f6ed4c57e6de">ptlrpc_nrs_req_hp_move</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Moves request <em>req</em> from the regular to the high-priority NRS head.  <a href="#gae517dc74ee0bcadf3b53f6ed4c57e6de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#gaa2834dc010aa5a515daaa07672450184">nrs_policy_get_info_locked</a> (struct <a class="el" href="structptlrpc__nrs__policy.html">ptlrpc_nrs_policy</a> *policy, struct <a class="el" href="structptlrpc__nrs__pol__info.html">ptlrpc_nrs_pol_info</a> *info)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga385a793cd8516bc3fca7519e54ebd7b6">ptlrpc_nrs_req_can_move</a> (struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *req)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga1c34898d90054376939d759b6e693def">nrs_policy_compat_all</a> (const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *desc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga1a5cd89d185d2a3b73b4f115badc98e8">nrs_policy_compat_one</a> (const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *desc)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service compatibility function; the policy is compatible with only a specific service which is identified by its human-readable name at <a class="el" href="structptlrpc__service.html#aae4c3cd5c6362b9586c16f671076bb55" title="only statically allocated strings here; we don&#39;t clean them">ptlrpc_service::srv_name</a>.  <a href="#ga1a5cd89d185d2a3b73b4f115badc98e8"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structptlrpc__nrs__request.html">ptlrpc_nrs_request</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nrs.html#ga87c0b624fd16e1aaaac107f6d71e0fd1">ptlrpc_srv_req::sr_nrq</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">stub for NRS request  <a href="#ga87c0b624fd16e1aaaac107f6d71e0fd1"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Service compatibility function; the policy is compatible with all services. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>svc</em>&nbsp;</td><td>The service the policy is attempting to register with. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>desc</em>&nbsp;</td><td>The policy descriptor</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>The policy is compatible with the service</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structptlrpc__nrs__pol__desc.html#a7c57c75713e6367abb8433ab580d1db4" title="Service compatibility predicate.">ptlrpc_nrs_pol_desc::pd_compat()</a> </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga352850be609f28c94c8969d5ff9f1fe8"></a><!-- doxytag: member="lustre_nrs.h::NRS_POL_ARG_MAX" ref="ga352850be609f28c94c8969d5ff9f1fe8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NRS_POL_ARG_MAX&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00383">383</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l00192">nrs_policy_start_locked()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6b62bacadc4bb1dd50a3ec89faf25e48"></a><!-- doxytag: member="lustre_nrs.h::NRS_POL_NAME_MAX" ref="ga6b62bacadc4bb1dd50a3ec89faf25e48" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NRS_POL_NAME_MAX&nbsp;&nbsp;&nbsp;16</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00382">382</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01075">nrs_policy_find_desc_locked()</a>, <a class="el" href="nrs_8c_source.html#l00356">nrs_policy_find_locked()</a>, <a class="el" href="nrs_8c_source.html#l01165">ptlrpc_nrs_policy_register()</a>, and <a class="el" href="nrs_8c_source.html#l01323">ptlrpc_nrs_policy_unregister()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ga105d7800dea02f8936595c3bb231d065"></a><!-- doxytag: member="lustre_nrs.h::nrs_pol_desc_compat_t" ref="ga105d7800dea02f8936595c3bb231d065" args=")(const struct ptlrpc_service *svc, const struct ptlrpc_nrs_pol_desc *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef bool(* <a class="el" href="group__nrs.html#ga105d7800dea02f8936595c3bb231d065">nrs_pol_desc_compat_t</a>)(const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *svc, const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *desc)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Service compatibility predicate; this determines whether a policy is adequate for handling RPCs of a particular PTLRPC service. </p>
<p>XXX:This should give the same result during policy registration and unregistration, and for all partitions of a service; so the result should not depend on temporal service or other properties, that may influence the result. </p>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00396">396</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ga550cb4231d535863c55643bbd2d3c6ba"></a><!-- doxytag: member="lustre_nrs.h::@70" ref="ga550cb4231d535863c55643bbd2d3c6ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga550cb4231d535863c55643bbd2d3c6baa9be98a40eaa84f611091b058ce3a4f38"></a><!-- doxytag: member="NRS_RES_FALLBACK" ref="gga550cb4231d535863c55643bbd2d3c6baa9be98a40eaa84f611091b058ce3a4f38" args="" -->NRS_RES_FALLBACK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga550cb4231d535863c55643bbd2d3c6baa7785a43e8697c1ef492db488044151c5"></a><!-- doxytag: member="NRS_RES_PRIMARY" ref="gga550cb4231d535863c55643bbd2d3c6baa7785a43e8697c1ef492db488044151c5" args="" -->NRS_RES_PRIMARY</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga550cb4231d535863c55643bbd2d3c6baa376edf48428fd666fdc66928adade336"></a><!-- doxytag: member="NRS_RES_MAX" ref="gga550cb4231d535863c55643bbd2d3c6baa376edf48428fd666fdc66928adade336" args="" -->NRS_RES_MAX</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00668">668</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga6ea16220314a76d72e40776a753ad5e8"></a><!-- doxytag: member="lustre_nrs.h::nrs_policy_flags" ref="ga6ea16220314a76d72e40776a753ad5e8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__nrs.html#ga6ea16220314a76d72e40776a753ad5e8">nrs_policy_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Policy flags. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga6ea16220314a76d72e40776a753ad5e8ad327b4b9e26d26b5620cfdb682ca0b4c"></a><!-- doxytag: member="PTLRPC_NRS_FL_FALLBACK" ref="gga6ea16220314a76d72e40776a753ad5e8ad327b4b9e26d26b5620cfdb682ca0b4c" args="" -->PTLRPC_NRS_FL_FALLBACK</em>&nbsp;</td><td>
<p>Fallback policy, use this flag only on a single supported policy per service. </p>
<p>The flag cannot be used on policies that use <em>PTLRPC_NRS_FL_REG_EXTERN</em> </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga6ea16220314a76d72e40776a753ad5e8a274b96449b8debe8a3aadf811d78b8aa"></a><!-- doxytag: member="PTLRPC_NRS_FL_REG_START" ref="gga6ea16220314a76d72e40776a753ad5e8a274b96449b8debe8a3aadf811d78b8aa" args="" -->PTLRPC_NRS_FL_REG_START</em>&nbsp;</td><td>
<p>Start policy immediately after registering. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga6ea16220314a76d72e40776a753ad5e8a35947833fd282bc0e5a01eb24fc3791a"></a><!-- doxytag: member="PTLRPC_NRS_FL_REG_EXTERN" ref="gga6ea16220314a76d72e40776a753ad5e8a35947833fd282bc0e5a01eb24fc3791a" args="" -->PTLRPC_NRS_FL_REG_EXTERN</em>&nbsp;</td><td>
<p>This is a policy registering from a module different to the one NRS core ships in (currently ptlrpc). </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00266">266</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaa3db631148675f8074864fa452691540"></a><!-- doxytag: member="lustre_nrs.h::ptlrpc_nrs_ctl" ref="gaa3db631148675f8074864fa452691540" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__nrs.html#gaa3db631148675f8074864fa452691540">ptlrpc_nrs_ctl</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>NRS control operations. </p>
<p>These are common for all policies. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ggaa3db631148675f8074864fa452691540a321baf9361db3da24cdfa83280bad032"></a><!-- doxytag: member="PTLRPC_NRS_CTL_INVALID" ref="ggaa3db631148675f8074864fa452691540a321baf9361db3da24cdfa83280bad032" args="" -->PTLRPC_NRS_CTL_INVALID</em>&nbsp;</td><td>
<p>Not a valid opcode. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggaa3db631148675f8074864fa452691540acd5d2cd7790ab425869163314eae0e70"></a><!-- doxytag: member="PTLRPC_NRS_CTL_START" ref="ggaa3db631148675f8074864fa452691540acd5d2cd7790ab425869163314eae0e70" args="" -->PTLRPC_NRS_CTL_START</em>&nbsp;</td><td>
<p>Activate the policy. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggaa3db631148675f8074864fa452691540a23993a7a787dd0c72c216e7a4b7531e5"></a><!-- doxytag: member="PTLRPC_NRS_CTL_STOP" ref="ggaa3db631148675f8074864fa452691540a23993a7a787dd0c72c216e7a4b7531e5" args="" -->PTLRPC_NRS_CTL_STOP</em>&nbsp;</td><td>
<p>Reserved for multiple primary policies, which may be a possibility in the future. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggaa3db631148675f8074864fa452691540a543ec0e517ec44e1af95c5137d28f80b"></a><!-- doxytag: member="PTLRPC_NRS_CTL_1ST_POL_SPEC" ref="ggaa3db631148675f8074864fa452691540a543ec0e517ec44e1af95c5137d28f80b" args="" -->PTLRPC_NRS_CTL_1ST_POL_SPEC</em>&nbsp;</td><td>
<p>Policies can start using opcodes from this value and onwards for their own purposes; the assigned value itself is arbitrary. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00048">48</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga843285b91fa9672fdf0fcc93b4387971"></a><!-- doxytag: member="lustre_nrs.h::ptlrpc_nrs_pol_state" ref="ga843285b91fa9672fdf0fcc93b4387971" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__nrs.html#ga843285b91fa9672fdf0fcc93b4387971">ptlrpc_nrs_pol_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>NRS policy state. </p>
<p>Policies transition from one state to the other during their lifetime </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga843285b91fa9672fdf0fcc93b4387971a2ef3aa72b5e4987d1c4e789c31dffdba"></a><!-- doxytag: member="NRS_POL_STATE_INVALID" ref="gga843285b91fa9672fdf0fcc93b4387971a2ef3aa72b5e4987d1c4e789c31dffdba" args="" -->NRS_POL_STATE_INVALID</em>&nbsp;</td><td>
<p>Not a valid policy state. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga843285b91fa9672fdf0fcc93b4387971a60ca6b44260cb20198b1d5d4747a6257"></a><!-- doxytag: member="NRS_POL_STATE_STOPPED" ref="gga843285b91fa9672fdf0fcc93b4387971a60ca6b44260cb20198b1d5d4747a6257" args="" -->NRS_POL_STATE_STOPPED</em>&nbsp;</td><td>
<p>Policies are at this state either at the start of their life, or transition here when the user selects a different policy to act as the primary one. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga843285b91fa9672fdf0fcc93b4387971a3e737ea7aa14781899e40eb0343c9a39"></a><!-- doxytag: member="NRS_POL_STATE_STOPPING" ref="gga843285b91fa9672fdf0fcc93b4387971a3e737ea7aa14781899e40eb0343c9a39" args="" -->NRS_POL_STATE_STOPPING</em>&nbsp;</td><td>
<p>Policy is progress of stopping. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga843285b91fa9672fdf0fcc93b4387971a6198482c4c72e590f9009efb54f424ec"></a><!-- doxytag: member="NRS_POL_STATE_STARTING" ref="gga843285b91fa9672fdf0fcc93b4387971a6198482c4c72e590f9009efb54f424ec" args="" -->NRS_POL_STATE_STARTING</em>&nbsp;</td><td>
<p>Policy is in progress of starting. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga843285b91fa9672fdf0fcc93b4387971a8da4904dfb7ba56810332673912a76cb"></a><!-- doxytag: member="NRS_POL_STATE_STARTED" ref="gga843285b91fa9672fdf0fcc93b4387971a8da4904dfb7ba56810332673912a76cb" args="" -->NRS_POL_STATE_STARTED</em>&nbsp;</td><td>
<p>A policy is in this state in two cases:</p>
<ul>
<li>it is the fallback policy, which is always in this state. </li>
</ul>
<ul>
<li>it has been activated by the user; i.e. it is the primary policy, </li>
</ul>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00515">515</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga79e63c48a144326744316f397c52a883"></a><!-- doxytag: member="lustre_nrs.h::ptlrpc_nrs_queue_type" ref="ga79e63c48a144326744316f397c52a883" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__nrs.html#ga79e63c48a144326744316f397c52a883">ptlrpc_nrs_queue_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>NRS queue type. </p>
<p>Denotes whether an NRS instance is for handling normal or high-priority RPCs, or whether an operation pertains to one or both of the NRS instances in a service. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga79e63c48a144326744316f397c52a883a2c17707997f37ba22024fb895b796fab"></a><!-- doxytag: member="PTLRPC_NRS_QUEUE_REG" ref="gga79e63c48a144326744316f397c52a883a2c17707997f37ba22024fb895b796fab" args="" -->PTLRPC_NRS_QUEUE_REG</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga79e63c48a144326744316f397c52a883a66f9b7007f946555d79ff8d7bf4cf67a"></a><!-- doxytag: member="PTLRPC_NRS_QUEUE_HP" ref="gga79e63c48a144326744316f397c52a883a66f9b7007f946555d79ff8d7bf4cf67a" args="" -->PTLRPC_NRS_QUEUE_HP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga79e63c48a144326744316f397c52a883a96a357e154fce62299ed458d57fac394"></a><!-- doxytag: member="PTLRPC_NRS_QUEUE_BOTH" ref="gga79e63c48a144326744316f397c52a883a96a357e154fce62299ed458d57fac394" args="" -->PTLRPC_NRS_QUEUE_BOTH</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00291">291</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga1c34898d90054376939d759b6e693def"></a><!-- doxytag: member="lustre_net.h::nrs_policy_compat_all" ref="ga1c34898d90054376939d759b6e693def" args="(const struct ptlrpc_service *svc, const struct ptlrpc_nrs_pol_desc *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool nrs_policy_compat_all </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>desc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lustre__net_8h_source.html#l01956">1956</a> of file <a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga1a5cd89d185d2a3b73b4f115badc98e8"></a><!-- doxytag: member="lustre_net.h::nrs_policy_compat_one" ref="ga1a5cd89d185d2a3b73b4f115badc98e8" args="(const struct ptlrpc_service *svc, const struct ptlrpc_nrs_pol_desc *desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool nrs_policy_compat_one </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structptlrpc__service.html">ptlrpc_service</a> *&nbsp;</td>
          <td class="paramname"> <em>svc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structptlrpc__nrs__pol__desc.html">ptlrpc_nrs_pol_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>desc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Service compatibility function; the policy is compatible with only a specific service which is identified by its human-readable name at <a class="el" href="structptlrpc__service.html#aae4c3cd5c6362b9586c16f671076bb55" title="only statically allocated strings here; we don&#39;t clean them">ptlrpc_service::srv_name</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>svc</em>&nbsp;</td><td>The service the policy is attempting to register with. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>desc</em>&nbsp;</td><td>The policy descriptor</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>false</em>&nbsp;</td><td>The policy is not compatible with the service </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>true</em>&nbsp;</td><td>The policy is compatible with the service</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structptlrpc__nrs__pol__desc.html#a7c57c75713e6367abb8433ab580d1db4" title="Service compatibility predicate.">ptlrpc_nrs_pol_desc::pd_compat()</a> </dd></dl>

<p>Definition at line <a class="el" href="lustre__net_8h_source.html#l01975">1975</a> of file <a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>.</p>

<p>References <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="lustre__nrs_8h_source.html#l00459">ptlrpc_nrs_pol_desc::pd_compat_svc_name</a>, and <a class="el" href="lustre__net_8h_source.html#l01678">ptlrpc_service::srv_name</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01165">ptlrpc_nrs_policy_register()</a>.</p>

</div>
</div>
<a class="anchor" id="gaa2834dc010aa5a515daaa07672450184"></a><!-- doxytag: member="lustre_net.h::nrs_policy_get_info_locked" ref="gaa2834dc010aa5a515daaa07672450184" args="(struct ptlrpc_nrs_policy *policy, struct ptlrpc_nrs_pol_info *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nrs_policy_get_info_locked </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__nrs__policy.html">ptlrpc_nrs_policy</a> *&nbsp;</td>
          <td class="paramname"> <em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__nrs__pol__info.html">ptlrpc_nrs_pol_info</a> *&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ga5de7e78460dcd401c48a46cf67ac9851"></a><!-- doxytag: member="lustre_net.h::ptlrpc_nrs_policy_register" ref="ga5de7e78460dcd401c48a46cf67ac9851" args="(struct ptlrpc_nrs_pol_conf *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ptlrpc_nrs_policy_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__nrs__pol__conf.html">ptlrpc_nrs_pol_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Registers a new policy with NRS core. </p>
<p>The function will only succeed if policy registration with all compatible service partitions (if any) is successful.</p>
<p>N.B. This function should be called either at ptlrpc module initialization time when registering a policy that ships with NRS core, or in a module's init() function for policies registering from other modules.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>conf</em>&nbsp;</td><td>configuration information for the new policy to register</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>error </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
  </table>
  </dd>
</dl>

<p><p>External policies are not allowed to start immediately upon registration, as there is a relatively higher chance that their registration might fail. In such a case, some policy instances may already have requests queued wen unregistration needs to happen as part o cleanup; since there is currently no way to drain requests from a policy unless the service is unregistering, we just disallow this.</p>
<p>For policies that are held in the same module as NRS (currently ptlrpc), do not register the policy with all compatible services, as the services will not have started at this point, since we are calling from ptlrpc module initialization code. In such cases each service will register all compatible policies later, via <a class="el" href="nrs_8c.html#a107d0adae381864f5c53de6cc805a59f" title="Setup NRS heads on all service partitions of service svc, and register all compatible...">ptlrpc_service_nrs_setup()</a>.</p>
<p>Register the new policy on all compatible services</p>
<p>Should not fail at this point</p>
<p>No need to take a reference to other modules here, as we will be calling from the module's init() function.</p>
<p>Should not fail at this point</p>
</p>

<p>Definition at line <a class="el" href="nrs_8c_source.html#l01165">1165</a> of file <a class="el" href="nrs_8c_source.html">nrs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="osd__iam_8h_source.html#l00057">ergo</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00090">list_add_tail()</a>, <a class="el" href="list_8h_source.html#l00459">list_for_each_entry</a>, <a class="el" href="lustre__nrs_8h_source.html#l00411">ptlrpc_nrs_pol_conf::nc_compat</a>, <a class="el" href="lustre__nrs_8h_source.html#l00418">ptlrpc_nrs_pol_conf::nc_compat_svc_name</a>, <a class="el" href="lustre__nrs_8h_source.html#l00428">ptlrpc_nrs_pol_conf::nc_flags</a>, <a class="el" href="lustre__nrs_8h_source.html#l00403">ptlrpc_nrs_pol_conf::nc_name</a>, <a class="el" href="lustre__nrs_8h_source.html#l00407">ptlrpc_nrs_pol_conf::nc_ops</a>, <a class="el" href="lustre__nrs_8h_source.html#l00424">ptlrpc_nrs_pol_conf::nc_owner</a>, <a class="el" href="lustre__nrs_8h_source.html#l00382">NRS_POL_NAME_MAX</a>, <a class="el" href="lustre__net_8h_source.html#l01975">nrs_policy_compat_one()</a>, <a class="el" href="nrs_8c_source.html#l00885">nrs_policy_compatible()</a>, <a class="el" href="nrs_8c_source.html#l01075">nrs_policy_find_desc_locked()</a>, <a class="el" href="nrs_8c_source.html#l00764">nrs_policy_register()</a>, <a class="el" href="nrs_8c_source.html#l01099">nrs_policy_unregister_locked()</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00189">nrs_svc_has_hp()</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00199">nrs_svcpt2nrs()</a>, <a class="el" href="obd__support_8h_source.html#l00710">OBD_ALLOC_PTR</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="structptlrpc__nrs__pol__ops.html#ad81393abaf1277b8fdebc3f67903c55a">ptlrpc_nrs_pol_ops::op_lprocfs_init</a>, <a class="el" href="lustre__nrs_8h_source.html#l00453">ptlrpc_nrs_pol_desc::pd_compat</a>, <a class="el" href="lustre__nrs_8h_source.html#l00459">ptlrpc_nrs_pol_desc::pd_compat_svc_name</a>, <a class="el" href="lustre__nrs_8h_source.html#l00503">ptlrpc_nrs_pol_desc::pd_flags</a>, <a class="el" href="lustre__nrs_8h_source.html#l00445">ptlrpc_nrs_pol_desc::pd_list</a>, <a class="el" href="lustre__nrs_8h_source.html#l00441">ptlrpc_nrs_pol_desc::pd_name</a>, <a class="el" href="lustre__nrs_8h_source.html#l00449">ptlrpc_nrs_pol_desc::pd_ops</a>, <a class="el" href="lustre__nrs_8h_source.html#l00499">ptlrpc_nrs_pol_desc::pd_owner</a>, <a class="el" href="lustre__nrs_8h_source.html#l00507">ptlrpc_nrs_pol_desc::pd_refs</a>, <a class="el" href="service_8c_source.html#l00068">ptlrpc_all_services</a>, <a class="el" href="service_8c_source.html#l00070">ptlrpc_all_services_mutex</a>, <a class="el" href="lustre__nrs_8h_source.html#l00272">PTLRPC_NRS_FL_FALLBACK</a>, <a class="el" href="lustre__nrs_8h_source.html#l00281">PTLRPC_NRS_FL_REG_EXTERN</a>, <a class="el" href="lustre__nrs_8h_source.html#l00276">PTLRPC_NRS_FL_REG_START</a>, <a class="el" href="lustre__net_8h_source.html#l01857">ptlrpc_service_for_each_part</a>, <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>, <a class="el" href="lustre__net_8h_source.html#l01753">ptlrpc_service_part::scp_cpt</a>, <a class="el" href="lustre__net_8h_source.html#l01713">ptlrpc_service::srv_is_stopping</a>, <a class="el" href="string_8c_source.html#l00058">strlcpy()</a>, and <a class="el" href="libcfs__private_8h_source.html#l00310">unlikely</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01787">ptlrpc_nrs_init()</a>.</p>

</div>
</div>
<a class="anchor" id="gafa9c71a2f34f3e56750abaeba0d358f8"></a><!-- doxytag: member="lustre_net.h::ptlrpc_nrs_policy_unregister" ref="gafa9c71a2f34f3e56750abaeba0d358f8" args="(struct ptlrpc_nrs_pol_conf *conf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ptlrpc_nrs_policy_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__nrs__pol__conf.html">ptlrpc_nrs_pol_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregisters a previously registered policy with NRS core. </p>
<p>All instances of the policy on all NRS heads of all supported services are removed.</p>
<p>N.B. This function should only be called from a module's exit() function. Although it can be used for policies that ship alongside NRS core, the function is primarily intended for policies that register externally, from other modules.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>conf</em>&nbsp;</td><td>configuration information for the policy to unregister</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>error </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nrs_8c_source.html#l01323">1323</a> of file <a class="el" href="nrs_8c_source.html">nrs.c</a>.</p>

<p>References <a class="el" href="libcfs__debug_8h_source.html#l00259">CDEBUG</a>, <a class="el" href="libcfs__debug_8h_source.html#l00278">CERROR</a>, <a class="el" href="libcfs__debug_8h_source.html#l00135">D_INFO</a>, <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="small__write_8c_source.html#l00044">GOTO</a>, <a class="el" href="utils_2wirehdr_8c_source.html#l00044">LASSERT</a>, <a class="el" href="list_8h_source.html#l00116">list_del()</a>, <a class="el" href="lustre__nrs_8h_source.html#l00428">ptlrpc_nrs_pol_conf::nc_flags</a>, <a class="el" href="lustre__nrs_8h_source.html#l00403">ptlrpc_nrs_pol_conf::nc_name</a>, <a class="el" href="lustre__nrs_8h_source.html#l00382">NRS_POL_NAME_MAX</a>, <a class="el" href="nrs_8c_source.html#l01075">nrs_policy_find_desc_locked()</a>, <a class="el" href="nrs_8c_source.html#l01099">nrs_policy_unregister_locked()</a>, <a class="el" href="obd__support_8h_source.html#l00830">OBD_FREE_PTR</a>, <a class="el" href="lustre__nrs_8h_source.html#l00445">ptlrpc_nrs_pol_desc::pd_list</a>, <a class="el" href="service_8c_source.html#l00070">ptlrpc_all_services_mutex</a>, <a class="el" href="lustre__nrs_8h_source.html#l00272">PTLRPC_NRS_FL_FALLBACK</a>, and <a class="el" href="libcfs__debug_8h_source.html#l00352">RETURN</a>.</p>

</div>
</div>
<a class="anchor" id="ga385a793cd8516bc3fca7519e54ebd7b6"></a><!-- doxytag: member="lustre_net.h::ptlrpc_nrs_req_can_move" ref="ga385a793cd8516bc3fca7519e54ebd7b6" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool ptlrpc_nrs_req_can_move </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>LU-898: Check <a class="el" href="structptlrpc__nrs__request.html#a93ede77b7ca94be577bc4a17834c31da">ptlrpc_nrs_request::nr_enqueued</a> to make sure the request has been enqueued first, and <a class="el" href="structptlrpc__nrs__request.html#a80e711eebd94cbf365c79f7fe24653cb">ptlrpc_nrs_request::nr_started</a> to make sure it has not been scheduled yet (analogous to previous (non-NRS) checking of !list_empty(&amp;<a class="el" href="structptlrpc__request.html#aa9b98d9b3a3a53d97d4fdc825910c733" title="Linkage item through which this request is included into sending/delayed lists on...">ptlrpc_request::rq_list</a>).</p>
</p>

<p>Definition at line <a class="el" href="lustre__net_8h_source.html#l01155">1155</a> of file <a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>.</p>

<p>References <a class="el" href="lustre__nrs_8h_source.html#l00700">ptlrpc_nrs_request::nr_enqueued</a>, <a class="el" href="lustre__nrs_8h_source.html#l00701">ptlrpc_nrs_request::nr_started</a>, and <a class="el" href="lustre__net_8h_source.html#l01003">ptlrpc_request::rq_hp</a>.</p>

<p>Referenced by <a class="el" href="nrs_8c_source.html#l01673">ptlrpc_nrs_req_hp_move()</a>.</p>

</div>
</div>
<a class="anchor" id="gae517dc74ee0bcadf3b53f6ed4c57e6de"></a><!-- doxytag: member="lustre_net.h::ptlrpc_nrs_req_hp_move" ref="gae517dc74ee0bcadf3b53f6ed4c57e6de" args="(struct ptlrpc_request *req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ptlrpc_nrs_req_hp_move </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structptlrpc__request.html">ptlrpc_request</a> *&nbsp;</td>
          <td class="paramname"> <em>req</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Moves request <em>req</em> from the regular to the high-priority NRS head. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>req</em>&nbsp;</td><td>the request to move </td></tr>
  </table>
  </dd>
</dl>

<p><p>Obtain the high-priority NRS head resources.</p>
<p>Release either the regular NRS head resources if we moved the request, or the high-priority NRS head resources if we took a reference earlier in this function and <a class="el" href="group__nrs.html#ga385a793cd8516bc3fca7519e54ebd7b6">ptlrpc_nrs_req_can_move()</a> returned false.</p>
</p>

<p>Definition at line <a class="el" href="nrs_8c_source.html#l01673">1673</a> of file <a class="el" href="nrs_8c_source.html">nrs.c</a>.</p>

<p>References <a class="el" href="flock_8c_source.html#l00061">ENTRY</a>, <a class="el" href="flock_8c_source.html#l00090">EXIT</a>, <a class="el" href="lustre__nrs_8h_source.html#l00691">ptlrpc_nrs_request::nr_res_ptrs</a>, <a class="el" href="lustre__nrs_8h_source.html#l00671">NRS_RES_MAX</a>, <a class="el" href="nrs_8c_source.html#l00457">nrs_resource_get_safe()</a>, <a class="el" href="nrs_8c_source.html#l00511">nrs_resource_put_safe()</a>, <a class="el" href="ptlrpc__internal_8h_source.html#l00199">nrs_svcpt2nrs()</a>, <a class="el" href="nrs_8c_source.html#l00861">ptlrpc_nrs_hpreq_add_nolock()</a>, <a class="el" href="lustre__net_8h_source.html#l01155">ptlrpc_nrs_req_can_move()</a>, and <a class="el" href="nrs_8c_source.html#l01619">ptlrpc_nrs_req_del_nolock()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga87c0b624fd16e1aaaac107f6d71e0fd1"></a><!-- doxytag: member="ptlrpc_srv_req::sr_nrq" ref="ga87c0b624fd16e1aaaac107f6d71e0fd1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structptlrpc__nrs__request.html">ptlrpc_nrs_request</a> <a class="el" href="group__nrs.html#ga87c0b624fd16e1aaaac107f6d71e0fd1">ptlrpc_srv_req::sr_nrq</a><code> [read, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>stub for NRS request </p>

<p>Definition at line <a class="el" href="lustre__net_8h_source.html#l00910">910</a> of file <a class="el" href="lustre__net_8h_source.html">lustre_net.h</a>.</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:52 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
