<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/lov/lov_internal.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/lov/lov_internal.h</h1><a href="lov__internal_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2003, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef LOV_INTERNAL_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define LOV_INTERNAL_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="obd__class_8h.html">obd_class.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="lustre__user_8h.html">lustre/lustre_user.h</a>&gt;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">/* If we are unable to get the maximum object size from the OST in</span>
<a name="l00044"></a>00044 <span class="comment"> * ocd_maxbytes using OBD_CONNECT_MAXBYTES, then we fall back to using</span>
<a name="l00045"></a>00045 <span class="comment"> * the old maximum object size from ext3. */</span>
<a name="l00046"></a><a class="code" href="lov__internal_8h.html#a91fa00e6978a5177b043996e09f94ea6">00046</a> <span class="preprocessor">#define LUSTRE_EXT3_STRIPE_MAXBYTES 0x1fffffff000ULL</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="structlov__stripe__md.html">00048</a> <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> {
<a name="l00049"></a><a class="code" href="structlov__stripe__md.html#a1b3bc159001923b9d6c17fb235903667">00049</a>         atomic_t        <a class="code" href="structlov__stripe__md.html#a1b3bc159001923b9d6c17fb235903667">lsm_refc</a>;
<a name="l00050"></a><a class="code" href="structlov__stripe__md.html#a85f66587f020038bbe1df6efea4bb3a1">00050</a>         spinlock_t      <a class="code" href="structlov__stripe__md.html#a85f66587f020038bbe1df6efea4bb3a1">lsm_lock</a>;
<a name="l00051"></a><a class="code" href="structlov__stripe__md.html#a2545b8413e1e82d8b20f4ee6bb4ed71f">00051</a>         pid_t           <a class="code" href="structlov__stripe__md.html#a2545b8413e1e82d8b20f4ee6bb4ed71f">lsm_lock_owner</a>; <span class="comment">/* debugging */</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="comment">/* maximum possible file size, might change as OSTs status changes,</span>
<a name="l00054"></a>00054 <span class="comment">         * e.g. disconnected, deactivated */</span>
<a name="l00055"></a><a class="code" href="structlov__stripe__md.html#a3c41c911520596bbcec0ce99b1c7a00d">00055</a>         loff_t          <a class="code" href="structlov__stripe__md.html#a3c41c911520596bbcec0ce99b1c7a00d">lsm_maxbytes</a>;
<a name="l00056"></a><a class="code" href="structlov__stripe__md.html#a25ee17b0e11357169308ee4753359952">00056</a>         <span class="keyword">struct </span><a class="code" href="structost__id.html" title="OST object IDentifier.">ost_id</a>   <a class="code" href="structlov__stripe__md.html#a25ee17b0e11357169308ee4753359952">lsm_oi</a>;
<a name="l00057"></a><a class="code" href="structlov__stripe__md.html#ae1d10c71518541ea1761440a9242d5a6">00057</a>         u32             <a class="code" href="structlov__stripe__md.html#ae1d10c71518541ea1761440a9242d5a6">lsm_magic</a>;
<a name="l00058"></a><a class="code" href="structlov__stripe__md.html#a8120411e89e2e75b764e9461184af292">00058</a>         u32             <a class="code" href="structlov__stripe__md.html#a8120411e89e2e75b764e9461184af292">lsm_stripe_size</a>;
<a name="l00059"></a><a class="code" href="structlov__stripe__md.html#a51608db3983fae479d57af387ba30b25">00059</a>         u32             <a class="code" href="structlov__stripe__md.html#a51608db3983fae479d57af387ba30b25">lsm_pattern</a>; <span class="comment">/* RAID0, RAID1, released, ... */</span>
<a name="l00060"></a><a class="code" href="structlov__stripe__md.html#af2d1f39e8f69708e4179e9a85708e9a2">00060</a>         u16             <a class="code" href="structlov__stripe__md.html#af2d1f39e8f69708e4179e9a85708e9a2">lsm_stripe_count</a>;
<a name="l00061"></a><a class="code" href="structlov__stripe__md.html#aabd03305be3a103382b733de149e7862">00061</a>         u16             <a class="code" href="structlov__stripe__md.html#aabd03305be3a103382b733de149e7862">lsm_layout_gen</a>;
<a name="l00062"></a><a class="code" href="structlov__stripe__md.html#afdc61fb845d8d9e4beace971518a2382">00062</a>         <span class="keywordtype">char</span>            <a class="code" href="structlov__stripe__md.html#afdc61fb845d8d9e4beace971518a2382">lsm_pool_name</a>[<a class="code" href="group__lustreuser.html#gaff040b96729bd1570b96fa43d7b40f35">LOV_MAXPOOLNAME</a> + 1];
<a name="l00063"></a><a class="code" href="structlov__stripe__md.html#a18e38cf8e3f3fdaeb9b63d6ba955a73e">00063</a>         <span class="keyword">struct </span><a class="code" href="structlov__oinfo.html">lov_oinfo</a>        *<a class="code" href="structlov__stripe__md.html#a18e38cf8e3f3fdaeb9b63d6ba955a73e">lsm_oinfo</a>[0];
<a name="l00064"></a>00064 };
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="lov__internal_8h.html#a2992e2c142dc6639b83809f7e2c62dcf">00066</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="lov__internal_8h.html#a2992e2c142dc6639b83809f7e2c62dcf">lsm_is_released</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm)
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068         <span class="keywordflow">return</span> !!(lsm-&gt;<a class="code" href="structlov__stripe__md.html#a51608db3983fae479d57af387ba30b25">lsm_pattern</a> &amp; <a class="code" href="group__lustreuser.html#ga5ea6d1e06f2ab15536f2626540c0c862">LOV_PATTERN_F_RELEASED</a>);
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="lov__internal_8h.html#a047748c788e912553eda9ceac6df9f7c">00071</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="lov__internal_8h.html#a047748c788e912553eda9ceac6df9f7c">lsm_has_objects</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073         <span class="keywordflow">if</span> (lsm == NULL)
<a name="l00074"></a>00074                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordflow">if</span> (<a class="code" href="lov__internal_8h.html#a2992e2c142dc6639b83809f7e2c62dcf">lsm_is_released</a>(lsm))
<a name="l00077"></a>00077                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00080"></a>00080 }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="structlsm__operations.html">00082</a> <span class="keyword">struct </span><a class="code" href="structlsm__operations.html">lsm_operations</a> {
<a name="l00083"></a>00083         void (*<a class="code" href="structlsm__operations.html#a4fa00f53d544b67cb6a57994578bcdb5">lsm_free</a>)(<span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *);
<a name="l00084"></a>00084         void (*<a class="code" href="structlsm__operations.html#a6ac73575eeccde09cca637237f4970f2">lsm_stripe_by_index</a>)(<span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *, <span class="keywordtype">int</span> *, loff_t *,
<a name="l00085"></a>00085                                     loff_t *);
<a name="l00086"></a>00086         void (*<a class="code" href="structlsm__operations.html#a8506c5a14891d83708096384c4e2cb64">lsm_stripe_by_offset</a>)(<span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *, <span class="keywordtype">int</span> *, loff_t *,
<a name="l00087"></a>00087                                      loff_t *);
<a name="l00088"></a>00088         int (*<a class="code" href="structlsm__operations.html#a128fe295e55692c44457ac675e701a3c">lsm_lmm_verify</a>)(<span class="keyword">struct </span><a class="code" href="group__lustreidl.html#ga120d1e282e1d65132fbcd7f17ae908c7">lov_mds_md</a> *lmm, <span class="keywordtype">int</span> lmm_bytes,
<a name="l00089"></a>00089                               u16 *stripe_count);
<a name="l00090"></a>00090         int (*<a class="code" href="structlsm__operations.html#a1caf593b6eb90d93c16d36f8ad768edc">lsm_unpackmd</a>)(<span class="keyword">struct </span><a class="code" href="structlov__obd.html">lov_obd</a> *lov, <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm,
<a name="l00091"></a>00091                             <span class="keyword">struct </span><a class="code" href="group__lustreidl.html#ga120d1e282e1d65132fbcd7f17ae908c7">lov_mds_md</a> *lmm);
<a name="l00092"></a>00092 };
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlsm__operations.html">lsm_operations</a> <a class="code" href="lov__ea_8c.html#a17764ea528aaf8bc55f0fc5447543b93">lsm_v1_ops</a>;
<a name="l00095"></a>00095 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlsm__operations.html">lsm_operations</a> <a class="code" href="lov__ea_8c.html#a5d2e2150742193ee3ad6ac1e9f17b9b6">lsm_v3_ops</a>;
<a name="l00096"></a><a class="code" href="lov__internal_8h.html#a6911417c3f5f2b9e72d2aaf8d12a79dc">00096</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlsm__operations.html">lsm_operations</a> *<a class="code" href="lov__internal_8h.html#a6911417c3f5f2b9e72d2aaf8d12a79dc">lsm_op_find</a>(<span class="keywordtype">int</span> magic)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098         <span class="keywordflow">switch</span> (magic) {
<a name="l00099"></a>00099         <span class="keywordflow">case</span> <a class="code" href="packet-lustre_8c.html#ada11336fa80616348f207b7629418f0b">LOV_MAGIC_V1</a>:
<a name="l00100"></a>00100                 <span class="keywordflow">return</span> &amp;<a class="code" href="lov__ea_8c.html#a17764ea528aaf8bc55f0fc5447543b93">lsm_v1_ops</a>;
<a name="l00101"></a>00101         <span class="keywordflow">case</span> <a class="code" href="group__lustreidl.html#gae8cb34c56846064d179aa2d4aeddbece">LOV_MAGIC_V3</a>:
<a name="l00102"></a>00102                 <span class="keywordflow">return</span> &amp;<a class="code" href="lov__ea_8c.html#a5d2e2150742193ee3ad6ac1e9f17b9b6">lsm_v3_ops</a>;
<a name="l00103"></a>00103         <span class="keywordflow">default</span>:
<a name="l00104"></a>00104                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;unrecognized lsm_magic %08x\n&quot;</span>, magic);
<a name="l00105"></a>00105                 <span class="keywordflow">return</span> NULL;
<a name="l00106"></a>00106         }
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">/* lov_do_div64(a, b) returns a % b, and a = a / b.</span>
<a name="l00110"></a>00110 <span class="comment"> * The 32-bit code is LOV-specific due to knowing about stripe limits in</span>
<a name="l00111"></a>00111 <span class="comment"> * order to reduce the divisor to a 32-bit number.  If the divisor is</span>
<a name="l00112"></a>00112 <span class="comment"> * already a 32-bit value the compiler handles this directly. */</span>
<a name="l00113"></a>00113 <span class="preprocessor">#if BITS_PER_LONG == 64</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor"># define lov_do_div64(n, base) ({                                       \</span>
<a name="l00115"></a>00115 <span class="preprocessor">        uint64_t __base = (base);                                       \</span>
<a name="l00116"></a>00116 <span class="preprocessor">        uint64_t __rem;                                                 \</span>
<a name="l00117"></a>00117 <span class="preprocessor">        __rem = ((uint64_t)(n)) % __base;                               \</span>
<a name="l00118"></a>00118 <span class="preprocessor">        (n) = ((uint64_t)(n)) / __base;                                 \</span>
<a name="l00119"></a>00119 <span class="preprocessor">        __rem;                                                          \</span>
<a name="l00120"></a>00120 <span class="preprocessor">})</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#elif BITS_PER_LONG == 32</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor"># define lov_do_div64(n, base) ({                                       \</span>
<a name="l00123"></a>00123 <span class="preprocessor">        uint64_t __rem;                                                 \</span>
<a name="l00124"></a>00124 <span class="preprocessor">        if ((sizeof(base) &gt; 4) &amp;&amp; (((base) &amp; 0xffffffff00000000ULL) != 0)) {  \</span>
<a name="l00125"></a>00125 <span class="preprocessor">                int __remainder;                                              \</span>
<a name="l00126"></a>00126 <span class="preprocessor">                LASSERTF(!((base) &amp; (LOV_MIN_STRIPE_SIZE - 1)), &quot;64 bit lov &quot; \</span>
<a name="l00127"></a>00127 <span class="preprocessor">                         &quot;division %llu / %llu\n&quot;, (n), (uint64_t)(base));    \</span>
<a name="l00128"></a>00128 <span class="preprocessor">                __remainder = (n) &amp; (LOV_MIN_STRIPE_SIZE - 1);          \</span>
<a name="l00129"></a>00129 <span class="preprocessor">                (n) &gt;&gt;= LOV_MIN_STRIPE_BITS;                            \</span>
<a name="l00130"></a>00130 <span class="preprocessor">                __rem = do_div(n, (base) &gt;&gt; LOV_MIN_STRIPE_BITS);       \</span>
<a name="l00131"></a>00131 <span class="preprocessor">                __rem &lt;&lt;= LOV_MIN_STRIPE_BITS;                          \</span>
<a name="l00132"></a>00132 <span class="preprocessor">                __rem += __remainder;                                   \</span>
<a name="l00133"></a>00133 <span class="preprocessor">        } else {                                                        \</span>
<a name="l00134"></a>00134 <span class="preprocessor">                __rem = do_div(n, base);                                \</span>
<a name="l00135"></a>00135 <span class="preprocessor">        }                                                               \</span>
<a name="l00136"></a>00136 <span class="preprocessor">        __rem;                                                          \</span>
<a name="l00137"></a>00137 <span class="preprocessor">})</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="lov__internal_8h.html#ab51e46eaa2bd2f3e0f3a1c47c5f78cb5">00140</a> <span class="preprocessor">#define pool_tgt_size(p) ((p)-&gt;pool_obds.op_size)</span>
<a name="l00141"></a><a class="code" href="lov__internal_8h.html#ae822a98627ba236ff5909a9f10a60359">00141</a> <span class="preprocessor"></span><span class="preprocessor">#define pool_tgt_count(p) ((p)-&gt;pool_obds.op_count)</span>
<a name="l00142"></a><a class="code" href="lov__internal_8h.html#a440def12dace3c42ca8e3624d900a45b">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define pool_tgt_array(p) ((p)-&gt;pool_obds.op_array)</span>
<a name="l00143"></a><a class="code" href="lov__internal_8h.html#a1a950bea7090a45731d9cef2e9a4d90c">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define pool_tgt_rw_sem(p) ((p)-&gt;pool_obds.op_rw_sem)</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145 <span class="keyword">struct </span><a class="code" href="structpool__desc.html">pool_desc</a> {
<a name="l00146"></a>00146         <span class="keywordtype">char</span>                     <a class="code" href="structpool__desc.html#a76d8b7de9d9b2258a4de8718761d92d8">pool_name</a>[<a class="code" href="group__lustreuser.html#gaff040b96729bd1570b96fa43d7b40f35">LOV_MAXPOOLNAME</a> + 1];
<a name="l00147"></a>00147         <span class="keyword">struct </span><a class="code" href="structost__pool.html">ost_pool</a>          pool_obds;
<a name="l00148"></a>00148         atomic_t                 <a class="code" href="structpool__desc.html#aebad5e146f57d634849727cb60356c8d">pool_refcount</a>;
<a name="l00149"></a>00149         <span class="keyword">struct </span><a class="code" href="structhlist__node.html">hlist_node</a>        pool_hash;     <span class="comment">/* access by poolname */</span>
<a name="l00150"></a>00150         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         pool_list;     <span class="comment">/* serial access */</span>
<a name="l00151"></a>00151         <span class="keyword">struct </span>proc_dir_entry   *<a class="code" href="structpool__desc.html#a1a7e9bb4033caf989f7d244953e6f542">pool_proc_entry</a>;
<a name="l00152"></a>00152         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>       *<a class="code" href="structpool__desc.html#a37a28ec38a85c63de62d5f1056a01e95">pool_lobd</a>;     <span class="comment">/* owner */</span>
<a name="l00153"></a>00153 };
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="structlov__request.html">00155</a> <span class="keyword">struct </span><a class="code" href="structlov__request.html">lov_request</a> {
<a name="l00156"></a><a class="code" href="structlov__request.html#ae88d57ce821872eabc4b0c87b0af563f">00156</a>         <span class="keyword">struct </span><a class="code" href="structobd__info.html">obd_info</a>          <a class="code" href="structlov__request.html#ae88d57ce821872eabc4b0c87b0af563f">rq_oi</a>;
<a name="l00157"></a><a class="code" href="structlov__request.html#a115df6ecb3d30ecfa0ec4b9c64d69650">00157</a>         <span class="keyword">struct </span><a class="code" href="structlov__request__set.html">lov_request_set</a>  *<a class="code" href="structlov__request.html#a115df6ecb3d30ecfa0ec4b9c64d69650">rq_rqset</a>;
<a name="l00158"></a><a class="code" href="structlov__request.html#a4a0ffa496dfbc24d8defc2013eded64e">00158</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structlov__request.html#a4a0ffa496dfbc24d8defc2013eded64e">rq_link</a>;
<a name="l00159"></a><a class="code" href="structlov__request.html#a305312d359f9820e822ace54ee4de33f">00159</a>         <span class="keywordtype">int</span>                      <a class="code" href="structlov__request.html#a305312d359f9820e822ace54ee4de33f">rq_idx</a>;        <span class="comment">/* index in lov-&gt;tgts array */</span>
<a name="l00160"></a><a class="code" href="structlov__request.html#ae872ae616ef7fcd17ac434210c88935c">00160</a>         <span class="keywordtype">int</span>                      <a class="code" href="structlov__request.html#ae872ae616ef7fcd17ac434210c88935c">rq_stripe</a>;     <span class="comment">/* stripe number */</span>
<a name="l00161"></a><a class="code" href="structlov__request.html#a6e0e205933d05655279ab2c0cf0aff26">00161</a>         <span class="keywordtype">int</span>                      <a class="code" href="structlov__request.html#a6e0e205933d05655279ab2c0cf0aff26">rq_complete</a>;
<a name="l00162"></a><a class="code" href="structlov__request.html#ae594aaa949a5bf960c4f336c8efcadf2">00162</a>         <span class="keywordtype">int</span>                      <a class="code" href="structlov__request.html#ae594aaa949a5bf960c4f336c8efcadf2">rq_rc</a>;
<a name="l00163"></a>00163 };
<a name="l00164"></a>00164 
<a name="l00165"></a><a class="code" href="structlov__request__set.html">00165</a> <span class="keyword">struct </span><a class="code" href="structlov__request__set.html">lov_request_set</a> {
<a name="l00166"></a><a class="code" href="structlov__request__set.html#ab4c7cf4346d2ebe54123946b265e6995">00166</a>         <span class="keyword">struct </span><a class="code" href="structobd__info.html">obd_info</a>         *<a class="code" href="structlov__request__set.html#ab4c7cf4346d2ebe54123946b265e6995">set_oi</a>;
<a name="l00167"></a><a class="code" href="structlov__request__set.html#aefbb1bb6788ea5068ac63e9cfba2b2c5">00167</a>         atomic_t                 <a class="code" href="structlov__request__set.html#aefbb1bb6788ea5068ac63e9cfba2b2c5">set_refcount</a>;
<a name="l00168"></a><a class="code" href="structlov__request__set.html#a58aa8482e2dc7a4084f307c1797421af">00168</a>         <span class="keyword">struct </span><a class="code" href="structobd__export.html" title="Export structure.">obd_export</a>       *<a class="code" href="structlov__request__set.html#a58aa8482e2dc7a4084f307c1797421af">set_exp</a>;
<a name="l00169"></a>00169         <span class="comment">/* XXX: There is @set_exp already, however obd_statfs gets</span>
<a name="l00170"></a>00170 <span class="comment">           obd_device only. */</span>
<a name="l00171"></a><a class="code" href="structlov__request__set.html#a4f63ed093835c365b4d7ebb61aab02a9">00171</a>         <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a>       *<a class="code" href="structlov__request__set.html#a4f63ed093835c365b4d7ebb61aab02a9">set_obd</a>;
<a name="l00172"></a><a class="code" href="structlov__request__set.html#a88905e9d0b2e5185afe7e84bd8989352">00172</a>         <span class="keywordtype">int</span>                      <a class="code" href="structlov__request__set.html#a88905e9d0b2e5185afe7e84bd8989352">set_count</a>;
<a name="l00173"></a><a class="code" href="structlov__request__set.html#a38a6a7fec2800fc2f76bd05553f1cce3">00173</a>         atomic_t                 <a class="code" href="structlov__request__set.html#a38a6a7fec2800fc2f76bd05553f1cce3">set_completes</a>;
<a name="l00174"></a><a class="code" href="structlov__request__set.html#a8b7380137c3f287c63981e01d539c128">00174</a>         atomic_t                 <a class="code" href="structlov__request__set.html#a8b7380137c3f287c63981e01d539c128">set_success</a>;
<a name="l00175"></a><a class="code" href="structlov__request__set.html#ac4abe4a32e2659628283692dd5ca0659">00175</a>         atomic_t                 <a class="code" href="structlov__request__set.html#ac4abe4a32e2659628283692dd5ca0659">set_finish_checked</a>;
<a name="l00176"></a><a class="code" href="structlov__request__set.html#a8eeb7fd24d77903192dfa012d030c037">00176</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         <a class="code" href="structlov__request__set.html#a8eeb7fd24d77903192dfa012d030c037">set_list</a>;
<a name="l00177"></a><a class="code" href="structlov__request__set.html#a4db7f2846937cf579c0c6d3e7beb3b81">00177</a>         wait_queue_head_t        <a class="code" href="structlov__request__set.html#a4db7f2846937cf579c0c6d3e7beb3b81">set_waitq</a>;
<a name="l00178"></a>00178 };
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="keyword">extern</span> <span class="keyword">struct </span>kmem_cache *<a class="code" href="lov__internal_8h.html#a7c3b751686b92625114ca35de8bb29e4">lov_oinfo_slab</a>;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__kmem__descr.html">lu_kmem_descr</a> <a class="code" href="lov__dev_8c.html#aa34f2da825284a1b30153069960f04c6">lov_caches</a>[];
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#adc7fa89bae3cfb01d65716b13bb62329">lov_finish_set</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>);
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="lov__internal_8h.html#ae49e17b0e2ad7239ab203551effa335f">00186</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#ae49e17b0e2ad7239ab203551effa335f">lov_put_reqset</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (atomic_dec_and_test(&amp;set-&gt;set_refcount))
<a name="l00189"></a>00189                 <a class="code" href="lov__internal_8h.html#adc7fa89bae3cfb01d65716b13bb62329">lov_finish_set</a>(<span class="keyword">set</span>);
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="lov__internal_8h.html#a62f9c0dc3fd175bb12f9bbc3927802c2">00192</a> <span class="preprocessor">#define lov_uuid2str(lv, index) \</span>
<a name="l00193"></a>00193 <span class="preprocessor">        (char *)((lv)-&gt;lov_tgts[index]-&gt;ltd_uuid.uuid)</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>
<a name="l00195"></a>00195 <span class="comment">/* lov_merge.c */</span>
<a name="l00196"></a>00196 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ae1cbeca39c7c1a887ab753e3ac37b075" title="Merge the lock value block(&amp;amp;lvb) attributes and KMS from each of the stripes...">lov_merge_lvb_kms</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm,
<a name="l00197"></a>00197                       <span class="keyword">struct</span> <a class="code" href="structost__lvb.html">ost_lvb</a> *lvb, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *kms_place);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="comment">/* lov_offset.c */</span>
<a name="l00200"></a>00200 u64 <a class="code" href="lov__internal_8h.html#a6fae7a2f473be1bbbbb156beb8b7ac35">lov_stripe_size</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, u64 ost_size, <span class="keywordtype">int</span> stripeno);
<a name="l00201"></a>00201 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ae1903d406484572ca113b165c10a5175">lov_stripe_offset</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, loff_t lov_off, <span class="keywordtype">int</span> stripeno,
<a name="l00202"></a>00202                       loff_t *obd_off);
<a name="l00203"></a>00203 loff_t <a class="code" href="lov__internal_8h.html#abee14064a7e737ed5646ccad81701f38">lov_size_to_stripe</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, u64 <a class="code" href="fsx_8c.html#a2e20b1a50c221cc85a34c13277736a03">file_size</a>,
<a name="l00204"></a>00204                           <span class="keywordtype">int</span> stripeno);
<a name="l00205"></a>00205 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a4dfe76f1a68d5004328c5789ad4c9053">lov_stripe_intersects</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, <span class="keywordtype">int</span> stripeno,
<a name="l00206"></a>00206                           loff_t <a class="code" href="rename__many_8c.html#ac452537b6646180ccdf7beba12c1b331">start</a>, loff_t <a class="code" href="mdsrate_8c.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>,
<a name="l00207"></a>00207                           loff_t *obd_start, loff_t *obd_end);
<a name="l00208"></a>00208 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#abc8138d72d1922eec019eaefe471cce4">lov_stripe_number</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, loff_t lov_off);
<a name="l00209"></a>00209 pgoff_t <a class="code" href="lov__internal_8h.html#a9e2648aea5dd0062c430ff08e6babbb1" title="Compute file level page index by stripe level page offset.">lov_stripe_pgoff</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, pgoff_t stripe_index,
<a name="l00210"></a>00210                          <span class="keywordtype">int</span> stripe);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 <span class="comment">/* lov_request.c */</span>
<a name="l00213"></a>00213 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a3af135751bbafab3faf17b5167f87d7e">lov_set_add_req</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request.html">lov_request</a> *req, <span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>);
<a name="l00214"></a>00214 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a9034ef1ef08e376bd05d2438bf08fc1e">lov_set_finished</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>, <span class="keywordtype">int</span> idempotent);
<a name="l00215"></a>00215 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#af8cca6118055ff4ec884ff061d9144e0">lov_update_set</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>,
<a name="l00216"></a>00216                     <span class="keyword">struct</span> <a class="code" href="structlov__request.html">lov_request</a> *req, <span class="keywordtype">int</span> rc);
<a name="l00217"></a>00217 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ac0bb29b97b89cf4148b8fa75b3e850f3">lov_check_and_wait_active</a>(<span class="keyword">struct</span> <a class="code" href="structlov__obd.html">lov_obd</a> *lov, <span class="keywordtype">int</span> ost_idx);
<a name="l00218"></a>00218 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#af5b5dac60b156b521c9e282b8333db52">lov_prep_statfs_set</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structobd__info.html">obd_info</a> *oinfo,
<a name="l00219"></a>00219                         <span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> **reqset);
<a name="l00220"></a>00220 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#aea6beae1b5ab79a5d71c01c9cc1a196d">lov_update_statfs</a>(<span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs, <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *lov_sfs,
<a name="l00221"></a>00221                        <span class="keywordtype">int</span> success);
<a name="l00222"></a>00222 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a0ae5e2db6b4edff2369c0a92fd97f588">lov_fini_statfs</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs,
<a name="l00223"></a>00223                     <span class="keywordtype">int</span> success);
<a name="l00224"></a>00224 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a90b1a10205c7ce2c6c3acc3226f8778e">lov_fini_statfs_set</a>(<span class="keyword">struct</span> <a class="code" href="structlov__request__set.html">lov_request_set</a> *<span class="keyword">set</span>);
<a name="l00225"></a>00225 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a16ce9831bd177417ac14147abfe285e2">lov_statfs_interpret</a>(<span class="keyword">struct</span> <a class="code" href="structptlrpc__request__set.html" title="Definition of request set structure.">ptlrpc_request_set</a> *rqset, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> rc);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="comment">/* lov_obd.c */</span>
<a name="l00228"></a>00228 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a8f3c87cabcb5d47b49918785fde1c3e2">lov_stripe_lock</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *md);
<a name="l00229"></a>00229 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#af2a6da155855222f757c1fd236d9c2ab">lov_stripe_unlock</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *md);
<a name="l00230"></a>00230 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a86bac33085b71b2131cbd3c186b0db57">lov_fix_desc</a>(<span class="keyword">struct</span> <a class="code" href="structlov__desc.html">lov_desc</a> *desc);
<a name="l00231"></a>00231 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a02accd732ee2a586d053bcc2730f6b8a">lov_fix_desc_stripe_size</a>(<a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> *val);
<a name="l00232"></a>00232 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#aab4914e1558f31f8b329701bf332de63">lov_fix_desc_stripe_count</a>(__u32 *val);
<a name="l00233"></a>00233 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a6b278a8d90234c5cc1bfcf17abcfb3b6">lov_fix_desc_pattern</a>(__u32 *val);
<a name="l00234"></a>00234 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#ad206de490a6ea67b69255f405283498a">lov_fix_desc_qos_maxage</a>(__u32 *val);
<a name="l00235"></a>00235 __u16 <a class="code" href="lov__internal_8h.html#a8baf258a1956b3d50d998b35da3852f6">lov_get_stripecnt</a>(<span class="keyword">struct</span> <a class="code" href="structlov__obd.html">lov_obd</a> *lov, __u32 magic, __u16 stripe_count);
<a name="l00236"></a>00236 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a054a0ad88fd08f240c3af6991a8affee">lov_connect_obd</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, __u32 index, <span class="keywordtype">int</span> activate,
<a name="l00237"></a>00237                     <span class="keyword">struct</span> <a class="code" href="structobd__connect__data.html">obd_connect_data</a> *data);
<a name="l00238"></a>00238 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a57c80fe6184c1ee150ad3448b6600268">lov_setup</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structlustre__cfg.html">lustre_cfg</a> *lcfg);
<a name="l00239"></a>00239 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ac715b32c2199f6480a6aceeb5abb3eb8">lov_process_config_base</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keyword">struct</span> <a class="code" href="structlustre__cfg.html">lustre_cfg</a> *lcfg,
<a name="l00240"></a>00240                             __u32 *indexp, <span class="keywordtype">int</span> *genp);
<a name="l00241"></a>00241 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ab52f3f81722c8495c64263ce2721abbd">lov_del_target</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, __u32 index,
<a name="l00242"></a>00242                    <span class="keyword">struct</span> <a class="code" href="structobd__uuid.html">obd_uuid</a> *uuidp, <span class="keywordtype">int</span> gen);
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="comment">/* lov_pack.c */</span>
<a name="l00245"></a>00245 ssize_t <a class="code" href="lov__internal_8h.html#a308f4e7a52e3ea846cc68363a6461e95" title="Pack LOV striping metadata for disk storage format (in little endian byte order)...">lov_lsm_pack</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm, <span class="keywordtype">void</span> *<a class="code" href="parallel__grouplock_8c.html#a30581aaaef7980b9fc6df8f98406097c">buf</a>,
<a name="l00246"></a>00246                      <span class="keywordtype">size_t</span> buf_size);
<a name="l00247"></a>00247 <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *<a class="code" href="lov__internal_8h.html#abba5224263ad223d716587162abcc448">lov_unpackmd</a>(<span class="keyword">struct</span> <a class="code" href="structlov__obd.html">lov_obd</a> *lov, <span class="keyword">struct</span> <a class="code" href="group__lustreidl.html#ga120d1e282e1d65132fbcd7f17ae908c7">lov_mds_md</a> *lmm,
<a name="l00248"></a>00248                                    <span class="keywordtype">size_t</span> lmm_size);
<a name="l00249"></a>00249 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#afcb826ef867a3938969a2a00a5eb2c7d">lov_free_memmd</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> **lsmp);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#abfaf93a8f51c65976f147d2415e47028">lov_dump_lmm_v1</a>(<span class="keywordtype">int</span> level, <span class="keyword">struct</span> <a class="code" href="structlov__mds__md__v1.html">lov_mds_md_v1</a> *lmm);
<a name="l00252"></a>00252 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a7bb95c1fd61685569365c8f4971fe070">lov_dump_lmm_v3</a>(<span class="keywordtype">int</span> level, <span class="keyword">struct</span> <a class="code" href="structlov__mds__md__v3.html">lov_mds_md_v3</a> *lmm);
<a name="l00253"></a>00253 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#ad0be1640ec5e33c3360f7eb67771adb7">lov_dump_lmm_common</a>(<span class="keywordtype">int</span> level, <span class="keywordtype">void</span> *lmmp);
<a name="l00254"></a>00254 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#a71825430554071121045b9c8d964e81c">lov_dump_lmm</a>(<span class="keywordtype">int</span> level, <span class="keywordtype">void</span> *lmm);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/* lov_ea.c */</span>
<a name="l00257"></a>00257 <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *<a class="code" href="lov__ea_8c.html#a5aa673b48817b162a2580f288b615729">lsm_alloc_plain</a>(u16 stripe_count);
<a name="l00258"></a>00258 <span class="keywordtype">void</span> <a class="code" href="lov__ea_8c.html#aa4debe6811f1c291dc94afdc96183185">lsm_free_plain</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm);
<a name="l00259"></a>00259 <span class="keywordtype">void</span> <a class="code" href="lov__ea_8c.html#ae1c10050e306693fd0ed643fd4465f7c">dump_lsm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="comment">/* lproc_lov.c */</span>
<a name="l00262"></a>00262 <span class="keyword">extern</span> <span class="keyword">struct </span>file_operations <a class="code" href="lov__internal_8h.html#ade312a7e37b5719ec027f74e5de16097">lov_proc_target_fops</a>;
<a name="l00263"></a>00263 <span class="preprocessor">#ifdef CONFIG_PROC_FS</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlprocfs__vars.html">lprocfs_vars</a> lprocfs_lov_obd_vars[];
<a name="l00265"></a>00265 <span class="preprocessor">#endif</span>
<a name="l00266"></a>00266 <span class="preprocessor"></span>
<a name="l00267"></a>00267 <span class="comment">/* lov_cl.c */</span>
<a name="l00268"></a>00268 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__device__type.html" title="Type of device.">lu_device_type</a> <a class="code" href="group__lov.html#ga2745a960f590325621d2598480c38d72">lov_device_type</a>;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="comment">/* pools */</span>
<a name="l00271"></a>00271 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structcfs__hash__ops.html">cfs_hash_ops</a> <a class="code" href="lod__internal_8h.html#a482f6f8430424db32b75a1344cb3eaea">pool_hash_operations</a>;
<a name="l00272"></a>00272 <span class="comment">/* ost_pool methods */</span>
<a name="l00273"></a>00273 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a4604cb83f00be3bc6e749f08b2eb4b35">lov_ost_pool_init</a>(<span class="keyword">struct</span> <a class="code" href="structost__pool.html">ost_pool</a> *<a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count);
<a name="l00274"></a>00274 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a7eaa731697d01fd6ee010ec50980ad0f">lov_ost_pool_extend</a>(<span class="keyword">struct</span> <a class="code" href="structost__pool.html">ost_pool</a> *<a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_count);
<a name="l00275"></a>00275 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a5cb4f0153231802f4156a6d81d2905d1">lov_ost_pool_add</a>(<span class="keyword">struct</span> <a class="code" href="structost__pool.html">ost_pool</a> *<a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, __u32 idx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_count);
<a name="l00276"></a>00276 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a93b0242b5ae8e3ff311ad94e218c74a9">lov_ost_pool_remove</a>(<span class="keyword">struct</span> <a class="code" href="structost__pool.html">ost_pool</a> *<a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>, __u32 idx);
<a name="l00277"></a>00277 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ae4f9386136340d4af3b52c72bf24e7ea">lov_ost_pool_free</a>(<span class="keyword">struct</span> <a class="code" href="structost__pool.html">ost_pool</a> *<a class="code" href="iam__ut_8c.html#a99a30df0f2488360cdd46b4b88e5f5f0">op</a>);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">/* high level pool methods */</span>
<a name="l00280"></a>00280 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#ac81997d28bd015b7520206f3ddb17949">lov_pool_new</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>);
<a name="l00281"></a>00281 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#a987564df47264c3b98587d8dfd8afdbf">lov_pool_del</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>);
<a name="l00282"></a>00282 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#afa1867437d6e3ddad410fb9ab93fd248">lov_pool_add</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>, <span class="keywordtype">char</span> *ostname);
<a name="l00283"></a>00283 <span class="keywordtype">int</span> <a class="code" href="lov__internal_8h.html#aed2bd2316b21c5bddf0fcac2212a36a9">lov_pool_remove</a>(<span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a> *obd, <span class="keywordtype">char</span> *<a class="code" href="llapi__layout__test_8c.html#a9d096844ad7d6672fe415306cd352062">poolname</a>, <span class="keywordtype">char</span> *ostname);
<a name="l00284"></a>00284 <span class="keywordtype">void</span> <a class="code" href="lov__internal_8h.html#aef7fb022877489a35faac5de1e7c2ada">lov_dump_pool</a>(<span class="keywordtype">int</span> level, <span class="keyword">struct</span> <a class="code" href="structpool__desc.html">pool_desc</a> *pool);
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="lov__internal_8h.html#a290a822aeb01f17ec39540abe2a6ddf2">00286</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *<a class="code" href="lov__internal_8h.html#a290a822aeb01f17ec39540abe2a6ddf2">lsm_addref</a>(<span class="keyword">struct</span> <a class="code" href="structlov__stripe__md.html">lov_stripe_md</a> *lsm)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(atomic_read(&amp;lsm-&gt;<a class="code" href="structlov__stripe__md.html#a1b3bc159001923b9d6c17fb235903667">lsm_refc</a>) &gt; 0);
<a name="l00289"></a>00289         atomic_inc(&amp;lsm-&gt;<a class="code" href="structlov__stripe__md.html#a1b3bc159001923b9d6c17fb235903667">lsm_refc</a>);
<a name="l00290"></a>00290         <span class="keywordflow">return</span> lsm;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="lov__internal_8h.html#a46647dd6308aaf1fa59cde527699bd76">00293</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="lov__internal_8h.html#a46647dd6308aaf1fa59cde527699bd76">lov_oinfo_is_dummy</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlov__oinfo.html">lov_oinfo</a> *loi)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295         <span class="keywordflow">if</span> (<a class="code" href="libcfs__private_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(loi-&gt;<a class="code" href="structlov__oinfo.html#a8d09d3283744c17ac1dd29e7235d5c7b">loi_oi</a>.<a class="code" href="structost__id.html#a01d44bff8859d8cd3aabe8a4b0c2ee46">oi</a>.oi_id == 0 &amp;&amp;
<a name="l00296"></a>00296                      loi-&gt;<a class="code" href="structlov__oinfo.html#a8d09d3283744c17ac1dd29e7235d5c7b">loi_oi</a>.<a class="code" href="structost__id.html#a01d44bff8859d8cd3aabe8a4b0c2ee46">oi</a>.oi_seq == 0 &amp;&amp;
<a name="l00297"></a>00297                      loi-&gt;<a class="code" href="structlov__oinfo.html#a23831418fd676aed99af05e02891ecc5">loi_ost_idx</a> == 0 &amp;&amp;
<a name="l00298"></a>00298                      loi-&gt;<a class="code" href="structlov__oinfo.html#ac4a320685ec78a38b16ede9b61888c48">loi_ost_gen</a> == 0))
<a name="l00299"></a>00299                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="lov__internal_8h.html#a3b54b36f472c7029aacdd787c5eb48c8">00304</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structobd__device.html">obd_device</a> *<a class="code" href="lov__internal_8h.html#a3b54b36f472c7029aacdd787c5eb48c8">lov2obd</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlov__obd.html">lov_obd</a> *<a class="code" href="structobd__device.html#a855c7bb370bc328f8ffde620f5618801">lov</a>)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306         <span class="keywordflow">return</span> container_of0(lov, <span class="keyword">struct</span> <a class="code" href="structobd__device.html">obd_device</a>, <a class="code" href="structobd__device.html#aebe227afed9945c803b5bda6794bb729">u</a>.lov);
<a name="l00307"></a>00307 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:37 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
