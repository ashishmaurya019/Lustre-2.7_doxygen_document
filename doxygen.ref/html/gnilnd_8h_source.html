<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lnet/klnds/gnilnd/gnilnd.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lnet/klnds/gnilnd/gnilnd.h</h1><a href="gnilnd_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2004 Cluster File Systems, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2009-2012 Cray, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (c) 2014, Intel Corporation.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *   Derived from work by: Eric Barton &lt;eric@bartonsoftware.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment"> *   Author: Nic Henke &lt;nic@cray.com&gt;</span>
<a name="l00010"></a>00010 <span class="comment"> *   Author: James Shimek &lt;jshimek@cray.com&gt;</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> *   This file is part of Lustre, http://www.lustre.org.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> *   Lustre is free software; you can redistribute it and/or</span>
<a name="l00015"></a>00015 <span class="comment"> *   modify it under the terms of version 2 of the GNU General Public</span>
<a name="l00016"></a>00016 <span class="comment"> *   License as published by the Free Software Foundation.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> *   Lustre is distributed in the hope that it will be useful,</span>
<a name="l00019"></a>00019 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00020"></a>00020 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00021"></a>00021 <span class="comment"> *   GNU General Public License for more details.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
<a name="l00024"></a>00024 <span class="comment"> *   along with Lustre; if not, write to the Free Software</span>
<a name="l00025"></a>00025 <span class="comment"> *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef _GNILND_GNILND_H_</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define _GNILND_GNILND_H_</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#ifdef HAVE_COMPAT_RDMA</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/compat-2.6.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/module.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;linux/kernel.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;linux/mm.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;linux/string.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;linux/stat.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;linux/errno.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef HAVE_LINUX_KERNEL_LOCK</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/smp_lock.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/unistd.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;linux/uio.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;linux/time.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;asm/timex.h&gt;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;asm/uaccess.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;asm/io.h&gt;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;linux/init.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;linux/fs.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;linux/file.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;linux/stat.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;linux/list.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;linux/kmod.h&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;linux/sysctl.h&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;linux/kthread.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;linux/nmi.h&gt;</span>
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;net/sock.h&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;linux/in.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;linux/nmi.h&gt;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="gnilnd_8h.html#abda60744d497fcfe370cfd6b2d65c7ed">00065</a> <span class="preprocessor">#define DEBUG_SUBSYSTEM S_LND</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;<a class="code" href="libcfs_8h.html">libcfs/libcfs.h</a>&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;<a class="code" href="lnet_8h.html">lnet/lnet.h</a>&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;<a class="code" href="lib-lnet_8h.html">lnet/lib-lnet.h</a>&gt;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="preprocessor">#include &lt;<a class="code" href="gni__pub_8h.html">gni_pub.h</a>&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="gnilnd__version_8h.html">gnilnd_version.h</a>&quot;</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* tunables determined at compile time */</span>
<a name="l00076"></a><a class="code" href="gnilnd_8h.html#ac10eadd0112c7364e467985f9986ff4c">00076</a> <span class="preprocessor">#define GNILND_MIN_TIMEOUT      5               </span><span class="comment">/* minimum timeout interval (seconds) */</span>
<a name="l00077"></a><a class="code" href="gnilnd_8h.html#a6670bdbac27e1fc3c440c7c5b2d1cca0">00077</a> <span class="preprocessor">#define GNILND_TO2KA(t)         (((t)-1)/2)     </span><span class="comment">/* timeout -&gt; keepalive interval */</span>
<a name="l00078"></a><a class="code" href="gnilnd_8h.html#adb3357b42311ed03ca4f34ce8578964c">00078</a> <span class="preprocessor">#define GNILND_MIN_RECONNECT_TO (GNILND_BASE_TIMEOUT/4)</span>
<a name="l00079"></a><a class="code" href="gnilnd_8h.html#aa5a78961772159b3e5bcfca9616d4b4c">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MAX_RECONNECT_TO GNILND_BASE_TIMEOUT</span>
<a name="l00080"></a><a class="code" href="gnilnd_8h.html#abb21b99536740d68558b3dfd31b9af0e">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_HARDWARE_TIMEOUT 15              </span><span class="comment">/* maximum time for data to travel between nodes */</span>
<a name="l00081"></a><a class="code" href="gnilnd_8h.html#a1803f3492695f22195b1999bc1f204a2">00081</a> <span class="preprocessor">#define GNILND_MDD_TIMEOUT      15              </span><span class="comment">/* MDD hold timeout in minutes */</span>
<a name="l00082"></a><a class="code" href="gnilnd_8h.html#a79ebe5720d0a536f1ea89f7c650297ca">00082</a> <span class="preprocessor">#define GNILND_SCHED_TIMEOUT       1</span>
<a name="l00083"></a><a class="code" href="gnilnd_8h.html#a8123962c2bffc19c1f131f277c0b4669">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DGRAM_TIMEOUT       2</span>
<a name="l00084"></a><a class="code" href="gnilnd_8h.html#a365e15ddd1689ef6b9641b4a00df8842">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_FAST_MAPPING_TRY   \</span>
<a name="l00085"></a>00085 <span class="preprocessor">        *kgnilnd_tunables.kgn_max_retransmits   </span><span class="comment">/* maximum number to attempt mapping of a tx */</span>
<a name="l00086"></a><a class="code" href="gnilnd_8h.html#a69f9992a51d6116a9bc477488fc43990">00086</a> <span class="preprocessor">#define GNILND_MAP_RETRY_RATE      1            </span><span class="comment">/* interval between mapping attempts in jiffies */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* map failure timeout */</span>
<a name="l00089"></a><a class="code" href="gnilnd_8h.html#ad38db255065849e09d6a02b5235aa52c">00089</a> <span class="preprocessor">#define GNILND_MAP_TIMEOUT         \</span>
<a name="l00090"></a>00090 <span class="preprocessor">        (cfs_time_seconds(*kgnilnd_tunables.kgn_timeout * \</span>
<a name="l00091"></a>00091 <span class="preprocessor">         *kgnilnd_tunables.kgn_timeout))</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a>00093 <span class="comment">/* reaper thread wakup interval */</span>
<a name="l00094"></a><a class="code" href="gnilnd_8h.html#ac5d67c354c738af03c92e45b0da0e451">00094</a> <span class="preprocessor">#define GNILND_REAPER_THREAD_WAKE  1</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="comment">/* reaper thread checks each conn NCHECKS time every kgnilnd_data.kgn_new_min_timeout */</span>
<a name="l00096"></a><a class="code" href="gnilnd_8h.html#a323b9820a37d496de926522cb97f1777">00096</a> <span class="preprocessor">#define GNILND_REAPER_NCHECKS      4</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a>00098 <span class="comment">/* fixed constants */</span>
<a name="l00099"></a><a class="code" href="gnilnd_8h.html#acbdf96a8f76cb7e1e97b1689751fa0f1">00099</a> <span class="preprocessor">#define GNILND_MAXDEVS          1               </span><span class="comment">/* max # of GNI devices currently supported */</span>
<a name="l00100"></a><a class="code" href="gnilnd_8h.html#a241ee05053f808eb654158da794eab16">00100</a> <span class="preprocessor">#define GNILND_MBOX_CREDITS     256             </span><span class="comment">/* number of credits per mailbox */</span>
<a name="l00101"></a><a class="code" href="gnilnd_8h.html#ae72181f1612fa7b704277765c35ea03a">00101</a> <span class="preprocessor">#define GNILND_CONN_MAGIC         0xa100f       </span><span class="comment">/* magic value for verifying connection validity */</span>
<a name="l00102"></a>00102 <span class="comment">/* checksum values */</span>
<a name="l00103"></a><a class="code" href="gnilnd_8h.html#abdb37b0d6c151140308c6d5010ed1e0b">00103</a> <span class="preprocessor">#define GNILND_CHECKSUM_OFF             0       </span><span class="comment">/* checksum turned off */</span>
<a name="l00104"></a><a class="code" href="gnilnd_8h.html#ab9b4b77ee71ff6f7b1f57a92c815c64a">00104</a> <span class="preprocessor">#define GNILND_CHECKSUM_SMSG_HEADER     1       </span><span class="comment">/* Only checksum SMSG header */</span>
<a name="l00105"></a><a class="code" href="gnilnd_8h.html#a70e89cafea020e4220409c7ffecaa7dd">00105</a> <span class="preprocessor">#define GNILND_CHECKSUM_SMSG            2       </span><span class="comment">/* checksum entire SMSG packet */</span>
<a name="l00106"></a><a class="code" href="gnilnd_8h.html#adb880be392c1791387054db65e089c93">00106</a> <span class="preprocessor">#define GNILND_CHECKSUM_SMSG_BTE        3       </span><span class="comment">/* Full checksum support */</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/* tune down some COMPUTE options as they won&apos;t see the same number of connections and</span>
<a name="l00109"></a>00109 <span class="comment"> * don&apos;t need the throughput of multiple threads by default */</span>
<a name="l00110"></a>00110 <span class="preprocessor">#if defined(CONFIG_CRAY_COMPUTE)</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_MK1OM</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">#define GNILND_SCHED_THREADS      2             </span><span class="comment">/* default # of kgnilnd_scheduler threads */</span>
<a name="l00113"></a>00113 <span class="preprocessor">#else</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">#define GNILND_SCHED_THREADS      1             </span><span class="comment">/* default # of kgnilnd_scheduler threads */</span>
<a name="l00115"></a>00115 <span class="preprocessor">#endif</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">#define GNILND_FMABLK             64            </span><span class="comment">/* default number of mboxes per fmablk */</span>
<a name="l00117"></a>00117 <span class="preprocessor">#define GNILND_SCHED_NICE         0             </span><span class="comment">/* default nice value for scheduler threads */</span>
<a name="l00118"></a>00118 <span class="preprocessor">#define GNILND_COMPUTE            1             </span><span class="comment">/* compute image */</span>
<a name="l00119"></a>00119 <span class="preprocessor">#define GNILND_FAST_RECONNECT     1             </span><span class="comment">/* Fast Reconnect option */</span>
<a name="l00120"></a>00120 <span class="preprocessor">#else</span>
<a name="l00121"></a><a class="code" href="gnilnd_8h.html#a6059390e9b6e11ba8c48a75e57fd8cb0">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_FMABLK             1024          </span><span class="comment">/* default number of mboxes per fmablk */</span>
<a name="l00122"></a><a class="code" href="gnilnd_8h.html#aa520a60ae0ca3e9656038f5c0c89ea70">00122</a> <span class="preprocessor">#define GNILND_SCHED_NICE         -20           </span><span class="comment">/* default nice value for scheduler threads */</span>
<a name="l00123"></a><a class="code" href="gnilnd_8h.html#a42e166f4090eca0d6cf8645cf228e674">00123</a> <span class="preprocessor">#define GNILND_COMPUTE            0             </span><span class="comment">/* service image */</span>
<a name="l00124"></a><a class="code" href="gnilnd_8h.html#a3f5093c7162d78a5f1b287f19cabc448">00124</a> <span class="preprocessor">#define GNILND_FAST_RECONNECT     0             </span><span class="comment">/* Fast Reconnect option */</span>
<a name="l00125"></a>00125 <span class="preprocessor">#endif</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>
<a name="l00127"></a>00127 <span class="comment">/* EXTRA_BITS are there to allow us to hide NOOP/CLOSE and anything else out of band */</span>
<a name="l00128"></a><a class="code" href="gnilnd_8h.html#a79e57606ed582fa86be6f85e2158e886">00128</a> <span class="preprocessor">#define GNILND_EXTRA_BITS         1</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="comment">/* maximum number of conns &amp; bits for cqid in the SMSG event data */</span>
<a name="l00130"></a><a class="code" href="gnilnd_8h.html#a4009b8735200e65fab1c5e9419cb4cbf">00130</a> <span class="preprocessor">#define GNILND_CQID_NBITS         (21 - GNILND_EXTRA_BITS)</span>
<a name="l00131"></a><a class="code" href="gnilnd_8h.html#aa2e26212fdd3960442c188fcd05080f5">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MSGID_TX_NBITS     (32 - GNILND_CQID_NBITS)</span>
<a name="l00132"></a><a class="code" href="gnilnd_8h.html#ada7cf919a3dd25e646818835f2a21844">00132</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MAX_CQID           (1 &lt;&lt; GNILND_CQID_NBITS)</span>
<a name="l00133"></a><a class="code" href="gnilnd_8h.html#a243d5a761e283c93b9725963fb48242f">00133</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MAX_MSG_ID         (1 &lt;&lt; GNILND_MSGID_TX_NBITS)</span>
<a name="l00134"></a><a class="code" href="gnilnd_8h.html#a84dc655f9e1334a031e2ec2fcdc840c4">00134</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MAX_MSG_SIZE       (*kgnilnd_tunables.kgn_max_immediate + sizeof(kgn_msg_t))</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136 <span class="comment">/* need sane upper bound to limit copy overhead */</span>
<a name="l00137"></a><a class="code" href="gnilnd_8h.html#ad34589b51f4e0a2ecc3839d906a5ff09">00137</a> <span class="preprocessor">#define GNILND_MAX_IMMEDIATE      (64&lt;&lt;10)</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>
<a name="l00139"></a>00139 <span class="comment">/* Max number of connections to keep in purgatory per peer */</span>
<a name="l00140"></a><a class="code" href="gnilnd_8h.html#a2635df7dd4dea1165b4b48dcf552d822">00140</a> <span class="preprocessor">#define GNILND_PURGATORY_MAX      5</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="comment">/* Closing, don&apos;t put in purgatory */</span>
<a name="l00142"></a><a class="code" href="gnilnd_8h.html#aad63e3948c1ddc9e418670eaf52cd281">00142</a> <span class="preprocessor">#define GNILND_NOPURG             222</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
<a name="l00144"></a>00144 <span class="comment">/* payload size to add to the base mailbox size</span>
<a name="l00145"></a>00145 <span class="comment"> * This is subtracting 2 from the concurrent_sends as 4 messages are included in the size</span>
<a name="l00146"></a>00146 <span class="comment"> * gni_smsg_buff_size_needed calculates, the MAX_PAYLOAD is added to</span>
<a name="l00147"></a>00147 <span class="comment"> * the calculation return from that function.*/</span>
<a name="l00148"></a><a class="code" href="gnilnd_8h.html#aab471b111d7335252749baf434b64fb8">00148</a> <span class="preprocessor">#define GNILND_MBOX_PAYLOAD     \</span>
<a name="l00149"></a>00149 <span class="preprocessor">          (GNILND_MAX_MSG_SIZE * \</span>
<a name="l00150"></a>00150 <span class="preprocessor">          ((*kgnilnd_tunables.kgn_concurrent_sends - 2) * 2));</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a>00152 <span class="comment">/* timeout -&gt; deadman timer for kgni mdd holds */</span>
<a name="l00153"></a><a class="code" href="gnilnd_8h.html#a59819d72bb2c1d56d952b4e208c81b0e">00153</a> <span class="preprocessor">#define GNILND_TIMEOUT2DEADMAN   ((*kgnilnd_tunables.kgn_mdd_timeout) * 1000 * 60)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00155"></a>00155 <span class="comment">/* timeout for failing sends in t is in jiffies*/</span>
<a name="l00156"></a><a class="code" href="gnilnd_8h.html#a36f49f2fc110c751b62da1a9d201eaac">00156</a> <span class="preprocessor">#define GNILND_TIMEOUTRX(t)     (t + cfs_time_seconds(*kgnilnd_tunables.kgn_hardware_timeout))</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00158"></a>00158 <span class="comment">/* time when to release from purgatory in the reaper thread in jiffies */</span>
<a name="l00159"></a><a class="code" href="gnilnd_8h.html#abb8a7ccf59f7ccc52e30c5923f2e6e74">00159</a> <span class="preprocessor">#define GNILND_PURG_RELEASE(t)   (GNILND_TIMEOUTRX(t) * 3)</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>
<a name="l00161"></a>00161 <span class="comment">/* Macro for finding last_rx 2 datapoints are compared</span>
<a name="l00162"></a>00162 <span class="comment"> * and the most recent one in jiffies is returned.</span>
<a name="l00163"></a>00163 <span class="comment"> */</span>
<a name="l00164"></a><a class="code" href="gnilnd_8h.html#ad2058014784fb4620d4778fb111e9fac">00164</a> <span class="preprocessor">#define GNILND_LASTRX(conn) (time_after(conn-&gt;gnc_last_rx, conn-&gt;gnc_last_rx_cq) \</span>
<a name="l00165"></a>00165 <span class="preprocessor">                                ? conn-&gt;gnc_last_rx : conn-&gt;gnc_last_rx_cq)</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>
<a name="l00167"></a>00167 <span class="comment">/* fmablk registration failures timeout before failing node */</span>
<a name="l00168"></a><a class="code" href="gnilnd_8h.html#aabe23a38dccb02dc4cb0304e97097dba">00168</a> <span class="preprocessor">#define GNILND_REGFAILTO_DISABLE  -1</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>
<a name="l00170"></a>00170 <span class="comment">/************************************************************************</span>
<a name="l00171"></a>00171 <span class="comment"> * Enum, flag and tag data</span>
<a name="l00172"></a>00172 <span class="comment"> */</span>
<a name="l00173"></a><a class="code" href="gnilnd_8h.html#ae0b2c59457a0446e5112f1a495cdaf75">00173</a> <span class="preprocessor">#define GNILND_INIT_NOTHING         0</span>
<a name="l00174"></a><a class="code" href="gnilnd_8h.html#a00aa99f6d8d3ab3ab9f8b5765278e04c">00174</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_INIT_DATA            1</span>
<a name="l00175"></a><a class="code" href="gnilnd_8h.html#a3cb3bafa78b7be7b77bf872b06ba6869">00175</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_INIT_ALL             2</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a>00177 <span class="comment">/* If you change the ordering away from MAPPED = UNMAPPED + 1, things break */</span>
<a name="l00178"></a><a class="code" href="gnilnd_8h.html#afe8e12acbfdea61e48f9bb57077336ac">00178</a> <span class="preprocessor">#define GNILND_BUF_NONE           0              </span><span class="comment">/* buffer type not set */</span>
<a name="l00179"></a><a class="code" href="gnilnd_8h.html#a6262571192d2613b1cc186089b289515">00179</a> <span class="preprocessor">#define GNILND_BUF_IMMEDIATE      1              </span><span class="comment">/* immediate data */</span>
<a name="l00180"></a><a class="code" href="gnilnd_8h.html#aefac1f031c85b0bb3989598681cb7b0a">00180</a> <span class="preprocessor">#define GNILND_BUF_IMMEDIATE_KIOV 2              </span><span class="comment">/* immediate data */</span>
<a name="l00181"></a><a class="code" href="gnilnd_8h.html#a78d14536ca56b0e79f1ec710a663394f">00181</a> <span class="preprocessor">#define GNILND_BUF_PHYS_UNMAPPED  3              </span><span class="comment">/* physical: not mapped yet */</span>
<a name="l00182"></a><a class="code" href="gnilnd_8h.html#a956b9c75e68a9dd97299f84952a607c0">00182</a> <span class="preprocessor">#define GNILND_BUF_PHYS_MAPPED    4              </span><span class="comment">/* physical: mapped already */</span>
<a name="l00183"></a><a class="code" href="gnilnd_8h.html#a72acf5c4cc528ba1e6e74864235fed73">00183</a> <span class="preprocessor">#define GNILND_BUF_VIRT_UNMAPPED  5              </span><span class="comment">/* virtual: not mapped yet */</span>
<a name="l00184"></a><a class="code" href="gnilnd_8h.html#a4ab82644a0eeff27b737032d9beb2990">00184</a> <span class="preprocessor">#define GNILND_BUF_VIRT_MAPPED    6              </span><span class="comment">/* virtual: mapped already */</span>
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="gnilnd_8h.html#aee4d5676b5242d2aa5b31a6fa48bffec">00186</a> <span class="preprocessor">#define GNILND_TX_WAITING_REPLY      (1&lt;&lt;1)     </span><span class="comment">/* expecting to receive reply */</span>
<a name="l00187"></a><a class="code" href="gnilnd_8h.html#aec1ac0b08d1d1f7251fe15fa75eb52ce">00187</a> <span class="preprocessor">#define GNILND_TX_WAITING_COMPLETION (1&lt;&lt;2)     </span><span class="comment">/* waiting for smsg_send to complete */</span>
<a name="l00188"></a><a class="code" href="gnilnd_8h.html#af740699239a803b2ca893fa6fc6853bd">00188</a> <span class="preprocessor">#define GNILND_TX_PENDING_RDMA       (1&lt;&lt;3)     </span><span class="comment">/* RDMA transaction pending until we get prev. completion */</span>
<a name="l00189"></a><a class="code" href="gnilnd_8h.html#ad126df4ad99a9a5a441e25a53fe2ddbb">00189</a> <span class="preprocessor">#define GNILND_TX_QUIET_ERROR        (1&lt;&lt;4)     </span><span class="comment">/* don&apos;t print error on tx_done */</span>
<a name="l00190"></a><a class="code" href="gnilnd_8h.html#a79b95c9db40bdb1d465fa2bf0cd9e948">00190</a> <span class="preprocessor">#define GNILND_TX_FAIL_SMSG          (1&lt;&lt;5)     </span><span class="comment">/* pass down error injection for SMSG fail */</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">/* stash above max CQID to avoid any collision */</span>
<a name="l00193"></a><a class="code" href="gnilnd_8h.html#a5d0ad946a9fb10fc7eec3dabd3812114">00193</a> <span class="preprocessor">#define GNILND_MSGID_NOOP           (GNILND_MAX_CQID + 128)</span>
<a name="l00194"></a><a class="code" href="gnilnd_8h.html#aefe4a813d1fc54f8e72eb35b22e23aae">00194</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_MSGID_CLOSE          (GNILND_MSGID_NOOP + 1)</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>
<a name="l00196"></a>00196 <span class="comment">/* kgn_msg_t::gnm_type */</span>
<a name="l00197"></a><a class="code" href="gnilnd_8h.html#a414a67f1c1974e853ff67f9e8a55d816">00197</a> <span class="preprocessor">#define GNILND_MSG_NONE              0x00        </span><span class="comment">/* illegal message */</span>
<a name="l00198"></a><a class="code" href="gnilnd_8h.html#a5722734fada0cbc8096711745ea8795b">00198</a> <span class="preprocessor">#define GNILND_MSG_NOOP              0x01        </span><span class="comment">/* empty gnm_u (keepalive) */</span>
<a name="l00199"></a><a class="code" href="gnilnd_8h.html#aa3712163c83778e8fa7a39cd6ab6f0c1">00199</a> <span class="preprocessor">#define GNILND_MSG_IMMEDIATE         0x02        </span><span class="comment">/* gnm_u.immediate */</span>
<a name="l00200"></a><a class="code" href="gnilnd_8h.html#a702af06a92bc7dc05cb1982055af1f97">00200</a> <span class="preprocessor">#define GNILND_MSG_PUT_REQ           0x03        </span><span class="comment">/* gnm_u.putreq (src-&gt;sink) */</span>
<a name="l00201"></a><a class="code" href="gnilnd_8h.html#a6f015e6978308e0d5f5fbf14a8894de2">00201</a> <span class="preprocessor">#define GNILND_MSG_PUT_NAK           0x04        </span><span class="comment">/* gnm_u.completion (no PUT match: sink-&gt;src) */</span>
<a name="l00202"></a><a class="code" href="gnilnd_8h.html#a538c1e5ea9db30f63148b2e5b5a235cc">00202</a> <span class="preprocessor">#define GNILND_MSG_PUT_ACK           0x05        </span><span class="comment">/* gnm_u.putack (PUT matched: sink-&gt;src) */</span>
<a name="l00203"></a><a class="code" href="gnilnd_8h.html#a5ad27d7c244ffae29c2768a81db32e5c">00203</a> <span class="preprocessor">#define GNILND_MSG_PUT_DONE          0x06        </span><span class="comment">/* gnm_u.completion (src-&gt;sink) */</span>
<a name="l00204"></a><a class="code" href="gnilnd_8h.html#a936077dff8b5cb1e39c38821cb3ac8d5">00204</a> <span class="preprocessor">#define GNILND_MSG_GET_REQ           0x07        </span><span class="comment">/* gnm_u.get (sink-&gt;src) */</span>
<a name="l00205"></a><a class="code" href="gnilnd_8h.html#a13d525b05522e57c8d1c5bed8368685e">00205</a> <span class="preprocessor">#define GNILND_MSG_GET_NAK           0x08        </span><span class="comment">/* gnm_u.completion (no GET match: src-&gt;sink) */</span>
<a name="l00206"></a><a class="code" href="gnilnd_8h.html#a417c47928f8ac6bb2d79c38f8da50fa0">00206</a> <span class="preprocessor">#define GNILND_MSG_GET_DONE          0x09        </span><span class="comment">/* gnm_u.completion (src-&gt;sink) */</span>
<a name="l00207"></a><a class="code" href="gnilnd_8h.html#af8624e7fad4aad0b939df186e3df0ed4">00207</a> <span class="preprocessor">#define GNILND_MSG_CLOSE             0x0a        </span><span class="comment">/* empty gnm_u */</span>
<a name="l00208"></a><a class="code" href="gnilnd_8h.html#a2d5c4b28bb91e90f8ad935addbb9501e">00208</a> <span class="preprocessor">#define GNILND_MSG_PUT_REQ_REV       0x0b        </span><span class="comment">/* gnm_u.get (src-&gt;sink) */</span>
<a name="l00209"></a><a class="code" href="gnilnd_8h.html#a060a3d02abd591bc5a8fcad9e6d40635">00209</a> <span class="preprocessor">#define GNILND_MSG_PUT_DONE_REV      0x0c        </span><span class="comment">/* gnm_u.completion (sink-&gt;src) */</span>
<a name="l00210"></a><a class="code" href="gnilnd_8h.html#aa55f15ac60dd763125624a47c68a2395">00210</a> <span class="preprocessor">#define GNILND_MSG_PUT_NAK_REV       0x0d        </span><span class="comment">/* gnm_u.completion (no PUT match: sink-&gt;src) */</span>
<a name="l00211"></a><a class="code" href="gnilnd_8h.html#ae4cb635f033a4a5cd743a7e5cf36e938">00211</a> <span class="preprocessor">#define GNILND_MSG_GET_REQ_REV       0x0e        </span><span class="comment">/* gnm_u.get (sink-&gt;src ) */</span>
<a name="l00212"></a><a class="code" href="gnilnd_8h.html#ac9e044e91bd5e297d7a95c30683dca39">00212</a> <span class="preprocessor">#define GNILND_MSG_GET_ACK_REV       0x0f        </span><span class="comment">/* gnm_u.getack (GET matched: src-&gt;sink) */</span>
<a name="l00213"></a><a class="code" href="gnilnd_8h.html#a41f8050b5f2435ed6307f811a0714c2c">00213</a> <span class="preprocessor">#define GNILND_MSG_GET_DONE_REV      0x10        </span><span class="comment">/* gnm_u.completion (sink -&gt; src) */</span>
<a name="l00214"></a><a class="code" href="gnilnd_8h.html#a1a778db934f1153cbabbea7e4544d538">00214</a> <span class="preprocessor">#define GNILND_MSG_GET_NAK_REV       0x11        </span><span class="comment">/* gnm_u.completeion (no GET match: sink -&gt; src) */</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="comment">/* defines for gnc_*scheduled states */</span>
<a name="l00217"></a><a class="code" href="gnilnd_8h.html#a03e064087c51c1d4094f21ec9d815b4e">00217</a> <span class="preprocessor">#define GNILND_CONN_IDLE             0</span>
<a name="l00218"></a><a class="code" href="gnilnd_8h.html#ac90c6ba70ee8da9293a7dcb648695bee">00218</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CONN_SCHED            1</span>
<a name="l00219"></a><a class="code" href="gnilnd_8h.html#abbc55627d983df49b5b8592bd1aaa32c">00219</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CONN_WANTS_SCHED      2</span>
<a name="l00220"></a><a class="code" href="gnilnd_8h.html#a76d878894434e4c2733f2df2ab8670c5">00220</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CONN_PROCESS          3</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>
<a name="l00222"></a><a class="code" href="gnilnd_8h.html#aa00b330c36a6e65a7ad01aac80a9a5dd">00222</a> <span class="preprocessor">#define GNILND_DEV_IDLE              0</span>
<a name="l00223"></a><a class="code" href="gnilnd_8h.html#a61b76015d0a5dcc3e4794678204609a1">00223</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DEV_IRQ               1</span>
<a name="l00224"></a><a class="code" href="gnilnd_8h.html#a8eb565cc25dd88210b9a945a4045547b">00224</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DEV_LOOP              2</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>
<a name="l00226"></a><a class="code" href="gnilnd_8h.html#ad582c74339d5372135e69536f8a5f592">00226</a> <span class="preprocessor">#define GNILND_DGRAM_IDLE            0</span>
<a name="l00227"></a><a class="code" href="gnilnd_8h.html#ad37af1767cd28978ccf5fdf658f274f5">00227</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DGRAM_SCHED           1</span>
<a name="l00228"></a><a class="code" href="gnilnd_8h.html#a535176bd132f9b9c2ce700a282b27b16">00228</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DGRAM_PROCESS         2</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>
<a name="l00230"></a><a class="code" href="gnilnd_8h.html#a62fa3c755f2429f118559bd89c8d84d5">00230</a> <span class="preprocessor">#define GNILND_PEER_IDLE             0</span>
<a name="l00231"></a><a class="code" href="gnilnd_8h.html#a08aa73ed62411a3ea5c771b0d1e8401f">00231</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_CONNECT          1</span>
<a name="l00232"></a><a class="code" href="gnilnd_8h.html#a4ab40a42aa7c7c222eef57a76fa83488">00232</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_POSTING          2</span>
<a name="l00233"></a><a class="code" href="gnilnd_8h.html#a747709150d65c21f6405d9be5e6bf313">00233</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_POSTED           3</span>
<a name="l00234"></a><a class="code" href="gnilnd_8h.html#aed14cc5d3a6e153f6bf209d3783d617f">00234</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_NEEDS_DEATH      4</span>
<a name="l00235"></a><a class="code" href="gnilnd_8h.html#ab9d39ae93d56f49b06b2232f41a42cb5">00235</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_KILL             5</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a>00237 <span class="comment">/* for gnc_close_recvd */</span>
<a name="l00238"></a><a class="code" href="gnilnd_8h.html#af23cb58ebc35b99a3a1a8bd00f6c70d3">00238</a> <span class="preprocessor">#define GNILND_CLOSE_RX              1</span>
<a name="l00239"></a><a class="code" href="gnilnd_8h.html#acfb2144bec86b3da1982c987205ebee2">00239</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CLOSE_INJECT1         2</span>
<a name="l00240"></a><a class="code" href="gnilnd_8h.html#aaa914880e606d924d0e03bf32fff05e1">00240</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CLOSE_INJECT2         3</span>
<a name="l00241"></a><a class="code" href="gnilnd_8h.html#a306b0db54250a10027938b9b020d1384">00241</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CLOSE_EARLY           4</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="comment">/* defines for why quiesce trigger set */</span>
<a name="l00244"></a><a class="code" href="gnilnd_8h.html#a51f16b40581237dc5121cfcf83caf478">00244</a> <span class="preprocessor">#define GNILND_QUIESCE_IDLE          0</span>
<a name="l00245"></a><a class="code" href="gnilnd_8h.html#ad3d9d56e948bbadbee5c48ddffb52bbc">00245</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_QUIESCE_ADMIN         1</span>
<a name="l00246"></a><a class="code" href="gnilnd_8h.html#a112aee7c8bfa84cac934004a83f1e8b0">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_QUIESCE_RESET         2</span>
<a name="l00247"></a><a class="code" href="gnilnd_8h.html#a72ede9b75f81b34f5a9f10099aa31cc1">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_QUIESCE_HW_QUIESCE    3</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>
<a name="l00249"></a><a class="code" href="gnilnd_8h.html#aed0cdc0839de7903053ad948ed376c3d">00249</a> <span class="preprocessor">#define GNILND_PEER_CLEAN            0</span>
<a name="l00250"></a><a class="code" href="gnilnd_8h.html#a4454867c0dd85f2a585fe27427c1f29b">00250</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_PEER_PERSISTING       1</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="gnilnd_8h.html#aadc0bfc0ed40c2ea3a87242fb56f1be9">00252</a> <span class="preprocessor">#define GNILND_DEL_CONN              0</span>
<a name="l00253"></a><a class="code" href="gnilnd_8h.html#adbe19524f381839c2887ed2ecfdd5095">00253</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_DEL_PEER              1</span>
<a name="l00254"></a><a class="code" href="gnilnd_8h.html#ab58772a0d4ff100c4daaa5243dcaedcf">00254</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_CLEAR_PURGATORY       2</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a><a class="code" href="gnilnd_8h.html#a6f3060f398784542eb56f4e9813ab5ee">00256</a> <span class="preprocessor">#define GNILND_RCA_NODE_UP           0</span>
<a name="l00257"></a><a class="code" href="gnilnd_8h.html#a2c1d5b265c4e274dfed0281e084e7880">00257</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_RCA_NODE_DOWN         1</span>
<a name="l00258"></a><a class="code" href="gnilnd_8h.html#a904ec18d477ebeec7c4d667098a7ecba">00258</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_RCA_NODE_UNKNOWN      2</span>
<a name="l00259"></a>00259 <span class="preprocessor"></span>
<a name="l00260"></a>00260 <span class="comment">/* defines for reverse RDMA states */</span>
<a name="l00261"></a><a class="code" href="gnilnd_8h.html#adda9cb19a3b37ef41f45462a430b6639">00261</a> <span class="preprocessor">#define GNILND_REVERSE_NONE             0</span>
<a name="l00262"></a><a class="code" href="gnilnd_8h.html#a4b73e8d034a37c3aa29f2ae8de6c6d2d">00262</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_REVERSE_GET              1</span>
<a name="l00263"></a><a class="code" href="gnilnd_8h.html#af3e67e8e8220c628537f5c8a74d0978b">00263</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_REVERSE_PUT              2</span>
<a name="l00264"></a><a class="code" href="gnilnd_8h.html#a76ecc689bfe6280df11ce811cd5517f3">00264</a> <span class="preprocessor"></span><span class="preprocessor">#define GNILND_REVERSE_BOTH             (GNILND_REVERSE_GET | GNILND_REVERSE_PUT)</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>
<a name="l00266"></a><a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fe">00266</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fe">kgn_fmablk_state</a> {
<a name="l00267"></a><a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fead20fc3a310984100fe707210c936f305">00267</a>         <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fead20fc3a310984100fe707210c936f305">GNILND_FMABLK_IDLE</a> = 0, <span class="comment">/* is allocated or ready to be freed */</span>
<a name="l00268"></a><a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0feae54ea6b5582446ab5dc58dd336f88473">00268</a>         <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0feae54ea6b5582446ab5dc58dd336f88473">GNILND_FMABLK_PHYS</a>,     <span class="comment">/* allocated out of slab of physical memory */</span>
<a name="l00269"></a><a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea1ccd4e5861d4867649a79b03f8e2138c">00269</a>         <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea1ccd4e5861d4867649a79b03f8e2138c">GNILND_FMABLK_VIRT</a>,     <span class="comment">/* &apos;standard&apos; vmalloc hunk */</span>
<a name="l00270"></a><a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea74f6c27283107427cfae273924e51c22">00270</a>         <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea74f6c27283107427cfae273924e51c22">GNILND_FMABLK_FREED</a>,    <span class="comment">/* after free */</span>
<a name="l00271"></a>00271 } <a class="code" href="gnilnd_8h.html#a06d1dfb4838b49767f3edc78fdf82066">kgn_fmablk_state_t</a>;
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3">00273</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3">kgn_tx_list_state</a> {
<a name="l00274"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a8739fec6255b605c908d3aeec59fff0a">00274</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a8739fec6255b605c908d3aeec59fff0a">GNILND_TX_IDLE</a> = 0,     <span class="comment">/* TX is on the idle list, kgn_idle_txs */</span>
<a name="l00275"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">00275</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>,       <span class="comment">/* TX has been alloced (off of idle), could be in any state transition */</span>
<a name="l00276"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">00276</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">GNILND_TX_PEERQ</a>,        <span class="comment">/* TX on peer-&gt;gnp_tx_queue (no live conn) */</span>
<a name="l00277"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">00277</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">GNILND_TX_MAPQ</a>,         <span class="comment">/* TX on dev:gnd_map_tx for buffer mapping */</span>
<a name="l00278"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">00278</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">GNILND_TX_FMAQ</a>,         <span class="comment">/* TX waiting to be send on conn FMA */</span>
<a name="l00279"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">00279</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>,    <span class="comment">/* TX live on the FMA wire, waiting for completion or reply */</span>
<a name="l00280"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">00280</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">GNILND_TX_RDMAQ</a>,        <span class="comment">/* TX waiting to send FMA confirmation to auth RDMA PUT */</span>
<a name="l00281"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">00281</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>,   <span class="comment">/* TX live on the RDMA wire, waiting for completion */</span>
<a name="l00282"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">00282</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>,        <span class="comment">/* TX got caught on MAPQ or RDMAQ while conn was closing, needs someone to call tx_done */</span>
<a name="l00283"></a><a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a23ca8db5b03dbf6da9db4afea6c4df1b">00283</a>         <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a23ca8db5b03dbf6da9db4afea6c4df1b">GNILND_TX_FREED</a>         <span class="comment">/* TX is free! */</span>
<a name="l00284"></a>00284 } <a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840">00286</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840">kgn_conn_state</a> {
<a name="l00287"></a>00287         <span class="comment">/* don&apos;t start @ 0 - prevent memset(0) badness */</span>
<a name="l00288"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a89df6bf549010018c49e9400c43a9e1f">00288</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a89df6bf549010018c49e9400c43a9e1f">GNILND_CONN_DUMMY</a> = 0,
<a name="l00289"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ac4ac654d4d5d3662eec243dc2bfbad79">00289</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ac4ac654d4d5d3662eec243dc2bfbad79">GNILND_CONN_LISTEN</a>,
<a name="l00290"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840acd29011708f4d20d63b00a2e3434dbbf">00290</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840acd29011708f4d20d63b00a2e3434dbbf">GNILND_CONN_CONNECTING</a>,
<a name="l00291"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840af38207cc4ea93ca58295feab9e5b06b1">00291</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840af38207cc4ea93ca58295feab9e5b06b1">GNILND_CONN_ESTABLISHED</a>,
<a name="l00292"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a198bdaa9e3fd0230119414f84e5d79e0">00292</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a198bdaa9e3fd0230119414f84e5d79e0">GNILND_CONN_CLOSING</a>,
<a name="l00293"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ae368bc5dd559c5dd2b6deaa1b740e956">00293</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ae368bc5dd559c5dd2b6deaa1b740e956">GNILND_CONN_CLOSED</a>,
<a name="l00294"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840aed4aabd8d35d04ac367aa184eed376e2">00294</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840aed4aabd8d35d04ac367aa184eed376e2">GNILND_CONN_DONE</a>,
<a name="l00295"></a><a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a4bce15e927727fef1b9297edccd05c33">00295</a>         <a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a4bce15e927727fef1b9297edccd05c33">GNILND_CONN_DESTROY_EP</a>
<a name="l00296"></a>00296 } <a class="code" href="gnilnd_8h.html#a4f644ae1efecea5e3de0d0c2668ccd48">kgn_conn_state_t</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="comment">/* changing these requires a change to GNILND_CONNREQ_VERSION and</span>
<a name="l00299"></a>00299 <span class="comment"> * will result in dropped packets instead of NAKs. Adding to this is</span>
<a name="l00300"></a>00300 <span class="comment"> * acceptable without changing the CONNREQ_VERSION, but code should</span>
<a name="l00301"></a>00301 <span class="comment"> * be ready to handle NAKs on version mismatch  */</span>
<a name="l00302"></a><a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777">00302</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777">kgn_connreq_type</a> {
<a name="l00303"></a><a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a48dd218ba2da7bccf230d76dad5a5b41">00303</a>         <a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a48dd218ba2da7bccf230d76dad5a5b41">GNILND_CONNREQ_REQ</a> = 1,         <span class="comment">/* how YOU doin&apos; ? */</span>
<a name="l00304"></a><a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a94d5a8f2d421f134365d87243edfed68">00304</a>         <a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a94d5a8f2d421f134365d87243edfed68">GNILND_CONNREQ_NAK</a>,             <span class="comment">/* NO soup for you! */</span>
<a name="l00305"></a><a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777adaa4234e3db40364268a026b60d5dc52">00305</a>         <a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777adaa4234e3db40364268a026b60d5dc52">GNILND_CONNREQ_CLOSE</a>,           <span class="comment">/* we should see other people */</span>
<a name="l00306"></a>00306 } <a class="code" href="gnilnd_8h.html#ad9e9bf7209c754ba088533226ac5ab78">kgn_connreq_type_t</a>;
<a name="l00307"></a>00307 
<a name="l00308"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950">00308</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950">kgn_dgram_state</a> {
<a name="l00309"></a>00309         <span class="comment">/* don&apos;t use 0 to avoid thinking a memset of zero is valid data */</span>
<a name="l00310"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a954d2d6a8ab6239c849b6e26bcfe0643">00310</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a954d2d6a8ab6239c849b6e26bcfe0643">GNILND_DGRAM_USED</a> = 1,
<a name="l00311"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a0412913cdbcb1e664ff635883302180a">00311</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a0412913cdbcb1e664ff635883302180a">GNILND_DGRAM_POSTING</a>,
<a name="l00312"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a16f6b012f4ea48a0a117372ddebbae18">00312</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a16f6b012f4ea48a0a117372ddebbae18">GNILND_DGRAM_POSTED</a>,
<a name="l00313"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ad27651948750cad41bba3e4ad706a740">00313</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ad27651948750cad41bba3e4ad706a740">GNILND_DGRAM_PROCESSING</a>,
<a name="l00314"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a671b81e5dd1707df3626ecd10d7ee68c">00314</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a671b81e5dd1707df3626ecd10d7ee68c">GNILND_DGRAM_CANCELED</a>,
<a name="l00315"></a><a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ab7d8300a4cbfd5b331e8018b4822f6f9">00315</a>         <a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ab7d8300a4cbfd5b331e8018b4822f6f9">GNILND_DGRAM_DONE</a>,
<a name="l00316"></a>00316 } <a class="code" href="gnilnd_8h.html#a3d5cd3fca3d3f36c8be443bd43b1c1bb">kgn_dgram_state_t</a>;
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26">00318</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26">kgn_dgram_type</a> {
<a name="l00319"></a><a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a4a4f3521baf43868818329dad6d38e60">00319</a>         <a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a4a4f3521baf43868818329dad6d38e60">GNILND_DGRAM_REQ</a> = 1,         <span class="comment">/* how YOU doin&apos; ? */</span>
<a name="l00320"></a><a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26ac7a6edaf2f13914a807a7a72518e4358">00320</a>         <a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26ac7a6edaf2f13914a807a7a72518e4358">GNILND_DGRAM_WC_REQ</a>,          <span class="comment">/* you talkin&apos; to ME? */</span>
<a name="l00321"></a><a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a8f76fc062376a06723fcaacc88d7b4e2">00321</a>         <a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a8f76fc062376a06723fcaacc88d7b4e2">GNILND_DGRAM_NAK</a>,             <span class="comment">/* NO soup for you! */</span>
<a name="l00322"></a><a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26adea4a1be184d633910794cc89443418e">00322</a>         <a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26adea4a1be184d633910794cc89443418e">GNILND_DGRAM_CLOSE</a>,           <span class="comment">/* we should see other people */</span>
<a name="l00323"></a>00323 } <a class="code" href="gnilnd_8h.html#af8b8123cb6d7bda204f2f338f545833a">kgn_dgram_type_t</a>;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="comment">/************************************************************************</span>
<a name="l00326"></a>00326 <span class="comment"> * Wire message structs.  These are sent in sender&apos;s byte order</span>
<a name="l00327"></a>00327 <span class="comment"> * (i.e. receiver checks magic and flips if required).</span>
<a name="l00328"></a>00328 <span class="comment"> */</span>
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="gnilnd_8h.html#a81aeaea3994bb532cf7a1a5a9c9c5670">00330</a> <span class="preprocessor">#define GNILND_MSG_MAGIC     LNET_PROTO_GNI_MAGIC </span><span class="comment">/* unique magic */</span>
<a name="l00331"></a><a class="code" href="gnilnd_8h.html#af0349821a59c57b1664d802146449eba">00331</a> <span class="preprocessor">#define GNILND_DGRAM_MAGIC   0x0DDBA11</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>
<a name="l00333"></a>00333 <span class="comment">/*  kgn_msg_t - FMA/SMSG wire struct</span>
<a name="l00334"></a>00334 <span class="comment">  v2:</span>
<a name="l00335"></a>00335 <span class="comment">   * - added checksum to FMA</span>
<a name="l00336"></a>00336 <span class="comment">   * moved seq before paylod</span>
<a name="l00337"></a>00337 <span class="comment">   * WIRE_ATTR added for alignment</span>
<a name="l00338"></a>00338 <span class="comment">  v3:</span>
<a name="l00339"></a>00339 <span class="comment">   * added gnm_payload_len for FMA payload size</span>
<a name="l00340"></a>00340 <span class="comment">  v4:</span>
<a name="l00341"></a>00341 <span class="comment">   * added gncm_retval to completion, allowing return code transmission</span>
<a name="l00342"></a>00342 <span class="comment">     on RDMA NAKs</span>
<a name="l00343"></a>00343 <span class="comment">  v5:</span>
<a name="l00344"></a>00344 <span class="comment">   * changed how CQID and TX ids are assigned</span>
<a name="l00345"></a>00345 <span class="comment">  v6:</span>
<a name="l00346"></a>00346 <span class="comment">   * added retval on CLOSE</span>
<a name="l00347"></a>00347 <span class="comment">  v7:</span>
<a name="l00348"></a>00348 <span class="comment">   * added payload checksumming</span>
<a name="l00349"></a>00349 <span class="comment">  v8:</span>
<a name="l00350"></a>00350 <span class="comment">   * reworked checksumming a bit, changed payload checksums</span>
<a name="l00351"></a>00351 <span class="comment">*/</span>
<a name="l00352"></a><a class="code" href="gnilnd_8h.html#a5fb6e064fb5a58d9cb4070c545c7ced6">00352</a> <span class="preprocessor">#define GNILND_MSG_VERSION              8</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="comment">/* kgn_connreq_t connection request datagram wire struct</span>
<a name="l00354"></a>00354 <span class="comment">  v2:</span>
<a name="l00355"></a>00355 <span class="comment">   * added NAKs</span>
<a name="l00356"></a>00356 <span class="comment">*/</span>
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="gnilnd_8h.html#abd9e13d97334b10c2b2026dfd4c75e94">00358</a> <span class="preprocessor">#define GNILND_CONNREQ_VERSION          2</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span>
<a name="l00360"></a><a class="code" href="structkgn__gniparams.html">00360</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__gniparams.html">kgn_gniparams</a> {
<a name="l00361"></a><a class="code" href="structkgn__gniparams.html#a0ee580d49e912f8a2c954093a8bf0522">00361</a>         __u32            <a class="code" href="structkgn__gniparams.html#a0ee580d49e912f8a2c954093a8bf0522">gnpr_host_id</a>;          <span class="comment">/* ph. host ID of the NIC */</span>
<a name="l00362"></a><a class="code" href="structkgn__gniparams.html#a91eb2e51396913ea524606af7640fd40">00362</a>         __u32            <a class="code" href="structkgn__gniparams.html#a91eb2e51396913ea524606af7640fd40">gnpr_cqid</a>;             <span class="comment">/* cqid I want peer to use when sending events to me */</span>
<a name="l00363"></a><a class="code" href="structkgn__gniparams.html#ac546a52c7366da4fdbb9de98394c46b9">00363</a>         <a class="code" href="structgni__smsg__attr.html">gni_smsg_attr_t</a>  <a class="code" href="structkgn__gniparams.html#ac546a52c7366da4fdbb9de98394c46b9">gnpr_smsg_attr</a>;        <span class="comment">/* my short msg. attributes */</span>
<a name="l00364"></a>00364 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> <a class="code" href="structkgn__gniparams.html">kgn_gniparams_t</a>;
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="structkgn__nak__data.html">00366</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__nak__data.html">kgn_nak_data</a> {
<a name="l00367"></a><a class="code" href="structkgn__nak__data.html#ab642014e904809eb127f35c63b981c70">00367</a>         __s32            <a class="code" href="structkgn__nak__data.html#ab642014e904809eb127f35c63b981c70">gnnd_errno</a>;            <span class="comment">/* errno reason for NAK */</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> <a class="code" href="structkgn__nak__data.html">kgn_nak_data_t</a>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="comment">/* the first bits of the connreq struct CANNOT CHANGE FORM EVER</span>
<a name="l00372"></a>00372 <span class="comment"> * without breaking the ability for us to properly NAK someone */</span>
<a name="l00373"></a><a class="code" href="structkgn__connreq.html">00373</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__connreq.html">kgn_connreq</a> {                    <span class="comment">/* connection request/response */</span>
<a name="l00374"></a><a class="code" href="structkgn__connreq.html#a339aeb3890e335d460f3cd27e893b270">00374</a>         __u32             <a class="code" href="structkgn__connreq.html#a339aeb3890e335d460f3cd27e893b270">gncr_magic</a>;           <span class="comment">/* I&apos;m an gnilnd connreq */</span>
<a name="l00375"></a><a class="code" href="structkgn__connreq.html#a83097cb9d5827df7bfd7ea897a26ce56">00375</a>         __u32             <a class="code" href="structkgn__connreq.html#a83097cb9d5827df7bfd7ea897a26ce56">gncr_cksum</a>;           <span class="comment">/* checksum (0 == disabled) */</span>
<a name="l00376"></a><a class="code" href="structkgn__connreq.html#a3f5e7b13bcf2d9713f74a9a1b9826ee6">00376</a>         __u16             <a class="code" href="structkgn__connreq.html#a3f5e7b13bcf2d9713f74a9a1b9826ee6">gncr_type</a>;            <span class="comment">/* REQ, NAK, etc */</span>
<a name="l00377"></a><a class="code" href="structkgn__connreq.html#ad381c498d8c33fc45f227228d8513968">00377</a>         __u16             <a class="code" href="structkgn__connreq.html#ad381c498d8c33fc45f227228d8513968">gncr_version</a>;         <span class="comment">/* this is my version number */</span>
<a name="l00378"></a><a class="code" href="structkgn__connreq.html#ada7e02ee44699928ab4b98350cf1dac1">00378</a>         __u32             <a class="code" href="structkgn__connreq.html#ada7e02ee44699928ab4b98350cf1dac1">gncr_timeout</a>;         <span class="comment">/* sender&apos;s timeout */</span>
<a name="l00379"></a><a class="code" href="structkgn__connreq.html#adf22cc545a3496c33adf782dfedcb844">00379</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             <a class="code" href="structkgn__connreq.html#adf22cc545a3496c33adf782dfedcb844">gncr_srcnid</a>;          <span class="comment">/* sender&apos;s NID */</span>
<a name="l00380"></a><a class="code" href="structkgn__connreq.html#a18c2271a703b87ecf18c69f080fd838e">00380</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             <a class="code" href="structkgn__connreq.html#a18c2271a703b87ecf18c69f080fd838e">gncr_dstnid</a>;          <span class="comment">/* who sender expects to listen */</span>
<a name="l00381"></a><a class="code" href="structkgn__connreq.html#a3376a452a7080b8be6d9d358dd846d55">00381</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             <a class="code" href="structkgn__connreq.html#a3376a452a7080b8be6d9d358dd846d55">gncr_peerstamp</a>;       <span class="comment">/* sender&apos;s instance stamp */</span>
<a name="l00382"></a><a class="code" href="structkgn__connreq.html#a68e94324894ead083cc6f2a2492475dd">00382</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             <a class="code" href="structkgn__connreq.html#a68e94324894ead083cc6f2a2492475dd">gncr_connstamp</a>;       <span class="comment">/* sender&apos;s connection stamp */</span>
<a name="l00383"></a>00383 
<a name="l00384"></a>00384         <span class="comment">/* everything before this needs to stay static, adding after should</span>
<a name="l00385"></a>00385 <span class="comment">         * result in a change to GNILND_CONNREQ_VERSION */</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keyword">union </span>{
<a name="l00388"></a><a class="code" href="structkgn__connreq.html#ae293e6a38adb3452f04d3312eb3c1fc4">00388</a>                 kgn_gniparams_t   <a class="code" href="structkgn__connreq.html#ae293e6a38adb3452f04d3312eb3c1fc4">gncr_gnparams</a>;        <span class="comment">/* sender&apos;s endpoint info */</span>
<a name="l00389"></a><a class="code" href="structkgn__connreq.html#a60aca351f9aeb0506874026d3986e1e6">00389</a>                 kgn_nak_data_t    <a class="code" href="structkgn__connreq.html#a60aca351f9aeb0506874026d3986e1e6">gncr_nakdata</a>;         <span class="comment">/* data (rc, etc) for NAK */</span>
<a name="l00390"></a>00390         };
<a name="l00391"></a>00391 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> <a class="code" href="structkgn__connreq.html">kgn_connreq_t</a>;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00394"></a><a class="code" href="structWIRE__ATTR.html#adef91c52340d84495e955d3667021ada">00394</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>  gnrd_key;
<a name="l00395"></a><a class="code" href="structWIRE__ATTR.html#a2083bf7c573426a0891260d99bf4ec66">00395</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnrd_addr;
<a name="l00396"></a><a class="code" href="structWIRE__ATTR.html#a8ae296eadaa380fb03eeca717c717cfa">00396</a>         __u32             gnrd_nob;
<a name="l00397"></a>00397 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_rdma_desc_t;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00400"></a><a class="code" href="structWIRE__ATTR.html#a3235f33d0b63161bd5567a7fd8349d65">00400</a>         lnet_hdr_t        gnim_hdr;             <span class="comment">/* LNet header */</span>
<a name="l00401"></a>00401         <span class="comment">/* LNet payload is in FMA &quot;Message Data&quot; */</span>
<a name="l00402"></a>00402 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_immediate_msg_t;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00405"></a><a class="code" href="structWIRE__ATTR.html#ab534a05092e7517a3c303050a38af02b">00405</a>         lnet_hdr_t        gnprm_hdr;            <span class="comment">/* LNet header */</span>
<a name="l00406"></a><a class="code" href="structWIRE__ATTR.html#a86f5ba23264fedcbf714239d81c9af3d">00406</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnprm_cookie;         <span class="comment">/* opaque completion cookie */</span>
<a name="l00407"></a>00407 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_putreq_msg_t;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00410"></a><a class="code" href="structWIRE__ATTR.html#a2131f17242531f428f8a280dd490b210">00410</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnpam_src_cookie;     <span class="comment">/* reflected completion cookie */</span>
<a name="l00411"></a><a class="code" href="structWIRE__ATTR.html#aece8a1c189c3fb164e22f1aa4b45c6a2">00411</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnpam_dst_cookie;     <span class="comment">/* opaque completion cookie */</span>
<a name="l00412"></a><a class="code" href="structWIRE__ATTR.html#aa1aeea5190474ccc16403f4dabd7e399">00412</a>         __u16             gnpam_payload_cksum;  <span class="comment">/* checksum for get msg */</span>
<a name="l00413"></a><a class="code" href="structWIRE__ATTR.html#a6f9c479709b1cacddb601b248635c713">00413</a>         kgn_rdma_desc_t   gnpam_desc;           <span class="comment">/* sender&apos;s sink buffer */</span>
<a name="l00414"></a>00414 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_putack_msg_t;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00417"></a><a class="code" href="structWIRE__ATTR.html#ae8e8d9892a1561985b0d1ee9d9edad7c">00417</a>         lnet_hdr_t        gngm_hdr;             <span class="comment">/* LNet header */</span>
<a name="l00418"></a><a class="code" href="structWIRE__ATTR.html#a8dac035f8f0c9b9403ca3dc9b4a49be2">00418</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gngm_cookie;          <span class="comment">/* opaque completion cookie */</span>
<a name="l00419"></a><a class="code" href="structWIRE__ATTR.html#aeb81407a84a694e3197bf10826fb7a4f">00419</a>         __u16             gngm_payload_cksum;   <span class="comment">/* checksum for put msg */</span>
<a name="l00420"></a><a class="code" href="structWIRE__ATTR.html#aa8851d83a8023dbe30ebdb6588550b41">00420</a>         kgn_rdma_desc_t   gngm_desc;            <span class="comment">/* sender&apos;s sink buffer */</span>
<a name="l00421"></a>00421 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_get_msg_t;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00424"></a><a class="code" href="structWIRE__ATTR.html#a5925840627721696c207197fbd39d7d2">00424</a>         <span class="keywordtype">int</span>               gncm_retval;          <span class="comment">/* error on NAK, size on REQ */</span>
<a name="l00425"></a><a class="code" href="structWIRE__ATTR.html#ab998fd9fa0528f122f341b8f371bfa5e">00425</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gncm_cookie;          <span class="comment">/* reflected completion cookie */</span>
<a name="l00426"></a>00426 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_completion_msg_t;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="keyword">typedef</span> <span class="keyword">struct </span>{                                <span class="comment">/* NB must fit in FMA &quot;Prefix&quot; */</span>
<a name="l00429"></a><a class="code" href="structWIRE__ATTR.html#aa3acca5ba76983494012ba2e0a15fef3">00429</a>         __u32             gnm_magic;            <span class="comment">/* I&apos;m an gni message */</span>
<a name="l00430"></a><a class="code" href="structWIRE__ATTR.html#adfe8a42cf16bee733f4a0c5a9faade85">00430</a>         __u16             gnm_version;          <span class="comment">/* this is my version number */</span>
<a name="l00431"></a><a class="code" href="structWIRE__ATTR.html#a28040fafddcbd6cee0322215b26dafe7">00431</a>         __u16             gnm_type;             <span class="comment">/* msg type */</span>
<a name="l00432"></a><a class="code" href="structWIRE__ATTR.html#a42eeba4428f075cd34f315bfa0d0cbe4">00432</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnm_srcnid;           <span class="comment">/* sender&apos;s NID */</span>
<a name="l00433"></a><a class="code" href="structWIRE__ATTR.html#aae8ab9f511e209ef54ad7554c2ae9500">00433</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             gnm_connstamp;        <span class="comment">/* sender&apos;s connection stamp */</span>
<a name="l00434"></a><a class="code" href="structWIRE__ATTR.html#ac09b215a866256ab55e951facf8de072">00434</a>         __u32             gnm_seq;              <span class="comment">/* incrementing sequence number */</span>
<a name="l00435"></a><a class="code" href="structWIRE__ATTR.html#af1e566fa1627454581d6d31771701849">00435</a>         __u16             gnm_cksum;            <span class="comment">/* checksum (0 == no checksum ) */</span>
<a name="l00436"></a><a class="code" href="structWIRE__ATTR.html#a7ea12647e4eb17d9b18a08e2c0111a2b">00436</a>         __u16             gnm_payload_cksum;    <span class="comment">/* payload checksum (0 == no checksum ) */</span>
<a name="l00437"></a><a class="code" href="structWIRE__ATTR.html#aadef64a080c4b55b66e4959e9bc08c11">00437</a>         __u32             gnm_payload_len;      <span class="comment">/* size of the FMA payload sent */</span>
<a name="l00438"></a>00438         <span class="keyword">union </span>{
<a name="l00439"></a><a class="code" href="structWIRE__ATTR.html#a852ff376e69b7a76f5487ddf13b55398">00439</a>                 kgn_immediate_msg_t   immediate;
<a name="l00440"></a><a class="code" href="structWIRE__ATTR.html#a327b94a830b2f2b151533665211e2a04">00440</a>                 kgn_putreq_msg_t      putreq;
<a name="l00441"></a><a class="code" href="structWIRE__ATTR.html#aba42d243047381e18bd55a87b0c4674d">00441</a>                 kgn_putack_msg_t      putack;
<a name="l00442"></a><a class="code" href="structWIRE__ATTR.html#ad6c15e210d0bb3799bf465f47608691b">00442</a>                 kgn_get_msg_t         <span class="keyword">get</span>;
<a name="l00443"></a><a class="code" href="structWIRE__ATTR.html#ad10957667052b2ffe420d64eb8db5cf4">00443</a>                 kgn_completion_msg_t  completion;
<a name="l00444"></a>00444         } gnm_u;
<a name="l00445"></a>00445 } <a class="code" href="structWIRE__ATTR.html">WIRE_ATTR</a> kgn_msg_t;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="comment">/************************************************************************</span>
<a name="l00448"></a>00448 <span class="comment"> * runtime tunable data</span>
<a name="l00449"></a>00449 <span class="comment"> */</span>
<a name="l00450"></a>00450 
<a name="l00451"></a><a class="code" href="structkgn__tunables.html">00451</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__tunables.html">kgn_tunables</a> {
<a name="l00452"></a><a class="code" href="structkgn__tunables.html#ab0696058fae9f6a1e99c7a1763513e3b">00452</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#ab0696058fae9f6a1e99c7a1763513e3b">kgn_min_reconnect_interval</a>; <span class="comment">/* connreq starting timeout &amp; retransmit interval */</span>
<a name="l00453"></a><a class="code" href="structkgn__tunables.html#aabb15d92824fbac8464714a0a4ba05b4">00453</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#aabb15d92824fbac8464714a0a4ba05b4">kgn_max_reconnect_interval</a>; <span class="comment">/* ...exponentially increasing to this */</span>
<a name="l00454"></a><a class="code" href="structkgn__tunables.html#a2a3e3e7afeb534f3452e6d60435e4c06">00454</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a2a3e3e7afeb534f3452e6d60435e4c06">kgn_credits</a>;          <span class="comment">/* # concurrent sends */</span>
<a name="l00455"></a><a class="code" href="structkgn__tunables.html#a249d1b15c02bfaf6e15964c15681d2f8">00455</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a249d1b15c02bfaf6e15964c15681d2f8">kgn_fma_cq_size</a>;      <span class="comment">/* # entries in receive CQ */</span>
<a name="l00456"></a><a class="code" href="structkgn__tunables.html#a96d6cbfd54ef6daaf6178075fb4ddece">00456</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a96d6cbfd54ef6daaf6178075fb4ddece">kgn_peer_credits</a>;     <span class="comment">/* # LNet peer credits */</span>
<a name="l00457"></a><a class="code" href="structkgn__tunables.html#abe3d5186c0e4db70fb80982ff8d0c2c8">00457</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#abe3d5186c0e4db70fb80982ff8d0c2c8">kgn_concurrent_sends</a>; <span class="comment">/* max # of max_immediate in mbox */</span>
<a name="l00458"></a><a class="code" href="structkgn__tunables.html#a12c0064e233846566b84d3a2c7578972">00458</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a12c0064e233846566b84d3a2c7578972">kgn_timeout</a>;          <span class="comment">/* comms timeout (seconds) */</span>
<a name="l00459"></a><a class="code" href="structkgn__tunables.html#a71d7522cd28b4b529eb1f7d4a6e06528">00459</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a71d7522cd28b4b529eb1f7d4a6e06528">kgn_max_immediate</a>;    <span class="comment">/* immediate payload breakpoint */</span>
<a name="l00460"></a><a class="code" href="structkgn__tunables.html#af9675f5e42ff98ed45dd8a3f412b3b1e">00460</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#af9675f5e42ff98ed45dd8a3f412b3b1e">kgn_checksum</a>;         <span class="comment">/* checksum data */</span>
<a name="l00461"></a><a class="code" href="structkgn__tunables.html#a9c5edc834933c6d62f846b763f84956b">00461</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a9c5edc834933c6d62f846b763f84956b">kgn_checksum_dump</a>;    <span class="comment">/* dump raw data to D_INFO log when checksumming */</span>
<a name="l00462"></a><a class="code" href="structkgn__tunables.html#a409651ee2f4c662f0faae9b9a8603d4d">00462</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a409651ee2f4c662f0faae9b9a8603d4d">kgn_bte_dlvr_mode</a>;    <span class="comment">/* BTE delivery mode mask */</span>
<a name="l00463"></a><a class="code" href="structkgn__tunables.html#a3f5e22379310cf342d407bb210ed1c44">00463</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a3f5e22379310cf342d407bb210ed1c44">kgn_bte_relaxed_ordering</a>; <span class="comment">/* relaxed ordering (PASSPW) on BTE transfers */</span>
<a name="l00464"></a><a class="code" href="structkgn__tunables.html#ad9558c4a46aa4504af53b4fed08792fb">00464</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#ad9558c4a46aa4504af53b4fed08792fb">kgn_ptag</a>;             <span class="comment">/* PTAG for cdm_create */</span>
<a name="l00465"></a><a class="code" href="structkgn__tunables.html#a47de3cad1c510e40001341a4b6f5c33a">00465</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a47de3cad1c510e40001341a4b6f5c33a">kgn_pkey</a>;             <span class="comment">/* PKEY for cdm_create */</span>
<a name="l00466"></a><a class="code" href="structkgn__tunables.html#a7b147e088a99bae77151da623ee25719">00466</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a7b147e088a99bae77151da623ee25719">kgn_max_retransmits</a>;  <span class="comment">/* max number of FMA retransmits */</span>
<a name="l00467"></a><a class="code" href="structkgn__tunables.html#af80a385f48c278fb1d4d269dbe9650db">00467</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#af80a385f48c278fb1d4d269dbe9650db">kgn_nwildcard</a>;        <span class="comment">/* # wildcard per net to post */</span>
<a name="l00468"></a><a class="code" href="structkgn__tunables.html#acf385a6eb103311f2e130153dc256285">00468</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#acf385a6eb103311f2e130153dc256285">kgn_nice</a>;             <span class="comment">/* nice value for kgnilnd threads */</span>
<a name="l00469"></a><a class="code" href="structkgn__tunables.html#a0de170f274bbc1b049cc0a8d96d983eb">00469</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a0de170f274bbc1b049cc0a8d96d983eb">kgn_rdmaq_intervals</a>;  <span class="comment">/* # intervals per second for rdmaq throttle */</span>
<a name="l00470"></a><a class="code" href="structkgn__tunables.html#a6a85bee3878b7b0319fe5926dbf68bb9">00470</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a6a85bee3878b7b0319fe5926dbf68bb9">kgn_loops</a>;            <span class="comment">/* # of loops sched does before flush/heartbeat tickle */</span>
<a name="l00471"></a><a class="code" href="structkgn__tunables.html#acc193b5b5171465a5a45ec26665c4c63">00471</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#acc193b5b5171465a5a45ec26665c4c63">kgn_peer_hash_size</a>;   <span class="comment">/* size of kgn_peers */</span>
<a name="l00472"></a><a class="code" href="structkgn__tunables.html#a3b35debe1723bfa80a18771c88ef5a61">00472</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a3b35debe1723bfa80a18771c88ef5a61">kgn_peer_health</a>;      <span class="comment">/* enable/disable peer health */</span>
<a name="l00473"></a><a class="code" href="structkgn__tunables.html#aaacf367752a989b862685f8037c186cd">00473</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#aaacf367752a989b862685f8037c186cd">kgn_peer_timeout</a>;     <span class="comment">/* Override of the default peer_timeout used by peer_health */</span>
<a name="l00474"></a><a class="code" href="structkgn__tunables.html#adce64da6b3b4d0ff584d57f59cc30732">00474</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#adce64da6b3b4d0ff584d57f59cc30732">kgn_vmap_cksum</a>;       <span class="comment">/* enable/disable vmap of kiov checksums */</span>
<a name="l00475"></a><a class="code" href="structkgn__tunables.html#a9ee75448f755ee69a9be568f70eb26c3">00475</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a9ee75448f755ee69a9be568f70eb26c3">kgn_mbox_per_block</a>;   <span class="comment">/* mailboxes per fmablk */</span>
<a name="l00476"></a><a class="code" href="structkgn__tunables.html#aa845e81ea7b75f2a8748d96761a274cf">00476</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#aa845e81ea7b75f2a8748d96761a274cf">kgn_nphys_mbox</a>;       <span class="comment">/* # mailboxes to preallocate with physical memory */</span>
<a name="l00477"></a><a class="code" href="structkgn__tunables.html#aaada2458ab6f6be7992cca495951adb3">00477</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#aaada2458ab6f6be7992cca495951adb3">kgn_mbox_credits</a>;     <span class="comment">/* max credits per fma */</span>
<a name="l00478"></a><a class="code" href="structkgn__tunables.html#a2ac9918bda5284e6eb49078b5f13a2b0">00478</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a2ac9918bda5284e6eb49078b5f13a2b0">kgn_sched_threads</a>;    <span class="comment">/* number of kgnilnd_scheduler threads */</span>
<a name="l00479"></a><a class="code" href="structkgn__tunables.html#a13f331d71711fd6e13e4453153bdc634">00479</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a13f331d71711fd6e13e4453153bdc634">kgn_net_hash_size</a>;    <span class="comment">/* size of kgn_net_ht */</span>
<a name="l00480"></a><a class="code" href="structkgn__tunables.html#a8c8d59df0cef7603faeae5994dc9886f">00480</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a8c8d59df0cef7603faeae5994dc9886f">kgn_hardware_timeout</a>; <span class="comment">/* max time for a message to get across the network */</span>
<a name="l00481"></a><a class="code" href="structkgn__tunables.html#a1bb44e4a5ef722d027a5124ec45e5e9e">00481</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a1bb44e4a5ef722d027a5124ec45e5e9e">kgn_mdd_timeout</a>;      <span class="comment">/* max time for ghal to hold an mdd in minutes */</span>
<a name="l00482"></a><a class="code" href="structkgn__tunables.html#a275a6f7882153be841b2938deba379ad">00482</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a275a6f7882153be841b2938deba379ad">kgn_sched_timeout</a>;    <span class="comment">/* max time for scheduler to run before yielding */</span>
<a name="l00483"></a><a class="code" href="structkgn__tunables.html#afdaa36d1f176adc05479a26974ed8be1">00483</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#afdaa36d1f176adc05479a26974ed8be1">kgn_dgram_timeout</a>;    <span class="comment">/* max time for dgram mover to run before scheduling */</span>
<a name="l00484"></a><a class="code" href="structkgn__tunables.html#a775d6eb8d07ecf15d054799862d9a7e6">00484</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a775d6eb8d07ecf15d054799862d9a7e6">kgn_sched_nice</a>;       <span class="comment">/* nice value for kgnilnd scheduler threads */</span>
<a name="l00485"></a><a class="code" href="structkgn__tunables.html#a981fcf2baaea379fde828d8355f052de">00485</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a981fcf2baaea379fde828d8355f052de">kgn_reverse_rdma</a>;     <span class="comment">/* Reverse RDMA setting */</span>
<a name="l00486"></a><a class="code" href="structkgn__tunables.html#a61d0fec9e6aa5215e557760cdddee11e">00486</a>         <span class="keywordtype">int</span>              *<a class="code" href="structkgn__tunables.html#a61d0fec9e6aa5215e557760cdddee11e">kgn_eager_credits</a>;    <span class="comment">/* allocated eager buffers */</span>
<a name="l00487"></a><a class="code" href="structkgn__tunables.html#ad9c1721c88bd86869ee8e292a6f65f42">00487</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#ad9c1721c88bd86869ee8e292a6f65f42">kgn_fast_reconn</a>;      <span class="comment">/* fast reconnection on conn timeout */</span>
<a name="l00488"></a><a class="code" href="structkgn__tunables.html#a6ddb1ce7490300427b3ff968adcd92e5">00488</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#a6ddb1ce7490300427b3ff968adcd92e5">kgn_efault_lbug</a>;      <span class="comment">/* LBUG on receiving an EFAULT */</span>
<a name="l00489"></a><a class="code" href="structkgn__tunables.html#a6de0df51827601ba9d366a215e2c1ce1">00489</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#a6de0df51827601ba9d366a215e2c1ce1">kgn_max_purgatory</a>;    <span class="comment">/* # conns/peer to keep in purgatory */</span>
<a name="l00490"></a><a class="code" href="structkgn__tunables.html#aa40136954f6aa247e5cde59c86c578e1">00490</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#aa40136954f6aa247e5cde59c86c578e1">kgn_reg_fail_timeout</a>; <span class="comment">/* registration failure timeout */</span>
<a name="l00491"></a><a class="code" href="structkgn__tunables.html#a0a5f5c0c9f271b0c899007626b690c24">00491</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#a0a5f5c0c9f271b0c899007626b690c24">kgn_thread_affinity</a>;  <span class="comment">/* bind scheduler threads to cpus */</span>
<a name="l00492"></a><a class="code" href="structkgn__tunables.html#ac8b5703b9dd55c8dfc5e43b3ef16373e">00492</a>         <span class="keywordtype">int</span>     *<a class="code" href="structkgn__tunables.html#ac8b5703b9dd55c8dfc5e43b3ef16373e">kgn_thread_safe</a>;      <span class="comment">/* use thread safe kgni API */</span>
<a name="l00493"></a>00493 } <a class="code" href="structkgn__tunables.html">kgn_tunables_t</a>;
<a name="l00494"></a>00494 
<a name="l00495"></a><a class="code" href="structkgn__mbox__info.html">00495</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__mbox__info.html">kgn_mbox_info</a> {
<a name="l00496"></a><a class="code" href="structkgn__mbox__info.html#afc1e98ea09e1a66197294ec1325341a4">00496</a>         <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> <a class="code" href="structkgn__mbox__info.html#afc1e98ea09e1a66197294ec1325341a4">mbx_prev_nid</a>;
<a name="l00497"></a><a class="code" href="structkgn__mbox__info.html#a2d65a6898f43f8e91d72fe8f490f9893">00497</a>         <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> <a class="code" href="structkgn__mbox__info.html#a2d65a6898f43f8e91d72fe8f490f9893">mbx_prev_purg_nid</a>;
<a name="l00498"></a><a class="code" href="structkgn__mbox__info.html#abda9d2e0369ea4d78431ccb0718f4da5">00498</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkgn__mbox__info.html#abda9d2e0369ea4d78431ccb0718f4da5">mbx_create_conn_memset</a>;
<a name="l00499"></a><a class="code" href="structkgn__mbox__info.html#a915a6e7c8f5bf1c49210ceccd8851368">00499</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkgn__mbox__info.html#a915a6e7c8f5bf1c49210ceccd8851368">mbx_add_purgatory</a>;
<a name="l00500"></a><a class="code" href="structkgn__mbox__info.html#a0e939bb486ddf5b708dd13a47b7706d8">00500</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkgn__mbox__info.html#a0e939bb486ddf5b708dd13a47b7706d8">mbx_detach_of_purgatory</a>;
<a name="l00501"></a><a class="code" href="structkgn__mbox__info.html#a8518efb274aa4506128906b139a03b09">00501</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkgn__mbox__info.html#a8518efb274aa4506128906b139a03b09">mbx_release_from_purgatory</a>;
<a name="l00502"></a><a class="code" href="structkgn__mbox__info.html#a309801504cecba859b4cb5bcc3b58ed7">00502</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structkgn__mbox__info.html#a309801504cecba859b4cb5bcc3b58ed7">mbx_release_purg_active_dgram</a>;
<a name="l00503"></a><a class="code" href="structkgn__mbox__info.html#ac0dca24fe50fb866ae77512afeb4359e">00503</a>         <span class="keywordtype">int</span>           <a class="code" href="structkgn__mbox__info.html#ac0dca24fe50fb866ae77512afeb4359e">mbx_nallocs</a>;
<a name="l00504"></a><a class="code" href="structkgn__mbox__info.html#ae7760d56b6ebbe72e4fbe511b4c0ab7b">00504</a>         <span class="keywordtype">int</span>           <a class="code" href="structkgn__mbox__info.html#ae7760d56b6ebbe72e4fbe511b4c0ab7b">mbx_nallocs_total</a>;
<a name="l00505"></a>00505 } <a class="code" href="structkgn__mbox__info.html">kgn_mbox_info_t</a>;
<a name="l00506"></a>00506 
<a name="l00507"></a><a class="code" href="structkgn__fma__memblock.html">00507</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__fma__memblock.html">kgn_fma_memblock</a> {
<a name="l00508"></a><a class="code" href="structkgn__fma__memblock.html#a1fb88c525253b178e5d3cbe8ee00b98e">00508</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__fma__memblock.html#a1fb88c525253b178e5d3cbe8ee00b98e">gnm_bufflist</a>;                          <span class="comment">/* memblock is part of device&apos;s  gnd_fma_buffs */</span>
<a name="l00509"></a><a class="code" href="structkgn__fma__memblock.html#a27d31da05d1397e7b6d476001771d1e6">00509</a>         <a class="code" href="gnilnd_8h.html#a06d1dfb4838b49767f3edc78fdf82066">kgn_fmablk_state_t</a>  <a class="code" href="structkgn__fma__memblock.html#a27d31da05d1397e7b6d476001771d1e6">gnm_state</a>;                             <span class="comment">/* how this memory allocated &amp; state of it */</span>
<a name="l00510"></a><a class="code" href="structkgn__fma__memblock.html#a887e7562a9972a1759c2bd091e817c8a">00510</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#a887e7562a9972a1759c2bd091e817c8a">gnm_hold_timeout</a>;                      <span class="comment">/* hold_timeout if used at unmap time */</span>
<a name="l00511"></a><a class="code" href="structkgn__fma__memblock.html#a446914981e6f7893babbe183a8882220">00511</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#a446914981e6f7893babbe183a8882220">gnm_num_mboxs</a>;                         <span class="comment">/* total mboxes allocated */</span>
<a name="l00512"></a><a class="code" href="structkgn__fma__memblock.html#aa4864ee1cee075485c209ed202b177ac">00512</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#aa4864ee1cee075485c209ed202b177ac">gnm_avail_mboxs</a>;                       <span class="comment">/* number of available mailboxes in the block */</span>
<a name="l00513"></a><a class="code" href="structkgn__fma__memblock.html#a9c1dd155b9beaae810d5c012235c3e4e">00513</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#a9c1dd155b9beaae810d5c012235c3e4e">gnm_held_mboxs</a>;                        <span class="comment">/* number of purgatory held  mailboxes */</span>
<a name="l00514"></a><a class="code" href="structkgn__fma__memblock.html#a10c29e7513392b5c54e1f50a1ee400df">00514</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#a10c29e7513392b5c54e1f50a1ee400df">gnm_mbox_size</a>;                         <span class="comment">/* size of the single mailbox */</span>
<a name="l00515"></a><a class="code" href="structkgn__fma__memblock.html#ad0fb3006dd21142155a2fa4abbc10cb8">00515</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__fma__memblock.html#ad0fb3006dd21142155a2fa4abbc10cb8">gnm_next_avail_mbox</a>;                   <span class="comment">/* next available mailbox */</span>
<a name="l00516"></a><a class="code" href="structkgn__fma__memblock.html#ab7d550d2036aa71dc6fc495d2973ca8d">00516</a>         <span class="keywordtype">long</span>                <a class="code" href="structkgn__fma__memblock.html#ab7d550d2036aa71dc6fc495d2973ca8d">gnm_max_timeout</a>;                       <span class="comment">/* max timeout for possible purgatory hold */</span>
<a name="l00517"></a><a class="code" href="structkgn__fma__memblock.html#a9363f15234016f79f9750fb0cd266d06">00517</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="structkgn__fma__memblock.html#a9363f15234016f79f9750fb0cd266d06">gnm_blk_size</a>;                          <span class="comment">/* how big is our hunk o memory ? */</span>
<a name="l00518"></a><a class="code" href="structkgn__fma__memblock.html#a7ae72e0428ae5ccfaf1b95740b222e87">00518</a>         <span class="keywordtype">void</span>               *<a class="code" href="structkgn__fma__memblock.html#a7ae72e0428ae5ccfaf1b95740b222e87">gnm_block</a>;                             <span class="comment">/* pointer to mem. block */</span>
<a name="l00519"></a><a class="code" href="structkgn__fma__memblock.html#a09822fd3ada28d5b93898186a9fb7213">00519</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>    <a class="code" href="structkgn__fma__memblock.html#a09822fd3ada28d5b93898186a9fb7213">gnm_hndl</a>;                              <span class="comment">/* mem. handle of the block */</span>
<a name="l00520"></a><a class="code" href="structkgn__fma__memblock.html#a79ec5a38cffb295070f70fc48f725c27">00520</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>      *<a class="code" href="structkgn__fma__memblock.html#a79ec5a38cffb295070f70fc48f725c27">gnm_bit_array</a>;                         <span class="comment">/* bit array tracking allocation of mailboxes */</span>
<a name="l00521"></a><a class="code" href="structkgn__fma__memblock.html#a4a4b79d2d90189d3d56b9e449644322f">00521</a>         <a class="code" href="structkgn__mbox__info.html">kgn_mbox_info_t</a>    *<a class="code" href="structkgn__fma__memblock.html#a4a4b79d2d90189d3d56b9e449644322f">gnm_mbox_info</a>;                         <span class="comment">/* array of mbox_information about each mbox */</span>
<a name="l00522"></a>00522 } <a class="code" href="structkgn__fma__memblock.html">kgn_fma_memblock_t</a>;
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="structkgn__device.html">00524</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__device.html">kgn_device</a> {
<a name="l00525"></a><a class="code" href="structkgn__device.html#adef69bb2d51b71d659d4404ea419e18e">00525</a>         <a class="code" href="gni__pub_8h.html#af1caa135c65d40d4d45b21b1f0b707b8">gni_nic_handle_t</a>        <a class="code" href="structkgn__device.html#adef69bb2d51b71d659d4404ea419e18e">gnd_handle</a>;       <span class="comment">/* device handle */</span>
<a name="l00526"></a><a class="code" href="structkgn__device.html#a8fb416a4d8b96283ad814b444edd4e0f">00526</a>         <a class="code" href="gni__pub_8h.html#a6ac578b54bff23d65f7c977189b2b0a5">gni_cdm_handle_t</a>        <a class="code" href="structkgn__device.html#a8fb416a4d8b96283ad814b444edd4e0f">gnd_domain</a>;       <span class="comment">/* GNI communication domain */</span>
<a name="l00527"></a><a class="code" href="structkgn__device.html#ae59be350e5746598ef6ea5107a3866f5">00527</a>         <a class="code" href="gni__pub_8h.html#afeff57911fc00ec064a2b9bdb7b0b47c">gni_err_handle_t</a>        <a class="code" href="structkgn__device.html#ae59be350e5746598ef6ea5107a3866f5">gnd_err_handle</a>;   <span class="comment">/* device error handle */</span>
<a name="l00528"></a><a class="code" href="structkgn__device.html#af89a5f9375dac3c671cded4958f4d937">00528</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__device.html#af89a5f9375dac3c671cded4958f4d937">gnd_sched_alive</a>;  <span class="comment">/* scheduler thread alive stamp */</span>
<a name="l00529"></a><a class="code" href="structkgn__device.html#a3c6917235269d06e3c44a66d18be65f4">00529</a>         <a class="code" href="gni__pub_8h.html#a897899941c015abbc9ba88acdc7e0ca8">gni_cq_handle_t</a>         <a class="code" href="structkgn__device.html#a3c6917235269d06e3c44a66d18be65f4">gnd_rcv_fma_cqh</a>;  <span class="comment">/* FMA rcv. completion queue handle */</span>
<a name="l00530"></a><a class="code" href="structkgn__device.html#ab3ab404d12af522c68d41c3a8543d58c">00530</a>         <a class="code" href="gni__pub_8h.html#a897899941c015abbc9ba88acdc7e0ca8">gni_cq_handle_t</a>         <a class="code" href="structkgn__device.html#ab3ab404d12af522c68d41c3a8543d58c">gnd_snd_rdma_cqh</a>; <span class="comment">/* rdma send completion queue handle */</span>
<a name="l00531"></a><a class="code" href="structkgn__device.html#af28a4186dfab71a6da306f9b16d9b556">00531</a>         <a class="code" href="gni__pub_8h.html#a897899941c015abbc9ba88acdc7e0ca8">gni_cq_handle_t</a>         <a class="code" href="structkgn__device.html#af28a4186dfab71a6da306f9b16d9b556">gnd_snd_fma_cqh</a>;  <span class="comment">/* rdma send completion queue handle */</span>
<a name="l00532"></a><a class="code" href="structkgn__device.html#aaec8286fe758f7e065f3fa1add6d7378">00532</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structkgn__device.html#aaec8286fe758f7e065f3fa1add6d7378">gnd_cq_mutex</a>;     <span class="comment">/* CQ access serialization */</span>
<a name="l00533"></a><a class="code" href="structkgn__device.html#a1166a48e70b8f64c768135dc8cab3593">00533</a>         __u32                   <a class="code" href="structkgn__device.html#a1166a48e70b8f64c768135dc8cab3593">gnd_host_id</a>;      <span class="comment">/* ph. host ID of the NIC */</span>
<a name="l00534"></a><a class="code" href="structkgn__device.html#a121a69ed91d615c6eec65ca3605545eb">00534</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__device.html#a121a69ed91d615c6eec65ca3605545eb">gnd_id</a>;           <span class="comment">/* device id, also index in kgn_devices */</span>
<a name="l00535"></a><a class="code" href="structkgn__device.html#aa56a56f537d0714709413694effbfab7">00535</a>         __u32                   <a class="code" href="structkgn__device.html#aa56a56f537d0714709413694effbfab7">gnd_nid</a>;          <span class="comment">/* ph host ID translated to NID */</span>
<a name="l00536"></a><a class="code" href="structkgn__device.html#a7788b6db1547646b3bc81f8ee2b5670d">00536</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#a7788b6db1547646b3bc81f8ee2b5670d">gnd_fma_buffs</a>;    <span class="comment">/* list of FMA memory blocks */</span>
<a name="l00537"></a><a class="code" href="structkgn__device.html#a0b19dc0f01341e16cf1e9c2f2e6ac4c4">00537</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structkgn__device.html#a0b19dc0f01341e16cf1e9c2f2e6ac4c4">gnd_fmablk_mutex</a>; <span class="comment">/* mutex for FMA block memory alloc/free */</span>
<a name="l00538"></a><a class="code" href="structkgn__device.html#af33dc1d2c1cc543c27a3d9b57d1210e4">00538</a>         spinlock_t              <a class="code" href="structkgn__device.html#af33dc1d2c1cc543c27a3d9b57d1210e4">gnd_fmablk_lock</a>;  <span class="comment">/* lock for mbox alloc/release */</span>
<a name="l00539"></a><a class="code" href="structkgn__device.html#a9b60268478e8dc949207f034d97db73d">00539</a>         atomic_t                <a class="code" href="structkgn__device.html#a9b60268478e8dc949207f034d97db73d">gnd_nfmablk</a>;      <span class="comment">/* # of fmablk live */</span>
<a name="l00540"></a><a class="code" href="structkgn__device.html#a102b3ef6f66caff6c374de0eb5c62f24">00540</a>         atomic_t                <a class="code" href="structkgn__device.html#a102b3ef6f66caff6c374de0eb5c62f24">gnd_fmablk_vers</a>;  <span class="comment">/* gnd_fma_bufs stamp */</span>
<a name="l00541"></a><a class="code" href="structkgn__device.html#ae1423e189989c65799b66b96c0c5c5c6">00541</a>         atomic_t                <a class="code" href="structkgn__device.html#ae1423e189989c65799b66b96c0c5c5c6">gnd_neps</a>;         <span class="comment">/* # EP allocated to conns */</span>
<a name="l00542"></a><a class="code" href="structkgn__device.html#a3f4af6789b2485dbce6958d4ffb62fa9">00542</a>         <span class="keywordtype">short</span>                   <a class="code" href="structkgn__device.html#a3f4af6789b2485dbce6958d4ffb62fa9">gnd_ready</a>;        <span class="comment">/* stuff to do in scheduler thread */</span>
<a name="l00543"></a><a class="code" href="structkgn__device.html#aed0d77a0c58dd407fd836f44e668a5fc">00543</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#aed0d77a0c58dd407fd836f44e668a5fc">gnd_ready_conns</a>;  <span class="comment">/* connections ready to tx/rx */</span>
<a name="l00544"></a><a class="code" href="structkgn__device.html#a41e836b9f7b3ed88630fcb5ff5814fd1">00544</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#a41e836b9f7b3ed88630fcb5ff5814fd1">gnd_map_tx</a>;       <span class="comment">/* TX: needing buffer mapping */</span>
<a name="l00545"></a><a class="code" href="structkgn__device.html#a3c9da5461f9bdcf6448a07131655c4f9">00545</a>         wait_queue_head_t       <a class="code" href="structkgn__device.html#a3c9da5461f9bdcf6448a07131655c4f9">gnd_waitq</a>;        <span class="comment">/* scheduler wakeup */</span>
<a name="l00546"></a><a class="code" href="structkgn__device.html#ac7f9137bc610f0826cf6ec594b0e814e">00546</a>         spinlock_t              <a class="code" href="structkgn__device.html#ac7f9137bc610f0826cf6ec594b0e814e">gnd_lock</a>;         <span class="comment">/* serialise gnd_ready_conns */</span>
<a name="l00547"></a><a class="code" href="structkgn__device.html#a854522e01cd31936d7e4234eb8e2334b">00547</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#a854522e01cd31936d7e4234eb8e2334b">gnd_connd_peers</a>;  <span class="comment">/* peers waiting for a connection */</span>
<a name="l00548"></a><a class="code" href="structkgn__device.html#a3e71e6d50510eb599aad31f3716db365">00548</a>         spinlock_t              <a class="code" href="structkgn__device.html#a3e71e6d50510eb599aad31f3716db365">gnd_connd_lock</a>;   <span class="comment">/* serialise connd_peers */</span>
<a name="l00549"></a><a class="code" href="structkgn__device.html#a99e37e9ed35a0ebca7c2502eec1c6af6">00549</a>         wait_queue_head_t       <a class="code" href="structkgn__device.html#a99e37e9ed35a0ebca7c2502eec1c6af6">gnd_dgram_waitq</a>;  <span class="comment">/* dgram_mover thread wakeup */</span>
<a name="l00550"></a><a class="code" href="structkgn__device.html#a70a586e0f36291301a07ac83792ed99a">00550</a>         wait_queue_head_t       <a class="code" href="structkgn__device.html#a70a586e0f36291301a07ac83792ed99a">gnd_dgping_waitq</a>; <span class="comment">/* dgram thread ping-pong */</span>
<a name="l00551"></a><a class="code" href="structkgn__device.html#a2895476de1d6f2031ba8875219522b26">00551</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__device.html#a2895476de1d6f2031ba8875219522b26">gnd_dgram_ready</a>;  <span class="comment">/* dgrams need movin&apos; */</span>
<a name="l00552"></a><a class="code" href="structkgn__device.html#ad0a7f62b9d3c4fb47b0e8994aebe3757">00552</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       *<a class="code" href="structkgn__device.html#ad0a7f62b9d3c4fb47b0e8994aebe3757">gnd_dgrams</a>;       <span class="comment">/* nid hash to dgrams */</span>
<a name="l00553"></a><a class="code" href="structkgn__device.html#a51b814d02d69b4750eb35c78575bd03b">00553</a>         atomic_t                <a class="code" href="structkgn__device.html#a51b814d02d69b4750eb35c78575bd03b">gnd_ndgrams</a>;      <span class="comment">/* # dgrams extant */</span>
<a name="l00554"></a><a class="code" href="structkgn__device.html#a5660a310af80697abfbb9a2b33a8b6ff">00554</a>         atomic_t                <a class="code" href="structkgn__device.html#a5660a310af80697abfbb9a2b33a8b6ff">gnd_nwcdgrams</a>;    <span class="comment">/* # wildcard dgrams to post*/</span>
<a name="l00555"></a><a class="code" href="structkgn__device.html#ad320f09f5ee808eb87c3a9e4cdba7199">00555</a>         spinlock_t              <a class="code" href="structkgn__device.html#ad320f09f5ee808eb87c3a9e4cdba7199">gnd_dgram_lock</a>;   <span class="comment">/* serialize gnd_dgrams */</span>
<a name="l00556"></a><a class="code" href="structkgn__device.html#a2a855a8779094a526737431c2a55cb09">00556</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#a2a855a8779094a526737431c2a55cb09">gnd_map_list</a>;     <span class="comment">/* list of all mapped regions */</span>
<a name="l00557"></a><a class="code" href="structkgn__device.html#a5c4d5a79753e101e2c77a495ba0f786f">00557</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__device.html#a5c4d5a79753e101e2c77a495ba0f786f">gnd_map_version</a>;  <span class="comment">/* version flag for map list */</span>
<a name="l00558"></a><a class="code" href="structkgn__device.html#a6b2e0ef1ac8d540d8839863ee3bde12c">00558</a>         <span class="keyword">struct </span>timer_list       <a class="code" href="structkgn__device.html#a6b2e0ef1ac8d540d8839863ee3bde12c">gnd_map_timer</a>;    <span class="comment">/* wakey-wakey */</span>
<a name="l00559"></a><a class="code" href="structkgn__device.html#a6ea63598d69da2c028365e8c041cce37">00559</a>         atomic_t                <a class="code" href="structkgn__device.html#a6ea63598d69da2c028365e8c041cce37">gnd_n_mdd</a>;        <span class="comment">/* number of total MDD - fma, tx, etc */</span>
<a name="l00560"></a><a class="code" href="structkgn__device.html#a9182b880f57ab8df2151ce2d15c8554a">00560</a>         atomic_t                <a class="code" href="structkgn__device.html#a9182b880f57ab8df2151ce2d15c8554a">gnd_n_mdd_held</a>;   <span class="comment">/* number of total MDD held - fma, tx, etc */</span>
<a name="l00561"></a><a class="code" href="structkgn__device.html#a777e0e9f219c6c26929885b75f2e309b">00561</a>         atomic_t                <a class="code" href="structkgn__device.html#a777e0e9f219c6c26929885b75f2e309b">gnd_nq_map</a>;       <span class="comment">/* # queued waiting for mapping (MDD/GART) */</span>
<a name="l00562"></a><a class="code" href="structkgn__device.html#a292559c55248658c29bcc821160a20e1">00562</a>         atomic64_t              <a class="code" href="structkgn__device.html#a292559c55248658c29bcc821160a20e1">gnd_nbytes_map</a>;   <span class="comment">/* bytes of total GART maps - fma, tx, etc */</span>
<a name="l00563"></a><a class="code" href="structkgn__device.html#a5e5892c6b9761bc918a055a15ea3aea0">00563</a>         __u32                   <a class="code" href="structkgn__device.html#a5e5892c6b9761bc918a055a15ea3aea0">gnd_map_nphys</a>;    <span class="comment">/* # TX phys mappings */</span>
<a name="l00564"></a><a class="code" href="structkgn__device.html#ac00701ff38675c6fbe4260f15ce9fec9">00564</a>         __u32                   <a class="code" href="structkgn__device.html#ac00701ff38675c6fbe4260f15ce9fec9">gnd_map_physnop</a>;  <span class="comment">/* # TX phys pages mapped */</span>
<a name="l00565"></a><a class="code" href="structkgn__device.html#a74b885f8e428a180a67f943c23f4f767">00565</a>         __u32                   <a class="code" href="structkgn__device.html#a74b885f8e428a180a67f943c23f4f767">gnd_map_nvirt</a>;    <span class="comment">/* # TX virt mappings */</span>
<a name="l00566"></a><a class="code" href="structkgn__device.html#a18327d9cb54c715dead411554642a520">00566</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structkgn__device.html#a18327d9cb54c715dead411554642a520">gnd_map_virtnob</a>;  <span class="comment">/* # TX virt bytes mapped */</span>
<a name="l00567"></a><a class="code" href="structkgn__device.html#af2788fe76ff69c6372ff47c7b1859ae7">00567</a>         spinlock_t              <a class="code" href="structkgn__device.html#af2788fe76ff69c6372ff47c7b1859ae7">gnd_map_lock</a>;     <span class="comment">/* serialize gnd_map_XXX */</span>
<a name="l00568"></a><a class="code" href="structkgn__device.html#aad44d3a08a8ffd41fad18bb0f6ba887e">00568</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__device.html#aad44d3a08a8ffd41fad18bb0f6ba887e">gnd_next_map</a>;     <span class="comment">/* next mapping attempt in jiffies */</span>
<a name="l00569"></a><a class="code" href="structkgn__device.html#af60a10a44a37681feb1360a4fbed7ad4">00569</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__device.html#af60a10a44a37681feb1360a4fbed7ad4">gnd_map_attempt</a>;  <span class="comment">/* last map attempt # */</span>
<a name="l00570"></a><a class="code" href="structkgn__device.html#a498f5bf403e22899ff4a4d0bfe5c1e83">00570</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__device.html#a498f5bf403e22899ff4a4d0bfe5c1e83">gnd_last_map</a>;     <span class="comment">/* map timeout base */</span>
<a name="l00571"></a><a class="code" href="structkgn__device.html#a17277f4ffc0e102c1e7c047d674863a8">00571</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        <a class="code" href="structkgn__device.html#a17277f4ffc0e102c1e7c047d674863a8">gnd_rdmaq</a>;        <span class="comment">/* RDMA to be sent */</span>
<a name="l00572"></a><a class="code" href="structkgn__device.html#acdb784dffaeac7a4fc5376d626d42ea4">00572</a>         spinlock_t              <a class="code" href="structkgn__device.html#acdb784dffaeac7a4fc5376d626d42ea4">gnd_rdmaq_lock</a>;   <span class="comment">/* play nice with others */</span>
<a name="l00573"></a><a class="code" href="structkgn__device.html#a4b70d5f3510198faf5865cf973d04259">00573</a>         atomic64_t              <a class="code" href="structkgn__device.html#a4b70d5f3510198faf5865cf973d04259">gnd_rdmaq_bytes_out</a>; <span class="comment">/* # bytes authorized */</span>
<a name="l00574"></a><a class="code" href="structkgn__device.html#a3b72f9db82e9bd46683bf1ab6c8319ca">00574</a>         atomic64_t              <a class="code" href="structkgn__device.html#a3b72f9db82e9bd46683bf1ab6c8319ca">gnd_rdmaq_bytes_ok</a>;  <span class="comment">/* # bytes allowed until deadline */</span>
<a name="l00575"></a><a class="code" href="structkgn__device.html#ad44d6ee3e68234d6763180999cc143ff">00575</a>         atomic_t                <a class="code" href="structkgn__device.html#ad44d6ee3e68234d6763180999cc143ff">gnd_rdmaq_nstalls</a>;   <span class="comment">/* # stalls due to throttle */</span>
<a name="l00576"></a><a class="code" href="structkgn__device.html#a6296dcb88e2f96596e82b87dc2e0cc77">00576</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__device.html#a6296dcb88e2f96596e82b87dc2e0cc77">gnd_rdmaq_deadline</a>;  <span class="comment">/* when does bucket roll over ? */</span>
<a name="l00577"></a><a class="code" href="structkgn__device.html#a20db710e61d9095ab82c8588e7addc45">00577</a>         <span class="keyword">struct </span>timer_list       <a class="code" href="structkgn__device.html#a20db710e61d9095ab82c8588e7addc45">gnd_rdmaq_timer</a>;     <span class="comment">/* wakey-wakey */</span>
<a name="l00578"></a><a class="code" href="structkgn__device.html#ad41ced896155159ac01ae061acabd0c0">00578</a>         atomic_t                <a class="code" href="structkgn__device.html#ad41ced896155159ac01ae061acabd0c0">gnd_short_ntx</a>;      <span class="comment">/* TX stats: short messages */</span>
<a name="l00579"></a><a class="code" href="structkgn__device.html#a8c6d937e33a16e1c32f3c03245b6170a">00579</a>         atomic64_t              <a class="code" href="structkgn__device.html#a8c6d937e33a16e1c32f3c03245b6170a">gnd_short_txbytes</a>;  <span class="comment">/* TX stats: short message  payload*/</span>
<a name="l00580"></a><a class="code" href="structkgn__device.html#aaf22b16e0d7f515b0037e61c1fffe513">00580</a>         atomic_t                <a class="code" href="structkgn__device.html#aaf22b16e0d7f515b0037e61c1fffe513">gnd_rdma_ntx</a>;       <span class="comment">/* TX stats: rdma messages */</span>
<a name="l00581"></a><a class="code" href="structkgn__device.html#ab555d8d35e0f99139bd1934b5198df17">00581</a>         atomic64_t              <a class="code" href="structkgn__device.html#ab555d8d35e0f99139bd1934b5198df17">gnd_rdma_txbytes</a>;   <span class="comment">/* TX stats: rdma message payload*/</span>
<a name="l00582"></a><a class="code" href="structkgn__device.html#a3a09f18c098d195cb12de3e90a9db81f">00582</a>         atomic_t                <a class="code" href="structkgn__device.html#a3a09f18c098d195cb12de3e90a9db81f">gnd_short_nrx</a>;      <span class="comment">/* RX stats: short messages */</span>
<a name="l00583"></a><a class="code" href="structkgn__device.html#a0e11371c4aedfe626caf645b126e4a95">00583</a>         atomic64_t              <a class="code" href="structkgn__device.html#a0e11371c4aedfe626caf645b126e4a95">gnd_short_rxbytes</a>;  <span class="comment">/* RX stats: short message  payload*/</span>
<a name="l00584"></a><a class="code" href="structkgn__device.html#af49adca4dcd2d1827357e3f8f3846986">00584</a>         atomic_t                <a class="code" href="structkgn__device.html#af49adca4dcd2d1827357e3f8f3846986">gnd_rdma_nrx</a>;       <span class="comment">/* RX stats: rdma messages */</span>
<a name="l00585"></a><a class="code" href="structkgn__device.html#ad796465dbe34d18d9cf7758b3f08eed3">00585</a>         atomic64_t              <a class="code" href="structkgn__device.html#ad796465dbe34d18d9cf7758b3f08eed3">gnd_rdma_rxbytes</a>;   <span class="comment">/* RX stats: rdma message payload*/</span>
<a name="l00586"></a><a class="code" href="structkgn__device.html#a2629e6ac6fad957a9bfcc411e1d0f839">00586</a>         atomic_t                <a class="code" href="structkgn__device.html#a2629e6ac6fad957a9bfcc411e1d0f839">gnd_fast_try</a>;       <span class="comment">/* # of times fast send tried */</span>
<a name="l00587"></a><a class="code" href="structkgn__device.html#ae879f4e564478906c05676f6ab1eaec6">00587</a>         atomic_t                <a class="code" href="structkgn__device.html#ae879f4e564478906c05676f6ab1eaec6">gnd_fast_ok</a>;        <span class="comment">/* # of times fast send ok */</span>
<a name="l00588"></a><a class="code" href="structkgn__device.html#ad5f217e8ea436f247f9a659302d12feb">00588</a>         atomic_t                <a class="code" href="structkgn__device.html#ad5f217e8ea436f247f9a659302d12feb">gnd_fast_block</a>;     <span class="comment">/* # of times fast send blocked */</span>
<a name="l00589"></a><a class="code" href="structkgn__device.html#a9bc6ca50a530899f33126ff421aa26e4">00589</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__device.html#a9bc6ca50a530899f33126ff421aa26e4">gnd_mutex_delay</a>;
<a name="l00590"></a><a class="code" href="structkgn__device.html#a08ab74fe77f4fc67be880b400b5a82ce">00590</a>         atomic_t                <a class="code" href="structkgn__device.html#a08ab74fe77f4fc67be880b400b5a82ce">gnd_n_yield</a>;
<a name="l00591"></a><a class="code" href="structkgn__device.html#a23a2f2d571002ec5656390aa2664d28a">00591</a>         atomic_t                <a class="code" href="structkgn__device.html#a23a2f2d571002ec5656390aa2664d28a">gnd_n_schedule</a>;
<a name="l00592"></a><a class="code" href="structkgn__device.html#a8db21b5be388935ce9343d9579b01868">00592</a>         atomic_t                <a class="code" href="structkgn__device.html#a8db21b5be388935ce9343d9579b01868">gnd_canceled_dgrams</a>; <span class="comment">/* # of outstanding cancels */</span>
<a name="l00593"></a><a class="code" href="structkgn__device.html#abed4c6b0554d8b131f4314968a562235">00593</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structkgn__device.html#abed4c6b0554d8b131f4314968a562235">gnd_conn_sem</a>;       <span class="comment">/* serialize connection changes/data movement */</span>
<a name="l00594"></a><a class="code" href="structkgn__device.html#aff311c675a9761aab2e94c3d633b654b">00594</a>         <span class="keywordtype">void</span>                   *<a class="code" href="structkgn__device.html#aff311c675a9761aab2e94c3d633b654b">gnd_smdd_hold_buf</a>;  <span class="comment">/* buffer to keep smdd */</span>
<a name="l00595"></a><a class="code" href="structkgn__device.html#a8f975d5a075334b5592c559484386c53">00595</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>        <a class="code" href="structkgn__device.html#a8f975d5a075334b5592c559484386c53">gnd_smdd_hold_hndl</a>; <span class="comment">/* buffer mem handle */</span>
<a name="l00596"></a>00596 } <a class="code" href="structkgn__device.html">kgn_device_t</a>;
<a name="l00597"></a>00597 
<a name="l00598"></a><a class="code" href="structkgn__net.html">00598</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__net.html">kgn_net</a> {
<a name="l00599"></a><a class="code" href="structkgn__net.html#ae76fce881c9ebc7c543e29ecfb695825">00599</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__net.html#ae76fce881c9ebc7c543e29ecfb695825">gnn_list</a>;           <span class="comment">/* chain on kgni_data::kgn_nets */</span>
<a name="l00600"></a><a class="code" href="structkgn__net.html#a00bbcf50be777caee6eae29af7131a56">00600</a>         <a class="code" href="structkgn__device.html">kgn_device_t</a>       *<a class="code" href="structkgn__net.html#a00bbcf50be777caee6eae29af7131a56">gnn_dev</a>;            <span class="comment">/* device for this net */</span>
<a name="l00601"></a><a class="code" href="structkgn__net.html#ae1eebd7c97c508cd6215923dc828585b">00601</a>         <a class="code" href="structlnet__ni.html">lnet_ni_t</a>          *<a class="code" href="structkgn__net.html#ae1eebd7c97c508cd6215923dc828585b">gnn_ni</a>;             <span class="comment">/* network interface instance */</span>
<a name="l00602"></a><a class="code" href="structkgn__net.html#a1d58fab39ef96f081b36882f13470847">00602</a>         atomic_t            <a class="code" href="structkgn__net.html#a1d58fab39ef96f081b36882f13470847">gnn_refcount</a>;       <span class="comment">/* # current references */</span>
<a name="l00603"></a><a class="code" href="structkgn__net.html#a5338935d53737311f4f6037d6241f274">00603</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__net.html#a5338935d53737311f4f6037d6241f274">gnn_shutdown</a>;       <span class="comment">/* lnd_shutdown set */</span>
<a name="l00604"></a><a class="code" href="structkgn__net.html#a82c70a308b49e7574ce1dbc1ff48809a">00604</a>         __u16               <a class="code" href="structkgn__net.html#a82c70a308b49e7574ce1dbc1ff48809a">gnn_netnum</a>;         <span class="comment">/* stash netnum for quicker lookup */</span>
<a name="l00605"></a>00605 } <a class="code" href="structkgn__net.html">kgn_net_t</a>;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a>
<a name="l00608"></a><a class="code" href="gnilnd_8h.html#a40d05475323e2ca62a8a762f13751d3e">00608</a> <a class="code" href="gnilnd_8h.html#a40d05475323e2ca62a8a762f13751d3e">kgnilnd_lnd2lnetnid</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> ni_nid, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> kgnilnd_nid)
<a name="l00609"></a>00609 {
<a name="l00610"></a>00610         <span class="keywordflow">return</span> <a class="code" href="group__lnet__addr.html#gacab9a4d9fd8480776bef52653af50be3">LNET_MKNID</a>(<a class="code" href="group__lnet__addr.html#gabf536c21b8f5226eadf3a124a265ee3b">LNET_NIDNET</a>(ni_nid), <a class="code" href="group__lnet__addr.html#ga692b6a866269a35490f2e2803cc2e5d6" title="extract the address part of an lnet_nid_t">LNET_NIDADDR</a>(kgnilnd_nid));
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a>
<a name="l00614"></a><a class="code" href="gnilnd_8h.html#a3246b8ab76e4e68e608e839e8fb4712a">00614</a> <a class="code" href="gnilnd_8h.html#a3246b8ab76e4e68e608e839e8fb4712a">kgnilnd_lnet2lndnid</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> lnet_nid, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> kgnilnd_nid)
<a name="l00615"></a>00615 {
<a name="l00616"></a>00616         <span class="keywordflow">return</span> <a class="code" href="group__lnet__addr.html#gacab9a4d9fd8480776bef52653af50be3">LNET_MKNID</a>(<a class="code" href="group__lnet__addr.html#gabf536c21b8f5226eadf3a124a265ee3b">LNET_NIDNET</a>(kgnilnd_nid), <a class="code" href="group__lnet__addr.html#ga692b6a866269a35490f2e2803cc2e5d6" title="extract the address part of an lnet_nid_t">LNET_NIDADDR</a>(lnet_nid));
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 <span class="comment">/* The code for this is a bit ugly - but really  this just boils down to a __u64</span>
<a name="l00620"></a>00620 <span class="comment"> * that can have various parts accessed separately.</span>
<a name="l00621"></a>00621 <span class="comment"> *</span>
<a name="l00622"></a>00622 <span class="comment"> * The lower 32 bits is the ID</span>
<a name="l00623"></a>00623 <span class="comment"> * we give to SMSG for our completion event - it needs to be globally unique across</span>
<a name="l00624"></a>00624 <span class="comment"> * all TX currently in flight. We separate that out into the CQID so that we can</span>
<a name="l00625"></a>00625 <span class="comment"> * reference the connection (kgnilnd_cqid2conn_locked) and then the msg_id to pull</span>
<a name="l00626"></a>00626 <span class="comment"> * the actual TX out of the per-connection gnc_tx_ref_table.</span>
<a name="l00627"></a>00627 <span class="comment"> *</span>
<a name="l00628"></a>00628 <span class="comment"> * The upper 32 bits are just extra stuff we put into the cookie to ensure this TX</span>
<a name="l00629"></a>00629 <span class="comment"> * has a unique value we can send with RDMA setup messages to ensure the completion for</span>
<a name="l00630"></a>00630 <span class="comment"> * those is unique across the wire. The extra 32 bits are there to ensure that TX id</span>
<a name="l00631"></a>00631 <span class="comment"> * reuse is separated.</span>
<a name="l00632"></a>00632 <span class="comment"> */</span>
<a name="l00633"></a>00633 
<a name="l00634"></a><a class="code" href="structkgn__tx__ev__id.html">00634</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__tx__ev__id.html">kgn_tx_ev_id</a> {
<a name="l00635"></a>00635         <span class="keyword">union </span>{
<a name="l00636"></a><a class="code" href="structkgn__tx__ev__id.html#a5eb4fe412af60d98ec5b9da242d9d61c">00636</a>                 <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>             <a class="code" href="structkgn__tx__ev__id.html#a5eb4fe412af60d98ec5b9da242d9d61c">txe_cookie</a>;    <span class="comment">/* are you my mommy ? */</span>
<a name="l00637"></a>00637                 <span class="keyword">struct </span>{
<a name="l00638"></a><a class="code" href="structkgn__tx__ev__id.html#aa3a0ed9fc2ea1fd08750d76087dd6c56">00638</a>                         __u32     <a class="code" href="structkgn__tx__ev__id.html#aa3a0ed9fc2ea1fd08750d76087dd6c56">txe_chips</a>;     <span class="comment">/* extra bits to ensure ID unique across reuse */</span>
<a name="l00639"></a>00639                         <span class="keyword">union </span>{
<a name="l00640"></a><a class="code" href="structkgn__tx__ev__id.html#a2993667c61b758818de2f4a0290428f5">00640</a>                                 __u32     <a class="code" href="structkgn__tx__ev__id.html#a2993667c61b758818de2f4a0290428f5">txe_smsg_id</a>;      <span class="comment">/* ID for SMSG CQ event */</span>
<a name="l00641"></a>00641                                 <span class="comment">/* N.B: Never ever ever ever use the bit shifts directly,</span>
<a name="l00642"></a>00642 <span class="comment">                                 * you are just asking for a world of pain and are at the</span>
<a name="l00643"></a>00643 <span class="comment">                                 * mercy of the compiler layouts */</span>
<a name="l00644"></a>00644                                 <span class="keyword">struct </span>{
<a name="l00645"></a><a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">00645</a>                                         __u32     <a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a> :<a class="code" href="gnilnd_8h.html#a4009b8735200e65fab1c5e9419cb4cbf">GNILND_CQID_NBITS</a>;
<a name="l00646"></a><a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">00646</a>                                         __u32     <a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a> :<a class="code" href="gnilnd_8h.html#aa2e26212fdd3960442c188fcd05080f5">GNILND_MSGID_TX_NBITS</a>;
<a name="l00647"></a>00647                                 };
<a name="l00648"></a>00648                         };
<a name="l00649"></a>00649                 };
<a name="l00650"></a>00650         };
<a name="l00651"></a>00651 } <a class="code" href="structkgn__tx__ev__id.html">kgn_tx_ev_id_t</a>;
<a name="l00652"></a>00652 
<a name="l00653"></a><a class="code" href="structkgn__dgram.html">00653</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__dgram.html">kgn_dgram</a> {
<a name="l00654"></a><a class="code" href="structkgn__dgram.html#a088df57c9c535f57230c8362f2b562de">00654</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>     <a class="code" href="structkgn__dgram.html#a088df57c9c535f57230c8362f2b562de">gndg_list</a>;          <span class="comment">/* on hash dev::gnd_dgrams */</span>
<a name="l00655"></a><a class="code" href="structkgn__dgram.html#a8b0ce0b83a279a3190ab756895b9db0f">00655</a>         <a class="code" href="gnilnd_8h.html#a3d5cd3fca3d3f36c8be443bd43b1c1bb">kgn_dgram_state_t</a>    <a class="code" href="structkgn__dgram.html#a8b0ce0b83a279a3190ab756895b9db0f">gndg_state</a>;         <span class="comment">/* state of this dgram */</span>
<a name="l00656"></a><a class="code" href="structkgn__dgram.html#a9fbb47038f88c0f2a2b4063511c12d18">00656</a>         <a class="code" href="gnilnd_8h.html#af8b8123cb6d7bda204f2f338f545833a">kgn_dgram_type_t</a>     <a class="code" href="structkgn__dgram.html#a9fbb47038f88c0f2a2b4063511c12d18">gndg_type</a>;          <span class="comment">/* REQ, NAK, etc */</span>
<a name="l00657"></a><a class="code" href="structkgn__dgram.html#a923188981616f589919e893a153913a8">00657</a>         __u32                <a class="code" href="structkgn__dgram.html#a923188981616f589919e893a153913a8">gndg_magic</a>;         <span class="comment">/* saftey word */</span>
<a name="l00658"></a><a class="code" href="structkgn__dgram.html#a03e30c7c8e63140d708e72dbcc4e729c">00658</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>        <a class="code" href="structkgn__dgram.html#a03e30c7c8e63140d708e72dbcc4e729c">gndg_post_time</a>;     <span class="comment">/* time when we posted */</span>
<a name="l00659"></a><a class="code" href="structkgn__dgram.html#a68e98b8e2c9d359f78c2d9f72958983d">00659</a>         <span class="keyword">struct </span><a class="code" href="structkgn__conn.html">kgn_conn</a>     *<a class="code" href="structkgn__dgram.html#a68e98b8e2c9d359f78c2d9f72958983d">gndg_conn</a>;          <span class="comment">/* unbound conn with ep &amp; smsg */</span>
<a name="l00660"></a><a class="code" href="structkgn__dgram.html#aed6294ccecc533f26beb119d0b7e5e05">00660</a>         kgn_connreq_t        <a class="code" href="structkgn__dgram.html#aed6294ccecc533f26beb119d0b7e5e05">gndg_conn_out</a>;      <span class="comment">/* connreq from local node */</span>
<a name="l00661"></a><a class="code" href="structkgn__dgram.html#aa6bb912988e701441979a9812545abe5">00661</a>         kgn_connreq_t        <a class="code" href="structkgn__dgram.html#aa6bb912988e701441979a9812545abe5">gndg_conn_in</a>;       <span class="comment">/* connreq from remote node */</span>
<a name="l00662"></a>00662 } <a class="code" href="structkgn__dgram.html">kgn_dgram_t</a>;
<a name="l00663"></a>00663 
<a name="l00664"></a><a class="code" href="structkgn__tx.html">00664</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__tx.html">kgn_tx</a> {                         <span class="comment">/* message descriptor */</span>
<a name="l00665"></a><a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">00665</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>          <a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>;      <span class="comment">/* TX queues - peer, conn, rdma */</span>
<a name="l00666"></a><a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">00666</a>         <a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a>       <a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a>;<span class="comment">/* where in state machine is this TX ? */</span>
<a name="l00667"></a><a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">00667</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>         *<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a>;    <span class="comment">/* pointer to current list */</span>
<a name="l00668"></a><a class="code" href="structkgn__tx.html#a1c9c5c0c527ec8abb5b4b0692fa7d7c7">00668</a>         <span class="keyword">struct </span><a class="code" href="structkgn__conn.html">kgn_conn</a>          *<a class="code" href="structkgn__tx.html#a1c9c5c0c527ec8abb5b4b0692fa7d7c7">tx_conn</a>;      <span class="comment">/* owning conn */</span>
<a name="l00669"></a><a class="code" href="structkgn__tx.html#a16efcdb5d353e425244fda9846808fb4">00669</a>         <a class="code" href="structlnet__msg.html">lnet_msg_t</a>               *<a class="code" href="structkgn__tx.html#a16efcdb5d353e425244fda9846808fb4">tx_lntmsg</a>[2]; <span class="comment">/* ptl msgs to finalize on completion */</span>
<a name="l00670"></a><a class="code" href="structkgn__tx.html#ab4221343db994671e1c3622283cdcaab">00670</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>             <a class="code" href="structkgn__tx.html#ab4221343db994671e1c3622283cdcaab">tx_qtime</a>;     <span class="comment">/* when tx started to wait for something (jiffies) */</span>
<a name="l00671"></a><a class="code" href="structkgn__tx.html#a528f893ec294110cf4c021f75aadab4c">00671</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>             <a class="code" href="structkgn__tx.html#a528f893ec294110cf4c021f75aadab4c">tx_cred_wait</a>; <span class="comment">/* time spend waiting for smsg creds */</span>
<a name="l00672"></a><a class="code" href="structkgn__tx.html#a8679394beba2534418b20fb9c6639a2b">00672</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>          <a class="code" href="structkgn__tx.html#a8679394beba2534418b20fb9c6639a2b">tx_map_list</a>;  <span class="comment">/* list entry on device map list */</span>
<a name="l00673"></a><a class="code" href="structkgn__tx.html#a17bd8815b80774e47e167b59f719657d">00673</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structkgn__tx.html#a17bd8815b80774e47e167b59f719657d">tx_nob</a>;       <span class="comment">/* # bytes of payload */</span>
<a name="l00674"></a><a class="code" href="structkgn__tx.html#a24527a86d6fc15ab2de5f7e9be6c5ba6">00674</a>         <span class="keywordtype">int</span>                       <a class="code" href="structkgn__tx.html#a24527a86d6fc15ab2de5f7e9be6c5ba6">tx_buftype</a>;   <span class="comment">/* payload buffer type */</span>
<a name="l00675"></a><a class="code" href="structkgn__tx.html#ad3b92e2e56546dc209db133c5df8a08d">00675</a>         <span class="keywordtype">int</span>                       <a class="code" href="structkgn__tx.html#ad3b92e2e56546dc209db133c5df8a08d">tx_phys_npages</a>; <span class="comment">/* # physical pages */</span>
<a name="l00676"></a><a class="code" href="structkgn__tx.html#a70491cbe93de44d6e0502fe1cc3e9268">00676</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>          <a class="code" href="structkgn__tx.html#a70491cbe93de44d6e0502fe1cc3e9268">tx_map_key</a>;   <span class="comment">/* mapping key */</span>
<a name="l00677"></a><a class="code" href="structkgn__tx.html#a5fa0a52536cfe8d33feb4aae48052393">00677</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>          <a class="code" href="structkgn__tx.html#a5fa0a52536cfe8d33feb4aae48052393">tx_buffer_copy_map_key</a>;  <span class="comment">/* mapping key for page aligned copy */</span>
<a name="l00678"></a><a class="code" href="structkgn__tx.html#a9a9d5750201abd8f93bee894ae93d4aa">00678</a>         <a class="code" href="structgni__mem__segment.html">gni_mem_segment_t</a>        *<a class="code" href="structkgn__tx.html#a9a9d5750201abd8f93bee894ae93d4aa">tx_phys</a>;      <span class="comment">/* page descriptors */</span>
<a name="l00679"></a><a class="code" href="structkgn__tx.html#abe64ab18265d3c171cc5c2af2da25dfe">00679</a>         kgn_msg_t                 <a class="code" href="structkgn__tx.html#abe64ab18265d3c171cc5c2af2da25dfe">tx_msg</a>;       <span class="comment">/* FMA message buffer */</span>
<a name="l00680"></a><a class="code" href="structkgn__tx.html#a73bd845489b55504023e6baab680e1f3">00680</a>         <a class="code" href="structkgn__tx__ev__id.html">kgn_tx_ev_id_t</a>            <a class="code" href="structkgn__tx.html#a73bd845489b55504023e6baab680e1f3">tx_id</a>;        <span class="comment">/* who are you, who ? who ? */</span>
<a name="l00681"></a><a class="code" href="structkgn__tx.html#a742df48e2dbe155e9b97f9764a6d6461">00681</a>         __u8                      <a class="code" href="structkgn__tx.html#a742df48e2dbe155e9b97f9764a6d6461">tx_state</a>;     <span class="comment">/* state of the descriptor */</span>
<a name="l00682"></a><a class="code" href="structkgn__tx.html#ad3dd89c1cb4c969022840b93d97e1094">00682</a>         <span class="keywordtype">int</span>                       <a class="code" href="structkgn__tx.html#ad3dd89c1cb4c969022840b93d97e1094">tx_retrans</a>;   <span class="comment">/* retrans count of RDMA */</span>
<a name="l00683"></a><a class="code" href="structkgn__tx.html#aa9063381fbd317e44d3303682ac1ad5d">00683</a>         <span class="keywordtype">int</span>                       <a class="code" href="structkgn__tx.html#aa9063381fbd317e44d3303682ac1ad5d">tx_rc</a>;        <span class="comment">/* if we need to stash the ret code until we see completion */</span>
<a name="l00684"></a><a class="code" href="structkgn__tx.html#a36779b45d9618561e05d5851d427bd81">00684</a>         <span class="keywordtype">void</span>                     *<a class="code" href="structkgn__tx.html#a36779b45d9618561e05d5851d427bd81">tx_buffer</a>;    <span class="comment">/* source/sink buffer */</span>
<a name="l00685"></a><a class="code" href="structkgn__tx.html#a2b08f74a2173aa4a71248e7728c6a9b3">00685</a>         <span class="keywordtype">void</span>                     *<a class="code" href="structkgn__tx.html#a2b08f74a2173aa4a71248e7728c6a9b3">tx_buffer_copy</a>;   <span class="comment">/* pointer to page aligned buffer */</span>
<a name="l00686"></a><a class="code" href="structkgn__tx.html#a306031f0fb8d771b9e3329c1f85ea751">00686</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structkgn__tx.html#a306031f0fb8d771b9e3329c1f85ea751">tx_nob_rdma</a>;  <span class="comment">/* nob actually rdma */</span>
<a name="l00687"></a><a class="code" href="structkgn__tx.html#a46bfd670e2de3bc87944b6daae41ccb7">00687</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>              <a class="code" href="structkgn__tx.html#a46bfd670e2de3bc87944b6daae41ccb7">tx_offset</a>;    <span class="comment">/* offset of data into copied buffer */</span>
<a name="l00688"></a>00688         <span class="keyword">union </span>{
<a name="l00689"></a><a class="code" href="structkgn__tx.html#ac3f6eac8187414b3395d253e612d68a0">00689</a>                 <a class="code" href="structgni__post__descriptor.html">gni_post_descriptor_t</a>     <a class="code" href="structkgn__tx.html#ac3f6eac8187414b3395d253e612d68a0">tx_rdma_desc</a>; <span class="comment">/* rdma descriptor */</span>
<a name="l00690"></a><a class="code" href="structkgn__tx.html#a2b65501fd9823546dda959032d98f7ab">00690</a>                 <span class="keyword">struct </span>page              *<a class="code" href="structkgn__tx.html#a2b65501fd9823546dda959032d98f7ab">tx_imm_pages</a>[<a class="code" href="gnilnd_8h.html#ad34589b51f4e0a2ecc3839d906a5ff09">GNILND_MAX_IMMEDIATE</a>/PAGE_SIZE];  <span class="comment">/* page array to map kiov for immediate send */</span>
<a name="l00691"></a>00691         };
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">/* we only use one or the other */</span>
<a name="l00694"></a>00694         <span class="keyword">union </span>{
<a name="l00695"></a><a class="code" href="structkgn__tx.html#ae18f1d056fbede6d10f23003fde0525f">00695</a>                 kgn_putack_msg_t  <a class="code" href="structkgn__tx.html#ae18f1d056fbede6d10f23003fde0525f">tx_putinfo</a>;   <span class="comment">/* data for differed rdma &amp; re-try */</span>
<a name="l00696"></a><a class="code" href="structkgn__tx.html#a92d5478e5630cbe59212d7792ae91988">00696</a>                 kgn_get_msg_t     <a class="code" href="structkgn__tx.html#a92d5478e5630cbe59212d7792ae91988">tx_getinfo</a>;   <span class="comment">/* data for rdma re-try*/</span>
<a name="l00697"></a>00697         };
<a name="l00698"></a>00698 } <a class="code" href="structkgn__tx.html">kgn_tx_t</a>;
<a name="l00699"></a>00699 
<a name="l00700"></a><a class="code" href="structkgn__conn.html">00700</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__conn.html">kgn_conn</a> {
<a name="l00701"></a><a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">00701</a>         <a class="code" href="structkgn__device.html">kgn_device_t</a>       *<a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">gnc_device</a>;         <span class="comment">/* which device */</span>
<a name="l00702"></a><a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">00702</a>         <span class="keyword">struct </span><a class="code" href="structkgn__peer.html">kgn_peer</a>    *<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>;           <span class="comment">/* owning peer */</span>
<a name="l00703"></a><a class="code" href="structkgn__conn.html#a49489cec2f682f2cb57b9b29ce6c6235">00703</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a49489cec2f682f2cb57b9b29ce6c6235">gnc_magic</a>;          <span class="comment">/* magic value cleared before free */</span>
<a name="l00704"></a><a class="code" href="structkgn__conn.html#afa12a1f7e60ddf21d1bb24fbab3bd976">00704</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__conn.html#afa12a1f7e60ddf21d1bb24fbab3bd976">gnc_list</a>;           <span class="comment">/* stash on peer&apos;s conn list - or pending purgatory lists as we clear them */</span>
<a name="l00705"></a><a class="code" href="structkgn__conn.html#ae888fe73719c8307cadebc91e8e04325">00705</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__conn.html#ae888fe73719c8307cadebc91e8e04325">gnc_hashlist</a>;       <span class="comment">/* stash in connection hash table */</span>
<a name="l00706"></a><a class="code" href="structkgn__conn.html#a4cc26007e2eab20dbe809717bcc430c2">00706</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__conn.html#a4cc26007e2eab20dbe809717bcc430c2">gnc_schedlist</a>;      <span class="comment">/* schedule (on gnd_?_conns) for attention */</span>
<a name="l00707"></a><a class="code" href="structkgn__conn.html#a97da12c5a8df4839347877187dc9ba2d">00707</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__conn.html#a97da12c5a8df4839347877187dc9ba2d">gnc_fmaq</a>;           <span class="comment">/* txs queued for FMA */</span>
<a name="l00708"></a><a class="code" href="structkgn__conn.html#abf3c207b164f294b64a4c50ca5d909e8">00708</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__conn.html#abf3c207b164f294b64a4c50ca5d909e8">gnc_mdd_list</a>;       <span class="comment">/* hold list for MDD on hard conn reset */</span>
<a name="l00709"></a><a class="code" href="structkgn__conn.html#a04cf09f9875d5dd418f235adbe2a108a">00709</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>               <a class="code" href="structkgn__conn.html#a04cf09f9875d5dd418f235adbe2a108a">gnc_peerstamp</a>;      <span class="comment">/* peer&apos;s unique stamp */</span>
<a name="l00710"></a><a class="code" href="structkgn__conn.html#acd111c5bef285f78421eac8121b25f7a">00710</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>               <a class="code" href="structkgn__conn.html#acd111c5bef285f78421eac8121b25f7a">gnc_peer_connstamp</a>; <span class="comment">/* peer&apos;s unique connection stamp */</span>
<a name="l00711"></a><a class="code" href="structkgn__conn.html#a462ce2a0b3fc489c4822a43245dc27c2">00711</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>               <a class="code" href="structkgn__conn.html#a462ce2a0b3fc489c4822a43245dc27c2">gnc_my_connstamp</a>;   <span class="comment">/* my unique connection stamp */</span>
<a name="l00712"></a><a class="code" href="structkgn__conn.html#aa92c46596e20d2d0d508ee8ac9d7d221">00712</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aa92c46596e20d2d0d508ee8ac9d7d221">gnc_first_rx</a>;       <span class="comment">/* when I first received an FMA message (jiffies) */</span>
<a name="l00713"></a><a class="code" href="structkgn__conn.html#aa67e80660a876b283142eaed037524a3">00713</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aa67e80660a876b283142eaed037524a3">gnc_last_tx</a>;        <span class="comment">/* when I last sent an FMA message (jiffies) */</span>
<a name="l00714"></a><a class="code" href="structkgn__conn.html#aff3fc60b91fc8d1b8fee46d4e48476d0">00714</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aff3fc60b91fc8d1b8fee46d4e48476d0">gnc_last_rx</a>;        <span class="comment">/* when I last sent an FMA message (jiffies) */</span>
<a name="l00715"></a><a class="code" href="structkgn__conn.html#a0b0089293e0c37b4e0f82263ffab650a">00715</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#a0b0089293e0c37b4e0f82263ffab650a">gnc_last_tx_cq</a>;     <span class="comment">/* when I last received an FMA CQ (jiffies) */</span>
<a name="l00716"></a><a class="code" href="structkgn__conn.html#aae38163050ac7cb3e63b041a10ca27b7">00716</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aae38163050ac7cb3e63b041a10ca27b7">gnc_last_rx_cq</a>;     <span class="comment">/* when I last received an FMA CQ (jiffies) */</span>
<a name="l00717"></a><a class="code" href="structkgn__conn.html#abd9835989c1e2796977272114f313727">00717</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#abd9835989c1e2796977272114f313727">gnc_last_noop_want</a>; <span class="comment">/* time I wanted to send NOOP */</span>
<a name="l00718"></a><a class="code" href="structkgn__conn.html#aa8dec4e25d9fe85c9849dfc74b892de0">00718</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aa8dec4e25d9fe85c9849dfc74b892de0">gnc_last_noop_sent</a>; <span class="comment">/* time I did gni_smsg_send on NOOP */</span>
<a name="l00719"></a><a class="code" href="structkgn__conn.html#a50070cda75acedfad6a9634bae38f22e">00719</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#a50070cda75acedfad6a9634bae38f22e">gnc_last_noop_cq</a>;   <span class="comment">/* time when NOOP completed */</span>
<a name="l00720"></a><a class="code" href="structkgn__conn.html#aaa4b48e5f57762fa08c726e1928bb410">00720</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#aaa4b48e5f57762fa08c726e1928bb410">gnc_last_sched_ask</a>; <span class="comment">/* time when conn added to ready_conns */</span>
<a name="l00721"></a><a class="code" href="structkgn__conn.html#ac67faaf122c61c396ba048e2184c922b">00721</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__conn.html#ac67faaf122c61c396ba048e2184c922b">gnc_last_sched_do</a>;  <span class="comment">/* time when conn processed from ready_conns */</span>
<a name="l00722"></a><a class="code" href="structkgn__conn.html#a743dac44049a56e01d30eddb1137bdce">00722</a>         atomic_t            <a class="code" href="structkgn__conn.html#a743dac44049a56e01d30eddb1137bdce">gnc_reaper_noop</a>;    <span class="comment">/* # reaper triggered NOOP */</span>
<a name="l00723"></a><a class="code" href="structkgn__conn.html#a7944c4817d5f3c6fb8edd780c4a7033f">00723</a>         atomic_t            <a class="code" href="structkgn__conn.html#a7944c4817d5f3c6fb8edd780c4a7033f">gnc_sched_noop</a>;     <span class="comment">/* # sched triggered NOOP */</span>
<a name="l00724"></a><a class="code" href="structkgn__conn.html#a6f6f71a37891a4697ad9737eed11105e">00724</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="structkgn__conn.html#a6f6f71a37891a4697ad9737eed11105e">gnc_timeout</a>;        <span class="comment">/* infer peer death if no rx for this many seconds */</span>
<a name="l00725"></a><a class="code" href="structkgn__conn.html#a5ffc6d67b964fa813a576abcd3a7138f">00725</a>         __u32               <a class="code" href="structkgn__conn.html#a5ffc6d67b964fa813a576abcd3a7138f">gnc_cqid</a>;           <span class="comment">/* my completion callback id (non-unique) */</span>
<a name="l00726"></a><a class="code" href="structkgn__conn.html#a4f99a0ca77e46d3e454f0a02f9cbdf23">00726</a>         atomic_t            <a class="code" href="structkgn__conn.html#a4f99a0ca77e46d3e454f0a02f9cbdf23">gnc_tx_seq</a>;         <span class="comment">/* tx msg sequence number */</span>
<a name="l00727"></a><a class="code" href="structkgn__conn.html#a6871fe539bc3db6cc9f184e1ff358773">00727</a>         atomic_t            <a class="code" href="structkgn__conn.html#a6871fe539bc3db6cc9f184e1ff358773">gnc_rx_seq</a>;         <span class="comment">/* rx msg sequence number */</span>
<a name="l00728"></a><a class="code" href="structkgn__conn.html#ae1b1fdea4ad053d22ea177469103147a">00728</a>         <span class="keyword">struct </span>mutex        <a class="code" href="structkgn__conn.html#ae1b1fdea4ad053d22ea177469103147a">gnc_smsg_mutex</a>;     <span class="comment">/* tx smsg sequence serialization */</span>
<a name="l00729"></a><a class="code" href="structkgn__conn.html#a4b651864dbaa7034d996ebef461266be">00729</a>         <span class="keyword">struct </span>mutex        <a class="code" href="structkgn__conn.html#a4b651864dbaa7034d996ebef461266be">gnc_rdma_mutex</a>;     <span class="comment">/* tx rdma sequence serialization */</span>
<a name="l00730"></a><a class="code" href="structkgn__conn.html#aa3c8a94748f88c8f7060660a9b59fbc2">00730</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>               <a class="code" href="structkgn__conn.html#aa3c8a94748f88c8f7060660a9b59fbc2">gnc_tx_retrans</a>;     <span class="comment">/* # retrans on SMSG */</span>
<a name="l00731"></a><a class="code" href="structkgn__conn.html#adb4e74140f20d4e0a2b90fec8abeb9e5">00731</a>         atomic_t            <a class="code" href="structkgn__conn.html#adb4e74140f20d4e0a2b90fec8abeb9e5">gnc_nlive_fma</a>;      <span class="comment">/* # live FMA */</span>
<a name="l00732"></a><a class="code" href="structkgn__conn.html#ae31165083f6dd1d7ddafef16fe286d51">00732</a>         atomic_t            <a class="code" href="structkgn__conn.html#ae31165083f6dd1d7ddafef16fe286d51">gnc_nq_rdma</a>;        <span class="comment">/* # queued (on device) RDMA */</span>
<a name="l00733"></a><a class="code" href="structkgn__conn.html#af4ff5ebda7184a62eb2389490837e402">00733</a>         atomic_t            <a class="code" href="structkgn__conn.html#af4ff5ebda7184a62eb2389490837e402">gnc_nlive_rdma</a>;     <span class="comment">/* # live RDMA */</span>
<a name="l00734"></a><a class="code" href="structkgn__conn.html#ad5386d8bd103aaa705e5c07ebd76d621">00734</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__conn.html#ad5386d8bd103aaa705e5c07ebd76d621">gnc_close_sent</a>;     <span class="comment">/* I&apos;ve sent CLOSE */</span>
<a name="l00735"></a><a class="code" href="structkgn__conn.html#a99975b69e00c3700ef276afa4c7de333">00735</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__conn.html#a99975b69e00c3700ef276afa4c7de333">gnc_close_recvd</a>;    <span class="comment">/* I&apos;ve received CLOSE */</span>
<a name="l00736"></a><a class="code" href="structkgn__conn.html#a63b61baefcee066660583cbee9d603b6">00736</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__conn.html#a63b61baefcee066660583cbee9d603b6">gnc_in_purgatory</a>;   <span class="comment">/* in the sin bin */</span>
<a name="l00737"></a><a class="code" href="structkgn__conn.html#a91c453cb4b36a5989201c815077b00e2">00737</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a91c453cb4b36a5989201c815077b00e2">gnc_error</a>;          <span class="comment">/* errno when conn being closed due to error */</span>
<a name="l00738"></a><a class="code" href="structkgn__conn.html#a560ba7f635824958412c6bb08444b7e0">00738</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a560ba7f635824958412c6bb08444b7e0">gnc_peer_error</a>;     <span class="comment">/* errno peer sent us on CLOSE */</span>
<a name="l00739"></a><a class="code" href="structkgn__conn.html#a2399b04e7ded56efe4ae3ba8a431e60a">00739</a>         <a class="code" href="gnilnd_8h.html#a4f644ae1efecea5e3de0d0c2668ccd48">kgn_conn_state_t</a>    <a class="code" href="structkgn__conn.html#a2399b04e7ded56efe4ae3ba8a431e60a">gnc_state</a>;          <span class="comment">/* connection state */</span>
<a name="l00740"></a><a class="code" href="structkgn__conn.html#a28b800a8222df5746d444b4179a90305">00740</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a28b800a8222df5746d444b4179a90305">gnc_scheduled</a>;      <span class="comment">/* being attented to */</span>
<a name="l00741"></a><a class="code" href="structkgn__conn.html#a55a51e3ab2b7b71016aab0ad59af2f46">00741</a>         <span class="keywordtype">char</span>                <a class="code" href="structkgn__conn.html#a55a51e3ab2b7b71016aab0ad59af2f46">gnc_sched_caller</a>[30]; <span class="comment">/* what function last called schedule */</span>
<a name="l00742"></a><a class="code" href="structkgn__conn.html#a8a83acd874f02b6c32313105ebdcbcf7">00742</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a8a83acd874f02b6c32313105ebdcbcf7">gnc_sched_line</a>;     <span class="comment">/* what line # last called schedule */</span>
<a name="l00743"></a><a class="code" href="structkgn__conn.html#af45e30135dd0994437e1716a1548494c">00743</a>         atomic_t            <a class="code" href="structkgn__conn.html#af45e30135dd0994437e1716a1548494c">gnc_refcount</a>;       <span class="comment">/* # users */</span>
<a name="l00744"></a><a class="code" href="structkgn__conn.html#a54be7d975dac7f7bdc61a3e2cedbaa4f">00744</a>         spinlock_t          <a class="code" href="structkgn__conn.html#a54be7d975dac7f7bdc61a3e2cedbaa4f">gnc_list_lock</a>;      <span class="comment">/* serialise tx lists, max_rx_age */</span>
<a name="l00745"></a><a class="code" href="structkgn__conn.html#aed3554ed5385235fb822b8263c7a95b6">00745</a>         <a class="code" href="gni__pub_8h.html#aab946a6adff1c0aca74ef31caf5a4d8f">gni_ep_handle_t</a>     <a class="code" href="structkgn__conn.html#aed3554ed5385235fb822b8263c7a95b6">gnc_ephandle</a>;       <span class="comment">/* GNI endpoint */</span>
<a name="l00746"></a><a class="code" href="structkgn__conn.html#a44d0c57f674b15422b998eae0227b57a">00746</a>         <a class="code" href="structkgn__fma__memblock.html">kgn_fma_memblock_t</a> *<a class="code" href="structkgn__conn.html#a44d0c57f674b15422b998eae0227b57a">gnc_fma_blk</a>;        <span class="comment">/* pointer to fma block for our mailbox */</span>
<a name="l00747"></a><a class="code" href="structkgn__conn.html#a11d994c672cf491d3935a13e04448879">00747</a>         <a class="code" href="structgni__smsg__attr.html">gni_smsg_attr_t</a>     <a class="code" href="structkgn__conn.html#a11d994c672cf491d3935a13e04448879">gnpr_smsg_attr</a>;     <span class="comment">/* my short msg. attributes */</span>
<a name="l00748"></a><a class="code" href="structkgn__conn.html#a0e66b63db756ecf2775da8777280998e">00748</a>         spinlock_t          <a class="code" href="structkgn__conn.html#a0e66b63db756ecf2775da8777280998e">gnc_tx_lock</a>;        <span class="comment">/* protect tx alloc/free */</span>
<a name="l00749"></a><a class="code" href="structkgn__conn.html#a06d35cd59cba0ef0853b4da5421a68d2">00749</a>         __u8                <a class="code" href="structkgn__conn.html#a06d35cd59cba0ef0853b4da5421a68d2">gnc_tx_bits</a>[<a class="code" href="gnilnd_8h.html#a243d5a761e283c93b9725963fb48242f">GNILND_MAX_MSG_ID</a>/8]; <span class="comment">/* bit table for tx id */</span>
<a name="l00750"></a><a class="code" href="structkgn__conn.html#a6e1ac1ebf11a2005f185fc5ad7940aee">00750</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a6e1ac1ebf11a2005f185fc5ad7940aee">gnc_next_tx</a>;        <span class="comment">/* next tx to use in tx_ref_table */</span>
<a name="l00751"></a><a class="code" href="structkgn__conn.html#ab9c9ca702f9f03d52c9fe63d65f52e7f">00751</a>         <a class="code" href="structkgn__tx.html">kgn_tx_t</a>          **<a class="code" href="structkgn__conn.html#ab9c9ca702f9f03d52c9fe63d65f52e7f">gnc_tx_ref_table</a>;   <span class="comment">/* table of TX descriptors for this conn */</span>
<a name="l00752"></a><a class="code" href="structkgn__conn.html#a6170b6853d316b0f0c41a29eee87f10f">00752</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__conn.html#a6170b6853d316b0f0c41a29eee87f10f">gnc_mbox_id</a>;        <span class="comment">/* id of mbox in fma_blk                 */</span>
<a name="l00753"></a><a class="code" href="structkgn__conn.html#ab68ae90875f38b6e6913fdb188717cbf">00753</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__conn.html#ab68ae90875f38b6e6913fdb188717cbf">gnc_needs_detach</a>;   <span class="comment">/* flag set in detach_purgatory_all_locked so reaper will clear out purgatory */</span>
<a name="l00754"></a><a class="code" href="structkgn__conn.html#adbf4cb85687b1cbd76510488988661dc">00754</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__conn.html#adbf4cb85687b1cbd76510488988661dc">gnc_needs_closing</a>;  <span class="comment">/* flag set in del_conns when called from kgnilnd_del_peer_or_conn */</span>
<a name="l00755"></a><a class="code" href="structkgn__conn.html#a38e0353dd525f9ddaf8df5c848918da7">00755</a>         atomic_t            <a class="code" href="structkgn__conn.html#a38e0353dd525f9ddaf8df5c848918da7">gnc_tx_in_use</a>;      <span class="comment">/* # of tx&apos;s currently in use by another thread use kgnilnd_peer_conn_lock */</span>
<a name="l00756"></a><a class="code" href="structkgn__conn.html#a9272f5179eadb5ba1e2910958f2f376f">00756</a>         <a class="code" href="gnilnd_8h.html#af8b8123cb6d7bda204f2f338f545833a">kgn_dgram_type_t</a>    <a class="code" href="structkgn__conn.html#a9272f5179eadb5ba1e2910958f2f376f">gnc_dgram_type</a>;     <span class="comment">/* save dgram type used to establish this conn */</span>
<a name="l00757"></a><a class="code" href="structkgn__conn.html#a8bfc17b14a280ad9502fa37d6c3986dd">00757</a>         <span class="keywordtype">void</span>               *<a class="code" href="structkgn__conn.html#a8bfc17b14a280ad9502fa37d6c3986dd">remote_mbox_addr</a>;   <span class="comment">/* save remote mbox address */</span>
<a name="l00758"></a>00758 } <a class="code" href="structkgn__conn.html">kgn_conn_t</a>;
<a name="l00759"></a>00759 
<a name="l00760"></a><a class="code" href="structkgn__mdd__purgatory.html">00760</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__mdd__purgatory.html">kgn_mdd_purgatory</a> {
<a name="l00761"></a><a class="code" href="structkgn__mdd__purgatory.html#a256bb83ca12472043b463f258ece0247">00761</a>         <a class="code" href="structgni__mem__handle.html">gni_mem_handle_t</a>    <a class="code" href="structkgn__mdd__purgatory.html#a256bb83ca12472043b463f258ece0247">gmp_map_key</a>;        <span class="comment">/* mapping key */</span>
<a name="l00762"></a><a class="code" href="structkgn__mdd__purgatory.html#af81b06f4a00df9b9f2edb8d08460cb92">00762</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__mdd__purgatory.html#af81b06f4a00df9b9f2edb8d08460cb92">gmp_list</a>;           <span class="comment">/* entry point for purgatory list */</span>
<a name="l00763"></a>00763 } <a class="code" href="structkgn__mdd__purgatory.html">kgn_mdd_purgatory_t</a>;
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="structkgn__peer.html">00765</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__peer.html">kgn_peer</a> {
<a name="l00766"></a><a class="code" href="structkgn__peer.html#abc4cb936d909df02263e8f93b697d618">00766</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__peer.html#abc4cb936d909df02263e8f93b697d618">gnp_list</a>;                   <span class="comment">/* stash on global peer list */</span>
<a name="l00767"></a><a class="code" href="structkgn__peer.html#a48a5b4723170789c6b4b5ce13a045401">00767</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__peer.html#a48a5b4723170789c6b4b5ce13a045401">gnp_connd_list</a>;             <span class="comment">/* schedule on kgn_connd_peers */</span>
<a name="l00768"></a><a class="code" href="structkgn__peer.html#a75552d1bdc03d75d8daa6248fe289189">00768</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__peer.html#a75552d1bdc03d75d8daa6248fe289189">gnp_conns</a>;                  <span class="comment">/* all active connections and all conns in purgatory for the peer */</span>
<a name="l00769"></a><a class="code" href="structkgn__peer.html#a1f5c32f5e78499df976c91b72725a72d">00769</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>    <a class="code" href="structkgn__peer.html#a1f5c32f5e78499df976c91b72725a72d">gnp_tx_queue</a>;               <span class="comment">/* msgs waiting for a conn */</span>
<a name="l00770"></a><a class="code" href="structkgn__peer.html#ad2b6b6968e8e1712e1a4e328a8190a30">00770</a>         <a class="code" href="structkgn__net.html">kgn_net_t</a>          *<a class="code" href="structkgn__peer.html#ad2b6b6968e8e1712e1a4e328a8190a30">gnp_net</a>;                    <span class="comment">/* net instance for this peer */</span>
<a name="l00771"></a><a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">00771</a>         <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a>          <a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">gnp_nid</a>;                    <span class="comment">/* who&apos;s on the other end(s) */</span>
<a name="l00772"></a><a class="code" href="structkgn__peer.html#ad0f22773c5617718301d1a1ffaad36bc">00772</a>         atomic_t            <a class="code" href="structkgn__peer.html#ad0f22773c5617718301d1a1ffaad36bc">gnp_refcount</a>;               <span class="comment">/* # users */</span>
<a name="l00773"></a><a class="code" href="structkgn__peer.html#a6f87b8c909431c15ea90708e77c7710c">00773</a>         __u32               <a class="code" href="structkgn__peer.html#a6f87b8c909431c15ea90708e77c7710c">gnp_host_id</a>;                <span class="comment">/* ph. host ID of the peer */</span>
<a name="l00774"></a><a class="code" href="structkgn__peer.html#a392b83d4cbd981048932925448977659">00774</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__peer.html#a392b83d4cbd981048932925448977659">gnp_connecting</a>;             <span class="comment">/* connection forming */</span>
<a name="l00775"></a><a class="code" href="structkgn__peer.html#a893f92edc7c2b630c57773d0648b9936">00775</a>         <span class="keywordtype">short</span>               <a class="code" href="structkgn__peer.html#a893f92edc7c2b630c57773d0648b9936">gnp_pending_unlink</a>;         <span class="comment">/* need last conn close to trigger unlink */</span>
<a name="l00776"></a><a class="code" href="structkgn__peer.html#a53e6c37f4a705c6f8421c95bea9934cc">00776</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__peer.html#a53e6c37f4a705c6f8421c95bea9934cc">gnp_last_errno</a>;             <span class="comment">/* last error conn saw */</span>
<a name="l00777"></a><a class="code" href="structkgn__peer.html#a08e1b57d2799eedbf11f326022bb0624">00777</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#a08e1b57d2799eedbf11f326022bb0624">gnp_last_alive</a>;             <span class="comment">/* last time I had valid comms */</span>
<a name="l00778"></a><a class="code" href="structkgn__peer.html#a8f7fe56c0cb630e7264b19bb87cd9363">00778</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__peer.html#a8f7fe56c0cb630e7264b19bb87cd9363">gnp_last_dgram_errno</a>;       <span class="comment">/* last error dgrams saw */</span>
<a name="l00779"></a><a class="code" href="structkgn__peer.html#a34c954a249b92768db34dd8da301bc64">00779</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#a34c954a249b92768db34dd8da301bc64">gnp_last_dgram_time</a>;        <span class="comment">/* last time I tried to connect */</span>
<a name="l00780"></a><a class="code" href="structkgn__peer.html#a3f8f8a9d80491190013887e8611beeaf">00780</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#a3f8f8a9d80491190013887e8611beeaf">gnp_reconnect_time</a>;         <span class="comment">/* get_seconds() when reconnect OK */</span>
<a name="l00781"></a><a class="code" href="structkgn__peer.html#a49b120572b756d5c7a1aa6c23b7576a5">00781</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#a49b120572b756d5c7a1aa6c23b7576a5">gnp_reconnect_interval</a>;     <span class="comment">/* exponential backoff */</span>
<a name="l00782"></a><a class="code" href="structkgn__peer.html#a62ee1ed1c8044c72b7c100af5aa0f6cb">00782</a>         atomic_t            <a class="code" href="structkgn__peer.html#a62ee1ed1c8044c72b7c100af5aa0f6cb">gnp_dirty_eps</a>;              <span class="comment">/* # of old but yet to be destroyed EPs from conns */</span>
<a name="l00783"></a><a class="code" href="structkgn__peer.html#abc2766b07b95aa11882dc98a4d9ffc7c">00783</a>         <span class="keywordtype">int</span>                 <a class="code" href="structkgn__peer.html#abc2766b07b95aa11882dc98a4d9ffc7c">gnp_down</a>;                   <span class="comment">/* rca says peer down */</span>
<a name="l00784"></a><a class="code" href="structkgn__peer.html#a7c9bf3da4d9fda9cde47cbcc36009493">00784</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#a7c9bf3da4d9fda9cde47cbcc36009493">gnp_down_event_time</a>;        <span class="comment">/* time peer down */</span>
<a name="l00785"></a><a class="code" href="structkgn__peer.html#ab550c2d3b78e6824a99ae35529c9bc3a">00785</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       <a class="code" href="structkgn__peer.html#ab550c2d3b78e6824a99ae35529c9bc3a">gnp_up_event_time</a>;          <span class="comment">/* time peer back up */</span>
<a name="l00786"></a>00786 } <a class="code" href="structkgn__peer.html">kgn_peer_t</a>;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="comment">/* the kgn_rx_t is a struct for handing to LNET as the private pointer for things</span>
<a name="l00789"></a>00789 <span class="comment"> * like lnet_parse. It allows a single pointer to let us get enough</span>
<a name="l00790"></a>00790 <span class="comment"> * information in _recv and friends */</span>
<a name="l00791"></a><a class="code" href="structkgn__rx.html">00791</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__rx.html">kgn_rx</a> {
<a name="l00792"></a><a class="code" href="structkgn__rx.html#a4f843bcad829ae6a33244239c61700fb">00792</a>         <a class="code" href="structkgn__conn.html">kgn_conn_t</a>              *<a class="code" href="structkgn__rx.html#a4f843bcad829ae6a33244239c61700fb">grx_conn</a>;      <span class="comment">/* connection */</span>
<a name="l00793"></a><a class="code" href="structkgn__rx.html#a66717a7023dea8b6bc9be93f2a362886">00793</a>         kgn_msg_t               *<a class="code" href="structkgn__rx.html#a66717a7023dea8b6bc9be93f2a362886">grx_msg</a>;       <span class="comment">/* message */</span>
<a name="l00794"></a><a class="code" href="structkgn__rx.html#acd12894bed0a2038b93c159638d48618">00794</a>         <a class="code" href="structlnet__msg.html">lnet_msg_t</a>              *<a class="code" href="structkgn__rx.html#acd12894bed0a2038b93c159638d48618">grx_lntmsg</a>;    <span class="comment">/* lnet msg for this rx (eager only) */</span>
<a name="l00795"></a><a class="code" href="structkgn__rx.html#a0857646263da24a2bd5239659c33d494">00795</a>         <span class="keywordtype">int</span>                      <a class="code" href="structkgn__rx.html#a0857646263da24a2bd5239659c33d494">grx_eager</a>;     <span class="comment">/* if eager, we copied msg to somewhere */</span>
<a name="l00796"></a><a class="code" href="structkgn__rx.html#ae6c8b404e327e327f5c37409e1308ce7">00796</a>         <span class="keyword">struct </span>timespec          <a class="code" href="structkgn__rx.html#ae6c8b404e327e327f5c37409e1308ce7">grx_received</a>;  <span class="comment">/* time this msg received */</span>
<a name="l00797"></a>00797 } <a class="code" href="structkgn__rx.html">kgn_rx_t</a>;
<a name="l00798"></a>00798 
<a name="l00799"></a><a class="code" href="structkgn__data.html">00799</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structkgn__data.html">kgn_data</a> {
<a name="l00800"></a><a class="code" href="structkgn__data.html#afa2b4a4f175574130ceba906f618c3e4">00800</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#afa2b4a4f175574130ceba906f618c3e4">kgn_init</a>;             <span class="comment">/* initialisation state */</span>
<a name="l00801"></a><a class="code" href="structkgn__data.html#ab2514d2a3fe52303f185e3f4c7260eea">00801</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#ab2514d2a3fe52303f185e3f4c7260eea">kgn_shutdown</a>;         <span class="comment">/* shut down? */</span>
<a name="l00802"></a><a class="code" href="structkgn__data.html#a938fd18f7c3c46fd90971f983573871b">00802</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a938fd18f7c3c46fd90971f983573871b">kgn_wc_kill</a>;          <span class="comment">/* Should I repost the WC */</span>
<a name="l00803"></a><a class="code" href="structkgn__data.html#ad499d3150558aee153468244de43f28d">00803</a>         atomic_t                <a class="code" href="structkgn__data.html#ad499d3150558aee153468244de43f28d">kgn_nthreads</a>;         <span class="comment">/* # live threads */</span>
<a name="l00804"></a><a class="code" href="structkgn__data.html#a8a0d676973ac82f9de3fe956d620de07">00804</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a8a0d676973ac82f9de3fe956d620de07">kgn_nresets</a>;          <span class="comment">/* number of stack resets */</span>
<a name="l00805"></a><a class="code" href="structkgn__data.html#a0cd73387ab25e56d411e774a9b613447">00805</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a0cd73387ab25e56d411e774a9b613447">kgn_in_reset</a>;         <span class="comment">/* are we in stack reset ? */</span>
<a name="l00806"></a>00806 
<a name="l00807"></a><a class="code" href="structkgn__data.html#ab7472f4d5402ad46edced1795078e84b">00807</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structkgn__data.html#ab7472f4d5402ad46edced1795078e84b">kgn_nid_trans_private</a>;<span class="comment">/* private data for each of the HW nid2nic arenas */</span>
<a name="l00808"></a>00808 
<a name="l00809"></a><a class="code" href="structkgn__data.html#ac3fc1a4aec213d797477dd3383256159">00809</a>         <a class="code" href="structkgn__device.html">kgn_device_t</a>            <a class="code" href="structkgn__data.html#ac3fc1a4aec213d797477dd3383256159">kgn_devices</a>[<a class="code" href="gnilnd_8h.html#acbdf96a8f76cb7e1e97b1689751fa0f1">GNILND_MAXDEVS</a>]; <span class="comment">/* device/ptag/cq etc */</span>
<a name="l00810"></a><a class="code" href="structkgn__data.html#ac47258fa83e3ccbe03ccca36bf3f4d10">00810</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#ac47258fa83e3ccbe03ccca36bf3f4d10">kgn_ndevs</a>;            <span class="comment">/* # devices */</span>
<a name="l00811"></a>00811 
<a name="l00812"></a><a class="code" href="structkgn__data.html#a80603d081086d4cbbbdf97f04e574f03">00812</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a80603d081086d4cbbbdf97f04e574f03">kgn_ruhroh_running</a>;   <span class="comment">/* ruhroh thread is running */</span>
<a name="l00813"></a><a class="code" href="structkgn__data.html#addd5bfe7844849700b532e5930c95aca">00813</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#addd5bfe7844849700b532e5930c95aca">kgn_ruhroh_shutdown</a>;  <span class="comment">/* ruhroh thread should or is shut down */</span>
<a name="l00814"></a><a class="code" href="structkgn__data.html#a2fb289f2356150a3f60f26c214fd4c21">00814</a>         wait_queue_head_t       <a class="code" href="structkgn__data.html#a2fb289f2356150a3f60f26c214fd4c21">kgn_ruhroh_waitq</a>;     <span class="comment">/* ruhroh thread wakeup */</span>
<a name="l00815"></a><a class="code" href="structkgn__data.html#a9ad4269edf56049c1363d137e31a56c0">00815</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a9ad4269edf56049c1363d137e31a56c0">kgn_quiesce_trigger</a>;  <span class="comment">/* should we quiesce ? */</span>
<a name="l00816"></a><a class="code" href="structkgn__data.html#af240a5d5fa9450d3d6256c6ed722994e">00816</a>         atomic_t                <a class="code" href="structkgn__data.html#af240a5d5fa9450d3d6256c6ed722994e">kgn_nquiesce</a>;         <span class="comment">/* how many quiesced ? */</span>
<a name="l00817"></a><a class="code" href="structkgn__data.html#a4b506e6db131684b0c67d7df3e32fc70">00817</a>         <span class="keyword">struct </span>mutex            <a class="code" href="structkgn__data.html#a4b506e6db131684b0c67d7df3e32fc70">kgn_quiesce_mutex</a>;    <span class="comment">/* serialize ruhroh task, startup and shutdown */</span>
<a name="l00818"></a><a class="code" href="structkgn__data.html#aa542dae3629c58782625c9abad09f02b">00818</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#aa542dae3629c58782625c9abad09f02b">kgn_needs_reset</a>;      <span class="comment">/* we need stack reset */</span>
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         <span class="comment">/* These next three members implement communication from gnilnd into</span>
<a name="l00821"></a>00821 <span class="comment">         * the ruhroh task.  To ensure correct operation of the task, code that</span>
<a name="l00822"></a>00822 <span class="comment">         * writes into them must use memory barriers to ensure that the changes</span>
<a name="l00823"></a>00823 <span class="comment">         * are visible to other cores in the order the members appear below.  */</span>
<a name="l00824"></a><a class="code" href="structkgn__data.html#ad1f05c9319c008c7288a632764e9f64e">00824</a>         __u32                   <a class="code" href="structkgn__data.html#ad1f05c9319c008c7288a632764e9f64e">kgn_quiesce_secs</a>;     <span class="comment">/* seconds to bump timeouts */</span>
<a name="l00825"></a><a class="code" href="structkgn__data.html#afc05abb8a9f528b6aa6c472d0e1ccbbe">00825</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#afc05abb8a9f528b6aa6c472d0e1ccbbe">kgn_bump_info_rdy</a>;    <span class="comment">/* we have info needed to bump */</span>
<a name="l00826"></a><a class="code" href="structkgn__data.html#a98ef575cfe907c298949e18991a9e9a0">00826</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a98ef575cfe907c298949e18991a9e9a0">kgn_needs_pause</a>;      <span class="comment">/* we need to pause for network quiesce */</span>
<a name="l00827"></a>00827 
<a name="l00828"></a><a class="code" href="structkgn__data.html#afd25d10810a2728c040bd30588b1da0a">00828</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       *<a class="code" href="structkgn__data.html#afd25d10810a2728c040bd30588b1da0a">kgn_nets</a>;             <span class="comment">/* hashtable of kgn_net instances */</span>
<a name="l00829"></a><a class="code" href="structkgn__data.html#aefbf08af493c7d1a10f58b08aa960e5e">00829</a>         <span class="keyword">struct </span>rw_semaphore     <a class="code" href="structkgn__data.html#aefbf08af493c7d1a10f58b08aa960e5e">kgn_net_rw_sem</a>;       <span class="comment">/* serialise gnn_shutdown, kgn_nets */</span>
<a name="l00830"></a>00830 
<a name="l00831"></a><a class="code" href="structkgn__data.html#a8d148ea02cd62ecb9ebf62ffe7bd4e0e">00831</a>         rwlock_t                <a class="code" href="structkgn__data.html#a8d148ea02cd62ecb9ebf62ffe7bd4e0e">kgn_peer_conn_lock</a>;   <span class="comment">/* stabilize peer/conn ops */</span>
<a name="l00832"></a><a class="code" href="structkgn__data.html#a445e0b668ae1b8609c04cfc6595ee013">00832</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       *<a class="code" href="structkgn__data.html#a445e0b668ae1b8609c04cfc6595ee013">kgn_peers</a>;            <span class="comment">/* hash table of all my known peers */</span>
<a name="l00833"></a><a class="code" href="structkgn__data.html#a8b3e2f1578618637b5cddfd66f95a8b0">00833</a>         atomic_t                <a class="code" href="structkgn__data.html#a8b3e2f1578618637b5cddfd66f95a8b0">kgn_npeers</a>;           <span class="comment">/* # peers extant */</span>
<a name="l00834"></a><a class="code" href="structkgn__data.html#ab554a297aa558bf07b1e344be8bfccac">00834</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#ab554a297aa558bf07b1e344be8bfccac">kgn_peer_version</a>;     <span class="comment">/* version flag for peer tables */</span>
<a name="l00835"></a>00835 
<a name="l00836"></a><a class="code" href="structkgn__data.html#ad5dff9fd022453ff12617ddfc5c43e1c">00836</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>       *<a class="code" href="structkgn__data.html#ad5dff9fd022453ff12617ddfc5c43e1c">kgn_conns</a>;            <span class="comment">/* conns hashed by cqid */</span>
<a name="l00837"></a><a class="code" href="structkgn__data.html#a5f0cbfbb4909615bcb2abd7aa0f2197c">00837</a>         atomic_t                <a class="code" href="structkgn__data.html#a5f0cbfbb4909615bcb2abd7aa0f2197c">kgn_nconns</a>;           <span class="comment">/* # connections extant */</span>
<a name="l00838"></a><a class="code" href="structkgn__data.html#ae522c10eef9dc4bc81783f56a3e5d3a9">00838</a>         atomic_t                <a class="code" href="structkgn__data.html#ae522c10eef9dc4bc81783f56a3e5d3a9">kgn_neager_allocs</a>;    <span class="comment">/* # of eager allocations */</span>
<a name="l00839"></a><a class="code" href="structkgn__data.html#a7b7f4499ed006d7bf1025e8e3898a859">00839</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structkgn__data.html#a7b7f4499ed006d7bf1025e8e3898a859">kgn_peerstamp</a>;        <span class="comment">/* when I started up */</span>
<a name="l00840"></a><a class="code" href="structkgn__data.html#ae5f47917962297fa80c50fd239c888c0">00840</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structkgn__data.html#ae5f47917962297fa80c50fd239c888c0">kgn_connstamp</a>;        <span class="comment">/* conn stamp generator */</span>
<a name="l00841"></a><a class="code" href="structkgn__data.html#a4bc3ee6990c9f0654c1a2fef5afa02ca">00841</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a4bc3ee6990c9f0654c1a2fef5afa02ca">kgn_conn_version</a>;     <span class="comment">/* version flag for conn tables */</span>
<a name="l00842"></a><a class="code" href="structkgn__data.html#aba96ee64d0a428edc910fd15845eb6fe">00842</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#aba96ee64d0a428edc910fd15845eb6fe">kgn_next_cqid</a>;        <span class="comment">/* cqid generator */</span>
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="structkgn__data.html#a3156eb8b372cc5dbee2264554305a609">00844</a>         <span class="keywordtype">long</span>                    <a class="code" href="structkgn__data.html#a3156eb8b372cc5dbee2264554305a609">kgn_new_min_timeout</a>;  <span class="comment">/* minimum timeout on any new conn */</span>
<a name="l00845"></a><a class="code" href="structkgn__data.html#a22465c5c174bd62a43b23bf4598862fa">00845</a>         wait_queue_head_t       <a class="code" href="structkgn__data.html#a22465c5c174bd62a43b23bf4598862fa">kgn_reaper_waitq</a>;     <span class="comment">/* reaper sleeps here */</span>
<a name="l00846"></a><a class="code" href="structkgn__data.html#a5a3882c505e137ffe7452dc3ae80fe1d">00846</a>         spinlock_t              <a class="code" href="structkgn__data.html#a5a3882c505e137ffe7452dc3ae80fe1d">kgn_reaper_lock</a>;      <span class="comment">/* serialise */</span>
<a name="l00847"></a>00847 
<a name="l00848"></a><a class="code" href="structkgn__data.html#af78c2a69ccee736dc4974f8553c2e788">00848</a>         <span class="keyword">struct </span>kmem_cache      *<a class="code" href="structkgn__data.html#af78c2a69ccee736dc4974f8553c2e788">kgn_rx_cache</a>;         <span class="comment">/* rx descriptor space */</span>
<a name="l00849"></a><a class="code" href="structkgn__data.html#a52afacfd728dd007cdd4cab2fce076bc">00849</a>         <span class="keyword">struct </span>kmem_cache      *<a class="code" href="structkgn__data.html#a52afacfd728dd007cdd4cab2fce076bc">kgn_tx_cache</a>;         <span class="comment">/* tx descriptor memory */</span>
<a name="l00850"></a><a class="code" href="structkgn__data.html#aafc2463e4d1adfb76e8bd0eee729911f">00850</a>         <span class="keyword">struct </span>kmem_cache      *<a class="code" href="structkgn__data.html#aafc2463e4d1adfb76e8bd0eee729911f">kgn_tx_phys_cache</a>;    <span class="comment">/* tx phys descriptor memory */</span>
<a name="l00851"></a><a class="code" href="structkgn__data.html#ad71e9a4232ac9c8a93b9173f9422d935">00851</a>         atomic_t                <a class="code" href="structkgn__data.html#ad71e9a4232ac9c8a93b9173f9422d935">kgn_ntx</a>;              <span class="comment">/* # tx in use */</span>
<a name="l00852"></a><a class="code" href="structkgn__data.html#a2beaf3264a518539776fbe5b154c4b02">00852</a>         <span class="keyword">struct </span>kmem_cache      *<a class="code" href="structkgn__data.html#a2beaf3264a518539776fbe5b154c4b02">kgn_dgram_cache</a>;      <span class="comment">/* outgoing datagrams */</span>
<a name="l00853"></a>00853 
<a name="l00854"></a><a class="code" href="structkgn__data.html#a99e07d3b3ab224fc36aefd8e73917abc">00854</a>         <span class="keyword">struct </span>page          ***<a class="code" href="structkgn__data.html#a99e07d3b3ab224fc36aefd8e73917abc">kgn_cksum_map_pages</a>;  <span class="comment">/* page arrays for mapping pages on checksum */</span>
<a name="l00855"></a><a class="code" href="structkgn__data.html#a1f81d9278b8c9241c0c9c018ae8678c7">00855</a>         <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a>                   <a class="code" href="structkgn__data.html#a1f81d9278b8c9241c0c9c018ae8678c7">kgn_cksum_npages</a>;     <span class="comment">/* # pages alloc&apos;d for checksumming */</span>
<a name="l00856"></a><a class="code" href="structkgn__data.html#a1cf310d052088dc101d71ca067d86e97">00856</a>         atomic_t                <a class="code" href="structkgn__data.html#a1cf310d052088dc101d71ca067d86e97">kgn_nvmap_cksum</a>;      <span class="comment">/* # times we vmapped for checksums */</span>
<a name="l00857"></a><a class="code" href="structkgn__data.html#a64d02f7faa14d63ce9f58a37beed8cc3">00857</a>         atomic_t                <a class="code" href="structkgn__data.html#a64d02f7faa14d63ce9f58a37beed8cc3">kgn_nvmap_short</a>;      <span class="comment">/* # times we vmapped for short kiov */</span>
<a name="l00858"></a>00858 
<a name="l00859"></a><a class="code" href="structkgn__data.html#a6320275c6191c216626eca60c28c4c7b">00859</a>         atomic_t                <a class="code" href="structkgn__data.html#a6320275c6191c216626eca60c28c4c7b">kgn_nkmap_short</a>;      <span class="comment">/* # time we kmapped for a short kiov */</span>
<a name="l00860"></a><a class="code" href="structkgn__data.html#a49830a19b1be5446b7a9ca31b30dd6aa">00860</a>         <span class="keywordtype">long</span>                    <a class="code" href="structkgn__data.html#a49830a19b1be5446b7a9ca31b30dd6aa">kgn_rdmaq_override</a>;   <span class="comment">/* bytes per second override */</span>
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="structkgn__data.html#a70b14daf19f25d72b39733b8dd28c71a">00862</a>         <span class="keyword">struct </span>kmem_cache      *<a class="code" href="structkgn__data.html#a70b14daf19f25d72b39733b8dd28c71a">kgn_mbox_cache</a>;       <span class="comment">/* mailboxes from not-GART */</span>
<a name="l00863"></a>00863 
<a name="l00864"></a><a class="code" href="structkgn__data.html#aca931f2a78c5ed49ab236139c19a701b">00864</a>         atomic_t                <a class="code" href="structkgn__data.html#aca931f2a78c5ed49ab236139c19a701b">kgn_npending_unlink</a>;  <span class="comment">/* # of peers pending unlink */</span>
<a name="l00865"></a><a class="code" href="structkgn__data.html#a22857e37b1b9cf5c3fad97d41b4db1b3">00865</a>         atomic_t                <a class="code" href="structkgn__data.html#a22857e37b1b9cf5c3fad97d41b4db1b3">kgn_npending_conns</a>;   <span class="comment">/* # of conns with pending closes */</span>
<a name="l00866"></a><a class="code" href="structkgn__data.html#a16a4c8fb65ab92e08da24afaf06bb87b">00866</a>         atomic_t                <a class="code" href="structkgn__data.html#a16a4c8fb65ab92e08da24afaf06bb87b">kgn_npending_detach</a>;  <span class="comment">/* # of conns with a pending detach */</span>
<a name="l00867"></a><a class="code" href="structkgn__data.html#a3d4c449e8d48d6b5d16e7f27224412a4">00867</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__data.html#a3d4c449e8d48d6b5d16e7f27224412a4">kgn_last_scheduled</a>;   <span class="comment">/* last time schedule was called */</span>
<a name="l00868"></a><a class="code" href="structkgn__data.html#ae4a52f76c1d7858d22e47ac7c61726b8">00868</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__data.html#ae4a52f76c1d7858d22e47ac7c61726b8">kgn_last_condresched</a>; <span class="comment">/* last time cond_resched was called */</span>
<a name="l00869"></a><a class="code" href="structkgn__data.html#aacc4cf7c54f77d41f9f7aa9f0f3677db">00869</a>         atomic_t                <a class="code" href="structkgn__data.html#aacc4cf7c54f77d41f9f7aa9f0f3677db">kgn_rev_offset</a>;       <span class="comment">/* # of REV rdma w/misaligned offsets */</span>
<a name="l00870"></a><a class="code" href="structkgn__data.html#ac82e3b02aec752a74aa23eb430c11fa9">00870</a>         atomic_t                <a class="code" href="structkgn__data.html#ac82e3b02aec752a74aa23eb430c11fa9">kgn_rev_length</a>;       <span class="comment">/* # of REV rdma have misaligned len */</span>
<a name="l00871"></a><a class="code" href="structkgn__data.html#a7025e81b76af570e857e6524fcc15144">00871</a>         atomic_t                <a class="code" href="structkgn__data.html#a7025e81b76af570e857e6524fcc15144">kgn_rev_copy_buff</a>;    <span class="comment">/* # of REV rdma buffer copies */</span>
<a name="l00872"></a><a class="code" href="structkgn__data.html#a9b61845af1e338a34d38f046a565536c">00872</a>         <span class="keyword">struct </span>socket          *<a class="code" href="structkgn__data.html#a9b61845af1e338a34d38f046a565536c">kgn_sock</a>;             <span class="comment">/* for Apollo */</span>
<a name="l00873"></a><a class="code" href="structkgn__data.html#a0620d46bb7dfbbf65e0d99e0e3658845">00873</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>           <a class="code" href="structkgn__data.html#a0620d46bb7dfbbf65e0d99e0e3658845">free_pages_limit</a>;     <span class="comment">/* # of free pages reserve from fma block allocations */</span>
<a name="l00874"></a><a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">00874</a>         <span class="keywordtype">int</span>                     <a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>;  <span class="comment">/* kgni api mtx enable */</span>
<a name="l00875"></a>00875 } <a class="code" href="structkgn__data.html">kgn_data_t</a>;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="keyword">extern</span> <a class="code" href="structkgn__data.html">kgn_data_t</a>         <a class="code" href="gnilnd_8c.html#a31cd8f62818415359226aef3a488282b">kgnilnd_data</a>;
<a name="l00878"></a>00878 <span class="keyword">extern</span> <a class="code" href="structkgn__tunables.html">kgn_tunables_t</a>     <a class="code" href="gnilnd_8h.html#ab5530c1749f29302e919ef38ec1e66a0">kgnilnd_tunables</a>;
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a884f2a2748771c25aaa4c109fe18ebcd">kgnilnd_destroy_peer</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l00881"></a>00881 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a495181f059ae8370f49727cdef93db51">kgnilnd_destroy_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn);
<a name="l00882"></a>00882 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#adb279c641584e3b535d258104ebce43c">_kgnilnd_schedule_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *caller, <span class="keywordtype">int</span> line, <span class="keywordtype">int</span> refheld);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 <span class="comment">/* Macro wrapper for _kgnilnd_schedule_conn. This will store the function</span>
<a name="l00885"></a>00885 <span class="comment"> * and the line of the calling function to allow us to debug problematic</span>
<a name="l00886"></a>00886 <span class="comment"> * schedule calls in the future without the programmer having to mark</span>
<a name="l00887"></a>00887 <span class="comment"> * the location manually.</span>
<a name="l00888"></a>00888 <span class="comment"> */</span>
<a name="l00889"></a><a class="code" href="gnilnd_8h.html#a98071e0aa9dd72ea5209ae9ed060904a">00889</a> <span class="preprocessor">#define kgnilnd_schedule_conn(conn)                                     \</span>
<a name="l00890"></a>00890 <span class="preprocessor">        _kgnilnd_schedule_conn(conn, __func__, __LINE__, 0);</span>
<a name="l00891"></a>00891 <span class="preprocessor"></span>
<a name="l00892"></a><a class="code" href="gnilnd_8h.html#adb1e617be3bf09941d875c8e817dd725">00892</a> <span class="preprocessor">#define kgnilnd_schedule_conn_refheld(conn, refheld)                    \</span>
<a name="l00893"></a>00893 <span class="preprocessor">        _kgnilnd_schedule_conn(conn, __func__, __LINE__, refheld);</span>
<a name="l00894"></a>00894 <span class="preprocessor"></span>
<a name="l00895"></a>00895 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00896"></a><a class="code" href="gnilnd_8h.html#a32eb11fd0c34dc5d5d0ec8c6dbee146a">00896</a> <a class="code" href="gnilnd_8h.html#a32eb11fd0c34dc5d5d0ec8c6dbee146a">kgnilnd_thread_fini</a>(<span class="keywordtype">void</span>)
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898         atomic_dec(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#ad499d3150558aee153468244de43f28d">kgn_nthreads</a>);
<a name="l00899"></a>00899 }
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="gnilnd_8h.html#ab5b25c5f60649d14d55ff7e45aa4fbd5">00901</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ab5b25c5f60649d14d55ff7e45aa4fbd5">kgnilnd_gl_mutex_lock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00902"></a>00902 {
<a name="l00903"></a>00903         <span class="keywordflow">if</span> (kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00904"></a>00904                 mutex_lock(lock);
<a name="l00905"></a>00905 }
<a name="l00906"></a>00906 
<a name="l00907"></a><a class="code" href="gnilnd_8h.html#a835bfcd2013481a5b1e1671e59d07930">00907</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a835bfcd2013481a5b1e1671e59d07930">kgnilnd_gl_mutex_unlock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909         <span class="keywordflow">if</span> (kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00910"></a>00910                 mutex_unlock(lock);
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a><a class="code" href="gnilnd_8h.html#a208814857ded7578eafb13226525ccb1">00913</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a208814857ded7578eafb13226525ccb1">kgnilnd_conn_mutex_lock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00914"></a>00914 {
<a name="l00915"></a>00915         <span class="keywordflow">if</span> (!kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00916"></a>00916                 mutex_lock(lock);
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a><a class="code" href="gnilnd_8h.html#a45d74d2918278c144d27e4191a5b908d">00919</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a45d74d2918278c144d27e4191a5b908d">kgnilnd_conn_mutex_unlock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921         <span class="keywordflow">if</span> (!kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00922"></a>00922                 mutex_unlock(lock);
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925 <span class="comment">/* like mutex_trylock but with a jiffies spinner. This is to allow certain</span>
<a name="l00926"></a>00926 <span class="comment"> * parts of the code to avoid a scheduler trip when the mutex is held</span>
<a name="l00927"></a>00927 <span class="comment"> *</span>
<a name="l00928"></a>00928 <span class="comment"> * Try to acquire the mutex atomically for 1 jiffie. Returns 1 if the mutex</span>
<a name="l00929"></a>00929 <span class="comment"> * has been acquired successfully, and 0 on contention.</span>
<a name="l00930"></a>00930 <span class="comment"> *</span>
<a name="l00931"></a>00931 <span class="comment"> * NOTE: this function follows the spin_trylock() convention, so</span>
<a name="l00932"></a>00932 <span class="comment"> * it is negated to the down_trylock() return values! Be careful</span>
<a name="l00933"></a>00933 <span class="comment"> * about this when converting semaphore users to mutexes.</span>
<a name="l00934"></a>00934 <span class="comment"> *</span>
<a name="l00935"></a>00935 <span class="comment"> * This function must not be used in interrupt context. The</span>
<a name="l00936"></a>00936 <span class="comment"> * mutex must be released by the same task that acquired it.</span>
<a name="l00937"></a>00937 <span class="comment"> */</span>
<a name="l00938"></a><a class="code" href="gnilnd_8h.html#a785efc9de432e2754279f854b0db7a14">00938</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a785efc9de432e2754279f854b0db7a14">__kgnilnd_mutex_trylock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00939"></a>00939 {
<a name="l00940"></a>00940         <span class="keywordtype">int</span>             <a class="code" href="utils_2wirehdr_8c.html#a6baa346e44f4c2158d2be4f9b77b8203">ret</a>;
<a name="l00941"></a>00941         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   <a class="code" href="gnilnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         <a class="code" href="utils_2wirehdr_8c.html#a40eabc293a68a6404ce1de507c99c4b5">LASSERT</a>(!in_interrupt());
<a name="l00944"></a>00944 
<a name="l00945"></a>00945         <span class="keywordflow">for</span> (timeout = jiffies + 1; time_before(jiffies, timeout);) {
<a name="l00946"></a>00946 
<a name="l00947"></a>00947                 ret = mutex_trylock(lock);
<a name="l00948"></a>00948                 <span class="keywordflow">if</span> (ret)
<a name="l00949"></a>00949                         <span class="keywordflow">return</span> ret;
<a name="l00950"></a>00950         }
<a name="l00951"></a>00951         <span class="keywordflow">return</span> 0;
<a name="l00952"></a>00952 }
<a name="l00953"></a>00953 
<a name="l00954"></a><a class="code" href="gnilnd_8h.html#a26e68fc660a0dcbd35f71ee3167c3f25">00954</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a26e68fc660a0dcbd35f71ee3167c3f25">kgnilnd_mutex_trylock</a>(<span class="keyword">struct</span> mutex *lock)
<a name="l00955"></a>00955 {
<a name="l00956"></a>00956         <span class="keywordflow">if</span> (!kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00957"></a>00957                 <span class="keywordflow">return</span> 1;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959         <span class="keywordflow">return</span> <a class="code" href="gnilnd_8h.html#a785efc9de432e2754279f854b0db7a14">__kgnilnd_mutex_trylock</a>(lock);
<a name="l00960"></a>00960 }
<a name="l00961"></a>00961 
<a name="l00962"></a><a class="code" href="gnilnd_8h.html#ae0bfbdf86ac0bbd724452bf594637877">00962</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ae0bfbdf86ac0bbd724452bf594637877">kgnilnd_trylock</a>(<span class="keyword">struct</span> mutex *cq_lock,
<a name="l00963"></a>00963                                   <span class="keyword">struct</span> mutex *c_lock)
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a>)
<a name="l00966"></a>00966                 <span class="keywordflow">return</span> <a class="code" href="gnilnd_8h.html#a785efc9de432e2754279f854b0db7a14">__kgnilnd_mutex_trylock</a>(cq_lock);
<a name="l00967"></a>00967         <span class="keywordflow">else</span>
<a name="l00968"></a>00968                 <span class="keywordflow">return</span> <a class="code" href="gnilnd_8h.html#a785efc9de432e2754279f854b0db7a14">__kgnilnd_mutex_trylock</a>(c_lock);
<a name="l00969"></a>00969 }
<a name="l00970"></a>00970 
<a name="l00971"></a><a class="code" href="gnilnd_8h.html#a02f68a201db8ff28fd06b10065c9feae">00971</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *<a class="code" href="gnilnd_8h.html#a02f68a201db8ff28fd06b10065c9feae">kgnilnd_vzalloc</a>(<span class="keywordtype">int</span> <a class="code" href="lp__utils_8h.html#a439227feff9d7f55384e8780cfc2eb82">size</a>)
<a name="l00972"></a>00972 {
<a name="l00973"></a>00973         <span class="keywordtype">void</span> *<a class="code" href="utils_2wirehdr_8c.html#a6baa346e44f4c2158d2be4f9b77b8203">ret</a> = __vmalloc(size, __GFP_HIGHMEM | GFP_NOIO | __GFP_NORETRY | __GFP_ZERO,
<a name="l00974"></a>00974                               PAGE_KERNEL);
<a name="l00975"></a>00975         LIBCFS_ALLOC_POST(ret, size);
<a name="l00976"></a>00976         <span class="keywordflow">return</span> ret;
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979 <span class="comment">/* Copied from DEBUG_REQ in Lustre - the dance is needed to save stack space */</span>
<a name="l00980"></a>00980 
<a name="l00981"></a>00981 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l00982"></a>00982 <a class="code" href="gnilnd_8h.html#aaa4084af0c460179269e0931443bc540">_kgnilnd_debug_msg</a>(kgn_msg_t *<a class="code" href="multiop_8c.html#afbbc03d010d4a43d0dcc0ef3c41de5ec">msg</a>,
<a name="l00983"></a>00983                 <span class="keyword">struct</span> <a class="code" href="structlibcfs__debug__msg__data.html">libcfs_debug_msg_data</a> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ... );
<a name="l00984"></a>00984 
<a name="l00985"></a><a class="code" href="gnilnd_8h.html#ae6e46a6f294bd8b4755844c29a596ad2">00985</a> <span class="preprocessor">#define kgnilnd_debug_msg(msgdata, mask, cdls, msg, fmt, a...)                \</span>
<a name="l00986"></a>00986 <span class="preprocessor">do {                                                                          \</span>
<a name="l00987"></a>00987 <span class="preprocessor">        CFS_CHECK_STACK(msgdata, mask, cdls);                                 \</span>
<a name="l00988"></a>00988 <span class="preprocessor">                                                                              \</span>
<a name="l00989"></a>00989 <span class="preprocessor">        if (((mask) &amp; D_CANTMASK) != 0 ||                                     \</span>
<a name="l00990"></a>00990 <span class="preprocessor">            ((libcfs_debug &amp; (mask)) != 0 &amp;&amp;                                  \</span>
<a name="l00991"></a>00991 <span class="preprocessor">             (libcfs_subsystem_debug &amp; DEBUG_SUBSYSTEM) != 0))                \</span>
<a name="l00992"></a>00992 <span class="preprocessor">                _kgnilnd_debug_msg((msg), msgdata, fmt, ##a);                 \</span>
<a name="l00993"></a>00993 <span class="preprocessor">} while(0)</span>
<a name="l00994"></a>00994 <span class="preprocessor"></span>
<a name="l00995"></a>00995 <span class="comment">/* for most callers (level is a constant) this is resolved at compile time */</span>
<a name="l00996"></a><a class="code" href="gnilnd_8h.html#ab65fe6c54698c4f7d1c8f2f45e51c89e">00996</a> <span class="preprocessor">#define GNIDBG_MSG(level, msg, fmt, args...)                                  \</span>
<a name="l00997"></a>00997 <span class="preprocessor">do {                                                                          \</span>
<a name="l00998"></a>00998 <span class="preprocessor">        if ((level) &amp; (D_ERROR | D_WARNING | D_NETERROR)) {                   \</span>
<a name="l00999"></a>00999 <span class="preprocessor">            static struct cfs_debug_limit_state cdls;                         \</span>
<a name="l01000"></a>01000 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, &amp;cdls);                \</span>
<a name="l01001"></a>01001 <span class="preprocessor">            kgnilnd_debug_msg(&amp;msgdata, level, &amp;cdls, msg,                    \</span>
<a name="l01002"></a>01002 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; from %s &quot;, ## args,                   \</span>
<a name="l01003"></a>01003 <span class="preprocessor">                              libcfs_nid2str((msg)-&gt;gnm_srcnid));             \</span>
<a name="l01004"></a>01004 <span class="preprocessor">        } else {                                                              \</span>
<a name="l01005"></a>01005 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, NULL);                 \</span>
<a name="l01006"></a>01006 <span class="preprocessor">            kgnilnd_debug_msg(&amp;msgdata, level, NULL, msg,                     \</span>
<a name="l01007"></a>01007 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; from %s &quot;, ## args,                   \</span>
<a name="l01008"></a>01008 <span class="preprocessor">                              libcfs_nid2str((msg)-&gt;gnm_srcnid));             \</span>
<a name="l01009"></a>01009 <span class="preprocessor">        }                                                                     \</span>
<a name="l01010"></a>01010 <span class="preprocessor">} while (0)</span>
<a name="l01011"></a>01011 <span class="preprocessor"></span>
<a name="l01012"></a>01012 <span class="comment">/* user puts &apos;to nid&apos; in msg for us */</span>
<a name="l01013"></a><a class="code" href="gnilnd_8h.html#a418c50204c3fcf03caa4d0cb4b65a363">01013</a> <span class="preprocessor">#define GNIDBG_TOMSG(level, msg, fmt, args...)                                \</span>
<a name="l01014"></a>01014 <span class="preprocessor">do {                                                                          \</span>
<a name="l01015"></a>01015 <span class="preprocessor">        if ((level) &amp; (D_ERROR | D_WARNING | D_NETERROR)) {                   \</span>
<a name="l01016"></a>01016 <span class="preprocessor">            static struct cfs_debug_limit_state cdls;                         \</span>
<a name="l01017"></a>01017 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, &amp;cdls);                \</span>
<a name="l01018"></a>01018 <span class="preprocessor">            kgnilnd_debug_msg(&amp;msgdata, level, &amp;cdls, msg,                    \</span>
<a name="l01019"></a>01019 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; &quot;, ## args);                          \</span>
<a name="l01020"></a>01020 <span class="preprocessor">        } else {                                                              \</span>
<a name="l01021"></a>01021 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, NULL);                 \</span>
<a name="l01022"></a>01022 <span class="preprocessor">            kgnilnd_debug_msg(&amp;msgdata, level, NULL, msg,                     \</span>
<a name="l01023"></a>01023 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; &quot;, ## args);                          \</span>
<a name="l01024"></a>01024 <span class="preprocessor">        }                                                                     \</span>
<a name="l01025"></a>01025 <span class="preprocessor">} while (0)</span>
<a name="l01026"></a>01026 <span class="preprocessor"></span>
<a name="l01027"></a>01027 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l01028"></a>01028 <a class="code" href="gnilnd_8h.html#a952653dd314ae545471f2d1f3d5257e0">_kgnilnd_debug_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn,
<a name="l01029"></a>01029                 <span class="keyword">struct</span> <a class="code" href="structlibcfs__debug__msg__data.html">libcfs_debug_msg_data</a> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ... );
<a name="l01030"></a>01030 
<a name="l01031"></a><a class="code" href="gnilnd_8h.html#a798621f7941f418d53ef7f72bbc12794">01031</a> <span class="preprocessor">#define kgnilnd_debug_conn(msgdata, mask, cdls, conn, fmt, a...)               \</span>
<a name="l01032"></a>01032 <span class="preprocessor">do {                                                                           \</span>
<a name="l01033"></a>01033 <span class="preprocessor">        CFS_CHECK_STACK(msgdata, mask, cdls);                                  \</span>
<a name="l01034"></a>01034 <span class="preprocessor">                                                                               \</span>
<a name="l01035"></a>01035 <span class="preprocessor">        if (((mask) &amp; D_CANTMASK) != 0 ||                                      \</span>
<a name="l01036"></a>01036 <span class="preprocessor">            ((libcfs_debug &amp; (mask)) != 0 &amp;&amp;                                   \</span>
<a name="l01037"></a>01037 <span class="preprocessor">             (libcfs_subsystem_debug &amp; DEBUG_SUBSYSTEM) != 0))                 \</span>
<a name="l01038"></a>01038 <span class="preprocessor">                _kgnilnd_debug_conn((conn), msgdata, fmt, ##a);                \</span>
<a name="l01039"></a>01039 <span class="preprocessor">} while(0)</span>
<a name="l01040"></a>01040 <span class="preprocessor"></span>
<a name="l01041"></a>01041 <span class="comment">/* for most callers (level is a constant) this is resolved at compile time */</span>
<a name="l01042"></a><a class="code" href="gnilnd_8h.html#ad5a39c6a74efb11ebd48acf8a6b384a6">01042</a> <span class="preprocessor">#define GNIDBG_CONN(level, conn, fmt, args...)                                  \</span>
<a name="l01043"></a>01043 <span class="preprocessor">do {                                                                            \</span>
<a name="l01044"></a>01044 <span class="preprocessor">        if ((level) &amp; (D_ERROR | D_WARNING | D_NETERROR)) {                     \</span>
<a name="l01045"></a>01045 <span class="preprocessor">            static struct cfs_debug_limit_state cdls;                           \</span>
<a name="l01046"></a>01046 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, &amp;cdls);                  \</span>
<a name="l01047"></a>01047 <span class="preprocessor">            kgnilnd_debug_conn(&amp;msgdata, level, &amp;cdls, conn,                    \</span>
<a name="l01048"></a>01048 <span class="preprocessor">                               &quot;$$ &quot;fmt&quot; &quot;, ## args);                           \</span>
<a name="l01049"></a>01049 <span class="preprocessor">        } else {                                                                \</span>
<a name="l01050"></a>01050 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, NULL);                   \</span>
<a name="l01051"></a>01051 <span class="preprocessor">            kgnilnd_debug_conn(&amp;msgdata, level, NULL, conn,                     \</span>
<a name="l01052"></a>01052 <span class="preprocessor">                               &quot;$$ &quot;fmt&quot; &quot;, ## args);                           \</span>
<a name="l01053"></a>01053 <span class="preprocessor">        }                                                                       \</span>
<a name="l01054"></a>01054 <span class="preprocessor">} while (0)</span>
<a name="l01055"></a>01055 <span class="preprocessor"></span>
<a name="l01056"></a>01056 <span class="keyword">extern</span> <span class="keywordtype">void</span>
<a name="l01057"></a>01057 <a class="code" href="gnilnd_8h.html#a46537775a4001d8158365aef34551825">_kgnilnd_debug_tx</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx,
<a name="l01058"></a>01058                 <span class="keyword">struct</span> <a class="code" href="structlibcfs__debug__msg__data.html">libcfs_debug_msg_data</a> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ... );
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="gnilnd_8h.html#a2084fadeb5c0be9794306f8b5867b10d">01060</a> <span class="preprocessor">#define kgnilnd_debug_tx(msgdata, mask, cdls, tx, fmt, a...)                   \</span>
<a name="l01061"></a>01061 <span class="preprocessor">do {                                                                           \</span>
<a name="l01062"></a>01062 <span class="preprocessor">        CFS_CHECK_STACK(msgdata, mask, cdls);                                  \</span>
<a name="l01063"></a>01063 <span class="preprocessor">                                                                               \</span>
<a name="l01064"></a>01064 <span class="preprocessor">        if (((mask) &amp; D_CANTMASK) != 0 ||                                      \</span>
<a name="l01065"></a>01065 <span class="preprocessor">            ((libcfs_debug &amp; (mask)) != 0 &amp;&amp;                                   \</span>
<a name="l01066"></a>01066 <span class="preprocessor">             (libcfs_subsystem_debug &amp; DEBUG_SUBSYSTEM) != 0))                 \</span>
<a name="l01067"></a>01067 <span class="preprocessor">                _kgnilnd_debug_tx((tx), msgdata, fmt, ##a);                    \</span>
<a name="l01068"></a>01068 <span class="preprocessor">} while(0)</span>
<a name="l01069"></a>01069 <span class="preprocessor"></span>
<a name="l01070"></a>01070 <span class="comment">/* for most callers (level is a constant) this is resolved at compile time */</span>
<a name="l01071"></a><a class="code" href="gnilnd_8h.html#a33350f0c75ebff8179d61663e12f7b80">01071</a> <span class="preprocessor">#define GNIDBG_TX(level, tx, fmt, args...)                                      \</span>
<a name="l01072"></a>01072 <span class="preprocessor">do {                                                                            \</span>
<a name="l01073"></a>01073 <span class="preprocessor">        if ((level) &amp; (D_ERROR | D_WARNING | D_NETERROR)) {                     \</span>
<a name="l01074"></a>01074 <span class="preprocessor">            static struct cfs_debug_limit_state cdls;                           \</span>
<a name="l01075"></a>01075 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, &amp;cdls);                  \</span>
<a name="l01076"></a>01076 <span class="preprocessor">            kgnilnd_debug_tx(&amp;msgdata, level, &amp;cdls, tx,                        \</span>
<a name="l01077"></a>01077 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; &quot;, ## args);                            \</span>
<a name="l01078"></a>01078 <span class="preprocessor">        } else {                                                                \</span>
<a name="l01079"></a>01079 <span class="preprocessor">            LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, level, NULL);                   \</span>
<a name="l01080"></a>01080 <span class="preprocessor">            kgnilnd_debug_tx(&amp;msgdata, level, NULL, tx,                         \</span>
<a name="l01081"></a>01081 <span class="preprocessor">                              &quot;$$ &quot;fmt&quot; &quot;, ## args);                            \</span>
<a name="l01082"></a>01082 <span class="preprocessor">        }                                                                       \</span>
<a name="l01083"></a>01083 <span class="preprocessor">} while (0)</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span>
<a name="l01085"></a><a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">01085</a> <span class="preprocessor">#define GNITX_ASSERTF(tx, cond, fmt, a...)                                      \</span>
<a name="l01086"></a>01086 <span class="preprocessor">({                                                                              \</span>
<a name="l01087"></a>01087 <span class="preprocessor">        if (unlikely(!(cond))) {                                                \</span>
<a name="l01088"></a>01088 <span class="preprocessor">                GNIDBG_TX(D_EMERG, tx, &quot;ASSERTION(&quot; #cond &quot;) failed:&quot; fmt, a);  \</span>
<a name="l01089"></a>01089 <span class="preprocessor">                LBUG();                                                         \</span>
<a name="l01090"></a>01090 <span class="preprocessor">        }                                                                       \</span>
<a name="l01091"></a>01091 <span class="preprocessor">})</span>
<a name="l01092"></a>01092 <span class="preprocessor"></span>
<a name="l01093"></a><a class="code" href="gnilnd_8h.html#a284c09c2b68fabcf7d4733d9be41355b">01093</a> <span class="preprocessor">#define GNILND_IS_QUIESCED                                                      \</span>
<a name="l01094"></a>01094 <span class="preprocessor">        (atomic_read(&amp;kgnilnd_data.kgn_nquiesce) ==                             \</span>
<a name="l01095"></a>01095 <span class="preprocessor">                atomic_read(&amp;kgnilnd_data.kgn_nthreads))</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span>
<a name="l01097"></a><a class="code" href="gnilnd_8h.html#a5b810659a3cb6549fa91d9e67c8fd2e9">01097</a> <span class="preprocessor">#define KGNILND_SPIN_QUIESCE                                            \</span>
<a name="l01098"></a>01098 <span class="preprocessor">do {                                                                    \</span>
<a name="l01099"></a>01099 <span class="preprocessor">        </span><span class="comment">/* E.T phone home */</span>                                            \
<a name="l01100"></a>01100         atomic_inc(&amp;kgnilnd_data.kgn_nquiesce);                         \
<a name="l01101"></a>01101         CDEBUG(D_NET, &quot;Waiting for thread pause to be over...\n&quot;);      \
<a name="l01102"></a>01102         while (kgnilnd_data.kgn_quiesce_trigger) {                      \
<a name="l01103"></a>01103                 msleep_interruptible(MSEC_PER_SEC);                     \
<a name="l01104"></a>01104         }                                                               \
<a name="l01105"></a>01105         <span class="comment">/* Mom, my homework is done */</span>                                  \
<a name="l01106"></a>01106         CDEBUG(D_NET, &quot;Waking up from thread pause\n&quot;);                 \
<a name="l01107"></a>01107         atomic_dec(&amp;kgnilnd_data.kgn_nquiesce);                         \
<a name="l01108"></a>01108 } while(0)
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="comment">/* use macros for addref/decref to get the calling function name in the CDEBUG */</span>
<a name="l01111"></a>01111 <span class="preprocessor">#ifndef LIBCFS_DEBUG</span>
<a name="l01112"></a>01112 <span class="preprocessor"></span><span class="preprocessor">#error &quot;this code uses actions inside LASSERT for ref counting&quot;</span>
<a name="l01113"></a>01113 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01114"></a>01114 <span class="preprocessor"></span>
<a name="l01115"></a><a class="code" href="gnilnd_8h.html#a1b04527de6ab8a99d2a6934c1c379f95">01115</a> <span class="preprocessor">#define kgnilnd_admin_addref(atomic)                                     \</span>
<a name="l01116"></a>01116 <span class="preprocessor">do {                                                                            \</span>
<a name="l01117"></a>01117 <span class="preprocessor">        int     val = atomic_inc_return(&amp;atomic);                               \</span>
<a name="l01118"></a>01118 <span class="preprocessor">        LASSERTF(val &gt; 0,  #atomic &quot; refcount %d\n&quot;, val);                       \</span>
<a name="l01119"></a>01119 <span class="preprocessor">        CDEBUG(D_NETTRACE, #atomic &quot; refcount %d\n&quot;, val);                       \</span>
<a name="l01120"></a>01120 <span class="preprocessor">} while (0)</span>
<a name="l01121"></a>01121 <span class="preprocessor"></span>
<a name="l01122"></a><a class="code" href="gnilnd_8h.html#a16c74fde7b75f50db70c46ff5357d714">01122</a> <span class="preprocessor">#define kgnilnd_admin_decref(atomic)                                     \</span>
<a name="l01123"></a>01123 <span class="preprocessor">do {                                                                            \</span>
<a name="l01124"></a>01124 <span class="preprocessor">        int     val = atomic_dec_return(&amp;atomic);                               \</span>
<a name="l01125"></a>01125 <span class="preprocessor">        LASSERTF(val &gt;=0,  #atomic &quot; refcount %d\n&quot;, val);                        \</span>
<a name="l01126"></a>01126 <span class="preprocessor">        CDEBUG(D_NETTRACE, #atomic &quot; refcount %d\n&quot;, val);                       \</span>
<a name="l01127"></a>01127 <span class="preprocessor">}while (0)</span>
<a name="l01128"></a>01128 <span class="preprocessor"></span>
<a name="l01129"></a><a class="code" href="gnilnd_8h.html#ab92bd710788a62695afe5d8f70524f96">01129</a> <span class="preprocessor">#define kgnilnd_net_addref(net)                                                 \</span>
<a name="l01130"></a>01130 <span class="preprocessor">do {                                                                            \</span>
<a name="l01131"></a>01131 <span class="preprocessor">        int     val = atomic_inc_return(&amp;net-&gt;gnn_refcount);                    \</span>
<a name="l01132"></a>01132 <span class="preprocessor">        LASSERTF(val &gt; 1, &quot;net %p refcount %d\n&quot;, net, val);                    \</span>
<a name="l01133"></a>01133 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;net %p-&gt;%s++ (%d)\n&quot;, net,                          \</span>
<a name="l01134"></a>01134 <span class="preprocessor">                libcfs_nid2str(net-&gt;gnn_ni-&gt;ni_nid), val);                      \</span>
<a name="l01135"></a>01135 <span class="preprocessor">} while (0)</span>
<a name="l01136"></a>01136 <span class="preprocessor"></span>
<a name="l01137"></a><a class="code" href="gnilnd_8h.html#ac2fa4e6785ec2b30de4dc241a23ca24f">01137</a> <span class="preprocessor">#define kgnilnd_net_decref(net)                                                 \</span>
<a name="l01138"></a>01138 <span class="preprocessor">do {                                                                            \</span>
<a name="l01139"></a>01139 <span class="preprocessor">        int     val = atomic_dec_return(&amp;net-&gt;gnn_refcount);                    \</span>
<a name="l01140"></a>01140 <span class="preprocessor">        LASSERTF(val &gt;= 0, &quot;net %p refcount %d\n&quot;, net, val);                   \</span>
<a name="l01141"></a>01141 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;net %p-&gt;%s-- (%d)\n&quot;, net,                          \</span>
<a name="l01142"></a>01142 <span class="preprocessor">               libcfs_nid2str(net-&gt;gnn_ni-&gt;ni_nid), val);                       \</span>
<a name="l01143"></a>01143 <span class="preprocessor">} while (0)</span>
<a name="l01144"></a>01144 <span class="preprocessor"></span>
<a name="l01145"></a><a class="code" href="gnilnd_8h.html#ae39f61b875250339ce83d38a9067c201">01145</a> <span class="preprocessor">#define kgnilnd_peer_addref(peer)                                               \</span>
<a name="l01146"></a>01146 <span class="preprocessor">do {                                                                            \</span>
<a name="l01147"></a>01147 <span class="preprocessor">        int     val = atomic_inc_return(&amp;peer-&gt;gnp_refcount);                   \</span>
<a name="l01148"></a>01148 <span class="preprocessor">        LASSERTF(val &gt; 1, &quot;peer %p refcount %d\n&quot;, peer, val);                  \</span>
<a name="l01149"></a>01149 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;peer %p-&gt;%s++ (%d)\n&quot;, peer,                        \</span>
<a name="l01150"></a>01150 <span class="preprocessor">               libcfs_nid2str(peer-&gt;gnp_nid), val);                             \</span>
<a name="l01151"></a>01151 <span class="preprocessor">} while (0)</span>
<a name="l01152"></a>01152 <span class="preprocessor"></span>
<a name="l01153"></a><a class="code" href="gnilnd_8h.html#a808a7a2d5c4b4612643d06cee039117b">01153</a> <span class="preprocessor">#define kgnilnd_peer_decref(peer)                                               \</span>
<a name="l01154"></a>01154 <span class="preprocessor">do {                                                                            \</span>
<a name="l01155"></a>01155 <span class="preprocessor">        int     val = atomic_dec_return(&amp;peer-&gt;gnp_refcount);                   \</span>
<a name="l01156"></a>01156 <span class="preprocessor">        LASSERTF(val &gt;= 0, &quot;peer %p refcount %d\n&quot;, peer, val);                 \</span>
<a name="l01157"></a>01157 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;peer %p-&gt;%s--(%d)\n&quot;, peer,                         \</span>
<a name="l01158"></a>01158 <span class="preprocessor">               libcfs_nid2str(peer-&gt;gnp_nid), val);                             \</span>
<a name="l01159"></a>01159 <span class="preprocessor">        if (val == 0)                                                           \</span>
<a name="l01160"></a>01160 <span class="preprocessor">                kgnilnd_destroy_peer(peer);                                     \</span>
<a name="l01161"></a>01161 <span class="preprocessor">} while(0)</span>
<a name="l01162"></a>01162 <span class="preprocessor"></span>
<a name="l01163"></a><a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">01163</a> <span class="preprocessor">#define kgnilnd_conn_addref(conn)                                       \</span>
<a name="l01164"></a>01164 <span class="preprocessor">do {                                                                    \</span>
<a name="l01165"></a>01165 <span class="preprocessor">        int     val;                                                    \</span>
<a name="l01166"></a>01166 <span class="preprocessor">                                                                        \</span>
<a name="l01167"></a>01167 <span class="preprocessor">        smp_wmb();                                                      \</span>
<a name="l01168"></a>01168 <span class="preprocessor">        val = atomic_inc_return(&amp;conn-&gt;gnc_refcount);                   \</span>
<a name="l01169"></a>01169 <span class="preprocessor">        LASSERTF(val &gt; 1 &amp;&amp; conn-&gt;gnc_magic == GNILND_CONN_MAGIC,       \</span>
<a name="l01170"></a>01170 <span class="preprocessor">                &quot;conn %p refc %d to %s\n&quot;,                              \</span>
<a name="l01171"></a>01171 <span class="preprocessor">                conn, val,                                              \</span>
<a name="l01172"></a>01172 <span class="preprocessor">                conn-&gt;gnc_peer                                          \</span>
<a name="l01173"></a>01173 <span class="preprocessor">                        ? libcfs_nid2str(conn-&gt;gnc_peer-&gt;gnp_nid)       \</span>
<a name="l01174"></a>01174 <span class="preprocessor">                        : &quot;&lt;?&gt;&quot;);                                       \</span>
<a name="l01175"></a>01175 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;conn %p-&gt;%s++ (%d)\n&quot;, conn,                \</span>
<a name="l01176"></a>01176 <span class="preprocessor">                conn-&gt;gnc_peer                                          \</span>
<a name="l01177"></a>01177 <span class="preprocessor">                        ? libcfs_nid2str(conn-&gt;gnc_peer-&gt;gnp_nid)       \</span>
<a name="l01178"></a>01178 <span class="preprocessor">                        : &quot;&lt;?&gt;&quot;,                                        \</span>
<a name="l01179"></a>01179 <span class="preprocessor">                val);                                                   \</span>
<a name="l01180"></a>01180 <span class="preprocessor">} while (0)</span>
<a name="l01181"></a>01181 <span class="preprocessor"></span>
<a name="l01182"></a>01182 <span class="comment">/* we hijack conn_decref &amp;&amp; gnc_refcount = 1 to allow us to push the conn</span>
<a name="l01183"></a>01183 <span class="comment"> * through the scheduler thread to get the EP destroyed. This avoids some</span>
<a name="l01184"></a>01184 <span class="comment"> * messy semaphore business and allows us to reuse the connd_list and existing</span>
<a name="l01185"></a>01185 <span class="comment"> * linkage and avoid creating extra lists just for destroying EPs */</span>
<a name="l01186"></a>01186 
<a name="l01187"></a>01187 <span class="comment">/* Safety Disclaimer:</span>
<a name="l01188"></a>01188 <span class="comment"> * Q: If we decrement the refcount and then check it again, is it possible that</span>
<a name="l01189"></a>01189 <span class="comment"> *    another caller could have passed through this macro concurrently? If so,</span>
<a name="l01190"></a>01190 <span class="comment"> *    then it is possible that both will attempt to call kgnilnd_destroy_conn().</span>
<a name="l01191"></a>01191 <span class="comment"> *</span>
<a name="l01192"></a>01192 <span class="comment"> * A: Yes, entirely possible in most cases, but we can&apos;t get concurrent users</span>
<a name="l01193"></a>01193 <span class="comment"> * once we are refcount &lt;= 2. It hinges around gnc_state and membership of</span>
<a name="l01194"></a>01194 <span class="comment"> * gnc_hashlist. There are two ways to find a connection - either ask for</span>
<a name="l01195"></a>01195 <span class="comment"> * it from the peer, kgnilnd_find_conn_locked(peer) or from the CQ id,</span>
<a name="l01196"></a>01196 <span class="comment"> * kgnilnd_cqid2conn_locked(id). While a conn is live, we&apos;ll have at least</span>
<a name="l01197"></a>01197 <span class="comment"> * 4 refcounts</span>
<a name="l01198"></a>01198 <span class="comment"> *</span>
<a name="l01199"></a>01199 <span class="comment"> * - #1 from create (kgnilnd_create_conn)</span>
<a name="l01200"></a>01200 <span class="comment"> * - #2 for EP (kgnilnd_create_conn)</span>
<a name="l01201"></a>01201 <span class="comment"> * - #3 - living on peer (gnc_list, kgnilnd_finish_connect)</span>
<a name="l01202"></a>01202 <span class="comment"> * - #4 living in global hash (gnc_hashlist, kgnilnd_finish_connect).</span>
<a name="l01203"></a>01203 <span class="comment"> *</span>
<a name="l01204"></a>01204 <span class="comment"> * Actually, only 3 live, as at the end of kgnilnd_finish_connect, we drop:</span>
<a name="l01205"></a>01205 <span class="comment"> * - #1 - the ref the dgram inherited from kgnilnd_create_conn.</span>
<a name="l01206"></a>01206 <span class="comment"> *</span>
<a name="l01207"></a>01207 <span class="comment"> * There could be more from TX descriptors during the lifetime of a live</span>
<a name="l01208"></a>01208 <span class="comment"> * conn.</span>
<a name="l01209"></a>01209 <span class="comment"> *</span>
<a name="l01210"></a>01210 <span class="comment"> * If we nuke the conn before finish_connect, we won&apos;t have parallel paths</span>
<a name="l01211"></a>01211 <span class="comment"> * because nobody besides the dgram handler for the single outstanding</span>
<a name="l01212"></a>01212 <span class="comment"> * dgram can find the connection as it isn&apos;t in any searchable tables yet.</span>
<a name="l01213"></a>01213 <span class="comment"> *</span>
<a name="l01214"></a>01214 <span class="comment"> * This leaves connection close, we&apos;ll drop 2 refs (#4 and #3) but only</span>
<a name="l01215"></a>01215 <span class="comment"> * after calling kgnilnd_schedule_conn, which would add a new ref (#5). At</span>
<a name="l01216"></a>01216 <span class="comment"> * this point gnc_refcount=2 (#2, #5). We have a &apos;maybe&apos; send of the CLOSE</span>
<a name="l01217"></a>01217 <span class="comment"> * now on the next scheduler loop, this could be #6 (schedule_conn again)</span>
<a name="l01218"></a>01218 <span class="comment"> * and #7 (TX on gnc_fmaq). Both would be cleared quickly as that TX is</span>
<a name="l01219"></a>01219 <span class="comment"> * sent. Now the gnc_state == CLOSED, so we hit</span>
<a name="l01220"></a>01220 <span class="comment"> * kgnilnd_complete_closed_conn. At this point, nobody can &apos;find&apos; this conn</span>
<a name="l01221"></a>01221 <span class="comment"> * - we&apos;ve nuked them from the peer and CQ id tables, so we own them and</span>
<a name="l01222"></a>01222 <span class="comment"> * are guaranteed serial access - hence the complete lack of conn list</span>
<a name="l01223"></a>01223 <span class="comment"> * locking in kgnilnd_complete_closed_conn. We are free then to mark the</span>
<a name="l01224"></a>01224 <span class="comment"> * conn DESTROY_EP (add #6 for schedule_conn), then lose #5 in</span>
<a name="l01225"></a>01225 <span class="comment"> * kgnilnd_process_conns. Then the next scheduler loop would call</span>
<a name="l01226"></a>01226 <span class="comment"> * kgnilnd_destroy_conn_ep (drop #2 for EP) and lose #6 (refcount=0) in</span>
<a name="l01227"></a>01227 <span class="comment"> * kgnilnd_process_conns.</span>
<a name="l01228"></a>01228 <span class="comment"> *</span>
<a name="l01229"></a>01229 <span class="comment"> * Clearly, we are totally safe. Clearly.</span>
<a name="l01230"></a>01230 <span class="comment"> */</span>
<a name="l01231"></a>01231 
<a name="l01232"></a><a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">01232</a> <span class="preprocessor">#define kgnilnd_conn_decref(conn)                                       \</span>
<a name="l01233"></a>01233 <span class="preprocessor">do {                                                                    \</span>
<a name="l01234"></a>01234 <span class="preprocessor">        int     val;                                                    \</span>
<a name="l01235"></a>01235 <span class="preprocessor">                                                                        \</span>
<a name="l01236"></a>01236 <span class="preprocessor">        smp_wmb();                                                      \</span>
<a name="l01237"></a>01237 <span class="preprocessor">        val = atomic_dec_return(&amp;conn-&gt;gnc_refcount);                   \</span>
<a name="l01238"></a>01238 <span class="preprocessor">        LASSERTF(val &gt;= 0, &quot;conn %p refc %d to %s\n&quot;,                   \</span>
<a name="l01239"></a>01239 <span class="preprocessor">                conn, val,                                              \</span>
<a name="l01240"></a>01240 <span class="preprocessor">                conn-&gt;gnc_peer                                          \</span>
<a name="l01241"></a>01241 <span class="preprocessor">                        ? libcfs_nid2str(conn-&gt;gnc_peer-&gt;gnp_nid)       \</span>
<a name="l01242"></a>01242 <span class="preprocessor">                        : &quot;&lt;?&gt;&quot;);                                       \</span>
<a name="l01243"></a>01243 <span class="preprocessor">        CDEBUG(D_NETTRACE, &quot;conn %p-&gt;%s-- (%d)\n&quot;, conn,                \</span>
<a name="l01244"></a>01244 <span class="preprocessor">                conn-&gt;gnc_peer                                          \</span>
<a name="l01245"></a>01245 <span class="preprocessor">                        ? libcfs_nid2str(conn-&gt;gnc_peer-&gt;gnp_nid)       \</span>
<a name="l01246"></a>01246 <span class="preprocessor">                        : &quot;&lt;?&gt;&quot;,                                        \</span>
<a name="l01247"></a>01247 <span class="preprocessor">                val);                                                   \</span>
<a name="l01248"></a>01248 <span class="preprocessor">        smp_rmb();                                                      \</span>
<a name="l01249"></a>01249 <span class="preprocessor">        if ((val == 1) &amp;&amp;                                               \</span>
<a name="l01250"></a>01250 <span class="preprocessor">            (conn-&gt;gnc_ephandle != NULL) &amp;&amp;                             \</span>
<a name="l01251"></a>01251 <span class="preprocessor">            (conn-&gt;gnc_state != GNILND_CONN_DESTROY_EP)) {              \</span>
<a name="l01252"></a>01252 <span class="preprocessor">                set_mb(conn-&gt;gnc_state, GNILND_CONN_DESTROY_EP);        \</span>
<a name="l01253"></a>01253 <span class="preprocessor">                kgnilnd_schedule_conn(conn);                            \</span>
<a name="l01254"></a>01254 <span class="preprocessor">        } else if (val == 0) {                                          \</span>
<a name="l01255"></a>01255 <span class="preprocessor">                kgnilnd_destroy_conn(conn);                             \</span>
<a name="l01256"></a>01256 <span class="preprocessor">        }                                                               \</span>
<a name="l01257"></a>01257 <span class="preprocessor">} while (0)</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>
<a name="l01259"></a>01259 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *
<a name="l01260"></a><a class="code" href="gnilnd_8h.html#a11bd50791712297bb4af95e06688152c">01260</a> <a class="code" href="gnilnd_8h.html#a11bd50791712297bb4af95e06688152c">kgnilnd_nid2peerlist</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid)
<a name="l01261"></a>01261 {
<a name="l01262"></a>01262         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash = ((<span class="keywordtype">unsigned</span> int)<a class="code" href="group__lnet__addr.html#ga692b6a866269a35490f2e2803cc2e5d6" title="extract the address part of an lnet_nid_t">LNET_NIDADDR</a>(nid)) % *kgnilnd_tunables.<a class="code" href="structkgn__tunables.html#acc193b5b5171465a5a45ec26665c4c63">kgn_peer_hash_size</a>;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a>(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#a445e0b668ae1b8609c04cfc6595ee013">kgn_peers</a>[hash]);
<a name="l01265"></a>01265 }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *
<a name="l01268"></a><a class="code" href="gnilnd_8h.html#a1f3ec746ab41d55531d21196d0b48e89">01268</a> <a class="code" href="gnilnd_8h.html#a1f3ec746ab41d55531d21196d0b48e89">kgnilnd_netnum2netlist</a>(__u16 netnum)
<a name="l01269"></a>01269 {
<a name="l01270"></a>01270         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash = ((<span class="keywordtype">unsigned</span> int) netnum) % *kgnilnd_tunables.<a class="code" href="structkgn__tunables.html#a13f331d71711fd6e13e4453153bdc634">kgn_net_hash_size</a>;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a>(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#afd25d10810a2728c040bd30588b1da0a">kgn_nets</a>[hash]);
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01276"></a><a class="code" href="gnilnd_8h.html#a71952850ccab3e2c426edf4eda0eaf6d">01276</a> <a class="code" href="gnilnd_8h.html#a71952850ccab3e2c426edf4eda0eaf6d">kgnilnd_peer_active</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer)
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278         <span class="comment">/* Am I in the peer hash table? */</span>
<a name="l01279"></a>01279         <span class="keywordflow">return</span> (!<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;peer-&gt;<a class="code" href="structkgn__peer.html#abc4cb936d909df02263e8f93b697d618">gnp_list</a>));
<a name="l01280"></a>01280 }
<a name="l01281"></a>01281 
<a name="l01282"></a>01282 <span class="comment">/* need write_lock on kgn_peer_conn_lock */</span>
<a name="l01283"></a>01283 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01284"></a><a class="code" href="gnilnd_8h.html#a07c9549b1e045d0345a8a7fcbe9142cc">01284</a> <a class="code" href="gnilnd_8h.html#a07c9549b1e045d0345a8a7fcbe9142cc">kgnilnd_can_unlink_peer_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer)
<a name="l01285"></a>01285 {
<a name="l01286"></a>01286         <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a645bb72e3ae1cac3c21a4b507d522a92">D_NET</a>, <span class="stringliteral">&quot;peer 0x%p-&gt;%s conns? %d tx? %d\n&quot;</span>,
<a name="l01287"></a>01287                 peer, <a class="code" href="nidstr_8h.html#ada87bd30bf737eb0f07cd208ba08d73d">libcfs_nid2str</a>(peer-&gt;<a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">gnp_nid</a>),
<a name="l01288"></a>01288                 !<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;peer-&gt;<a class="code" href="structkgn__peer.html#a75552d1bdc03d75d8daa6248fe289189">gnp_conns</a>),
<a name="l01289"></a>01289                 !<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;peer-&gt;<a class="code" href="structkgn__peer.html#a1f5c32f5e78499df976c91b72725a72d">gnp_tx_queue</a>));
<a name="l01290"></a>01290 
<a name="l01291"></a>01291         <span class="comment">/* kgn_peer_conn_lock protects us from conflict with</span>
<a name="l01292"></a>01292 <span class="comment">         * kgnilnd_peer_notify and gnp_persistent */</span>
<a name="l01293"></a>01293         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a> ((<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;peer-&gt;<a class="code" href="structkgn__peer.html#a75552d1bdc03d75d8daa6248fe289189">gnp_conns</a>)) &amp;&amp;
<a name="l01294"></a>01294                 (<a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;peer-&gt;<a class="code" href="structkgn__peer.html#a1f5c32f5e78499df976c91b72725a72d">gnp_tx_queue</a>)));
<a name="l01295"></a>01295 }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 <span class="comment">/* returns positive if error was for a clean shutdown of conn */</span>
<a name="l01298"></a>01298 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01299"></a><a class="code" href="gnilnd_8h.html#abe08ac87284a96cd7a960602d2015fc5">01299</a> <a class="code" href="gnilnd_8h.html#abe08ac87284a96cd7a960602d2015fc5">kgnilnd_conn_clean_errno</a>(<span class="keywordtype">int</span> errno)
<a name="l01300"></a>01300 {
<a name="l01301"></a>01301         <span class="comment">/*  - ESHUTDOWN - LND is unloading</span>
<a name="l01302"></a>01302 <span class="comment">         *  - EUCLEAN - admin requested via &quot;lctl del_peer&quot;</span>
<a name="l01303"></a>01303 <span class="comment">         *  - ENETRESET - admin requested via &quot;lctl disconnect&quot; or rca event</span>
<a name="l01304"></a>01304 <span class="comment">         *  - ENOTRECOVERABLE - stack reset</span>
<a name="l01305"></a>01305 <span class="comment">         *  - EISCONN - cleared via &quot;lctl push&quot;</span>
<a name="l01306"></a>01306 <span class="comment">         *  not doing ESTALE - that isn&apos;t clean */</span>
<a name="l01307"></a>01307         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a> ((errno == 0) ||
<a name="l01308"></a>01308                 (errno == -ESHUTDOWN) ||
<a name="l01309"></a>01309                 (errno == -EUCLEAN) ||
<a name="l01310"></a>01310                 (errno == -ENETRESET) ||
<a name="l01311"></a>01311                 (errno == -EISCONN) ||
<a name="l01312"></a>01312                 (errno == -ENOTRECOVERABLE));
<a name="l01313"></a>01313 }
<a name="l01314"></a>01314 
<a name="l01315"></a>01315 <span class="comment">/* returns positive if error results in purgatory hold */</span>
<a name="l01316"></a>01316 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01317"></a><a class="code" href="gnilnd_8h.html#aebe10fdcfe073b4f4a6a75902a0b4453">01317</a> <a class="code" href="gnilnd_8h.html#aebe10fdcfe073b4f4a6a75902a0b4453">kgnilnd_check_purgatory_errno</a>(<span class="keywordtype">int</span> errno)
<a name="l01318"></a>01318 {
<a name="l01319"></a>01319         <span class="comment">/* We don&apos;t want to save the purgatory lists these cases:</span>
<a name="l01320"></a>01320 <span class="comment">         *  - EUCLEAN - admin requested via &quot;lctl del_peer&quot;</span>
<a name="l01321"></a>01321 <span class="comment">         *  - ESHUTDOWN - LND is unloading</span>
<a name="l01322"></a>01322 <span class="comment">         */</span>
<a name="l01323"></a>01323         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a> ((errno != -ESHUTDOWN) &amp;&amp;
<a name="l01324"></a>01324                 (errno != -EUCLEAN));
<a name="l01325"></a>01325 
<a name="l01326"></a>01326 }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328 <span class="comment">/* returns positive if a purgatory hold is needed */</span>
<a name="l01329"></a>01329 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01330"></a><a class="code" href="gnilnd_8h.html#a4d6ee22352af0bfffb289d01ef812913">01330</a> <a class="code" href="gnilnd_8h.html#a4d6ee22352af0bfffb289d01ef812913">kgnilnd_check_purgatory_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn)
<a name="l01331"></a>01331 {
<a name="l01332"></a>01332         <span class="keywordtype">int</span> loopback = 0;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334         <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>) {
<a name="l01335"></a>01335                 loopback = conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>-&gt;<a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">gnp_nid</a> ==
<a name="l01336"></a>01336                        conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>-&gt;<a class="code" href="structkgn__peer.html#ad2b6b6968e8e1712e1a4e328a8190a30">gnp_net</a>-&gt;<a class="code" href="structkgn__net.html#ae1eebd7c97c508cd6215923dc828585b">gnn_ni</a>-&gt;<a class="code" href="structlnet__ni.html#a3220978c27f9626e971d2537a167795d">ni_nid</a>;
<a name="l01337"></a>01337         } <span class="keywordflow">else</span> {
<a name="l01338"></a>01338                 <span class="comment">/* short circuit - a conn that didn&apos;t complete</span>
<a name="l01339"></a>01339 <span class="comment">                 * setup never needs a purgatory hold */</span>
<a name="l01340"></a>01340                 <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a>(0);
<a name="l01341"></a>01341         }
<a name="l01342"></a>01342         <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#aeeeea1864fc878a5feed7940fd096adc">D_NETTRACE</a>, <span class="stringliteral">&quot;conn 0x%p-&gt;%s loopback %d close_recvd %d\n&quot;</span>,
<a name="l01343"></a>01343                 conn, conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a> ?
<a name="l01344"></a>01344                                 <a class="code" href="nidstr_8h.html#ada87bd30bf737eb0f07cd208ba08d73d">libcfs_nid2str</a>(conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>-&gt;<a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">gnp_nid</a>) :
<a name="l01345"></a>01345                                 <span class="stringliteral">&quot;&lt;?&gt;&quot;</span>,
<a name="l01346"></a>01346                 loopback, conn-&gt;<a class="code" href="structkgn__conn.html#a99975b69e00c3700ef276afa4c7de333">gnc_close_recvd</a>);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348         <span class="comment">/* we only use a purgatory hold if we&apos;ve not received the CLOSE msg</span>
<a name="l01349"></a>01349 <span class="comment">         * from our peer - without that message, we can&apos;t know the state of</span>
<a name="l01350"></a>01350 <span class="comment">         * the other end of this connection and must put it into purgatory</span>
<a name="l01351"></a>01351 <span class="comment">         * to prevent reuse and corruption.</span>
<a name="l01352"></a>01352 <span class="comment">         * The theory is that a TX error can be communicated in all other cases</span>
<a name="l01353"></a>01353 <span class="comment">         */</span>
<a name="l01354"></a>01354         <a class="code" href="libcfs__debug_8h.html#a787d0616756df8ab4dceb42a0b73e6d6">RETURN</a>(<a class="code" href="libcfs__private_8h.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>(!loopback) &amp;&amp; !conn-&gt;<a class="code" href="structkgn__conn.html#a99975b69e00c3700ef276afa4c7de333">gnc_close_recvd</a> &amp;&amp;
<a name="l01355"></a>01355                 <a class="code" href="gnilnd_8h.html#aebe10fdcfe073b4f4a6a75902a0b4453">kgnilnd_check_purgatory_errno</a>(conn-&gt;<a class="code" href="structkgn__conn.html#a91c453cb4b36a5989201c815077b00e2">gnc_error</a>));
<a name="l01356"></a>01356 }
<a name="l01357"></a>01357 
<a name="l01358"></a>01358 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01359"></a>01359 <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(<a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>);
<a name="l01360"></a>01360 
<a name="l01361"></a>01361 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *
<a name="l01362"></a><a class="code" href="gnilnd_8h.html#af2b35e72ec68bce2f9ff3413f55c8a18">01362</a> <a class="code" href="gnilnd_8h.html#af2b35e72ec68bce2f9ff3413f55c8a18">kgnilnd_tx_state2list</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn,
<a name="l01363"></a>01363                         <a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a> to_state)
<a name="l01364"></a>01364 {
<a name="l01365"></a>01365         <span class="keywordflow">switch</span> (to_state) {
<a name="l01366"></a>01366         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">GNILND_TX_PEERQ</a>:
<a name="l01367"></a>01367                 <span class="keywordflow">return</span> &amp;peer-&gt;<a class="code" href="structkgn__peer.html#a1f5c32f5e78499df976c91b72725a72d">gnp_tx_queue</a>;
<a name="l01368"></a>01368         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">GNILND_TX_FMAQ</a>:
<a name="l01369"></a>01369                 <span class="keywordflow">return</span> &amp;conn-&gt;<a class="code" href="structkgn__conn.html#a97da12c5a8df4839347877187dc9ba2d">gnc_fmaq</a>;
<a name="l01370"></a>01370         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>:
<a name="l01371"></a>01371         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>:
<a name="l01372"></a>01372         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>:
<a name="l01373"></a>01373                 <span class="keywordflow">return</span> NULL;
<a name="l01374"></a>01374         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">GNILND_TX_MAPQ</a>:
<a name="l01375"></a>01375                 <span class="keywordflow">return</span> &amp;conn-&gt;<a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">gnc_device</a>-&gt;<a class="code" href="structkgn__device.html#a41e836b9f7b3ed88630fcb5ff5814fd1">gnd_map_tx</a>;
<a name="l01376"></a>01376         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">GNILND_TX_RDMAQ</a>:
<a name="l01377"></a>01377                 <span class="keywordflow">return</span> &amp;conn-&gt;<a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">gnc_device</a>-&gt;<a class="code" href="structkgn__device.html#a17277f4ffc0e102c1e7c047d674863a8">gnd_rdmaq</a>;
<a name="l01378"></a>01378         <span class="keywordflow">default</span>:
<a name="l01379"></a>01379                 <span class="comment">/* IDLE, FREED or ALLOCD is not valid &quot;on list&quot; state */</span>
<a name="l01380"></a>01380                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;invalid state requested: %s\n&quot;</span>,
<a name="l01381"></a>01381                         <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(to_state));
<a name="l01382"></a>01382                 <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01383"></a>01383                 <span class="keywordflow">break</span>;
<a name="l01384"></a>01384         }
<a name="l01385"></a>01385 }
<a name="l01386"></a>01386 
<a name="l01387"></a>01387 <span class="comment">/* should hold tx, conn or peer lock when calling */</span>
<a name="l01388"></a>01388 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01389"></a><a class="code" href="gnilnd_8h.html#aaaf45699616172ad648a0f434f5dfdad">01389</a> <a class="code" href="gnilnd_8h.html#aaaf45699616172ad648a0f434f5dfdad">kgnilnd_tx_add_state_locked</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer,
<a name="l01390"></a>01390                         <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>,
<a name="l01391"></a>01391                         <span class="keywordtype">int</span> add_tail)
<a name="l01392"></a>01392 {
<a name="l01393"></a>01393         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        *<a class="code" href="lnetctl_8c.html#ac75dee5cf9c8f0128e744b7d95db6767">list</a> = NULL;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395         <span class="comment">/* make sure we have a sane TX state to start */</span>
<a name="l01396"></a>01396         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, (tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a> == NULL &amp;&amp;
<a name="l01397"></a>01397                   tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> == <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>) &amp;&amp;
<a name="l01398"></a>01398                 <a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>),
<a name="l01399"></a>01399                 <span class="stringliteral">&quot;bad state with tx_list %s&quot;</span>,
<a name="l01400"></a>01400                 <a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>) ? <span class="stringliteral">&quot;empty&quot;</span> : <span class="stringliteral">&quot;not empty&quot;</span>);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402         <span class="comment">/* WTF - you are already on that state buttmunch */</span>
<a name="l01403"></a>01403         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, state != tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a>,
<a name="l01404"></a>01404                       <span class="stringliteral">&quot;already at %s&quot;</span>, <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(state));
<a name="l01405"></a>01405 
<a name="l01406"></a>01406         <span class="comment">/* get proper list from the state requested */</span>
<a name="l01407"></a>01407         list = <a class="code" href="gnilnd_8h.html#af2b35e72ec68bce2f9ff3413f55c8a18">kgnilnd_tx_state2list</a>(peer, conn, state);
<a name="l01408"></a>01408 
<a name="l01409"></a>01409         <span class="comment">/* add refcount */</span>
<a name="l01410"></a>01410         <span class="keywordflow">switch</span> (state) {
<a name="l01411"></a>01411         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">GNILND_TX_PEERQ</a>:
<a name="l01412"></a>01412                 <a class="code" href="gnilnd_8h.html#ae39f61b875250339ce83d38a9067c201">kgnilnd_peer_addref</a>(peer);
<a name="l01413"></a>01413                 <span class="keywordflow">break</span>;
<a name="l01414"></a>01414         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>:
<a name="l01415"></a>01415                 <span class="comment">/* no refs needed */</span>
<a name="l01416"></a>01416                 <span class="keywordflow">break</span>;
<a name="l01417"></a>01417         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">GNILND_TX_FMAQ</a>:
<a name="l01418"></a>01418                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01419"></a>01419                 <span class="keywordflow">break</span>;
<a name="l01420"></a>01420         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">GNILND_TX_MAPQ</a>:
<a name="l01421"></a>01421                 atomic_inc(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">gnc_device</a>-&gt;<a class="code" href="structkgn__device.html#a777e0e9f219c6c26929885b75f2e309b">gnd_nq_map</a>);
<a name="l01422"></a>01422                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01423"></a>01423                 <span class="keywordflow">break</span>;
<a name="l01424"></a>01424         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>:
<a name="l01425"></a>01425                 atomic_inc(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#adb4e74140f20d4e0a2b90fec8abeb9e5">gnc_nlive_fma</a>);
<a name="l01426"></a>01426                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01427"></a>01427                 <span class="keywordflow">break</span>;
<a name="l01428"></a>01428         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>:
<a name="l01429"></a>01429                 atomic_inc(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#af4ff5ebda7184a62eb2389490837e402">gnc_nlive_rdma</a>);
<a name="l01430"></a>01430                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01431"></a>01431                 <span class="keywordflow">break</span>;
<a name="l01432"></a>01432         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">GNILND_TX_RDMAQ</a>:
<a name="l01433"></a>01433                 atomic_inc(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#ae31165083f6dd1d7ddafef16fe286d51">gnc_nq_rdma</a>);
<a name="l01434"></a>01434                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01435"></a>01435                 <span class="keywordflow">break</span>;
<a name="l01436"></a>01436         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>:
<a name="l01437"></a>01437                 <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01438"></a>01438                 <span class="keywordflow">break</span>;
<a name="l01439"></a>01439         <span class="keywordflow">default</span>:
<a name="l01440"></a>01440                 <a class="code" href="libcfs__debug_8h.html#ad06acc43c8c74fb94f76adde491a72ac">CERROR</a>(<span class="stringliteral">&quot;invalid state requested: %s\n&quot;</span>,
<a name="l01441"></a>01441                         <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(state));
<a name="l01442"></a>01442                 <a class="code" href="libcfs__private_8h.html#a08eceadb65d1adcf8c198cff27081d5f">LBUG</a>();
<a name="l01443"></a>01443                 <span class="keywordflow">break</span>;;
<a name="l01444"></a>01444         }
<a name="l01445"></a>01445 
<a name="l01446"></a>01446         <span class="comment">/* if this changes, change kgnilnd_alloc_tx */</span>
<a name="l01447"></a>01447         tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> = state;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449         <span class="comment">/* some states don&apos;t have lists - we track them in the per conn</span>
<a name="l01450"></a>01450 <span class="comment">         * TX table instead. Waste not, want not! */</span>
<a name="l01451"></a>01451         <span class="keywordflow">if</span> (list != NULL) {
<a name="l01452"></a>01452                 tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a> = list;
<a name="l01453"></a>01453                 <span class="keywordflow">if</span> (add_tail)
<a name="l01454"></a>01454                         <a class="code" href="list_8h.html#a588bec046f1e9797b33a5c5ab250f447" title="Insert an entry at the end of a list.">list_add_tail</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>, list);
<a name="l01455"></a>01455                 <span class="keywordflow">else</span>
<a name="l01456"></a>01456                         <a class="code" href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1" title="Insert an entry at the start of a list.">list_add</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>, list);
<a name="l01457"></a>01457         } <span class="keywordflow">else</span> {
<a name="l01458"></a>01458                 <span class="comment">/* set dummy list_p to make book keeping happy and let debugging</span>
<a name="l01459"></a>01459 <span class="comment">                 * be a hair easier */</span>
<a name="l01460"></a>01460                 tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a> = (<span class="keywordtype">void</span> *)state;
<a name="l01461"></a>01461         }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         <a class="code" href="gnilnd_8h.html#a33350f0c75ebff8179d61663e12f7b80">GNIDBG_TX</a>(<a class="code" href="libcfs__debug_8h.html#a645bb72e3ae1cac3c21a4b507d522a92">D_NET</a>, tx, <span class="stringliteral">&quot;onto %s-&gt;0x%p&quot;</span>,
<a name="l01464"></a>01464                   <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(state), list);
<a name="l01465"></a>01465 }
<a name="l01466"></a>01466 
<a name="l01467"></a>01467 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01468"></a><a class="code" href="gnilnd_8h.html#aef4c03cda84c85ea98c1ffcf8266a331">01468</a> <a class="code" href="gnilnd_8h.html#aef4c03cda84c85ea98c1ffcf8266a331">kgnilnd_tx_del_state_locked</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer,
<a name="l01469"></a>01469                         <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a> new_state)
<a name="l01470"></a>01470 {
<a name="l01471"></a>01471         <span class="comment">/* These is only 1 &quot;off-list&quot; state */</span>
<a name="l01472"></a>01472         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, new_state == <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>,
<a name="l01473"></a>01473                       <span class="stringliteral">&quot;invalid new_state %s&quot;</span>, <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(new_state));
<a name="l01474"></a>01474 
<a name="l01475"></a>01475         <span class="comment">/* new_state == ALLOCD means we are deallocating this tx,</span>
<a name="l01476"></a>01476 <span class="comment">         * so make sure it was on a valid list to start with */</span>
<a name="l01477"></a>01477         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, (tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a> != NULL) &amp;&amp;
<a name="l01478"></a>01478                       (((tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> == <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>) ||
<a name="l01479"></a>01479                         (tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> == <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>) ||
<a name="l01480"></a>01480                         (tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> == <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>)) == <a class="code" href="list_8h.html#a0fce12be81e8f2677b3a272fee1652ac" title="Test whether a list is empty.">list_empty</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>)),
<a name="l01481"></a>01481                       <span class="stringliteral">&quot;bad state&quot;</span>, NULL);
<a name="l01482"></a>01482 
<a name="l01483"></a>01483         <a class="code" href="gnilnd_8h.html#a33350f0c75ebff8179d61663e12f7b80">GNIDBG_TX</a>(<a class="code" href="libcfs__debug_8h.html#a645bb72e3ae1cac3c21a4b507d522a92">D_NET</a>, tx, <span class="stringliteral">&quot;off %p&quot;</span>, tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a>);
<a name="l01484"></a>01484 
<a name="l01485"></a>01485         <span class="comment">/* drop refcount */</span>
<a name="l01486"></a>01486         <span class="keywordflow">switch</span> (tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a>) {
<a name="l01487"></a>01487         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">GNILND_TX_PEERQ</a>:
<a name="l01488"></a>01488                 <a class="code" href="gnilnd_8h.html#a808a7a2d5c4b4612643d06cee039117b">kgnilnd_peer_decref</a>(peer);
<a name="l01489"></a>01489                 <span class="keywordflow">break</span>;
<a name="l01490"></a>01490         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a23ca8db5b03dbf6da9db4afea6c4df1b">GNILND_TX_FREED</a>:
<a name="l01491"></a>01491         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a8739fec6255b605c908d3aeec59fff0a">GNILND_TX_IDLE</a>:
<a name="l01492"></a>01492         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>:
<a name="l01493"></a>01493                 <span class="comment">/* no refs needed */</span>
<a name="l01494"></a>01494                 <span class="keywordflow">break</span>;
<a name="l01495"></a>01495         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>:
<a name="l01496"></a>01496                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01497"></a>01497                 <span class="keywordflow">break</span>;
<a name="l01498"></a>01498         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">GNILND_TX_FMAQ</a>:
<a name="l01499"></a>01499                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01500"></a>01500                 <span class="keywordflow">break</span>;
<a name="l01501"></a>01501         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">GNILND_TX_MAPQ</a>:
<a name="l01502"></a>01502                 atomic_dec(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#a66e68f130a38c6d57141b6d40a638942">gnc_device</a>-&gt;<a class="code" href="structkgn__device.html#a777e0e9f219c6c26929885b75f2e309b">gnd_nq_map</a>);
<a name="l01503"></a>01503                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01504"></a>01504                 <span class="keywordflow">break</span>;
<a name="l01505"></a>01505         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>:
<a name="l01506"></a>01506                 atomic_dec(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#adb4e74140f20d4e0a2b90fec8abeb9e5">gnc_nlive_fma</a>);
<a name="l01507"></a>01507                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01508"></a>01508                 <span class="keywordflow">break</span>;
<a name="l01509"></a>01509         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>:
<a name="l01510"></a>01510                 atomic_dec(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#af4ff5ebda7184a62eb2389490837e402">gnc_nlive_rdma</a>);
<a name="l01511"></a>01511                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01512"></a>01512                 <span class="keywordflow">break</span>;
<a name="l01513"></a>01513         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">GNILND_TX_RDMAQ</a>:
<a name="l01514"></a>01514                 atomic_dec(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#ae31165083f6dd1d7ddafef16fe286d51">gnc_nq_rdma</a>);
<a name="l01515"></a>01515                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01516"></a>01516         <span class="comment">/* don&apos;t need to assert on default, already did in set */</span>
<a name="l01517"></a>01517         }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519         <span class="comment">/* for ALLOCD, this might already be true, but no harm doing it again */</span>
<a name="l01520"></a>01520         <a class="code" href="list_8h.html#ae1cde0f50b85945cfff23be4fc1586f4" title="Remove an entry from the list it is currently in and reinitialize it.">list_del_init</a>(&amp;tx-&gt;<a class="code" href="structkgn__tx.html#a54cbe0ede10a106e109b671db0600c16">tx_list</a>);
<a name="l01521"></a>01521         tx-&gt;<a class="code" href="structkgn__tx.html#ae1865060183274b3bdc19cdffa80d9d6">tx_list_p</a> = NULL;
<a name="l01522"></a>01522         tx-&gt;<a class="code" href="structkgn__tx.html#a3ca92b72b701739147bab903f3f02b0b">tx_list_state</a> = new_state;
<a name="l01523"></a>01523 }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01526"></a><a class="code" href="gnilnd_8h.html#aff0130958435d312782e881f6b087e24">01526</a> <a class="code" href="gnilnd_8h.html#aff0130958435d312782e881f6b087e24">kgnilnd_tx_mapped</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx)
<a name="l01527"></a>01527 {
<a name="l01528"></a>01528         <span class="keywordflow">return</span> (tx-&gt;<a class="code" href="structkgn__tx.html#a24527a86d6fc15ab2de5f7e9be6c5ba6">tx_buftype</a> == <a class="code" href="gnilnd_8h.html#a4ab82644a0eeff27b737032d9beb2990">GNILND_BUF_VIRT_MAPPED</a> ||
<a name="l01529"></a>01529                 tx-&gt;<a class="code" href="structkgn__tx.html#a24527a86d6fc15ab2de5f7e9be6c5ba6">tx_buftype</a> == <a class="code" href="gnilnd_8h.html#a956b9c75e68a9dd97299f84952a607c0">GNILND_BUF_PHYS_MAPPED</a>);
<a name="l01530"></a>01530 }
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *
<a name="l01533"></a><a class="code" href="gnilnd_8h.html#a57f7e674e39f232d908b58be61b04d1f">01533</a> <a class="code" href="gnilnd_8h.html#a57f7e674e39f232d908b58be61b04d1f">kgnilnd_cqid2connlist</a>(__u32 cqid)
<a name="l01534"></a>01534 {
<a name="l01535"></a>01535         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hash = cqid % *kgnilnd_tunables.<a class="code" href="structkgn__tunables.html#acc193b5b5171465a5a45ec26665c4c63">kgn_peer_hash_size</a>;
<a name="l01536"></a>01536 
<a name="l01537"></a>01537         <span class="keywordflow">return</span> (&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#ad5dff9fd022453ff12617ddfc5c43e1c">kgn_conns</a> [hash]);
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *
<a name="l01541"></a><a class="code" href="gnilnd_8h.html#aa2220c2da88d9db9072ae071a9dde9f2">01541</a> <a class="code" href="gnilnd_8h.html#aa2220c2da88d9db9072ae071a9dde9f2">kgnilnd_cqid2conn_locked</a>(__u32 cqid)
<a name="l01542"></a>01542 {
<a name="l01543"></a>01543         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *conns = <a class="code" href="gnilnd_8h.html#a57f7e674e39f232d908b58be61b04d1f">kgnilnd_cqid2connlist</a>(cqid);
<a name="l01544"></a>01544         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *tmp;
<a name="l01545"></a>01545         <a class="code" href="structkgn__conn.html">kgn_conn_t</a>       *conn;
<a name="l01546"></a>01546 
<a name="l01547"></a>01547         <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502" title="Iterate over a list.">list_for_each</a>(tmp, conns) {
<a name="l01548"></a>01548                 conn = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de" title="Get the container of a list.">list_entry</a>(tmp, <a class="code" href="structkgn__conn.html">kgn_conn_t</a>, gnc_hashlist);
<a name="l01549"></a>01549 
<a name="l01550"></a>01550                 <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structkgn__conn.html#a5ffc6d67b964fa813a576abcd3a7138f">gnc_cqid</a> == cqid)
<a name="l01551"></a>01551                         <span class="keywordflow">return</span> conn;
<a name="l01552"></a>01552         }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554         <span class="keywordflow">return</span> NULL;
<a name="l01555"></a>01555 }
<a name="l01556"></a>01556 
<a name="l01557"></a>01557 <span class="comment">/* returns 1..GNILND_MAX_CQID on success, 0 on failure */</span>
<a name="l01558"></a>01558 <span class="keyword">static</span> <span class="keyword">inline</span> __u32
<a name="l01559"></a><a class="code" href="gnilnd_8h.html#a96576b4b7e7f1c322cbb926caf2025cb">01559</a> <a class="code" href="gnilnd_8h.html#a96576b4b7e7f1c322cbb926caf2025cb">kgnilnd_get_cqid_locked</a>(<span class="keywordtype">void</span>)
<a name="l01560"></a>01560 {
<a name="l01561"></a>01561         <span class="keywordtype">int</span>     looped = 0;
<a name="l01562"></a>01562         __u32   cqid;
<a name="l01563"></a>01563 
<a name="l01564"></a>01564         <span class="keywordflow">do</span> {
<a name="l01565"></a>01565                 cqid = kgnilnd_data.<a class="code" href="structkgn__data.html#aba96ee64d0a428edc910fd15845eb6fe">kgn_next_cqid</a>++;
<a name="l01566"></a>01566                 <span class="keywordflow">if</span> (kgnilnd_data.<a class="code" href="structkgn__data.html#aba96ee64d0a428edc910fd15845eb6fe">kgn_next_cqid</a> &gt;= <a class="code" href="gnilnd_8h.html#ada7cf919a3dd25e646818835f2a21844">GNILND_MAX_CQID</a>) {
<a name="l01567"></a>01567                         <span class="keywordflow">if</span> (looped) {
<a name="l01568"></a>01568                                 <span class="keywordflow">return</span> 0;
<a name="l01569"></a>01569                         }
<a name="l01570"></a>01570                         kgnilnd_data.<a class="code" href="structkgn__data.html#aba96ee64d0a428edc910fd15845eb6fe">kgn_next_cqid</a> = 1;
<a name="l01571"></a>01571                         looped = 1;
<a name="l01572"></a>01572                 }
<a name="l01573"></a>01573         } <span class="keywordflow">while</span> (<a class="code" href="gnilnd_8h.html#aa2220c2da88d9db9072ae071a9dde9f2">kgnilnd_cqid2conn_locked</a>(cqid) != NULL);
<a name="l01574"></a>01574 
<a name="l01575"></a>01575         <span class="keywordflow">return</span> cqid;
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l01579"></a><a class="code" href="gnilnd_8h.html#a6a6aa7c4c1ee9287b231f27670c2265a">01579</a> <a class="code" href="gnilnd_8h.html#a6a6aa7c4c1ee9287b231f27670c2265a">kgnilnd_validate_tx_ev_id</a>(<a class="code" href="structkgn__tx__ev__id.html">kgn_tx_ev_id_t</a> *ev_id, <a class="code" href="structkgn__tx.html">kgn_tx_t</a> **txp, <a class="code" href="structkgn__conn.html">kgn_conn_t</a> **connp)
<a name="l01580"></a>01580 {
<a name="l01581"></a>01581         <a class="code" href="structkgn__tx.html">kgn_tx_t</a>        *tx = NULL;
<a name="l01582"></a>01582         <a class="code" href="structkgn__conn.html">kgn_conn_t</a>      *conn = NULL;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584         <span class="comment">/* set to NULL so any early return is an error */</span>
<a name="l01585"></a>01585         *txp = NULL;
<a name="l01586"></a>01586         *connp = NULL;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>((ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a> &gt; 0) &amp;&amp;
<a name="l01589"></a>01589                  (ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a> &lt; <a class="code" href="gnilnd_8h.html#a243d5a761e283c93b9725963fb48242f">GNILND_MAX_MSG_ID</a>),
<a name="l01590"></a>01590                 <span class="stringliteral">&quot;bogus txe_idx %d &gt;= %d\n&quot;</span>,
<a name="l01591"></a>01591                 ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>, <a class="code" href="gnilnd_8h.html#a243d5a761e283c93b9725963fb48242f">GNILND_MAX_MSG_ID</a>);
<a name="l01592"></a>01592 
<a name="l01593"></a>01593         <a class="code" href="utils_2wirehdr_8c.html#a2e063b87e63a187e8b2302ef6628b842">LASSERTF</a>((ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a> &gt; 0) &amp;&amp;
<a name="l01594"></a>01594                  (ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a> &lt; <a class="code" href="gnilnd_8h.html#ada7cf919a3dd25e646818835f2a21844">GNILND_MAX_CQID</a>),
<a name="l01595"></a>01595                 <span class="stringliteral">&quot;bogus txe_cqid %d &gt;= %d\n&quot;</span>,
<a name="l01596"></a>01596                 ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a>, <a class="code" href="gnilnd_8h.html#ada7cf919a3dd25e646818835f2a21844">GNILND_MAX_CQID</a>);
<a name="l01597"></a>01597 
<a name="l01598"></a>01598         read_lock(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#a8d148ea02cd62ecb9ebf62ffe7bd4e0e">kgn_peer_conn_lock</a>);
<a name="l01599"></a>01599         conn = <a class="code" href="gnilnd_8h.html#aa2220c2da88d9db9072ae071a9dde9f2">kgnilnd_cqid2conn_locked</a>(ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a>);
<a name="l01600"></a>01600 
<a name="l01601"></a>01601         <span class="keywordflow">if</span> (conn == NULL) {
<a name="l01602"></a>01602                 <span class="comment">/* Conn was destroyed? */</span>
<a name="l01603"></a>01603                 read_unlock(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#a8d148ea02cd62ecb9ebf62ffe7bd4e0e">kgn_peer_conn_lock</a>);
<a name="l01604"></a>01604                 <a class="code" href="libcfs__debug_8h.html#a9253e2ada2b31c570a7c99d1bd6a6355">CDEBUG</a>(<a class="code" href="libcfs__debug_8h.html#a645bb72e3ae1cac3c21a4b507d522a92">D_NET</a>, <span class="stringliteral">&quot;CQID %d lookup failed\n&quot;</span>, ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#aa262560467a9770b7d0d419c338ea1f3">txe_cqid</a>);
<a name="l01605"></a>01605                 <span class="keywordflow">return</span>;
<a name="l01606"></a>01606         }
<a name="l01607"></a>01607         <span class="comment">/* just insurance */</span>
<a name="l01608"></a>01608         <a class="code" href="gnilnd_8h.html#a645ce9ec3f2e5a37df940b2e5f9ef25d">kgnilnd_conn_addref</a>(conn);
<a name="l01609"></a>01609         <a class="code" href="gnilnd_8h.html#a1b04527de6ab8a99d2a6934c1c379f95">kgnilnd_admin_addref</a>(conn-&gt;<a class="code" href="structkgn__conn.html#a38e0353dd525f9ddaf8df5c848918da7">gnc_tx_in_use</a>);
<a name="l01610"></a>01610         read_unlock(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#a8d148ea02cd62ecb9ebf62ffe7bd4e0e">kgn_peer_conn_lock</a>);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         <span class="comment">/* we know this is safe - as the TX won&apos;t be reused until AFTER</span>
<a name="l01613"></a>01613 <span class="comment">         * the conn is unlinked from the cqid hash, so we can use the TX</span>
<a name="l01614"></a>01614 <span class="comment">         * (serializing to avoid any cache oddness) freely from the conn tx ref table */</span>
<a name="l01615"></a>01615 
<a name="l01616"></a>01616         spin_lock(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#a0e66b63db756ecf2775da8777280998e">gnc_tx_lock</a>);
<a name="l01617"></a>01617         tx = conn-&gt;<a class="code" href="structkgn__conn.html#ab9c9ca702f9f03d52c9fe63d65f52e7f">gnc_tx_ref_table</a>[ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>];
<a name="l01618"></a>01618         spin_unlock(&amp;conn-&gt;<a class="code" href="structkgn__conn.html#a0e66b63db756ecf2775da8777280998e">gnc_tx_lock</a>);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620         <span class="comment">/* We could have a tx that was cleared out by other forces</span>
<a name="l01621"></a>01621 <span class="comment">         * lctl disconnect or del_peer. */</span>
<a name="l01622"></a>01622         <span class="keywordflow">if</span> (tx == NULL) {
<a name="l01623"></a>01623                 <a class="code" href="libcfs__debug_8h.html#a27bee86c1bde3433be1c0d3939ea8c62">CNETERR</a>(<span class="stringliteral">&quot;txe_idx %d is gone, ignoring event\n&quot;</span>, ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>);
<a name="l01624"></a>01624                 <a class="code" href="gnilnd_8h.html#a16c74fde7b75f50db70c46ff5357d714">kgnilnd_admin_decref</a>(conn-&gt;<a class="code" href="structkgn__conn.html#a38e0353dd525f9ddaf8df5c848918da7">gnc_tx_in_use</a>);
<a name="l01625"></a>01625                 <a class="code" href="gnilnd_8h.html#a8660e9cbb0dc158d5d7a36f7dc86e184">kgnilnd_conn_decref</a>(conn);
<a name="l01626"></a>01626                 <span class="keywordflow">return</span>;
<a name="l01627"></a>01627         }
<a name="l01628"></a>01628 
<a name="l01629"></a>01629         <span class="comment">/* check tx-&gt;tx_msg magic to make sure kgni didn&apos;t eat it */</span>
<a name="l01630"></a>01630         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, tx-&gt;<a class="code" href="structkgn__tx.html#abe64ab18265d3c171cc5c2af2da25dfe">tx_msg</a>.gnm_magic == <a class="code" href="gnilnd_8h.html#a81aeaea3994bb532cf7a1a5a9c9c5670">GNILND_MSG_MAGIC</a>,
<a name="l01631"></a>01631                       <span class="stringliteral">&quot;came back from kgni with bad magic %x&quot;</span>, tx-&gt;<a class="code" href="structkgn__tx.html#abe64ab18265d3c171cc5c2af2da25dfe">tx_msg</a>.gnm_magic);
<a name="l01632"></a>01632 
<a name="l01633"></a>01633         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, tx-&gt;<a class="code" href="structkgn__tx.html#a73bd845489b55504023e6baab680e1f3">tx_id</a>.<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a> == ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>,
<a name="l01634"></a>01634                       <span class="stringliteral">&quot;conn 0x%p-&gt;%s tx_ref_table hosed: wanted txe_idx %d &quot;</span>
<a name="l01635"></a>01635                       <span class="stringliteral">&quot;found tx %p txe_idx %d&quot;</span>,
<a name="l01636"></a>01636                       conn, <a class="code" href="nidstr_8h.html#ada87bd30bf737eb0f07cd208ba08d73d">libcfs_nid2str</a>(conn-&gt;<a class="code" href="structkgn__conn.html#a73c5fd56c57297902f4203db1086cd87">gnc_peer</a>-&gt;<a class="code" href="structkgn__peer.html#acd500c6e672c04b82c765ea12c4e647e">gnp_nid</a>),
<a name="l01637"></a>01637                       ev_id-&gt;<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>, tx, tx-&gt;<a class="code" href="structkgn__tx.html#a73bd845489b55504023e6baab680e1f3">tx_id</a>.<a class="code" href="structkgn__tx__ev__id.html#a176397242f0f803e28898d095dcc0789">txe_idx</a>);
<a name="l01638"></a>01638 
<a name="l01639"></a>01639         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, tx-&gt;<a class="code" href="structkgn__tx.html#a1c9c5c0c527ec8abb5b4b0692fa7d7c7">tx_conn</a> != NULL, <span class="stringliteral">&quot;tx with NULL connection&quot;</span>, NULL);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         <a class="code" href="gnilnd_8h.html#a1aa462da55248bf8a8b25e5fbf7ff1d4">GNITX_ASSERTF</a>(tx, tx-&gt;<a class="code" href="structkgn__tx.html#a1c9c5c0c527ec8abb5b4b0692fa7d7c7">tx_conn</a> == conn, <span class="stringliteral">&quot;tx conn does not equal conn&quot;</span>, NULL);
<a name="l01642"></a>01642 
<a name="l01643"></a>01643         *txp = tx;
<a name="l01644"></a>01644         *connp = conn;
<a name="l01645"></a>01645 
<a name="l01646"></a>01646         <a class="code" href="gnilnd_8h.html#a33350f0c75ebff8179d61663e12f7b80">GNIDBG_TX</a>(<a class="code" href="libcfs__debug_8h.html#a645bb72e3ae1cac3c21a4b507d522a92">D_NET</a>, tx, <span class="stringliteral">&quot;validated to 0x%p&quot;</span>, conn);
<a name="l01647"></a>01647 }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649 <span class="comment">/* set_normalized_timepsec isn&apos;t exported from the kernel, so</span>
<a name="l01650"></a>01650 <span class="comment"> * we need to do the same thing inline */</span>
<a name="l01651"></a>01651 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span>timespec
<a name="l01652"></a><a class="code" href="gnilnd_8h.html#a762bfa19cc667380a4eddc849851ec64">01652</a> <a class="code" href="gnilnd_8h.html#a762bfa19cc667380a4eddc849851ec64">kgnilnd_ts_sub</a>(struct timespec lhs, struct timespec rhs)
<a name="l01653"></a>01653 {
<a name="l01654"></a>01654         time_t                  sec;
<a name="l01655"></a>01655         <span class="keywordtype">long</span>                    nsec;
<a name="l01656"></a>01656         <span class="keyword">struct </span>timespec         ts;
<a name="l01657"></a>01657 
<a name="l01658"></a>01658         sec = lhs.tv_sec - rhs.tv_sec;
<a name="l01659"></a>01659         nsec = lhs.tv_nsec - rhs.tv_nsec;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661         <span class="keywordflow">while</span> (nsec &gt;= <a class="code" href="lhsmtool__posix_8c.html#a0501e82515b2bdf36453c4cc80f5e0cc">NSEC_PER_SEC</a>) {
<a name="l01662"></a>01662                 nsec -= <a class="code" href="lhsmtool__posix_8c.html#a0501e82515b2bdf36453c4cc80f5e0cc">NSEC_PER_SEC</a>;
<a name="l01663"></a>01663                 ++sec;
<a name="l01664"></a>01664         }
<a name="l01665"></a>01665         <span class="keywordflow">while</span> (nsec &lt; 0) {
<a name="l01666"></a>01666                 nsec += <a class="code" href="lhsmtool__posix_8c.html#a0501e82515b2bdf36453c4cc80f5e0cc">NSEC_PER_SEC</a>;
<a name="l01667"></a>01667                 --sec;
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669         ts.tv_sec = sec;
<a name="l01670"></a>01670         ts.tv_nsec = nsec;
<a name="l01671"></a>01671         <span class="keywordflow">return</span> ts;
<a name="l01672"></a>01672 }
<a name="l01673"></a>01673 
<a name="l01674"></a>01674 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01675"></a><a class="code" href="gnilnd_8h.html#a82827c8fefef40dddc0673f38dbbd8cb">01675</a> <a class="code" href="gnilnd_8h.html#a82827c8fefef40dddc0673f38dbbd8cb">kgnilnd_count_list</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *q)
<a name="l01676"></a>01676 {
<a name="l01677"></a>01677         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *e;
<a name="l01678"></a>01678         <span class="keywordtype">int</span>               n = 0;
<a name="l01679"></a>01679 
<a name="l01680"></a>01680         <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502" title="Iterate over a list.">list_for_each</a>(e, q) {
<a name="l01681"></a>01681                 n++;
<a name="l01682"></a>01682         }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684         <span class="keywordflow">return</span> n;
<a name="l01685"></a>01685 }
<a name="l01686"></a>01686 
<a name="l01687"></a>01687 <span class="comment">/* kgnilnd_find_net adds a reference to the net it finds</span>
<a name="l01688"></a>01688 <span class="comment"> * this is so the net will not be removed before the calling function</span>
<a name="l01689"></a>01689 <span class="comment"> * has time to use the data returned. This reference needs to be released</span>
<a name="l01690"></a>01690 <span class="comment"> * by the calling function once it has finished using the returned net</span>
<a name="l01691"></a>01691 <span class="comment"> */</span>
<a name="l01692"></a>01692 
<a name="l01693"></a>01693 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01694"></a><a class="code" href="gnilnd_8h.html#aa82f2f433c0c2b89229eda2e94c9aeb6">01694</a> <a class="code" href="gnilnd_8h.html#aa82f2f433c0c2b89229eda2e94c9aeb6">kgnilnd_find_net</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <a class="code" href="structkgn__net.html">kgn_net_t</a> **netp)
<a name="l01695"></a>01695 {
<a name="l01696"></a>01696         <a class="code" href="structkgn__net.html">kgn_net_t</a> *net;
<a name="l01697"></a>01697         <span class="keywordtype">int</span> rc;
<a name="l01698"></a>01698 
<a name="l01699"></a>01699         rc = down_read_trylock(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#aefbf08af493c7d1a10f58b08aa960e5e">kgn_net_rw_sem</a>);
<a name="l01700"></a>01700 
<a name="l01701"></a>01701         <span class="keywordflow">if</span> (!rc) {
<a name="l01702"></a>01702                 <span class="keywordflow">return</span> -ESHUTDOWN;
<a name="l01703"></a>01703         }
<a name="l01704"></a>01704 
<a name="l01705"></a>01705         <a class="code" href="list_8h.html#a9b782fefb5ab71ce9762182e45a615e1" title="Iterate over a list of given type.">list_for_each_entry</a>(net, <a class="code" href="gnilnd_8h.html#a1f3ec746ab41d55531d21196d0b48e89">kgnilnd_netnum2netlist</a>(<a class="code" href="group__lnet__addr.html#gaa5b1f70b0f73fff4e4d2ceb7b95965b1">LNET_NETNUM</a>(<a class="code" href="group__lnet__addr.html#gabf536c21b8f5226eadf3a124a265ee3b">LNET_NIDNET</a>(nid))), gnn_list) {
<a name="l01706"></a>01706                 <span class="keywordflow">if</span> (!net-&gt;<a class="code" href="structkgn__net.html#a5338935d53737311f4f6037d6241f274">gnn_shutdown</a> &amp;&amp; <a class="code" href="group__lnet__addr.html#gabf536c21b8f5226eadf3a124a265ee3b">LNET_NIDNET</a>(net-&gt;<a class="code" href="structkgn__net.html#ae1eebd7c97c508cd6215923dc828585b">gnn_ni</a>-&gt;<a class="code" href="structlnet__ni.html#a3220978c27f9626e971d2537a167795d">ni_nid</a>) == <a class="code" href="group__lnet__addr.html#gabf536c21b8f5226eadf3a124a265ee3b">LNET_NIDNET</a>(nid)) {
<a name="l01707"></a>01707                         <a class="code" href="gnilnd_8h.html#ab92bd710788a62695afe5d8f70524f96">kgnilnd_net_addref</a>(net);
<a name="l01708"></a>01708                         up_read(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#aefbf08af493c7d1a10f58b08aa960e5e">kgn_net_rw_sem</a>);
<a name="l01709"></a>01709                         *netp = net;
<a name="l01710"></a>01710                         <span class="keywordflow">return</span> 0;
<a name="l01711"></a>01711                 }
<a name="l01712"></a>01712         }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714         up_read(&amp;kgnilnd_data.<a class="code" href="structkgn__data.html#aefbf08af493c7d1a10f58b08aa960e5e">kgn_net_rw_sem</a>);
<a name="l01715"></a>01715 
<a name="l01716"></a>01716         <span class="keywordflow">return</span> -ENONET;
<a name="l01717"></a>01717 }
<a name="l01718"></a>01718 
<a name="l01719"></a>01719 <span class="preprocessor">#ifdef CONFIG_DEBUG_SLAB</span>
<a name="l01720"></a>01720 <span class="preprocessor"></span><span class="preprocessor">#define KGNILND_POISON(ptr, c, s) do {} while(0)</span>
<a name="l01721"></a>01721 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l01722"></a><a class="code" href="gnilnd_8h.html#acd1b9c58e37e49e2d93b91384ae95d13">01722</a> <span class="preprocessor"></span><span class="preprocessor">#define KGNILND_POISON(ptr, c, s) memset(ptr, c, s)</span>
<a name="l01723"></a>01723 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01724"></a>01724 <span class="preprocessor"></span>
<a name="l01725"></a>01725 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#ad5d92cce6e80cb7717095dd3e1d7f86b">kgnilnd_dev_init</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01726"></a>01726 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a9c582256e25ca81ad9c184fe6068447a">kgnilnd_dev_fini</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01727"></a>01727 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#ad197e69dd4e83bb821609d602073b9fd">kgnilnd_startup</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni);
<a name="l01728"></a>01728 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#ada9052a03d28dd06d9be8992b8548c02">kgnilnd_shutdown</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni);
<a name="l01729"></a>01729 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a2d74f56d4a4b486b51090e693683fd3f">kgnilnd_base_startup</a>(<span class="keywordtype">void</span>);
<a name="l01730"></a>01730 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#aefe6ca6ffdb80897883c39398a29f902">kgnilnd_base_shutdown</a>(<span class="keywordtype">void</span>);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ab7bdf5deae46f8af78130a4297b6b03b">kgnilnd_allocate_phys_fmablk</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *device);
<a name="l01733"></a>01733 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ac9720b771159e503a066d32d87914e0e">kgnilnd_map_phys_fmablk</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *device);
<a name="l01734"></a>01734 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a093daa4c438c7886400c0fd14c8b86e9">kgnilnd_unmap_fma_blocks</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *device);
<a name="l01735"></a>01735 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ad9648ed7367761195557c1a0ffe67008">kgnilnd_free_phys_fmablk</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *device);
<a name="l01736"></a>01736 
<a name="l01737"></a>01737 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#ab5d31e9fcd446393ec9a5157c2ac966e">kgnilnd_ctl</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="mdsrate_8c.html#a7353cae57e2530c316ddacb27ef14932">cmd</a>, <span class="keywordtype">void</span> *arg);
<a name="l01738"></a>01738 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a532c3ba6f8c785383f3e90957e98f394">kgnilnd_query</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <a class="code" href="linux-time_8h.html#a0e81d053bc8d925f6574c760bbea5ac4">cfs_time_t</a> *when);
<a name="l01739"></a>01739 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#aa2205fec977bf88aa7b87c9aa4b52a23">kgnilnd_send</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni, <span class="keywordtype">void</span> *<span class="keyword">private</span>, <a class="code" href="structlnet__msg.html">lnet_msg_t</a> *lntmsg);
<a name="l01740"></a>01740 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a0ee902b1e952a32717cd25b842c64fbb">kgnilnd_eager_recv</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni, <span class="keywordtype">void</span> *<span class="keyword">private</span>,
<a name="l01741"></a>01741                         <a class="code" href="structlnet__msg.html">lnet_msg_t</a> *lntmsg, <span class="keywordtype">void</span> **new_private);
<a name="l01742"></a>01742 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ad36dfec1c4a84dccce5432ee79d7cc29">kgnilnd_recv</a>(<a class="code" href="structlnet__ni.html">lnet_ni_t</a> *ni, <span class="keywordtype">void</span> *<span class="keyword">private</span>, <a class="code" href="structlnet__msg.html">lnet_msg_t</a> *lntmsg,
<a name="l01743"></a>01743                 <span class="keywordtype">int</span> delayed, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> niov,
<a name="l01744"></a>01744                 <span class="keyword">struct</span> kvec *iov, <a class="code" href="structlnet__kiov__t.html" title="A page-based fragment of a MD.">lnet_kiov_t</a> *kiov,
<a name="l01745"></a>01745                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mlen, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rlen);
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 __u16 <a class="code" href="gnilnd_8h.html#a17553aefd58fca436f932354257107b7">kgnilnd_cksum_kiov</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nkiov, <a class="code" href="structlnet__kiov__t.html" title="A page-based fragment of a MD.">lnet_kiov_t</a> *kiov, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nob, <span class="keywordtype">int</span> dump_blob);
<a name="l01748"></a>01748 
<a name="l01749"></a>01749 <span class="comment">/* purgatory functions */</span>
<a name="l01750"></a>01750 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a4d36d0d19accb84ebc1427954f0caed5">kgnilnd_add_purgatory_locked</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01751"></a>01751 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#aef4de006cab131b87834b8ad1001a20b">kgnilnd_mark_for_detach_purgatory_all_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01752"></a>01752 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a2a5aeebca4f2635526c9954234d2475e">kgnilnd_detach_purgatory_locked</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *conn_list);
<a name="l01753"></a>01753 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#ac89412d40638ceb4c9d8a453e138059b">kgnilnd_release_purgatory_list</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *conn_list);
<a name="l01754"></a>01754 
<a name="l01755"></a>01755 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ab069e010c6ae5e4cc75d43c644db7c9e">kgnilnd_update_reaper_timeout</a>(<span class="keywordtype">long</span> <a class="code" href="gnilnd__modparams_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);
<a name="l01756"></a>01756 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a16178adf2cef67357c27b7eedcbd0d4a">kgnilnd_unmap_buffer</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01757"></a>01757 <a class="code" href="structkgn__tx.html">kgn_tx_t</a> *<a class="code" href="gnilnd_8h.html#ae93b3c94aa7475bfc5569e626e3547bd">kgnilnd_new_tx_msg</a>(<span class="keywordtype">int</span> type, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> source);
<a name="l01758"></a>01758 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a002ca2f36836d051ef9c4d2d156defbd">kgnilnd_tx_done</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <span class="keywordtype">int</span> completion);
<a name="l01759"></a>01759 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a59108fe9faf03a90836a6f8fb1db7b67">kgnilnd_txlist_done</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *txlist, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01760"></a>01760 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a89bc4605fa7b5c546e3398e579488b29">kgnilnd_unlink_peer_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01761"></a>01761 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#adb279c641584e3b535d258104ebce43c">_kgnilnd_schedule_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keyword">const</span> <span class="keywordtype">char</span> *caller, <span class="keywordtype">int</span> line, <span class="keywordtype">int</span> refheld);
<a name="l01762"></a>01762 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a4ec63fcd6a99496548fc8a3c0dfcdce9">kgnilnd_schedule_process_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keywordtype">int</span> sched_intent);
<a name="l01763"></a>01763 
<a name="l01764"></a>01764 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a8817bfea0f760de156b4cb92a6fbe237">kgnilnd_schedule_dgram</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01765"></a>01765 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a5288902f8447984c991c5c8158655ccf">kgnilnd_create_peer_safe</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> **peerp, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <a class="code" href="structkgn__net.html">kgn_net_t</a> *net, <span class="keywordtype">int</span> node_state);
<a name="l01766"></a>01766 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#af4db478154428769ee73bef14abf6697">kgnilnd_add_peer_locked</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> *new_stub_peer, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> **peerp);
<a name="l01767"></a>01767 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a2275aac86a3d202075b8cf63c0a74786">kgnilnd_add_peer</a>(<a class="code" href="structkgn__net.html">kgn_net_t</a> *net, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <a class="code" href="structkgn__peer.html">kgn_peer_t</a> **peerp);
<a name="l01768"></a>01768 
<a name="l01769"></a>01769 <a class="code" href="structkgn__peer.html">kgn_peer_t</a> *<a class="code" href="gnilnd_8c.html#ae3f81dd4cc7e7702064be92557b3aa62">kgnilnd_find_peer_locked</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid);
<a name="l01770"></a>01770 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#af7d4b3b9964567d59ef902948a864b50">kgnilnd_del_conn_or_peer</a>(<a class="code" href="structkgn__net.html">kgn_net_t</a> *net, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <span class="keywordtype">int</span> command, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01771"></a>01771 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#ab4ac8ae1e5171241dc45b64017af6921">kgnilnd_peer_increase_reconnect_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01772"></a>01772 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#af38db7f24ed139702a93b79e44e4ca11">kgnilnd_queue_reply</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx);
<a name="l01773"></a>01773 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ad640a1d09cb6b09e21f2a593cb1bbe33">kgnilnd_queue_tx</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx);
<a name="l01774"></a>01774 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a1956fa1203840c4321b71eca9c3aff59">kgnilnd_launch_tx</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <a class="code" href="structkgn__net.html">kgn_net_t</a> *net, <a class="code" href="structlnet__process__id__t.html" title="Global process ID.">lnet_process_id_t</a> *target);
<a name="l01775"></a>01775 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a29c373ffc1d80181b998434aa307f6ee">kgnilnd_send_mapped_tx</a>(<a class="code" href="structkgn__tx.html">kgn_tx_t</a> *tx, <span class="keywordtype">int</span> try_map_if_full);
<a name="l01776"></a>01776 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a8ec787f01a0380fe9309cfb710fcf927">kgnilnd_consume_rx</a>(<a class="code" href="structkgn__rx.html">kgn_rx_t</a> *rx);
<a name="l01777"></a>01777 
<a name="l01778"></a>01778 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#abf4ddc3a20f7e84393ef51bd7a78902e">kgnilnd_schedule_device</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01779"></a>01779 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a9ca9fe4413632746e4cac41f63c54ba5">kgnilnd_device_callback</a>(__u32 devid, <a class="code" href="uapi__kernelcomm_8h.html#adc2adfee3162ec44eb82da5f869a806c">__u64</a> arg);
<a name="l01780"></a>01780 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a0334b01360de3dd99ae8bc0045f997fa">kgnilnd_schedule_device_timer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a53b47893fa838f2d3af38186a91d2d34">kgnilnd_reaper</a>(<span class="keywordtype">void</span> *arg);
<a name="l01783"></a>01783 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ae65189e754e98f8c13bb9f16077104c6">kgnilnd_scheduler</a>(<span class="keywordtype">void</span> *arg);
<a name="l01784"></a>01784 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#aa5f856d935bb33bc3fbe528da6e72f45">kgnilnd_dgram_mover</a>(<span class="keywordtype">void</span> *arg);
<a name="l01785"></a>01785 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a5ec60b510836d90664d079611ef1f6b1">kgnilnd_rca</a>(<span class="keywordtype">void</span> *arg);
<a name="l01786"></a>01786 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#adbbc95f7b266329ee8dd7ed8e0440cff">kgnilnd_thread_start</a>(<span class="keywordtype">int</span>(*fn)(<span class="keywordtype">void</span> *arg), <span class="keywordtype">void</span> *arg, <span class="keywordtype">char</span> *<a class="code" href="mdt__coordinator_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l01787"></a>01787 
<a name="l01788"></a>01788 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a16427dc1b73966ab084540120a97a5d7">kgnilnd_create_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> **connp, <a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01789"></a>01789 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a3d953771b6f029ea638fb6e01b4805aa">kgnilnd_conn_isdup_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *newconn);
<a name="l01790"></a>01790 <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *<a class="code" href="gnilnd_8c.html#a209cddb87ec4e32b1db4f3e079eced90">kgnilnd_find_conn_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01791"></a>01791 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ac7a47467276de44ba8ad56bbeb6e92e5">kgnilnd_get_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> **connp, <a class="code" href="structkgn__peer.html">kgn_peer_t</a>);
<a name="l01792"></a>01792 <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *<a class="code" href="gnilnd_8c.html#a8f2d688354c8216633beafea61807ed7">kgnilnd_find_or_create_conn_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01793"></a>01793 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#af4d189666438a122e71d639513eb4687">kgnilnd_peer_cancel_tx_queue</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01794"></a>01794 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a7fcc5eacc52dd9ddbd5c3cc99c78045b">kgnilnd_cancel_peer_connect_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> *zombies);
<a name="l01795"></a>01795 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#aaf924160cbe58b9a8a8173a2b28ce15d">kgnilnd_close_stale_conns_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <a class="code" href="structkgn__conn.html">kgn_conn_t</a> *newconn);
<a name="l01796"></a>01796 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a9d259d3b924feedc8538d96bfbebf96b">kgnilnd_peer_alive</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer);
<a name="l01797"></a>01797 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a4c259e822949bb03bc9c48dc2ed1f055">kgnilnd_peer_notify</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>, <span class="keywordtype">int</span> alive);
<a name="l01798"></a>01798 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a0f765370a7e485330db730bf60b71b26">kgnilnd_close_conn_locked</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01799"></a>01799 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#a39b926eccdae79c7376981a6fb160e5d">kgnilnd_close_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keywordtype">int</span> <a class="code" href="it__test_8c.html#ae70cde843eddd6d7c493335f157da127">error</a>);
<a name="l01800"></a>01800 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#ade8d4f6b64233fd2284746b440fd8d9e">kgnilnd_complete_closed_conn</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn);
<a name="l01801"></a>01801 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8c.html#aa529372d260414f43397590770ec8ca2">kgnilnd_destroy_conn_ep</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn);
<a name="l01802"></a>01802 
<a name="l01803"></a>01803 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#add581a399f2d4597ac724df9f5937fca">kgnilnd_close_peer_conns_locked</a>(<a class="code" href="structkgn__peer.html">kgn_peer_t</a> *peer, <span class="keywordtype">int</span> why);
<a name="l01804"></a>01804 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a2e169edb6f0db44b57001e20b992c74e">kgnilnd_report_node_state</a>(<a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> nid, <span class="keywordtype">int</span> down);
<a name="l01805"></a>01805 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#aef2971a87032b03722a7a54445c68680">kgnilnd_wakeup_rca_thread</a>(<span class="keywordtype">void</span>);
<a name="l01806"></a>01806 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a872f7c02a65a89757233c3b350a57346">kgnilnd_start_rca_thread</a>(<span class="keywordtype">void</span>);
<a name="l01807"></a>01807 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a9ca0b26f4a9ddb96d196c73668f540b8">kgnilnd_get_node_state</a>(__u32 nid);
<a name="l01808"></a>01808 
<a name="l01809"></a>01809 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#ad81704c630844792ca529c537d1e1f06">kgnilnd_tunables_init</a>(<span class="keywordtype">void</span>);
<a name="l01810"></a>01810 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ace07d00caa4c7b2bd20b35da95f5eecf">kgnilnd_init_msg</a>(kgn_msg_t *<a class="code" href="multiop_8c.html#afbbc03d010d4a43d0dcc0ef3c41de5ec">msg</a>, <span class="keywordtype">int</span> type, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> source);
<a name="l01811"></a>01811 
<a name="l01812"></a>01812 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a662fd57a0e9af4476734b4ef00038842">kgnilnd_bump_timeouts</a>(__u32 nap_time, <span class="keywordtype">char</span> *reason);
<a name="l01813"></a>01813 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a9ea2af8ba38bb8aed45f3df47278040d">kgnilnd_pause_threads</a>(<span class="keywordtype">void</span>);
<a name="l01814"></a>01814 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a896c6c4bebfffaca280a3840afd0c7c8">kgnilnd_hw_in_quiesce</a>(<span class="keywordtype">void</span>);
<a name="l01815"></a>01815 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a72094302ab878b73587cd15b16b5569b">kgnilnd_check_hw_quiesce</a>(<span class="keywordtype">void</span>);
<a name="l01816"></a>01816 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#affb1c70e2ef616a744561465483e8e55">kgnilnd_quiesce_wait</a>(<span class="keywordtype">char</span> *reason);
<a name="l01817"></a>01817 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a31d18aec3d3d6b771a3aee5549dee59e">kgnilnd_quiesce_end_callback</a>(<a class="code" href="gni__pub_8h.html#af1caa135c65d40d4d45b21b1f0b707b8">gni_nic_handle_t</a> nic_handle, uint64_t msecs);
<a name="l01818"></a>01818 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#aa26b5a8fc94c56ac2f4f6e1c2b1d4e96">kgnilnd_ruhroh_thread</a>(<span class="keywordtype">void</span> *arg);
<a name="l01819"></a>01819 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a38b5e5288ecc571ad118e96411ebaebb">kgnilnd_reset_stack</a>(<span class="keywordtype">void</span>);
<a name="l01820"></a>01820 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a9ed0d8fc491cd4514575b73f9ee65e9c">kgnilnd_critical_error</a>(<a class="code" href="gni__pub_8h.html#afeff57911fc00ec064a2b9bdb7b0b47c">gni_err_handle_t</a> err_handle);
<a name="l01821"></a>01821 
<a name="l01822"></a>01822 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a8881f96ff8d90914f24fb870de508db5">kgnilnd_insert_sysctl</a>(<span class="keywordtype">void</span>);
<a name="l01823"></a>01823 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a64dfaf6fc6d3954d4be6bcdb924a9bf2">kgnilnd_remove_sysctl</a>(<span class="keywordtype">void</span>);
<a name="l01824"></a>01824 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#ab0147b7b33e7300fc34093063817660d">kgnilnd_proc_init</a>(<span class="keywordtype">void</span>);
<a name="l01825"></a>01825 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a7684f9505be0988f69e139a85cae14aa">kgnilnd_proc_fini</a>(<span class="keywordtype">void</span>);
<a name="l01826"></a>01826 
<a name="l01827"></a>01827 <span class="comment">/* gnilnd_conn.c */</span>
<a name="l01828"></a>01828 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a5fb6b4a60b216aa0d5351d323fa5acb8">kgnilnd_release_mbox</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn, <span class="keywordtype">int</span> purgatory_hold);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a77d59ddd3a555acd5a63439fc7ebe121">kgnilnd_find_and_cancel_dgram</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev, <a class="code" href="group__lnet__addr.html#ga0d47ef2c4f1002efbdd050547f80a312" title="Address of an end-point in an LNet network.">lnet_nid_t</a> dst_nid);
<a name="l01831"></a>01831 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#af0bc27af31ab08277023dded0673771f">kgnilnd_cancel_dgram_locked</a>(<a class="code" href="structkgn__dgram.html">kgn_dgram_t</a> *dgram);
<a name="l01832"></a>01832 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a7a7b634c7c8164ec658dac434ddcb7fb">kgnilnd_release_dgram</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev, <a class="code" href="structkgn__dgram.html">kgn_dgram_t</a> *dgram, <span class="keywordtype">int</span> shutdown);
<a name="l01833"></a>01833 
<a name="l01834"></a>01834 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#adb51499e02fb3635d50acf91d94ecbf1">kgnilnd_setup_wildcard_dgram</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01835"></a>01835 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a4e5db7f9ad90a055e0232f801596e252">kgnilnd_cancel_net_dgrams</a>(<a class="code" href="structkgn__net.html">kgn_net_t</a> *net);
<a name="l01836"></a>01836 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#afc13255d05063a1f24efe5c43019146f">kgnilnd_cancel_wc_dgrams</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01837"></a>01837 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a79091bd9ae8e1203959ee7a1e99060a3">kgnilnd_cancel_dgrams</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01838"></a>01838 <span class="keywordtype">void</span> <a class="code" href="gnilnd_8h.html#a2eda8cca5a4beaa5b316c9817fc2bcd6">kgnilnd_wait_for_canceled_dgrams</a>(<a class="code" href="structkgn__device.html">kgn_device_t</a> *dev);
<a name="l01839"></a>01839 
<a name="l01840"></a>01840 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8h.html#a1296043c6477ca3f825856f772a45e38">kgnilnd_dgram_waitq</a>(<span class="keywordtype">void</span> *arg);
<a name="l01841"></a>01841 
<a name="l01842"></a>01842 <span class="keywordtype">int</span> <a class="code" href="gnilnd_8c.html#a414904ece5fc5f35c276b7d775e1ee54">kgnilnd_set_conn_params</a>(<a class="code" href="structkgn__dgram.html">kgn_dgram_t</a> *dgram);
<a name="l01843"></a>01843 
<a name="l01844"></a>01844 <span class="comment">/* struct2str functions - we don&apos;t use a default: case to cause the compile</span>
<a name="l01845"></a>01845 <span class="comment"> * to fail if there is a missing case. This allows us to hide these down here</span>
<a name="l01846"></a>01846 <span class="comment"> * out of the way but ensure we&apos;ll catch any updates to the enum/types</span>
<a name="l01847"></a>01847 <span class="comment"> * above */</span>
<a name="l01848"></a>01848 
<a name="l01849"></a><a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">01849</a> <span class="preprocessor">#define DO_TYPE(x) case x: return #x;</span>
<a name="l01850"></a>01850 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01851"></a><a class="code" href="gnilnd_8h.html#ae63679d499465f18c88e248421293d9a">01851</a> <a class="code" href="gnilnd_8h.html#ae63679d499465f18c88e248421293d9a">kgnilnd_fmablk_state2str</a>(<a class="code" href="gnilnd_8h.html#a06d1dfb4838b49767f3edc78fdf82066">kgn_fmablk_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>)
<a name="l01852"></a>01852 {
<a name="l01853"></a>01853         <span class="comment">/* Only want single char string for this */</span>
<a name="l01854"></a>01854         <span class="keywordflow">switch</span> (state) {
<a name="l01855"></a>01855         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fead20fc3a310984100fe707210c936f305">GNILND_FMABLK_IDLE</a>:
<a name="l01856"></a>01856                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;I&quot;</span>;
<a name="l01857"></a>01857         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0feae54ea6b5582446ab5dc58dd336f88473">GNILND_FMABLK_PHYS</a>:
<a name="l01858"></a>01858                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;P&quot;</span>;
<a name="l01859"></a>01859         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea1ccd4e5861d4867649a79b03f8e2138c">GNILND_FMABLK_VIRT</a>:
<a name="l01860"></a>01860                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;V&quot;</span>;
<a name="l01861"></a>01861         <span class="keywordflow">case</span> <a class="code" href="gnilnd_8h.html#a6cbe51af58c314ee8bf57c742f0fa0fea74f6c27283107427cfae273924e51c22">GNILND_FMABLK_FREED</a>:
<a name="l01862"></a>01862                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;F&quot;</span>;
<a name="l01863"></a>01863         }
<a name="l01864"></a>01864         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown state&gt;&quot;</span>;
<a name="l01865"></a>01865 }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01868"></a><a class="code" href="gnilnd_8h.html#a28477e0bf33b6093b8992fa3c3bb478f">01868</a> <a class="code" href="gnilnd_8h.html#a28477e0bf33b6093b8992fa3c3bb478f">kgnilnd_msgtype2str</a>(<span class="keywordtype">int</span> type)
<a name="l01869"></a>01869 {
<a name="l01870"></a>01870         <span class="keywordflow">switch</span> (type) {
<a name="l01871"></a>01871                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a414a67f1c1974e853ff67f9e8a55d816">GNILND_MSG_NONE</a>);
<a name="l01872"></a>01872                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a5722734fada0cbc8096711745ea8795b">GNILND_MSG_NOOP</a>);
<a name="l01873"></a>01873                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa3712163c83778e8fa7a39cd6ab6f0c1">GNILND_MSG_IMMEDIATE</a>);
<a name="l01874"></a>01874                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a702af06a92bc7dc05cb1982055af1f97">GNILND_MSG_PUT_REQ</a>);
<a name="l01875"></a>01875                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a6f015e6978308e0d5f5fbf14a8894de2">GNILND_MSG_PUT_NAK</a>);
<a name="l01876"></a>01876                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a538c1e5ea9db30f63148b2e5b5a235cc">GNILND_MSG_PUT_ACK</a>);
<a name="l01877"></a>01877                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a5ad27d7c244ffae29c2768a81db32e5c">GNILND_MSG_PUT_DONE</a>);
<a name="l01878"></a>01878                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a936077dff8b5cb1e39c38821cb3ac8d5">GNILND_MSG_GET_REQ</a>);
<a name="l01879"></a>01879                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a13d525b05522e57c8d1c5bed8368685e">GNILND_MSG_GET_NAK</a>);
<a name="l01880"></a>01880                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a417c47928f8ac6bb2d79c38f8da50fa0">GNILND_MSG_GET_DONE</a>);
<a name="l01881"></a>01881                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#af8624e7fad4aad0b939df186e3df0ed4">GNILND_MSG_CLOSE</a>);
<a name="l01882"></a>01882                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a2d5c4b28bb91e90f8ad935addbb9501e">GNILND_MSG_PUT_REQ_REV</a>);
<a name="l01883"></a>01883                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a060a3d02abd591bc5a8fcad9e6d40635">GNILND_MSG_PUT_DONE_REV</a>);
<a name="l01884"></a>01884                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa55f15ac60dd763125624a47c68a2395">GNILND_MSG_PUT_NAK_REV</a>);
<a name="l01885"></a>01885                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae4cb635f033a4a5cd743a7e5cf36e938">GNILND_MSG_GET_REQ_REV</a>);
<a name="l01886"></a>01886                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9e044e91bd5e297d7a95c30683dca39">GNILND_MSG_GET_ACK_REV</a>);
<a name="l01887"></a>01887                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a41f8050b5f2435ed6307f811a0714c2c">GNILND_MSG_GET_DONE_REV</a>);
<a name="l01888"></a>01888                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a1a778db934f1153cbabbea7e4544d538">GNILND_MSG_GET_NAK_REV</a>);
<a name="l01889"></a>01889         }
<a name="l01890"></a>01890         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown msg type&gt;&quot;</span>;
<a name="l01891"></a>01891 }
<a name="l01892"></a>01892 
<a name="l01893"></a>01893 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01894"></a><a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">01894</a> <a class="code" href="gnilnd_8h.html#a078ad3383290ed293562d1bdc357920c">kgnilnd_tx_state2str</a>(<a class="code" href="gnilnd_8h.html#a38b8712d32989d355a42e43b5f88caac">kgn_tx_list_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a>)
<a name="l01895"></a>01895 {
<a name="l01896"></a>01896         <span class="keywordflow">switch</span> (state) {
<a name="l01897"></a>01897                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a8739fec6255b605c908d3aeec59fff0a">GNILND_TX_IDLE</a>);
<a name="l01898"></a>01898                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad4955dee9ea31427eea5247997e9823f">GNILND_TX_ALLOCD</a>);
<a name="l01899"></a>01899                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6312f8b2c1b9b00de73c2d3db4ee6106">GNILND_TX_PEERQ</a>);
<a name="l01900"></a>01900                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a09c99e12f8ebb98b04230b2ff667bb5f">GNILND_TX_MAPQ</a>);
<a name="l01901"></a>01901                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a99cd00eb5d14d4697d8de0ae650f7daa">GNILND_TX_FMAQ</a>);
<a name="l01902"></a>01902                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ac210d3f46a7c362ff3ad9efb64cc481d">GNILND_TX_LIVE_FMAQ</a>);
<a name="l01903"></a>01903                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a6887bb69af94562ec026e4f1712b9e5f">GNILND_TX_RDMAQ</a>);
<a name="l01904"></a>01904                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3ad78d48c99675ed032b94c38630676a1a">GNILND_TX_LIVE_RDMAQ</a>);
<a name="l01905"></a>01905                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a28a44586e091e1f2e302c0acb17149d3">GNILND_TX_DYING</a>);
<a name="l01906"></a>01906                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ac9f81a13a3450db4fdb51dd5da9038f3a23ca8db5b03dbf6da9db4afea6c4df1b">GNILND_TX_FREED</a>);
<a name="l01907"></a>01907         }
<a name="l01908"></a>01908         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown state&gt;&quot;</span>;
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01912"></a><a class="code" href="gnilnd_8h.html#ada5547c7acae43a0f8e8053b46407adf">01912</a> <a class="code" href="gnilnd_8h.html#ada5547c7acae43a0f8e8053b46407adf">kgnilnd_conn_state2str</a>(<a class="code" href="structkgn__conn.html">kgn_conn_t</a> *conn)
<a name="l01913"></a>01913 {
<a name="l01914"></a>01914         <a class="code" href="gnilnd_8h.html#a4f644ae1efecea5e3de0d0c2668ccd48">kgn_conn_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a> = conn-&gt;<a class="code" href="structkgn__conn.html#a2399b04e7ded56efe4ae3ba8a431e60a">gnc_state</a>;
<a name="l01915"></a>01915         <span class="keywordflow">switch</span> (state) {
<a name="l01916"></a>01916                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a89df6bf549010018c49e9400c43a9e1f">GNILND_CONN_DUMMY</a>);
<a name="l01917"></a>01917                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ac4ac654d4d5d3662eec243dc2bfbad79">GNILND_CONN_LISTEN</a>);
<a name="l01918"></a>01918                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840acd29011708f4d20d63b00a2e3434dbbf">GNILND_CONN_CONNECTING</a>);
<a name="l01919"></a>01919                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840af38207cc4ea93ca58295feab9e5b06b1">GNILND_CONN_ESTABLISHED</a>);
<a name="l01920"></a>01920                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a198bdaa9e3fd0230119414f84e5d79e0">GNILND_CONN_CLOSING</a>);
<a name="l01921"></a>01921                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840ae368bc5dd559c5dd2b6deaa1b740e956">GNILND_CONN_CLOSED</a>);
<a name="l01922"></a>01922                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840aed4aabd8d35d04ac367aa184eed376e2">GNILND_CONN_DONE</a>);
<a name="l01923"></a>01923                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a32505d3fed0776333ac6c392b9138840a4bce15e927727fef1b9297edccd05c33">GNILND_CONN_DESTROY_EP</a>);
<a name="l01924"></a>01924         }
<a name="l01925"></a>01925         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;?state?&gt;&quot;</span>;
<a name="l01926"></a>01926 }
<a name="l01927"></a>01927 
<a name="l01928"></a>01928 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01929"></a><a class="code" href="gnilnd_8h.html#ab194f631fecd0ca00918602b420409ca">01929</a> <a class="code" href="gnilnd_8h.html#ab194f631fecd0ca00918602b420409ca">kgnilnd_connreq_type2str</a>(kgn_connreq_t *connreq)
<a name="l01930"></a>01930 {
<a name="l01931"></a>01931         <a class="code" href="gnilnd_8h.html#ad9e9bf7209c754ba088533226ac5ab78">kgn_connreq_type_t</a> type = connreq-&gt;<a class="code" href="structkgn__connreq.html#a3f5e7b13bcf2d9713f74a9a1b9826ee6">gncr_type</a>;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933         <span class="keywordflow">switch</span> (type) {
<a name="l01934"></a>01934                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a48dd218ba2da7bccf230d76dad5a5b41">GNILND_CONNREQ_REQ</a>);
<a name="l01935"></a>01935                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777a94d5a8f2d421f134365d87243edfed68">GNILND_CONNREQ_NAK</a>);
<a name="l01936"></a>01936                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#a6c9695fbb09051832186b293ea4fe777adaa4234e3db40364268a026b60d5dc52">GNILND_CONNREQ_CLOSE</a>);
<a name="l01937"></a>01937         }
<a name="l01938"></a>01938         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;?type?&gt;&quot;</span>;
<a name="l01939"></a>01939 }
<a name="l01940"></a>01940 
<a name="l01941"></a>01941 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01942"></a><a class="code" href="gnilnd_8h.html#acc0ed17e2d524b0f29db5479f1dcda93">01942</a> <a class="code" href="gnilnd_8h.html#acc0ed17e2d524b0f29db5479f1dcda93">kgnilnd_dgram_state2str</a>(<a class="code" href="structkgn__dgram.html">kgn_dgram_t</a> *dgram)
<a name="l01943"></a>01943 {
<a name="l01944"></a>01944         <a class="code" href="gnilnd_8h.html#a3d5cd3fca3d3f36c8be443bd43b1c1bb">kgn_dgram_state_t</a> <a class="code" href="fsx_8c.html#a5797ba50831ee71f60588abd75d2992e">state</a> = dgram-&gt;<a class="code" href="structkgn__dgram.html#a8b0ce0b83a279a3190ab756895b9db0f">gndg_state</a>;
<a name="l01945"></a>01945 
<a name="l01946"></a>01946         <span class="keywordflow">switch</span> (state) {
<a name="l01947"></a>01947                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a954d2d6a8ab6239c849b6e26bcfe0643">GNILND_DGRAM_USED</a>);
<a name="l01948"></a>01948                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a0412913cdbcb1e664ff635883302180a">GNILND_DGRAM_POSTING</a>);
<a name="l01949"></a>01949                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a16f6b012f4ea48a0a117372ddebbae18">GNILND_DGRAM_POSTED</a>);
<a name="l01950"></a>01950                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ad27651948750cad41bba3e4ad706a740">GNILND_DGRAM_PROCESSING</a>);
<a name="l01951"></a>01951                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950ab7d8300a4cbfd5b331e8018b4822f6f9">GNILND_DGRAM_DONE</a>);
<a name="l01952"></a>01952                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#ae1d78d2b5773655ce426324d420bb950a671b81e5dd1707df3626ecd10d7ee68c">GNILND_DGRAM_CANCELED</a>);
<a name="l01953"></a>01953         }
<a name="l01954"></a>01954         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;?state?&gt;&quot;</span>;
<a name="l01955"></a>01955 }
<a name="l01956"></a>01956 
<a name="l01957"></a>01957 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01958"></a><a class="code" href="gnilnd_8h.html#a58b8a57bd15297dc6fd25a5677d3fd8c">01958</a> <a class="code" href="gnilnd_8h.html#a58b8a57bd15297dc6fd25a5677d3fd8c">kgnilnd_dgram_type2str</a>(<a class="code" href="structkgn__dgram.html">kgn_dgram_t</a> *dgram)
<a name="l01959"></a>01959 {
<a name="l01960"></a>01960         <a class="code" href="gnilnd_8h.html#af8b8123cb6d7bda204f2f338f545833a">kgn_dgram_type_t</a> type = dgram-&gt;<a class="code" href="structkgn__dgram.html#a9fbb47038f88c0f2a2b4063511c12d18">gndg_type</a>;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962         <span class="keywordflow">switch</span> (type) {
<a name="l01963"></a>01963                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a4a4f3521baf43868818329dad6d38e60">GNILND_DGRAM_REQ</a>);
<a name="l01964"></a>01964                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26ac7a6edaf2f13914a807a7a72518e4358">GNILND_DGRAM_WC_REQ</a>);
<a name="l01965"></a>01965                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a8f76fc062376a06723fcaacc88d7b4e2">GNILND_DGRAM_NAK</a>);
<a name="l01966"></a>01966                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26adea4a1be184d633910794cc89443418e">GNILND_DGRAM_CLOSE</a>);
<a name="l01967"></a>01967         }
<a name="l01968"></a>01968         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;?type?&gt;&quot;</span>;
<a name="l01969"></a>01969 }
<a name="l01970"></a>01970 
<a name="l01971"></a>01971 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01972"></a><a class="code" href="gnilnd_8h.html#a04cecdac8881b4a108dc42174aec3436">01972</a> <a class="code" href="gnilnd_8h.html#a04cecdac8881b4a108dc42174aec3436">kgnilnd_conn_dgram_type2str</a>(<a class="code" href="gnilnd_8h.html#af8b8123cb6d7bda204f2f338f545833a">kgn_dgram_type_t</a> type)
<a name="l01973"></a>01973 {
<a name="l01974"></a>01974         <span class="keywordflow">switch</span> (type) {
<a name="l01975"></a>01975                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a4a4f3521baf43868818329dad6d38e60">GNILND_DGRAM_REQ</a>);
<a name="l01976"></a>01976                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26ac7a6edaf2f13914a807a7a72518e4358">GNILND_DGRAM_WC_REQ</a>);
<a name="l01977"></a>01977                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26a8f76fc062376a06723fcaacc88d7b4e2">GNILND_DGRAM_NAK</a>);
<a name="l01978"></a>01978                 <a class="code" href="gnilnd_8h.html#ac9f344507b753298ec910fb9c374bfb9">DO_TYPE</a>(<a class="code" href="gnilnd_8h.html#aa8e915c6b7a2bb3f50b6c32283be2e26adea4a1be184d633910794cc89443418e">GNILND_DGRAM_CLOSE</a>);
<a name="l01979"></a>01979         }
<a name="l01980"></a>01980         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;?type?&gt;&quot;</span>;
<a name="l01981"></a>01981 }
<a name="l01982"></a>01982 
<a name="l01983"></a>01983 <span class="preprocessor">#undef DO_TYPE</span>
<a name="l01984"></a>01984 <span class="preprocessor"></span>
<a name="l01985"></a>01985 <span class="comment">/* pulls in tunables per platform and adds in nid/nic conversion</span>
<a name="l01986"></a>01986 <span class="comment"> * if RCA wasn&apos;t available at build time */</span>
<a name="l01987"></a>01987 <span class="preprocessor">#include &quot;<a class="code" href="gnilnd__hss__ops_8h.html">gnilnd_hss_ops.h</a>&quot;</span>
<a name="l01988"></a>01988 <span class="comment">/* API wrapper functions - include late to pick up all of the other defines */</span>
<a name="l01989"></a>01989 <span class="preprocessor">#include &quot;<a class="code" href="gnilnd__api__wrap_8h.html">gnilnd_api_wrap.h</a>&quot;</span>
<a name="l01990"></a>01990 
<a name="l01991"></a>01991 <span class="preprocessor">#if defined(CONFIG_CRAY_GEMINI)</span>
<a name="l01992"></a>01992 <span class="preprocessor"></span><span class="preprocessor"> #include &quot;<a class="code" href="gnilnd__gemini_8h.html">gnilnd_gemini.h</a>&quot;</span>
<a name="l01993"></a>01993 <span class="preprocessor">#elif defined(CONFIG_CRAY_ARIES)</span>
<a name="l01994"></a>01994 <span class="preprocessor"></span><span class="preprocessor"> #include &quot;<a class="code" href="gnilnd__aries_8h.html">gnilnd_aries.h</a>&quot;</span>
<a name="l01995"></a>01995 <span class="preprocessor">#else</span>
<a name="l01996"></a>01996 <span class="preprocessor"></span><span class="preprocessor"> #error &quot;Undefined Network Hardware Type&quot;</span>
<a name="l01997"></a>01997 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01998"></a>01998 <span class="preprocessor"></span>
<a name="l01999"></a>01999 <span class="keyword">extern</span> uint32_t <a class="code" href="gnilnd_8h.html#aa9220f0fe53ae570c4bd4a40d465552a">kgni_driver_version</a>;
<a name="l02000"></a>02000 
<a name="l02001"></a>02001 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l02002"></a><a class="code" href="gnilnd_8h.html#a37b108828937dfbcd8015afe7e7102d8">02002</a> <a class="code" href="gnilnd_8h.html#a37b108828937dfbcd8015afe7e7102d8">kgnilnd_check_kgni_version</a>(<span class="keywordtype">void</span>)
<a name="l02003"></a>02003 {
<a name="l02004"></a>02004         uint32_t *kdv;
<a name="l02005"></a>02005 
<a name="l02006"></a>02006         kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a> = 1;
<a name="l02007"></a>02007         kdv = symbol_get(kgni_driver_version);
<a name="l02008"></a>02008         <span class="keywordflow">if</span> (!kdv) {
<a name="l02009"></a>02009                 <a class="code" href="libcfs__debug_8h.html#a43240b2ab1235407f143ed4582ea1f75">LCONSOLE_INFO</a>(<span class="stringliteral">&quot;Not using thread safe locking -&quot;</span>
<a name="l02010"></a>02010                         <span class="stringliteral">&quot; no symbol kgni_driver_version\n&quot;</span>);
<a name="l02011"></a>02011                 <span class="keywordflow">return</span>;
<a name="l02012"></a>02012         }
<a name="l02013"></a>02013 
<a name="l02014"></a>02014         <span class="comment">/* Thread-safe kgni implemented in minor ver 0x44/45, code rev 0xb9 */</span>
<a name="l02015"></a>02015         <span class="keywordflow">if</span> (*kdv &lt; <a class="code" href="gni__pub_8h.html#ae121de26e2301e02486e9b1383496f16">GNI_VERSION_CHECK</a>(0, <a class="code" href="gnilnd__aries_8h.html#a7ffd5f836e1984f7f0dda363c3ad8dff">GNILND_KGNI_TS_MINOR_VER</a>, 0xb9)) {
<a name="l02016"></a>02016                 symbol_put(kgni_driver_version);
<a name="l02017"></a>02017                 <a class="code" href="libcfs__debug_8h.html#a43240b2ab1235407f143ed4582ea1f75">LCONSOLE_INFO</a>(<span class="stringliteral">&quot;Not using thread safe locking, gni version 0x%x,&quot;</span>
<a name="l02018"></a>02018                         <span class="stringliteral">&quot; need &gt;= 0x%x\n&quot;</span>, *kdv,
<a name="l02019"></a>02019                         <a class="code" href="gni__pub_8h.html#ae121de26e2301e02486e9b1383496f16">GNI_VERSION_CHECK</a>(0, <a class="code" href="gnilnd__aries_8h.html#a7ffd5f836e1984f7f0dda363c3ad8dff">GNILND_KGNI_TS_MINOR_VER</a>, 0xb9));
<a name="l02020"></a>02020                 <span class="keywordflow">return</span>;
<a name="l02021"></a>02021         }
<a name="l02022"></a>02022 
<a name="l02023"></a>02023         symbol_put(kgni_driver_version);
<a name="l02024"></a>02024 
<a name="l02025"></a>02025         <span class="keywordflow">if</span> (!*kgnilnd_tunables.<a class="code" href="structkgn__tunables.html#ac8b5703b9dd55c8dfc5e43b3ef16373e">kgn_thread_safe</a>) {
<a name="l02026"></a>02026                 <span class="keywordflow">return</span>;
<a name="l02027"></a>02027         }
<a name="l02028"></a>02028 
<a name="l02029"></a>02029         <span class="comment">/* Use thread-safe locking */</span>
<a name="l02030"></a>02030         kgnilnd_data.<a class="code" href="structkgn__data.html#a33b5587bb2263ac80dfb0fda6031902a">kgn_enable_gl_mutex</a> = 0;
<a name="l02031"></a>02031 }
<a name="l02032"></a>02032 
<a name="l02033"></a>02033 <span class="preprocessor">#endif </span><span class="comment">/* _GNILND_GNILND_H_ */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:54:33 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
