<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: cl_lock</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cl_lock<br/>
<small>
[<a class="el" href="group__clio.html">clio</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for cl_lock:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__cl__lock.png" border="0" alt="" usemap="#group____cl____lock_map"/>
<map name="group____cl____lock_map" id="group____cl____lock">
<area shape="rect" id="node1" href="group__clio.html" title="Client objects implement io operations and cache pages." alt="" coords="7,5,49,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__lock__descr.html">cl_lock_descr</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lock description.  <a href="structcl__lock__descr.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__lock.html">cl_lock</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Layered client lock.  <a href="structcl__lock.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__lock__slice.html">cl_lock_slice</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Per-layer part of <a class="el" href="structcl__lock.html" title="Layered client lock.">cl_lock</a>.  <a href="structcl__lock__slice.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__lock__operations.html">cl_lock_operations</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaa48eed39677054974791fe8eacf7db52"></a><!-- doxytag: member="cl_lock::DDESCR" ref="gaa48eed39677054974791fe8eacf7db52" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>DDESCR</b>&nbsp;&nbsp;&nbsp;&quot;%s(%d):[%lu, %lu]:%x&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>PDESCR</b>(descr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CL_LOCK_DEBUG</b>(mask, env, lock, format,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CL_LOCK_ASSERT</b>(expr, env, lock)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#ga85e741e93c4ba0b8fd87206425e347a1">cl_lock_mode</a> { <b>CLM_READ</b>, 
<b>CLM_WRITE</b>, 
<b>CLM_GROUP</b>, 
<b>CLM_MAX</b>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Lock mode. </p>
 <a href="group__cl__lock.html#ga85e741e93c4ba0b8fd87206425e347a1">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#ga37f72b37baaeba18d9e0fac4560ec902">cl_enq_flags</a> { <br/>
&nbsp;&nbsp;<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a1562800e334f5cb2c074f41cc5b0bf1c">CEF_NONBLOCK</a> =  0x00000001, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a432de84a3a6c92d385d1455be6b0272b">CEF_ASYNC</a> =  0x00000002, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a2b96e0457cbff9ba9a8aa854009cf8da">CEF_DISCARD_DATA</a> =  0x00000004, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902acf6cb6d67732370185bebac31ca6ef29">CEF_MUST</a> =  0x00000008, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a0a16d738d6f6b4a50693501adc8e310d">CEF_NEVER</a> =  0x00000010, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a143ec61f815da4099f40d16b5e1b13d2">CEF_AGL</a> =  0x00000020, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a469f38a944b34de3f51d2f2964202604">CEF_PEEK</a> =  0x00000040, 
<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a61dce4cb6cb397ffffaf1c6d5d8608db">CEF_LOCK_MATCH</a> =  0x00000080, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a1a094fe2f0162ab8a02816903d804d97">CEF_MASK</a> =  0x000000ff
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Flags to lock enqueue procedure. </p>
 <a href="group__cl__lock.html#ga37f72b37baaeba18d9e0fac4560ec902">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaef00eb170071c4836742562b90e49750"></a><!-- doxytag: member="cl_lock::cl_lock_mode_name" ref="gaef00eb170071c4836742562b90e49750" args="(const enum cl_lock_mode mode)" -->
const char *&nbsp;</td><td class="memItemRight" valign="bottom"><b>cl_lock_mode_name</b> (const enum <a class="el" href="group__cl__lock.html#ga85e741e93c4ba0b8fd87206425e347a1">cl_lock_mode</a> mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4afe671873f4a7343d9c50c574557fd6"></a><!-- doxytag: member="cl_lock::cl_lock_request" ref="ga4afe671873f4a7343d9c50c574557fd6" args="(const struct lu_env *env, struct cl_io *io, struct cl_lock *lock)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#ga4afe671873f4a7343d9c50c574557fd6">cl_lock_request</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main high-level entry point of <a class="el" href="structcl__lock.html" title="Layered client lock.">cl_lock</a> interface that finds existing or enqueues new lock matching given description. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga936be055d2a7449907656154d8970dc0"></a><!-- doxytag: member="cl_lock::cl_lock_init" ref="ga936be055d2a7449907656154d8970dc0" args="(const struct lu_env *env, struct cl_lock *lock, const struct cl_io *io)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>cl_lock_init</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock, const struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga61a295e97704c2509c99d3f7d8711a95"></a><!-- doxytag: member="cl_lock::cl_lock_fini" ref="ga61a295e97704c2509c99d3f7d8711a95" args="(const struct lu_env *env, struct cl_lock *lock)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>cl_lock_fini</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structcl__lock__slice.html">cl_lock_slice</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#ga9b59ad7624c11fcecf6eadb1a58f6f8b">cl_lock_at</a> (const struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock, const struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *dtype)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns a slice with a lock, corresponding to the given layer in the device stack.  <a href="#ga9b59ad7624c11fcecf6eadb1a58f6f8b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4e8069a400c6a75342649a6fc04fa2c3"></a><!-- doxytag: member="cl_lock::cl_lock_release" ref="ga4e8069a400c6a75342649a6fc04fa2c3" args="(const struct lu_env *env, struct cl_lock *lock)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#ga4e8069a400c6a75342649a6fc04fa2c3">cl_lock_release</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Releases a hold and a reference on a lock, obtained by cl_lock_hold(). <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__lock.html#gab9d3d1e316773c71555cbb8e29ca0403">cl_lock_enqueue</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock, struct <a class="el" href="structcl__sync__io.html">cl_sync_io</a> *anchor)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enqueue a lock.  <a href="#gab9d3d1e316773c71555cbb8e29ca0403"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaab3c1781a296023121c2641a117a57b1"></a><!-- doxytag: member="cl_lock::cl_lock_cancel" ref="gaab3c1781a296023121c2641a117a57b1" args="(const struct lu_env *env, struct cl_lock *lock)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>cl_lock_cancel</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__lock.html">cl_lock</a> *lock)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga141b4ac98e80211e16e7866b193053ef"></a><!-- doxytag: member="cl_object.h::CL_LOCK_ASSERT" ref="ga141b4ac98e80211e16e7866b193053ef" args="(expr, env, lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CL_LOCK_ASSERT</td>
          <td>(</td>
          <td class="paramtype">expr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">env, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                            \
        <span class="keywordflow">if</span> (likely(expr))                                               \
                <span class="keywordflow">break</span>;                                                  \
                                                                        \
        CL_LOCK_DEBUG(D_ERROR, env, lock, <span class="stringliteral">&quot;failed at %s.\n&quot;</span>, #expr);    \
        LBUG();                                                         \
} <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01262">1262</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga81d354408ca5abbfe26fcd44665e7e23"></a><!-- doxytag: member="cl_object.h::CL_LOCK_DEBUG" ref="ga81d354408ca5abbfe26fcd44665e7e23" args="(mask, env, lock, format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CL_LOCK_DEBUG</td>
          <td>(</td>
          <td class="paramtype">mask, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">env, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lock, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">format, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"> <em>...</em>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                    \
        <span class="keywordflow">if</span> (cfs_cdebug_show(mask, DEBUG_SUBSYSTEM)) {                   \
                LIBCFS_DEBUG_MSG_DATA_DECL(msgdata, mask, NULL);        \
                <a class="code" href="group__cl__page.html#gae62cdffcc2ad419c1efe15d3f7e2b7be" title="Prints human readable representation of lock to the f.">cl_lock_print</a>(env, &amp;msgdata, <a class="code" href="group__lu.html#gaea04856d0829f02ff6e8b5b957cd8a52" title="Printer function emitting messages through libcfs_debug_msg().">lu_cdebug_printer</a>, lock);  \
                CDEBUG(mask, format , ## __VA_ARGS__);                  \
        }                                                               \
} <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01253">1253</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga207d24f359de64af33fe97e97dc08843"></a><!-- doxytag: member="cl_object.h::PDESCR" ref="ga207d24f359de64af33fe97e97dc08843" args="(descr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PDESCR</td>
          <td>(</td>
          <td class="paramtype">descr&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">cl_lock_mode_name((descr)-&gt;cld_mode), (descr)-&gt;cld_mode,        \
        (descr)-&gt;cld_start, (descr)-&gt;cld_end, (descr)-&gt;cld_enq_flags
</pre></div>
<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01180">1180</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ga37f72b37baaeba18d9e0fac4560ec902"></a><!-- doxytag: member="cl_object.h::cl_enq_flags" ref="ga37f72b37baaeba18d9e0fac4560ec902" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__lock.html#ga37f72b37baaeba18d9e0fac4560ec902">cl_enq_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flags to lock enqueue procedure. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a1562800e334f5cb2c074f41cc5b0bf1c"></a><!-- doxytag: member="CEF_NONBLOCK" ref="gga37f72b37baaeba18d9e0fac4560ec902a1562800e334f5cb2c074f41cc5b0bf1c" args="" -->CEF_NONBLOCK</em>&nbsp;</td><td>
<p>instruct server to not block, if conflicting lock is found. </p>
<p>Instead -EWOULDBLOCK is returned immediately. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a432de84a3a6c92d385d1455be6b0272b"></a><!-- doxytag: member="CEF_ASYNC" ref="gga37f72b37baaeba18d9e0fac4560ec902a432de84a3a6c92d385d1455be6b0272b" args="" -->CEF_ASYNC</em>&nbsp;</td><td>
<p>take lock asynchronously (out of order), as it cannot deadlock. </p>
<p>This is for LDLM_FL_HAS_INTENT locks used for glimpsing. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a2b96e0457cbff9ba9a8aa854009cf8da"></a><!-- doxytag: member="CEF_DISCARD_DATA" ref="gga37f72b37baaeba18d9e0fac4560ec902a2b96e0457cbff9ba9a8aa854009cf8da" args="" -->CEF_DISCARD_DATA</em>&nbsp;</td><td>
<p>tell the server to instruct (though a flag in the blocking ast) an owner of the conflicting lock, that it can drop dirty pages protected by this lock, without sending them to the server. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902acf6cb6d67732370185bebac31ca6ef29"></a><!-- doxytag: member="CEF_MUST" ref="gga37f72b37baaeba18d9e0fac4560ec902acf6cb6d67732370185bebac31ca6ef29" args="" -->CEF_MUST</em>&nbsp;</td><td>
<p>tell the sub layers that it must be a `real' lock. </p>
<p>This is used for mmapped-buffer locks and glimpse locks that must be never converted into lockless mode.</p>
<dl class="see"><dt><b>See also:</b></dt><dd>vvp_mmap_locks(), cl_glimpse_lock(). </dd></dl>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a0a16d738d6f6b4a50693501adc8e310d"></a><!-- doxytag: member="CEF_NEVER" ref="gga37f72b37baaeba18d9e0fac4560ec902a0a16d738d6f6b4a50693501adc8e310d" args="" -->CEF_NEVER</em>&nbsp;</td><td>
<p>tell the sub layers that never request a `real' lock. </p>
<p>This flag is not used currently.</p>
<p><a class="el" href="structcl__io.html#a245a0c27f43614baa43128f2e82867fa" title="lock requirements, this is just a help info for sublayers.">cl_io::ci_lockreq</a> and CEF_{MUST,NEVER} flags specify lockless conversion policy: ci_lockreq describes generic information of lock requirement for this IO, especially for locks which belong to the object doing IO; however, lock itself may have precise requirements that are described by the enqueue flags. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a143ec61f815da4099f40d16b5e1b13d2"></a><!-- doxytag: member="CEF_AGL" ref="gga37f72b37baaeba18d9e0fac4560ec902a143ec61f815da4099f40d16b5e1b13d2" args="" -->CEF_AGL</em>&nbsp;</td><td>
<p>for async glimpse lock. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a469f38a944b34de3f51d2f2964202604"></a><!-- doxytag: member="CEF_PEEK" ref="gga37f72b37baaeba18d9e0fac4560ec902a469f38a944b34de3f51d2f2964202604" args="" -->CEF_PEEK</em>&nbsp;</td><td>
<p>enqueue a lock to test DLM lock existence. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a61dce4cb6cb397ffffaf1c6d5d8608db"></a><!-- doxytag: member="CEF_LOCK_MATCH" ref="gga37f72b37baaeba18d9e0fac4560ec902a61dce4cb6cb397ffffaf1c6d5d8608db" args="" -->CEF_LOCK_MATCH</em>&nbsp;</td><td>
<p>Lock match only. </p>
<p>Used by group lock in I/O as group lock is known to exist. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga37f72b37baaeba18d9e0fac4560ec902a1a094fe2f0162ab8a02816903d804d97"></a><!-- doxytag: member="CEF_MASK" ref="gga37f72b37baaeba18d9e0fac4560ec902a1a094fe2f0162ab8a02816903d804d97" args="" -->CEF_MASK</em>&nbsp;</td><td>
<p>mask of enq_flags. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01601">1601</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01601"></a>01601                   {
<a name="l01606"></a>01606         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a1562800e334f5cb2c074f41cc5b0bf1c" title="instruct server to not block, if conflicting lock is found.">CEF_NONBLOCK</a>     = 0x00000001,
<a name="l01611"></a>01611         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a432de84a3a6c92d385d1455be6b0272b" title="take lock asynchronously (out of order), as it cannot deadlock.">CEF_ASYNC</a>        = 0x00000002,
<a name="l01617"></a>01617         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a2b96e0457cbff9ba9a8aa854009cf8da" title="tell the server to instruct (though a flag in the blocking ast) an owner of the conflicting...">CEF_DISCARD_DATA</a> = 0x00000004,
<a name="l01625"></a>01625         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902acf6cb6d67732370185bebac31ca6ef29" title="tell the sub layers that it must be a `real&amp;#39; lock.">CEF_MUST</a>         = 0x00000008,
<a name="l01636"></a>01636         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a0a16d738d6f6b4a50693501adc8e310d" title="tell the sub layers that never request a `real&amp;#39; lock.">CEF_NEVER</a>        = 0x00000010,
<a name="l01640"></a>01640         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a143ec61f815da4099f40d16b5e1b13d2" title="for async glimpse lock.">CEF_AGL</a>          = 0x00000020,
<a name="l01644"></a>01644         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a469f38a944b34de3f51d2f2964202604" title="enqueue a lock to test DLM lock existence.">CEF_PEEK</a>        = 0x00000040,
<a name="l01649"></a>01649         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a61dce4cb6cb397ffffaf1c6d5d8608db" title="Lock match only.">CEF_LOCK_MATCH</a>  = 0x00000080,
<a name="l01653"></a>01653         <a class="code" href="group__cl__lock.html#gga37f72b37baaeba18d9e0fac4560ec902a1a094fe2f0162ab8a02816903d804d97" title="mask of enq_flags.">CEF_MASK</a>         = 0x000000ff,
<a name="l01654"></a>01654 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga85e741e93c4ba0b8fd87206425e347a1"></a><!-- doxytag: member="cl_object.h::cl_lock_mode" ref="ga85e741e93c4ba0b8fd87206425e347a1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__lock.html#ga85e741e93c4ba0b8fd87206425e347a1">cl_lock_mode</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lock mode. </p>
<p>For the client extent locks. </p>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l00776">776</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00776"></a>00776                   {
<a name="l00777"></a>00777         CLM_READ,
<a name="l00778"></a>00778         CLM_WRITE,
<a name="l00779"></a>00779         CLM_GROUP,
<a name="l00780"></a>00780         CLM_MAX,
<a name="l00781"></a>00781 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga9b59ad7624c11fcecf6eadb1a58f6f8b"></a><!-- doxytag: member="cl_object.h::cl_lock_at" ref="ga9b59ad7624c11fcecf6eadb1a58f6f8b" args="(const struct cl_lock *lock, const struct lu_device_type *dtype)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcl__lock__slice.html">cl_lock_slice</a>* cl_lock_at </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structcl__lock.html">cl_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__device__type.html">lu_device_type</a> *&nbsp;</td>
          <td class="paramname"> <em>dtype</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns a slice with a lock, corresponding to the given layer in the device stack. </p>
<dl class="see"><dt><b>See also:</b></dt><dd>cl_page_at() </dd></dl>

<p>Definition at line <a class="el" href="cl__lock_8c_source.html#l00134">134</a> of file <a class="el" href="cl__lock_8c_source.html">cl_lock.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01191">cll_layers</a>, <a class="el" href="cl__object_8h_source.html#l01208">cl_lock_slice::cls_linkage</a>, <a class="el" href="cl__object_8h_source.html#l01205">cl_lock_slice::cls_obj</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, <a class="el" href="lu__object_8h_source.html#l00275">lu_device::ld_type</a>, and <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__lock__slice.html" title="Per-layer part of cl_lock.">cl_lock_slice</a> *slice;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         ENTRY;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         list_for_each_entry(slice, &amp;lock-&gt;<a class="code" href="structcl__lock.html#a0b01a26d3cefbee85d1c803a490b34e8" title="List of slices.">cll_layers</a>, <a class="code" href="structcl__lock__slice.html#ade7bcd39b007dcafd05e98434e3ee990" title="Linkage into cl_lock::cll_layers.">cls_linkage</a>) {
<a name="l00142"></a>00142                 <span class="keywordflow">if</span> (slice-&gt;<a class="code" href="structcl__lock__slice.html#a7b92d10a7e81059bb811ba196a438d56" title="Object slice corresponding to this lock slice.">cls_obj</a>-&gt;<a class="code" href="structcl__object.html#acff3a09f38d513eda81deb6644332c2d" title="super class">co_lu</a>.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>-&gt;<a class="code" href="structlu__device.html#ad5886c6b5e9a91f07f22d33bbcdb5718" title="Pointer to device type.">ld_type</a> == dtype)
<a name="l00143"></a>00143                         RETURN(slice);
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145         RETURN(NULL);
<a name="l00146"></a>00146 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gab9d3d1e316773c71555cbb8e29ca0403"></a><!-- doxytag: member="cl_object.h::cl_lock_enqueue" ref="gab9d3d1e316773c71555cbb8e29ca0403" args="(const struct lu_env *env, struct cl_io *io, struct cl_lock *lock, struct cl_sync_io *anchor)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_lock_enqueue </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__lock.html">cl_lock</a> *&nbsp;</td>
          <td class="paramname"> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__sync__io.html">cl_sync_io</a> *&nbsp;</td>
          <td class="paramname"> <em>anchor</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enqueue a lock. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>anchor,:</em>&nbsp;</td><td>if we need to wait for resources before getting the lock, use <a class="anchor" id="for"></a> the purpose. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>enqueue successfully </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>&lt;0</em>&nbsp;</td><td>error code </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cl__lock_8c_source.html#l00171">171</a> of file <a class="el" href="cl__lock_8c_source.html">cl_lock.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01191">cll_layers</a>, <a class="el" href="structcl__lock__operations.html#ac662a1c9135cac8c084a7c95d6fc19d7">cl_lock_operations::clo_enqueue</a>, and <a class="el" href="cl__object_8h_source.html#l01208">cl_lock_slice::cls_linkage</a>.</p>

<p>Referenced by <a class="el" href="cl__lock_8c_source.html#l00195">cl_lock_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__lock__slice.html" title="Per-layer part of cl_lock.">cl_lock_slice</a>      *slice;
<a name="l00175"></a>00175         <span class="keywordtype">int</span>                             rc = -ENOSYS;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         ENTRY;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         list_for_each_entry(slice, &amp;lock-&gt;<a class="code" href="structcl__lock.html#a0b01a26d3cefbee85d1c803a490b34e8" title="List of slices.">cll_layers</a>, <a class="code" href="structcl__lock__slice.html#ade7bcd39b007dcafd05e98434e3ee990" title="Linkage into cl_lock::cll_layers.">cls_linkage</a>) {
<a name="l00180"></a>00180                 <span class="keywordflow">if</span> (slice-&gt;cls_ops-&gt;<a class="code" href="structcl__lock__operations.html#ac662a1c9135cac8c084a7c95d6fc19d7" title="Attempts to enqueue the lock.">clo_enqueue</a> == NULL)
<a name="l00181"></a>00181                         <span class="keywordflow">continue</span>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183                 rc = slice-&gt;cls_ops-&gt;<a class="code" href="structcl__lock__operations.html#ac662a1c9135cac8c084a7c95d6fc19d7" title="Attempts to enqueue the lock.">clo_enqueue</a>(env, slice, io, anchor);
<a name="l00184"></a>00184                 <span class="keywordflow">if</span> (rc != 0)
<a name="l00185"></a>00185                         <span class="keywordflow">break</span>;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         RETURN(rc);
<a name="l00188"></a>00188 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__lock_gab9d3d1e316773c71555cbb8e29ca0403_icgraph.png" border="0" usemap="#group__cl__lock_gab9d3d1e316773c71555cbb8e29ca0403_icgraph_map" alt=""></div>
<map name="group__cl__lock_gab9d3d1e316773c71555cbb8e29ca0403_icgraph_map" id="group__cl__lock_gab9d3d1e316773c71555cbb8e29ca0403_icgraph">
<area shape="rect" id="node3" href="group__cl__lock.html#ga4afe671873f4a7343d9c50c574557fd6" title="Main high&#45;level entry point of cl_lock interface that finds existing or enqueues..." alt="" coords="188,5,313,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:38 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
