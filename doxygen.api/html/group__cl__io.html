<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: cl_io</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cl_io<br/>
<small>
[<a class="el" href="group__clio.html">clio</a>]</small>
</h1>
<p><div class="dynheader">
Collaboration diagram for cl_io:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__cl__io.png" border="0" alt="" usemap="#group____cl____io_map"/>
<map name="group____cl____io_map" id="group____cl____io">
<area shape="rect" id="node1" href="group__clio.html" title="Client objects implement io operations and cache pages." alt="" coords="7,5,49,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__io__slice.html">cl_io_slice</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">IO state private for a layer.  <a href="structcl__io__slice.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__read__ahead.html">cl_read_ahead</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__io__operations.html">cl_io_operations</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Per-layer io operations.  <a href="structcl__io__operations.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__io__lock__link.html">cl_io_lock_link</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Link between lock and io.  <a href="structcl__io__lock__link.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__lockset.html">cl_lockset</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lock-set represents a collection of locks, that io needs at a time.  <a href="structcl__lockset.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__io__rw__common.html">cl_io_rw_common</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcl__io.html">cl_io</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State for io.  <a href="structcl__io.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad8a155eb56429b6d2ad9515eb4c4c5b5"></a><!-- doxytag: member="cl_io::cill_descr" ref="gad8a155eb56429b6d2ad9515eb4c4c5b5" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>cill_descr</b>&nbsp;&nbsp;&nbsp;cill_lock.cll_descr</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CL_IO_SLICE_CLEAN</b>(foo_io, base)</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga54c4de6c969138d0642ef59a1ff5e0b0"></a><!-- doxytag: member="cl_io::cl_commit_cbt" ref="ga54c4de6c969138d0642ef59a1ff5e0b0" args=")(const struct lu_env *, struct cl_io *, struct cl_page *)" -->
typedef void(*&nbsp;</td><td class="memItemRight" valign="bottom"><b>cl_commit_cbt</b> )(const struct <a class="el" href="structlu__env.html">lu_env</a> *, struct <a class="el" href="structcl__io.html">cl_io</a> *, struct <a class="el" href="structcl__page.html">cl_page</a> *)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a> { <br/>
&nbsp;&nbsp;<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb">CIT_READ</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378aa9c9f93ccf31c58b09085a8460ed1475">CIT_WRITE</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a0a7b38271be1f7d7faac2bfc3f8ce3a6">CIT_SETATTR</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ae0e5d488dc0faa7eca8a7ab4a48cbc25">CIT_DATA_VERSION</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378af6dd7f3f5e03ad52c7f5a42d5fd03322">CIT_FAULT</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a5e5f57a7ae1e41cc45aa7ec77eacf4b3">CIT_FSYNC</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ab21ff138f79ef4d41a40950879bf1e3c">CIT_MISC</a>, 
<a class="el" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ad49f27c1cdc5be6e64ea32bcb4f16e8d">CIT_LADVISE</a>, 
<br/>
&nbsp;&nbsp;<b>CIT_OP_NR</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>IO types. </p>
 <a href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga31cc6886dbe550ea8576111ded9814f3">cl_io_state</a> { <br/>
&nbsp;&nbsp;<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a533479241f38018af1651a483ca85b91">CIS_ZERO</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a009e9e287aa930cf2a8aa288afbbe134">CIS_INIT</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154">CIS_IT_STARTED</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba">CIS_LOCKED</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ae890b65a3f8bcb1142724628e71c247a">CIS_IO_GOING</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4c41fb95967777c249bd9b835a1e4a8e">CIS_IO_FINISHED</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a3d421a3505fbc9098add0227c3e978c5">CIS_UNLOCKED</a>, 
<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe">CIS_IT_ENDED</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3aeb38a1f10d1e0e66044bbfe4f40a20c0">CIS_FINI</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>States of <a class="el" href="structcl__io.html" title="State for io.">cl_io</a> state machine. </p>
 <a href="group__cl__io.html#ga31cc6886dbe550ea8576111ded9814f3">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gac7ff31ceda4789c9101711379ffe824b">cl_io_lock_dmd</a> { <a class="el" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824ba4e46f767dce68b1f061c35ec1edc0528">CILR_MANDATORY</a> =  0, 
<a class="el" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824bafc402749f67a87f7c2508998b1caec47">CILR_MAYBE</a>, 
<a class="el" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824bacfd43489ba9d674ad77c4bdd51d3a7bc">CILR_NEVER</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Lock requirements(demand) for IO. </p>
 <a href="group__cl__io.html#gac7ff31ceda4789c9101711379ffe824b">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gabb7d5d07a2e68b82b9b13cac60256a7d">cl_fsync_mode</a> { <a class="el" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da2efbba1b7d141493ec27186a908dfd02">CL_FSYNC_NONE</a> =  0, 
<a class="el" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da7421020b0252ff0989fd86dc2b3c2620">CL_FSYNC_LOCAL</a> =  1, 
<a class="el" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da26eec0d9c8b5fb4114c7841d531cd07e">CL_FSYNC_DISCARD</a> =  2, 
<a class="el" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da1289d6fd8294a72b7d758fd5d5c1aa2e">CL_FSYNC_ALL</a> =  3
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga2a75c8a7a83eb31d6c899da9dc5143b1">cl_io_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a> iot, struct <a class="el" href="structcl__object.html">cl_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize <em>io</em>, by calling cl_io_operations::cio_init() top-to-bottom.  <a href="#ga2a75c8a7a83eb31d6c899da9dc5143b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga485aa4a9e93475523519f07aca310bac">cl_io_sub_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a> iot, struct <a class="el" href="structcl__object.html">cl_object</a> *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize sub-io, by calling cl_io_operations::cio_init() top-to-bottom.  <a href="#ga485aa4a9e93475523519f07aca310bac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gacff72463468f75b6af811bf709aefa9d">cl_io_rw_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a> iot, loff_t pos, size_t count)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize read or write io.  <a href="#gacff72463468f75b6af811bf709aefa9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga2b13e91188661c45925b56e88b000c6e">cl_io_loop</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main io loop.  <a href="#ga2b13e91188661c45925b56e88b000c6e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacde22a6b2da553556081b6f93e8e0f7f"></a><!-- doxytag: member="cl_io::cl_io_fini" ref="gacde22a6b2da553556081b6f93e8e0f7f" args="(const struct lu_env *env, struct cl_io *io)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gacde22a6b2da553556081b6f93e8e0f7f">cl_io_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalize <em>io</em>, by calling <a class="el" href="structcl__io__operations.html#a09ecbd759c7a3569d67a75e9f201d1ba" title="Called once per io, bottom-to-top to release io resources.">cl_io_operations::cio_fini()</a> bottom-to-top. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gac1a8e0e9d4277fcde8a56794f6f41003">cl_io_iter_init</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepares next iteration of io.  <a href="#gac1a8e0e9d4277fcde8a56794f6f41003"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gad8b5d08373d6d963c67c2682e41999ac">cl_io_iter_fini</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Finalizes io iteration.  <a href="#gad8b5d08373d6d963c67c2682e41999ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga2229beaa77461f453fa4e1f1e129cbe6">cl_io_lock</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Takes locks necessary for the current iteration of io.  <a href="#ga2229beaa77461f453fa4e1f1e129cbe6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0de2f26e31233ef3bf8c7315b412e681"></a><!-- doxytag: member="cl_io::cl_io_unlock" ref="ga0de2f26e31233ef3bf8c7315b412e681" args="(const struct lu_env *env, struct cl_io *io)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681">cl_io_unlock</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release locks takes by io. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacf4c2a55f31d42191ff49b8685163008"></a><!-- doxytag: member="cl_io::cl_io_start" ref="gacf4c2a55f31d42191ff49b8685163008" args="(const struct lu_env *env, struct cl_io *io)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gacf4c2a55f31d42191ff49b8685163008">cl_io_start</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts io by calling <a class="el" href="structcl__io__operations.html#a29bbb031f049b8a1a5e54d575fa88209" title="Start io iteration.">cl_io_operations::cio_start()</a> top-to-bottom. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaffebdf9278fa11f9dbecfeb3f5852fb5"></a><!-- doxytag: member="cl_io::cl_io_end" ref="gaffebdf9278fa11f9dbecfeb3f5852fb5" args="(const struct lu_env *env, struct cl_io *io)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gaffebdf9278fa11f9dbecfeb3f5852fb5">cl_io_end</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait until current io iteration is finished by calling <a class="el" href="structcl__io__operations.html#a4d3dfb49a0fbf1f90b3de60841183d0a" title="Called top-to-bottom at the end of io loop.">cl_io_operations::cio_end()</a> bottom-to-top. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga80fe084e78e83a4a66fceb0e2c605b6e"></a><!-- doxytag: member="cl_io::cl_io_lock_add" ref="ga80fe084e78e83a4a66fceb0e2c605b6e" args="(const struct lu_env *env, struct cl_io *io, struct cl_io_lock_link *link)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga80fe084e78e83a4a66fceb0e2c605b6e">cl_io_lock_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__io__lock__link.html">cl_io_lock_link</a> *link)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a lock to a lockset. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3ce86bab1ea06d8d2d7ac15f3a0be3f6"></a><!-- doxytag: member="cl_io::cl_io_lock_alloc_add" ref="ga3ce86bab1ea06d8d2d7ac15f3a0be3f6" args="(const struct lu_env *env, struct cl_io *io, struct cl_lock_descr *descr)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga3ce86bab1ea06d8d2d7ac15f3a0be3f6">cl_io_lock_alloc_add</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__lock__descr.html">cl_lock_descr</a> *descr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocates new lock link, and uses it to add a lock to a lockset. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gae609957e435aaa7c3044b45cada6b96c">cl_io_submit_rw</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, enum <a class="el" href="group__cl__page.html#ga419215a2ca4eeab85983de8ca5a16a02">cl_req_type</a> iot, struct <a class="el" href="structcl__2queue.html">cl_2queue</a> *queue)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Submits a list of pages for immediate io.  <a href="#gae609957e435aaa7c3044b45cada6b96c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga575a43e2ec65ba4aa6c926cf5e49fe70">cl_io_submit_sync</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, enum <a class="el" href="group__cl__page.html#ga419215a2ca4eeab85983de8ca5a16a02">cl_req_type</a> iot, struct <a class="el" href="structcl__2queue.html">cl_2queue</a> *queue, long timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Submit a sync_io and wait for the IO to be finished, or error happens.  <a href="#ga575a43e2ec65ba4aa6c926cf5e49fe70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gac830ac176054e906a54a4db48fbf45bb">cl_io_commit_async</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__page__list.html">cl_page_list</a> *queue, int from, int to, cl_commit_cbt cb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Commit a list of contiguous pages into writeback cache.  <a href="#gac830ac176054e906a54a4db48fbf45bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#gad5b4d2971764744ec2f5d30fe56d9781">cl_io_read_ahead</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, pgoff_t start, struct <a class="el" href="structcl__read__ahead.html">cl_read_ahead</a> *ra)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Called by read io, to decide the readahead extent.  <a href="#gad5b4d2971764744ec2f5d30fe56d9781"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0e67009a999662295be41a4532bf6f37"></a><!-- doxytag: member="cl_io::cl_io_rw_advance" ref="ga0e67009a999662295be41a4532bf6f37" args="(const struct lu_env *env, struct cl_io *io, size_t nob)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga0e67009a999662295be41a4532bf6f37">cl_io_rw_advance</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, size_t nob)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Records that read or write io progressed <em>nob</em> bytes forward. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9e1b49d71ec98da5a7f4bd1fba415ad5"></a><!-- doxytag: member="cl_io::cl_io_cancel" ref="ga9e1b49d71ec98da5a7f4bd1fba415ad5" args="(const struct lu_env *env, struct cl_io *io, struct cl_page_list *queue)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga9e1b49d71ec98da5a7f4bd1fba415ad5">cl_io_cancel</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structcl__io.html">cl_io</a> *io, struct <a class="el" href="structcl__page__list.html">cl_page_list</a> *queue)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cancel an IO which has been submitted by cl_io_submit_rw. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2ae08af9fbe1af93e2d82049e7ae7e3c"></a><!-- doxytag: member="cl_io::cl_io_is_going" ref="ga2ae08af9fbe1af93e2d82049e7ae7e3c" args="(const struct lu_env *env)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga2ae08af9fbe1af93e2d82049e7ae7e3c">cl_io_is_going</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true iff there is an IO ongoing in the given environment. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga4bb065eb52291173dbda9a0721b1ea2c">cl_io_top</a> (struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns top-level io.  <a href="#ga4bb065eb52291173dbda9a0721b1ea2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga56de1ca2cd018d724e180da7eabbcad9"></a><!-- doxytag: member="cl_io::cl_io_print" ref="ga56de1ca2cd018d724e180da7eabbcad9" args="(const struct lu_env *env, void *cookie, lu_printer_t printer, const struct cl_io *io)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__cl__io.html#ga56de1ca2cd018d724e180da7eabbcad9">cl_io_print</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, void *cookie, <a class="el" href="group__lu.html#gac8ccca21472f6dc3ea91d73983740fdc">lu_printer_t</a> printer, const struct <a class="el" href="structcl__io.html">cl_io</a> *io)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prints human readable representation of <em>io</em> to the <em>f</em>. <br/></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="gac166b29f4371ce1ec6adb1d26633c4fa"></a><!-- doxytag: member="cl_object.h::CL_IO_SLICE_CLEAN" ref="gac166b29f4371ce1ec6adb1d26633c4fa" args="(foo_io, base)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CL_IO_SLICE_CLEAN</td>
          <td>(</td>
          <td class="paramtype">foo_io, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">base&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> {                                                                    \
        typeof(foo_io) __foo_io = (foo_io);                             \
                                                                        \
        CLASSERT(offsetof(typeof(*__foo_io), base) == 0);               \
        memset(&amp;__foo_io-&gt;base + 1, 0,                                  \
               (sizeof *__foo_io) - sizeof __foo_io-&gt;base);             \
} while (0)
</pre></div>
<p>Definition at line <a class="el" href="cl__object_8h_source.html#l02314">2314</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="gabb7d5d07a2e68b82b9b13cac60256a7d"></a><!-- doxytag: member="cl_object.h::cl_fsync_mode" ref="gabb7d5d07a2e68b82b9b13cac60256a7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__io.html#gabb7d5d07a2e68b82b9b13cac60256a7d">cl_fsync_mode</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ggabb7d5d07a2e68b82b9b13cac60256a7da2efbba1b7d141493ec27186a908dfd02"></a><!-- doxytag: member="CL_FSYNC_NONE" ref="ggabb7d5d07a2e68b82b9b13cac60256a7da2efbba1b7d141493ec27186a908dfd02" args="" -->CL_FSYNC_NONE</em>&nbsp;</td><td>
<p>start writeback, do not wait for them to finish </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggabb7d5d07a2e68b82b9b13cac60256a7da7421020b0252ff0989fd86dc2b3c2620"></a><!-- doxytag: member="CL_FSYNC_LOCAL" ref="ggabb7d5d07a2e68b82b9b13cac60256a7da7421020b0252ff0989fd86dc2b3c2620" args="" -->CL_FSYNC_LOCAL</em>&nbsp;</td><td>
<p>start writeback and wait for them to finish </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggabb7d5d07a2e68b82b9b13cac60256a7da26eec0d9c8b5fb4114c7841d531cd07e"></a><!-- doxytag: member="CL_FSYNC_DISCARD" ref="ggabb7d5d07a2e68b82b9b13cac60256a7da26eec0d9c8b5fb4114c7841d531cd07e" args="" -->CL_FSYNC_DISCARD</em>&nbsp;</td><td>
<p>discard all of dirty pages in a specific file range </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggabb7d5d07a2e68b82b9b13cac60256a7da1289d6fd8294a72b7d758fd5d5c1aa2e"></a><!-- doxytag: member="CL_FSYNC_ALL" ref="ggabb7d5d07a2e68b82b9b13cac60256a7da1289d6fd8294a72b7d758fd5d5c1aa2e" args="" -->CL_FSYNC_ALL</em>&nbsp;</td><td>
<p>start writeback and make sure they have reached storage before return. </p>
<p>OST_SYNC RPC must be issued and finished </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01719">1719</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01719"></a>01719                    {
<a name="l01721"></a>01721         <a class="code" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da2efbba1b7d141493ec27186a908dfd02" title="start writeback, do not wait for them to finish">CL_FSYNC_NONE</a>  = 0,
<a name="l01723"></a>01723         <a class="code" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da7421020b0252ff0989fd86dc2b3c2620" title="start writeback and wait for them to finish">CL_FSYNC_LOCAL</a> = 1,
<a name="l01725"></a>01725         <a class="code" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da26eec0d9c8b5fb4114c7841d531cd07e" title="discard all of dirty pages in a specific file range">CL_FSYNC_DISCARD</a> = 2,
<a name="l01728"></a>01728         <a class="code" href="group__cl__io.html#ggabb7d5d07a2e68b82b9b13cac60256a7da1289d6fd8294a72b7d758fd5d5c1aa2e" title="start writeback and make sure they have reached storage before return.">CL_FSYNC_ALL</a>   = 3
<a name="l01729"></a>01729 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="gac7ff31ceda4789c9101711379ffe824b"></a><!-- doxytag: member="cl_object.h::cl_io_lock_dmd" ref="gac7ff31ceda4789c9101711379ffe824b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__io.html#gac7ff31ceda4789c9101711379ffe824b">cl_io_lock_dmd</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lock requirements(demand) for IO. </p>
<p>It should be cl_io_lock_req, but 'req' is always to be thought as 'request' :-) </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ggac7ff31ceda4789c9101711379ffe824ba4e46f767dce68b1f061c35ec1edc0528"></a><!-- doxytag: member="CILR_MANDATORY" ref="ggac7ff31ceda4789c9101711379ffe824ba4e46f767dce68b1f061c35ec1edc0528" args="" -->CILR_MANDATORY</em>&nbsp;</td><td>
<p>Always lock data (e.g., O_APPEND). </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggac7ff31ceda4789c9101711379ffe824bafc402749f67a87f7c2508998b1caec47"></a><!-- doxytag: member="CILR_MAYBE" ref="ggac7ff31ceda4789c9101711379ffe824bafc402749f67a87f7c2508998b1caec47" args="" -->CILR_MAYBE</em>&nbsp;</td><td>
<p>Layers are free to decide between local and global locking. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggac7ff31ceda4789c9101711379ffe824bacfd43489ba9d674ad77c4bdd51d3a7bc"></a><!-- doxytag: member="CILR_NEVER" ref="ggac7ff31ceda4789c9101711379ffe824bacfd43489ba9d674ad77c4bdd51d3a7bc" args="" -->CILR_NEVER</em>&nbsp;</td><td>
<p>Never lock: there is no cache (e.g., liblustre). </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01710">1710</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01710"></a>01710                     {
<a name="l01712"></a>01712         <a class="code" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824ba4e46f767dce68b1f061c35ec1edc0528" title="Always lock data (e.g., O_APPEND).">CILR_MANDATORY</a> = 0,
<a name="l01714"></a>01714         <a class="code" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824bafc402749f67a87f7c2508998b1caec47" title="Layers are free to decide between local and global locking.">CILR_MAYBE</a>,
<a name="l01716"></a>01716         <a class="code" href="group__cl__io.html#ggac7ff31ceda4789c9101711379ffe824bacfd43489ba9d674ad77c4bdd51d3a7bc" title="Never lock: there is no cache (e.g., liblustre).">CILR_NEVER</a>
<a name="l01717"></a>01717 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga31cc6886dbe550ea8576111ded9814f3"></a><!-- doxytag: member="cl_object.h::cl_io_state" ref="ga31cc6886dbe550ea8576111ded9814f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__io.html#ga31cc6886dbe550ea8576111ded9814f3">cl_io_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>States of <a class="el" href="structcl__io.html" title="State for io.">cl_io</a> state machine. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a533479241f38018af1651a483ca85b91"></a><!-- doxytag: member="CIS_ZERO" ref="gga31cc6886dbe550ea8576111ded9814f3a533479241f38018af1651a483ca85b91" args="" -->CIS_ZERO</em>&nbsp;</td><td>
<p>Not initialized. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a009e9e287aa930cf2a8aa288afbbe134"></a><!-- doxytag: member="CIS_INIT" ref="gga31cc6886dbe550ea8576111ded9814f3a009e9e287aa930cf2a8aa288afbbe134" args="" -->CIS_INIT</em>&nbsp;</td><td>
<p>Initialized. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154"></a><!-- doxytag: member="CIS_IT_STARTED" ref="gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154" args="" -->CIS_IT_STARTED</em>&nbsp;</td><td>
<p>IO iteration started. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba"></a><!-- doxytag: member="CIS_LOCKED" ref="gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba" args="" -->CIS_LOCKED</em>&nbsp;</td><td>
<p>Locks taken. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3ae890b65a3f8bcb1142724628e71c247a"></a><!-- doxytag: member="CIS_IO_GOING" ref="gga31cc6886dbe550ea8576111ded9814f3ae890b65a3f8bcb1142724628e71c247a" args="" -->CIS_IO_GOING</em>&nbsp;</td><td>
<p>Actual IO is in progress. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a4c41fb95967777c249bd9b835a1e4a8e"></a><!-- doxytag: member="CIS_IO_FINISHED" ref="gga31cc6886dbe550ea8576111ded9814f3a4c41fb95967777c249bd9b835a1e4a8e" args="" -->CIS_IO_FINISHED</em>&nbsp;</td><td>
<p>IO for the current iteration finished. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a3d421a3505fbc9098add0227c3e978c5"></a><!-- doxytag: member="CIS_UNLOCKED" ref="gga31cc6886dbe550ea8576111ded9814f3a3d421a3505fbc9098add0227c3e978c5" args="" -->CIS_UNLOCKED</em>&nbsp;</td><td>
<p>Locks released. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe"></a><!-- doxytag: member="CIS_IT_ENDED" ref="gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe" args="" -->CIS_IT_ENDED</em>&nbsp;</td><td>
<p>Iteration completed. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga31cc6886dbe550ea8576111ded9814f3aeb38a1f10d1e0e66044bbfe4f40a20c0"></a><!-- doxytag: member="CIS_FINI" ref="gga31cc6886dbe550ea8576111ded9814f3aeb38a1f10d1e0e66044bbfe4f40a20c0" args="" -->CIS_FINI</em>&nbsp;</td><td>
<p><a class="el" href="structcl__io.html" title="State for io.">cl_io</a> finalized. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01409">1409</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01409"></a>01409                  {
<a name="l01411"></a>01411         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a533479241f38018af1651a483ca85b91" title="Not initialized.">CIS_ZERO</a>,
<a name="l01413"></a>01413         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a009e9e287aa930cf2a8aa288afbbe134" title="Initialized.">CIS_INIT</a>,
<a name="l01415"></a>01415         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154" title="IO iteration started.">CIS_IT_STARTED</a>,
<a name="l01417"></a>01417         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba" title="Locks taken.">CIS_LOCKED</a>,
<a name="l01419"></a>01419         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ae890b65a3f8bcb1142724628e71c247a" title="Actual IO is in progress.">CIS_IO_GOING</a>,
<a name="l01421"></a>01421         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4c41fb95967777c249bd9b835a1e4a8e" title="IO for the current iteration finished.">CIS_IO_FINISHED</a>,
<a name="l01423"></a>01423         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a3d421a3505fbc9098add0227c3e978c5" title="Locks released.">CIS_UNLOCKED</a>,
<a name="l01425"></a>01425         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe" title="Iteration completed.">CIS_IT_ENDED</a>,
<a name="l01427"></a>01427         <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3aeb38a1f10d1e0e66044bbfe4f40a20c0" title="cl_io finalized.">CIS_FINI</a>
<a name="l01428"></a>01428 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga7ce44ceebcd945560fa661571e3a4378"></a><!-- doxytag: member="cl_object.h::cl_io_type" ref="ga7ce44ceebcd945560fa661571e3a4378" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>IO types. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb"></a><!-- doxytag: member="CIT_READ" ref="gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb" args="" -->CIT_READ</em>&nbsp;</td><td>
<p>read system call </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378aa9c9f93ccf31c58b09085a8460ed1475"></a><!-- doxytag: member="CIT_WRITE" ref="gga7ce44ceebcd945560fa661571e3a4378aa9c9f93ccf31c58b09085a8460ed1475" args="" -->CIT_WRITE</em>&nbsp;</td><td>
<p>write system call </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378a0a7b38271be1f7d7faac2bfc3f8ce3a6"></a><!-- doxytag: member="CIT_SETATTR" ref="gga7ce44ceebcd945560fa661571e3a4378a0a7b38271be1f7d7faac2bfc3f8ce3a6" args="" -->CIT_SETATTR</em>&nbsp;</td><td>
<p>truncate, utime system calls </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378ae0e5d488dc0faa7eca8a7ab4a48cbc25"></a><!-- doxytag: member="CIT_DATA_VERSION" ref="gga7ce44ceebcd945560fa661571e3a4378ae0e5d488dc0faa7eca8a7ab4a48cbc25" args="" -->CIT_DATA_VERSION</em>&nbsp;</td><td>
<p>get data version </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378af6dd7f3f5e03ad52c7f5a42d5fd03322"></a><!-- doxytag: member="CIT_FAULT" ref="gga7ce44ceebcd945560fa661571e3a4378af6dd7f3f5e03ad52c7f5a42d5fd03322" args="" -->CIT_FAULT</em>&nbsp;</td><td>
<p>page fault handling </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378a5e5f57a7ae1e41cc45aa7ec77eacf4b3"></a><!-- doxytag: member="CIT_FSYNC" ref="gga7ce44ceebcd945560fa661571e3a4378a5e5f57a7ae1e41cc45aa7ec77eacf4b3" args="" -->CIT_FSYNC</em>&nbsp;</td><td>
<p>fsync system call handling To write out a range of file </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378ab21ff138f79ef4d41a40950879bf1e3c"></a><!-- doxytag: member="CIT_MISC" ref="gga7ce44ceebcd945560fa661571e3a4378ab21ff138f79ef4d41a40950879bf1e3c" args="" -->CIT_MISC</em>&nbsp;</td><td>
<p>Miscellaneous io. </p>
<p>This is used for occasional io activity that doesn't fit into other types. Currently this is used for:</p>
<ul>
<li>cancellation of an extent lock. This io exists as a context to write dirty pages from under the lock being canceled back to the server;</li>
</ul>
<ul>
<li>VM induced page write-out. An io context for writing page out for memory cleansing;</li>
</ul>
<ul>
<li>glimpse. An io context to acquire glimpse lock.</li>
</ul>
<ul>
<li>grouplock. An io context to acquire group lock.</li>
</ul>
<p>CIT_MISC io is used simply as a context in which locks and pages are manipulated. Such io has no internal "process", that is, <a class="el" href="group__cl__io.html#ga2b13e91188661c45925b56e88b000c6e" title="Main io loop.">cl_io_loop()</a> is never called for it. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga7ce44ceebcd945560fa661571e3a4378ad49f27c1cdc5be6e64ea32bcb4f16e8d"></a><!-- doxytag: member="CIT_LADVISE" ref="gga7ce44ceebcd945560fa661571e3a4378ad49f27c1cdc5be6e64ea32bcb4f16e8d" args="" -->CIT_LADVISE</em>&nbsp;</td><td>
<p>ladvise handling To give advice about access of a file </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="cl__object_8h_source.html#l01360">1360</a> of file <a class="el" href="cl__object_8h_source.html">cl_object.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01360"></a>01360                 {
<a name="l01362"></a>01362         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb" title="read system call">CIT_READ</a>,
<a name="l01364"></a>01364         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378aa9c9f93ccf31c58b09085a8460ed1475" title="write system call">CIT_WRITE</a>,
<a name="l01366"></a>01366         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a0a7b38271be1f7d7faac2bfc3f8ce3a6" title="truncate, utime system calls">CIT_SETATTR</a>,
<a name="l01368"></a>01368         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ae0e5d488dc0faa7eca8a7ab4a48cbc25" title="get data version">CIT_DATA_VERSION</a>,
<a name="l01372"></a>01372         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378af6dd7f3f5e03ad52c7f5a42d5fd03322" title="page fault handling">CIT_FAULT</a>,
<a name="l01377"></a>01377         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a5e5f57a7ae1e41cc45aa7ec77eacf4b3" title="fsync system call handling To write out a range of file">CIT_FSYNC</a>,
<a name="l01397"></a>01397         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ab21ff138f79ef4d41a40950879bf1e3c" title="Miscellaneous io.">CIT_MISC</a>,
<a name="l01402"></a>01402         <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378ad49f27c1cdc5be6e64ea32bcb4f16e8d" title="ladvise handling To give advice about access of a file">CIT_LADVISE</a>,
<a name="l01403"></a>01403         CIT_OP_NR
<a name="l01404"></a>01404 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gac830ac176054e906a54a4db48fbf45bb"></a><!-- doxytag: member="cl_object.h::cl_io_commit_async" ref="gac830ac176054e906a54a4db48fbf45bb" args="(const struct lu_env *env, struct cl_io *io, struct cl_page_list *queue, int from, int to, cl_commit_cbt cb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_commit_async </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__page__list.html">cl_page_list</a> *&nbsp;</td>
          <td class="paramname"> <em>queue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cl_commit_cbt&nbsp;</td>
          <td class="paramname"> <em>cb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Commit a list of contiguous pages into writeback cache. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if all pages committed, or errcode if error occurred. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structcl__io__operations.html#a1c88c4ec4901b77c0a32b3951f217f8c" title="Queue async page for write.">cl_io_operations::cio_commit_async()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00646">646</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="structcl__io__operations.html#a1c88c4ec4901b77c0a32b3951f217f8c">cl_io_operations::cio_commit_async</a>, and <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00649"></a>00649 {
<a name="l00650"></a>00650         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00651"></a>00651         <span class="keywordtype">int</span> result = 0;
<a name="l00652"></a>00652         ENTRY;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         cl_io_for_each(scan, io) {
<a name="l00655"></a>00655                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a1c88c4ec4901b77c0a32b3951f217f8c" title="Queue async page for write.">cio_commit_async</a> == NULL)
<a name="l00656"></a>00656                         <span class="keywordflow">continue</span>;
<a name="l00657"></a>00657                 result = scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a1c88c4ec4901b77c0a32b3951f217f8c" title="Queue async page for write.">cio_commit_async</a>(env, scan, queue,
<a name="l00658"></a>00658                                                          from, to, cb);
<a name="l00659"></a>00659                 <span class="keywordflow">if</span> (result != 0)
<a name="l00660"></a>00660                         <span class="keywordflow">break</span>;
<a name="l00661"></a>00661         }
<a name="l00662"></a>00662         RETURN(result);
<a name="l00663"></a>00663 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga2a75c8a7a83eb31d6c899da9dc5143b1"></a><!-- doxytag: member="cl_object.h::cl_io_init" ref="ga2a75c8a7a83eb31d6c899da9dc5143b1" args="(const struct lu_env *env, struct cl_io *io, enum cl_io_type iot, struct cl_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a>&nbsp;</td>
          <td class="paramname"> <em>iot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__object.html">cl_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize <em>io</em>, by calling cl_io_operations::cio_init() top-to-bottom. </p>
<p>Caller has to call <a class="el" href="group__cl__io.html#gacde22a6b2da553556081b6f93e8e0f7f" title="Finalize io, by calling cl_io_operations::cio_fini() bottom-to-top.">cl_io_fini()</a> after a call to <a class="el" href="group__cl__io.html#ga2a75c8a7a83eb31d6c899da9dc5143b1" title="Initialize io, by calling cl_io_operations::cio_init() top-to-bottom.">cl_io_init()</a>, no matter what the latter returned.</p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>obj == cl_object_top(obj) </dd>
<dd>
cl_io_type_is_valid(iot) </dd></dl>
<dl class="post"><dt><b>Postcondition:</b></dt><dd>cl_io_type_is_valid(io-&gt;ci_type) &amp;&amp; io-&gt;ci_type == iot </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00211">211</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00145">cl_object_top()</a>, and <a class="el" href="cl__internal_8h_source.html#l00107">cl_thread_info::clt_current_io</a>.</p>

<p>Referenced by <a class="el" href="cl__io_8c_source.html#l00229">cl_io_rw_init()</a>, and <a class="el" href="osc__page_8c_source.html#l00667">osc_lru_shrink()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00213"></a>00213 {
<a name="l00214"></a>00214         <span class="keyword">struct </span><a class="code" href="structcl__thread__info.html" title="Thread local state internal for generic cl-code.">cl_thread_info</a> *info = cl_env_info(env);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         LASSERT(obj == <a class="code" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top-object for a given o.">cl_object_top</a>(obj));
<a name="l00217"></a>00217         LASSERT(info-&gt;<a class="code" href="structcl__thread__info.html#a9483e30eb2d58f1ed5eb6224090af583" title="Pointer to the topmost ongoing IO in this thread.">clt_current_io</a> == NULL);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         info-&gt;<a class="code" href="structcl__thread__info.html#a9483e30eb2d58f1ed5eb6224090af583" title="Pointer to the topmost ongoing IO in this thread.">clt_current_io</a> = io;
<a name="l00220"></a>00220         <span class="keywordflow">return</span> cl_io_init0(env, io, iot, obj);
<a name="l00221"></a>00221 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_cgraph.png" border="0" usemap="#group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_cgraph_map" alt=""></div>
<map name="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_cgraph_map" id="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_cgraph">
<area shape="rect" id="node3" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top&#45;object for a given o." alt="" coords="133,5,248,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_icgraph.png" border="0" usemap="#group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_icgraph_map" alt=""></div>
<map name="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_icgraph_map" id="group__cl__io_ga2a75c8a7a83eb31d6c899da9dc5143b1_icgraph">
<area shape="rect" id="node3" href="group__cl__io.html#gacff72463468f75b6af811bf709aefa9d" title="Initialize read or write io." alt="" coords="140,5,241,35"/><area shape="rect" id="node5" href="group__osc.html#gacad2bab69d5c52c6248c0b76fcf1e93a" title="Drop &#160;of pages from LRU at most." alt="" coords="135,59,247,88"/><area shape="rect" id="node7" href="group__osc.html#ga084c788be8d116db87ebdd3c273d9a23" title="Scan and try to reclaim sc&#45;&gt;nr_to_scan cached LRU pages." alt="" coords="296,59,472,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gad8b5d08373d6d963c67c2682e41999ac"></a><!-- doxytag: member="cl_object.h::cl_io_iter_fini" ref="gad8b5d08373d6d963c67c2682e41999ac" args="(const struct lu_env *env, struct cl_io *io)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cl_io_iter_fini </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Finalizes io iteration. </p>
<p>Calls <a class="el" href="structcl__io__operations.html#a2c6f9fa7cecb546bd2b46156d57b10dd" title="Finalize io iteration.">cl_io_operations::cio_iter_fini()</a> bottom-to-top. </p>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00469">469</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01750">ci_state</a>, <a class="el" href="cl__object_8h_source.html#l01748">ci_type</a>, <a class="el" href="structcl__io__operations.html#a2c6f9fa7cecb546bd2b46156d57b10dd">cl_io_operations::cio_iter_fini</a>, <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>, <a class="el" href="cl__object_8h_source.html#l01425">CIS_IT_ENDED</a>, <a class="el" href="cl__object_8h_source.html#l01423">CIS_UNLOCKED</a>, and <a class="el" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282">cl_io_operations::op</a>.</p>

<p>Referenced by <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00470"></a>00470 {
<a name="l00471"></a>00471         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         LINVRNT(cl_io_is_loopable(io));
<a name="l00474"></a>00474         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a3d421a3505fbc9098add0227c3e978c5" title="Locks released.">CIS_UNLOCKED</a>);
<a name="l00475"></a>00475         LINVRNT(cl_io_invariant(io));
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         ENTRY;
<a name="l00478"></a>00478         cl_io_for_each_reverse(scan, io) {
<a name="l00479"></a>00479                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#a2c6f9fa7cecb546bd2b46156d57b10dd" title="Finalize io iteration.">cio_iter_fini</a> != NULL)
<a name="l00480"></a>00480                         scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#a2c6f9fa7cecb546bd2b46156d57b10dd" title="Finalize io iteration.">cio_iter_fini</a>(env, scan);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482         io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> = <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe" title="Iteration completed.">CIS_IT_ENDED</a>;
<a name="l00483"></a>00483         EXIT;
<a name="l00484"></a>00484 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_gad8b5d08373d6d963c67c2682e41999ac_icgraph.png" border="0" usemap="#group__cl__io_gad8b5d08373d6d963c67c2682e41999ac_icgraph_map" alt=""></div>
<map name="group__cl__io_gad8b5d08373d6d963c67c2682e41999ac_icgraph_map" id="group__cl__io_gad8b5d08373d6d963c67c2682e41999ac_icgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga2b13e91188661c45925b56e88b000c6e" title="Main io loop." alt="" coords="163,5,248,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac1a8e0e9d4277fcde8a56794f6f41003"></a><!-- doxytag: member="cl_object.h::cl_io_iter_init" ref="gac1a8e0e9d4277fcde8a56794f6f41003" args="(const struct lu_env *env, struct cl_io *io)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_iter_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prepares next iteration of io. </p>
<p>Calls <a class="el" href="structcl__io__operations.html#aeedb0fcc4555583225020c012c5b84e1" title="Prepare io iteration at a given layer.">cl_io_operations::cio_iter_init()</a> top-to-bottom. This exists to give layers a chance to modify io parameters, e.g., so that lov can restrict io to a single stripe. </p>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00439">439</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01750">ci_state</a>, <a class="el" href="cl__object_8h_source.html#l01748">ci_type</a>, <a class="el" href="structcl__io__operations.html#aeedb0fcc4555583225020c012c5b84e1">cl_io_operations::cio_iter_init</a>, <a class="el" href="cl__object_8h_source.html#l01413">CIS_INIT</a>, <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>, <a class="el" href="cl__object_8h_source.html#l01425">CIS_IT_ENDED</a>, <a class="el" href="cl__object_8h_source.html#l01415">CIS_IT_STARTED</a>, and <a class="el" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282">cl_io_operations::op</a>.</p>

<p>Referenced by <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00440"></a>00440 {
<a name="l00441"></a>00441         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00442"></a>00442         <span class="keywordtype">int</span> result;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         LINVRNT(cl_io_is_loopable(io));
<a name="l00445"></a>00445         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a009e9e287aa930cf2a8aa288afbbe134" title="Initialized.">CIS_INIT</a> || io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a4a452e3aadf68f37073952f26f59ecbe" title="Iteration completed.">CIS_IT_ENDED</a>);
<a name="l00446"></a>00446         LINVRNT(cl_io_invariant(io));
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         ENTRY;
<a name="l00449"></a>00449         result = 0;
<a name="l00450"></a>00450         cl_io_for_each(scan, io) {
<a name="l00451"></a>00451                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#aeedb0fcc4555583225020c012c5b84e1" title="Prepare io iteration at a given layer.">cio_iter_init</a> == NULL)
<a name="l00452"></a>00452                         <span class="keywordflow">continue</span>;
<a name="l00453"></a>00453                 result = scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#aeedb0fcc4555583225020c012c5b84e1" title="Prepare io iteration at a given layer.">cio_iter_init</a>(env,
<a name="l00454"></a>00454                                                                       scan);
<a name="l00455"></a>00455                 <span class="keywordflow">if</span> (result != 0)
<a name="l00456"></a>00456                         <span class="keywordflow">break</span>;
<a name="l00457"></a>00457         }
<a name="l00458"></a>00458         <span class="keywordflow">if</span> (result == 0)
<a name="l00459"></a>00459                 io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> = <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154" title="IO iteration started.">CIS_IT_STARTED</a>;
<a name="l00460"></a>00460         RETURN(result);
<a name="l00461"></a>00461 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_gac1a8e0e9d4277fcde8a56794f6f41003_icgraph.png" border="0" usemap="#group__cl__io_gac1a8e0e9d4277fcde8a56794f6f41003_icgraph_map" alt=""></div>
<map name="group__cl__io_gac1a8e0e9d4277fcde8a56794f6f41003_icgraph_map" id="group__cl__io_gac1a8e0e9d4277fcde8a56794f6f41003_icgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga2b13e91188661c45925b56e88b000c6e" title="Main io loop." alt="" coords="165,5,251,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2229beaa77461f453fa4e1f1e129cbe6"></a><!-- doxytag: member="cl_object.h::cl_io_lock" ref="ga2229beaa77461f453fa4e1f1e129cbe6" args="(const struct lu_env *env, struct cl_io *io)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_lock </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Takes locks necessary for the current iteration of io. </p>
<p>Calls <a class="el" href="structcl__io__operations.html#a4211dc9e2bf48da829c2fffd4633b1cf" title="Collect locks for the current iteration of io.">cl_io_operations::cio_lock()</a> top-to-bottom to collect locks required by layers for the current iteration. Then sort locks (to avoid dead-locks), and acquire them. </p>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00363">363</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01761">ci_lockset</a>, <a class="el" href="cl__object_8h_source.html#l01750">ci_state</a>, <a class="el" href="cl__object_8h_source.html#l01748">ci_type</a>, <a class="el" href="structcl__io__operations.html#a4211dc9e2bf48da829c2fffd4633b1cf">cl_io_operations::cio_lock</a>, <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>, <a class="el" href="cl__object_8h_source.html#l01415">CIS_IT_STARTED</a>, <a class="el" href="cl__object_8h_source.html#l01417">CIS_LOCKED</a>, <a class="el" href="cl__io_8c_source.html#l00395">cl_io_unlock()</a>, and <a class="el" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282">cl_io_operations::op</a>.</p>

<p>Referenced by <a class="el" href="cl__io_8c_source.html#l00779">cl_io_loop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00364"></a>00364 {
<a name="l00365"></a>00365         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00366"></a>00366         <span class="keywordtype">int</span> result = 0;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         LINVRNT(cl_io_is_loopable(io));
<a name="l00369"></a>00369         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ad8aa8993a7b31bf97b878e8ad84b9154" title="IO iteration started.">CIS_IT_STARTED</a>);
<a name="l00370"></a>00370         LINVRNT(cl_io_invariant(io));
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         ENTRY;
<a name="l00373"></a>00373         cl_io_for_each(scan, io) {
<a name="l00374"></a>00374                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#a4211dc9e2bf48da829c2fffd4633b1cf" title="Collect locks for the current iteration of io.">cio_lock</a> == NULL)
<a name="l00375"></a>00375                         <span class="keywordflow">continue</span>;
<a name="l00376"></a>00376                 result = scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a646d5084e9960fc83c6ac20e37640282" title="Vector of io state transition methods for every io type.">op</a>[io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a>].<a class="code" href="structcl__io__operations.html#a4211dc9e2bf48da829c2fffd4633b1cf" title="Collect locks for the current iteration of io.">cio_lock</a>(env, scan);
<a name="l00377"></a>00377                 <span class="keywordflow">if</span> (result != 0)
<a name="l00378"></a>00378                         <span class="keywordflow">break</span>;
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380         <span class="keywordflow">if</span> (result == 0) {
<a name="l00381"></a>00381                 cl_io_locks_sort(io);
<a name="l00382"></a>00382                 result = cl_lockset_lock(env, io, &amp;io-&gt;<a class="code" href="structcl__io.html#a5e4726f4ed7b0cc829ca85342b383875" title="list of locks (to be) acquired by this io.">ci_lockset</a>);
<a name="l00383"></a>00383         }
<a name="l00384"></a>00384         <span class="keywordflow">if</span> (result != 0)
<a name="l00385"></a>00385                 <a class="code" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681" title="Release locks takes by io.">cl_io_unlock</a>(env, io);
<a name="l00386"></a>00386         <span class="keywordflow">else</span>
<a name="l00387"></a>00387                 io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> = <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba" title="Locks taken.">CIS_LOCKED</a>;
<a name="l00388"></a>00388         RETURN(result);
<a name="l00389"></a>00389 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_cgraph.png" border="0" usemap="#group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_cgraph_map" alt=""></div>
<map name="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_cgraph_map" id="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_cgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681" title="Release locks takes by io." alt="" coords="140,5,239,35"/><area shape="rect" id="node5" href="group__cl__lock.html#ga4e8069a400c6a75342649a6fc04fa2c3" title="Releases a hold and a reference on a lock, obtained by cl_lock_hold()." alt="" coords="288,5,411,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_icgraph.png" border="0" usemap="#group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_icgraph_map" alt=""></div>
<map name="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_icgraph_map" id="group__cl__io_ga2229beaa77461f453fa4e1f1e129cbe6_icgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga2b13e91188661c45925b56e88b000c6e" title="Main io loop." alt="" coords="139,5,224,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga2b13e91188661c45925b56e88b000c6e"></a><!-- doxytag: member="cl_object.h::cl_io_loop" ref="ga2b13e91188661c45925b56e88b000c6e" args="(const struct lu_env *env, struct cl_io *io)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_loop </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Main io loop. </p>
<p>Pumps io through iterations calling</p>
<ul>
<li><a class="el" href="group__cl__io.html#gac1a8e0e9d4277fcde8a56794f6f41003" title="Prepares next iteration of io.">cl_io_iter_init()</a></li>
</ul>
<ul>
<li><a class="el" href="group__cl__io.html#ga2229beaa77461f453fa4e1f1e129cbe6" title="Takes locks necessary for the current iteration of io.">cl_io_lock()</a></li>
</ul>
<ul>
<li><a class="el" href="group__cl__io.html#gacf4c2a55f31d42191ff49b8685163008" title="Starts io by calling cl_io_operations::cio_start() top-to-bottom.">cl_io_start()</a></li>
</ul>
<ul>
<li><a class="el" href="group__cl__io.html#gaffebdf9278fa11f9dbecfeb3f5852fb5" title="Wait until current io iteration is finished by calling cl_io_operations::cio_end()...">cl_io_end()</a></li>
</ul>
<ul>
<li><a class="el" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681" title="Release locks takes by io.">cl_io_unlock()</a></li>
</ul>
<ul>
<li><a class="el" href="group__cl__io.html#gad8b5d08373d6d963c67c2682e41999ac" title="Finalizes io iteration.">cl_io_iter_fini()</a></li>
</ul>
<p>repeatedly until there is no more io to do. </p>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00779">779</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__io_8c_source.html#l00593">cl_io_end()</a>, <a class="el" href="cl__io_8c_source.html#l00469">cl_io_iter_fini()</a>, <a class="el" href="cl__io_8c_source.html#l00439">cl_io_iter_init()</a>, <a class="el" href="cl__io_8c_source.html#l00363">cl_io_lock()</a>, <a class="el" href="cl__io_8c_source.html#l00490">cl_io_rw_advance()</a>, <a class="el" href="cl__io_8c_source.html#l00565">cl_io_start()</a>, and <a class="el" href="cl__io_8c_source.html#l00395">cl_io_unlock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00780"></a>00780 {
<a name="l00781"></a>00781         <span class="keywordtype">int</span> result   = 0;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         LINVRNT(cl_io_is_loopable(io));
<a name="l00784"></a>00784         ENTRY;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <span class="keywordflow">do</span> {
<a name="l00787"></a>00787                 <span class="keywordtype">size_t</span> nob;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789                 io-&gt;ci_continue = 0;
<a name="l00790"></a>00790                 result = <a class="code" href="group__cl__io.html#gac1a8e0e9d4277fcde8a56794f6f41003" title="Prepares next iteration of io.">cl_io_iter_init</a>(env, io);
<a name="l00791"></a>00791                 <span class="keywordflow">if</span> (result == 0) {
<a name="l00792"></a>00792                         nob    = io-&gt;ci_nob;
<a name="l00793"></a>00793                         result = <a class="code" href="group__cl__io.html#ga2229beaa77461f453fa4e1f1e129cbe6" title="Takes locks necessary for the current iteration of io.">cl_io_lock</a>(env, io);
<a name="l00794"></a>00794                         <span class="keywordflow">if</span> (result == 0) {
<a name="l00795"></a>00795                                 <span class="comment">/*</span>
<a name="l00796"></a>00796 <span class="comment">                                 * Notify layers that locks has been taken,</span>
<a name="l00797"></a>00797 <span class="comment">                                 * and do actual i/o.</span>
<a name="l00798"></a>00798 <span class="comment">                                 *</span>
<a name="l00799"></a>00799 <span class="comment">                                 *   - llite: kms, short read;</span>
<a name="l00800"></a>00800 <span class="comment">                                 *   - llite: generic_file_read();</span>
<a name="l00801"></a>00801 <span class="comment">                                 */</span>
<a name="l00802"></a>00802                                 result = <a class="code" href="group__cl__io.html#gacf4c2a55f31d42191ff49b8685163008" title="Starts io by calling cl_io_operations::cio_start() top-to-bottom.">cl_io_start</a>(env, io);
<a name="l00803"></a>00803                                 <span class="comment">/*</span>
<a name="l00804"></a>00804 <span class="comment">                                 * Send any remaining pending</span>
<a name="l00805"></a>00805 <span class="comment">                                 * io, etc.</span>
<a name="l00806"></a>00806 <span class="comment">                                 *</span>
<a name="l00807"></a>00807 <span class="comment">                                 *   - llite: ll_rw_stats_tally.</span>
<a name="l00808"></a>00808 <span class="comment">                                 */</span>
<a name="l00809"></a>00809                                 <a class="code" href="group__cl__io.html#gaffebdf9278fa11f9dbecfeb3f5852fb5" title="Wait until current io iteration is finished by calling cl_io_operations::cio_end()...">cl_io_end</a>(env, io);
<a name="l00810"></a>00810                                 <a class="code" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681" title="Release locks takes by io.">cl_io_unlock</a>(env, io);
<a name="l00811"></a>00811                                 <a class="code" href="group__cl__io.html#ga0e67009a999662295be41a4532bf6f37" title="Records that read or write io progressed nob bytes forward.">cl_io_rw_advance</a>(env, io, io-&gt;ci_nob - nob);
<a name="l00812"></a>00812                         }
<a name="l00813"></a>00813                 }
<a name="l00814"></a>00814                 <a class="code" href="group__cl__io.html#gad8b5d08373d6d963c67c2682e41999ac" title="Finalizes io iteration.">cl_io_iter_fini</a>(env, io);
<a name="l00815"></a>00815         } <span class="keywordflow">while</span> (result == 0 &amp;&amp; io-&gt;ci_continue);
<a name="l00816"></a>00816         <span class="keywordflow">if</span> (result == 0)
<a name="l00817"></a>00817                 result = io-&gt;ci_result;
<a name="l00818"></a>00818         RETURN(result &lt; 0 ? result : 0);
<a name="l00819"></a>00819 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga2b13e91188661c45925b56e88b000c6e_cgraph.png" border="0" usemap="#group__cl__io_ga2b13e91188661c45925b56e88b000c6e_cgraph_map" alt=""></div>
<map name="group__cl__io_ga2b13e91188661c45925b56e88b000c6e_cgraph_map" id="group__cl__io_ga2b13e91188661c45925b56e88b000c6e_cgraph">
<area shape="rect" id="node3" href="group__cl__io.html#gaffebdf9278fa11f9dbecfeb3f5852fb5" title="Wait until current io iteration is finished by calling cl_io_operations::cio_end()..." alt="" coords="167,5,249,35"/><area shape="rect" id="node5" href="group__cl__io.html#gad8b5d08373d6d963c67c2682e41999ac" title="Finalizes io iteration." alt="" coords="155,59,261,88"/><area shape="rect" id="node7" href="group__cl__io.html#gac1a8e0e9d4277fcde8a56794f6f41003" title="Prepares next iteration of io." alt="" coords="153,112,263,141"/><area shape="rect" id="node9" href="group__cl__io.html#ga2229beaa77461f453fa4e1f1e129cbe6" title="Takes locks necessary for the current iteration of io." alt="" coords="167,165,249,195"/><area shape="rect" id="node11" href="group__cl__io.html#ga0de2f26e31233ef3bf8c7315b412e681" title="Release locks takes by io." alt="" coords="327,192,425,221"/><area shape="rect" id="node15" href="group__cl__io.html#ga0e67009a999662295be41a4532bf6f37" title="Records that read or write io progressed nob bytes forward." alt="" coords="139,269,277,299"/><area shape="rect" id="node17" href="group__cl__io.html#gacf4c2a55f31d42191ff49b8685163008" title="Starts io by calling cl_io_operations::cio_start() top&#45;to&#45;bottom." alt="" coords="163,323,253,352"/><area shape="rect" id="node13" href="group__cl__lock.html#ga4e8069a400c6a75342649a6fc04fa2c3" title="Releases a hold and a reference on a lock, obtained by cl_lock_hold()." alt="" coords="475,192,597,221"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gad5b4d2971764744ec2f5d30fe56d9781"></a><!-- doxytag: member="cl_object.h::cl_io_read_ahead" ref="gad5b4d2971764744ec2f5d30fe56d9781" args="(const struct lu_env *env, struct cl_io *io, pgoff_t start, struct cl_read_ahead *ra)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_read_ahead </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pgoff_t&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__read__ahead.html">cl_read_ahead</a> *&nbsp;</td>
          <td class="paramname"> <em>ra</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Called by read io, to decide the readahead extent. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structcl__io__operations.html#a4a7f6334b0e726f9c7fc52b8064a2613" title="Decide maximum read ahead extent.">cl_io_operations::cio_read_ahead()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00617">617</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01750">ci_state</a>, <a class="el" href="cl__object_8h_source.html#l01748">ci_type</a>, <a class="el" href="structcl__io__operations.html#a4a7f6334b0e726f9c7fc52b8064a2613">cl_io_operations::cio_read_ahead</a>, <a class="el" href="cl__object_8h_source.html#l01419">CIS_IO_GOING</a>, <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>, <a class="el" href="cl__object_8h_source.html#l01417">CIS_LOCKED</a>, <a class="el" href="cl__object_8h_source.html#l01372">CIT_FAULT</a>, and <a class="el" href="cl__object_8h_source.html#l01362">CIT_READ</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00619"></a>00619 {
<a name="l00620"></a>00620         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00621"></a>00621         <span class="keywordtype">int</span>                       result = 0;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a> == <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb" title="read system call">CIT_READ</a> || io-&gt;<a class="code" href="structcl__io.html#ac02cd7b5e65d1d20d00de68de64d8b50" title="type of this IO.">ci_type</a> == <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378af6dd7f3f5e03ad52c7f5a42d5fd03322" title="page fault handling">CIT_FAULT</a>);
<a name="l00624"></a>00624         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3ae890b65a3f8bcb1142724628e71c247a" title="Actual IO is in progress.">CIS_IO_GOING</a> || io-&gt;<a class="code" href="structcl__io.html#a2d9112d04e0c51b82eb5b31eee94e984" title="current state of cl_io state machine.">ci_state</a> == <a class="code" href="group__cl__io.html#gga31cc6886dbe550ea8576111ded9814f3a7aaaa8f4b4ceebebb8004c39f786d2ba" title="Locks taken.">CIS_LOCKED</a>);
<a name="l00625"></a>00625         LINVRNT(cl_io_invariant(io));
<a name="l00626"></a>00626         ENTRY;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         cl_io_for_each(scan, io) {
<a name="l00629"></a>00629                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a4a7f6334b0e726f9c7fc52b8064a2613" title="Decide maximum read ahead extent.">cio_read_ahead</a> == NULL)
<a name="l00630"></a>00630                         <span class="keywordflow">continue</span>;
<a name="l00631"></a>00631 
<a name="l00632"></a>00632                 result = scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a4a7f6334b0e726f9c7fc52b8064a2613" title="Decide maximum read ahead extent.">cio_read_ahead</a>(env, scan, start, ra);
<a name="l00633"></a>00633                 <span class="keywordflow">if</span> (result != 0)
<a name="l00634"></a>00634                         <span class="keywordflow">break</span>;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636         RETURN(result &gt; 0 ? 0 : result);
<a name="l00637"></a>00637 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="gacff72463468f75b6af811bf709aefa9d"></a><!-- doxytag: member="cl_object.h::cl_io_rw_init" ref="gacff72463468f75b6af811bf709aefa9d" args="(const struct lu_env *env, struct cl_io *io, enum cl_io_type iot, loff_t pos, size_t count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_rw_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a>&nbsp;</td>
          <td class="paramname"> <em>iot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">loff_t&nbsp;</td>
          <td class="paramname"> <em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize read or write io. </p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>iot == CIT_READ || iot == CIT_WRITE </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00229">229</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01752">ci_obj</a>, <a class="el" href="cl__object_8h_source.html#l01362">CIT_READ</a>, <a class="el" href="cl__object_8h_source.html#l01364">CIT_WRITE</a>, <a class="el" href="cl__io_8c_source.html#l00211">cl_io_init()</a>, <a class="el" href="cl__object_8h_source.html#l00227">cl_object::co_lu</a>, and <a class="el" href="lu__object_8h_source.html#l00812">LU_OBJECT_HEADER</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00231"></a>00231 {
<a name="l00232"></a>00232         LINVRNT(iot == <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378a30c0e746c178fe52f3c6f3939df1b2cb" title="read system call">CIT_READ</a> || iot == <a class="code" href="group__cl__io.html#gga7ce44ceebcd945560fa661571e3a4378aa9c9f93ccf31c58b09085a8460ed1475" title="write system call">CIT_WRITE</a>);
<a name="l00233"></a>00233         LINVRNT(io-&gt;<a class="code" href="structcl__io.html#ab2758184445778d1acf0282ac0e6687b" title="main object this io is against.">ci_obj</a> != NULL);
<a name="l00234"></a>00234         ENTRY;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         <a class="code" href="group__lu.html#gab6811b221fe08d6e5b46ce532fdd1059" title="Print short object description followed by a user-supplied message.">LU_OBJECT_HEADER</a>(D_VFSTRACE, env, &amp;io-&gt;<a class="code" href="structcl__io.html#ab2758184445778d1acf0282ac0e6687b" title="main object this io is against.">ci_obj</a>-&gt;<a class="code" href="structcl__object.html#acff3a09f38d513eda81deb6644332c2d" title="super class">co_lu</a>,
<a name="l00237"></a>00237                          <span class="stringliteral">&quot;io range: %u [&quot;</span>LPU64<span class="stringliteral">&quot;, &quot;</span>LPU64<span class="stringliteral">&quot;) %u %u\n&quot;</span>,
<a name="l00238"></a>00238                          iot, (__u64)pos, (__u64)pos + count,
<a name="l00239"></a>00239                          io-&gt;u.ci_rw.crw_nonblock, io-&gt;u.ci_wr.wr_append);
<a name="l00240"></a>00240         io-&gt;u.ci_rw.crw_pos    = pos;
<a name="l00241"></a>00241         io-&gt;u.ci_rw.crw_count  = count;
<a name="l00242"></a>00242         RETURN(<a class="code" href="group__cl__io.html#ga2a75c8a7a83eb31d6c899da9dc5143b1" title="Initialize io, by calling cl_io_operations::cio_init() top-to-bottom.">cl_io_init</a>(env, io, iot, io-&gt;<a class="code" href="structcl__io.html#ab2758184445778d1acf0282ac0e6687b" title="main object this io is against.">ci_obj</a>));
<a name="l00243"></a>00243 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_gacff72463468f75b6af811bf709aefa9d_cgraph.png" border="0" usemap="#group__cl__io_gacff72463468f75b6af811bf709aefa9d_cgraph_map" alt=""></div>
<map name="group__cl__io_gacff72463468f75b6af811bf709aefa9d_cgraph_map" id="group__cl__io_gacff72463468f75b6af811bf709aefa9d_cgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga2a75c8a7a83eb31d6c899da9dc5143b1" title="Initialize io, by calling cl_io_operations::cio_init() top&#45;to&#45;bottom." alt="" coords="159,5,236,35"/><area shape="rect" id="node5" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top&#45;object for a given o." alt="" coords="285,5,400,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga485aa4a9e93475523519f07aca310bac"></a><!-- doxytag: member="cl_object.h::cl_io_sub_init" ref="ga485aa4a9e93475523519f07aca310bac" args="(const struct lu_env *env, struct cl_io *io, enum cl_io_type iot, struct cl_object *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_sub_init </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__cl__io.html#ga7ce44ceebcd945560fa661571e3a4378">cl_io_type</a>&nbsp;</td>
          <td class="paramname"> <em>iot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__object.html">cl_object</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize sub-io, by calling cl_io_operations::cio_init() top-to-bottom. </p>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>obj != cl_object_top(obj) </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00189">189</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8c_source.html#l00145">cl_object_top()</a>, and <a class="el" href="cl__internal_8h_source.html#l00107">cl_thread_info::clt_current_io</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00191"></a>00191 {
<a name="l00192"></a>00192         <span class="keyword">struct </span><a class="code" href="structcl__thread__info.html" title="Thread local state internal for generic cl-code.">cl_thread_info</a> *info = cl_env_info(env);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         LASSERT(obj != <a class="code" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top-object for a given o.">cl_object_top</a>(obj));
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structcl__thread__info.html#a9483e30eb2d58f1ed5eb6224090af583" title="Pointer to the topmost ongoing IO in this thread.">clt_current_io</a> == NULL)
<a name="l00196"></a>00196                 info-&gt;<a class="code" href="structcl__thread__info.html#a9483e30eb2d58f1ed5eb6224090af583" title="Pointer to the topmost ongoing IO in this thread.">clt_current_io</a> = io;
<a name="l00197"></a>00197         <span class="keywordflow">return</span> cl_io_init0(env, io, iot, obj);
<a name="l00198"></a>00198 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga485aa4a9e93475523519f07aca310bac_cgraph.png" border="0" usemap="#group__cl__io_ga485aa4a9e93475523519f07aca310bac_cgraph_map" alt=""></div>
<map name="group__cl__io_ga485aa4a9e93475523519f07aca310bac_cgraph_map" id="group__cl__io_ga485aa4a9e93475523519f07aca310bac_cgraph">
<area shape="rect" id="node3" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top&#45;object for a given o." alt="" coords="163,5,277,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gae609957e435aaa7c3044b45cada6b96c"></a><!-- doxytag: member="cl_object.h::cl_io_submit_rw" ref="gae609957e435aaa7c3044b45cada6b96c" args="(const struct lu_env *env, struct cl_io *io, enum cl_req_type iot, struct cl_2queue *queue)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_submit_rw </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__cl__page.html#ga419215a2ca4eeab85983de8ca5a16a02">cl_req_type</a>&nbsp;</td>
          <td class="paramname"> <em>crt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__2queue.html">cl_2queue</a> *&nbsp;</td>
          <td class="paramname"> <em>queue</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Submits a list of pages for immediate io. </p>
<p>After the function gets returned, The submitted pages are moved to queue-&gt;c2_qout queue, and queue-&gt;c2_qin contain both the pages don't need to be submitted, and the pages are errant to submit.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if at least one page was submitted, error code otherwise. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="structcl__io__operations.html#a2aa87d92a0f183a26ae076afc9b8b74f" title="Submit pages from queue-&gt;c2_qin for IO, and move successfully submitted pages...">cl_io_operations::cio_submit()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00676">676</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="structcl__io__operations.html#a2aa87d92a0f183a26ae076afc9b8b74f">cl_io_operations::cio_submit</a>, and <a class="el" href="cl__object_8h_source.html#l01443">cl_io_slice::cis_iop</a>.</p>

<p>Referenced by <a class="el" href="cl__io_8c_source.html#l00702">cl_io_submit_sync()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00678"></a>00678 {
<a name="l00679"></a>00679         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcl__io__slice.html" title="IO state private for a layer.">cl_io_slice</a> *scan;
<a name="l00680"></a>00680         <span class="keywordtype">int</span> result = 0;
<a name="l00681"></a>00681         ENTRY;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         cl_io_for_each(scan, io) {
<a name="l00684"></a>00684                 <span class="keywordflow">if</span> (scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a2aa87d92a0f183a26ae076afc9b8b74f" title="Submit pages from queue-&amp;gt;c2_qin for IO, and move successfully submitted pages...">cio_submit</a> == NULL)
<a name="l00685"></a>00685                         <span class="keywordflow">continue</span>;
<a name="l00686"></a>00686                 result = scan-&gt;<a class="code" href="structcl__io__slice.html#a18ddc4d2d844be0a28d5303ca1e79964" title="io operations.">cis_iop</a>-&gt;<a class="code" href="structcl__io__operations.html#a2aa87d92a0f183a26ae076afc9b8b74f" title="Submit pages from queue-&amp;gt;c2_qin for IO, and move successfully submitted pages...">cio_submit</a>(env, scan, crt, queue);
<a name="l00687"></a>00687                 <span class="keywordflow">if</span> (result != 0)
<a name="l00688"></a>00688                         <span class="keywordflow">break</span>;
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690         <span class="comment">/*</span>
<a name="l00691"></a>00691 <span class="comment">         * If -&gt;cio_submit() failed, no pages were sent.</span>
<a name="l00692"></a>00692 <span class="comment">         */</span>
<a name="l00693"></a>00693         LASSERT(ergo(result != 0, list_empty(&amp;queue-&gt;c2_qout.pl_pages)));
<a name="l00694"></a>00694         RETURN(result);
<a name="l00695"></a>00695 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_gae609957e435aaa7c3044b45cada6b96c_icgraph.png" border="0" usemap="#group__cl__io_gae609957e435aaa7c3044b45cada6b96c_icgraph_map" alt=""></div>
<map name="group__cl__io_gae609957e435aaa7c3044b45cada6b96c_icgraph_map" id="group__cl__io_gae609957e435aaa7c3044b45cada6b96c_icgraph">
<area shape="rect" id="node3" href="group__cl__io.html#ga575a43e2ec65ba4aa6c926cf5e49fe70" title="Submit a sync_io and wait for the IO to be finished, or error happens." alt="" coords="183,5,324,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga575a43e2ec65ba4aa6c926cf5e49fe70"></a><!-- doxytag: member="cl_object.h::cl_io_submit_sync" ref="ga575a43e2ec65ba4aa6c926cf5e49fe70" args="(const struct lu_env *env, struct cl_io *io, enum cl_req_type iot, struct cl_2queue *queue, long timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cl_io_submit_sync </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__cl__page.html#ga419215a2ca4eeab85983de8ca5a16a02">cl_req_type</a>&nbsp;</td>
          <td class="paramname"> <em>iot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcl__2queue.html">cl_2queue</a> *&nbsp;</td>
          <td class="paramname"> <em>queue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Submit a sync_io and wait for the IO to be finished, or error happens. </p>
<p>If <em>timeout</em> is zero, it means to wait for the IO unconditionally. </p>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l00702">702</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__io_8c_source.html#l00676">cl_io_submit_rw()</a>, <a class="el" href="cl__io_8c_source.html#l01038">cl_page_list_assume()</a>, <a class="el" href="cl__object_8h_source.html#l02346">cl_page_list_for_each</a>, <a class="el" href="cl__io_8c_source.html#l01202">cl_sync_io_init()</a>, <a class="el" href="cl__io_8c_source.html#l01258">cl_sync_io_note()</a>, <a class="el" href="cl__io_8c_source.html#l01221">cl_sync_io_wait()</a>, <a class="el" href="cl__internal_8h_source.html#l00111">cl_thread_info::clt_anchor</a>, and <a class="el" href="cl__object_8h_source.html#l00750">cl_page::cp_sync_io</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00705"></a>00705 {
<a name="l00706"></a>00706         <span class="keyword">struct </span><a class="code" href="structcl__sync__io.html" title="Anchor for synchronous transfer.">cl_sync_io</a> *anchor = &amp;cl_env_info(env)-&gt;<a class="code" href="structcl__thread__info.html#a781696e18feaf78b895a129c01774e1e" title="Used for submitting a sync io.">clt_anchor</a>;
<a name="l00707"></a>00707         <span class="keyword">struct </span><a class="code" href="structcl__page.html" title="Fields are protected by the lock on struct page, except for atomics and immutables...">cl_page</a> *pg;
<a name="l00708"></a>00708         <span class="keywordtype">int</span> rc;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710         <a class="code" href="group__cl__page__list.html#ga31a6630a381a5667594d699aa7269794" title="Iterate over pages in a page list.">cl_page_list_for_each</a>(pg, &amp;queue-&gt;c2_qin) {
<a name="l00711"></a>00711                 LASSERT(pg-&gt;<a class="code" href="structcl__page.html#a9fee0561b08bf01258f9824f0c2b62d2" title="Assigned if doing a sync_io.">cp_sync_io</a> == NULL);
<a name="l00712"></a>00712                 pg-&gt;<a class="code" href="structcl__page.html#a9fee0561b08bf01258f9824f0c2b62d2" title="Assigned if doing a sync_io.">cp_sync_io</a> = anchor;
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <a class="code" href="group__cl__sync__io.html#ga9e4705c43e9207a09c6cd8c9fac1c3e5" title="Initialize synchronous io wait anchor.">cl_sync_io_init</a>(anchor, queue-&gt;c2_qin.pl_nr, &amp;cl_sync_io_end);
<a name="l00716"></a>00716         rc = <a class="code" href="group__cl__io.html#gae609957e435aaa7c3044b45cada6b96c" title="Submits a list of pages for immediate io.">cl_io_submit_rw</a>(env, io, iot, queue);
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (rc == 0) {
<a name="l00718"></a>00718                 <span class="comment">/*</span>
<a name="l00719"></a>00719 <span class="comment">                 * If some pages weren&apos;t sent for any reason (e.g.,</span>
<a name="l00720"></a>00720 <span class="comment">                 * read found up-to-date pages in the cache, or write found</span>
<a name="l00721"></a>00721 <span class="comment">                 * clean pages), count them as completed to avoid infinite</span>
<a name="l00722"></a>00722 <span class="comment">                 * wait.</span>
<a name="l00723"></a>00723 <span class="comment">                 */</span>
<a name="l00724"></a>00724                 <a class="code" href="group__cl__page__list.html#ga31a6630a381a5667594d699aa7269794" title="Iterate over pages in a page list.">cl_page_list_for_each</a>(pg, &amp;queue-&gt;c2_qin) {
<a name="l00725"></a>00725                         pg-&gt;<a class="code" href="structcl__page.html#a9fee0561b08bf01258f9824f0c2b62d2" title="Assigned if doing a sync_io.">cp_sync_io</a> = NULL;
<a name="l00726"></a>00726                         <a class="code" href="group__cl__sync__io.html#gadb134aa2c1fb3f510bb8fe2a6da02bb9" title="Indicate that transfer of a single page completed.">cl_sync_io_note</a>(env, anchor, 1);
<a name="l00727"></a>00727                 }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                 <span class="comment">/* wait for the IO to be finished. */</span>
<a name="l00730"></a>00730                 rc = <a class="code" href="group__cl__sync__io.html#ga92057d29f315080be03e18c0262a1871" title="Wait until all IO completes.">cl_sync_io_wait</a>(env, anchor, timeout);
<a name="l00731"></a>00731                 <a class="code" href="group__cl__page__list.html#ga321527c28a251fead1c4d8e7967da693" title="Assumes all pages in a queue.">cl_page_list_assume</a>(env, io, &amp;queue-&gt;c2_qout);
<a name="l00732"></a>00732         } <span class="keywordflow">else</span> {
<a name="l00733"></a>00733                 LASSERT(list_empty(&amp;queue-&gt;c2_qout.pl_pages));
<a name="l00734"></a>00734                 <a class="code" href="group__cl__page__list.html#ga31a6630a381a5667594d699aa7269794" title="Iterate over pages in a page list.">cl_page_list_for_each</a>(pg, &amp;queue-&gt;c2_qin)
<a name="l00735"></a>00735                         pg-&gt;<a class="code" href="structcl__page.html#a9fee0561b08bf01258f9824f0c2b62d2" title="Assigned if doing a sync_io.">cp_sync_io</a> = NULL;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737         return rc;
<a name="l00738"></a>00738 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga575a43e2ec65ba4aa6c926cf5e49fe70_cgraph.png" border="0" usemap="#group__cl__io_ga575a43e2ec65ba4aa6c926cf5e49fe70_cgraph_map" alt=""></div>
<map name="group__cl__io_ga575a43e2ec65ba4aa6c926cf5e49fe70_cgraph_map" id="group__cl__io_ga575a43e2ec65ba4aa6c926cf5e49fe70_cgraph">
<area shape="rect" id="node3" href="group__cl__io.html#gae609957e435aaa7c3044b45cada6b96c" title="Submits a list of pages for immediate io." alt="" coords="215,5,340,35"/><area shape="rect" id="node5" href="group__cl__page__list.html#ga321527c28a251fead1c4d8e7967da693" title="Assumes all pages in a queue." alt="" coords="199,59,356,88"/><area shape="rect" id="node11" href="group__cl__sync__io.html#ga9e4705c43e9207a09c6cd8c9fac1c3e5" title="Initialize synchronous io wait anchor." alt="" coords="219,112,336,141"/><area shape="rect" id="node13" href="group__cl__sync__io.html#gadb134aa2c1fb3f510bb8fe2a6da02bb9" title="Indicate that transfer of a single page completed." alt="" coords="213,165,341,195"/><area shape="rect" id="node15" href="group__cl__sync__io.html#ga92057d29f315080be03e18c0262a1871" title="Wait until all IO completes." alt="" coords="215,219,340,248"/><area shape="rect" id="node7" href="group__cl__page.html#ga77a2e8592e58cc9c514cb4ac38a9d2f4" title="Assume page ownership." alt="" coords="407,59,537,88"/><area shape="rect" id="node9" href="group__cl__io.html#ga4bb065eb52291173dbda9a0721b1ea2c" title="Returns top&#45;level io." alt="" coords="588,59,668,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga4bb065eb52291173dbda9a0721b1ea2c"></a><!-- doxytag: member="cl_object.h::cl_io_top" ref="ga4bb065eb52291173dbda9a0721b1ea2c" args="(struct cl_io *io)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcl__io.html">cl_io</a>* cl_io_top </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcl__io.html">cl_io</a> *&nbsp;</td>
          <td class="paramname"> <em>io</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns top-level io. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__cl__object.html#ga00ef0f7240b9a7d773a49a77c667f03a" title="Returns the top-object for a given o.">cl_object_top()</a> </dd></dl>

<p>Definition at line <a class="el" href="cl__io_8c_source.html#l01152">1152</a> of file <a class="el" href="cl__io_8c_source.html">cl_io.c</a>.</p>

<p>References <a class="el" href="cl__object_8h_source.html#l01757">ci_parent</a>.</p>

<p>Referenced by <a class="el" href="cl__page_8c_source.html#l00652">cl_page_assume()</a>, <a class="el" href="cl__page_8c_source.html#l00709">cl_page_disown()</a>, <a class="el" href="cl__page_8c_source.html#l00555">cl_page_is_owned()</a>, and <a class="el" href="cl__page_8c_source.html#l00680">cl_page_unassume()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01153"></a>01153 {
<a name="l01154"></a>01154         ENTRY;
<a name="l01155"></a>01155         <span class="keywordflow">while</span> (io-&gt;<a class="code" href="structcl__io.html#a0848dbd9565e8113af8636a8182f9e1d" title="Upper layer io, of which this io is a part of.">ci_parent</a> != NULL)
<a name="l01156"></a>01156                 io = io-&gt;<a class="code" href="structcl__io.html#a0848dbd9565e8113af8636a8182f9e1d" title="Upper layer io, of which this io is a part of.">ci_parent</a>;
<a name="l01157"></a>01157         RETURN(io);
<a name="l01158"></a>01158 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__cl__io_ga4bb065eb52291173dbda9a0721b1ea2c_icgraph.png" border="0" usemap="#group__cl__io_ga4bb065eb52291173dbda9a0721b1ea2c_icgraph_map" alt=""></div>
<map name="group__cl__io_ga4bb065eb52291173dbda9a0721b1ea2c_icgraph_map" id="group__cl__io_ga4bb065eb52291173dbda9a0721b1ea2c_icgraph">
<area shape="rect" id="node3" href="group__cl__page.html#ga77a2e8592e58cc9c514cb4ac38a9d2f4" title="Assume page ownership." alt="" coords="141,67,272,96"/><area shape="rect" id="node11" href="group__cl__page.html#gae41a4c98faae723b2566a721b6e4b7fb" title="Releases page ownership." alt="" coords="343,112,468,141"/><area shape="rect" id="node17" href="group__cl__page.html#gabf5979233c47e0913f8d438d01051ebf" title="returns true, iff page is owned by the given io." alt="" coords="136,212,277,241"/><area shape="rect" id="node30" href="group__cl__page.html#ga4e7db1845b76bea8277b4e3d2a482f61" title="Releases page ownership without unlocking the page." alt="" coords="332,325,479,355"/><area shape="rect" id="node5" href="group__cl__page__list.html#ga321527c28a251fead1c4d8e7967da693" title="Assumes all pages in a queue." alt="" coords="327,59,484,88"/><area shape="rect" id="node7" href="group__cl__page__list.html#gaf1c12344f300cfdabbaabba9544db1da" title="Assume to own the pages in cl_2queue." alt="" coords="536,5,685,35"/><area shape="rect" id="node9" href="group__cl__io.html#ga575a43e2ec65ba4aa6c926cf5e49fe70" title="Submit a sync_io and wait for the IO to be finished, or error happens." alt="" coords="540,59,681,88"/><area shape="rect" id="node13" href="group__osc.html#gacad2bab69d5c52c6248c0b76fcf1e93a" title="Drop &#160;of pages from LRU at most." alt="" coords="555,112,667,141"/><area shape="rect" id="node15" href="group__osc.html#ga084c788be8d116db87ebdd3c273d9a23" title="Scan and try to reclaim sc&#45;&gt;nr_to_scan cached LRU pages." alt="" coords="736,112,912,141"/><area shape="rect" id="node19" href="group__cl__page.html#ga775efaa18bd22d404f7588fd35f6cd03" title="Called when page is to be removed from the object, e.g., as a result of truncate..." alt="" coords="343,165,468,195"/><area shape="rect" id="node26" href="group__cl__page.html#ga0616bcd8605ed9a75e799f64bcdd5a2d" title="Called if a pge is being written back by kernel&#39;s intention." alt="" coords="349,219,461,248"/><area shape="rect" id="node28" href="group__cl__page.html#ga8216a843e48aa6d45d049b6aacb13744" title="Prepares page for immediate transfer." alt="" coords="351,272,460,301"/><area shape="rect" id="node21" href="group__cl__page__list.html#gabe8fbe4bdda923be3d8ee245549230f8" title="Discards all pages in a queue." alt="" coords="533,165,688,195"/><area shape="rect" id="node23" href="group__cl__page__list.html#gab47261ab07f2e439b306dccb18a0980e" title="Discard (truncate) pages in both lists of a 2&#45;queue." alt="" coords="752,165,896,195"/></map>
</div>
</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:38 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
