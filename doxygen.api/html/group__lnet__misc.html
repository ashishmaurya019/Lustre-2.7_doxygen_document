<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: Miscellaneous operations.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Miscellaneous operations.<br/>
<small>
[<a class="el" href="group__lnet.html">LNet</a>]</small>
</h1>
<p>Miscellaneous operations.  
<a href="#_details">More...</a></p>

<p><div class="dynheader">
Collaboration diagram for Miscellaneous operations.:</div>
<div class="dynsection">
<center><table><tr><td><img src="group__lnet__misc.png" border="0" alt="" usemap="#group____lnet____misc_map"/>
<map name="group____lnet____misc_map" id="group____lnet____misc">
<area shape="rect" id="node2" href="group__lnet.html" title="The Lustre Networking subsystem." alt="" coords="5,5,61,35"/></map></td></tr></table></center>
</div>
</p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lnet__misc.html#ga1986737ae4fa6d8756708df641f024e3">LNetSetLazyPortal</a> (int portal)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Turn on the lazy portal attribute.  <a href="#ga1986737ae4fa6d8756708df641f024e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lnet__misc.html#ga8dd90e2ffad743128236983380bab6db">LNetClearLazyPortal</a> (int portal)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Turn off the lazy portal attribute.  <a href="#ga8dd90e2ffad743128236983380bab6db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4feb5dc040fabdac2a7bd61ee5b2aa64"></a><!-- doxytag: member="lnet_misc::LNetCtl" ref="ga4feb5dc040fabdac2a7bd61ee5b2aa64" args="(unsigned int cmd, void *arg)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lnet__misc.html#ga4feb5dc040fabdac2a7bd61ee5b2aa64">LNetCtl</a> (unsigned int cmd, void *arg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">LNet ioctl handler. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab75e868007b205e6bdb46743994ff366"></a><!-- doxytag: member="lnet_misc::LNetDebugPeer" ref="gab75e868007b205e6bdb46743994ff366" args="(lnet_process_id_t id)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>LNetDebugPeer</b> (<a class="el" href="structlnet__process__id__t.html">lnet_process_id_t</a> id)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Miscellaneous operations. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga8dd90e2ffad743128236983380bab6db"></a><!-- doxytag: member="api.h::LNetClearLazyPortal" ref="ga8dd90e2ffad743128236983380bab6db" args="(int portal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LNetClearLazyPortal </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>portal</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Turn off the lazy portal attribute. </p>
<p>Delayed requests on the portal, if any, will be all dropped when this function returns.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>portal</em>&nbsp;</td><td>Index of the portal to disable the lazy attribute on.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>On success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>If <em>portal</em> is not a valid index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lib-ptl_8c_source.html#l00977">977</a> of file <a class="el" href="lib-ptl_8c_source.html">lib-ptl.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00978"></a>00978 {
<a name="l00979"></a>00979         <span class="keywordflow">return</span> lnet_clear_lazy_portal(NULL, portal,
<a name="l00980"></a>00980                                       <span class="stringliteral">&quot;Clearing lazy portal attr&quot;</span>);
<a name="l00981"></a>00981 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga1986737ae4fa6d8756708df641f024e3"></a><!-- doxytag: member="api.h::LNetSetLazyPortal" ref="ga1986737ae4fa6d8756708df641f024e3" args="(int portal)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LNetSetLazyPortal </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>portal</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Turn on the lazy portal attribute. </p>
<p>Use with caution!</p>
<p>This portal attribute only affects incoming PUT requests to the portal, and is off by default. By default, if there's no matching MD for an incoming PUT request, it is simply dropped. With the lazy attribute on, such requests are queued indefinitely until either a matching MD is posted to the portal or the lazy attribute is turned off.</p>
<p>It would prevent dropped requests, however it should be regarded as the last line of defense - i.e. users must keep a close watch on active buffers on a lazy portal and once it becomes too low post more buffers as soon as possible. This is because delayed requests usually have detrimental effects on underlying <a class="el" href="structnetwork.html">network</a> connections. A few delayed requests often suffice to bring an underlying connection to a complete halt, due to flow control mechanisms.</p>
<p>There's also a DOS attack risk. If users don't post match-all MDs on a lazy portal, a malicious peer can easily stop a service by sending some PUT requests with match bits that won't match any MD. A routed server is especially vulnerable since the connections to its neighbor routers are shared among all clients.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>portal</em>&nbsp;</td><td>Index of the portal to enable the lazy attribute on.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>On success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-EINVAL</em>&nbsp;</td><td>If <em>portal</em> is not a valid index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lib-ptl_8c_source.html#l00896">896</a> of file <a class="el" href="lib-ptl_8c_source.html">lib-ptl.c</a>.</p>

<p>Referenced by <a class="el" href="service_8c_source.html#l00690">ptlrpc_register_service()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00897"></a>00897 {
<a name="l00898"></a>00898         <span class="keyword">struct </span><a class="code" href="structlnet__portal.html">lnet_portal</a> *ptl;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900         <span class="keywordflow">if</span> (portal &lt; 0 || portal &gt;= the_lnet.ln_nportals)
<a name="l00901"></a>00901                 <span class="keywordflow">return</span> -EINVAL;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         CDEBUG(D_NET, <span class="stringliteral">&quot;Setting portal %d lazy\n&quot;</span>, portal);
<a name="l00904"></a>00904         ptl = the_lnet.ln_portals[portal];
<a name="l00905"></a>00905 
<a name="l00906"></a>00906         lnet_res_lock(LNET_LOCK_EX);
<a name="l00907"></a>00907         lnet_ptl_lock(ptl);
<a name="l00908"></a>00908 
<a name="l00909"></a>00909         lnet_ptl_setopt(ptl, LNET_PTL_LAZY);
<a name="l00910"></a>00910 
<a name="l00911"></a>00911         lnet_ptl_unlock(ptl);
<a name="l00912"></a>00912         lnet_res_unlock(LNET_LOCK_EX);
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="keywordflow">return</span> 0;
<a name="l00915"></a>00915 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__lnet__misc_ga1986737ae4fa6d8756708df641f024e3_icgraph.png" border="0" usemap="#group__lnet__misc_ga1986737ae4fa6d8756708df641f024e3_icgraph_map" alt=""></div>
<map name="group__lnet__misc_ga1986737ae4fa6d8756708df641f024e3_icgraph_map" id="group__lnet__misc_ga1986737ae4fa6d8756708df641f024e3_icgraph">
<area shape="rect" id="node3" href="group__net.html#ga13835bf69545de9744051ff7ef02a4c3" title="Initialize service on a given portal." alt="" coords="207,5,383,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:48 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
