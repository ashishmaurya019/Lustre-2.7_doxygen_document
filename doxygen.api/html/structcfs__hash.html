<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: cfs_hash Struct Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cfs_hash Struct Reference</h1><!-- doxytag: class="cfs_hash" -->
<p><a class="el" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a> is a hash-table implementation for general purpose, it can support: 
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="libcfs__hash_8h_source.html">libcfs_hash.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for cfs_hash:</div>
<div class="dynsection">
<div class="center"><img src="structcfs__hash__coll__graph.png" border="0" usemap="#cfs__hash_coll__map" alt="Collaboration graph"/></div>
<map name="cfs__hash_coll__map" id="cfs__hash_coll__map">
<area shape="rect" id="node2" href="unioncfs__hash__lock.html" title="{cfs_hash_lock\n|+ rw\l+ spin\l|}" alt="" coords="5,177,117,279"/><area shape="rect" id="node9" href="structcfs__hash__bucket.html" title="cfs_hash_bucket is a container of:lock, counter ." alt="" coords="99,373,232,545"/><area shape="rect" id="node4" href="structcfs__workitem.html" title="{cfs_workitem\n|+ wi_list\l+ wi_action\l+ wi_data\l+ wi_running\l+ wi_scheduled\l|}" alt="" coords="256,381,381,536"/><area shape="rect" id="node6" href="structlist__head.html" title="{list_head\n|+ next\l+ prev\l|}" alt="" coords="273,177,356,279"/><area shape="rect" id="node12" href="structcfs__hash__hlist__ops.html" title="{cfs_hash_hlist_ops\n|+ hop_hhead\l+ hop_hhead_size\l+ hop_hnode_add\l+ hop_hnode_del\l|}" alt="" coords="405,390,549,527"/><area shape="rect" id="node14" href="structhlist__head.html" title="{hlist_head\n|+ first\l|}" alt="" coords="437,185,528,271"/><area shape="rect" id="node16" href="structhlist__node.html" title="{hlist_node\n|+ next\l+ pprev\l|}" alt="" coords="437,6,528,109"/><area shape="rect" id="node19" href="structcfs__hash__lock__ops.html" title="{cfs_hash_lock_ops\n|+ hs_lock\l+ hs_unlock\l+ hs_bkt_lock\l+ hs_bkt_unlock\l|}" alt="" coords="573,390,715,527"/><area shape="rect" id="node21" href="structcfs__hash__ops.html" title="{cfs_hash_ops\n|+ hs_hash\l+ hs_key\l+ hs_keycpy\l+ hs_keycmp\l+ hs_object\l+ hs_get\l+ hs_put\l+ hs_put_locked\l+ hs_exit\l|}" alt="" coords="739,347,869,571"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8a6786b1f4bad4c8487a445464bf2b64"></a><!-- doxytag: member="cfs_hash::hs_lock" ref="a8a6786b1f4bad4c8487a445464bf2b64" args="" -->
union <a class="el" href="unioncfs__hash__lock.html">cfs_hash_lock</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a8a6786b1f4bad4c8487a445464bf2b64">hs_lock</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">serialize with rehash, or serialize all operations if the hash-table has CFS_HASH_NO_BKTLOCK <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a142d72c3de915e025c2c73e902b1deb7"></a><!-- doxytag: member="cfs_hash::hs_ops" ref="a142d72c3de915e025c2c73e902b1deb7" args="" -->
struct <a class="el" href="structcfs__hash__ops.html">cfs_hash_ops</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a142d72c3de915e025c2c73e902b1deb7">hs_ops</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash operations <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35f27e7c4c3c28aa332a7e9727b9b370"></a><!-- doxytag: member="cfs_hash::hs_lops" ref="a35f27e7c4c3c28aa332a7e9727b9b370" args="" -->
struct <a class="el" href="structcfs__hash__lock__ops.html">cfs_hash_lock_ops</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a35f27e7c4c3c28aa332a7e9727b9b370">hs_lops</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash lock operations <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8ecac20b030cab05599bcbc426fa12ff"></a><!-- doxytag: member="cfs_hash::hs_hops" ref="a8ecac20b030cab05599bcbc426fa12ff" args="" -->
struct <a class="el" href="structcfs__hash__hlist__ops.html">cfs_hash_hlist_ops</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a8ecac20b030cab05599bcbc426fa12ff">hs_hops</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash list operations <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0037382aac15aa98e7769f3a1e705ec2"></a><!-- doxytag: member="cfs_hash::hs_buckets" ref="a0037382aac15aa98e7769f3a1e705ec2" args="" -->
struct <a class="el" href="structcfs__hash__bucket.html">cfs_hash_bucket</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a0037382aac15aa98e7769f3a1e705ec2">hs_buckets</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash buckets-table <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6468533a211d7ba8dbe065344b26cb20"></a><!-- doxytag: member="cfs_hash::hs_count" ref="a6468533a211d7ba8dbe065344b26cb20" args="" -->
atomic_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a6468533a211d7ba8dbe065344b26cb20">hs_count</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">total number of items on this hash-table <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa124601989b8b1fa7638f2ae3bdb1a4d"></a><!-- doxytag: member="cfs_hash::hs_flags" ref="aa124601989b8b1fa7638f2ae3bdb1a4d" args="" -->
__u16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#aa124601989b8b1fa7638f2ae3bdb1a4d">hs_flags</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash flags, see cfs_hash_tag for detail <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8f5538ba428a5d1bfcbdedf2670675b"></a><!-- doxytag: member="cfs_hash::hs_extra_bytes" ref="ae8f5538ba428a5d1bfcbdedf2670675b" args="" -->
__u16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#ae8f5538ba428a5d1bfcbdedf2670675b">hs_extra_bytes</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"># of extra-bytes for bucket, for user saving extended attributes <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a066dc687739a76cc3a7325c54dd22be2"></a><!-- doxytag: member="cfs_hash::hs_iterating" ref="a066dc687739a76cc3a7325c54dd22be2" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a066dc687739a76cc3a7325c54dd22be2">hs_iterating</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">wants to iterate <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aecc3bc4853e3dc9a05c1101303105ab3"></a><!-- doxytag: member="cfs_hash::hs_exiting" ref="aecc3bc4853e3dc9a05c1101303105ab3" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#aecc3bc4853e3dc9a05c1101303105ab3">hs_exiting</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hash-table is dying <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0708aef0dadfbea4f8eda2255ea586a0"></a><!-- doxytag: member="cfs_hash::hs_cur_bits" ref="a0708aef0dadfbea4f8eda2255ea586a0" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a0708aef0dadfbea4f8eda2255ea586a0">hs_cur_bits</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">current hash bits <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5fc9fa938616d397812796ef3ab93bc3"></a><!-- doxytag: member="cfs_hash::hs_min_bits" ref="a5fc9fa938616d397812796ef3ab93bc3" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a5fc9fa938616d397812796ef3ab93bc3">hs_min_bits</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">min hash bits <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2c32479538c0b4195ff8b63df9ee652b"></a><!-- doxytag: member="cfs_hash::hs_max_bits" ref="a2c32479538c0b4195ff8b63df9ee652b" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a2c32479538c0b4195ff8b63df9ee652b">hs_max_bits</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">max hash bits <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afa9cc26fb1cdf53bf93306a646fc4a12"></a><!-- doxytag: member="cfs_hash::hs_rehash_bits" ref="afa9cc26fb1cdf53bf93306a646fc4a12" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#afa9cc26fb1cdf53bf93306a646fc4a12">hs_rehash_bits</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">bits for rehash <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a617308284ebe6349f4506b0a8edd9834"></a><!-- doxytag: member="cfs_hash::hs_bkt_bits" ref="a617308284ebe6349f4506b0a8edd9834" args="" -->
__u8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a617308284ebe6349f4506b0a8edd9834">hs_bkt_bits</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">bits for each bucket <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a20d7e9ee877b7ffe878c78d369e7a5a4"></a><!-- doxytag: member="cfs_hash::hs_min_theta" ref="a20d7e9ee877b7ffe878c78d369e7a5a4" args="" -->
__u16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a20d7e9ee877b7ffe878c78d369e7a5a4">hs_min_theta</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">resize min threshold <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a244197b47c9b68b72738849c33a26977"></a><!-- doxytag: member="cfs_hash::hs_max_theta" ref="a244197b47c9b68b72738849c33a26977" args="" -->
__u16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a244197b47c9b68b72738849c33a26977">hs_max_theta</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">resize max threshold <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa566defe2de2633a747200ff9eb4c58e"></a><!-- doxytag: member="cfs_hash::hs_rehash_count" ref="aa566defe2de2633a747200ff9eb4c58e" args="" -->
__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#aa566defe2de2633a747200ff9eb4c58e">hs_rehash_count</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">resize count <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a32503470d27f50a830cdaeda3ae6adbc"></a><!-- doxytag: member="cfs_hash::hs_iterators" ref="a32503470d27f50a830cdaeda3ae6adbc" args="" -->
__u32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a32503470d27f50a830cdaeda3ae6adbc">hs_iterators</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"># of iterators (caller of cfs_hash_for_each_*) <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3869f462a16492f575df4d84e4497c4c"></a><!-- doxytag: member="cfs_hash::hs_rehash_wi" ref="a3869f462a16492f575df4d84e4497c4c" args="" -->
struct <a class="el" href="structcfs__workitem.html">cfs_workitem</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a3869f462a16492f575df4d84e4497c4c">hs_rehash_wi</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">rehash workitem <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1521cb8e379605aaf330a824de2f6a0b"></a><!-- doxytag: member="cfs_hash::hs_refcount" ref="a1521cb8e379605aaf330a824de2f6a0b" args="" -->
atomic_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a1521cb8e379605aaf330a824de2f6a0b">hs_refcount</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">refcount on this hash table <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a150c977fb93e52fc252f0095440e8ef7"></a><!-- doxytag: member="cfs_hash::hs_rehash_buckets" ref="a150c977fb93e52fc252f0095440e8ef7" args="" -->
struct <a class="el" href="structcfs__hash__bucket.html">cfs_hash_bucket</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a150c977fb93e52fc252f0095440e8ef7">hs_rehash_buckets</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">rehash buckets-table <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a08d0891326130dcdfbd39d6d85aa3dd3"></a><!-- doxytag: member="cfs_hash::hs_name" ref="a08d0891326130dcdfbd39d6d85aa3dd3" args="[0]" -->
char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcfs__hash.html#a08d0891326130dcdfbd39d6d85aa3dd3">hs_name</a> [0]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">name of htable <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="structcfs__hash.html" title="cfs_hash is a hash-table implementation for general purpose, it can support: .">cfs_hash</a> is a hash-table implementation for general purpose, it can support:</p>
<p>two refcount modes hash-table with &amp; without refcount . four lock modes nolock, one-spinlock, rw-bucket-lock, spin-bucket-lock . general operations lookup, add(add_tail or add_head), delete . rehash grows or shrink . iteration locked iteration and unlocked iteration . bigname support long name hash . debug trace max searching depth</p>
<p>Rehash: When the htable grows or shrinks, a separate task (cfs_hash_rehash_worker) is spawned to handle the rehash in the background, it's possible that other processes can concurrently perform additions, deletions, and lookups without being blocked on rehash completion, because rehash will release the global wrlock for each bucket.</p>
<p>rehash and iteration can't run at the same time because it's too tricky to keep both of them safe and correct. As they are relatively rare operations, so: . if iteration is in progress while we try to launch rehash, then it just giveup, iterator will launch rehash at the end. . if rehash is in progress while we try to iterate the hash table, then we just wait (shouldn't be very long time), anyway, nobody should expect iteration of whole hash-table to be non-blocking.</p>
<p>During rehashing, a (key,object) pair may be in one of two buckets, depending on whether the worker task has yet to transfer the object to its new location in the table. Lookups and deletions need to search both locations; additions must take care to only insert into the new bucket. </p>

<p>Definition at line <a class="el" href="libcfs__hash_8h_source.html#l00207">207</a> of file <a class="el" href="libcfs__hash_8h_source.html">libcfs_hash.h</a>.</p>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>libcfs/include/libcfs/<a class="el" href="libcfs__hash_8h_source.html">libcfs_hash.h</a></li>
</ul>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:52 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
