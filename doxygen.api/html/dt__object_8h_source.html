<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: lustre/include/dt_object.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lustre/include/dt_object.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * GPL HEADER START</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License version 2 only,</span>
<a name="l00008"></a>00008 <span class="comment"> * as published by the Free Software Foundation.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00011"></a>00011 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00013"></a>00013 <span class="comment"> * General Public License version 2 for more details (a copy is included</span>
<a name="l00014"></a>00014 <span class="comment"> * in the LICENSE file that accompanied this code).</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * version 2 along with this program; If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * http://www.sun.com/software/products/lustre/docs/GPLv2.pdf</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * Please contact Sun Microsystems, Inc., 4150 Network Circle, Santa Clara,</span>
<a name="l00021"></a>00021 <span class="comment"> * CA 95054 USA or visit www.sun.com if you need additional information or</span>
<a name="l00022"></a>00022 <span class="comment"> * have any questions.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * GPL HEADER END</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 <span class="comment">/*</span>
<a name="l00027"></a>00027 <span class="comment"> * Copyright (c) 2007, 2010, Oracle and/or its affiliates. All rights reserved.</span>
<a name="l00028"></a>00028 <span class="comment"> * Use is subject to license terms.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * Copyright (c) 2011, 2015, Intel Corporation.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 <span class="comment">/*</span>
<a name="l00033"></a>00033 <span class="comment"> * This file is part of Lustre, http://www.lustre.org/</span>
<a name="l00034"></a>00034 <span class="comment"> * Lustre is a trademark of Sun Microsystems, Inc.</span>
<a name="l00035"></a>00035 <span class="comment"> */</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#ifndef __LUSTRE_DT_OBJECT_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define __LUSTRE_DT_OBJECT_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;obd_support.h&gt;</span>
<a name="l00053"></a>00053 <span class="comment">/*</span>
<a name="l00054"></a>00054 <span class="comment"> * super-class definitions.</span>
<a name="l00055"></a>00055 <span class="comment"> */</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;lu_object.h&gt;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;libcfs/libcfs.h&gt;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="keyword">struct </span>seq_file;
<a name="l00061"></a>00061 <span class="keyword">struct </span>proc_dir_entry;
<a name="l00062"></a>00062 <span class="keyword">struct </span><a class="code" href="structlustre__cfg.html">lustre_cfg</a>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>;
<a name="l00065"></a>00065 <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>;
<a name="l00066"></a>00066 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>;
<a name="l00067"></a>00067 <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a>;
<a name="l00068"></a>00068 <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a>;
<a name="l00069"></a>00069 <span class="keyword">struct </span><a class="code" href="structniobuf__remote.html">niobuf_remote</a>;
<a name="l00070"></a>00070 <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00073"></a>00073         MNTOPT_USERXATTR        = 0x00000001,
<a name="l00074"></a>00074         MNTOPT_ACL              = 0x00000002,
<a name="l00075"></a>00075 } mntopt_t;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="structdt__device__param.html">00077</a> <span class="keyword">struct </span><a class="code" href="structdt__device__param.html">dt_device_param</a> {
<a name="l00078"></a>00078         <span class="keywordtype">unsigned</span>           ddp_max_name_len;
<a name="l00079"></a>00079         <span class="keywordtype">unsigned</span>           ddp_max_nlink;
<a name="l00080"></a>00080         <span class="keywordtype">unsigned</span>           ddp_symlink_max;
<a name="l00081"></a>00081         mntopt_t           ddp_mntopts;
<a name="l00082"></a>00082         <span class="keywordtype">unsigned</span>           ddp_max_ea_size;
<a name="l00083"></a>00083         <span class="keywordtype">unsigned</span>           ddp_mount_type;
<a name="l00084"></a>00084         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> ddp_maxbytes;
<a name="l00085"></a>00085         <span class="comment">/* per-inode space consumption */</span>
<a name="l00086"></a>00086         <span class="keywordtype">short</span>              ddp_inodespace;
<a name="l00087"></a>00087         <span class="comment">/* maximum number of blocks in an extent */</span>
<a name="l00088"></a>00088         <span class="keywordtype">unsigned</span>           ddp_max_extent_blks;
<a name="l00089"></a>00089         <span class="comment">/* per-extent insertion overhead to be used by client for grant</span>
<a name="l00090"></a>00090 <span class="comment">         * calculation */</span>
<a name="l00091"></a>00091         <span class="keywordtype">unsigned</span>           ddp_extent_tax;
<a name="l00092"></a>00092 };
<a name="l00093"></a>00093 
<a name="l00097"></a>00097 <span class="keyword">struct </span><a class="code" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a>;
<a name="l00098"></a>00098 <span class="keyword">typedef</span> void (*dt_cb_t)(<span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l00099"></a>00099                         <span class="keyword">struct </span><a class="code" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *cb, <span class="keywordtype">int</span> err);
<a name="l00104"></a><a class="code" href="group__dt.html#ga89459f49f808512a60eea34fdcd5e43f">00104</a> <span class="preprocessor">#define TRANS_COMMIT_CB_MAGIC   0xa0a00a0a</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span><span class="preprocessor">#define MAX_COMMIT_CB_STR_LEN   32</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a>00107 <span class="preprocessor">#define DCB_TRANS_STOP          0x1</span>
<a name="l00108"></a><a class="code" href="structdt__txn__commit__cb.html">00108</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> {
<a name="l00109"></a>00109         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        dcb_linkage;
<a name="l00110"></a>00110         dt_cb_t                 dcb_func;
<a name="l00111"></a>00111         <span class="keywordtype">void</span>                    *dcb_data;
<a name="l00112"></a>00112         __u32                   dcb_magic;
<a name="l00113"></a>00113         __u32                   dcb_flags;
<a name="l00114"></a>00114         <span class="keywordtype">char</span>                    dcb_name[MAX_COMMIT_CB_STR_LEN];
<a name="l00115"></a>00115 };
<a name="l00116"></a>00116 
<a name="l00120"></a><a class="code" href="structdt__device__operations.html">00120</a> <span class="keyword">struct </span><a class="code" href="structdt__device__operations.html" title="Operations on dt device.">dt_device_operations</a> {
<a name="l00135"></a>00135         int   (*<a class="code" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_statfs</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00136"></a>00136                            <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00137"></a>00137                            <span class="keyword">struct </span><a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs);
<a name="l00138"></a>00138 
<a name="l00155"></a>00155         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *(*dt_trans_create)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00156"></a>00156                                            <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev);
<a name="l00157"></a>00157 
<a name="l00176"></a>00176         int   (*<a class="code" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_trans_start</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00177"></a>00177                                 <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00178"></a>00178                                 <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00179"></a>00179 
<a name="l00196"></a>00196         int   (*<a class="code" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_trans_stop</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00197"></a>00197                                <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00198"></a>00198                                <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00199"></a>00199 
<a name="l00220"></a>00220         int   (*<a class="code" href="structdt__device__operations.html#a977a253aad1d585cf9c316c3f87d801d" title="Add commit callback to the transaction.">dt_trans_cb_add</a>)(<span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l00221"></a>00221                                  <span class="keyword">struct </span><a class="code" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *dcb);
<a name="l00222"></a>00222 
<a name="l00238"></a>00238         int   (*<a class="code" href="structdt__device__operations.html#ad2a831d38be0be73f8a5498112e13b56" title="Return FID of root index object.">dt_root_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00239"></a>00239                              <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00240"></a>00240                              <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *f);
<a name="l00241"></a>00241 
<a name="l00253"></a>00253         void  (*<a class="code" href="structdt__device__operations.html#a652ff54fee6fbc7f4a5dda78befe5489" title="Return device configuration data.">dt_conf_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00254"></a>00254                              <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l00255"></a>00255                              <span class="keyword">struct </span><a class="code" href="structdt__device__param.html">dt_device_param</a> *param);
<a name="l00256"></a>00256 
<a name="l00272"></a>00272         int   (*<a class="code" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_sync</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00273"></a>00273                          <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev);
<a name="l00274"></a>00274 
<a name="l00289"></a>00289         int   (*<a class="code" href="structdt__device__operations.html#a03deb463a9aebe843829c31bbab1c34d" title="Make device read-only.">dt_ro</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00290"></a>00290                        <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev);
<a name="l00291"></a>00291 
<a name="l00308"></a>00308          int   (*<a class="code" href="structdt__device__operations.html#ab811b4bbba68f4edcab228e8d9f52d3c" title="Start transaction commit asynchronously.">dt_commit_async</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00309"></a>00309                                   <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *dev);
<a name="l00310"></a>00310 };
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="structdt__index__features.html">00312</a> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> {
<a name="l00314"></a><a class="code" href="structdt__index__features.html#a6e28f4490776ccf640ebe0cf484fd399">00314</a>         __u32 <a class="code" href="structdt__index__features.html#a6e28f4490776ccf640ebe0cf484fd399" title="required feature flags from enum dt_index_flags">dif_flags</a>;
<a name="l00316"></a><a class="code" href="structdt__index__features.html#ac7aa410827e498d147110abf38558568">00316</a>         <span class="keywordtype">size_t</span> <a class="code" href="structdt__index__features.html#ac7aa410827e498d147110abf38558568" title="minimal required key size">dif_keysize_min</a>;
<a name="l00318"></a><a class="code" href="structdt__index__features.html#a77a9d510b54a3321beab43f9fd27f72b">00318</a>         <span class="keywordtype">size_t</span> <a class="code" href="structdt__index__features.html#a77a9d510b54a3321beab43f9fd27f72b" title="maximal required key size, 0 if no limit">dif_keysize_max</a>;
<a name="l00320"></a><a class="code" href="structdt__index__features.html#a88a7d8aa4fc396ad2086af7de8b937f2">00320</a>         <span class="keywordtype">size_t</span> <a class="code" href="structdt__index__features.html#a88a7d8aa4fc396ad2086af7de8b937f2" title="minimal required record size">dif_recsize_min</a>;
<a name="l00322"></a><a class="code" href="structdt__index__features.html#af2fc6bfffa47d0412407d9290d32655d">00322</a>         <span class="keywordtype">size_t</span> <a class="code" href="structdt__index__features.html#af2fc6bfffa47d0412407d9290d32655d" title="maximal required record size, 0 if no limit">dif_recsize_max</a>;
<a name="l00324"></a><a class="code" href="structdt__index__features.html#a19644a422581281ac914664e8c44a66e">00324</a>         <span class="keywordtype">size_t</span> <a class="code" href="structdt__index__features.html#a19644a422581281ac914664e8c44a66e" title="pointer size for record">dif_ptrsize</a>;
<a name="l00325"></a>00325 };
<a name="l00326"></a>00326 
<a name="l00327"></a><a class="code" href="group__dt.html#gaea9a8b2931d0590dac0d8265121fd073">00327</a> <span class="keyword">enum</span> <a class="code" href="group__dt.html#gaea9a8b2931d0590dac0d8265121fd073">dt_index_flags</a> {
<a name="l00329"></a><a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073aef32729c6e8d2121075e256eabb309dc">00329</a>         <a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073aef32729c6e8d2121075e256eabb309dc" title="index supports variable sized keys">DT_IND_VARKEY</a> = 1 &lt;&lt; 0,
<a name="l00331"></a><a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a665c80fdf583c3b6fad49b7b2a59a97b">00331</a>         <a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a665c80fdf583c3b6fad49b7b2a59a97b" title="index supports variable sized records">DT_IND_VARREC</a> = 1 &lt;&lt; 1,
<a name="l00333"></a><a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a6528f1359f7a4f7626b6e1aa3b0d0eef">00333</a>         <a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a6528f1359f7a4f7626b6e1aa3b0d0eef" title="index can be modified">DT_IND_UPDATE</a> = 1 &lt;&lt; 2,
<a name="l00335"></a><a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a044b89f60c36ae2452a89148297b5494">00335</a>         <a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073a044b89f60c36ae2452a89148297b5494" title="index supports records with non-unique (duplicate) keys">DT_IND_NONUNQ</a> = 1 &lt;&lt; 3,
<a name="l00340"></a><a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073ae8406895b47a49eecdc3a0bae248d20e">00340</a>         <a class="code" href="group__dt.html#ggaea9a8b2931d0590dac0d8265121fd073ae8406895b47a49eecdc3a0bae248d20e" title="index support fixed-size keys sorted with natural numerical way and is able to return...">DT_IND_RANGE</a> = 1 &lt;&lt; 4,
<a name="l00341"></a>00341 };
<a name="l00342"></a>00342 
<a name="l00347"></a>00347 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> <a class="code" href="group__dt.html#ga7c4fc0f51c05675af9609faa67c6cdea" title="Features, required from index to support file system directories (mapping names to...">dt_directory_features</a>;
<a name="l00348"></a>00348 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_otable_features;
<a name="l00349"></a>00349 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_lfsck_orphan_features;
<a name="l00350"></a>00350 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_lfsck_features;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">/* index features supported by the accounting objects */</span>
<a name="l00353"></a>00353 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_acct_features;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">/* index features supported by the quota global indexes */</span>
<a name="l00356"></a>00356 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_quota_glb_features;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">/* index features supported by the quota slave indexes */</span>
<a name="l00359"></a>00359 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_quota_slv_features;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">/* index features supported by the nodemap index */</span>
<a name="l00362"></a>00362 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> dt_nodemap_features;
<a name="l00363"></a>00363 
<a name="l00369"></a><a class="code" href="structdt__allocation__hint.html">00369</a> <span class="keyword">struct </span><a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> {
<a name="l00370"></a>00370         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>        *dah_parent;
<a name="l00371"></a>00371         <span class="keyword">const</span> <span class="keywordtype">void</span>              *dah_eadata;
<a name="l00372"></a>00372         <span class="keywordtype">int</span>                     dah_eadata_len;
<a name="l00373"></a>00373         __u32                   dah_mode;
<a name="l00374"></a>00374 };
<a name="l00375"></a>00375 
<a name="l00380"></a><a class="code" href="group__dt.html#ga51d4c45efee77175aa61574dbc46b53e">00380</a> <span class="keyword">enum</span> <a class="code" href="group__dt.html#ga51d4c45efee77175aa61574dbc46b53e" title="object type specifier.">dt_format_type</a> {
<a name="l00381"></a>00381         DFT_REGULAR,
<a name="l00382"></a>00382         DFT_DIR,
<a name="l00384"></a><a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ea5ffd82c5e6e58403e141f5ab4867a310">00384</a>         <a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ea5ffd82c5e6e58403e141f5ab4867a310" title="for mknod">DFT_NODE</a>,
<a name="l00386"></a><a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ead93af9542695653a7e07004064dcfea4">00386</a>         <a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ead93af9542695653a7e07004064dcfea4" title="for special index">DFT_INDEX</a>,
<a name="l00388"></a><a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ea3ff5f1672deeb66303f63fc82b49fd11">00388</a>         <a class="code" href="group__dt.html#gga51d4c45efee77175aa61574dbc46b53ea3ff5f1672deeb66303f63fc82b49fd11" title="for symbolic link">DFT_SYM</a>,
<a name="l00389"></a>00389 };
<a name="l00390"></a>00390 
<a name="l00394"></a><a class="code" href="structdt__object__format.html">00394</a> <span class="keyword">struct </span><a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> {
<a name="l00396"></a><a class="code" href="structdt__object__format.html#a7522bce1087145d78c749b182e10357c">00396</a>         <span class="keyword">enum</span> <a class="code" href="group__dt.html#ga51d4c45efee77175aa61574dbc46b53e" title="object type specifier.">dt_format_type</a> <a class="code" href="structdt__object__format.html#a7522bce1087145d78c749b182e10357c" title="type for dt object">dof_type</a>;
<a name="l00397"></a>00397         <span class="keyword">union </span>{
<a name="l00398"></a>00398                 <span class="keyword">struct </span>dof_regular {
<a name="l00399"></a>00399                         <span class="keywordtype">int</span> striped;
<a name="l00400"></a>00400                 } dof_reg;
<a name="l00401"></a>00401                 <span class="keyword">struct </span>dof_dir {
<a name="l00402"></a>00402                 } dof_dir;
<a name="l00403"></a>00403                 <span class="keyword">struct </span>dof_node {
<a name="l00404"></a>00404                 } dof_node;
<a name="l00409"></a>00409                 <span class="keyword">struct </span>dof_index {
<a name="l00410"></a>00410                         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> *di_feat;
<a name="l00411"></a>00411                 } <a class="code" href="structdt__object__format.html#a2570277a076882708ae6b6d1419bfa13" title="special index need feature as parameter to create special idx">dof_idx</a>;
<a name="l00412"></a>00412         } u;
<a name="l00413"></a>00413 };
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="keyword">enum</span> <a class="code" href="group__dt.html#ga51d4c45efee77175aa61574dbc46b53e" title="object type specifier.">dt_format_type</a> dt_mode_to_dft(__u32 mode);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="keyword">typedef</span> __u64 dt_obj_version_t;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a>;
<a name="l00420"></a>00420 
<a name="l00425"></a><a class="code" href="structdt__object__operations.html">00425</a> <span class="keyword">struct </span><a class="code" href="structdt__object__operations.html" title="A dt_object provides common operations to create and destroy objects and to manage...">dt_object_operations</a> {
<a name="l00437"></a>00437         void  (*<a class="code" href="structdt__object__operations.html#a32a37f3abca0903ec9fa5c70b2b7a423" title="Get read lock on object.">do_read_lock</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00438"></a>00438                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00439"></a>00439                               <span class="keywordtype">unsigned</span> role);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="comment">/*</span>
<a name="l00442"></a>00442 <span class="comment">         * Get write lock on object.</span>
<a name="l00443"></a>00443 <span class="comment">         *</span>
<a name="l00444"></a>00444 <span class="comment">         * Write lock is exclusive and cannot be shared. The lock is blocking</span>
<a name="l00445"></a>00445 <span class="comment">         * and can&apos;t be used from an interrupt context.</span>
<a name="l00446"></a>00446 <span class="comment">         *</span>
<a name="l00447"></a>00447 <span class="comment">         * \param[in] env       execution environment for this thread</span>
<a name="l00448"></a>00448 <span class="comment">         * \param[in] dt        object to lock for writing</span>
<a name="l00449"></a>00449 <span class="comment">         * \param[in] role      a hint to debug locks (see kernel&apos;s mutexes)</span>
<a name="l00450"></a>00450 <span class="comment">         *</span>
<a name="l00451"></a>00451 <span class="comment">         */</span>
<a name="l00452"></a>00452         void  (*do_write_lock)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00453"></a>00453                                <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00454"></a>00454                                <span class="keywordtype">unsigned</span> role);
<a name="l00455"></a>00455 
<a name="l00462"></a>00462         void  (*<a class="code" href="structdt__object__operations.html#a5d68d191697e7964615a090f9896f7f5" title="Release read lock.">do_read_unlock</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00463"></a>00463                                 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt);
<a name="l00464"></a>00464 
<a name="l00471"></a>00471         void  (*<a class="code" href="structdt__object__operations.html#ad5346269fb80455252849f4fd7403720" title="Release write lock.">do_write_unlock</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00472"></a>00472                                  <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt);
<a name="l00473"></a>00473 
<a name="l00485"></a>00485         int  (*<a class="code" href="structdt__object__operations.html#a9072566fd18a198a7323439603b6fbdf" title="Check whether write lock is held.">do_write_locked</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00486"></a>00486                                 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt);
<a name="l00487"></a>00487 
<a name="l00504"></a>00504         int   (*<a class="code" href="structdt__object__operations.html#adc1fb34feaf57d9448beaab7f04302bd" title="Declare intention to request reqular attributes.">do_declare_attr_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00505"></a>00505                                      <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt);
<a name="l00506"></a>00506 
<a name="l00523"></a>00523         int   (*<a class="code" href="structdt__object__operations.html#a1d2ff17287fa229d0325cccf0aac5beb" title="Return regular attributes.">do_attr_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00524"></a>00524                              <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00525"></a>00525                              <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr);
<a name="l00526"></a>00526 
<a name="l00545"></a>00545         int   (*<a class="code" href="structdt__object__operations.html#a44eb5df458974e0568eba9863c439362" title="Declare intention to change regular object&amp;#39;s attributes.">do_declare_attr_set</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00546"></a>00546                                      <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00547"></a>00547                                      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l00548"></a>00548                                      <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00549"></a>00549 
<a name="l00567"></a>00567         int   (*<a class="code" href="structdt__object__operations.html#aa9a55847088d77aa8bbc16c693344ddb" title="Change regular attributes.">do_attr_set</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00568"></a>00568                              <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00569"></a>00569                              <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l00570"></a>00570                              <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00571"></a>00571 
<a name="l00590"></a>00590         int   (*<a class="code" href="structdt__object__operations.html#a2032c927c95147729dd7a7247c5c12aa" title="Declare intention to request extented attribute.">do_declare_xattr_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00591"></a>00591                                       <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00592"></a>00592                                       <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l00593"></a>00593                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *name);
<a name="l00594"></a>00594 
<a name="l00611"></a>00611         int   (*<a class="code" href="structdt__object__operations.html#af4c8c504e52a5571dbd0557980c3818a" title="Return a value of an extended attribute.">do_xattr_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00612"></a>00612                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00613"></a>00613                               <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l00614"></a>00614                               <span class="keyword">const</span> <span class="keywordtype">char</span> *name);
<a name="l00615"></a>00615 
<a name="l00636"></a>00636         int   (*<a class="code" href="structdt__object__operations.html#ad5d602fce101080720544cbdb0de96e8" title="Declare intention to change an extended attribute.">do_declare_xattr_set</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00637"></a>00637                                       <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00638"></a>00638                                       <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l00639"></a>00639                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00640"></a>00640                                       <span class="keywordtype">int</span> fl,
<a name="l00641"></a>00641                                       <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00642"></a>00642 
<a name="l00663"></a>00663         int   (*<a class="code" href="structdt__object__operations.html#a231db7d512a5786b8ad887e9fc47190b" title="Set an extended attribute.">do_xattr_set</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00664"></a>00664                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00665"></a>00665                               <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l00666"></a>00666                               <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00667"></a>00667                               <span class="keywordtype">int</span> fl,
<a name="l00668"></a>00668                               <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00669"></a>00669 
<a name="l00687"></a>00687         int   (*<a class="code" href="structdt__object__operations.html#a7b2e57f4c0bdb5108e9d1920242e813e" title="Declare intention to delete an extended attribute.">do_declare_xattr_del</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00688"></a>00688                                       <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00689"></a>00689                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00690"></a>00690                                       <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00691"></a>00691 
<a name="l00706"></a>00706         int   (*<a class="code" href="structdt__object__operations.html#a19762fb1d9e75136521019d51759b6ec" title="Delete an extended attribute.">do_xattr_del</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00707"></a>00707                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00708"></a>00708                               <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00709"></a>00709                               <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00710"></a>00710 
<a name="l00725"></a>00725         int   (*<a class="code" href="structdt__object__operations.html#a0ace7a9f2e3ae94bb5d5b7434917f0f1" title="Return a list of the extended attributes.">do_xattr_list</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00726"></a>00726                                <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00727"></a>00727                                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf);
<a name="l00728"></a>00728 
<a name="l00743"></a>00743         void  (*<a class="code" href="structdt__object__operations.html#a00fed99bee94890d3e36719af00d5595" title="Prepare allocation hint for a new object.">do_ah_init</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00744"></a>00744                             <span class="keyword">struct </span><a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> *ah,
<a name="l00745"></a>00745                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *parent,
<a name="l00746"></a>00746                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *child,
<a name="l00747"></a>00747                             umode_t mode);
<a name="l00748"></a>00748 
<a name="l00773"></a>00773         int   (*<a class="code" href="structdt__object__operations.html#ab16b75516dfd3d619fbffbc96f2b9d24" title="Declare intention to create a new object.">do_declare_create</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00774"></a>00774                                    <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00775"></a>00775                                    <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l00776"></a>00776                                    <span class="keyword">struct </span><a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> *hint,
<a name="l00777"></a>00777                                    <span class="keyword">struct </span><a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l00778"></a>00778                                    <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00779"></a>00779 
<a name="l00804"></a>00804         int   (*<a class="code" href="structdt__object__operations.html#ac1ca5a81cd3d00bd821fbfead64022c3" title="Create new object.">do_create</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00805"></a>00805                            <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00806"></a>00806                            <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l00807"></a>00807                            <span class="keyword">struct </span><a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> *hint,
<a name="l00808"></a>00808                            <span class="keyword">struct </span><a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l00809"></a>00809                            <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00810"></a>00810 
<a name="l00827"></a>00827         int   (*<a class="code" href="structdt__object__operations.html#af211c9cc7a0203979cd8cf0f0b81b293" title="Declare intention to destroy an object.">do_declare_destroy</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00828"></a>00828                                     <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00829"></a>00829                                     <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00830"></a>00830 
<a name="l00852"></a>00852         int   (*<a class="code" href="structdt__object__operations.html#a19ddd277003c24371f8c5771a2ba77bb" title="Destroy an object.">do_destroy</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00853"></a>00853                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00854"></a>00854                             <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00855"></a>00855 
<a name="l00873"></a>00873         int   (*<a class="code" href="structdt__object__operations.html#ac317771bd9f0827b4d8fcec4d51a63c2" title="Try object as an index.">do_index_try</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00874"></a>00874                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00875"></a>00875                               <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__features.html">dt_index_features</a> *feat);
<a name="l00876"></a>00876 
<a name="l00893"></a>00893         int   (*<a class="code" href="structdt__object__operations.html#a53431a1038b787ca15950b5a0495408b" title="Declare intention to increment nlink count.">do_declare_ref_add</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00894"></a>00894                                     <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00895"></a>00895                                     <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00896"></a>00896 
<a name="l00911"></a>00911         int   (*<a class="code" href="structdt__object__operations.html#a3ea43d6a7abb742fb238acc711b3bd2b" title="Increment nlink.">do_ref_add</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00912"></a>00912                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00913"></a>00913 
<a name="l00930"></a>00930         int   (*<a class="code" href="structdt__object__operations.html#ae33177c8da269d507a9b22b8066ae5f4" title="Declare intention to decrement nlink count.">do_declare_ref_del</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00931"></a>00931                                     <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00932"></a>00932                                     <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00933"></a>00933 
<a name="l00947"></a>00947         int   (*<a class="code" href="structdt__object__operations.html#a8d0abf79c5dace1f0839aefe251bfc1f" title="Decrement nlink.">do_ref_del</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00948"></a>00948                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00949"></a>00949                             <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l00950"></a>00950 
<a name="l00972"></a>00972         int (*<a class="code" href="structdt__object__operations.html#a2e3f3539d6ce344b27712d4b2f39d7b2" title="Sync obect.">do_object_sync</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l00973"></a>00973                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *obj,
<a name="l00974"></a>00974                               __u64 start,
<a name="l00975"></a>00975                               __u64 end);
<a name="l00976"></a>00976 
<a name="l00996"></a>00996         int (*<a class="code" href="structdt__object__operations.html#a1f63b46e6b64b5c8ba9e81492e0c2f19" title="Lock object.">do_object_lock</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l00997"></a>00997                               <span class="keyword">struct </span><a class="code" href="structlustre__handle.html">lustre_handle</a> *lh,
<a name="l00998"></a>00998                               <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *einfo,
<a name="l00999"></a>00999                               <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy);
<a name="l01000"></a>01000 
<a name="l01014"></a>01014         int (*<a class="code" href="structdt__object__operations.html#a0cc597f75bd319af28376e8a280a6ae3" title="Unlock object.">do_object_unlock</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01015"></a>01015                                 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01016"></a>01016                                 <span class="keyword">struct </span><a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *einfo,
<a name="l01017"></a>01017                                 <span class="keyword">union </span><a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy);
<a name="l01018"></a>01018 };
<a name="l01019"></a>01019 
<a name="l01023"></a><a class="code" href="structdt__body__operations.html">01023</a> <span class="keyword">struct </span><a class="code" href="structdt__body__operations.html" title="Per-dt-object operations on &amp;quot;file body&amp;quot; - unstructure raw data.">dt_body_operations</a> {
<a name="l01039"></a>01039         ssize_t (*<a class="code" href="structdt__body__operations.html#a6d7a363128fd4899b709b2ff18afd54c" title="Read data.">dbo_read</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01040"></a>01040                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01041"></a>01041                             <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l01042"></a>01042                             loff_t *pos);
<a name="l01043"></a>01043 
<a name="l01066"></a>01066         ssize_t (*<a class="code" href="structdt__body__operations.html#aa4d64d407e2b442c1e418fa9ca46ab44" title="Declare intention to write data to object.">dbo_declare_write</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01067"></a>01067                                      <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01068"></a>01068                                      <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l01069"></a>01069                                      loff_t pos,
<a name="l01070"></a>01070                                      <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01071"></a>01071 
<a name="l01093"></a>01093         ssize_t (*<a class="code" href="structdt__body__operations.html#a1d14bb3445892ab680cd8885645334bb" title="Write unstructured data to regular existing object.">dbo_write</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01094"></a>01094                              <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01095"></a>01095                              <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l01096"></a>01096                              loff_t *pos,
<a name="l01097"></a>01097                              <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l01098"></a>01098                              <span class="keywordtype">int</span> ignore);
<a name="l01099"></a>01099 
<a name="l01132"></a>01132         int (*<a class="code" href="structdt__body__operations.html#afe9f070ccbf102ca7d366a0d902216a7" title="Return buffers for data.">dbo_bufs_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01133"></a>01133                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01134"></a>01134                             loff_t pos,
<a name="l01135"></a>01135                             ssize_t len,
<a name="l01136"></a>01136                             <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lb,
<a name="l01137"></a>01137                             <span class="keywordtype">int</span> rw);
<a name="l01138"></a>01138 
<a name="l01153"></a>01153         int (*<a class="code" href="structdt__body__operations.html#aaa0f2da7b7271a358b9c1e3bfa4326e3" title="Release reference granted by -&amp;gt;dbo_bufs_get().">dbo_bufs_put</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01154"></a>01154                             <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01155"></a>01155                             <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lb,
<a name="l01156"></a>01156                             <span class="keywordtype">int</span> nr);
<a name="l01157"></a>01157 
<a name="l01178"></a>01178         int (*<a class="code" href="structdt__body__operations.html#a064a13169a793907c32faa01a657810a" title="Prepare buffers for reading.">dbo_read_prep</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01179"></a>01179                              <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01180"></a>01180                              <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb,
<a name="l01181"></a>01181                              <span class="keywordtype">int</span> nr);
<a name="l01182"></a>01182 
<a name="l01198"></a>01198         int (*<a class="code" href="structdt__body__operations.html#ab941af8487086f964f8721de634b86b8" title="Prepare buffers for write.">dbo_write_prep</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01199"></a>01199                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01200"></a>01200                               <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lb,
<a name="l01201"></a>01201                               <span class="keywordtype">int</span> nr);
<a name="l01202"></a>01202 
<a name="l01226"></a>01226         int (*<a class="code" href="structdt__body__operations.html#aaa2ba33b84fa7bdb6413e6f8347a1482" title="Declare intention to write data stored in the buffers.">dbo_declare_write_commit</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01227"></a>01227                                         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01228"></a>01228                                         <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lb,
<a name="l01229"></a>01229                                         <span class="keywordtype">int</span> nr,
<a name="l01230"></a>01230                                         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01231"></a>01231 
<a name="l01255"></a>01255         int (*<a class="code" href="structdt__body__operations.html#ac44e84fe7124d965c379a6817e4dc8bc" title="Write to existing object.">dbo_write_commit</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01256"></a>01256                                 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01257"></a>01257                                 <span class="keyword">struct </span><a class="code" href="structniobuf__local.html">niobuf_local</a> *lb,
<a name="l01258"></a>01258                                 <span class="keywordtype">int</span> nr,
<a name="l01259"></a>01259                                 <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01260"></a>01260 
<a name="l01272"></a>01272         int (*<a class="code" href="structdt__body__operations.html#afde6790a70f30800664044f1c627cb63" title="Return logical to physical block mapping for a given extent.">dbo_fiemap_get</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01273"></a>01273                               <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01274"></a>01274                               <span class="keyword">struct </span>fiemap *fm);
<a name="l01275"></a>01275 
<a name="l01293"></a>01293         int   (*<a class="code" href="structdt__body__operations.html#a814e0570b29ea97a47f9851e0f6bfc0c" title="Declare intention to deallocate space from an object.">dbo_declare_punch</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01294"></a>01294                                    <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01295"></a>01295                                    __u64 start,
<a name="l01296"></a>01296                                    __u64 end,
<a name="l01297"></a>01297                                    <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01298"></a>01298 
<a name="l01316"></a>01316         int   (*<a class="code" href="structdt__body__operations.html#a3ee6232f042892134c6f2fead05ed2c4" title="Deallocate specified region in an object.">dbo_punch</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01317"></a>01317                            <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01318"></a>01318                            __u64 start,
<a name="l01319"></a>01319                            __u64 end,
<a name="l01320"></a>01320                            <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01337"></a>01337         int   (*<a class="code" href="structdt__body__operations.html#a5b1cd9fc446d73843de8c4e57475765e" title="Give advices on specified region in an object.">dbo_ladvise</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01338"></a>01338                              <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01339"></a>01339                              __u64 start,
<a name="l01340"></a>01340                              __u64 end,
<a name="l01341"></a>01341                              <span class="keyword">enum</span> lu_ladvise_type advice);
<a name="l01342"></a>01342 };
<a name="l01343"></a>01343 
<a name="l01347"></a>01347 <span class="keyword">struct </span>dt_rec;
<a name="l01348"></a>01348 
<a name="l01352"></a>01352 <span class="keyword">struct </span>dt_key;
<a name="l01353"></a>01353 
<a name="l01357"></a>01357 <span class="keyword">struct </span>dt_it;
<a name="l01358"></a>01358 
<a name="l01366"></a><a class="code" href="structdt__index__operations.html">01366</a> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a> {
<a name="l01387"></a>01387         int (*<a class="code" href="structdt__index__operations.html#aab6a7632adfce2297c022b12f0d61791" title="Lookup in an index by key.">dio_lookup</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01388"></a>01388                           <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01389"></a>01389                           <span class="keyword">struct </span>dt_rec *rec,
<a name="l01390"></a>01390                           <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *key);
<a name="l01391"></a>01391 
<a name="l01410"></a>01410         int (*<a class="code" href="structdt__index__operations.html#af077ea7c9f156cb161f9c361109e1f68" title="Declare intention to insert a key/value into an index.">dio_declare_insert</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01411"></a>01411                                   <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01412"></a>01412                                   <span class="keyword">const</span> <span class="keyword">struct </span>dt_rec *rec,
<a name="l01413"></a>01413                                   <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *key,
<a name="l01414"></a>01414                                   <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01415"></a>01415 
<a name="l01436"></a>01436         int (*<a class="code" href="structdt__index__operations.html#af1e0507f0ca4df0ed3f486bab027dbda" title="Insert a new key/value pair into an index.">dio_insert</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01437"></a>01437                           <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01438"></a>01438                           <span class="keyword">const</span> <span class="keyword">struct </span>dt_rec *rec,
<a name="l01439"></a>01439                           <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *key,
<a name="l01440"></a>01440                           <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l01441"></a>01441                           <span class="keywordtype">int</span> ignore);
<a name="l01442"></a>01442 
<a name="l01460"></a>01460         int (*<a class="code" href="structdt__index__operations.html#aa25f7e5f60a5b9055e3f9b0898b2888b" title="Declare intention to delete a key/value from an index.">dio_declare_delete</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01461"></a>01461                                   <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01462"></a>01462                                   <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *key,
<a name="l01463"></a>01463                                   <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01464"></a>01464 
<a name="l01482"></a>01482         int (*<a class="code" href="structdt__index__operations.html#abe3c3c85ed6a910700306482ba8fcd0d" title="Delete key/value pair from an index.">dio_delete</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01483"></a>01483                           <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01484"></a>01484                           <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *key,
<a name="l01485"></a>01485                           <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01486"></a>01486 
<a name="l01493"></a><a class="code" href="structdt__index__operations_1_1dt__it__ops.html">01493</a>         <span class="keyword">struct </span><a class="code" href="structdt__index__operations_1_1dt__it__ops.html" title="Iterator interface.">dt_it_ops</a> {
<a name="l01510"></a>01510                 <span class="keyword">struct </span>dt_it *(*init)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01511"></a>01511                                       <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l01512"></a>01512                                       __u32 attr);
<a name="l01513"></a>01513 
<a name="l01523"></a>01523                 void          (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a9bde98040f4ba4fd69f69aa73c606cdd" title="Release iterator.">fini</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01524"></a>01524                                       <span class="keyword">struct </span>dt_it *di);
<a name="l01525"></a>01525 
<a name="l01541"></a>01541                 int            (*<span class="keyword">get</span>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01542"></a>01542                                       <span class="keyword">struct </span>dt_it *di,
<a name="l01543"></a>01543                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_key *<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a426dff3fc53f2cfed2fe22713d990ddc" title="Return key.">key</a>);
<a name="l01544"></a>01544 
<a name="l01556"></a>01556                 void           (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a0a49bc42af0733f3a82dd0e8c6cbe1e5" title="Release position.">put</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01557"></a>01557                                       <span class="keyword">struct </span>dt_it *di);
<a name="l01558"></a>01558 
<a name="l01571"></a>01571                 int           (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#aa41e28336a93af94d1c5e629d9394631" title="Move to next record.">next</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01572"></a>01572                                       <span class="keyword">struct </span>dt_it *di);
<a name="l01573"></a>01573 
<a name="l01588"></a>01588                 <span class="keyword">struct </span>dt_key *(*key)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01589"></a>01589                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di);
<a name="l01590"></a>01590 
<a name="l01602"></a>01602                 int       (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a0e2180d888668bf163ebf81fd27dc857" title="Return key size.">key_size</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01603"></a>01603                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di);
<a name="l01604"></a>01604 
<a name="l01622"></a>01622                 int            (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a1b24018fcd837461771bb59a4d0c0d05" title="Return record.">rec</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01623"></a>01623                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di,
<a name="l01624"></a>01624                                       <span class="keyword">struct </span>dt_rec *<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a1b24018fcd837461771bb59a4d0c0d05" title="Return record.">rec</a>,
<a name="l01625"></a>01625                                       __u32 attr);
<a name="l01626"></a>01626 
<a name="l01642"></a>01642                 int        (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a5a85dfb5e79d606a1abba1c1fd9986cc" title="Return record size.">rec_size</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01643"></a>01643                                        <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di,
<a name="l01644"></a>01644                                       __u32 attr);
<a name="l01645"></a>01645 
<a name="l01659"></a>01659                 __u64        (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a2966e2ef5ccc21df92b6a31b7c4a56f5" title="Return a cookie (hash).">store</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01660"></a>01660                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di);
<a name="l01661"></a>01661 
<a name="l01679"></a>01679                 int           (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a3ca6f6284e09ac4853574a011d4bd649" title="Initialize position using cookie/hash.">load</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01680"></a>01680                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di,
<a name="l01681"></a>01681                                       __u64 hash);
<a name="l01682"></a>01682 
<a name="l01686"></a>01686                 int        (*<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a26fde1d3c4f5e818827e667418f6f4ba" title="Not used.">key_rec</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01687"></a>01687                                       <span class="keyword">const</span> <span class="keyword">struct </span>dt_it *di,
<a name="l01688"></a>01688                                       <span class="keywordtype">void</span> *<a class="code" href="structdt__index__operations_1_1dt__it__ops.html#a26fde1d3c4f5e818827e667418f6f4ba" title="Not used.">key_rec</a>);
<a name="l01689"></a>01689         } <a class="code" href="structdt__index__operations.html#a16b19879e71b5cb1aaa459d731d580cb" title="Iterator interface.">dio_it</a>;
<a name="l01690"></a>01690 };
<a name="l01691"></a>01691 
<a name="l01692"></a>01692 <span class="keyword">enum</span> dt_otable_it_valid {
<a name="l01693"></a>01693         DOIV_ERROR_HANDLE       = 0x0001,
<a name="l01694"></a>01694         DOIV_DRYRUN             = 0x0002,
<a name="l01695"></a>01695 };
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="keyword">enum</span> dt_otable_it_flags {
<a name="l01698"></a>01698         <span class="comment">/* Exit when fail. */</span>
<a name="l01699"></a>01699         DOIF_FAILOUT    = 0x0001,
<a name="l01700"></a>01700 
<a name="l01701"></a>01701         <span class="comment">/* Reset iteration position to the device beginning. */</span>
<a name="l01702"></a>01702         DOIF_RESET      = 0x0002,
<a name="l01703"></a>01703 
<a name="l01704"></a>01704         <span class="comment">/* There is up layer component uses the iteration. */</span>
<a name="l01705"></a>01705         DOIF_OUTUSED    = 0x0004,
<a name="l01706"></a>01706 
<a name="l01707"></a>01707         <span class="comment">/* Check only without repairing. */</span>
<a name="l01708"></a>01708         DOIF_DRYRUN     = 0x0008,
<a name="l01709"></a>01709 };
<a name="l01710"></a>01710 
<a name="l01711"></a>01711 <span class="comment">/* otable based iteration needs to use the common DT iteration APIs.</span>
<a name="l01712"></a>01712 <span class="comment"> * To initialize the iteration, it needs call dio_it::init() firstly.</span>
<a name="l01713"></a>01713 <span class="comment"> * Here is how the otable based iteration should prepare arguments to</span>
<a name="l01714"></a>01714 <span class="comment"> * call dt_it_ops::init().</span>
<a name="l01715"></a>01715 <span class="comment"> *</span>
<a name="l01716"></a>01716 <span class="comment"> * For otable based iteration, the 32-bits &apos;attr&apos; for dt_it_ops::init()</span>
<a name="l01717"></a>01717 <span class="comment"> * is composed of two parts:</span>
<a name="l01718"></a>01718 <span class="comment"> * low 16-bits is for valid bits, high 16-bits is for flags bits. */</span>
<a name="l01719"></a>01719 <span class="preprocessor">#define DT_OTABLE_IT_FLAGS_SHIFT        16</span>
<a name="l01720"></a>01720 <span class="preprocessor"></span><span class="preprocessor">#define DT_OTABLE_IT_FLAGS_MASK         0xffff0000</span>
<a name="l01721"></a>01721 <span class="preprocessor"></span>
<a name="l01722"></a><a class="code" href="structdt__device.html">01722</a> <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> {
<a name="l01723"></a>01723         <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a>                   dd_lu_dev;
<a name="l01724"></a>01724         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__device__operations.html" title="Operations on dt device.">dt_device_operations</a> *dd_ops;
<a name="l01725"></a>01725 
<a name="l01731"></a><a class="code" href="structdt__device.html#a9a61196891613c643168283b37371893">01731</a>         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>                   <a class="code" href="structdt__device.html#a9a61196891613c643168283b37371893" title="List of dt_txn_callback (see below).">dd_txn_callbacks</a>;
<a name="l01732"></a>01732         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>                       dd_record_fid_accessed:1;
<a name="l01733"></a>01733 };
<a name="l01734"></a>01734 
<a name="l01735"></a>01735 <span class="keywordtype">int</span>  dt_device_init(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev, <span class="keyword">struct</span> <a class="code" href="structlu__device__type.html" title="Type of device.">lu_device_type</a> *t);
<a name="l01736"></a>01736 <span class="keywordtype">void</span> dt_device_fini(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev);
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> lu_device_is_dt(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d)
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740         <span class="keywordflow">return</span> ergo(d != NULL, d-&gt;<a class="code" href="structlu__device.html#ad5886c6b5e9a91f07f22d33bbcdb5718" title="Pointer to device type.">ld_type</a>-&gt;<a class="code" href="structlu__device__type.html#a80155fcf424540e70733a04e2a099c0c" title="Tag bits.">ldt_tags</a> &amp; <a class="code" href="group__lu.html#ggaa318f5b20c40de1d564f59dd72726345a5b8da75da353b465f5ddc30d87c931d9" title="this is data device">LU_DEVICE_DT</a>);
<a name="l01741"></a>01741 }
<a name="l01742"></a>01742 
<a name="l01743"></a>01743 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> * lu2dt_dev(<span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *l)
<a name="l01744"></a>01744 {
<a name="l01745"></a>01745         LASSERT(lu_device_is_dt(l));
<a name="l01746"></a>01746         <span class="keywordflow">return</span> container_of0(l, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a>, dd_lu_dev);
<a name="l01747"></a>01747 }
<a name="l01748"></a>01748 
<a name="l01749"></a><a class="code" href="structdt__object.html">01749</a> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> {
<a name="l01750"></a>01750         <span class="keyword">struct </span><a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a>                   do_lu;
<a name="l01751"></a>01751         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__object__operations.html" title="A dt_object provides common operations to create and destroy objects and to manage...">dt_object_operations</a> *do_ops;
<a name="l01752"></a>01752         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__body__operations.html" title="Per-dt-object operations on &amp;quot;file body&amp;quot; - unstructure raw data.">dt_body_operations</a>   *do_body_ops;
<a name="l01753"></a>01753         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structdt__index__operations.html" title="Per-dt-object operations on object as index.">dt_index_operations</a>  *do_index_ops;
<a name="l01754"></a>01754 };
<a name="l01755"></a>01755 
<a name="l01756"></a>01756 <span class="comment">/*</span>
<a name="l01757"></a>01757 <span class="comment"> * In-core representation of per-device local object OID storage</span>
<a name="l01758"></a>01758 <span class="comment"> */</span>
<a name="l01759"></a><a class="code" href="structlocal__oid__storage.html">01759</a> <span class="keyword">struct </span><a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> {
<a name="l01760"></a>01760         <span class="comment">/* all initialized llog systems on this node linked by this */</span>
<a name="l01761"></a>01761         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>  los_list;
<a name="l01762"></a>01762 
<a name="l01763"></a>01763         <span class="comment">/* how many handle&apos;s reference this los has */</span>
<a name="l01764"></a>01764         atomic_t          los_refcount;
<a name="l01765"></a>01765         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *los_dev;
<a name="l01766"></a>01766         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *los_obj;
<a name="l01767"></a>01767 
<a name="l01768"></a>01768         <span class="comment">/* data used to generate new fids */</span>
<a name="l01769"></a>01769         <span class="keyword">struct </span>mutex      los_id_lock;
<a name="l01770"></a>01770         __u64             los_seq;
<a name="l01771"></a>01771         __u32             los_last_oid;
<a name="l01772"></a>01772 };
<a name="l01773"></a>01773 
<a name="l01774"></a>01774 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *dt2lu_dev(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d)
<a name="l01775"></a>01775 {
<a name="l01776"></a>01776         <span class="keywordflow">return</span> &amp;d-&gt;dd_lu_dev;
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01779"></a>01779 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *lu2dt(<span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *l)
<a name="l01780"></a>01780 {
<a name="l01781"></a>01781         LASSERT(l == NULL || IS_ERR(l) || lu_device_is_dt(l-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>));
<a name="l01782"></a>01782         <span class="keywordflow">return</span> container_of0(l, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a>, do_lu);
<a name="l01783"></a>01783 }
<a name="l01784"></a>01784 
<a name="l01785"></a>01785 <span class="keywordtype">int</span>  dt_object_init(<span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *obj,
<a name="l01786"></a>01786                     <span class="keyword">struct</span> <a class="code" href="structlu__object__header.html" title="&amp;quot;Compound&amp;quot; object, consisting of multiple layers.">lu_object_header</a> *h, <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *d);
<a name="l01787"></a>01787 
<a name="l01788"></a>01788 <span class="keywordtype">void</span> dt_object_fini(<span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *obj);
<a name="l01789"></a>01789 
<a name="l01790"></a>01790 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_object_exists(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l01791"></a>01791 {
<a name="l01792"></a>01792         <span class="keywordflow">return</span> <a class="code" href="group__lu.html#gacef4aec6c28892e386a8d3cca26aeb28" title="Check whether object exists, no matter on local or remote storage.">lu_object_exists</a>(&amp;dt-&gt;do_lu);
<a name="l01793"></a>01793 }
<a name="l01794"></a>01794 
<a name="l01795"></a>01795 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_object_remote(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l01796"></a>01796 {
<a name="l01797"></a>01797         <span class="keywordflow">return</span> <a class="code" href="group__lu.html#ga3f1244491405504cc9adcc3b6ce78a91" title="Check whether object on the remote storage.">lu_object_remote</a>(&amp;dt-&gt;do_lu);
<a name="l01798"></a>01798 }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *lu2dt_obj(<span class="keyword">struct</span> <a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *o)
<a name="l01801"></a>01801 {
<a name="l01802"></a>01802         LASSERT(ergo(o != NULL, lu_device_is_dt(o-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>)));
<a name="l01803"></a>01803         <span class="keywordflow">return</span> container_of0(o, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a>, do_lu);
<a name="l01804"></a>01804 }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt_object_child(<span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o)
<a name="l01807"></a>01807 {
<a name="l01808"></a>01808         <span class="keywordflow">return</span> container_of0(lu_object_next(&amp;(o)-&gt;do_lu),
<a name="l01809"></a>01809                              <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a>, do_lu);
<a name="l01810"></a>01810 }
<a name="l01811"></a>01811 
<a name="l01826"></a><a class="code" href="structthandle.html">01826</a> <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> {
<a name="l01828"></a><a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6">01828</a>         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a> *<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>;
<a name="l01829"></a>01829 
<a name="l01830"></a>01830         <span class="comment">/* point to the top thandle, XXX this is a bit hacky right now,</span>
<a name="l01831"></a>01831 <span class="comment">         * but normal device trans callback triggered by the bottom</span>
<a name="l01832"></a>01832 <span class="comment">         * device (OSP/OSD == sub thandle layer) needs to get the</span>
<a name="l01833"></a>01833 <span class="comment">         * top_thandle (see dt_txn_hook_start/stop()), so we put the</span>
<a name="l01834"></a>01834 <span class="comment">         * top thandle here for now, will fix it when we have better</span>
<a name="l01835"></a>01835 <span class="comment">         * callback mechanism */</span>
<a name="l01836"></a>01836         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a>  *th_top;
<a name="l01838"></a><a class="code" href="structthandle.html#af5b62e871bd953fa67e6f943a038e4eb">01838</a>         <span class="keyword">struct </span><a class="code" href="structlu__context.html" title="lu_context.">lu_context</a> <a class="code" href="structthandle.html#af5b62e871bd953fa67e6f943a038e4eb" title="context for this transaction, tag is LCT_TX_HANDLE">th_ctx</a>;
<a name="l01839"></a>01839 
<a name="l01841"></a><a class="code" href="structthandle.html#a63d4ca7d24cf228d73ec7770d7cea6b0">01841</a>         __u32             <a class="code" href="structthandle.html#a63d4ca7d24cf228d73ec7770d7cea6b0" title="additional tags (layers can add in declare)">th_tags</a>;
<a name="l01842"></a>01842 
<a name="l01845"></a><a class="code" href="structthandle.html#a768f192711e7d5c5280da153173cb463">01845</a>         __s32             <a class="code" href="structthandle.html#a768f192711e7d5c5280da153173cb463" title="the last operation result in this transaction.">th_result</a>;
<a name="l01846"></a>01846 
<a name="l01848"></a><a class="code" href="structthandle.html#a4ebd1192a1e6fd4868826aee3ad1ec05">01848</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>            <a class="code" href="structthandle.html#a4ebd1192a1e6fd4868826aee3ad1ec05" title="whether we need sync commit">th_sync</a>:1,
<a name="l01849"></a>01849         <span class="comment">/* local transation, no need to inform other layers */</span>
<a name="l01850"></a>01850                                 th_local:1,
<a name="l01851"></a>01851         <span class="comment">/* Whether we need wait the transaction to be submitted */</span>
<a name="l01852"></a>01852                                 th_wait_submit:1,
<a name="l01853"></a>01853         <span class="comment">/* complex transaction which will track updates on all targets */</span>
<a name="l01854"></a>01854                                 th_complex:1;
<a name="l01855"></a>01855 };
<a name="l01856"></a>01856 
<a name="l01868"></a><a class="code" href="structdt__txn__callback.html">01868</a> <span class="keyword">struct </span><a class="code" href="structdt__txn__callback.html" title="Transaction call-backs.">dt_txn_callback</a> {
<a name="l01869"></a>01869         int (*dtc_txn_start)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01870"></a>01870                              <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn, <span class="keywordtype">void</span> *cookie);
<a name="l01871"></a>01871         int (*dtc_txn_stop)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01872"></a>01872                             <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn, <span class="keywordtype">void</span> *cookie);
<a name="l01873"></a>01873         void (*dtc_txn_commit)(<span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn, <span class="keywordtype">void</span> *cookie);
<a name="l01874"></a>01874         <span class="keywordtype">void</span>                    *dtc_cookie;
<a name="l01875"></a>01875         __u32                   dtc_tag;
<a name="l01876"></a>01876         <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a>        dtc_linkage;
<a name="l01877"></a>01877 };
<a name="l01878"></a>01878 
<a name="l01879"></a>01879 <span class="keywordtype">void</span> dt_txn_callback_add(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev, <span class="keyword">struct</span> <a class="code" href="structdt__txn__callback.html" title="Transaction call-backs.">dt_txn_callback</a> *cb);
<a name="l01880"></a>01880 <span class="keywordtype">void</span> dt_txn_callback_del(<span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev, <span class="keyword">struct</span> <a class="code" href="structdt__txn__callback.html" title="Transaction call-backs.">dt_txn_callback</a> *cb);
<a name="l01881"></a>01881 
<a name="l01882"></a>01882 <span class="keywordtype">int</span> dt_txn_hook_start(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01883"></a>01883                       <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn);
<a name="l01884"></a>01884 <span class="keywordtype">int</span> dt_txn_hook_stop(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn);
<a name="l01885"></a>01885 <span class="keywordtype">void</span> dt_txn_hook_commit(<span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *txn);
<a name="l01886"></a>01886 
<a name="l01887"></a>01887 <span class="keywordtype">int</span> dt_try_as_dir(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *obj);
<a name="l01888"></a>01888 
<a name="l01893"></a><a class="code" href="group__dt.html#gaac0ca3702789825e928e3b059d727679">01893</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__dt.html#gaac0ca3702789825e928e3b059d727679" title="Callback function used for parsing path.">dt_entry_func_t</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01894"></a>01894                             <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l01895"></a>01895                             <span class="keywordtype">void</span> *pvt);
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 <span class="preprocessor">#define DT_MAX_PATH 1024</span>
<a name="l01898"></a>01898 <span class="preprocessor"></span>
<a name="l01899"></a>01899 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#gae3f4b97c61841d149a6fa3a10d824494" title="Abstract function which parses path name.">dt_path_parser</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01900"></a>01900                    <span class="keywordtype">char</span> *local, <a class="code" href="group__dt.html#gaac0ca3702789825e928e3b059d727679" title="Callback function used for parsing path.">dt_entry_func_t</a> entry_func,
<a name="l01901"></a>01901                    <span class="keywordtype">void</span> *data);
<a name="l01902"></a>01902 
<a name="l01903"></a>01903 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *
<a name="l01904"></a>01904 dt_store_resolve(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01905"></a>01905                  <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l01906"></a>01906 
<a name="l01907"></a>01907 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *<a class="code" href="group__dt.html#ga589d233b6276fc177086429e37221e36" title="Open dt object named filename from dirname directory.">dt_store_open</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01908"></a>01908                                 <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01909"></a>01909                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *dirname,
<a name="l01910"></a>01910                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *filename,
<a name="l01911"></a>01911                                 <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l01912"></a>01912 
<a name="l01913"></a>01913 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt_find_or_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01914"></a>01914                                     <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01915"></a>01915                                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l01916"></a>01916                                     <span class="keyword">struct</span> <a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l01917"></a>01917                                     <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr);
<a name="l01918"></a>01918 
<a name="l01919"></a>01919 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *dt_locate_at(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01920"></a>01920                                <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l01921"></a>01921                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l01922"></a>01922                                <span class="keyword">struct</span> <a class="code" href="structlu__device.html" title="Device: a layer in the server side abstraction stacking.">lu_device</a> *top_dev,
<a name="l01923"></a>01923                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__object__conf.html" title="Object configuration, describing particulars of object being created.">lu_object_conf</a> *conf);
<a name="l01924"></a>01924 
<a name="l01925"></a>01925 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *
<a name="l01926"></a>01926 dt_locate(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l01927"></a>01927           <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid)
<a name="l01928"></a>01928 {
<a name="l01929"></a>01929         <span class="keywordflow">return</span> dt_locate_at(env, dev, fid,
<a name="l01930"></a>01930                             dev-&gt;dd_lu_dev.<a class="code" href="structlu__device.html#aaa1ef1e1a330f307a9baf6e59fc9c39b" title="Stack this device belongs to.">ld_site</a>-&gt;<a class="code" href="structlu__site.html#a371ff1de170feccd1c80e3d7a0202965" title="Top-level device for this stack.">ls_top_dev</a>, NULL);
<a name="l01931"></a>01931 }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *
<a name="l01934"></a>01934 dt_object_locate(<span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dto, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt_dev)
<a name="l01935"></a>01935 {
<a name="l01936"></a>01936         <span class="keyword">struct </span><a class="code" href="structlu__object.html" title="Layer in the layered object.">lu_object</a> *lo;
<a name="l01937"></a>01937 
<a name="l01938"></a>01938         list_for_each_entry(lo, &amp;dto-&gt;do_lu.<a class="code" href="structlu__object.html#ab55ad0889ad4d306d0a5aad7ed0aa398" title="Header for this object.">lo_header</a>-&gt;<a class="code" href="structlu__object__header.html#a1a4f1dbeb2aadfe34d9d11ed0ede12ec" title="Linkage into list of layers.">loh_layers</a>, <a class="code" href="structlu__object.html#a40275d310eb13538f41291f1cf7cba77" title="Linkage into list of all layers.">lo_linkage</a>) {
<a name="l01939"></a>01939                 <span class="keywordflow">if</span> (lo-&gt;<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a> == &amp;dt_dev-&gt;dd_lu_dev)
<a name="l01940"></a>01940                         <span class="keywordflow">return</span> container_of(lo, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a>, do_lu);
<a name="l01941"></a>01941         }
<a name="l01942"></a>01942         <span class="keywordflow">return</span> NULL;
<a name="l01943"></a>01943 }
<a name="l01944"></a>01944 
<a name="l01945"></a>01945 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#gacddd08c8c9a92143811432373ca8a057" title="Initialize local OID storage for required sequence.">local_oid_storage_init</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l01946"></a>01946                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *first_fid,
<a name="l01947"></a>01947                            <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> **los);
<a name="l01948"></a>01948 <span class="keywordtype">void</span> local_oid_storage_fini(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01949"></a>01949                             <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los);
<a name="l01950"></a>01950 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#gaecff6d908b2936e4f9c804611204f98f" title="local file fid generation">local_object_fid_generate</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01951"></a>01951                               <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los,
<a name="l01952"></a>01952                               <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l01953"></a>01953 <span class="keywordtype">int</span> local_object_declare_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01954"></a>01954                                 <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los,
<a name="l01955"></a>01955                                 <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l01956"></a>01956                                 <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l01957"></a>01957                                 <span class="keyword">struct</span> <a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l01958"></a>01958                                 <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01959"></a>01959 <span class="keywordtype">int</span> local_object_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01960"></a>01960                         <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los,
<a name="l01961"></a>01961                         <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l01962"></a>01962                         <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr, <span class="keyword">struct</span> <a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l01963"></a>01963                         <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l01964"></a>01964 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *local_file_find_or_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01965"></a>01965                                             <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los,
<a name="l01966"></a>01966                                             <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *parent,
<a name="l01967"></a>01967                                             <span class="keyword">const</span> <span class="keywordtype">char</span> *name, __u32 mode);
<a name="l01968"></a>01968 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *local_file_find_or_create_with_fid(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01969"></a>01969                                                      <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01970"></a>01970                                                      <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l01971"></a>01971                                                      <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *parent,
<a name="l01972"></a>01972                                                      <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l01973"></a>01973                                                      __u32 mode);
<a name="l01974"></a>01974 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *
<a name="l01975"></a>01975 local_index_find_or_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01976"></a>01976                            <span class="keyword">struct</span> <a class="code" href="structlocal__oid__storage.html">local_oid_storage</a> *los,
<a name="l01977"></a>01977                            <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *parent,
<a name="l01978"></a>01978                            <span class="keyword">const</span> <span class="keywordtype">char</span> *name, __u32 mode,
<a name="l01979"></a>01979                            <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__index__features.html">dt_index_features</a> *ft);
<a name="l01980"></a>01980 <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a> *
<a name="l01981"></a>01981 local_index_find_or_create_with_fid(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01982"></a>01982                                     <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01983"></a>01983                                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid,
<a name="l01984"></a>01984                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *parent,
<a name="l01985"></a>01985                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *name, __u32 mode,
<a name="l01986"></a>01986                                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__index__features.html">dt_index_features</a> *ft);
<a name="l01987"></a>01987 <span class="keywordtype">int</span> local_object_unlink(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dt,
<a name="l01988"></a>01988                         <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_object_lock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l01991"></a>01991                                  <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o, <span class="keyword">struct</span> <a class="code" href="structlustre__handle.html">lustre_handle</a> *lh,
<a name="l01992"></a>01992                                  <span class="keyword">struct</span> <a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *einfo,
<a name="l01993"></a>01993                                  <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy)
<a name="l01994"></a>01994 {
<a name="l01995"></a>01995         LASSERT(o != NULL);
<a name="l01996"></a>01996         LASSERT(o-&gt;do_ops != NULL);
<a name="l01997"></a>01997         LASSERT(o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a1f63b46e6b64b5c8ba9e81492e0c2f19" title="Lock object.">do_object_lock</a> != NULL);
<a name="l01998"></a>01998         <span class="keywordflow">return</span> o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a1f63b46e6b64b5c8ba9e81492e0c2f19" title="Lock object.">do_object_lock</a>(env, o, lh, einfo, policy);
<a name="l01999"></a>01999 }
<a name="l02000"></a>02000 
<a name="l02001"></a>02001 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_object_unlock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02002"></a>02002                                    <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l02003"></a>02003                                    <span class="keyword">struct</span> <a class="code" href="structldlm__enqueue__info.html" title="Common ldlm_enqueue parameters.">ldlm_enqueue_info</a> *einfo,
<a name="l02004"></a>02004                                    <span class="keyword">union</span> <a class="code" href="unionldlm__policy__data.html">ldlm_policy_data</a> *policy)
<a name="l02005"></a>02005 {
<a name="l02006"></a>02006         LASSERT(o != NULL);
<a name="l02007"></a>02007         LASSERT(o-&gt;do_ops != NULL);
<a name="l02008"></a>02008         LASSERT(o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a0cc597f75bd319af28376e8a280a6ae3" title="Unlock object.">do_object_unlock</a> != NULL);
<a name="l02009"></a>02009         <span class="keywordflow">return</span> o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a0cc597f75bd319af28376e8a280a6ae3" title="Unlock object.">do_object_unlock</a>(env, o, einfo, policy);
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#ga4c9bbe53e3209cc074409cbfdcb84ef6" title="lookup fid for object named name in directory dir.">dt_lookup_dir</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dir,
<a name="l02013"></a>02013                   <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *fid);
<a name="l02014"></a>02014 
<a name="l02015"></a>02015 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_object_sync(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l02016"></a>02016                                  __u64 start, __u64 end)
<a name="l02017"></a>02017 {
<a name="l02018"></a>02018         LASSERT(o);
<a name="l02019"></a>02019         LASSERT(o-&gt;do_ops);
<a name="l02020"></a>02020         LASSERT(o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a2e3f3539d6ce344b27712d4b2f39d7b2" title="Sync obect.">do_object_sync</a>);
<a name="l02021"></a>02021         <span class="keywordflow">return</span> o-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a2e3f3539d6ce344b27712d4b2f39d7b2" title="Sync obect.">do_object_sync</a>(env, o, start, end);
<a name="l02022"></a>02022 }
<a name="l02023"></a>02023 
<a name="l02024"></a>02024 <span class="keywordtype">int</span> dt_declare_version_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l02025"></a>02025                            <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l02026"></a>02026 <span class="keywordtype">void</span> dt_version_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o,
<a name="l02027"></a>02027                     dt_obj_version_t version, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l02028"></a>02028 dt_obj_version_t dt_version_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *o);
<a name="l02029"></a>02029 
<a name="l02030"></a>02030 
<a name="l02031"></a>02031 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#ga43c7a1d7a094f43523d594505c481095" title="Generic read helper.">dt_read</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02032"></a>02032             <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf, loff_t *pos);
<a name="l02033"></a>02033 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#ga82d909c9a0d09d6c21420825acb9e40e" title="Read structures of fixed size from storage.">dt_record_read</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02034"></a>02034                    <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf, loff_t *pos);
<a name="l02035"></a>02035 <span class="keywordtype">int</span> dt_record_write(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02036"></a>02036                     <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf, loff_t *pos, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th);
<a name="l02037"></a>02037 <span class="keyword">typedef</span> int (*dt_index_page_build_t)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02038"></a>02038                                      <span class="keyword">union </span><a class="code" href="unionlu__page.html">lu_page</a> *lp, <span class="keywordtype">size_t</span> nob,
<a name="l02039"></a>02039                                      <span class="keyword">const</span> <span class="keyword">struct </span>dt_it_ops *iops,
<a name="l02040"></a>02040                                      <span class="keyword">struct </span>dt_it *it, __u32 attr, <span class="keywordtype">void</span> *arg);
<a name="l02041"></a>02041 <span class="keywordtype">int</span> dt_index_walk(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *obj,
<a name="l02042"></a>02042                   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__rdpg.html" title="input params, should be filled out by mdt">lu_rdpg</a> *rdpg, dt_index_page_build_t filler,
<a name="l02043"></a>02043                   <span class="keywordtype">void</span> *arg);
<a name="l02044"></a>02044 <span class="keywordtype">int</span> <a class="code" href="group__dt.html#ga311aa8b791e51a13353036585b1236a4" title="Walk key/record pairs of an index and copy them into 4KB containers to be transferred...">dt_index_read</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l02045"></a>02045                   <span class="keyword">struct</span> <a class="code" href="structidx__info.html">idx_info</a> *ii, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__rdpg.html" title="input params, should be filled out by mdt">lu_rdpg</a> *rdpg);
<a name="l02046"></a>02046 
<a name="l02047"></a>02047 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *dt_trans_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02048"></a>02048                                               <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d)
<a name="l02049"></a>02049 {
<a name="l02050"></a>02050         LASSERT(d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_trans_create</a>);
<a name="l02051"></a>02051         <span class="keywordflow">return</span> d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a06f026899bb291ac5bb915a17dcadb7f" title="Create transaction.">dt_trans_create</a>(env, d);
<a name="l02052"></a>02052 }
<a name="l02053"></a>02053 
<a name="l02054"></a>02054 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_trans_start(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02055"></a>02055                                  <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02056"></a>02056 {
<a name="l02057"></a>02057         LASSERT(d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_trans_start</a>);
<a name="l02058"></a>02058         <span class="keywordflow">return</span> d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_trans_start</a>(env, d, th);
<a name="l02059"></a>02059 }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061 <span class="comment">/* for this transaction hooks shouldn&apos;t be called */</span>
<a name="l02062"></a>02062 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_trans_start_local(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02063"></a>02063                                        <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02064"></a>02064 {
<a name="l02065"></a>02065         LASSERT(d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_trans_start</a>);
<a name="l02066"></a>02066         th-&gt;th_local = 1;
<a name="l02067"></a>02067         <span class="keywordflow">return</span> d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a9f4532e51dbeefa61d9c0f6a9670ef5b" title="Start transaction.">dt_trans_start</a>(env, d, th);
<a name="l02068"></a>02068 }
<a name="l02069"></a>02069 
<a name="l02070"></a>02070 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_trans_stop(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02071"></a>02071                                 <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *d, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02072"></a>02072 {
<a name="l02073"></a>02073         LASSERT(d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_trans_stop</a>);
<a name="l02074"></a>02074         <span class="keywordflow">return</span> d-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a1a48e37999c62e8d1d2ad6e84572393b" title="Stop transaction.">dt_trans_stop</a>(env, d, th);
<a name="l02075"></a>02075 }
<a name="l02076"></a>02076 
<a name="l02077"></a>02077 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_trans_cb_add(<span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l02078"></a>02078                                   <span class="keyword">struct</span> <a class="code" href="structdt__txn__commit__cb.html">dt_txn_commit_cb</a> *dcb)
<a name="l02079"></a>02079 {
<a name="l02080"></a>02080         LASSERT(th-&gt;<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a977a253aad1d585cf9c316c3f87d801d" title="Add commit callback to the transaction.">dt_trans_cb_add</a>);
<a name="l02081"></a>02081         dcb-&gt;dcb_magic = <a class="code" href="group__dt.html#ga89459f49f808512a60eea34fdcd5e43f" title="Special per-transaction callback for cases when just commit callback is needed and...">TRANS_COMMIT_CB_MAGIC</a>;
<a name="l02082"></a>02082         <span class="keywordflow">return</span> th-&gt;<a class="code" href="structthandle.html#ade585afae0d30b274a8259d402e918b6" title="the dt device on which the transactions are executed">th_dev</a>-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a977a253aad1d585cf9c316c3f87d801d" title="Add commit callback to the transaction.">dt_trans_cb_add</a>(th, dcb);
<a name="l02083"></a>02083 }
<a name="l02087"></a>02087 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_record_write(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02088"></a>02088                                           <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02089"></a>02089                                           <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l02090"></a>02090                                           loff_t pos,
<a name="l02091"></a>02091                                           <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02092"></a>02092 {
<a name="l02093"></a>02093         <span class="keywordtype">int</span> rc;
<a name="l02094"></a>02094 
<a name="l02095"></a>02095         LASSERTF(dt != NULL, <span class="stringliteral">&quot;dt is NULL when we want to write record\n&quot;</span>);
<a name="l02096"></a>02096         LASSERT(th != NULL);
<a name="l02097"></a>02097         LASSERT(dt-&gt;do_body_ops);
<a name="l02098"></a>02098         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aa4d64d407e2b442c1e418fa9ca46ab44" title="Declare intention to write data to object.">dbo_declare_write</a>);
<a name="l02099"></a>02099         rc = dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aa4d64d407e2b442c1e418fa9ca46ab44" title="Declare intention to write data to object.">dbo_declare_write</a>(env, dt, buf, pos, th);
<a name="l02100"></a>02100         <span class="keywordflow">return</span> rc;
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a>02103 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02104"></a>02104                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02105"></a>02105                                     <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l02106"></a>02106                                     <span class="keyword">struct</span> <a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> *hint,
<a name="l02107"></a>02107                                     <span class="keyword">struct</span> <a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l02108"></a>02108                                     <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02109"></a>02109 {
<a name="l02110"></a>02110         LASSERT(dt);
<a name="l02111"></a>02111         LASSERT(dt-&gt;do_ops);
<a name="l02112"></a>02112         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ab16b75516dfd3d619fbffbc96f2b9d24" title="Declare intention to create a new object.">do_declare_create</a>);
<a name="l02113"></a>02113 
<a name="l02114"></a>02114         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_CREATE))
<a name="l02115"></a>02115                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02116"></a>02116 
<a name="l02117"></a>02117         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ab16b75516dfd3d619fbffbc96f2b9d24" title="Declare intention to create a new object.">do_declare_create</a>(env, dt, attr, hint, dof, th);
<a name="l02118"></a>02118 }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_create(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02121"></a>02121                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02122"></a>02122                                     <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *attr,
<a name="l02123"></a>02123                                     <span class="keyword">struct</span> <a class="code" href="structdt__allocation__hint.html" title="This is a general purpose dt allocation hint.">dt_allocation_hint</a> *hint,
<a name="l02124"></a>02124                                     <span class="keyword">struct</span> <a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a> *dof,
<a name="l02125"></a>02125                                     <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02126"></a>02126 {
<a name="l02127"></a>02127         LASSERT(dt);
<a name="l02128"></a>02128         LASSERT(dt-&gt;do_ops);
<a name="l02129"></a>02129         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ac1ca5a81cd3d00bd821fbfead64022c3" title="Create new object.">do_create</a>);
<a name="l02130"></a>02130 
<a name="l02131"></a>02131         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_CREATE))
<a name="l02132"></a>02132                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02133"></a>02133 
<a name="l02134"></a>02134         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ac1ca5a81cd3d00bd821fbfead64022c3" title="Create new object.">do_create</a>(env, dt, attr, hint, dof, th);
<a name="l02135"></a>02135 }
<a name="l02136"></a>02136 
<a name="l02137"></a>02137 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_destroy(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02138"></a>02138                                      <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02139"></a>02139                                      <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02140"></a>02140 {
<a name="l02141"></a>02141         LASSERT(dt);
<a name="l02142"></a>02142         LASSERT(dt-&gt;do_ops);
<a name="l02143"></a>02143         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#af211c9cc7a0203979cd8cf0f0b81b293" title="Declare intention to destroy an object.">do_declare_destroy</a>);
<a name="l02144"></a>02144 
<a name="l02145"></a>02145         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_DESTROY))
<a name="l02146"></a>02146                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#af211c9cc7a0203979cd8cf0f0b81b293" title="Declare intention to destroy an object.">do_declare_destroy</a>(env, dt, th);
<a name="l02149"></a>02149 }
<a name="l02150"></a>02150 
<a name="l02151"></a>02151 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_destroy(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02152"></a>02152                              <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02153"></a>02153                              <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02154"></a>02154 {
<a name="l02155"></a>02155         LASSERT(dt);
<a name="l02156"></a>02156         LASSERT(dt-&gt;do_ops);
<a name="l02157"></a>02157         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a19ddd277003c24371f8c5771a2ba77bb" title="Destroy an object.">do_destroy</a>);
<a name="l02158"></a>02158 
<a name="l02159"></a>02159         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DESTROY))
<a name="l02160"></a>02160                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02161"></a>02161 
<a name="l02162"></a>02162         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a19ddd277003c24371f8c5771a2ba77bb" title="Destroy an object.">do_destroy</a>(env, dt, th);
<a name="l02163"></a>02163 }
<a name="l02164"></a>02164 
<a name="l02165"></a>02165 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dt_read_lock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02166"></a>02166                                 <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02167"></a>02167                                 <span class="keywordtype">unsigned</span> role)
<a name="l02168"></a>02168 {
<a name="l02169"></a>02169         LASSERT(dt);
<a name="l02170"></a>02170         LASSERT(dt-&gt;do_ops);
<a name="l02171"></a>02171         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a32a37f3abca0903ec9fa5c70b2b7a423" title="Get read lock on object.">do_read_lock</a>);
<a name="l02172"></a>02172         dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a32a37f3abca0903ec9fa5c70b2b7a423" title="Get read lock on object.">do_read_lock</a>(env, dt, role);
<a name="l02173"></a>02173 }
<a name="l02174"></a>02174 
<a name="l02175"></a>02175 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dt_write_lock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02176"></a>02176                                 <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02177"></a>02177                                 <span class="keywordtype">unsigned</span> role)
<a name="l02178"></a>02178 {
<a name="l02179"></a>02179         LASSERT(dt);
<a name="l02180"></a>02180         LASSERT(dt-&gt;do_ops);
<a name="l02181"></a>02181         LASSERT(dt-&gt;do_ops-&gt;do_write_lock);
<a name="l02182"></a>02182         dt-&gt;do_ops-&gt;do_write_lock(env, dt, role);
<a name="l02183"></a>02183 }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dt_read_unlock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02186"></a>02186                                 <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l02187"></a>02187 {
<a name="l02188"></a>02188         LASSERT(dt);
<a name="l02189"></a>02189         LASSERT(dt-&gt;do_ops);
<a name="l02190"></a>02190         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a5d68d191697e7964615a090f9896f7f5" title="Release read lock.">do_read_unlock</a>);
<a name="l02191"></a>02191         dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a5d68d191697e7964615a090f9896f7f5" title="Release read lock.">do_read_unlock</a>(env, dt);
<a name="l02192"></a>02192 }
<a name="l02193"></a>02193 
<a name="l02194"></a>02194 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dt_write_unlock(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02195"></a>02195                                 <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l02196"></a>02196 {
<a name="l02197"></a>02197         LASSERT(dt);
<a name="l02198"></a>02198         LASSERT(dt-&gt;do_ops);
<a name="l02199"></a>02199         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ad5346269fb80455252849f4fd7403720" title="Release write lock.">do_write_unlock</a>);
<a name="l02200"></a>02200         dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ad5346269fb80455252849f4fd7403720" title="Release write lock.">do_write_unlock</a>(env, dt);
<a name="l02201"></a>02201 }
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_write_locked(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02204"></a>02204                                   <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l02205"></a>02205 {
<a name="l02206"></a>02206         LASSERT(dt);
<a name="l02207"></a>02207         LASSERT(dt-&gt;do_ops);
<a name="l02208"></a>02208         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a9072566fd18a198a7323439603b6fbdf" title="Check whether write lock is held.">do_write_locked</a>);
<a name="l02209"></a>02209         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a9072566fd18a198a7323439603b6fbdf" title="Check whether write lock is held.">do_write_locked</a>(env, dt);
<a name="l02210"></a>02210 }
<a name="l02211"></a>02211 
<a name="l02212"></a>02212 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_attr_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02213"></a>02213                                       <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt)
<a name="l02214"></a>02214 {
<a name="l02215"></a>02215         LASSERT(dt);
<a name="l02216"></a>02216         LASSERT(dt-&gt;do_ops);
<a name="l02217"></a>02217         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#adc1fb34feaf57d9448beaab7f04302bd" title="Declare intention to request reqular attributes.">do_declare_attr_get</a>);
<a name="l02218"></a>02218 
<a name="l02219"></a>02219         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_ATTR_GET))
<a name="l02220"></a>02220                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02221"></a>02221 
<a name="l02222"></a>02222         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#adc1fb34feaf57d9448beaab7f04302bd" title="Declare intention to request reqular attributes.">do_declare_attr_get</a>(env, dt);
<a name="l02223"></a>02223 }
<a name="l02224"></a>02224 
<a name="l02225"></a>02225 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_attr_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02226"></a>02226                               <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *la)
<a name="l02227"></a>02227 {
<a name="l02228"></a>02228         LASSERT(dt);
<a name="l02229"></a>02229         LASSERT(dt-&gt;do_ops);
<a name="l02230"></a>02230         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a1d2ff17287fa229d0325cccf0aac5beb" title="Return regular attributes.">do_attr_get</a>);
<a name="l02231"></a>02231 
<a name="l02232"></a>02232         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_ATTR_GET))
<a name="l02233"></a>02233                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02234"></a>02234 
<a name="l02235"></a>02235         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a1d2ff17287fa229d0325cccf0aac5beb" title="Return regular attributes.">do_attr_get</a>(env, dt, la);
<a name="l02236"></a>02236 }
<a name="l02237"></a>02237 
<a name="l02238"></a>02238 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_attr_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02239"></a>02239                                       <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02240"></a>02240                                       <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *la,
<a name="l02241"></a>02241                                       <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02242"></a>02242 {
<a name="l02243"></a>02243         LASSERT(dt);
<a name="l02244"></a>02244         LASSERT(dt-&gt;do_ops);
<a name="l02245"></a>02245         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a44eb5df458974e0568eba9863c439362" title="Declare intention to change regular object&amp;#39;s attributes.">do_declare_attr_set</a>);
<a name="l02246"></a>02246 
<a name="l02247"></a>02247         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_ATTR_SET))
<a name="l02248"></a>02248                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02249"></a>02249 
<a name="l02250"></a>02250         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a44eb5df458974e0568eba9863c439362" title="Declare intention to change regular object&amp;#39;s attributes.">do_declare_attr_set</a>(env, dt, la, th);
<a name="l02251"></a>02251 }
<a name="l02252"></a>02252 
<a name="l02253"></a>02253 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_attr_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02254"></a>02254                               <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a> *la, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02255"></a>02255 {
<a name="l02256"></a>02256         LASSERT(dt);
<a name="l02257"></a>02257         LASSERT(dt-&gt;do_ops);
<a name="l02258"></a>02258         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#aa9a55847088d77aa8bbc16c693344ddb" title="Change regular attributes.">do_attr_set</a>);
<a name="l02259"></a>02259 
<a name="l02260"></a>02260         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_ATTR_SET))
<a name="l02261"></a>02261                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#aa9a55847088d77aa8bbc16c693344ddb" title="Change regular attributes.">do_attr_set</a>(env, dt, la, th);
<a name="l02264"></a>02264 }
<a name="l02265"></a>02265 
<a name="l02266"></a>02266 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_ref_add(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02267"></a>02267                                      <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02268"></a>02268 {
<a name="l02269"></a>02269         LASSERT(dt);
<a name="l02270"></a>02270         LASSERT(dt-&gt;do_ops);
<a name="l02271"></a>02271         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a53431a1038b787ca15950b5a0495408b" title="Declare intention to increment nlink count.">do_declare_ref_add</a>);
<a name="l02272"></a>02272 
<a name="l02273"></a>02273         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_REF_ADD))
<a name="l02274"></a>02274                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02275"></a>02275 
<a name="l02276"></a>02276         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a53431a1038b787ca15950b5a0495408b" title="Declare intention to increment nlink count.">do_declare_ref_add</a>(env, dt, th);
<a name="l02277"></a>02277 }
<a name="l02278"></a>02278 
<a name="l02279"></a>02279 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_ref_add(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02280"></a>02280                              <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02281"></a>02281 {
<a name="l02282"></a>02282         LASSERT(dt);
<a name="l02283"></a>02283         LASSERT(dt-&gt;do_ops);
<a name="l02284"></a>02284         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a3ea43d6a7abb742fb238acc711b3bd2b" title="Increment nlink.">do_ref_add</a>);
<a name="l02285"></a>02285 
<a name="l02286"></a>02286         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_REF_ADD))
<a name="l02287"></a>02287                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a3ea43d6a7abb742fb238acc711b3bd2b" title="Increment nlink.">do_ref_add</a>(env, dt, th);
<a name="l02290"></a>02290 }
<a name="l02291"></a>02291 
<a name="l02292"></a>02292 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_ref_del(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02293"></a>02293                                      <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02294"></a>02294 {
<a name="l02295"></a>02295         LASSERT(dt);
<a name="l02296"></a>02296         LASSERT(dt-&gt;do_ops);
<a name="l02297"></a>02297         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ae33177c8da269d507a9b22b8066ae5f4" title="Declare intention to decrement nlink count.">do_declare_ref_del</a>);
<a name="l02298"></a>02298 
<a name="l02299"></a>02299         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_REF_DEL))
<a name="l02300"></a>02300                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02301"></a>02301 
<a name="l02302"></a>02302         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ae33177c8da269d507a9b22b8066ae5f4" title="Declare intention to decrement nlink count.">do_declare_ref_del</a>(env, dt, th);
<a name="l02303"></a>02303 }
<a name="l02304"></a>02304 
<a name="l02305"></a>02305 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_ref_del(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02306"></a>02306                              <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02307"></a>02307 {
<a name="l02308"></a>02308         LASSERT(dt);
<a name="l02309"></a>02309         LASSERT(dt-&gt;do_ops);
<a name="l02310"></a>02310         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a8d0abf79c5dace1f0839aefe251bfc1f" title="Decrement nlink.">do_ref_del</a>);
<a name="l02311"></a>02311 
<a name="l02312"></a>02312         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_REF_DEL))
<a name="l02313"></a>02313                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02314"></a>02314 
<a name="l02315"></a>02315         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a8d0abf79c5dace1f0839aefe251bfc1f" title="Decrement nlink.">do_ref_del</a>(env, dt, th);
<a name="l02316"></a>02316 }
<a name="l02317"></a>02317 
<a name="l02318"></a>02318 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_bufs_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02319"></a>02319                               <span class="keyword">struct</span> <a class="code" href="structniobuf__remote.html">niobuf_remote</a> *rnb,
<a name="l02320"></a>02320                               <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb, <span class="keywordtype">int</span> rw)
<a name="l02321"></a>02321 {
<a name="l02322"></a>02322         LASSERT(d);
<a name="l02323"></a>02323         LASSERT(d-&gt;do_body_ops);
<a name="l02324"></a>02324         LASSERT(d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#afe9f070ccbf102ca7d366a0d902216a7" title="Return buffers for data.">dbo_bufs_get</a>);
<a name="l02325"></a>02325         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#afe9f070ccbf102ca7d366a0d902216a7" title="Return buffers for data.">dbo_bufs_get</a>(env, d, rnb-&gt;rnb_offset,
<a name="l02326"></a>02326                                             rnb-&gt;rnb_len, lnb, rw);
<a name="l02327"></a>02327 }
<a name="l02328"></a>02328 
<a name="l02329"></a>02329 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_bufs_put(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02330"></a>02330                               <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb, <span class="keywordtype">int</span> n)
<a name="l02331"></a>02331 {
<a name="l02332"></a>02332         LASSERT(d);
<a name="l02333"></a>02333         LASSERT(d-&gt;do_body_ops);
<a name="l02334"></a>02334         LASSERT(d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aaa0f2da7b7271a358b9c1e3bfa4326e3" title="Release reference granted by -&amp;gt;dbo_bufs_get().">dbo_bufs_put</a>);
<a name="l02335"></a>02335         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aaa0f2da7b7271a358b9c1e3bfa4326e3" title="Release reference granted by -&amp;gt;dbo_bufs_get().">dbo_bufs_put</a>(env, d, lnb, n);
<a name="l02336"></a>02336 }
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_write_prep(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02339"></a>02339                                 <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb, <span class="keywordtype">int</span> n)
<a name="l02340"></a>02340 {
<a name="l02341"></a>02341         LASSERT(d);
<a name="l02342"></a>02342         LASSERT(d-&gt;do_body_ops);
<a name="l02343"></a>02343         LASSERT(d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#ab941af8487086f964f8721de634b86b8" title="Prepare buffers for write.">dbo_write_prep</a>);
<a name="l02344"></a>02344         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#ab941af8487086f964f8721de634b86b8" title="Prepare buffers for write.">dbo_write_prep</a>(env, d, lnb, n);
<a name="l02345"></a>02345 }
<a name="l02346"></a>02346 
<a name="l02347"></a>02347 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_write_commit(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02348"></a>02348                                           <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02349"></a>02349                                           <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb,
<a name="l02350"></a>02350                                           <span class="keywordtype">int</span> n, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02351"></a>02351 {
<a name="l02352"></a>02352         LASSERTF(d != NULL, <span class="stringliteral">&quot;dt is NULL when we want to declare write\n&quot;</span>);
<a name="l02353"></a>02353         LASSERT(th != NULL);
<a name="l02354"></a>02354         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aaa2ba33b84fa7bdb6413e6f8347a1482" title="Declare intention to write data stored in the buffers.">dbo_declare_write_commit</a>(env, d, lnb, n, th);
<a name="l02355"></a>02355 }
<a name="l02356"></a>02356 
<a name="l02357"></a>02357 
<a name="l02358"></a>02358 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_write_commit(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02359"></a>02359                                   <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d, <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb,
<a name="l02360"></a>02360                                   <span class="keywordtype">int</span> n, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02361"></a>02361 {
<a name="l02362"></a>02362         LASSERT(d);
<a name="l02363"></a>02363         LASSERT(d-&gt;do_body_ops);
<a name="l02364"></a>02364         LASSERT(d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#ac44e84fe7124d965c379a6817e4dc8bc" title="Write to existing object.">dbo_write_commit</a>);
<a name="l02365"></a>02365         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#ac44e84fe7124d965c379a6817e4dc8bc" title="Write to existing object.">dbo_write_commit</a>(env, d, lnb, n, th);
<a name="l02366"></a>02366 }
<a name="l02367"></a>02367 
<a name="l02368"></a>02368 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_read_prep(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02369"></a>02369                                <span class="keyword">struct</span> <a class="code" href="structniobuf__local.html">niobuf_local</a> *lnb, <span class="keywordtype">int</span> n)
<a name="l02370"></a>02370 {
<a name="l02371"></a>02371         LASSERT(d);
<a name="l02372"></a>02372         LASSERT(d-&gt;do_body_ops);
<a name="l02373"></a>02373         LASSERT(d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a064a13169a793907c32faa01a657810a" title="Prepare buffers for reading.">dbo_read_prep</a>);
<a name="l02374"></a>02374         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a064a13169a793907c32faa01a657810a" title="Prepare buffers for reading.">dbo_read_prep</a>(env, d, lnb, n);
<a name="l02375"></a>02375 }
<a name="l02376"></a>02376 
<a name="l02377"></a>02377 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_write(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02378"></a>02378                                    <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02379"></a>02379                                    <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf, loff_t pos,
<a name="l02380"></a>02380                                    <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02381"></a>02381 {
<a name="l02382"></a>02382         LASSERT(dt);
<a name="l02383"></a>02383         LASSERT(dt-&gt;do_body_ops);
<a name="l02384"></a>02384         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aa4d64d407e2b442c1e418fa9ca46ab44" title="Declare intention to write data to object.">dbo_declare_write</a>);
<a name="l02385"></a>02385         <span class="keywordflow">return</span> dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#aa4d64d407e2b442c1e418fa9ca46ab44" title="Declare intention to write data to object.">dbo_declare_write</a>(env, dt, buf, pos, th);
<a name="l02386"></a>02386 }
<a name="l02387"></a>02387 
<a name="l02388"></a>02388 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t dt_write(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02389"></a>02389                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf, loff_t *pos,
<a name="l02390"></a>02390                                <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th, <span class="keywordtype">int</span> rq)
<a name="l02391"></a>02391 {
<a name="l02392"></a>02392         LASSERT(dt);
<a name="l02393"></a>02393         LASSERT(dt-&gt;do_body_ops);
<a name="l02394"></a>02394         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a1d14bb3445892ab680cd8885645334bb" title="Write unstructured data to regular existing object.">dbo_write</a>);
<a name="l02395"></a>02395         <span class="keywordflow">return</span> dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a1d14bb3445892ab680cd8885645334bb" title="Write unstructured data to regular existing object.">dbo_write</a>(env, dt, buf, pos, th, rq);
<a name="l02396"></a>02396 }
<a name="l02397"></a>02397 
<a name="l02398"></a>02398 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_punch(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02399"></a>02399                                    <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, __u64 start,
<a name="l02400"></a>02400                                    __u64 end, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02401"></a>02401 {
<a name="l02402"></a>02402         LASSERT(dt);
<a name="l02403"></a>02403         LASSERT(dt-&gt;do_body_ops);
<a name="l02404"></a>02404         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a814e0570b29ea97a47f9851e0f6bfc0c" title="Declare intention to deallocate space from an object.">dbo_declare_punch</a>);
<a name="l02405"></a>02405         <span class="keywordflow">return</span> dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a814e0570b29ea97a47f9851e0f6bfc0c" title="Declare intention to deallocate space from an object.">dbo_declare_punch</a>(env, dt, start, end, th);
<a name="l02406"></a>02406 }
<a name="l02407"></a>02407 
<a name="l02408"></a>02408 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_punch(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02409"></a>02409                            __u64 start, __u64 end, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02410"></a>02410 {
<a name="l02411"></a>02411         LASSERT(dt);
<a name="l02412"></a>02412         LASSERT(dt-&gt;do_body_ops);
<a name="l02413"></a>02413         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a3ee6232f042892134c6f2fead05ed2c4" title="Deallocate specified region in an object.">dbo_punch</a>);
<a name="l02414"></a>02414         <span class="keywordflow">return</span> dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a3ee6232f042892134c6f2fead05ed2c4" title="Deallocate specified region in an object.">dbo_punch</a>(env, dt, start, end, th);
<a name="l02415"></a>02415 }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_ladvise(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02418"></a>02418                              __u64 start, __u64 end, <span class="keywordtype">int</span> advice)
<a name="l02419"></a>02419 {
<a name="l02420"></a>02420         LASSERT(dt);
<a name="l02421"></a>02421         LASSERT(dt-&gt;do_body_ops);
<a name="l02422"></a>02422         LASSERT(dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a5b1cd9fc446d73843de8c4e57475765e" title="Give advices on specified region in an object.">dbo_ladvise</a>);
<a name="l02423"></a>02423         <span class="keywordflow">return</span> dt-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#a5b1cd9fc446d73843de8c4e57475765e" title="Give advices on specified region in an object.">dbo_ladvise</a>(env, dt, start, end, advice);
<a name="l02424"></a>02424 }
<a name="l02425"></a>02425 
<a name="l02426"></a>02426 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_fiemap_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *d,
<a name="l02427"></a>02427                                 <span class="keyword">struct</span> fiemap *fm)
<a name="l02428"></a>02428 {
<a name="l02429"></a>02429         LASSERT(d);
<a name="l02430"></a>02430         <span class="keywordflow">if</span> (d-&gt;do_body_ops == NULL)
<a name="l02431"></a>02431                 <span class="keywordflow">return</span> -EPROTO;
<a name="l02432"></a>02432         <span class="keywordflow">if</span> (d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#afde6790a70f30800664044f1c627cb63" title="Return logical to physical block mapping for a given extent.">dbo_fiemap_get</a> == NULL)
<a name="l02433"></a>02433                 <span class="keywordflow">return</span> -EOPNOTSUPP;
<a name="l02434"></a>02434         <span class="keywordflow">return</span> d-&gt;do_body_ops-&gt;<a class="code" href="structdt__body__operations.html#afde6790a70f30800664044f1c627cb63" title="Return logical to physical block mapping for a given extent.">dbo_fiemap_get</a>(env, d, fm);
<a name="l02435"></a>02435 }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_statfs(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l02438"></a>02438                             <span class="keyword">struct</span> <a class="code" href="structobd__statfs.html">obd_statfs</a> *osfs)
<a name="l02439"></a>02439 {
<a name="l02440"></a>02440         LASSERT(dev);
<a name="l02441"></a>02441         LASSERT(dev-&gt;dd_ops);
<a name="l02442"></a>02442         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_statfs</a>);
<a name="l02443"></a>02443         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a5551db7b0deb0d6c07fc738552f445f7" title="Return device-wide statistics.">dt_statfs</a>(env, dev, osfs);
<a name="l02444"></a>02444 }
<a name="l02445"></a>02445 
<a name="l02446"></a>02446 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_root_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l02447"></a>02447                               <span class="keyword">struct</span> <a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a> *f)
<a name="l02448"></a>02448 {
<a name="l02449"></a>02449         LASSERT(dev);
<a name="l02450"></a>02450         LASSERT(dev-&gt;dd_ops);
<a name="l02451"></a>02451         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#ad2a831d38be0be73f8a5498112e13b56" title="Return FID of root index object.">dt_root_get</a>);
<a name="l02452"></a>02452         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#ad2a831d38be0be73f8a5498112e13b56" title="Return FID of root index object.">dt_root_get</a>(env, dev, f);
<a name="l02453"></a>02453 }
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> dt_conf_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02456"></a>02456                                <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev,
<a name="l02457"></a>02457                                <span class="keyword">struct</span> <a class="code" href="structdt__device__param.html">dt_device_param</a> *param)
<a name="l02458"></a>02458 {
<a name="l02459"></a>02459         LASSERT(dev);
<a name="l02460"></a>02460         LASSERT(dev-&gt;dd_ops);
<a name="l02461"></a>02461         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a652ff54fee6fbc7f4a5dda78befe5489" title="Return device configuration data.">dt_conf_get</a>);
<a name="l02462"></a>02462         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a652ff54fee6fbc7f4a5dda78befe5489" title="Return device configuration data.">dt_conf_get</a>(env, dev, param);
<a name="l02463"></a>02463 }
<a name="l02464"></a>02464 
<a name="l02465"></a>02465 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_sync(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev)
<a name="l02466"></a>02466 {
<a name="l02467"></a>02467         LASSERT(dev);
<a name="l02468"></a>02468         LASSERT(dev-&gt;dd_ops);
<a name="l02469"></a>02469         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_sync</a>);
<a name="l02470"></a>02470         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#aff03760ef16c08ef22ecfcace4a7afb9" title="Sync the device.">dt_sync</a>(env, dev);
<a name="l02471"></a>02471 }
<a name="l02472"></a>02472 
<a name="l02473"></a>02473 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_ro(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev)
<a name="l02474"></a>02474 {
<a name="l02475"></a>02475         LASSERT(dev);
<a name="l02476"></a>02476         LASSERT(dev-&gt;dd_ops);
<a name="l02477"></a>02477         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a03deb463a9aebe843829c31bbab1c34d" title="Make device read-only.">dt_ro</a>);
<a name="l02478"></a>02478         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#a03deb463a9aebe843829c31bbab1c34d" title="Make device read-only.">dt_ro</a>(env, dev);
<a name="l02479"></a>02479 }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_insert(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02482"></a>02482                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02483"></a>02483                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_rec *rec,
<a name="l02484"></a>02484                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_key *key,
<a name="l02485"></a>02485                                     <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02486"></a>02486 {
<a name="l02487"></a>02487         LASSERT(dt);
<a name="l02488"></a>02488         LASSERT(dt-&gt;do_index_ops);
<a name="l02489"></a>02489         LASSERT(dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#af077ea7c9f156cb161f9c361109e1f68" title="Declare intention to insert a key/value into an index.">dio_declare_insert</a>);
<a name="l02490"></a>02490 
<a name="l02491"></a>02491         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_INSERT))
<a name="l02492"></a>02492                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02493"></a>02493 
<a name="l02494"></a>02494         <span class="keywordflow">return</span> dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#af077ea7c9f156cb161f9c361109e1f68" title="Declare intention to insert a key/value into an index.">dio_declare_insert</a>(env, dt, rec, key, th);
<a name="l02495"></a>02495 }
<a name="l02496"></a>02496 
<a name="l02497"></a>02497 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_insert(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02498"></a>02498                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02499"></a>02499                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_rec *rec,
<a name="l02500"></a>02500                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_key *key,
<a name="l02501"></a>02501                                     <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th,
<a name="l02502"></a>02502                                     <span class="keywordtype">int</span> noquota)
<a name="l02503"></a>02503 {
<a name="l02504"></a>02504         LASSERT(dt);
<a name="l02505"></a>02505         LASSERT(dt-&gt;do_index_ops);
<a name="l02506"></a>02506         LASSERT(dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#af1e0507f0ca4df0ed3f486bab027dbda" title="Insert a new key/value pair into an index.">dio_insert</a>);
<a name="l02507"></a>02507 
<a name="l02508"></a>02508         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_INSERT))
<a name="l02509"></a>02509                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511         <span class="keywordflow">return</span> dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#af1e0507f0ca4df0ed3f486bab027dbda" title="Insert a new key/value pair into an index.">dio_insert</a>(env, dt, rec, key, th, noquota);
<a name="l02512"></a>02512 }
<a name="l02513"></a>02513 
<a name="l02514"></a>02514 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_xattr_del(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02515"></a>02515                                        <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02516"></a>02516                                        <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l02517"></a>02517                                        <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02518"></a>02518 {
<a name="l02519"></a>02519         LASSERT(dt);
<a name="l02520"></a>02520         LASSERT(dt-&gt;do_ops);
<a name="l02521"></a>02521         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a7b2e57f4c0bdb5108e9d1920242e813e" title="Declare intention to delete an extended attribute.">do_declare_xattr_del</a>);
<a name="l02522"></a>02522 
<a name="l02523"></a>02523         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_XATTR_DEL))
<a name="l02524"></a>02524                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02525"></a>02525 
<a name="l02526"></a>02526         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a7b2e57f4c0bdb5108e9d1920242e813e" title="Declare intention to delete an extended attribute.">do_declare_xattr_del</a>(env, dt, name, th);
<a name="l02527"></a>02527 }
<a name="l02528"></a>02528 
<a name="l02529"></a>02529 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_xattr_del(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02530"></a>02530                                <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l02531"></a>02531                                <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02532"></a>02532 {
<a name="l02533"></a>02533         LASSERT(dt);
<a name="l02534"></a>02534         LASSERT(dt-&gt;do_ops);
<a name="l02535"></a>02535         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a19762fb1d9e75136521019d51759b6ec" title="Delete an extended attribute.">do_xattr_del</a>);
<a name="l02536"></a>02536 
<a name="l02537"></a>02537         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_XATTR_DEL))
<a name="l02538"></a>02538                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02539"></a>02539 
<a name="l02540"></a>02540         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a19762fb1d9e75136521019d51759b6ec" title="Delete an extended attribute.">do_xattr_del</a>(env, dt, name, th);
<a name="l02541"></a>02541 }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_xattr_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02544"></a>02544                                       <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02545"></a>02545                                       <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l02546"></a>02546                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> fl,
<a name="l02547"></a>02547                                       <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02548"></a>02548 {
<a name="l02549"></a>02549         LASSERT(dt);
<a name="l02550"></a>02550         LASSERT(dt-&gt;do_ops);
<a name="l02551"></a>02551         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ad5d602fce101080720544cbdb0de96e8" title="Declare intention to change an extended attribute.">do_declare_xattr_set</a>);
<a name="l02552"></a>02552 
<a name="l02553"></a>02553         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_XATTR_SET))
<a name="l02554"></a>02554                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02555"></a>02555 
<a name="l02556"></a>02556         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#ad5d602fce101080720544cbdb0de96e8" title="Declare intention to change an extended attribute.">do_declare_xattr_set</a>(env, dt, buf, name, fl, th);
<a name="l02557"></a>02557 }
<a name="l02558"></a>02558 
<a name="l02559"></a>02559 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_xattr_set(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02560"></a>02560                                <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l02561"></a>02561                                <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> fl, <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02562"></a>02562 {
<a name="l02563"></a>02563         LASSERT(dt);
<a name="l02564"></a>02564         LASSERT(dt-&gt;do_ops);
<a name="l02565"></a>02565         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a231db7d512a5786b8ad887e9fc47190b" title="Set an extended attribute.">do_xattr_set</a>);
<a name="l02566"></a>02566 
<a name="l02567"></a>02567         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_XATTR_SET))
<a name="l02568"></a>02568                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02569"></a>02569 
<a name="l02570"></a>02570         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a231db7d512a5786b8ad887e9fc47190b" title="Set an extended attribute.">do_xattr_set</a>(env, dt, buf, name, fl, th);
<a name="l02571"></a>02571 }
<a name="l02572"></a>02572 
<a name="l02573"></a>02573 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_xattr_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02574"></a>02574                                        <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02575"></a>02575                                        <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l02576"></a>02576                                        <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l02577"></a>02577 {
<a name="l02578"></a>02578         LASSERT(dt);
<a name="l02579"></a>02579         LASSERT(dt-&gt;do_ops);
<a name="l02580"></a>02580         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a2032c927c95147729dd7a7247c5c12aa" title="Declare intention to request extented attribute.">do_declare_xattr_get</a>);
<a name="l02581"></a>02581 
<a name="l02582"></a>02582         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_XATTR_GET))
<a name="l02583"></a>02583                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02584"></a>02584 
<a name="l02585"></a>02585         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a2032c927c95147729dd7a7247c5c12aa" title="Declare intention to request extented attribute.">do_declare_xattr_get</a>(env, dt, buf, name);
<a name="l02586"></a>02586 }
<a name="l02587"></a>02587 
<a name="l02588"></a>02588 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_xattr_get(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02589"></a>02589                                <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt, <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf,
<a name="l02590"></a>02590                                <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l02591"></a>02591 {
<a name="l02592"></a>02592         LASSERT(dt);
<a name="l02593"></a>02593         LASSERT(dt-&gt;do_ops);
<a name="l02594"></a>02594         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#af4c8c504e52a5571dbd0557980c3818a" title="Return a value of an extended attribute.">do_xattr_get</a>);
<a name="l02595"></a>02595 
<a name="l02596"></a>02596         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_XATTR_GET))
<a name="l02597"></a>02597                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02598"></a>02598 
<a name="l02599"></a>02599         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#af4c8c504e52a5571dbd0557980c3818a" title="Return a value of an extended attribute.">do_xattr_get</a>(env, dt, buf, name);
<a name="l02600"></a>02600 }
<a name="l02601"></a>02601 
<a name="l02602"></a>02602 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_xattr_list(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env, <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02603"></a>02603                                 <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a> *buf)
<a name="l02604"></a>02604 {
<a name="l02605"></a>02605         LASSERT(dt);
<a name="l02606"></a>02606         LASSERT(dt-&gt;do_ops);
<a name="l02607"></a>02607         LASSERT(dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a0ace7a9f2e3ae94bb5d5b7434917f0f1" title="Return a list of the extended attributes.">do_xattr_list</a>);
<a name="l02608"></a>02608 
<a name="l02609"></a>02609         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_XATTR_LIST))
<a name="l02610"></a>02610                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02611"></a>02611 
<a name="l02612"></a>02612         <span class="keywordflow">return</span> dt-&gt;do_ops-&gt;<a class="code" href="structdt__object__operations.html#a0ace7a9f2e3ae94bb5d5b7434917f0f1" title="Return a list of the extended attributes.">do_xattr_list</a>(env, dt, buf);
<a name="l02613"></a>02613 }
<a name="l02614"></a>02614 
<a name="l02615"></a>02615 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_declare_delete(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02616"></a>02616                                     <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02617"></a>02617                                     <span class="keyword">const</span> <span class="keyword">struct</span> dt_key *key,
<a name="l02618"></a>02618                                     <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02619"></a>02619 {
<a name="l02620"></a>02620         LASSERT(dt);
<a name="l02621"></a>02621         LASSERT(dt-&gt;do_index_ops);
<a name="l02622"></a>02622         LASSERT(dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#aa25f7e5f60a5b9055e3f9b0898b2888b" title="Declare intention to delete a key/value from an index.">dio_declare_delete</a>);
<a name="l02623"></a>02623 
<a name="l02624"></a>02624         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DECLARE_DELETE))
<a name="l02625"></a>02625                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02626"></a>02626 
<a name="l02627"></a>02627         <span class="keywordflow">return</span> dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#aa25f7e5f60a5b9055e3f9b0898b2888b" title="Declare intention to delete a key/value from an index.">dio_declare_delete</a>(env, dt, key, th);
<a name="l02628"></a>02628 }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_delete(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02631"></a>02631                             <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02632"></a>02632                             <span class="keyword">const</span> <span class="keyword">struct</span> dt_key *key,
<a name="l02633"></a>02633                             <span class="keyword">struct</span> <a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th)
<a name="l02634"></a>02634 {
<a name="l02635"></a>02635         LASSERT(dt);
<a name="l02636"></a>02636         LASSERT(dt-&gt;do_index_ops);
<a name="l02637"></a>02637         LASSERT(dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#abe3c3c85ed6a910700306482ba8fcd0d" title="Delete key/value pair from an index.">dio_delete</a>);
<a name="l02638"></a>02638 
<a name="l02639"></a>02639         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_DELETE))
<a name="l02640"></a>02640                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02641"></a>02641 
<a name="l02642"></a>02642         <span class="keywordflow">return</span> dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#abe3c3c85ed6a910700306482ba8fcd0d" title="Delete key/value pair from an index.">dio_delete</a>(env, dt, key, th);
<a name="l02643"></a>02643 }
<a name="l02644"></a>02644 
<a name="l02645"></a>02645 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_commit_async(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02646"></a>02646                                   <span class="keyword">struct</span> <a class="code" href="structdt__device.html">dt_device</a> *dev)
<a name="l02647"></a>02647 {
<a name="l02648"></a>02648         LASSERT(dev);
<a name="l02649"></a>02649         LASSERT(dev-&gt;dd_ops);
<a name="l02650"></a>02650         LASSERT(dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#ab811b4bbba68f4edcab228e8d9f52d3c" title="Start transaction commit asynchronously.">dt_commit_async</a>);
<a name="l02651"></a>02651         <span class="keywordflow">return</span> dev-&gt;dd_ops-&gt;<a class="code" href="structdt__device__operations.html#ab811b4bbba68f4edcab228e8d9f52d3c" title="Start transaction commit asynchronously.">dt_commit_async</a>(env, dev);
<a name="l02652"></a>02652 }
<a name="l02653"></a>02653 
<a name="l02654"></a>02654 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> dt_lookup(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env,
<a name="l02655"></a>02655                             <span class="keyword">struct</span> <a class="code" href="structdt__object.html">dt_object</a> *dt,
<a name="l02656"></a>02656                             <span class="keyword">struct</span> dt_rec *rec,
<a name="l02657"></a>02657                             <span class="keyword">const</span> <span class="keyword">struct</span> dt_key *key)
<a name="l02658"></a>02658 {
<a name="l02659"></a>02659         <span class="keywordtype">int</span> ret;
<a name="l02660"></a>02660 
<a name="l02661"></a>02661         LASSERT(dt);
<a name="l02662"></a>02662         LASSERT(dt-&gt;do_index_ops);
<a name="l02663"></a>02663         LASSERT(dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#aab6a7632adfce2297c022b12f0d61791" title="Lookup in an index by key.">dio_lookup</a>);
<a name="l02664"></a>02664 
<a name="l02665"></a>02665         <span class="keywordflow">if</span> (CFS_FAULT_CHECK(OBD_FAIL_DT_LOOKUP))
<a name="l02666"></a>02666                 <span class="keywordflow">return</span> cfs_fail_err;
<a name="l02667"></a>02667 
<a name="l02668"></a>02668         ret = dt-&gt;do_index_ops-&gt;<a class="code" href="structdt__index__operations.html#aab6a7632adfce2297c022b12f0d61791" title="Lookup in an index by key.">dio_lookup</a>(env, dt, rec, key);
<a name="l02669"></a>02669         <span class="keywordflow">if</span> (ret &gt; 0)
<a name="l02670"></a>02670                 ret = 0;
<a name="l02671"></a>02671         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == 0)
<a name="l02672"></a>02672                 ret = -ENOENT;
<a name="l02673"></a>02673         <span class="keywordflow">return</span> ret;
<a name="l02674"></a>02674 }
<a name="l02675"></a>02675 
<a name="l02676"></a><a class="code" href="structdt__find__hint.html">02676</a> <span class="keyword">struct </span><a class="code" href="structdt__find__hint.html">dt_find_hint</a> {
<a name="l02677"></a>02677         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>        *dfh_fid;
<a name="l02678"></a>02678         <span class="keyword">struct </span><a class="code" href="structdt__device.html">dt_device</a>     *dfh_dt;
<a name="l02679"></a>02679         <span class="keyword">struct </span><a class="code" href="structdt__object.html">dt_object</a>     *dfh_o;
<a name="l02680"></a>02680 };
<a name="l02681"></a>02681 
<a name="l02682"></a><a class="code" href="structdt__insert__rec.html">02682</a> <span class="keyword">struct </span><a class="code" href="structdt__insert__rec.html">dt_insert_rec</a> {
<a name="l02683"></a>02683         <span class="keyword">union </span>{
<a name="l02684"></a>02684                 <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>     *rec_fid;
<a name="l02685"></a>02685                 <span class="keywordtype">void</span>                    *rec_data;
<a name="l02686"></a>02686         };
<a name="l02687"></a>02687         <span class="keyword">union </span>{
<a name="l02688"></a>02688                 <span class="keyword">struct </span>{
<a name="l02689"></a>02689                         __u32            rec_type;
<a name="l02690"></a>02690                         __u32            rec_padding;
<a name="l02691"></a>02691                 };
<a name="l02692"></a>02692                 __u64                    rec_misc;
<a name="l02693"></a>02693         };
<a name="l02694"></a>02694 };
<a name="l02695"></a>02695 
<a name="l02696"></a><a class="code" href="structdt__thread__info.html">02696</a> <span class="keyword">struct </span><a class="code" href="structdt__thread__info.html">dt_thread_info</a> {
<a name="l02697"></a>02697         <span class="keywordtype">char</span>                     dti_buf[DT_MAX_PATH];
<a name="l02698"></a>02698         <span class="keyword">struct </span><a class="code" href="structdt__find__hint.html">dt_find_hint</a>      dti_dfh;
<a name="l02699"></a>02699         <span class="keyword">struct </span><a class="code" href="structlu__attr.html" title="Common object attributes.">lu_attr</a>           dti_attr;
<a name="l02700"></a>02700         <span class="keyword">struct </span><a class="code" href="structlu__fid.html" title="File IDentifier.">lu_fid</a>            dti_fid;
<a name="l02701"></a>02701         <span class="keyword">struct </span><a class="code" href="structdt__object__format.html" title="object format specifier.">dt_object_format</a>  dti_dof;
<a name="l02702"></a>02702         <span class="keyword">struct </span><a class="code" href="structlustre__mdt__attrs.html" title="Following struct for object attributes, that will be kept inode&amp;#39;s EA.">lustre_mdt_attrs</a>  dti_lma;
<a name="l02703"></a>02703         <span class="keyword">struct </span><a class="code" href="structlu__buf.html" title="Common buffer structure to be passed around for various xattr_{s,g}et() methods.">lu_buf</a>            dti_lb;
<a name="l02704"></a>02704         <span class="keyword">struct </span><a class="code" href="structlu__object__conf.html" title="Object configuration, describing particulars of object being created.">lu_object_conf</a>    dti_conf;
<a name="l02705"></a>02705         loff_t                   dti_off;
<a name="l02706"></a>02706         <span class="keyword">struct </span><a class="code" href="structdt__insert__rec.html">dt_insert_rec</a>     dti_dt_rec;
<a name="l02707"></a>02707 };
<a name="l02708"></a>02708 
<a name="l02709"></a>02709 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structlu__context__key.html" title="Key.">lu_context_key</a> dt_key;
<a name="l02710"></a>02710 
<a name="l02711"></a>02711 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">struct </span><a class="code" href="structdt__thread__info.html">dt_thread_info</a> *dt_info(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structlu__env.html" title="Environment.">lu_env</a> *env)
<a name="l02712"></a>02712 {
<a name="l02713"></a>02713         <span class="keyword">struct </span><a class="code" href="structdt__thread__info.html">dt_thread_info</a> *dti;
<a name="l02714"></a>02714 
<a name="l02715"></a>02715         dti = <a class="code" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx.">lu_context_key_get</a>(&amp;env-&gt;<a class="code" href="structlu__env.html#a8c3e54a599d9514dce7868eab34e411d" title="&amp;quot;Local&amp;quot; context, used to store data instead of stack.">le_ctx</a>, &amp;dt_key);
<a name="l02716"></a>02716         LASSERT(dti);
<a name="l02717"></a>02717         <span class="keywordflow">return</span> dti;
<a name="l02718"></a>02718 }
<a name="l02719"></a>02719 
<a name="l02720"></a>02720 <span class="keywordtype">int</span> dt_global_init(<span class="keywordtype">void</span>);
<a name="l02721"></a>02721 <span class="keywordtype">void</span> dt_global_fini(<span class="keywordtype">void</span>);
<a name="l02722"></a>02722 
<a name="l02723"></a>02723 <span class="preprocessor"># ifdef CONFIG_PROC_FS</span>
<a name="l02724"></a>02724 <span class="preprocessor"></span><span class="keywordtype">int</span> lprocfs_dt_blksize_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02725"></a>02725 <span class="keywordtype">int</span> lprocfs_dt_kbytestotal_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02726"></a>02726 <span class="keywordtype">int</span> lprocfs_dt_kbytesfree_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02727"></a>02727 <span class="keywordtype">int</span> lprocfs_dt_kbytesavail_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02728"></a>02728 <span class="keywordtype">int</span> lprocfs_dt_filestotal_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02729"></a>02729 <span class="keywordtype">int</span> lprocfs_dt_filesfree_seq_show(<span class="keyword">struct</span> seq_file *m, <span class="keywordtype">void</span> *v);
<a name="l02730"></a>02730 <span class="preprocessor"># endif </span><span class="comment">/* CONFIG_PROC_FS */</span>
<a name="l02731"></a>02731 
<a name="l02732"></a>02732 <span class="preprocessor">#endif </span><span class="comment">/* __LUSTRE_DT_OBJECT_H */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:13 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
