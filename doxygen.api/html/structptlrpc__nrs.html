<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: ptlrpc_nrs Struct Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ptlrpc_nrs Struct Reference<br/>
<small>
[<a class="el" href="group__nrs.html">Network Request Scheduler</a>]</small>
</h1><!-- doxytag: class="ptlrpc_nrs" -->
<p>NRS head.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for ptlrpc_nrs:</div>
<div class="dynsection">
<div class="center"><img src="structptlrpc__nrs__coll__graph.png" border="0" usemap="#ptlrpc__nrs_coll__map" alt="Collaboration graph"/></div>
<map name="ptlrpc__nrs_coll__map" id="ptlrpc__nrs_coll__map">
<area shape="rect" id="node5" href="structptlrpc__service__part.html" title="Definition of PortalRPC service partition data." alt="" coords="469,689,664,1519"/><area shape="rect" id="node30" href="structptlrpc__nrs__policy.html" title="NRS policy." alt="" coords="1021,975,1163,1233"/><area shape="rect" id="node2" href="structlist__head.html" title="{list_head\n|+ next\l+ prev\l|}" alt="" coords="1075,31,1157,134"/><area shape="rect" id="node10" href="structptlrpc__service.html" title="Definition of PortalRPC service." alt="" coords="444,1673,649,2191"/><area shape="rect" id="node27" href="structptlrpc__at__array.html" title="{ptlrpc_at_array\n|+ paa_reqs_array\l+ paa_size\l+ paa_count\l+ paa_deadline\l+ paa_reqs_count\l|}" alt="" coords="404,312,545,467"/><area shape="rect" id="node32" href="structptlrpc__nrs__pol__desc.html" title="NRS policy registering descriptor." alt="" coords="1392,2979,1579,3186"/><area shape="rect" id="node42" href="structnrs__tbf__req.html" title="{nrs_tbf_req\n|+ tr_list\l+ tr_sequence\l|}" alt="" coords="1376,561,1496,663"/><area shape="rect" id="node57" href="structnrs__fifo__req.html" title="{nrs_fifo_req\n|+ fr_list\l+ fr_sequence\l|}" alt="" coords="1288,1545,1405,1647"/><area shape="rect" id="node8" href="structadaptive__timeout.html" title="{adaptive_timeout\n|+ at_binstart\l+ at_hist\l+ at_flags\l+ at_current\l+ at_worst_ever\l+ at_worst_time\l+ at_lock\l|}" alt="" coords="569,295,711,484"/><area shape="rect" id="node13" href="structlprocfs__stats.html" title="{lprocfs_stats\n|+ ls_num\l+ ls_biggest_alloc_num\l+ ls_flags\l+ ls_lock\l+ ls_cnt_header\l+ ls_percpu\l|}" alt="" coords="152,1018,328,1190"/><area shape="rect" id="node15" href="structlprocfs__percpu.html" title="{lprocfs_percpu\n|+ lp_cntr\l|}" alt="" coords="9,347,127,432"/><area shape="rect" id="node17" href="structlprocfs__counter.html" title="{lprocfs_counter\n|+ lc_count\l+ lc_min\l+ lc_max\l+ lc_sumsquare\l+ lc_array_sum\l|}" alt="" coords="5,5,131,160"/><area shape="rect" id="node19" href="structlprocfs__counter__header.html" title="{lprocfs_counter_header\n|+ lc_config\l+ lc_name\l+ lc_units\l|}" alt="" coords="151,329,329,449"/><area shape="rect" id="node21" href="structptlrpc__service__ops.html" title="{ptlrpc_service_ops\n|+ so_thr_init\l+ so_thr_done\l+ so_req_handler\l+ so_hpreq_handler\l+ so_req_printer\l|}" alt="" coords="688,1027,840,1181"/><area shape="rect" id="node24" href="structcfs__cpt__table.html" title="{cfs_cpt_table\n|+ ctb_nparts\l+ ctb_mask\l+ ctb_nodemask\l+ ctb_version\l|}" alt="" coords="864,1035,997,1173"/><area shape="rect" id="node38" href="structptlrpc__nrs__resource.html" title="NRS resource." alt="" coords="1077,1881,1232,1983"/><area shape="rect" id="node34" href="structptlrpc__nrs__pol__ops.html" title="NRS policy operations." alt="" coords="1412,2619,1559,2912"/><area shape="rect" id="node36" href="structptlrpc__nrs__request.html" title="NRS request." alt="" coords="1412,2259,1559,2552"/><area shape="rect" id="node45" href="structnrs__crrn__req.html" title="CRR&#45;N NRS request definition." alt="" coords="1473,1881,1596,1983"/><area shape="rect" id="node47" href="structnrs__orr__req.html" title="ORR/TRR NRS request definition." alt="" coords="1620,1829,1759,2035"/><area shape="rect" id="node49" href="structnrs__orr__key.html" title="As unique keys for grouping RPCs together, we use the object&#39;s OST FID for the..." alt="" coords="1725,1044,1824,1164"/><area shape="rect" id="node51" href="structlu__fid.html" title="File IDentifier." alt="" coords="1739,329,1811,449"/><area shape="rect" id="node53" href="structnrs__orr__req__range.html" title="Lower and upper byte offsets of a brw RPC." alt="" coords="1560,1053,1701,1155"/><area shape="rect" id="node55" href="structcfs__binheap__node.html" title="Binary heap node." alt="" coords="1783,1889,1924,1975"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aea65fa22421e95b8803d16a23de34b15"></a><!-- doxytag: member="ptlrpc_nrs::nrs_lock" ref="aea65fa22421e95b8803d16a23de34b15" args="" -->
spinlock_t&nbsp;</td><td class="memItemRight" valign="bottom"><b>nrs_lock</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlist__head.html">list_head</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#ae7e450db9f1413b9da0e4bbdd33cfb22">nrs_policy_list</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">XXX Possibly replace svcpt-&gt;scp_req_lock with another lock here.  <a href="#ae7e450db9f1413b9da0e4bbdd33cfb22"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structlist__head.html">list_head</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#abba957e518558f35d3e0dd9f2f7f7eb3">nrs_policy_queued</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of policies with queued requests.  <a href="#abba957e518558f35d3e0dd9f2f7f7eb3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abf2a529023ae89332f4b185930f1a537"></a><!-- doxytag: member="ptlrpc_nrs::nrs_svcpt" ref="abf2a529023ae89332f4b185930f1a537" args="" -->
struct <a class="el" href="structptlrpc__service__part.html">ptlrpc_service_part</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#abf2a529023ae89332f4b185930f1a537">nrs_svcpt</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service partition for this NRS head. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adb24110f68fc0c64da5e1ef0aa4733b6"></a><!-- doxytag: member="ptlrpc_nrs::nrs_policy_primary" ref="adb24110f68fc0c64da5e1ef0aa4733b6" args="" -->
struct <a class="el" href="structptlrpc__nrs__policy.html">ptlrpc_nrs_policy</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#adb24110f68fc0c64da5e1ef0aa4733b6">nrs_policy_primary</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Primary policy, which is the preferred policy for handling RPCs. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aefca80244819b99a84108e9010686738"></a><!-- doxytag: member="ptlrpc_nrs::nrs_policy_fallback" ref="aefca80244819b99a84108e9010686738" args="" -->
struct <a class="el" href="structptlrpc__nrs__policy.html">ptlrpc_nrs_policy</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#aefca80244819b99a84108e9010686738">nrs_policy_fallback</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fallback policy, which is the backup policy for handling RPCs. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5bb6a1b3602c1dd56d01a820e0e14228"></a><!-- doxytag: member="ptlrpc_nrs::nrs_queue_type" ref="a5bb6a1b3602c1dd56d01a820e0e14228" args="" -->
enum <a class="el" href="group__nrs.html#ga79e63c48a144326744316f397c52a883">ptlrpc_nrs_queue_type</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#a5bb6a1b3602c1dd56d01a820e0e14228">nrs_queue_type</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This NRS head handles either HP or regular requests. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa05e58ff4d5a998e0b24edb92a8f3ceb"></a><!-- doxytag: member="ptlrpc_nrs::nrs_req_queued" ref="aa05e58ff4d5a998e0b24edb92a8f3ceb" args="" -->
unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#aa05e58ff4d5a998e0b24edb92a8f3ceb">nrs_req_queued</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"># queued requests from all policies in this NRS head <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac28bda31fdafdd8b57f08e7233da607e"></a><!-- doxytag: member="ptlrpc_nrs::nrs_req_started" ref="ac28bda31fdafdd8b57f08e7233da607e" args="" -->
unsigned long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#ac28bda31fdafdd8b57f08e7233da607e">nrs_req_started</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"># scheduled requests from all policies in this NRS head <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a54bc17e6b4be4d73684ed821c0897bea"></a><!-- doxytag: member="ptlrpc_nrs::nrs_num_pols" ref="a54bc17e6b4be4d73684ed821c0897bea" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#a54bc17e6b4be4d73684ed821c0897bea">nrs_num_pols</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"># policies on this NRS <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab066b4e96742200fb1872733214cd89d"></a><!-- doxytag: member="ptlrpc_nrs::nrs_policy_starting" ref="ab066b4e96742200fb1872733214cd89d" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#ab066b4e96742200fb1872733214cd89d">nrs_policy_starting</a>:1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This NRS head is in progress of starting a policy. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9340ae118782160c94e4cbb9ef8f6a2a"></a><!-- doxytag: member="ptlrpc_nrs::nrs_stopping" ref="a9340ae118782160c94e4cbb9ef8f6a2a" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#a9340ae118782160c94e4cbb9ef8f6a2a">nrs_stopping</a>:1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">In progress of shutting down the whole NRS head; used during unregistration. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afb5e26c392efc34938dd705797a35f50"></a><!-- doxytag: member="ptlrpc_nrs::nrs_throttling" ref="afb5e26c392efc34938dd705797a35f50" args="" -->
unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structptlrpc__nrs.html#afb5e26c392efc34938dd705797a35f50">nrs_throttling</a>:1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">NRS policy is throttling reqeust. <br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>NRS head. </p>
<p>A PTLRPC service has at least one NRS head instance for handling normal priority RPCs, and may optionally have a second NRS head instance for handling high-priority RPCs. Each NRS head maintains a list of available policies, of which one and only one policy is acting as the fallback policy, and optionally a different policy may be acting as the primary policy. For all RPCs handled by this NRS head instance, NRS core will first attempt to enqueue the RPC using the primary policy (if any). The fallback policy is used in the following cases:</p>
<ul>
<li>when there was no primary policy in the <a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a8da4904dfb7ba56810332673912a76cb" title="A policy is in this state in two cases:it is the fallback policy, which is always...">ptlrpc_nrs_pol_state::NRS_POL_STATE_STARTED</a> state at the time the request was initialized.</li>
<li>when the primary policy that was at the ptlrpc_nrs_pol_state::PTLRPC_NRS_POL_STATE_STARTED state at the time the RPC was initialized, denoted it did not wish, or for some other reason was not able to handle the request, by returning a non-valid NRS resource reference.</li>
<li>when the primary policy that was at the ptlrpc_nrs_pol_state::PTLRPC_NRS_POL_STATE_STARTED state at the time the RPC was initialized, fails later during the request enqueueing stage.</li>
</ul>
<dl class="see"><dt><b>See also:</b></dt><dd>nrs_resource_get_safe() </dd>
<dd>
nrs_request_enqueue() </dd></dl>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00323">323</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="ae7e450db9f1413b9da0e4bbdd33cfb22"></a><!-- doxytag: member="ptlrpc_nrs::nrs_policy_list" ref="ae7e450db9f1413b9da0e4bbdd33cfb22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlist__head.html">list_head</a> <a class="el" href="structptlrpc__nrs.html#ae7e450db9f1413b9da0e4bbdd33cfb22">ptlrpc_nrs::nrs_policy_list</a><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>XXX Possibly replace svcpt-&gt;scp_req_lock with another lock here. </p>
<p>List of registered policies </p>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00329">329</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<a class="anchor" id="abba957e518558f35d3e0dd9f2f7f7eb3"></a><!-- doxytag: member="ptlrpc_nrs::nrs_policy_queued" ref="abba957e518558f35d3e0dd9f2f7f7eb3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structlist__head.html">list_head</a> <a class="el" href="structptlrpc__nrs.html#abba957e518558f35d3e0dd9f2f7f7eb3">ptlrpc_nrs::nrs_policy_queued</a><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>List of policies with queued requests. </p>
<p>Policies that have any outstanding requests are queued here, and this list is queried in a round-robin manner from NRS core when obtaining a request for handling. This ensures that requests from policies that at some point transition away from the <a class="el" href="group__nrs.html#gga843285b91fa9672fdf0fcc93b4387971a8da4904dfb7ba56810332673912a76cb" title="A policy is in this state in two cases:it is the fallback policy, which is always...">ptlrpc_nrs_pol_state::NRS_POL_STATE_STARTED</a> state are drained. </p>

<p>Definition at line <a class="el" href="lustre__nrs_8h_source.html#l00338">338</a> of file <a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>lustre/include/<a class="el" href="lustre__nrs_8h_source.html">lustre_nrs.h</a></li>
</ul>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 21:06:38 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
