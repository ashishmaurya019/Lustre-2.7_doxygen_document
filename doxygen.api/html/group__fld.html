<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Lustre: fld</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body fgcolor="#202020">
<img src="http://wiki.lustre.org/apidoc/header.jpg">
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>fld</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__fld__target.html">lu_fld_target</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__server__fld.html">lu_server_fld</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlu__client__fld.html">lu_client_fld</a></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <b>LUSTRE_CLI_FLD_HASH_DHT</b> =  0, 
<b>LUSTRE_CLI_FLD_HASH_RRB</b>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9b9b539b1ae1fe361f0430409a383db5"></a><!-- doxytag: member="fld::fld_server_init" ref="ga9b9b539b1ae1fe361f0430409a383db5" args="(const struct lu_env *env, struct lu_server_fld *fld, struct dt_device *dt, const char *prefix, int type)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_server_init</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, struct <a class="el" href="structdt__device.html">dt_device</a> *dt, const char *prefix, int type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad8fe90d1d0ee9dfec32bc62d1b8a1be7"></a><!-- doxytag: member="fld::fld_server_fini" ref="gad8fe90d1d0ee9dfec32bc62d1b8a1be7" args="(const struct lu_env *env, struct lu_server_fld *fld)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_server_fini</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3efa3c7a56f46507051b803063bda783"></a><!-- doxytag: member="fld::fld_declare_server_create" ref="ga3efa3c7a56f46507051b803063bda783" args="(const struct lu_env *env, struct lu_server_fld *fld, const struct lu_seq_range *range, struct thandle *th)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_declare_server_create</b> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, const struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *range, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fld.html#ga7c1be0aa5d0f655c08d1e1810246188b">fld_server_create</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, const struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *add_range, struct <a class="el" href="structthandle.html">thandle</a> *th)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Insert FLD index entry and update FLD cache.  <a href="#ga7c1be0aa5d0f655c08d1e1810246188b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fld.html#gae8f48350563bdfa8ce96124db14eed9f">fld_insert_entry</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, const struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *range)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">insert entry in fld store.  <a href="#gae8f48350563bdfa8ce96124db14eed9f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fld.html#ga564c5cfc33e401f8dd9c4ede0bd8cd62">fld_server_lookup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, u64 seq, struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *range)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup MDT/OST by seq, returns a range for given seq.  <a href="#ga564c5cfc33e401f8dd9c4ede0bd8cd62"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaaebfe53fda6d4c3bb7dfc963bdb19509"></a><!-- doxytag: member="fld::fld_local_lookup" ref="gaaebfe53fda6d4c3bb7dfc963bdb19509" args="(const struct lu_env *env, struct lu_server_fld *fld, u64 seq, struct lu_seq_range *range)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fld.html#gaaebfe53fda6d4c3bb7dfc963bdb19509">fld_local_lookup</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld, u64 seq, struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *range)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup sequece in local cache/fldb. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gabc127f61b9b80080cf6305837c232382"></a><!-- doxytag: member="fld::fld_update_from_controller" ref="gabc127f61b9b80080cf6305837c232382" args="(const struct lu_env *env, struct lu_server_fld *fld)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__fld.html#gabc127f61b9b80080cf6305837c232382">fld_update_from_controller</a> (const struct <a class="el" href="structlu__env.html">lu_env</a> *env, struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *fld)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve fldb entry from MDT0 and add to local FLDB and cache. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga61d3efa605b8eef01775fbe46b903dc4"></a><!-- doxytag: member="fld::fld_client_init" ref="ga61d3efa605b8eef01775fbe46b903dc4" args="(struct lu_client_fld *fld, const char *prefix, int hash)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_init</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, const char *prefix, int hash)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad4ee232ae9fa8a05b0c1c5cfabad08a6"></a><!-- doxytag: member="fld::fld_client_fini" ref="gad4ee232ae9fa8a05b0c1c5cfabad08a6" args="(struct lu_client_fld *fld)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_fini</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga8ef4db802ffc06e9f3e44185d6d75e0c"></a><!-- doxytag: member="fld::fld_client_flush" ref="ga8ef4db802ffc06e9f3e44185d6d75e0c" args="(struct lu_client_fld *fld)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_flush</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga78bb601175be76086dae36ff847ed432"></a><!-- doxytag: member="fld::fld_client_lookup" ref="ga78bb601175be76086dae36ff847ed432" args="(struct lu_client_fld *fld, u64 seq, u32 *mds, __u32 flags, const struct lu_env *env)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_lookup</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, u64 seq, u32 *mds, __u32 flags, const struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gab88bf60769d34f2e1ace1dc4bd5ef624"></a><!-- doxytag: member="fld::fld_client_create" ref="gab88bf60769d34f2e1ace1dc4bd5ef624" args="(struct lu_client_fld *fld, struct lu_seq_range *range, const struct lu_env *env)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_create</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *range, const struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4ac8e0a1fb25c661a1b2b8f6099f8ae1"></a><!-- doxytag: member="fld::fld_client_delete" ref="ga4ac8e0a1fb25c661a1b2b8f6099f8ae1" args="(struct lu_client_fld *fld, u64 seq, const struct lu_env *env)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_delete</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, u64 seq, const struct <a class="el" href="structlu__env.html">lu_env</a> *env)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga658da85e5dc251dd63518c88d902dfcc"></a><!-- doxytag: member="fld::fld_client_add_target" ref="ga658da85e5dc251dd63518c88d902dfcc" args="(struct lu_client_fld *fld, struct lu_fld_target *tar)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_add_target</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, struct <a class="el" href="structlu__fld__target.html">lu_fld_target</a> *tar)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga3e9ddd18dcad3763e124f3da782c9b18"></a><!-- doxytag: member="fld::fld_client_del_target" ref="ga3e9ddd18dcad3763e124f3da782c9b18" args="(struct lu_client_fld *fld, __u64 idx)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_del_target</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld, __u64 idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga72fe7bcae3d9844c63639aab20cb8ecd"></a><!-- doxytag: member="fld::fld_client_proc_fini" ref="ga72fe7bcae3d9844c63639aab20cb8ecd" args="(struct lu_client_fld *fld)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>fld_client_proc_fini</b> (struct <a class="el" href="structlu__client__fld.html">lu_client_fld</a> *fld)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gae8f48350563bdfa8ce96124db14eed9f"></a><!-- doxytag: member="lustre_fld.h::fld_insert_entry" ref="gae8f48350563bdfa8ce96124db14eed9f" args="(const struct lu_env *env, struct lu_server_fld *fld, const struct lu_seq_range *range)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fld_insert_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *&nbsp;</td>
          <td class="paramname"> <em>fld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *&nbsp;</td>
          <td class="paramname"> <em>range</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>insert entry in fld store. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>env</em>&nbsp;</td><td>relevant <a class="el" href="structlu__env.html" title="Environment.">lu_env</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fld</em>&nbsp;</td><td>fld store </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>range</em>&nbsp;</td><td>range to be inserted</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-ve</em>&nbsp;</td><td>error</td></tr>
  </table>
  </dd>
</dl>
<p>Caller must hold fld-&gt;lsf_lock </p>

<p>Definition at line <a class="el" href="fld__index_8c_source.html#l00273">273</a> of file <a class="el" href="fld__index_8c_source.html">fld_index.c</a>.</p>

<p>References <a class="el" href="lu__object_8h_source.html#l00472">lu_object::lo_dev</a>, <a class="el" href="lustre__fld_8h_source.html#l00093">lu_server_fld::lsf_lock</a>, and <a class="el" href="lustre__fld_8h_source.html#l00080">lu_server_fld::lsf_obj</a>.</p>

<p>Referenced by <a class="el" href="fld__handler_8c_source.html#l00128">fld_update_from_controller()</a>, and <a class="el" href="fid__handler_8c_source.html#l00275">seq_server_check_and_alloc_super()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00276"></a>00276 {
<a name="l00277"></a>00277         <span class="keyword">struct </span><a class="code" href="structthandle.html" title="This is the general purpose transaction handle.">thandle</a> *th;
<a name="l00278"></a>00278         <span class="keywordtype">int</span> rc;
<a name="l00279"></a>00279         ENTRY;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         LASSERT(mutex_is_locked(&amp;fld-&gt;<a class="code" href="structlu__server__fld.html#a4c2c31c32bc3ed33778317078112a40a" title="Protect index modifications.">lsf_lock</a>));
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         th = dt_trans_create(env, lu2dt_dev(fld-&gt;<a class="code" href="structlu__server__fld.html#a444bccf27f57be9dfb659d185e809ac6" title="/fld file object device">lsf_obj</a>-&gt;do_lu.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>));
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (IS_ERR(th))
<a name="l00285"></a>00285                 RETURN(PTR_ERR(th));
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         rc = fld_declare_index_create(env, fld, range, th);
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (rc != 0) {
<a name="l00289"></a>00289                 <span class="keywordflow">if</span> (rc == -EEXIST)
<a name="l00290"></a>00290                         rc = 0;
<a name="l00291"></a>00291                 GOTO(out, rc);
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         rc = dt_trans_start_local(env, lu2dt_dev(fld-&gt;<a class="code" href="structlu__server__fld.html#a444bccf27f57be9dfb659d185e809ac6" title="/fld file object device">lsf_obj</a>-&gt;do_lu.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>),
<a name="l00295"></a>00295                                   th);
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (rc)
<a name="l00297"></a>00297                 GOTO(out, rc);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299         rc = fld_index_create(env, fld, range, th);
<a name="l00300"></a>00300         <span class="keywordflow">if</span> (rc == -EEXIST)
<a name="l00301"></a>00301                 rc = 0;
<a name="l00302"></a>00302 out:
<a name="l00303"></a>00303         dt_trans_stop(env, lu2dt_dev(fld-&gt;<a class="code" href="structlu__server__fld.html#a444bccf27f57be9dfb659d185e809ac6" title="/fld file object device">lsf_obj</a>-&gt;do_lu.<a class="code" href="structlu__object.html#a5b9108a283d9901c95bdf32833f70601" title="Device for this layer.">lo_dev</a>), th);
<a name="l00304"></a>00304         RETURN(rc);
<a name="l00305"></a>00305 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__fld_gae8f48350563bdfa8ce96124db14eed9f_icgraph.png" border="0" usemap="#group__fld_gae8f48350563bdfa8ce96124db14eed9f_icgraph_map" alt=""></div>
<map name="group__fld_gae8f48350563bdfa8ce96124db14eed9f_icgraph_map" id="group__fld_gae8f48350563bdfa8ce96124db14eed9f_icgraph">
<area shape="rect" id="node3" href="group__fld.html#gabc127f61b9b80080cf6305837c232382" title="Retrieve fldb entry from MDT0 and add to local FLDB and cache." alt="" coords="211,5,413,35"/><area shape="rect" id="node5" href="group__fid.html#ga019b809314cad1f1e5152bdc586b9008" title="Check if the sequence server has sequence avaible." alt="" coords="185,59,439,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga7c1be0aa5d0f655c08d1e1810246188b"></a><!-- doxytag: member="lustre_fld.h::fld_server_create" ref="ga7c1be0aa5d0f655c08d1e1810246188b" args="(const struct lu_env *env, struct lu_server_fld *fld, const struct lu_seq_range *add_range, struct thandle *th)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fld_server_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *&nbsp;</td>
          <td class="paramname"> <em>fld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *&nbsp;</td>
          <td class="paramname"> <em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structthandle.html">thandle</a> *&nbsp;</td>
          <td class="paramname"> <em>th</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Insert FLD index entry and update FLD cache. </p>
<p>This function is called from the sequence allocator when a super-sequence is granted to a server. </p>

<p>Definition at line <a class="el" href="fld__handler_8c_source.html#l00094">94</a> of file <a class="el" href="fld__handler_8c_source.html">fld_handler.c</a>.</p>

<p>References <a class="el" href="lustre__fld_8h_source.html#l00093">lu_server_fld::lsf_lock</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097         <span class="keywordtype">int</span> rc;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         mutex_lock(&amp;fld-&gt;<a class="code" href="structlu__server__fld.html#a4c2c31c32bc3ed33778317078112a40a" title="Protect index modifications.">lsf_lock</a>);
<a name="l00100"></a>00100         rc = fld_index_create(env, fld, range, th);
<a name="l00101"></a>00101         mutex_unlock(&amp;fld-&gt;<a class="code" href="structlu__server__fld.html#a4c2c31c32bc3ed33778317078112a40a" title="Protect index modifications.">lsf_lock</a>);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103         RETURN(rc);
<a name="l00104"></a>00104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ga564c5cfc33e401f8dd9c4ede0bd8cd62"></a><!-- doxytag: member="lustre_fld.h::fld_server_lookup" ref="ga564c5cfc33e401f8dd9c4ede0bd8cd62" args="(const struct lu_env *env, struct lu_server_fld *fld, u64 seq, struct lu_seq_range *range)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fld_server_lookup </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structlu__env.html">lu_env</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__server__fld.html">lu_server_fld</a> *&nbsp;</td>
          <td class="paramname"> <em>fld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u64&nbsp;</td>
          <td class="paramname"> <em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structlu__seq__range.html">lu_seq_range</a> *&nbsp;</td>
          <td class="paramname"> <em>range</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup MDT/OST by seq, returns a range for given seq. </p>
<p>If that entry is not cached in fld cache, request is sent to super sequence controller node (MDT0). All other MDT[1...N] and client cache fld entries, but this cache is not persistent. </p>

<p>Definition at line <a class="el" href="fld__handler_8c_source.html#l00241">241</a> of file <a class="el" href="fld__handler_8c_source.html">fld_handler.c</a>.</p>

<p>References <a class="el" href="fld__handler_8c_source.html#l00205">fld_local_lookup()</a>, <a class="el" href="lustre__fld_8h_source.html#l00089">lu_server_fld::lsf_cache</a>, <a class="el" href="lustre__fld_8h_source.html#l00085">lu_server_fld::lsf_control_exp</a>, and <a class="el" href="lustre__fld_8h_source.html#l00097">lu_server_fld::lsf_name</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00243"></a>00243 {
<a name="l00244"></a>00244         __u32 index;
<a name="l00245"></a>00245         <span class="keywordtype">int</span> rc;
<a name="l00246"></a>00246         ENTRY;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         rc = <a class="code" href="group__fld.html#gaaebfe53fda6d4c3bb7dfc963bdb19509" title="Lookup sequece in local cache/fldb.">fld_local_lookup</a>(env, fld, seq, range);
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (likely(rc == 0))
<a name="l00250"></a>00250                 RETURN(rc);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         rc = fld_name_to_index(fld-&gt;<a class="code" href="structlu__server__fld.html#a7d13ffdae44cc4b43ab554eb3cd3c440" title="Fld service name in form &amp;quot;fld-srv-lustre-MDTXXX&amp;quot;.">lsf_name</a>, &amp;index);
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (rc &lt; 0)
<a name="l00254"></a>00254                 RETURN(rc);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (index == 0 &amp;&amp; rc == LDD_F_SV_TYPE_MDT) {
<a name="l00257"></a>00257                 <span class="comment">/* On server side, all entries should be in cache.</span>
<a name="l00258"></a>00258 <span class="comment">                 * If we can not find it in cache, just return error */</span>
<a name="l00259"></a>00259                 CERROR(<span class="stringliteral">&quot;%s: Cannot find sequence &quot;</span>LPX64<span class="stringliteral">&quot;: rc = %d\n&quot;</span>,
<a name="l00260"></a>00260                        fld-&gt;<a class="code" href="structlu__server__fld.html#a7d13ffdae44cc4b43ab554eb3cd3c440" title="Fld service name in form &amp;quot;fld-srv-lustre-MDTXXX&amp;quot;.">lsf_name</a>, seq, -ENOENT);
<a name="l00261"></a>00261                 RETURN(-ENOENT);
<a name="l00262"></a>00262         } <span class="keywordflow">else</span> {
<a name="l00263"></a>00263                 <span class="keywordflow">if</span> (fld-&gt;<a class="code" href="structlu__server__fld.html#a58b909e2fbe544cb394a71a40148e16f" title="super sequence controller export, needed to forward fld lookup request.">lsf_control_exp</a> == NULL) {
<a name="l00264"></a>00264                         CERROR(<span class="stringliteral">&quot;%s: lookup &quot;</span>LPX64<span class="stringliteral">&quot;, but not connects to MDT0&quot;</span>
<a name="l00265"></a>00265                                <span class="stringliteral">&quot;yet: rc = %d.\n&quot;</span>, fld-&gt;<a class="code" href="structlu__server__fld.html#a7d13ffdae44cc4b43ab554eb3cd3c440" title="Fld service name in form &amp;quot;fld-srv-lustre-MDTXXX&amp;quot;.">lsf_name</a>, seq, -EIO);
<a name="l00266"></a>00266                         RETURN(-EIO);
<a name="l00267"></a>00267                 }
<a name="l00268"></a>00268                 <span class="comment">/* send request to mdt0 i.e. super seq. controller.</span>
<a name="l00269"></a>00269 <span class="comment">                 * This is temporary solution, long term solution is fld</span>
<a name="l00270"></a>00270 <span class="comment">                 * replication on all mdt servers.</span>
<a name="l00271"></a>00271 <span class="comment">                 */</span>
<a name="l00272"></a>00272                 range-&gt;lsr_start = seq;
<a name="l00273"></a>00273                 rc = fld_client_rpc(fld-&gt;<a class="code" href="structlu__server__fld.html#a58b909e2fbe544cb394a71a40148e16f" title="super sequence controller export, needed to forward fld lookup request.">lsf_control_exp</a>,
<a name="l00274"></a>00274                                     range, FLD_QUERY, NULL);
<a name="l00275"></a>00275                 <span class="keywordflow">if</span> (rc == 0)
<a name="l00276"></a>00276                         fld_cache_insert(fld-&gt;<a class="code" href="structlu__server__fld.html#a830acf480ce13f8d991cc0557295fa92" title="Client FLD cache.">lsf_cache</a>, range);
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278         RETURN(rc);
<a name="l00279"></a>00279 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__fld_ga564c5cfc33e401f8dd9c4ede0bd8cd62_cgraph.png" border="0" usemap="#group__fld_ga564c5cfc33e401f8dd9c4ede0bd8cd62_cgraph_map" alt=""></div>
<map name="group__fld_ga564c5cfc33e401f8dd9c4ede0bd8cd62_cgraph_map" id="group__fld_ga564c5cfc33e401f8dd9c4ede0bd8cd62_cgraph">
<area shape="rect" id="node3" href="group__fld.html#gaaebfe53fda6d4c3bb7dfc963bdb19509" title="Lookup sequece in local cache/fldb." alt="" coords="192,5,317,35"/><area shape="rect" id="node5" href="group__lu.html#ga8fcebe57d8fb288a73a39144693074af" title="Return value associated with key key in context ctx." alt="" coords="365,5,523,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr size="1"><address style="text-align: right;"><small>
Generated on Sun Jun 5 20:55:43 2016 for Lustre by&nbsp;<a href="http://www.doxygen.org/index.html">doxygen</a> 1.6.1</small></address><br>
<small><a href="http://www.sun.com/contact">Contact</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/index.html">About Sun</a>&nbsp;|&nbsp;<a href="http://www.sun.com/aboutsun/media/index.html">News</a>&nbsp;|&nbsp;<a href="http://www.sun.com/corp_emp/">Employment</a>&nbsp;|&nbsp;<a href="http://www.sun.com/privacy/">Privacy</a>&nbsp;|&nbsp;<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a>&nbsp;|&nbsp;<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;(C) 2008 Sun Microsystems, Inc.</small>
</body>
</html>
